/*! For license information please see fsbot.min.js.LICENSE.txt */
(()=>{var e,t,n={5969:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AzureAudience:()=>s,AzureClient:()=>ii,AzureFunctionTokenProvider:()=>ci,ScopeType:()=>si});var r={};n.r(r),n.d(r,{Decoder:()=>qn,Encoder:()=>Ln,PacketType:()=>Mn,protocol:()=>Dn});var i=n(9074);class s extends i.c{createServiceMember(e){const t=e.user;return function(e,t){if(!e)throw new Error(t)}(void 0!==(null==t?void 0:t.name),'Provided user was not an "AzureUser".'),{userId:e.user.id,userName:t.name,connections:[],additionalDetails:t.additionalDetails}}}var o=n(3738),a=n(2045),c=n(1783),l=n(4839),u=n(2186),h=n(2738);const d=e=>"fluid"===(null==e?void 0:e.type);function p(e){if(!d(e))throw new Error(`resolved is not a Fluid url. Type: ${null==e?void 0:e.type}`)}class f{constructor(e){this.urlResolvers=e}static create(e){return Array.isArray(e)?1===e.length?e[0]:new f(e):e}async resolve(e){return async function(e,t){let n;for(const r of e)if(n=await r.resolve(Object.assign({},t)),void 0!==n)return n}(this.urlResolvers,e)}async getAbsoluteUrl(e,t){throw new Error("Not implmented")}}var g=n(8575);class m{constructor(e){this.protocolName="none:",this.protocolToDocumentFactoryMap=new Map,e.forEach((e=>{this.protocolToDocumentFactoryMap.set(e.protocolName,e)}))}static create(e){if(Array.isArray(e)){const t=[];return e.forEach((e=>{const n=e;void 0!==n.protocolToDocumentFactoryMap?t.push(...n.protocolToDocumentFactoryMap.values()):t.push(e)})),1===t.length?t[0]:new m(t)}return e}async createDocumentService(e,t,n){p(e);const r=(0,g.Qc)(e.url);if(void 0===r.protocol||null===r.protocol)throw new Error("No protocol provided");const i=this.protocolToDocumentFactoryMap.get(r.protocol);if(void 0===i)throw new Error("Unknown Fluid protocol");return i.createDocumentService(e,t,n)}async createContainer(e,t,n,r){p(t);const i=(0,g.Qc)(t.url);if(void 0===i.protocol||null===i.protocol)throw new Error("No protocol provided");const s=this.protocolToDocumentFactoryMap.get(i.protocol);if(void 0===s)throw new Error("Unknown Fluid protocol");return s.createContainer(e,t,n,r)}}var y=n(2492),v=n.n(y);const b=window.performance;function S(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}function w(e,t="Unreachable Case"){throw new Error(t)}var x,C=n(7846),E=n(9268);function T(e,t){return{type:x.Tree,tree:{".protocol":t,".app":e}}}!function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(x||(x={}));const A=window.performance,k=async e=>new Promise((t=>setTimeout((()=>t()),e)));var N=n(2505),O=n(9077);const P="1.3.7";async function R(e,t,n,r){var i,s;let o,a=!1,c=1e3,l=0;const u=A.now();let h;do{try{o=await e(r.cancel),a=!0}catch(e){if(!(0,O.ms)(e))throw n.sendTelemetryEvent({eventName:`${t}_cancel`,retry:l,duration:A.now()-u,fetchCallName:t},e),e;if(!0===(null===(i=r.cancel)||void 0===i?void 0:i.aborted))throw n.sendTelemetryEvent({eventName:`${t}_runWithRetryAborted`,retry:l,duration:A.now()-u,fetchCallName:t},e),new O.V2("runWithRetry was Aborted",N.C.genericError,{driverVersion:P,fetchCallName:t});l++,h=e,c=null!==(s=(0,O.ZZ)(e))&&void 0!==s?s:Math.min(2*c,8e3),r.onRetry&&r.onRetry(c,e),await k(c)}}while(!a);return l>0&&n.sendTelemetryEvent({eventName:`${t}_lastError`,retry:l,duration:A.now()-u,fetchCallName:t},h),o}var I,F,D,M=n(9252),L=n(4025);(D=I||(I={})).NoOp="noop",D.ClientJoin="join",D.ClientLeave="leave",D.Propose="propose",D.Reject="reject",D.Summarize="summarize",D.SummaryAck="summaryAck",D.SummaryNack="summaryNack",D.Operation="op",D.RemoteHelp="remoteHelp",D.NoClient="noClient",D.RoundTrip="tripComplete",D.Control="control",function(e){e.ThrottlingError="ThrottlingError",e.InvalidScopeError="InvalidScopeError",e.BadRequestError="BadRequestError",e.LimitExceededError="LimitExceededError"}(F||(F={}));var _,q,B,j=n(7187),z=n(361),H=n.n(z);class U extends j.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}function V(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}class G{constructor(e,t,n,r){this.sequenceNumber=e,this.key=t,this.value=n,this.local=r}}class W extends U{constructor(e){super(),this.isDisposed=!1,this.members=new Map(e),this.snapshotCache=e}get disposed(){return this.isDisposed}snapshot(){var e;return null!==(e=this.snapshotCache)&&void 0!==e||(this.snapshotCache=H()(Array.from(this.members))),this.snapshotCache}addMember(e,t){V(!this.members.has(e),462),this.members.set(e,t),this.emit("addMember",e,t),this.snapshotCache=void 0}removeMember(e){V(this.members.has(e),463),this.members.delete(e),this.emit("removeMember",e),this.snapshotCache=void 0}getMembers(){return new Map(this.members)}getMember(e){return this.members.get(e)}dispose(){this.isDisposed=!0}}class K extends U{constructor(e,t){super(),this.sendProposal=t,this.isDisposed=!1,this.stateEvents=new j.EventEmitter,this.proposals=new Map(e.proposals.map((([,e])=>[e.sequenceNumber,new G(e.sequenceNumber,e.key,e.value,!1)]))),this.values=new Map(e.values),this.proposalsSnapshotCache=e.proposals,this.valuesSnapshotCache=e.values}get disposed(){return this.isDisposed}snapshot(){var e,t;return null!==(e=this.proposalsSnapshotCache)&&void 0!==e||(this.proposalsSnapshotCache=Array.from(this.proposals).map((([e,t])=>[e,{sequenceNumber:e,key:t.key,value:t.value},[]]))),null!==(t=this.valuesSnapshotCache)&&void 0!==t||(this.valuesSnapshotCache=H()(Array.from(this.values))),{proposals:this.proposalsSnapshotCache,values:this.valuesSnapshotCache}}has(e){return this.values.has(e)}get(e){var t;return null===(t=this.values.get(e))||void 0===t?void 0:t.value}getApprovalData(e){const t=this.values.get(e);return t?H()(t):void 0}async propose(e,t){const n=this.sendProposal(e,t);if(n<0)throw this.emit("error",{eventName:"ProposalInDisconnectedState",key:e}),new Error("Can't propose in disconnected state");return new Promise(((e,t)=>{let r;const i=(e,t)=>{e===n&&(r=t,this.stateEvents.off("localProposalSequenced",i),this.stateEvents.off("disconnected",o),this.stateEvents.on("localProposalApproved",s))},s=t=>{t===r&&(e(),c())},o=()=>{void 0===r&&this.stateEvents.once("connected",(()=>{void 0===r&&(t(new Error("Client disconnected without successfully sending proposal")),c())}))},a=()=>{t(new Error("QuorumProposals was disposed")),c()},c=()=>{this.stateEvents.off("localProposalSequenced",i),this.stateEvents.off("localProposalApproved",s),this.stateEvents.off("disconnected",o),this.stateEvents.off("disposed",a)};this.stateEvents.on("localProposalSequenced",i),this.stateEvents.on("disconnected",o),this.stateEvents.on("disposed",a)}))}addProposal(e,t,n,r,i){V(!this.proposals.has(n),464);const s=new G(n,e,t,r);this.proposals.set(n,s),this.emit("addProposal",s),r&&this.stateEvents.emit("localProposalSequenced",i,n),this.proposalsSnapshotCache=void 0}updateMinimumSequenceNumber(e){const t=e.minimumSequenceNumber,n=[];for(const[e,r]of this.proposals)e<=t&&n.push(r);n.sort(((e,t)=>e.sequenceNumber-t.sequenceNumber));for(const t of n){const n={approvalSequenceNumber:e.sequenceNumber,commitSequenceNumber:-1,key:t.key,sequenceNumber:t.sequenceNumber,value:t.value};this.values.set(n.key,n),this.valuesSnapshotCache=void 0,this.emit("approveProposal",n.sequenceNumber,n.key,n.value,n.approvalSequenceNumber),this.proposals.delete(t.sequenceNumber),this.proposalsSnapshotCache=void 0,t.local&&this.stateEvents.emit("localProposalApproved",t.sequenceNumber)}}setConnectionState(e){e?this.stateEvents.emit("connected"):this.stateEvents.emit("disconnected")}dispose(){this.isDisposed=!0,this.stateEvents.emit("disposed")}}class $ extends U{constructor(e,t,n,r){super(),this.isDisposed=!1,this.quorumClients=new W(e),this.quorumClients.on("addMember",((e,t)=>{this.emit("addMember",e,t)})),this.quorumClients.on("removeMember",(e=>{this.emit("removeMember",e)})),this.quorumProposals=new K({proposals:t,values:n},r),this.quorumProposals.on("addProposal",(e=>{this.emit("addProposal",e)})),this.quorumProposals.on("approveProposal",((e,t,n,r)=>{this.emit("approveProposal",e,t,n,r)}))}get disposed(){return this.isDisposed}close(){this.removeAllListeners()}snapshot(){const e=this.quorumClients.snapshot(),{proposals:t,values:n}=this.quorumProposals.snapshot();return{members:e,proposals:t,values:n}}has(e){return this.quorumProposals.has(e)}get(e){return this.quorumProposals.get(e)}getApprovalData(e){return this.quorumProposals.getApprovalData(e)}addMember(e,t){this.quorumClients.addMember(e,t)}removeMember(e){this.quorumClients.removeMember(e)}getMembers(){return this.quorumClients.getMembers()}getMember(e){return this.quorumClients.getMember(e)}async propose(e,t){return this.quorumProposals.propose(e,t)}addProposal(e,t,n,r,i){return this.quorumProposals.addProposal(e,t,n,r,i)}updateMinimumSequenceNumber(e){this.quorumProposals.updateMinimumSequenceNumber(e)}setConnectionState(e,t){this.quorumProposals.setConnectionState(e)}dispose(){throw new Error("Not implemented.")}}class J{constructor(e,t,n,r,i,s,o){this.minimumSequenceNumber=e,this.sequenceNumber=t,this.term=null!=n?n:1,this._quorum=new $(r,i,s,o)}get quorum(){return this._quorum}get attributes(){return{minimumSequenceNumber:this.minimumSequenceNumber,sequenceNumber:this.sequenceNumber,term:this.term}}setConnectionState(e,t){this._quorum.setConnectionState(e,t)}snapshot(){return this._quorum.snapshot()}close(){this._quorum.close()}processMessage(e,t){if(e.sequenceNumber!==this.sequenceNumber+1)throw new Error(`Protocol state is not moving sequentially. Current is ${this.sequenceNumber}. Next is ${e.sequenceNumber}`);this.sequenceNumber=e.sequenceNumber,this.minimumSequenceNumber=e.minimumSequenceNumber;let n=!1;switch(e.type){case I.ClientJoin:const r=e,i=JSON.parse(r.data),s={client:i.detail,sequenceNumber:r.sequenceNumber};this._quorum.addMember(i.clientId,s);break;case I.ClientLeave:const o=e,a=JSON.parse(o.data);this._quorum.removeMember(a);break;case I.Propose:const c=e.contents;this._quorum.addProposal(c.key,c.value,e.sequenceNumber,t,e.clientSequenceNumber),n=!0;break;case I.Reject:throw new Error("Quorum rejection is removed.")}return this._quorum.updateMinimumSequenceNumber(e),{immediateNoOp:n}}getProtocolState(){return Object.assign({sequenceNumber:this.sequenceNumber,minimumSequenceNumber:this.minimumSequenceNumber},this._quorum.snapshot())}}class Q extends J{processMessage(e,t){const n=this._quorum.getMember(e.clientId);if(null!=e.clientId){if(void 0===n&&e.type!==I.ClientJoin)throw new Error("Remote message's clientId is missing from the quorum");if(!0===(null==n?void 0:n.shouldHaveLeft)&&e.type!==I.NoOp)throw new Error("Remote message's clientId already should have left")}return super.processMessage(e,t)}}!function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(_||(_={})),function(e){e.NoOp="noop",e.ClientJoin="join",e.ClientLeave="leave",e.Propose="propose",e.Reject="reject",e.Summarize="summarize",e.SummaryAck="summaryAck",e.SummaryNack="summaryNack",e.Operation="op",e.RemoteHelp="remoteHelp",e.NoClient="noClient",e.RoundTrip="tripComplete",e.Control="control"}(q||(q={})),function(e){e.ThrottlingError="ThrottlingError",e.InvalidScopeError="InvalidScopeError",e.BadRequestError="BadRequestError",e.LimitExceededError="LimitExceededError"}(B||(B={}));var X,Z=n(120),Y=n(8595),ee=n(2718);class te extends j.EventEmitter{constructor(){super(...arguments),this.members=new Map}on(e,t){return super.on(e,t)}addMember(e,t){this.members.set(e,t),this.emit("addMember",e,t)}removeMember(e){const t=this.members.get(e);return void 0!==t&&(this.members.delete(e),this.emit("removeMember",e,t),!0)}getMembers(){return new Map(this.members)}getMember(e){return this.members.get(e)}clear(){const e=this.members.keys();for(const t of e)this.removeMember(t)}}class ne{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return void 0===this.result&&(this.result=this.execute()),this.result}}class re{constructor(e,t,n,r,i,s,o,a,c,l,u,h,d,p,f){this.container=e,this.scope=t,this.codeLoader=n,this._codeDetails=r,this._baseSnapshot=i,this.deltaManager=s,this.loader=a,this.submitFn=c,this.submitSignalFn=l,this.closeFn=u,this.version=h,this.updateDirtyContainerState=d,this.existing=p,this.pendingLocalState=f,this._disposed=!1,this._quorum=o,this.taggedLogger=e.subLogger,this._fluidModuleP=new ne((async()=>this.loadCodeModule(r))),this.attachListener()}static async createOrLoad(e,t,n,r,i,s,o,a,c,l,u,h,d,p,f){const g=new re(e,t,n,r,i,s,o,a,c,l,u,h,d,p,f);return await g.instantiateRuntime(p),g}get clientId(){return this.container.clientId}get id(){const e=this.container.resolvedUrl;return d(e)?e.id:""}get clientDetails(){return this.container.clientDetails}get connected(){return this.container.connected}get canSummarize(){return"summarize"in this.runtime}get serviceConfiguration(){return this.container.serviceConfiguration}get audience(){return this.container.audience}get options(){return this.container.options}get baseSnapshot(){return this._baseSnapshot}get storage(){return this.container.storage}get runtime(){if(void 0===this._runtime)throw new Error("Attempted to access runtime before it was defined");return this._runtime}get disposed(){return this._disposed}get codeDetails(){return this._codeDetails}get quorum(){return this._quorum}getSpecifiedCodeDetails(){var e;return null!==(e=this._quorum.get("code"))&&void 0!==e?e:this._quorum.get("code2")}dispose(e){this._disposed||(this._disposed=!0,this.runtime.dispose(e),this._quorum.dispose(),this.deltaManager.dispose())}getLoadedFromVersion(){return this.container.loadedFromVersion}get attachState(){return this.container.attachState}createSummary(e){return this.runtime.createSummary(e)}setConnectionState(e,t){const n=this.runtime;S(e===this.connected,222),n.setConnectionState(e,t)}process(e,t,n){this.runtime.process(e,t,n)}processSignal(e,t){this.runtime.processSignal(e,t)}async request(e){return this.runtime.request(e)}async getAbsoluteUrl(e){return this.container.getAbsoluteUrl(e)}getPendingLocalState(){return this.runtime.getPendingLocalState()}async satisfies(e){var t;const n=[],r=this.codeLoader;void 0!==r.IFluidCodeDetailsComparer&&n.push(r.IFluidCodeDetailsComparer);const i=await this._fluidModuleP,s=null===(t=i.module)||void 0===t?void 0:t.fluidExport;if(void 0!==(null==s?void 0:s.IFluidCodeDetailsComparer)&&n.push(s.IFluidCodeDetailsComparer),0===n.length)return!1;for(const t of n)if(!1===await t.satisfies(i.details,e))return!1;return!0}notifyAttaching(e){var t,n;this._baseSnapshot=e,null===(n=(t=this.runtime).notifyAttaching)||void 0===n||n.call(t,e),this.runtime.setAttachState(o.mB.Attaching)}async getRuntimeFactory(){var e;const t=null===(e=(await this._fluidModuleP).module)||void 0===e?void 0:e.fluidExport,n=null==t?void 0:t.IRuntimeFactory;if(void 0===n)throw new Error("Code package does not implement IRuntimeFactory");return n}async instantiateRuntime(e){const t=await this.getRuntimeFactory();this._runtime=await t.instantiateRuntime(this,e)}attachListener(){this.container.once("attached",(()=>{this.runtime.setAttachState(o.mB.Attached)}))}async loadCodeModule(e){const t=await h.Xr.timedExecAsync(this.taggedLogger,{eventName:"CodeLoad"},(async()=>this.codeLoader.load(e)));if("module"in t){const{module:n,details:r}=t;return{module:n,details:null!=r?r:e}}return this.taggedLogger.sendTelemetryEvent({eventName:"LegacyCodeLoader"}),t}}!function(e){e.Never="Never",e.Disabled="Disabled",e.Enabled="Enabled"}(X||(X={}));var ie=n(8599),se=n.n(ie);class oe extends j.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}var ae=n(5708),ce=n(7237),le=n.n(ce);class ue extends oe{constructor(e){super(),this.worker=e,this.isDisposed=!1,this.q=new(le()),this.pauseCount=1}get disposed(){return this.isDisposed}get paused(){return 0!==this.pauseCount}get length(){return this.q.length}get idle(){return void 0===this.processingPromise&&0===this.q.length}async waitTillProcessingDone(){var e;return null!==(e=this.processingPromise)&&void 0!==e?e:{count:0,duration:0}}dispose(){throw new Error("Not implemented.")}clear(){this.q.clear()}peek(){return this.q.peekFront()}toArray(){return this.q.toArray()}push(e){try{this.q.push(e),this.emit("push",e),this.ensureProcessing()}catch(e){this.emit("error",e)}}async pause(){this.pauseCount++,await this.waitTillProcessingDone()}resume(){S(this.pauseCount>0,244),this.pauseCount--,this.ensureProcessing()}ensureProcessing(){this.anythingToProcess()&&void 0===this.processingPromise&&(this.processingPromise=Promise.resolve().then((()=>{S(void 0!==this.processingPromise,"reentrancy?");const e=this.processDeltas();return S(void 0!==this.processingPromise,"reentrancy?"),this.processingPromise=void 0,e})).catch((e=>(this.error=e,this.processingPromise=void 0,this.emit("error",e),{count:0,duration:0}))),S(void 0!==this.processingPromise,"processDeltas() should run async"))}anythingToProcess(){return 0!==this.q.length&&!this.paused&&void 0===this.error}processDeltas(){const e=b.now();let t=0;for(;this.anythingToProcess();){const e=this.q.shift();t++,this.worker(e),this.emit("op",e)}const n=b.now()-e;return 0===this.q.length&&this.emit("idle",t,n),{count:t,duration:n}}}class he extends oe{constructor(e,t,n,r){super(),this.serviceProvider=e,this.logger=t,this._active=n,this.pending=[],this.minSequenceNumber=0,this.lastQueuedSequenceNumber=0,this.lastObservedSeqNumber=0,this.lastProcessedSequenceNumber=0,this.baseTerm=0,this.opsSize=0,this.initSequenceNumber=0,this.closed=!1,this.throttlingIdSet=new Set,this.timeTillThrottling=0,this.closeAbortController=new(se()),this.deltaStorageDelayId=(0,a.Z)(),this.deltaStreamDelayId=(0,a.Z)(),this.messageBuffer=[];const i={incomingOpHandler:(e,t)=>{try{this.enqueueMessages(e,t)}catch(e){this.logger.sendErrorEvent({eventName:"EnqueueMessages_Exception"},e),this.close((0,ee.SC)(e))}},signalHandler:e=>this._inboundSignal.push(e),reconnectionDelayHandler:(e,t)=>this.emitDelayInfo(this.deltaStreamDelayId,e,t),closeHandler:e=>this.close(e),disconnectHandler:e=>this.disconnectHandler(e),connectHandler:e=>this.connectHandler(e),pongHandler:e=>this.emit("pong",e),readonlyChangeHandler:e=>(0,Y.Eb)(this,this.logger,"readonly",e)};this.connectionManager=r(i),this._inbound=new ue((e=>{this.processInboundMessage(e)})),this._inbound.on("error",(e=>{this.close(E.Hi.wrapIfUnrecognized(e,"deltaManagerInboundErrorHandler",this.lastMessage))})),this._inboundSignal=new ue((e=>{if(void 0===this.handler)throw new Error("Attempted to process an inbound signal without a handler attached");this.handler.processSignal({clientId:e.clientId,content:JSON.parse(e.content)})})),this._inboundSignal.on("error",(e=>{this.close((0,ee.SC)(e))}))}get active(){return this._active()}get disposed(){return this.closed}get IDeltaSender(){return this}get inbound(){return this._inbound}get inboundSignal(){return this._inboundSignal}get initialSequenceNumber(){return this.initSequenceNumber}get lastSequenceNumber(){return this.lastProcessedSequenceNumber}get lastMessage(){return this.lastProcessedMessage}get lastKnownSeqNumber(){return this.lastObservedSeqNumber}get referenceTerm(){return this.baseTerm}get minimumSequenceNumber(){return this.minSequenceNumber}get hasCheckpointSequenceNumber(){return S(this.connectionManager.connected,223),void 0!==this._checkpointSequenceNumber}get maxMessageSize(){return this.connectionManager.maxMessageSize}get version(){return this.connectionManager.version}get serviceConfiguration(){return this.connectionManager.serviceConfiguration}get outbound(){return this.connectionManager.outbound}get readOnlyInfo(){return this.connectionManager.readOnlyInfo}get clientDetails(){return this.connectionManager.clientDetails}submit(e,t,n=!1,r){const i={contents:JSON.stringify(t),metadata:r,referenceSequenceNumber:this.lastProcessedSequenceNumber,type:e};n||this.flush();const s=this.connectionManager.prepareMessageToSend(i);return void 0===s?-1:(this.opsSize+=s.contents.length,this.messageBuffer.push(s),this.emit("submitOp",s),n||this.flush(),s.clientSequenceNumber)}submitSignal(e){return this.connectionManager.submitSignal(e)}flush(){0!==this.messageBuffer.length&&(this.emit("prepareSend",this.messageBuffer),this.connectionManager.sendMessages(this.messageBuffer),this.messageBuffer=[])}get connectionProps(){return Object.assign({sequenceNumber:this.lastSequenceNumber,opsSize:this.opsSize>0?this.opsSize:void 0},this.connectionManager.connectionProps)}logConnectionIssue(e){var t;S(this.connectionManager.connected,568);const n=this.pending.sort(((e,t)=>e.sequenceNumber-t.sequenceNumber));this.logger.sendErrorEvent(Object.assign(Object.assign(Object.assign(Object.assign({},e),{fetchReason:this.fetchReason,lastQueuedSequenceNumber:this.lastQueuedSequenceNumber,lastProcessedSequenceNumber:this.lastProcessedSequenceNumber,lastObserved:this.lastObservedSeqNumber}),this.connectionManager.connectionVerboseProps),{pendingOps:this.pending.length,pendingFirst:null===(t=n[0])||void 0===t?void 0:t.sequenceNumber,haveHandler:void 0!==this.handler,inboundLength:this.inbound.length,inboundPaused:this.inbound.paused}))}connectHandler(e){this.refreshDelayInfo(this.deltaStreamDelayId);const t=this.connectionManager.connectionVerboseProps;t.connectionLastQueuedSequenceNumber=this.lastQueuedSequenceNumber,t.connectionLastObservedSeqNumber=this.lastObservedSeqNumber;const n=e.checkpointSequenceNumber;this._checkpointSequenceNumber=n,void 0!==n&&this.updateLatestKnownOpSeqNumber(n),S(0===this.messageBuffer.length,233),this.opsSize=0,this.emit("connect",e,void 0!==n?this.lastObservedSeqNumber-this.lastSequenceNumber:void 0),void 0!==n?n>this.lastQueuedSequenceNumber&&this.fetchMissingDeltas("AfterConnection"):"read"===e.mode&&this.fetchMissingDeltas("AfterReadConnection")}dispose(){throw new Error("Not implemented.")}async attachOpHandler(e,t,n,r,i="none"){if(this.initSequenceNumber=t,this.lastProcessedSequenceNumber=t,this.baseTerm=n,this.minSequenceNumber=e,this.lastQueuedSequenceNumber=t,this.lastObservedSeqNumber=t,S(void 0===this.handler,226),this.handler=r,S(!!this.handler,227),S(void 0===this.fetchReason,616),!this.closed){if(this._inbound.resume(),this._inboundSignal.resume(),"none"!==i){const e="cached"===i;await this.fetchMissingDeltasCore(`DocumentOpen_${i}`,e),e&&this.fetchMissingDeltas("PostDocumentOpen")}S(void 0!==this.fetchReason||0===this.pending.length,617)}}connect(e){var t;const n=null===(t=e.fetchOpsFromStorage)||void 0===t||t;(0,ae.M)(void 0!==this.handler||!n,this.logger,"CantFetchWithoutBaseline"),n&&this.fetchMissingDeltas(e.reason),this.connectionManager.connect(e.mode)}async getDeltas(e,t,n,r,i){const s=this.serviceProvider();if(void 0===s)throw new Error("Delta manager is not attached");let o;if(void 0===this.deltaStorage&&(this.deltaStorage=await s.connectToDeltaStorage()),void 0!==t){const r=t-1;if(this.lastQueuedSequenceNumber>=r)return void this.logger.sendPerformanceEvent(Object.assign({reason:n,eventName:"ExtraStorageCall",early:!0,from:e,to:t},this.connectionManager.connectionVerboseProps));o=e=>e.sequenceNumber>=r}else o=e=>e.sequenceNumber>=this.lastObservedSeqNumber;const a=new(se());let c=!1;const l=e=>{S(e.sequenceNumber===this.lastQueuedSequenceNumber,570),!c&&o(e)&&(a.abort(),this._inbound.off("push",l))};try{this._inbound.on("push",l),S(null===this.closeAbortController.signal.onabort,488),this.closeAbortController.signal.onabort=()=>a.abort();const s=this.deltaStorage.fetchMessages(e,t,a.signal,i,n);for(;;){const e=await s.read();if(e.done)break;try{c=!0,r(e.value)}finally{c=!1}}}finally{this.closeAbortController.signal.onabort=null,this._inbound.off("push",l),S(!c,649)}}close(e){this.closed||(this.closed=!0,this.connectionManager.dispose(e),this.closeAbortController.abort(),this._inbound.clear(),this._inboundSignal.clear(),this._inbound.pause(),this._inboundSignal.pause(),this.pending=[],this.emit("closed",e),this.removeAllListeners())}refreshDelayInfo(e){this.throttlingIdSet.delete(e),0===this.throttlingIdSet.size&&(this.timeTillThrottling=0)}disconnectHandler(e){this.messageBuffer.length=0,this.emit("disconnect",e)}emitDelayInfo(e,t,n){const r=Date.now();if(this.throttlingIdSet.add(e),t>0&&r+t>this.timeTillThrottling){this.timeTillThrottling=r+t;const e=E.FQ.wrap(n,t/1e3,this.logger);this.emit("throttled",e)}}comparableMessagePayload(e){return`${e.clientId}-${e.type}-${e.minimumSequenceNumber}-${e.referenceSequenceNumber}-${e.timestamp}`}enqueueMessages(e,t,n=!1){var r,i;if(void 0===this.handler)return void(this.pending=this.pending.concat(e));if(S(0===this.pending.length||void 0!==this.fetchReason,489),0===e.length)return;const s=e[0].sequenceNumber,o=e[e.length-1].sequenceNumber;if(o>this.lastQueuedSequenceNumber){let r=s-1;const i=r-this.lastQueuedSequenceNumber;let a,c,l=0,u=0;for(const t of e)t.sequenceNumber===r?l++:t.sequenceNumber!==r+1&&(u++,void 0===a&&(a=r+1)),r=t.sequenceNumber;0!==l||0!==u&&!n||i>0&&void 0===this.fetchReason?c="enqueueMessages":void 0!==this.fetchReason&&this.fetchReason!==t&&s<=this.lastQueuedSequenceNumber+1&&o>this.lastQueuedSequenceNumber&&(c="enqueueMessagesExtraFetch"),void 0!==c&&this.logger.sendPerformanceEvent(Object.assign({eventName:c,reason:t,previousReason:this.prevEnqueueMessagesReason,from:s,to:o+1,length:e.length,fetchReason:this.fetchReason,duplicate:l>0?l:void 0,initialGap:0!==i?i:void 0,gap:u>0?u:void 0,firstMissing:a,dmInitialSeqNumber:this.initialSequenceNumber},this.connectionManager.connectionVerboseProps))}this.updateLatestKnownOpSeqNumber(e[e.length-1].sequenceNumber);const a=null===(r=this.previouslyProcessedMessage)||void 0===r?void 0:r.sequenceNumber;S(void 0===a||a===this.lastQueuedSequenceNumber,236);for(const n of e)if(n.sequenceNumber<=this.lastQueuedSequenceNumber){if((null===(i=this.previouslyProcessedMessage)||void 0===i?void 0:i.sequenceNumber)===n.sequenceNumber){const e=this.comparableMessagePayload(this.previouslyProcessedMessage),t=this.comparableMessagePayload(n);if(e!==t){const r=new O.V2("Found two messages with the same sequenceNumber but different payloads. Likely to be a service issue",N.C.fileOverwrittenInStorage,{clientId:this.connectionManager.clientId,sequenceNumber:n.sequenceNumber,message1:e,message2:t,driverVersion:void 0});this.close(r)}}}else n.sequenceNumber!==this.lastQueuedSequenceNumber+1?(this.pending.push(n),this.fetchMissingDeltas(t,n.sequenceNumber)):(this.lastQueuedSequenceNumber=n.sequenceNumber,this.previouslyProcessedMessage=n,this._inbound.push(n));this.prevEnqueueMessagesReason=this.pending.length>0?"unknown":t}processInboundMessage(e){const t=Date.now();if(this.lastProcessedMessage=e,S(void 0!==e.clientId||!(0,L.ag)(e),237),"string"==typeof e.contents&&""!==e.contents&&e.type!==q.ClientLeave&&(e.contents=JSON.parse(e.contents)),this.connectionManager.beforeProcessingIncomingOp(e),this.minSequenceNumber>e.minimumSequenceNumber)throw new E.Jd("Found a lower minimumSequenceNumber (msn) than previously recorded",Object.assign(Object.assign({},(0,E.HN)(e)),{clientId:this.connectionManager.clientId}));if(this.minSequenceNumber=e.minimumSequenceNumber,e.sequenceNumber!==this.lastProcessedSequenceNumber+1)throw new E.Jd("Found a non-Sequential sequenceNumber",Object.assign(Object.assign({},(0,E.HN)(e)),{clientId:this.connectionManager.clientId}));if(this.lastProcessedSequenceNumber=e.sequenceNumber,S(this.lastProcessedSequenceNumber<=this.lastObservedSeqNumber,615),void 0===e.term&&(e.term=1),this.baseTerm=e.term,void 0===this.handler)throw new Error("Attempted to process an inbound message without a handler attached");this.handler.process(e);const n=Date.now();this.emit("op",e,n-t)}fetchMissingDeltas(e,t){this.fetchMissingDeltasCore(e,!1,t).catch((e=>{this.logger.sendErrorEvent({eventName:"fetchMissingDeltasException"},e)}))}async fetchMissingDeltasCore(e,t,n){var r;if(void 0===this.fetchReason)if(this.closed)this.logger.sendTelemetryEvent({eventName:"fetchMissingDeltasClosedConnection",reason:e});else if(void 0!==this.handler)try{let i=this.lastQueuedSequenceNumber+1;const s=null===(r=this.previouslyProcessedMessage)||void 0===r?void 0:r.sequenceNumber;void 0!==s&&(S(s===this.lastQueuedSequenceNumber,242),S(i>1,243),i--);const o=`${e}_fetch`;this.fetchReason=o,await this.getDeltas(i,n,o,(e=>{this.refreshDelayInfo(this.deltaStorageDelayId),this.enqueueMessages(e,o)}),t)}catch(e){this.logger.sendErrorEvent({eventName:"GetDeltas_Exception"},e),this.close((0,ee.SC)(e))}finally{this.refreshDelayInfo(this.deltaStorageDelayId),this.fetchReason=void 0,this.processPendingOps(e)}else S(0===this.lastQueuedSequenceNumber,619)}processPendingOps(e){if(this.closed)return;S(void 0!==this.handler,620);const t=this.pending.sort(((e,t)=>e.sequenceNumber-t.sequenceNumber));this.pending=[],this.enqueueMessages(t,`${e}_pending`,!0),void 0===this.fetchReason&&this.lastQueuedSequenceNumber<this.lastObservedSeqNumber&&this.fetchMissingDeltas("OpsBehind")}updateLatestKnownOpSeqNumber(e){this.lastObservedSeqNumber<e&&(this.lastObservedSeqNumber=e)}}class de extends oe{constructor(e){if(super(),this.isDisposed=!1,this.forwardingEvents=new Map,void 0!==e){const t=t=>this.unforwardEvent(e,t),n=t=>this.forwardEvent(e,t);this.on(de.removeListenerEvent,t),this.on(de.newListenerEvent,n)}}static isEmitterEvent(e){return e===de.newListenerEvent||e===de.removeListenerEvent}get disposed(){return this.isDisposed}dispose(){this.isDisposed=!0;for(const e of this.forwardingEvents.values())for(const t of e.values())try{t()}catch(e){}this.removeAllListeners(),this.forwardingEvents.clear()}forwardEvent(e,...t){for(const n of t)if(void 0!==e&&void 0!==n&&!de.isEmitterEvent(n)){let t=this.forwardingEvents.get(n);if(void 0===t&&(t=new Map,this.forwardingEvents.set(n,t)),!t.has(e)){const r=(...e)=>this.emit(n,...e);t.set(e,(()=>e.off(n,r))),e.on(n,r)}}}unforwardEvent(e,...t){for(const n of t)if(void 0!==n&&!de.isEmitterEvent(n)){const t=this.forwardingEvents.get(n);if((null==t?void 0:t.has(e))&&0===this.listenerCount(n)){const r=t.get(e);void 0!==r&&r(),t.delete(e),0===t.size&&this.forwardingEvents.delete(n)}}}}de.newListenerEvent="newListener",de.removeListenerEvent="removeListener";class pe extends de{constructor(e){super(e),this.queue=e}get paused(){return this.queue.paused}get length(){return this.queue.length}get idle(){return this.queue.idle}peek(){return this.queue.peek()}toArray(){return this.queue.toArray()}async systemPause(){return this.pause()}async pause(){return this.queue.pause()}async systemResume(){return this.resume()}async resume(){this.queue.resume()}async waitTillProcessingDone(){return this.queue.waitTillProcessingDone()}}class fe extends de{constructor(e){super(e),this.deltaManager=e,this.inbound=new pe(e.inbound),this.outbound=new pe(e.outbound),this.inboundSignal=new pe(e.inboundSignal)}get IDeltaSender(){return this}get minimumSequenceNumber(){return this.deltaManager.minimumSequenceNumber}get lastSequenceNumber(){return this.deltaManager.lastSequenceNumber}get lastMessage(){return this.deltaManager.lastMessage}get lastKnownSeqNumber(){return this.deltaManager.lastKnownSeqNumber}get initialSequenceNumber(){return this.deltaManager.initialSequenceNumber}get hasCheckpointSequenceNumber(){return this.deltaManager.hasCheckpointSequenceNumber}get clientDetails(){return this.deltaManager.clientDetails}get version(){return this.deltaManager.version}get maxMessageSize(){return this.deltaManager.maxMessageSize}get serviceConfiguration(){return this.deltaManager.serviceConfiguration}get active(){return this.deltaManager.active}get readOnlyInfo(){return this.deltaManager.readOnlyInfo}dispose(){this.inbound.dispose(),this.outbound.dispose(),this.inboundSignal.dispose(),super.dispose()}submitSignal(e){return this.deltaManager.submitSignal(e)}flush(){return this.deltaManager.flush()}}const ge="1.3.7";class me{constructor(e,t,n=(()=>Date.now())){this.defaultTimeout=e,this.defaultHandler=t,this.getCurrentTick=n}get hasTimer(){return!!this.runningState}start(e=this.defaultTimeout,t=this.defaultHandler){this.startCore(e,t,e)}clear(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}restart(e,t){var n,r;if(this.runningState){const i=null!=e?e:this.runningState.intendedDuration,s=null!==(r=null!=t?t:null===(n=this.runningState.restart)||void 0===n?void 0:n.handler)&&void 0!==r?r:this.runningState.handler,o=this.calculateRemainingTime(this.runningState);i<o?this.start(i,s):i===o?(this.runningState.handler=s,this.runningState.restart=void 0,this.runningState.intendedDuration=i):this.runningState.restart={startTick:this.getCurrentTick(),duration:i,handler:s}}else this.start(e,t)}startCore(e,t,n){this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:e,intendedDuration:n,handler:t,timeout:setTimeout((()=>this.handler()),e)}}handler(){S(!!this.runningState,10);const e=this.runningState.restart;if(void 0!==e){const t=this.calculateRemainingTime(e);this.startCore(t,(()=>e.handler()),e.duration)}else{const e=this.runningState.handler;this.clear(),e()}}calculateRemainingTime(e){const t=this.getCurrentTick()-e.startTick;return e.duration-t}}var ye=n(1434);class ve{constructor(e,t,n){var r;this.handler=e,this.logger=t,this._clientId=n,this._connectionState=ye.e.Disconnected,this.prevClientLeftTimer=new me(null!==(r=this.handler.maxClientLeaveWaitTime)&&void 0!==r?r:3e5,(()=>{S(!this.connected,684),this.applyForConnectedState("timeout")})),this.joinOpTimer=new me(45e3,(()=>{var e;if(this.connectionState!==ye.e.CatchingUp)return;const t=this.handler.quorumClients(),n={quorumInitialized:void 0!==t,hasPendingClientId:void 0!==this.pendingClientId,inQuorum:void 0!==(null==t?void 0:t.getMember(null!==(e=this.pendingClientId)&&void 0!==e?e:"")),waitingForLeaveOp:this.waitingForLeaveOp};this.handler.logConnectionIssue("NoJoinOp",n)}))}get connectionState(){return this._connectionState}get connected(){return this.connectionState===ye.e.Connected}get clientId(){return this._clientId}get pendingClientId(){return this._pendingClientId}startJoinOpTimer(){S(!this.joinOpTimer.hasTimer,564),this.joinOpTimer.start()}stopJoinOpTimer(){S(this.joinOpTimer.hasTimer,565),this.joinOpTimer.clear()}get waitingForLeaveOp(){return this.prevClientLeftTimer.hasTimer}dispose(){S(!this.joinOpTimer.hasTimer,677),this.prevClientLeftTimer.clear()}containerSaved(){this.waitingForLeaveOp&&(this.prevClientLeftTimer.clear(),this.applyForConnectedState("containerSaved"))}receivedAddMemberEvent(e){e===this.pendingClientId&&(this.joinOpTimer.hasTimer?this.stopJoinOpTimer():this.handler.logConnectionIssue("ReceivedJoinOp"),this.waitingForLeaveOp&&(this.waitEvent=h.Xr.start(this.logger,{eventName:"WaitBeforeClientLeave",details:JSON.stringify({waitOnClientId:this._clientId,hadOutstandingOps:this.handler.shouldClientJoinWrite()})})),this.applyForConnectedState("addMemberEvent"))}applyForConnectedState(e){var t,n;const r=this.handler.quorumClients();S(void 0!==r,566),S(!1===this.waitingForLeaveOp||void 0!==this.clientId&&void 0!==r.getMember(this.clientId),738),this.pendingClientId===this.clientId||void 0===this.pendingClientId||void 0===r.getMember(this.pendingClientId)||this.waitingForLeaveOp?this.logger.sendTelemetryEvent({eventName:"connectedStateRejected",category:"timeout"===e?"error":"generic",details:JSON.stringify({source:e,pendingClientId:this.pendingClientId,clientId:this.clientId,waitingForLeaveOp:this.waitingForLeaveOp,inQuorum:void 0!==(null==r?void 0:r.getMember(null!==(n=this.pendingClientId)&&void 0!==n?n:""))})}):(null===(t=this.waitEvent)||void 0===t||t.end({source:e}),this.setConnectionState(ye.e.Connected))}receivedRemoveMemberEvent(e){this.clientId===e&&(this.prevClientLeftTimer.clear(),this.applyForConnectedState("removeMemberEvent"))}receivedDisconnectEvent(e){this.joinOpTimer.hasTimer&&this.stopJoinOpTimer(),this.setConnectionState(ye.e.Disconnected,e)}receivedConnectEvent(e,t){const n=this._connectionState;this._connectionState=ye.e.CatchingUp;const r="write"===e;S(r||!this.handler.shouldClientJoinWrite(),778),S(r||!this.waitingForLeaveOp,678);const i=this.handler.quorumClients();this._pendingClientId=t.clientId,this.handler.logConnectionStateChangeTelemetry(ye.e.CatchingUp,n),r&&void 0===(null==i?void 0:i.getMember(this._pendingClientId))?this.startJoinOpTimer():this.waitingForLeaveOp||this.setConnectionState(ye.e.Connected)}setConnectionState(e,t){if(this.connectionState===e)return void this.logger.sendErrorEvent({eventName:"setConnectionStateSame",value:e});const n=this._connectionState;this._connectionState=e;const r=this.handler.quorumClients();let i;void 0!==this._clientId&&(i=null==r?void 0:r.getMember(this._clientId)),e===ye.e.Connected?(S(n===ye.e.CatchingUp,472),void 0!==i&&(i.shouldHaveLeft=!0),this._clientId=this.pendingClientId):e===ye.e.Disconnected&&(this._pendingClientId=void 0,void 0!==i&&this.handler.shouldClientJoinWrite()&&!1===this.prevClientLeftTimer.hasTimer?this.prevClientLeftTimer.restart():this.logger.sendTelemetryEvent({eventName:"noWaitOnDisconnected",details:JSON.stringify({inQuorum:void 0!==i,waitingForLeaveOp:this.waitingForLeaveOp,hadOutstandingOps:this.handler.shouldClientJoinWrite()})})),this.handler.logConnectionStateChangeTelemetry(this._connectionState,n,t),this.handler.connectionStateChanged()}initProtocol(e){e.quorum.on("addMember",((e,t)=>{this.receivedAddMemberEvent(e)})),e.quorum.on("removeMember",(e=>{this.receivedRemoveMemberEvent(e)})),void 0!==this.clientId&&void 0!==e.quorum.getMember(this.clientId)&&this.prevClientLeftTimer.restart()}}class be{constructor(e,t){this.internalStorageService=e,this.logger=t,this._disposed=!1}get policies(){return this.internalStorageService.policies}get disposed(){return this._disposed}dispose(){this._disposed=!0}get repositoryUrl(){return this.internalStorageService.repositoryUrl}async getSnapshotTree(e,t){return this.runWithRetry((async()=>this.internalStorageService.getSnapshotTree(e,t)),"storage_getSnapshotTree")}async readBlob(e){return this.runWithRetry((async()=>this.internalStorageService.readBlob(e)),"storage_readBlob")}async getVersions(e,t,n){return this.runWithRetry((async()=>this.internalStorageService.getVersions(e,t,n)),"storage_getVersions")}async uploadSummaryWithContext(e,t){return S(0===t.referenceSequenceNumber==(void 0===t.ackHandle),593),0!==t.referenceSequenceNumber?this.internalStorageService.uploadSummaryWithContext(e,t):this.runWithRetry((async()=>this.internalStorageService.uploadSummaryWithContext(e,t)),"storage_uploadSummaryWithContext")}async downloadSummary(e){return this.runWithRetry((async()=>this.internalStorageService.downloadSummary(e)),"storage_downloadSummary")}async createBlob(e){return this.runWithRetry((async()=>this.internalStorageService.createBlob(e)),"storage_createBlob")}checkStorageDisposed(){if(this._disposed)throw new E.pY("Storage Service is disposed. Cannot retry",{canRetry:!1})}async runWithRetry(e,t){return R(e,t,this.logger,{onRetry:()=>this.checkStorageDisposed()})}}class Se{constructor(e,t){this.internalStorageService=e,this.generateProtocolTree=t,this.getSnapshotTree=this.internalStorageService.getSnapshotTree.bind(this.internalStorageService),this.getVersions=this.internalStorageService.getVersions.bind(this.internalStorageService),this.createBlob=this.internalStorageService.createBlob.bind(this.internalStorageService),this.readBlob=this.internalStorageService.readBlob.bind(this.internalStorageService),this.downloadSummary=this.internalStorageService.downloadSummary.bind(this.internalStorageService),this.dispose=this.internalStorageService.dispose.bind(this.internalStorageService)}get policies(){return this.internalStorageService.policies}get repositoryUrl(){return this.internalStorageService.repositoryUrl}get disposed(){return this.internalStorageService.disposed}async uploadSummaryWithContext(e,t){return this.internalStorageService.uploadSummaryWithContext(T(e,this.generateProtocolTree()),t)}}class we{constructor(e){this.storageGetter=e,this.blobContents={}}loadSnapshotForRehydratingContainer(e){this.getBlobContents(e)}getBlobContents(e){for(const[t,n]of Object.entries(e.blobsContents))this.blobContents[t]=n;for(const[t,n]of Object.entries(e.trees))this.getBlobContents(n)}get policies(){try{return this.storageGetter().policies}catch(e){}}get repositoryUrl(){return this.storageGetter().repositoryUrl}async getSnapshotTree(e,t){return this.storageGetter().getSnapshotTree(e,t)}async readBlob(e){const t=this.blobContents[e];return void 0!==t?t:this.storageGetter().readBlob(e)}async getVersions(e,t,n){return this.storageGetter().getVersions(e,t,n)}async uploadSummaryWithContext(e,t){return this.storageGetter().uploadSummaryWithContext(e,t)}async downloadSummary(e){return this.storageGetter().downloadSummary(e)}async createBlob(e){return this.storageGetter().createBlob(e)}}class xe{constructor(e,t){this.blobStorage=e,this.logger=t,this.getSnapshotTree=this.notCalled,this.getVersions=this.notCalled,this.write=this.notCalled,this.uploadSummaryWithContext=this.notCalled,this.downloadSummary=this.notCalled}async createBlob(e){return this.blobStorage.createBlob(e)}async readBlob(e){return this.blobStorage.readBlob(e)}get policies(){return this.notCalled()}get repositoryUrl(){return this.notCalled()}notCalled(){try{throw new Error("BlobOnlyStorage not implemented method used")}catch(e){throw this.logger.sendErrorEvent({eventName:"BlobOnlyStorageWrongCall"},e),e}}}var Ce=n(9742);const Ee=(e,t)=>Ae.from(e,t).buffer;function Te(e){const t=e;return e instanceof ArrayBuffer||"object"==typeof t&&null!==t&&"number"==typeof t.byteLength&&"function"==typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}class Ae extends Uint8Array{toString(e){return function(e,t){switch(t){case"base64":return Ce.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}(this,e)}static from(e,t,n){if("string"==typeof e)return Ae.fromString(e,t);if(null!==e&&"object"==typeof e&&Te(e.buffer))return S(0===e.byteOffset,0),S(e.byteLength===e.buffer.byteLength,1),Ae.fromArrayBuffer(e.buffer,t,n);if(Te(e))return Ae.fromArrayBuffer(e,t,n);throw new TypeError}static fromArrayBuffer(e,t,n){const r=null!=t?t:0,i=null!=n?n:e.byteLength-r;if(r<0||r>e.byteLength||i<0||i+r>e.byteLength)throw new RangeError;return new Ae(e,r,i)}static fromString(e,t){switch(t){case"base64":{const t=this.sanitizeBase64(e),n=Ce.toByteArray(t);return new Ae(n.buffer)}case"utf8":case"utf-8":case void 0:{const t=(new TextEncoder).encode(e);return new Ae(t.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!=0&&(t+=["","===","==","="][t.length%4]),t}}function ke(e){var t;const n=(0,g.Qc)(e,!0);if("string"!=typeof n.pathname)throw new ee.j4("Failed to parse pathname");const r=null!==(t=n.search)&&void 0!==t?t:"",i=/^\/([^/]*\/[^/]*)(\/?.*)$/.exec(n.pathname);return 3===(null==i?void 0:i.length)?{id:i[1],path:i[2],query:r,version:n.query.version}:void 0}function Ne(e){const t={blobs:{},blobsContents:{},trees:{},id:(0,a.Z)(),unreferenced:e.unreferenced},n=Object.keys(e.tree);for(const i of n){const n=e.tree[i];switch(n.type){case _.Tree:t.trees[i]=Ne(n);break;case _.Attachment:t.blobs[i]=n.id;break;case _.Blob:{const e=(0,a.Z)();t.blobs[i]=e;const s="string"==typeof n.content?Ee(n.content,"utf8"):0===(r=n.content).byteOffset&&r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);t.blobsContents[e]=s;break}case _.Handle:throw new ee.j4("No handles should be there in summary in detached container!!");default:w(0,`Unknown tree type ${n.type}`)}}var r;return t}function Oe(e,t){const n={type:_.Tree,tree:Object.assign({},t.tree)};return n.tree[".protocol"]=e,Ne(n)}const Pe=e=>{const t=e.tree[".protocol"],n=e.tree[".app"];return S(void 0!==t&&void 0!==n,480),Oe(t,n)};function Re(e){return".protocol"in e.trees?e.trees[".protocol"]:e}function Ie(e,t){return(...n)=>{if(e.disposed)throw new Error("Already disposed");return t(...n)}}class Fe extends de{constructor(e){super(e),super.setMaxListeners(50),this.propose=Ie(this,e.propose.bind(e)),this.has=Ie(this,e.has.bind(e)),this.get=Ie(this,e.get.bind(e)),this.getMembers=Ie(this,e.getMembers.bind(e)),this.getMember=Ie(this,e.getMember.bind(e))}}function De(e){return[["code",{key:"code",value:e,approvalSequenceNumber:0,commitSequenceNumber:0,sequenceNumber:0}]]}class Me{constructor(e,t=2e3,n=50){this.submit=e,this.NoopCountFrequency=n,this.opsCountSinceNoop=0,t!==1/0&&(this.timer=new me(t,(()=>{0!==this.opsCountSinceNoop&&this.submitNoop(!1)})))}scheduleSequenceNumberUpdate(e,t){t?this.submitNoop(!0):(0,L.LW)(e)&&(this.opsCountSinceNoop++,this.opsCountSinceNoop>=this.NoopCountFrequency?this.submitNoop(!1):void 0!==this.timer&&(1===this.opsCountSinceNoop&&this.timer.restart(),S(this.timer.hasTimer,578)))}submitNoop(e){this.submit(q.NoOp,e?"":null),S(0===this.opsCountSinceNoop,579)}stopSequenceNumberUpdate(){this.opsCountSinceNoop=0}}function Le(e,t,n){var r,i;const s=Object.assign({},t),o=n.online;if(s.online="string"==typeof o?o:O.Yz[(0,O.Gg)()],"object"==typeof navigator&&null!==navigator){const e=navigator,t=null!==(i=null!==(r=e.connection)&&void 0!==r?r:e.mozConnection)&&void 0!==i?i:e.webkitConnection;null!==t&&"object"==typeof t&&(s.connectionType=t.type)}s.category=(0,O.ms)(n)?"generic":"error",e.sendTelemetryEvent(s,n)}function _e(e){return new Promise((t=>{let n=t,r=e;(0,O.Gg)()===O.Yz.Offline&&void 0!==(null===window||void 0===window?void 0:window.addEventListener)&&(n=()=>{t(),window.removeEventListener("online",n)},window.addEventListener("online",n,!1),r=Math.max(e,3e4)),setTimeout(n,r)}))}var qe;!function(e){e.DocRead="doc:read",e.DocWrite="doc:write",e.SummaryWrite="summary:write"}(qe||(qe={}));const Be={fatalConnectError:!0};class je extends oe{constructor(){super(...arguments),this.clientId="storage-only client",this.claims={scopes:[qe.DocRead]},this.mode="read",this.existing=!0,this.maxMessageSize=0,this.version="",this.initialMessages=[],this.initialSignals=[],this.initialClients=[],this.serviceConfiguration={maxMessageSize:0,blockSize:0,summary:void 0},this.checkpointSequenceNumber=void 0,this._disposed=!1}submit(e){this.emit("nack",this.clientId,e.map((e=>({operation:e,content:{message:"Cannot submit with storage-only connection",code:403}}))))}submitSignal(e){this.emit("nack",this.clientId,{operation:e,content:{message:"Cannot submit signal with storage-only connection",code:403}})}get disposed(){return this._disposed}dispose(){this._disposed=!0}}class ze{constructor(e,t,n,r,i){this.serviceProvider=e,this.client=t,this.logger=r,this.props=i,this._forceReadonly=!1,this.pendingReconnect=!1,this.clientSequenceNumber=0,this.clientSequenceNumberObserved=0,this.trailingNoopCount=0,this.connectFirstConnection=!0,this._connectionVerboseProps={},this._connectionProps={},this.closed=!1,this.opHandler=(e,t)=>{const n=Array.isArray(t)?t:[t];this.props.incomingOpHandler(n,"opHandler")},this.nackHandler=(e,t)=>{const n=t[0];if(!0===this._readonlyPermissions)return void this.props.closeHandler((0,O.j)("writeOnReadOnlyDocument",{driverVersion:void 0}));const r=function(e){const t=`Nack (${e.type}): ${e.message}`,n=403!==e.code,r=void 0!==e.retryAfter?1e3*e.retryAfter:void 0;return(0,O.jx)(t,{canRetry:n,retryAfterMs:r},{statusCode:e.code,driverVersion:void 0})}(n.content);r.canRetry?this.reconnectOnError("write",r):this.props.closeHandler(r)},this.disconnectHandlerInternal=e=>{this.reconnectOnError(this.defaultReconnectionMode,e)},this.errorHandler=e=>{this.reconnectOnError(this.defaultReconnectionMode,e)},this.clientDetails=this.client.details,this.defaultReconnectionMode=this.client.mode,this._reconnectMode=n?X.Enabled:X.Never,this._outbound=new ue((e=>{if(void 0===this.connection)throw new Error("Attempted to submit an outbound message without connection");this.connection.submit(e)})),this._outbound.on("error",(e=>{this.props.closeHandler((0,ee.SC)(e))}))}get connectionVerboseProps(){return this._connectionVerboseProps}get connectionMode(){var e,t;return null!==(t=null===(e=this.connection)||void 0===e?void 0:e.mode)&&void 0!==t?t:"read"}get connected(){return void 0!==this.connection}get clientId(){var e;return null===(e=this.connection)||void 0===e?void 0:e.clientId}get reconnectMode(){return this._reconnectMode}get maxMessageSize(){var e,t,n;return null!==(n=null===(t=null===(e=this.connection)||void 0===e?void 0:e.serviceConfiguration)||void 0===t?void 0:t.maxMessageSize)&&void 0!==n?n:16384}get version(){if(void 0===this.connection)throw new Error("Cannot check version without a connection");return this.connection.version}get serviceConfiguration(){var e;return null===(e=this.connection)||void 0===e?void 0:e.serviceConfiguration}get scopes(){var e;return null===(e=this.connection)||void 0===e?void 0:e.claims.scopes}get outbound(){return this._outbound}get connectionProps(){return void 0!==this.connection?this._connectionProps:Object.assign(Object.assign({},this._connectionProps),{sentOps:this.clientSequenceNumber})}shouldJoinWrite(){return this.clientSequenceNumberObserved<this.clientSequenceNumber-this.trailingNoopCount}get readonly(){return!!this._forceReadonly||this._readonlyPermissions}get readOnlyInfo(){const e=void 0!==this.connection&&this.connection instanceof je;return e||this._forceReadonly||!0===this._readonlyPermissions?{readonly:!0,forced:this._forceReadonly,permissions:this._readonlyPermissions,storageOnly:e}:{readonly:this._readonlyPermissions}}static detailsFromConnection(e){return{claims:e.claims,clientId:e.clientId,existing:e.existing,checkpointSequenceNumber:e.checkpointSequenceNumber,get initialClients(){return e.initialClients},mode:e.mode,serviceConfiguration:e.serviceConfiguration,version:e.version}}dispose(e){if(this.closed)return;this.closed=!0,this.pendingConnection=void 0,this._reconnectMode=X.Never,this._outbound.clear();const t=void 0!==e?`Closing DeltaManager (${e.message})`:"Closing DeltaManager";this.disconnectFromDeltaStream(t),this.set_readonlyPermissions(!0)}setAutoReconnect(e){S(e!==X.Never&&this._reconnectMode!==X.Never,632),this._reconnectMode=e,e!==X.Enabled&&this.disconnectFromDeltaStream("setAutoReconnect")}forceReadonly(e){e!==this._forceReadonly&&this.logger.sendTelemetryEvent({eventName:"ForceReadOnly",value:e});const t=this.readonly;if(this._forceReadonly=e,t!==this.readonly){if(this._reconnectMode===X.Never)throw new E.Oi("API is not supported for non-connecting or closed container");let e=!1;!0===this.readonly&&(this.shouldJoinWrite()&&this.logger.sendErrorEvent({eventName:"ForceReadonlyPendingChanged"}),e=this.disconnectFromDeltaStream("Force readonly")),this.props.readonlyChangeHandler(this.readonly),e&&this.triggerConnect("read")}}set_readonlyPermissions(e){const t=this.readonly;this._readonlyPermissions=e,t!==this.readonly&&this.props.readonlyChangeHandler(this.readonly)}connect(e){this.connectCore(e).catch((e=>{const t=(0,ee.SC)(e,{props:Be});this.props.closeHandler(t)}))}async connectCore(e){var t,n;if(S(!this.closed,618),void 0!==this.connection)return;let r;void 0!==this.pendingConnection&&(r=this.pendingConnection.connectionMode,this.cancelConnection(),S(void 0===this.pendingConnection,836));let i=null!==(t=null!=e?e:r)&&void 0!==t?t:this.defaultReconnectionMode;this.shouldJoinWrite()&&(i="write");const s=this.serviceProvider();let o;if(S(void 0!==s,679),!0===(null===(n=s.policies)||void 0===n?void 0:n.storageOnly))return o=new je,this.setupNewSuccessfulConnection(o,"read"),void S(void 0===this.pendingConnection,691);let a=1e3,c=0;const l=b.now();let u;const d=new(se()),p=d.signal;for(this.pendingConnection={abort:()=>{d.abort()},connectionMode:i};void 0===o;){if(this.closed)throw new Error("Attempting to connect a closed DeltaManager");if(!0===p.aborted)return void this.logger.sendTelemetryEvent({eventName:"ConnectionAttemptCancelled",attempts:c,duration:h.hy.formatTick(b.now()-l),connectionEstablished:!1});c++;try{this.client.mode=i,o=await s.connectToDeltaStream(Object.assign(Object.assign({},this.client),{mode:i})),o.disposed&&(this.logger.sendTelemetryEvent({eventName:"ReceivedClosedConnection"}),o=void 0)}catch(e){if("object"==typeof e&&null!==e&&(null==e?void 0:e.errorType)===O.y7.errorType){o=new je,i="read";break}if(!(0,O.ms)(e)){const t=(0,ee.SC)(e,{props:Be});throw this.props.closeHandler(t),t}Le(this.logger,{attempts:c,delay:a,eventName:"DeltaConnectionFailureToConnect",duration:h.hy.formatTick(b.now()-l)},e),u=e;const t=(0,O.ZZ)(e);a=null!=t?t:Math.min(2*a,8e3),void 0!==t&&this.props.reconnectionDelayHandler(t,e),await _e(a)}}if(c>1&&Le(this.logger,{eventName:"MultipleDeltaConnectionFailures",attempts:c,duration:h.hy.formatTick(b.now()-l)},u),!0===p.aborted)return o.dispose(),void this.logger.sendTelemetryEvent({eventName:"ConnectionAttemptCancelled",attempts:c,duration:h.hy.formatTick(b.now()-l),connectionEstablished:!0});this.setupNewSuccessfulConnection(o,i)}triggerConnect(e){S(void 0===this.connection,569),this.reconnectMode===X.Enabled&&this.connect(e)}disconnectFromDeltaStream(e){if(this.pendingReconnect=!1,void 0===this.connection)return void 0!==this.pendingConnection&&(this.cancelConnection(),!0);S(void 0===this.pendingConnection,635);const t=this.connection;return this.connection=void 0,t.off("op",this.opHandler),t.off("signal",this.props.signalHandler),t.off("nack",this.nackHandler),t.off("disconnect",this.disconnectHandlerInternal),t.off("error",this.errorHandler),t.off("pong",this.props.pongHandler),this._outbound.pause(),this._outbound.clear(),this.props.disconnectHandler(e),t.dispose(),this._connectionVerboseProps={},!0}cancelConnection(){S(void 0!==this.pendingConnection,837),this.pendingConnection.abort(),this.pendingConnection=void 0,this.logger.sendTelemetryEvent({eventName:"ConnectionCancelReceived"})}setupNewSuccessfulConnection(e,t){S(void 0===this.connection,230),S(!e.disposed,650),this.pendingConnection=void 0,this.connection=e;const n=!e.claims.scopes.includes(qe.DocWrite);if(S("read"===t||n===("read"===this.connectionMode),231),S(!n||"read"===this.connectionMode,232),this.set_readonlyPermissions(n),this.closed)return void this.disconnectFromDeltaStream("ConnectionManager already closed");this._outbound.resume(),e.on("op",this.opHandler),e.on("signal",this.props.signalHandler),e.on("nack",this.nackHandler),e.on("disconnect",this.disconnectHandlerInternal),e.on("error",this.errorHandler),e.on("pong",this.props.pongHandler);const r=e.initialMessages.sort(((e,t)=>e.sequenceNumber-t.sequenceNumber));let i=e.checkpointSequenceNumber;this._connectionVerboseProps={clientId:e.clientId,mode:e.mode},this._connectionProps={},void 0!==e.relayServiceAgent&&(this._connectionVerboseProps.relayServiceAgent=e.relayServiceAgent,this._connectionProps.relayServiceAgent=e.relayServiceAgent),this._connectionProps.socketDocumentId=e.claims.documentId,this._connectionProps.connectionMode=e.mode;let s=-1;if(0!==r.length&&(this._connectionVerboseProps.connectionInitialOpsFrom=r[0].sequenceNumber,s=r[r.length-1].sequenceNumber,this._connectionVerboseProps.connectionInitialOpsTo=s+1,(void 0===i||i<s)&&(i=s)),this.props.incomingOpHandler(r,this.connectFirstConnection?"InitialOps":"ReconnectOps"),void 0!==e.initialSignals)for(const t of e.initialSignals)this.props.signalHandler(t);const o=ze.detailsFromConnection(e);o.checkpointSequenceNumber=i,this.props.connectHandler(o),this.connectFirstConnection=!1}reconnectOnError(e,t){this.reconnect(e,t.message,t).catch(this.props.closeHandler)}async reconnect(e,t,n){if(S(void 0!==this.connection,235),this.disconnectFromDeltaStream(t),void 0===n||n.canRetry||this.logger.sendTelemetryEvent({eventName:"reconnectingDespiteFatalError",reconnectMode:this.reconnectMode},n),this.reconnectMode===X.Never&&this.props.closeHandler(),this.closed||this.reconnectMode!==X.Enabled)return;const r=(0,O.ZZ)(n);void 0!==n&&void 0!==r&&(this.props.reconnectionDelayHandler(r,n),await _e(r)),this.triggerConnect(e)}prepareMessageToSend(e){var t,n;if(!0!==this.readonly)return S(!!this.connection,228),this.lastSubmittedClientId!==(null===(t=this.connection)||void 0===t?void 0:t.clientId)&&(this.lastSubmittedClientId=null===(n=this.connection)||void 0===n?void 0:n.clientId,this.clientSequenceNumber=0,this.clientSequenceNumberObserved=0),e.type===q.NoOp?this.trailingNoopCount++:this.trailingNoopCount=0,Object.assign(Object.assign({},e),{clientSequenceNumber:++this.clientSequenceNumber});{S(!0===this.readOnlyInfo.readonly,496);const e=new E.pY("deltaManagerReadonlySubmit",void 0,{readonly:this.readOnlyInfo.readonly,forcedReadonly:this.readOnlyInfo.forced,readonlyPermissions:this.readOnlyInfo.permissions,storageOnly:this.readOnlyInfo.storageOnly});this.props.closeHandler(e)}}submitSignal(e){void 0!==this.connection?this.connection.submitSignal(e):this.logger.sendErrorEvent({eventName:"submitSignalDisconnected"})}sendMessages(e){S(this.connected,692),"read"!==this.connectionMode?(S(!this.pendingReconnect,693),this._outbound.push(e)):this.pendingReconnect||(this.pendingReconnect=!0,Promise.resolve().then((async()=>{this.pendingReconnect&&await this.reconnect("write","Switch to write")})).catch((()=>{})))}beforeProcessingIncomingOp(e){if(S(this.clientId!==e.clientId||this.lastSubmittedClientId===e.clientId,238),void 0!==this.lastSubmittedClientId&&this.lastSubmittedClientId===e.clientId){const t=e.clientSequenceNumber;S(this.clientSequenceNumberObserved<t,239),S(t<=this.clientSequenceNumber,240),this.clientSequenceNumberObserved=t}if(e.type===q.ClientLeave){const t=e;JSON.parse(t.data)===this.clientId&&(this.logger.sendPerformanceEvent({eventName:"ReadConnectionTransition"}),this.reconnect("read","Switch to read").catch((e=>{this.logger.sendErrorEvent({eventName:"SwitchToReadConnection"},e)})))}}}const He="dirty",Ue="saved";async function Ve(e,t,n){const r=h.Xr.start(e,{eventName:t}),i=await n();r.duration>1e3&&r.end(i)}const Ge="summarizer";class We extends Z.M{constructor(e,t){var n,r;super(((e,t)=>{this.mc.logger.sendErrorEvent({eventName:"ContainerEventHandlerException",name:"string"==typeof e?e:void 0},t)})),this.loader=e,this._canReconnect=!0,this._lifecycleState="loading",this._attachState=o.mB.Detached,this.inboundQueuePausedFromInit=!0,this.firstConnection=!0,this.connectionTransitionTimes=[],this.messageCountAfterDisconnection=0,this.attachStarted=!1,this._dirtyContainer=!1,this.setAutoReconnectTime=b.now(),this._audience=new te,this.clientDetailsOverride=t.clientDetailsOverride,this._resolvedUrl=t.resolvedUrl,void 0!==t.canReconnect&&(this._canReconnect=t.canReconnect);const i=this.client.details.type,s=`${this.client.details.capabilities.interactive?"interactive":"noninteractive"}${void 0!==i&&""!==i?`/${i}`:""}`;this.subLogger=h.G2.create(e.services.subLogger,void 0,{all:{clientType:s,containerId:(0,a.Z)(),docId:()=>{var e,t;return null!==(t=null===(e=this._resolvedUrl)||void 0===e?void 0:e.id)&&void 0!==t?t:void 0},containerAttachState:()=>this._attachState,containerLifecycleState:()=>this._lifecycleState,containerConnectionState:()=>ye.e[this.connectionState],serializedContainer:void 0!==t.serializedContainerState},error:{dmInitialSeqNumber:()=>{var e;return null===(e=this._deltaManager)||void 0===e?void 0:e.initialSequenceNumber},dmLastProcessedSeqNumber:()=>{var e;return null===(e=this._deltaManager)||void 0===e?void 0:e.lastSequenceNumber},dmLastKnownSeqNumber:()=>{var e;return null===(e=this._deltaManager)||void 0===e?void 0:e.lastKnownSeqNumber},containerLoadedFromVersionId:()=>{var e;return null===(e=this.loadedFromVersion)||void 0===e?void 0:e.id},containerLoadedFromVersionDate:()=>{var e;return null===(e=this.loadedFromVersion)||void 0===e?void 0:e.date},dmLastMsqSeqNumber:()=>{var e,t;return null===(t=null===(e=this.deltaManager)||void 0===e?void 0:e.lastMessage)||void 0===t?void 0:t.sequenceNumber},dmLastMsqSeqTimestamp:()=>{var e,t;return null===(t=null===(e=this.deltaManager)||void 0===e?void 0:e.lastMessage)||void 0===t?void 0:t.timestamp},dmLastMsqSeqClientId:()=>{var e,t;return null===(t=null===(e=this.deltaManager)||void 0===e?void 0:e.lastMessage)||void 0===t?void 0:t.clientId},connectionStateDuration:()=>b.now()-this.connectionTransitionTimes[this.connectionState]}}),this.mc=(0,l.rZ)(h.G2.create(this.subLogger,"Container"));const c=null!==(n=this.mc.config.getBoolean("Fluid.Container.summarizeProtocolTree"))&&void 0!==n?n:this.loader.services.options.summarizeProtocolTree;this.options=Object.assign(Object.assign({},this.loader.services.options),{summarizeProtocolTree:c}),this.connectionStateHandler=new ve({quorumClients:()=>{var e;return null===(e=this._protocolHandler)||void 0===e?void 0:e.quorum},logConnectionStateChangeTelemetry:(e,t,n)=>this.logConnectionStateChangeTelemetry(e,t,n),shouldClientJoinWrite:()=>this._deltaManager.connectionManager.shouldJoinWrite(),maxClientLeaveWaitTime:this.loader.services.options.maxClientLeaveWaitTime,logConnectionIssue:(e,t)=>{this._deltaManager.logConnectionIssue(Object.assign({eventName:e,duration:b.now()-this.connectionTransitionTimes[ye.e.CatchingUp]},void 0===t?{}:{details:JSON.stringify(t)}))},connectionStateChanged:()=>{"loaded"===this._lifecycleState&&this.propagateConnectionState()}},this.mc.logger,null===(r=t.serializedContainerState)||void 0===r?void 0:r.clientId),this.on(Ue,(()=>{this.connectionStateHandler.containerSaved()})),this._deltaManager=this.createDeltaManager(),this._storage=new we((()=>{if(this.attachState!==o.mB.Attached){if(void 0!==this.loader.services.detachedBlobStorage)return new xe(this.loader.services.detachedBlobStorage,this.mc.logger);throw this.mc.logger.sendErrorEvent({eventName:"NoRealStorageInDetachedContainer"}),new Error("Real storage calls not allowed in Unattached container")}return this.storageService})),"object"==typeof document&&null!==document&&"function"==typeof document.addEventListener&&null!==document.addEventListener&&(this.lastVisible=document.hidden?b.now():void 0,this.visibilityEventHandler=()=>{document.hidden?this.lastVisible=b.now():setTimeout((()=>{this.lastVisible=void 0}),0)},document.addEventListener("visibilitychange",this.visibilityEventHandler)),this.on("newListener",((e,t)=>{Promise.resolve().then((()=>{switch(e){case He:this._dirtyContainer&&t();break;case Ue:this._dirtyContainer||t();break;case Y.tZ:this.connected&&t(this.clientId);break;case Y.h$:this.connected||t()}})).catch((e=>{this.mc.logger.sendErrorEvent({eventName:"RaiseConnectedEventError"},e)}))}))}static async load(e,t,n){const r=new We(e,{clientDetailsOverride:t.clientDetailsOverride,resolvedUrl:t.resolvedUrl,canReconnect:t.canReconnect,serializedContainerState:n});return h.Xr.timedExecAsync(r.mc.logger,{eventName:"Load"},(async e=>new Promise(((i,s)=>{var o,a;const c=t.version,l={opsBeforeReturn:"cached"},u=n?Object.assign(Object.assign({},null!==(o=t.loadMode)&&void 0!==o?o:l),{opsBeforeReturn:void 0}):null!==(a=t.loadMode)&&void 0!==a?a:l,h=e=>{s(null!=e?e:new E.pY("Container closed without error during load"))};r.on("closed",h),r.load(c,u,n).finally((()=>{r.removeListener("closed",h)})).then((n=>{e.end(Object.assign(Object.assign({},n),t.loadMode)),i(r)}),(e=>{const t=(0,ee.SC)(e);r.close(t),h(t)}))}))),{start:!0,end:!0,cancel:"generic"})}static async createDetached(e,t){const n=new We(e,{});return h.Xr.timedExecAsync(n.mc.logger,{eventName:"CreateDetached"},(async e=>(await n.createDetached(t),n)),{start:!0,end:!0,cancel:"generic"})}static async rehydrateDetachedFromSnapshot(e,t){const n=new We(e,{});return h.Xr.timedExecAsync(n.mc.logger,{eventName:"RehydrateDetachedFromSnapshot"},(async e=>{const r=JSON.parse(t);return await n.rehydrateDetachedFromSnapshot(r),n}),{start:!0,end:!0,cancel:"generic"})}setLoaded(){"loading"===this._lifecycleState&&(this.propagateConnectionState(),this._lifecycleState="loaded")}get closed(){return"closing"===this._lifecycleState||"closed"===this._lifecycleState}get storage(){return this._storage}get storageService(){if(void 0===this._storageService)throw new Error("Attempted to access storageService before it was defined");return this._storageService}get context(){if(void 0===this._context)throw new E.pY("Attempted to access context before it was defined");return this._context}get protocolHandler(){if(void 0===this._protocolHandler)throw new Error("Attempted to access protocolHandler before it was defined");return this._protocolHandler}get connectionMode(){return this._deltaManager.connectionManager.connectionMode}get IFluidRouter(){return this}get resolvedUrl(){return this._resolvedUrl}get loadedFromVersion(){return this._loadedFromVersion}get readOnlyInfo(){return this._deltaManager.readOnlyInfo}get closeSignal(){return this._deltaManager.closeAbortController.signal}forceReadonly(e){this._deltaManager.connectionManager.forceReadonly(e)}get deltaManager(){return this._deltaManager}get connectionState(){return this.connectionStateHandler.connectionState}get connected(){return this.connectionStateHandler.connected}get serviceConfiguration(){return this._deltaManager.serviceConfiguration}get clientId(){return this.connectionStateHandler.clientId}get scopes(){return this._deltaManager.connectionManager.scopes}get clientDetails(){return this._deltaManager.clientDetails}getSpecifiedCodeDetails(){return this.getCodeDetailsFromQuorum()}getLoadedCodeDetails(){var e;return null===(e=this._context)||void 0===e?void 0:e.codeDetails}get audience(){return this._audience}get isDirty(){return this._dirtyContainer}get serviceFactory(){return this.loader.services.documentServiceFactory}get urlResolver(){return this.loader.services.urlResolver}get scope(){return this.loader.services.scope}get codeLoader(){return this.loader.services.codeLoader}getQuorum(){return this.protocolHandler.quorum}close(e){this._deltaManager.close(e),S(this.connectionState===ye.e.Disconnected,207),S("closed"===this._lifecycleState,788)}closeCore(e){var t,n,r,i;S(!this.closed,789);try{try{this.mc.logger.sendTelemetryEvent({eventName:"ContainerClose",category:void 0===e?"generic":"error"},e),this._lifecycleState="closing",null===(t=this._protocolHandler)||void 0===t||t.close(),this.connectionStateHandler.dispose(),null===(n=this._context)||void 0===n||n.dispose(void 0!==e?new Error(e.message):void 0),null===(r=this._storageService)||void 0===r||r.dispose(),null===(i=this.service)||void 0===i||i.dispose(e)}catch(e){this.mc.logger.sendErrorEvent({eventName:"ContainerCloseException"},e)}this.emit("closed",e),this.removeAllListeners(),void 0!==this.visibilityEventHandler&&document.removeEventListener("visibilitychange",this.visibilityEventHandler)}finally{this._lifecycleState="closed"}}closeAndGetPendingLocalState(){S(this.attachState===o.mB.Attached,209),S(void 0!==this.resolvedUrl&&"fluid"===this.resolvedUrl.type,210),S(!!this._protocolHandler,739),S(void 0!==this._protocolHandler.attributes.term,779);const e={pendingRuntimeState:this.context.getPendingLocalState(),url:this.resolvedUrl.url,protocol:this.protocolHandler.getProtocolState(),term:this._protocolHandler.attributes.term,clientId:this.clientId};return this.close(),JSON.stringify(e)}get attachState(){return this._attachState}serialize(){S(this.attachState===o.mB.Detached,211);const e=T(this.context.createSummary(),this.captureProtocolSummary());return this.loader.services.detachedBlobStorage&&this.loader.services.detachedBlobStorage.size>0&&(e.tree[".hasAttachmentBlobs"]={type:_.Blob,content:"true"}),JSON.stringify(e)}async attach(e){await h.Xr.timedExecAsync(this.mc.logger,{eventName:"Attach"},(async()=>{if("loaded"!==this._lifecycleState)throw new E.Oi(`The Container is not in a valid state for attach [${this._lifecycleState}]`);S(this._attachState===o.mB.Detached&&!this.attachStarted,517),this.attachStarted=!0;const t=void 0!==this.loader.services.detachedBlobStorage&&this.loader.services.detachedBlobStorage.size>0;try{let n;if(S(0===this.deltaManager.inbound.length,214),!t){const e=this.context.createSummary(),t=this.captureProtocolSummary();n=T(e,t),this._attachState=o.mB.Attaching,this.context.notifyAttaching(Pe(n))}const r=await this.urlResolver.resolve(e);p(r),void 0===this.service&&(S(this.client.details.type!==Ge,708),this.service=await R((async()=>this.serviceFactory.createContainer(n,r,this.subLogger,!1)),"containerAttach",this.mc.logger,{cancel:this.closeSignal}));const i=this.service.resolvedUrl;if(p(i),this._resolvedUrl=i,await this.connectStorageService(),t){S(!!this.loader.services.detachedBlobStorage,590);const e=new Map;for(;e.size<this.loader.services.detachedBlobStorage.size;){const t=this.loader.services.detachedBlobStorage.getBlobIds().filter((t=>!e.has(t)));for(const n of t){const t=await this.loader.services.detachedBlobStorage.readBlob(n),r=await this.storageService.createBlob(t);e.set(n,r.id)}}const t=this.context.createSummary(e),r=this.captureProtocolSummary();n=T(t,r),this._attachState=o.mB.Attaching,this.context.notifyAttaching(Pe(n)),await this.storageService.uploadSummaryWithContext(n,{referenceSequenceNumber:0,ackHandle:void 0,proposalHandle:void 0})}this._attachState=o.mB.Attached,this.emit("attached"),this.propagateConnectionState(),this.closed||this.resumeInternal({fetchOpsFromStorage:!1,reason:"createDetached"})}catch(e){const t=(0,ee.SC)(e),n=this.resolvedUrl;throw d(n)&&t.addTelemetryProperties({resolvedUrl:n.url}),this.close(t),t}}),{start:!0,end:!0,cancel:"generic"})}async request(e){return h.Xr.timedExecAsync(this.mc.logger,{eventName:"Request"},(async()=>this.context.request(e)),{end:!0,cancel:"error"})}setAutoReconnectInternal(e){if(this._deltaManager.connectionManager.reconnectMode===e)return;const t=b.now(),n=t-this.setAutoReconnectTime;this.setAutoReconnectTime=t,this.mc.logger.sendTelemetryEvent({eventName:e===X.Enabled?"AutoReconnectEnabled":"AutoReconnectDisabled",connectionMode:this.connectionMode,connectionState:ye.e[this.connectionState],duration:n}),this._deltaManager.connectionManager.setAutoReconnect(e)}connect(){if(this.closed)throw new E.Oi("The Container is closed and cannot be connected");if(this._attachState!==o.mB.Attached)throw new E.Oi("The Container is not attached and cannot be connected");this.connected||this.connectInternal({reason:"DocumentConnect",fetchOpsFromStorage:!1})}connectInternal(e){S(!this.closed,709),S(this._attachState===o.mB.Attached,710),this.resumeInternal(e);const t=X.Enabled;this.setAutoReconnectInternal(t)}disconnect(){if(this.closed)throw new E.Oi("The Container is closed and cannot be disconnected");this.disconnectInternal()}disconnectInternal(){S(!this.closed,711);const e=X.Disabled;this.setAutoReconnectInternal(e)}resumeInternal(e){S(!this.closed,217),this.inboundQueuePausedFromInit&&(this.inboundQueuePausedFromInit=!1,this._deltaManager.inbound.resume(),this._deltaManager.inboundSignal.resume()),this.connectToDeltaStream(e)}async getAbsoluteUrl(e){var t;if(void 0!==this.resolvedUrl)return this.urlResolver.getAbsoluteUrl(this.resolvedUrl,e,(e=>{let t;return t=e&&"name"in e?e:(0,C.s2)(null==e?void 0:e.package)?null==e?void 0:e.package.name:null==e?void 0:e.package,{name:t}})(null===(t=this._context)||void 0===t?void 0:t.codeDetails))}async proposeCodeDetails(e){if(!(0,C.Tr)(e))throw new Error("Provided codeDetails are not IFluidCodeDetails");if(this.codeLoader.IFluidCodeDetailsComparer){const t=await this.codeLoader.IFluidCodeDetailsComparer.compare(e,this.getCodeDetailsFromQuorum());if(void 0!==t&&t<=0)throw new Error("Proposed code details should be greater than the current")}return this.protocolHandler.quorum.propose("code",e).then((()=>!0)).catch((()=>!1))}async processCodeProposal(){const e=this.getCodeDetailsFromQuorum();if(await Promise.all([this.deltaManager.inbound.pause(),this.deltaManager.inboundSignal.pause()]),!0===await this.context.satisfies(e))return this.deltaManager.inbound.resume(),void this.deltaManager.inboundSignal.resume();this.close(new E.pY("Existing context does not satisfy incoming proposal"))}async getVersion(e){return(await this.storageService.getVersions(e,1))[0]}recordConnectStartTime(){void 0===this.connectionTransitionTimes[ye.e.Disconnected]&&(this.connectionTransitionTimes[ye.e.Disconnected]=b.now())}connectToDeltaStream(e){this.recordConnectStartTime(),this._canReconnect&&this.client.details.capabilities.interactive||(e.mode="write"),this._deltaManager.connect(e)}async load(e,t,n){if(void 0===this._resolvedUrl)throw new Error("Attempting to load without a resolved url");this.service=await this.serviceFactory.createDocumentService(this._resolvedUrl,this.subLogger,this.client.details.type===Ge);void 0===t.deltaConnection&&this.connectToDeltaStream({reason:"DocumentOpen",mode:"write",fetchOpsFromStorage:!1}),n?this.connectStorageService().catch((e=>this.close(e))):await this.connectStorageService(),this._attachState=o.mB.Attached;const{snapshot:r,versionId:i}=void 0===n?await this.fetchSnapshotTree(e):{snapshot:void 0,versionId:void 0};S(void 0!==r||void 0!==n,567);const s=void 0===n?await this.getDocumentAttributes(this.storageService,r):{sequenceNumber:n.protocol.sequenceNumber,minimumSequenceNumber:n.protocol.minimumSequenceNumber,term:n.term};let a;switch(t.opsBeforeReturn){case void 0:this.attachDeltaManagerOpHandler(s,"none"!==t.deltaConnection?"all":"none");break;case"cached":a=this.attachDeltaManagerOpHandler(s,"cached");break;case"all":a=this.attachDeltaManagerOpHandler(s,"all");break;default:w(t.opsBeforeReturn)}this._protocolHandler=void 0===n?await this.initializeProtocolStateFromSnapshot(s,this.storageService,r):await this.initializeProtocolState(s,n.protocol.members,n.protocol.proposals,n.protocol.values);const c=this.getCodeDetailsFromQuorum();if(await this.instantiateContext(!0,c,r,null==n?void 0:n.pendingRuntimeState),!this.closed)switch(void 0!==a&&(this._deltaManager.inbound.resume(),await Ve(this.mc.logger,"WaitOps",(async()=>(await a,{}))),await Ve(this.mc.logger,"WaitOpProcessing",(async()=>this._deltaManager.inbound.waitTillProcessingDone())),this._deltaManager.inbound.pause()),t.deltaConnection){case void 0:case"delayed":S(this.inboundQueuePausedFromInit,838),this.inboundQueuePausedFromInit=!1,this._deltaManager.inbound.resume(),this._deltaManager.inboundSignal.resume();break;case"none":break;default:w(t.deltaConnection)}if(this.closed)throw new Error("Container was closed while load()");return this.setLoaded(),{sequenceNumber:s.sequenceNumber,version:i,dmLastProcessedSeqNumber:this._deltaManager.lastSequenceNumber,dmLastKnownSeqNumber:this._deltaManager.lastKnownSeqNumber}}async createDetached(e){const t={sequenceNumber:0,term:1,minimumSequenceNumber:0};await this.attachDeltaManagerOpHandler(t);const n=De(e);this._protocolHandler=await this.initializeProtocolState(t,[],[],n),await this.instantiateContextDetached(!1),this.setLoaded()}async rehydrateDetachedFromSnapshot(e){void 0!==e.tree[".hasAttachmentBlobs"]&&(S(!!this.loader.services.detachedBlobStorage&&this.loader.services.detachedBlobStorage.size>0,592),delete e.tree[".hasAttachmentBlobs"]);const t=Pe(e);this._storage.loadSnapshotForRehydratingContainer(t);const n=await this.getDocumentAttributes(this._storage,t);await this.attachDeltaManagerOpHandler(n);const r=Re(t),i=function(e){const t=new Map(e).get("code");return S(void 0!==t,732),null==t?void 0:t.value}(await(0,M.g)(this._storage,r.blobs.quorumValues));this._protocolHandler=await this.initializeProtocolState(n,[],[],void 0!==i?De(i):[]),await this.instantiateContextDetached(!0,t),this.setLoaded()}async connectStorageService(){var e,t;if(void 0!==this._storageService)return;S(void 0!==this.service,495);const n=await this.service.connectToStorage();this._storageService=new be(n,this.mc.logger),!0===this.options.summarizeProtocolTree&&(this.mc.logger.sendTelemetryEvent({eventName:"summarizeProtocolTreeEnabled"}),this._storageService=new Se(this._storageService,(()=>this.captureProtocolSummary()))),S((null===(e=n.policies)||void 0===e?void 0:e.minBlobSize)===(null===(t=this.storageService.policies)||void 0===t?void 0:t.minBlobSize),224)}async getDocumentAttributes(e,t){if(void 0===t)return{minimumSequenceNumber:0,sequenceNumber:0,term:1};const n=".protocol"in t.trees?t.trees[".protocol"].blobs.attributes:t.blobs[".attributes"],r=await(0,M.g)(e,n);return void 0===r.term&&(r.term=1),r}async initializeProtocolStateFromSnapshot(e,t,n){let r=[],i=[],s=[];if(void 0!==n){const e=Re(n);[r,i,s]=await Promise.all([(0,M.g)(t,e.blobs.quorumMembers),(0,M.g)(t,e.blobs.quorumProposals),(0,M.g)(t,e.blobs.quorumValues)])}return await this.initializeProtocolState(e,r,i,s)}async initializeProtocolState(e,t,n,r){const i=new Q(e.minimumSequenceNumber,e.sequenceNumber,e.term,t,n,r,((e,t)=>this.submitMessage(q.Propose,{key:e,value:t}))),s=h.G2.create(this.subLogger,"ProtocolHandler");return i.quorum.on("error",(e=>{s.sendErrorEvent(e)})),this.connectionStateHandler.initProtocol(i),i.quorum.on("addProposal",(e=>{"code"!==e.key&&"code2"!==e.key||this.emit("codeDetailsProposed",e.value,e)})),i.quorum.on("approveProposal",((e,t,n)=>{"code"!==t&&"code2"!==t||((0,C.Tr)(n)||this.mc.logger.sendErrorEvent({eventName:"CodeProposalNotIFluidCodeDetails"}),this.processCodeProposal().catch((e=>{throw this.close((0,ee.SC)(e)),e})))})),i}captureProtocolSummary(){const e=this.protocolHandler.snapshot();return{tree:{attributes:{content:JSON.stringify(this.protocolHandler.attributes),type:_.Blob},quorumMembers:{content:JSON.stringify(e.members),type:_.Blob},quorumProposals:{content:JSON.stringify(e.proposals),type:_.Blob},quorumValues:{content:JSON.stringify(e.values),type:_.Blob}},type:_.Tree}}getCodeDetailsFromQuorum(){var e,t;return e=this.protocolHandler.quorum,null!==(t=e.get("code"))&&void 0!==t?t:e.get("code2")}get client(){var e;const t=void 0!==(null===(e=this.options)||void 0===e?void 0:e.client)?this.options.client:{details:{capabilities:{interactive:!0}},mode:"read",permission:[],scopes:[],user:{id:""}};return void 0!==this.clientDetailsOverride&&v()(t.details,this.clientDetailsOverride),t.details.environment=[t.details.environment,` loaderVersion:${ge}`].join(";"),t}activeConnection(){return this.connectionState===ye.e.Connected&&"write"===this.connectionMode}createDeltaManager(){const e=()=>this.service,t=new he(e,h.G2.create(this.subLogger,"DeltaManager"),(()=>this.activeConnection()),(t=>new ze(e,this.client,this._canReconnect,h.G2.create(this.subLogger,"ConnectionManager"),t)));return t.inbound.pause(),t.inboundSignal.pause(),t.on("connect",((e,t)=>{var n;this._audience.clear();for(const t of null!==(n=e.initialClients)&&void 0!==n?n:[])this._audience.addMember(t.clientId,t.client);this.connectionStateHandler.receivedConnectEvent(this.connectionMode,e)})),t.on("disconnect",(e=>{var t;null===(t=this.collabWindowTracker)||void 0===t||t.stopSequenceNumberUpdate(),this.connectionStateHandler.receivedDisconnectEvent(e)})),t.on("throttled",(e=>{const t=e;!0!==t.logged&&this.logContainerError(t),this.emit("warning",t)})),t.on("readonly",(e=>{this.emit("readonly",e)})),t.on("closed",(e=>{this.closeCore(e)})),t}async attachDeltaManagerOpHandler(e,t){var n;return this._deltaManager.attachOpHandler(e.minimumSequenceNumber,e.sequenceNumber,null!==(n=e.term)&&void 0!==n?n:1,{process:e=>this.processRemoteMessage(e),processSignal:e=>{this.processSignal(e)}},t)}logConnectionStateChangeTelemetry(e,t,n){var r;const i=b.now();this.connectionTransitionTimes[e]=i;const s=i-this.connectionTransitionTimes[t];let o,a,c,l,u;e===ye.e.Disconnected?c=this._deltaManager.connectionManager.reconnectMode:(e===ye.e.Connected?(o=i-this.connectionTransitionTimes[ye.e.Disconnected],o=h.hy.formatTick(o)):(l=this.deltaManager.lastKnownSeqNumber,this.deltaManager.hasCheckpointSequenceNumber&&(u=l-this.deltaManager.lastSequenceNumber)),a=this.firstConnection?"InitialConnect":"AutoReconnect"),this.mc.logger.sendPerformanceEvent(Object.assign({eventName:`ConnectionStateChange_${ye.e[e]}`,from:ye.e[t],duration:s,durationFromDisconnected:o,reason:n,connectionInitiationReason:a,pendingClientId:this.connectionStateHandler.pendingClientId,clientId:this.clientId,autoReconnect:c,opsBehind:u,online:O.Yz[(0,O.Gg)()],lastVisible:void 0!==this.lastVisible?b.now()-this.lastVisible:void 0,checkpointSequenceNumber:l,quorumSize:null===(r=this._protocolHandler)||void 0===r?void 0:r.quorum.getMembers().size},this._deltaManager.connectionProps)),e===ye.e.Connected&&(this.firstConnection=!1)}propagateConnectionState(){var e;const t=this.connectionState===ye.e.Connected&&!this.firstConnection&&"write"===this.connectionMode;t&&(this.messageCountAfterDisconnection=0);const n=this.connectionState===ye.e.Connected;!1===(null===(e=this._context)||void 0===e?void 0:e.disposed)&&this.context.setConnectionState(n,this.clientId),this.protocolHandler.setConnectionState(n,this.clientId),(0,Y.Qq)(this.mc.logger,this,n,this.clientId),t&&this.mc.logger.sendTelemetryEvent({eventName:"OpsSentOnReconnect",count:this.messageCountAfterDisconnection})}submitContainerMessage(e,t,n,r){switch(e){case q.Operation:case q.RemoteHelp:break;case q.Summarize:{const e=t;void 0===e.details&&(e.details={}),e.details.includesProtocolTree=!0===this.options.summarizeProtocolTree;break}default:return this.close(new E.pY("invalidContainerSubmitOpType",void 0,{messageType:e})),-1}return this.submitMessage(e,t,n,r)}submitMessage(e,t,n,r){var i;return this.connectionState!==ye.e.Connected?(this.mc.logger.sendErrorEvent({eventName:"SubmitMessageWithNoConnection",type:e}),-1):(this.messageCountAfterDisconnection+=1,null===(i=this.collabWindowTracker)||void 0===i||i.stopSequenceNumberUpdate(),this._deltaManager.submit(e,t,n,r))}processRemoteMessage(e){const t=this.clientId===e.clientId;let n={immediateNoOp:!1};try{n=this.protocolHandler.processMessage(e,t)}catch(t){this.close((0,ee.Jn)(t,(t=>new E.Jd(t,(0,E.HN)(e)))))}return(0,L._V)(e)&&!(0,L.LW)(e)&&this.mc.logger.sendTelemetryEvent({eventName:"UnpackedRuntimeMessage",type:e.type}),((0,L.LW)(e)||(0,L._V)(e))&&this.context.process(e,t,void 0),this.activeConnection()&&(void 0===this.collabWindowTracker&&(S(void 0!==this.serviceConfiguration,740),this.collabWindowTracker=new Me(((e,t)=>{S(this.activeConnection(),577),this.submitMessage(e,t)}),this.serviceConfiguration.noopTimeFrequency,this.serviceConfiguration.noopCountFrequency)),this.collabWindowTracker.scheduleSequenceNumberUpdate(e,!0===n.immediateNoOp)),this.emit("op",e),n}submitSignal(e){this._deltaManager.submitSignal(JSON.stringify(e))}processSignal(e){if(null===e.clientId){const t=e.content;if(t.type===q.ClientJoin){const e=t.content;this._audience.addMember(e.clientId,e.client)}else if(t.type===q.ClientLeave){const e=t.content;this._audience.removeMember(e)}}else{const t=this.clientId===e.clientId;this.context.processSignal(e,t)}}async fetchSnapshotTree(e){var t;const n=await this.getVersion(null!=e?e:null);void 0===n&&void 0!==e&&this.mc.logger.sendErrorEvent({eventName:"NoVersionFoundWhenSpecified",id:e}),this._loadedFromVersion=n;const r=null!==(t=await this.storageService.getSnapshotTree(n))&&void 0!==t?t:void 0;return void 0===r&&void 0!==n&&this.mc.logger.sendErrorEvent({eventName:"getSnapshotTreeFailed",id:n.id}),{snapshot:r,versionId:null==n?void 0:n.id}}async instantiateContextDetached(e,t){const n=this.getCodeDetailsFromQuorum();if(void 0===n)throw new Error("pkg should be provided in create flow!!");await this.instantiateContext(e,n,t)}async instantiateContext(e,t,n,r){var i;S(!1!==(null===(i=this._context)||void 0===i?void 0:i.disposed),221);const s=new $e(this,this.loader);this._context=await re.createOrLoad(this,this.scope,this.codeLoader,t,n,new fe(this._deltaManager),new Fe(this.protocolHandler.quorum),s,((e,t,n,r)=>this.submitContainerMessage(e,t,n,r)),(e=>this.submitSignal(e)),(e=>this.close(e)),We.version,(e=>this.updateDirtyContainerState(e)),e,r),this.emit("contextChanged",t)}updateDirtyContainerState(e){this._dirtyContainer!==e&&(this._dirtyContainer=e,this.emit(e?He:Ue))}logContainerError(e){this.mc.logger.sendErrorEvent({eventName:"ContainerWarning"},e)}}function Ke(e){return void 0===e.headers||!1!==e.headers[c.A.cache]}We.version="^0.1.0";class $e{constructor(e,t){this.container=e,this.loader=t}get IFluidRouter(){return this}async resolve(e){var t,n,r,i,s;if(e.url.startsWith("/")){if(Ke(e))return this.container;{const o=this.container.resolvedUrl;return p(o),await We.load(this.loader,{canReconnect:null===(t=e.headers)||void 0===t?void 0:t[c.A.reconnect],clientDetailsOverride:null===(n=e.headers)||void 0===n?void 0:n[c.A.clientDetails],resolvedUrl:Object.assign({},o),version:null!==(i=null===(r=e.headers)||void 0===r?void 0:r[c.A.version])&&void 0!==i?i:void 0,loadMode:null===(s=e.headers)||void 0===s?void 0:s[c.A.loadMode]})}}if(void 0===this.loader)throw new Error("Cannot resolve external containers");return this.loader.resolve(e)}async request(e){return e.url.startsWith("/")?(await this.resolve(e)).request(e):void 0===this.loader?{status:404,value:"Cannot request external containers",mimeType:"plain/text"}:this.loader.request(e)}}function Je(e){const t=Object.create(e),n=new Map;return t.resolve=async t=>Ke(t)?(n.has(t.url)||n.set(t.url,e.resolve(t)),n.get(t.url)):e.resolve(t),t}class Qe{constructor(e){var t,n;this.containers=new Map;const r=Object.assign({},e.scope);!1!==(null===(t=e.options)||void 0===t?void 0:t.provideScopeLoader)&&(r.ILoader=this);const i={loaderId:(0,a.Z)(),loaderVersion:ge},s=(0,l.UK)(u.b.mixinDebugLogger("fluid:telemetry",e.logger,{all:i}),l.of.value,e.configProvider);this.services={urlResolver:Je(f.create(e.urlResolver)),documentServiceFactory:m.create(e.documentServiceFactory),codeLoader:e.codeLoader,options:null!==(n=e.options)&&void 0!==n?n:{},scope:r,subLogger:s.logger,detachedBlobStorage:e.detachedBlobStorage},this.mc=(0,l.rZ)(h.G2.create(this.services.subLogger,"Loader"))}get IFluidRouter(){return this}async createDetachedContainer(e){const t=await We.createDetached(this,e);return this.cachingEnabled&&t.once("attached",(()=>{p(t.resolvedUrl);const e=ke(t.resolvedUrl.url);void 0!==e&&this.addToContainerCache(e.id,Promise.resolve(t))})),t}async rehydrateDetachedContainerFromSnapshot(e){return We.rehydrateDetachedFromSnapshot(this,e)}async resolve(e,t){const n=void 0===t?"Resolve":"ResolveWithPendingState";return h.Xr.timedExecAsync(this.mc.logger,{eventName:n},(async()=>(await this.resolveCore(e,void 0!==t?JSON.parse(t):void 0)).container))}async request(e){return h.Xr.timedExecAsync(this.mc.logger,{eventName:"Request"},(async()=>{const t=await this.resolveCore(e);return t.container.request(Object.assign(Object.assign({},e),{url:`${t.parsed.path}${t.parsed.query}`}))}))}getKeyForContainerCache(e,t){var n;return void 0!==(null===(n=e.headers)||void 0===n?void 0:n[c.A.version])?`${t.id}@${e.headers[c.A.version]}`:t.id}addToContainerCache(e,t){this.containers.set(e,t),t.then((t=>{t.closed?this.containers.delete(e):t.once("closed",(()=>{this.containers.delete(e)}))})).catch((e=>{}))}async resolveCore(e,t){const n=await this.services.urlResolver.resolve(e);p(n);const r=ke(n.url);if(void 0===r)throw new Error(`Invalid URL ${n.url}`);if(void 0!==t){const e=ke(t.url);if((null==e?void 0:e.id)!==r.id||(null==e?void 0:e.path.replace(/\/$/,""))!==r.path.replace(/\/$/,"")){const e=`URL ${n.url} does not match pending state URL ${t.url}`;throw new Error(e)}}const{canCache:i,fromSequenceNumber:s}=this.parseHeader(r,e);let o;if(void 0===t&&i){const t=this.getKeyForContainerCache(e,r),i=await this.containers.get(t);if(void 0!==i)o=i;else{const r=this.loadContainer(e,n);this.addToContainerCache(t,r),o=await r}}else o=await this.loadContainer(e,n,t);return o.deltaManager.lastSequenceNumber<=s&&await new Promise(((e,t)=>{o.on("op",(function t(n){n.sequenceNumber>s&&(e(),o.removeListener("op",t))}))})),{container:o,parsed:r}}get cachingEnabled(){return!1!==this.services.options.cache}canCacheForRequest(e){return this.cachingEnabled&&!1!==e[c.A.cache]}parseHeader(e,t){var n,r;let i=-1;t.headers=null!==(n=t.headers)&&void 0!==n?n:{};const s=t.headers[c.A.sequenceNumber];return void 0!==s&&(i=s),t.headers[c.A.version]=null!==(r=e.version)&&void 0!==r?r:t.headers[c.A.version],{canCache:this.canCacheForRequest(t.headers),fromSequenceNumber:i}}async loadContainer(e,t,n){var r,i,s,o,a;return We.load(this,{canReconnect:null===(r=e.headers)||void 0===r?void 0:r[c.A.reconnect],clientDetailsOverride:null===(i=e.headers)||void 0===i?void 0:i[c.A.clientDetails],resolvedUrl:t,version:null!==(o=null===(s=e.headers)||void 0===s?void 0:s[c.A.version])&&void 0!==o?o:void 0,loadMode:null===(a=e.headers)||void 0===a?void 0:a[c.A.loadMode]},n)}}var Xe,Ze=n(1),Ye=n(2434);function et(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}!function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(Xe||(Xe={}));var tt,nt=n(686);class rt{constructor(e){this.maxRequests=e,this.tasks=[],this.release=()=>{const e=this.tasks.shift();if(void 0!==e)return e();this.maxRequests++},(0,nt.h)(e>0,174)}get waitQueueLength(){return this.tasks.length}async acquire(){if(!(this.maxRequests>0))return new Promise((e=>{this.tasks.push(e)}));this.maxRequests--}async schedule(e){return await this.acquire(),e().finally(this.release)}}function it(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}function st(e,t){switch(t){case"base64":return Ce.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}function ot(e){const t=e;return e instanceof ArrayBuffer||"object"==typeof t&&null!==t&&"number"==typeof t.byteLength&&"function"==typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}!function(e){e[e.NoCaching=0]="NoCaching",e[e.Prefetch=1]="Prefetch"}(tt||(tt={}));class at extends Uint8Array{toString(e){return st(this,e)}static from(e,t,n){if("string"==typeof e)return at.fromString(e,t);if(null!==e&&"object"==typeof e&&ot(e.buffer))return it(0===e.byteOffset,0),it(e.byteLength===e.buffer.byteLength,1),at.fromArrayBuffer(e.buffer,t,n);if(ot(e))return at.fromArrayBuffer(e,t,n);throw new TypeError}static fromArrayBuffer(e,t,n){const r=null!=t?t:0,i=null!=n?n:e.byteLength-r;if(r<0||r>e.byteLength||i<0||i+r>e.byteLength)throw new RangeError;return new at(e,r,i)}static fromString(e,t){switch(t){case"base64":{const t=this.sanitizeBase64(e),n=Ce.toByteArray(t);return new at(n.buffer)}case"utf8":case"utf-8":case void 0:{const t=(new TextEncoder).encode(e);return new at(t.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!=0&&(t+=["","===","==","="][t.length%4]),t}}var ct=n(7673),lt=n(4530),ut=n.n(lt),ht=n(4200),dt=n.n(ht);const pt=(0,n(921).debug)("fluid:services-client");pt("Package: @fluidframework/server-services-client - Version: 0.1036.5001");class ft extends Error{constructor(e,t,n,r,i){super(t),this.code=e,this.canRetry=n,this.isFatal=r,this.retryAfterMs=i,this.name="NetworkError",this.retryAfter=void 0!==i?i/1e3:void 0}get details(){return void 0===this.canRetry&&void 0===this.isFatal&&void 0===this.retryAfterMs?this.message:{message:this.message,canRetry:this.canRetry,isFatal:this.isFatal,retryAfter:this.retryAfter,retryAfterMs:this.retryAfterMs}}toJSON(){return{code:this.code,message:this.message,canRetry:this.canRetry,isFatal:this.isFatal,retryAfterMs:this.retryAfterMs,retryAfter:this.retryAfter}}}function gt(e,t){var n;let r,i,s,o;switch(t&&"object"==typeof t?(r=null!==(n=t.message)&&void 0!==n?n:"Unknown Error",i=t.canRetry,s=t.isFatal,o=t.retryAfter):r=t&&"string"==typeof t?t:"Unknown Error",e){case 401:case 403:case 404:return new ft(e,r,!1,!1);case 413:case 422:return new ft(e,r,null!=i&&i,null!=s&&s,i?o:void 0);case 429:case 502:case 503:case 504:return new ft(e,r,!0,!1,o);case 500:return new ft(e,r,null==i||i,null!=s&&s,i?o:void 0);default:return new ft(e,r,!1,!0)}}const mt="x-correlation-id";class yt{constructor(e,t={},n=1048576e3,r=1048576e3){this.baseurl=e,this.defaultQueryString=t,this.maxBodyLength=n,this.maxContentLength=r}async get(e,t,n){const r={baseURL:this.baseurl,headers:n,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"GET",url:`${e}${this.generateQueryString(t)}`};return this.request(r,200)}async post(e,t,n,r){const i={baseURL:this.baseurl,data:t,headers:r,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"POST",url:`${e}${this.generateQueryString(n)}`};return this.request(i,201)}async delete(e,t,n){const r={baseURL:this.baseurl,headers:n,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"DELETE",url:`${e}${this.generateQueryString(t)}`};return this.request(r,204)}async patch(e,t,n,r){const i={baseURL:this.baseurl,data:t,headers:r,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"PATCH",url:`${e}${this.generateQueryString(n)}`};return this.request(i,200)}generateQueryString(e){if(this.defaultQueryString||e){const t=Object.assign(Object.assign({},this.defaultQueryString),e),n=ct.stringify(t);if(""!==n)return`?${n}`}return""}}class vt extends yt{constructor(e,t={},n=1048576e3,r=1048576e3,i={},s=dt(),o,a,c){super(e,t,n,r),this.defaultHeaders=i,this.axios=s,this.refreshDefaultQueryString=o,this.refreshDefaultHeaders=a,this.getCorrelationId=c}async request(e,t,n=!0){var r,i;const s=Object.assign({},e);return s.headers=this.generateHeaders(s.headers,null!==(i=null===(r=this.getCorrelationId)||void 0===r?void 0:r.call(this))&&void 0!==i?i:(0,a.Z)()),new Promise(((r,i)=>{this.axios.request(s).then((e=>{r(e.data)})).catch((o=>{var a,c,l,u,h,d,p,f,g,m,y,v,b,S;if((null===(a=null==o?void 0:o.response)||void 0===a?void 0:a.status)===t&&r(null===(c=null==o?void 0:o.response)||void 0===c?void 0:c.data),(null==o?void 0:o.config)?pt(`[${o.config.method}] request to [${null!==(l=o.config.baseURL)&&void 0!==l?l:""}${null!==(u=o.config.url)&&void 0!==u?u:""}] failed with [${null===(h=o.response)||void 0===h?void 0:h.status}] [${ut()(null===(d=o.response)||void 0===d?void 0:d.data,void 0,2)}]`):pt(`request to ${s.url} failed ${o?o.message:""}`),429===(null===(p=null==o?void 0:o.response)||void 0===p?void 0:p.status)&&(null===(g=null===(f=null==o?void 0:o.response)||void 0===f?void 0:f.data)||void 0===g?void 0:g.retryAfter)>0&&n)setTimeout((()=>{this.request(s,t).then(r).catch(i)}),1e3*o.response.data.retryAfter);else if(401===(null===(m=null==o?void 0:o.response)||void 0===m?void 0:m.status)&&n&&this.refreshOnAuthError()){const n=Object.assign({},e);n.headers=this.generateHeaders(n.headers,s.headers[mt]),this.request(n,t,!1).then(r).catch(i)}else if(null==o?void 0:o.response)i(gt(null===(y=null==o?void 0:o.response)||void 0===y?void 0:y.status,null===(v=null==o?void 0:o.response)||void 0===v?void 0:v.data));else if(null==o?void 0:o.request)i(gt(502,`Network Error: ${null!==(b=null==o?void 0:o.message)&&void 0!==b?b:"undefined"}`));else{const e={canRetry:!1,isFatal:!1,message:null!==(S=null==o?void 0:o.message)&&void 0!==S?S:"Unknown Error"};i(gt(500,e))}}))}))}generateHeaders(e,t){let n=null!=e?e:{};return this.defaultHeaders&&(n=Object.assign(Object.assign({},this.defaultHeaders),e)),n[mt]?n:Object.assign({[mt]:t},n)}refreshOnAuthError(){return(void 0!==this.refreshDefaultQueryString||void 0!==this.refreshDefaultHeaders)&&(void 0!==this.refreshDefaultHeaders&&(this.defaultHeaders=this.refreshDefaultHeaders()),void 0!==this.refreshDefaultQueryString&&(this.defaultQueryString=this.refreshDefaultQueryString()),!0)}}function bt(e,t){for(const n of t)if(e.endsWith(n))return!0;return!1}class St{constructor(e,t,n,r){this.endpoint=e,this.historianApi=t,this.restWrapper=r,this.defaultQueryString={},n&&this.historianApi?(this.defaultQueryString.disableCache=n,this.cacheBust=!1):this.cacheBust=n,void 0===this.restWrapper&&(this.restWrapper=new vt(this.endpoint))}async getHeader(e){return this.historianApi?this.restWrapper.get(`/headers/${encodeURIComponent(e)}`,this.getQueryString()):this.getHeaderDirect(e)}async getFullTree(e){return this.restWrapper.get(`/tree/${encodeURIComponent(e)}`,this.getQueryString())}async getBlob(e){return this.restWrapper.get(`/git/blobs/${encodeURIComponent(e)}`,this.getQueryString())}async createBlob(e){return this.restWrapper.post("/git/blobs",e,this.getQueryString())}async getContent(e,t){return this.restWrapper.get(`/contents/${e}`,this.getQueryString({ref:t}))}async getCommits(e,t){return this.restWrapper.get("/commits",this.getQueryString({count:t,sha:e})).catch((e=>400===e||404===e?[]:Promise.reject(e)))}async getCommit(e){return this.restWrapper.get(`/git/commits/${encodeURIComponent(e)}`,this.getQueryString())}async createCommit(e){return this.restWrapper.post("/git/commits",e,this.getQueryString())}async getRefs(){return this.restWrapper.get("/git/refs",this.getQueryString())}async getRef(e){return this.restWrapper.get(`/git/refs/${e}`,this.getQueryString())}async createRef(e){return this.restWrapper.post("/git/refs",e,this.getQueryString())}async updateRef(e,t){return this.restWrapper.patch(`/git/refs/${e}`,t,this.getQueryString())}async deleteRef(e){await this.restWrapper.delete(`/git/refs/${e}`,this.getQueryString())}async createTag(e){return this.restWrapper.post("/git/tags",e,this.getQueryString())}async getTag(e){return this.restWrapper.get(`/git/tags/${e}`,this.getQueryString())}async createTree(e){return this.restWrapper.post("/git/trees",e,this.getQueryString())}async getTree(e,t){return this.restWrapper.get(`/git/trees/${encodeURIComponent(e)}`,this.getQueryString({recursive:t?1:0}))}async createSummary(e){return this.restWrapper.post("/git/summaries",e,this.getQueryString())}async deleteSummary(e){const t={"Soft-Delete":e};return this.restWrapper.delete("/git/summaries",this.getQueryString(),t)}async getSummary(e){return this.restWrapper.get(`/git/summaries/${e}`,this.getQueryString())}async getHeaderDirect(e){const t=await this.getTree(e,!0),n=[".attributes",".blobs",".messages","header"],r=[];for(const e of t.tree)if("blob"===e.type&&bt(e.path,n)){const t=this.getBlob(e.sha);r.push(t)}return{blobs:await Promise.all(r),tree:t}}getQueryString(e){return this.cacheBust?Object.assign(Object.assign({cacheBust:Date.now()},this.defaultQueryString),e):Object.assign(Object.assign({},this.defaultQueryString),e)}}var wt,xt,Ct=n(1044);!function(e){e.File="100644",e.Executable="100755",e.Directory="040000",e.Symlink="120000"}(wt||(wt={})),function(e){e.Blob="Blob",e.Tree="Tree",e.Attachment="Attachment"}(xt||(xt={}));class Et{constructor(e){this.historian=e,this.blobCache=new Map,this.commitCache=new Map,this.treeCache=new Map,this.refCache=new Map}async getHeader(e,t){const n=await this.historian.getHeader(t);for(const e of n.blobs)this.blobCache.set(e.sha,e);return(0,Ct.eB)(n.tree)}async getFullTree(e){return this.historian.getFullTree(e)}async getCommit(e){return this.commitCache.has(e)?(pt(`Cache hit on ${e}`),this.commitCache.get(e)):this.historian.getCommit(e)}async getCommits(e,t){let n=e;if(this.refCache.has(e)&&(pt(`Commit cache hit on ${e}`),n=this.refCache.get(e),this.refCache.delete(e),!n))return[];if(this.commitCache.has(n)){const e=this.commitCache.get(n);return[{commit:{author:e.author,committer:e.committer,message:e.message,tree:e.tree,url:e.url},parents:e.parents,sha:e.sha,url:e.url}]}return this.historian.getCommits(n,t)}async getTree(e,t=!0){return this.treeCache.has(e)?(pt(`Tree cache hit on ${e}`),this.treeCache.get(e)):this.historian.getTree(e,t)}async getBlob(e){return this.blobCache.has(e)?(pt(`Blob cache hit on ${e}`),this.blobCache.get(e)):this.historian.getBlob(e)}getRawUrl(e){return`${this.historian.endpoint}/git/blobs/raw/${e}`}async getContent(e,t){return this.historian.getContent(t,e)}async createBlob(e,t){const n={content:e,encoding:t};return this.historian.createBlob(n)}async createGitTree(e){return this.historian.createTree(e)}async createTree(e){return this.createTreeCore(e,0)}async createCommit(e){return this.historian.createCommit(e)}async createSummary(e){return this.historian.createSummary(e)}async deleteSummary(e){return this.historian.deleteSummary(e)}async getSummary(e){return this.historian.getSummary(e)}async getRef(e){return this.historian.getRef(`heads/${e}`).catch((e=>{if(400===e||404===e)return null;throw e}))}async createRef(e,t){const n={ref:`refs/heads/${e}`,sha:t,config:{enabled:!0}};return this.historian.createRef(n)}async upsertRef(e,t){const n={force:!0,sha:t,config:{enabled:!0}};return this.historian.updateRef(`heads/${e}`,n)}addRef(e,t){this.refCache.set(e,t)}addCommit(e){this.commitCache.set(e.sha,e)}addTree(e){this.treeCache.set(e.sha,e)}addBlob(e){this.blobCache.set(e.sha,e)}async write(e,t,n,r){const i=await this.createTree(t),s={author:{date:(new Date).toISOString(),email:"kurtb@microsoft.com",name:"Kurt Berglund"},message:r,parents:n,tree:i.sha},o=await this.historian.createCommit(s);return await this.getRef(e)?await this.upsertRef(e,o.sha):await this.createRef(e,o.sha),o}async createTreeCore(e,t){if(e.id)return this.getTree(e.id);const n=[];for(const r of e.entries)switch(xt[r.type]){case xt.Blob:{const e=r.value;r.mode===wt.Symlink&&(e.contents=this.translateSymlink(e.contents,t));const i=this.createBlob(e.contents,e.encoding);n.push(i);break}case xt.Tree:{const e=r.value,i=this.createTreeCore(e,t+1);n.push(i);break}default:throw new Error("Unknown entry type")}const r=await Promise.all(n),i=[];it(r.length===e.entries.length,"File entries length is not correct");for(let t=0;t<e.entries.length;t++){const n=e.entries[t].type===xt.Tree?"tree":e.entries[t].type===xt.Blob?"blob":"commit";i.push({mode:e.entries[t].mode,path:e.entries[t].path,sha:r[t].sha,type:n})}const s={tree:i};return this.historian.createTree(s)}translateSymlink(e,t){let n="";for(let e=0;e<=t;e++)n+="../";return`${n}${e}`}}const Tt=Object.create(null);Tt.open="0",Tt.close="1",Tt.ping="2",Tt.pong="3",Tt.message="4",Tt.upgrade="5",Tt.noop="6";const At=Object.create(null);Object.keys(Tt).forEach((e=>{At[Tt[e]]=e}));const kt={type:"error",data:"parser error"},Nt="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),Ot="function"==typeof ArrayBuffer,Pt=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,Rt=({type:e,data:t},n,r)=>Nt&&t instanceof Blob?n?r(t):It(t,r):Ot&&(t instanceof ArrayBuffer||Pt(t))?n?r(t):It(new Blob([t]),r):r(Tt[e]+(t||"")),It=(e,t)=>{const n=new FileReader;return n.onload=function(){const e=n.result.split(",")[1];t("b"+(e||""))},n.readAsDataURL(e)};function Ft(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let Dt;const Mt="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let e=0;e<64;e++)Mt["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(e)]=e;const Lt="function"==typeof ArrayBuffer,_t=(e,t)=>{if("string"!=typeof e)return{type:"message",data:Bt(e,t)};const n=e.charAt(0);return"b"===n?{type:"message",data:qt(e.substring(1),t)}:At[n]?e.length>1?{type:At[n],data:e.substring(1)}:{type:At[n]}:kt},qt=(e,t)=>{if(Lt){const n=(e=>{let t,n,r,i,s,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);const l=new ArrayBuffer(o),u=new Uint8Array(l);for(t=0;t<a;t+=4)n=Mt[e.charCodeAt(t)],r=Mt[e.charCodeAt(t+1)],i=Mt[e.charCodeAt(t+2)],s=Mt[e.charCodeAt(t+3)],u[c++]=n<<2|r>>4,u[c++]=(15&r)<<4|i>>2,u[c++]=(3&i)<<6|63&s;return l})(e);return Bt(n,t)}return{base64:!0,data:e}},Bt=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,jt=String.fromCharCode(30);let zt;function Ht(e){return e.reduce(((e,t)=>e+t.length),0)}function Ut(e,t){if(e[0].length===t)return e.shift();const n=new Uint8Array(t);let r=0;for(let i=0;i<t;i++)n[i]=e[0][r++],r===e[0].length&&(e.shift(),r=0);return e.length&&r<e[0].length&&(e[0]=e[0].slice(r)),n}function Vt(e){if(e)return function(e){for(var t in Vt.prototype)e[t]=Vt.prototype[t];return e}(e)}Vt.prototype.on=Vt.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},Vt.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},Vt.prototype.off=Vt.prototype.removeListener=Vt.prototype.removeAllListeners=Vt.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<r.length;i++)if((n=r[i])===t||n.fn===t){r.splice(i,1);break}return 0===r.length&&delete this._callbacks["$"+e],this},Vt.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){r=0;for(var i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,t)}return this},Vt.prototype.emitReserved=Vt.prototype.emit,Vt.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},Vt.prototype.hasListeners=function(e){return!!this.listeners(e).length};const Gt="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function Wt(e,...t){return t.reduce(((t,n)=>(e.hasOwnProperty(n)&&(t[n]=e[n]),t)),{})}const Kt=Gt.setTimeout,$t=Gt.clearTimeout;function Jt(e,t){t.useNativeTimers?(e.setTimeoutFn=Kt.bind(Gt),e.clearTimeoutFn=$t.bind(Gt)):(e.setTimeoutFn=Gt.setTimeout.bind(Gt),e.clearTimeoutFn=Gt.clearTimeout.bind(Gt))}class Qt extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class Xt extends Vt{constructor(e){super(),this.writable=!1,Jt(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new Qt(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=_t(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){const t=function(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}(e);return t.length?"?"+t:""}}const Zt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Yt=64,en={};let tn,nn=0,rn=0;function sn(e){let t="";do{t=Zt[e%Yt]+t,e=Math.floor(e/Yt)}while(e>0);return t}function on(){const e=sn(+new Date);return e!==tn?(nn=0,tn=e):e+"."+sn(nn++)}for(;rn<Yt;rn++)en[Zt[rn]]=rn;let an=!1;try{an="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}const cn=an;function ln(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||cn))return new XMLHttpRequest}catch(e){}if(!t)try{return new(Gt[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}function un(){}const hn=null!=new ln({xdomain:!1}).responseType;class dn extends Vt{constructor(e,t){super(),Jt(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.data=void 0!==t.data?t.data:null,this.create()}create(){var e;const t=Wt(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd;const n=this.xhr=new ln(t);try{n.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&n.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(e){}if("POST"===this.method)try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{n.setRequestHeader("Accept","*/*")}catch(e){}null===(e=this.opts.cookieJar)||void 0===e||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=()=>{var e;3===n.readyState&&(null===(e=this.opts.cookieJar)||void 0===e||e.parseCookies(n)),4===n.readyState&&(200===n.status||1223===n.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof n.status?n.status:0)}),0))},n.send(this.data)}catch(e){return void this.setTimeoutFn((()=>{this.onError(e)}),0)}"undefined"!=typeof document&&(this.index=dn.requestsCount++,dn.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=un,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete dn.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}function pn(){for(let e in dn.requests)dn.requests.hasOwnProperty(e)&&dn.requests[e].abort()}dn.requestsCount=0,dn.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",pn):"function"==typeof addEventListener&&addEventListener("onpagehide"in Gt?"pagehide":"unload",pn,!1));const fn="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),gn=Gt.WebSocket||Gt.MozWebSocket,mn="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),yn={websocket:class extends Xt{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,n=mn?{}:Wt(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=mn?new gn(e,t,n):t?new gn(e,t):new gn(e)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],r=t===e.length-1;Rt(n,this.supportsBinary,(e=>{try{this.ws.send(e)}catch(e){}r&&fn((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=on()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}check(){return!!gn}},webtransport:class extends Xt{get name(){return"webtransport"}doOpen(){"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then((()=>{this.onClose()})).catch((e=>{this.onError("webtransport error",e)})),this.transport.ready.then((()=>{this.transport.createBidirectionalStream().then((e=>{const t=function(e,t){zt||(zt=new TextDecoder);const n=[];let r=0,i=-1,s=!1;return new TransformStream({transform(o,a){for(n.push(o);;){if(0===r){if(Ht(n)<1)break;const e=Ut(n,1);s=128==(128&e[0]),i=127&e[0],r=i<126?3:126===i?1:2}else if(1===r){if(Ht(n)<2)break;const e=Ut(n,2);i=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),r=3}else if(2===r){if(Ht(n)<8)break;const e=Ut(n,8),t=new DataView(e.buffer,e.byteOffset,e.length),s=t.getUint32(0);if(s>Math.pow(2,21)-1){a.enqueue(kt);break}i=s*Math.pow(2,32)+t.getUint32(4),r=3}else{if(Ht(n)<i)break;const e=Ut(n,i);a.enqueue(_t(s?e:zt.decode(e),t)),r=0}if(0===i||i>e){a.enqueue(kt);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(t).getReader(),r=new TransformStream({transform(e,t){!function(e,t){Nt&&e.data instanceof Blob?e.data.arrayBuffer().then(Ft).then(t):Ot&&(e.data instanceof ArrayBuffer||Pt(e.data))?t(Ft(e.data)):Rt(e,!1,(e=>{Dt||(Dt=new TextEncoder),t(Dt.encode(e))}))}(e,(n=>{const r=n.length;let i;if(r<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,r);else if(r<65536){i=new Uint8Array(3);const e=new DataView(i.buffer);e.setUint8(0,126),e.setUint16(1,r)}else{i=new Uint8Array(9);const e=new DataView(i.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(r))}e.data&&"string"!=typeof e.data&&(i[0]|=128),t.enqueue(i),t.enqueue(n)}))}});r.readable.pipeTo(e.writable),this.writer=r.writable.getWriter();const i=()=>{n.read().then((({done:e,value:t})=>{e||(this.onPacket(t),i())})).catch((e=>{}))};i();const s={type:"open"};this.query.sid&&(s.data=`{"sid":"${this.query.sid}"}`),this.writer.write(s).then((()=>this.onOpen()))}))})))}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],r=t===e.length-1;this.writer.write(n).then((()=>{r&&fn((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){var e;null===(e=this.transport)||void 0===e||e.close()}},polling:class extends Xt{constructor(e){if(super(e),this.polling=!1,"undefined"!=typeof location){const t="https:"===location.protocol;let n=location.port;n||(n=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||n!==e.port}const t=e&&e.forceBase64;this.supportsBinary=hn&&!t,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(e++,this.once("pollComplete",(function(){--e||t()}))),this.writable||(e++,this.once("drain",(function(){--e||t()})))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const n=e.split(jt),r=[];for(let e=0;e<n.length;e++){const i=_t(n[e],t);if(r.push(i),"error"===i.type)break}return r})(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const n=e.length,r=new Array(n);let i=0;e.forEach(((e,s)=>{Rt(e,!1,(e=>{r[s]=e,++i===n&&t(r.join(jt))}))}))})(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=on()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new dn(this.uri(),e)}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}},vn=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,bn=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Sn(e){if(e.length>2e3)throw"URI too long";const t=e,n=e.indexOf("["),r=e.indexOf("]");-1!=n&&-1!=r&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));let i=vn.exec(e||""),s={},o=14;for(;o--;)s[bn[o]]=i[o]||"";return-1!=n&&-1!=r&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=function(e,t){const n=t.replace(/\/{2,9}/g,"/").split("/");return"/"!=t.slice(0,1)&&0!==t.length||n.splice(0,1),"/"==t.slice(-1)&&n.splice(n.length-1,1),n}(0,s.path),s.queryKey=function(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,r){t&&(n[t]=r)})),n}(0,s.query),s}class wn extends Vt{constructor(e,t={}){super(),this.binaryType="arraybuffer",this.writeBuffer=[],e&&"object"==typeof e&&(t=e,e=null),e?(e=Sn(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=Sn(t.host).host),Jt(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},n=e.split("&");for(let e=0,r=n.length;e<r;e++){let r=n[e].split("=");t[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return t}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new yn[e](n)}open(){let e;if(this.opts.rememberUpgrade&&wn.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(e=>this.onClose("transport close",e)))}probe(e){let t=this.createTransport(e),n=!1;wn.priorWebsocketSuccess=!1;const r=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",(e=>{if(!n)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;wn.priorWebsocketSuccess="websocket"===t.name,this.transport.pause((()=>{n||"closed"!==this.readyState&&(l(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}))}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}})))};function i(){n||(n=!0,l(),t.close(),t=null)}const s=e=>{const n=new Error("probe error: "+e);n.transport=t.name,i(),this.emitReserved("upgradeError",n)};function o(){s("transport closed")}function a(){s("socket closed")}function c(e){t&&e.name!==t.name&&i()}const l=()=>{t.removeListener("open",r),t.removeListener("error",s),t.removeListener("close",o),this.off("close",a),this.off("upgrading",c)};t.once("open",r),t.once("error",s),t.once("close",o),this.once("close",a),this.once("upgrading",c),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn((()=>{n||t.open()}),200):t.open()}onOpen(){if(this.readyState="open",wn.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let n=0;n<this.writeBuffer.length;n++){const r=this.writeBuffer[n].data;if(r&&(e+="string"==typeof(t=r)?function(e){let t=0,n=0;for(let r=0,i=e.length;r<i;r++)t=e.charCodeAt(r),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}(t):Math.ceil(1.33*(t.byteLength||t.size))),n>0&&e>this.maxPayload)return this.writeBuffer.slice(0,n);e+=2}var t;return this.writeBuffer}write(e,t,n){return this.sendPacket("message",e,t,n),this}send(e,t,n){return this.sendPacket("message",e,t,n),this}sendPacket(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"===this.readyState||"closed"===this.readyState)return;(n=n||{}).compress=!1!==n.compress;const i={type:e,data:t,options:n};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?n():e()})):this.upgrading?n():e()),this}onError(e){wn.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let n=0;const r=e.length;for(;n<r;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}wn.protocol=4,wn.protocol;const xn="function"==typeof ArrayBuffer,Cn=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,En=Object.prototype.toString,Tn="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===En.call(Blob),An="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===En.call(File);function kn(e){return xn&&(e instanceof ArrayBuffer||Cn(e))||Tn&&e instanceof Blob||An&&e instanceof File}function Nn(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)if(Nn(e[t]))return!0;return!1}if(kn(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return Nn(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&Nn(e[t]))return!0;return!1}function On(e){const t=[],n=e.data,r=e;return r.data=Pn(n,t),r.attachments=t.length,{packet:r,buffers:t}}function Pn(e,t){if(!e)return e;if(kn(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}if(Array.isArray(e)){const n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=Pn(e[r],t);return n}if("object"==typeof e&&!(e instanceof Date)){const n={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=Pn(e[r],t));return n}return e}function Rn(e,t){return e.data=In(e.data,t),delete e.attachments,e}function In(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=In(e[n],t);else if("object"==typeof e)for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=In(e[n],t));return e}const Fn=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Dn=5;var Mn;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(Mn||(Mn={}));class Ln{constructor(e){this.replacer=e}encode(e){return e.type!==Mn.EVENT&&e.type!==Mn.ACK||!Nn(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===Mn.EVENT?Mn.BINARY_EVENT:Mn.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==Mn.BINARY_EVENT&&e.type!==Mn.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=On(e),n=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(n),r}}function _n(e){return"[object Object]"===Object.prototype.toString.call(e)}class qn extends Vt{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===Mn.BINARY_EVENT;n||t.type===Mn.BINARY_ACK?(t.type=n?Mn.EVENT:Mn.ACK,this.reconstructor=new Bn(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!kn(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(void 0===Mn[n.type])throw new Error("unknown packet type "+n.type);if(n.type===Mn.BINARY_EVENT||n.type===Mn.BINARY_ACK){const r=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const i=e.substring(r,t);if(i!=Number(i)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(i)}if("/"===e.charAt(t+1)){const r=t+1;for(;++t&&","!==e.charAt(t)&&t!==e.length;);n.nsp=e.substring(r,t)}else n.nsp="/";const r=e.charAt(t+1);if(""!==r&&Number(r)==r){const r=t+1;for(;++t;){const n=e.charAt(t);if(null==n||Number(n)!=n){--t;break}if(t===e.length)break}n.id=Number(e.substring(r,t+1))}if(e.charAt(++t)){const r=this.tryParse(e.substr(t));if(!qn.isPayloadValid(n.type,r))throw new Error("invalid payload");n.data=r}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}static isPayloadValid(e,t){switch(e){case Mn.CONNECT:return _n(t);case Mn.DISCONNECT:return void 0===t;case Mn.CONNECT_ERROR:return"string"==typeof t||_n(t);case Mn.EVENT:case Mn.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===Fn.indexOf(t[0]));case Mn.ACK:case Mn.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Bn{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=Rn(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function jn(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const zn=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Hn extends Vt{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[jn(e,"open",this.onopen.bind(this)),jn(e,"packet",this.onpacket.bind(this)),jn(e,"error",this.onerror.bind(this)),jn(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(zn.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const n={type:Mn.EVENT,data:t,options:{}};if(n.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const e=this.ids++,r=t.pop();this._registerAckCallback(e,r),n.id=e}const r=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!r||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){var n;const r=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0===r)return void(this.acks[e]=t);const i=this.io.setTimeoutFn((()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))}),r);this.acks[e]=(...e)=>{this.io.clearTimeoutFn(i),t.apply(this,[null,...e])}}emitWithAck(e,...t){const n=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise(((r,i)=>{t.push(((e,t)=>n?e?i(e):r(t):r(e))),this.emit(e,...t)}))}_addToQueue(e){let t;"function"==typeof e[e.length-1]&&(t=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push(((e,...r)=>{if(n===this._queue[0])return null!==e?n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(e)):(this._queue.shift(),t&&t(null,...r)),n.pending=!1,this._drainQueue()})),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth((e=>{this._sendConnectPacket(e)})):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:Mn.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Mn.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Mn.EVENT:case Mn.BINARY_EVENT:this.onevent(e);break;case Mn.ACK:case Mn.BINARY_ACK:this.onack(e);break;case Mn.DISCONNECT:this.ondisconnect();break;case Mn.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(...r){n||(n=!0,t.packet({type:Mn.ACK,id:e,data:r}))}}onack(e){const t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((e=>this.emitEvent(e))),this.receiveBuffer=[],this.sendBuffer.forEach((e=>{this.notifyOutgoingListeners(e),this.packet(e)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((e=>e())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Mn.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function Un(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Un.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},Un.prototype.reset=function(){this.attempts=0},Un.prototype.setMin=function(e){this.ms=e},Un.prototype.setMax=function(e){this.max=e},Un.prototype.setJitter=function(e){this.jitter=e};class Vn extends Vt{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,Jt(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(n=t.randomizationFactor)&&void 0!==n?n:.5),this.backoff=new Un({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||r;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new wn(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const r=jn(t,"open",(function(){n.onopen(),e&&e()})),i=t=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},s=jn(t,"error",i);if(!1!==this._timeout){const e=this._timeout,n=this.setTimeoutFn((()=>{r(),i(new Error("timeout")),t.close()}),e);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}return this.subs.push(r),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(jn(e,"ping",this.onping.bind(this)),jn(e,"data",this.ondata.bind(this)),jn(e,"error",this.onerror.bind(this)),jn(e,"close",this.onclose.bind(this)),jn(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(e){this.onclose("parse error",e)}}ondecoded(e){fn((()=>{this.emitReserved("packet",e)}),this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Hn(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const e of t)if(this.nsps[e].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach((e=>e())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn((()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()})))}),t);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Gn={};function Wn(e,t){"object"==typeof e&&(t=e,e=void 0);const n=function(e,t="",n){let r=e;n=n||"undefined"!=typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==n?n.protocol+"//"+e:"https://"+e),r=Sn(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const i=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+t,r.href=r.protocol+"://"+i+(n&&n.port===r.port?"":":"+r.port),r}(e,(t=t||{}).path||"/socket.io"),r=n.source,i=n.id,s=n.path,o=Gn[i]&&s in Gn[i].nsps;let a;return t.forceNew||t["force new connection"]||!1===t.multiplex||o?a=new Vn(r,t):(Gn[i]||(Gn[i]=new Vn(r,t)),a=Gn[i]),n.query&&!t.query&&(t.query=n.queryKey),a.socket(n.path,t)}Object.assign(Wn,{Manager:Vn,Socket:Hn,io:Wn,connect:Wn});class Kn{constructor(){this.completed=!1,this.p=new Promise(((e,t)=>{this.res=e,this.rej=t}))}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){void 0!==this.res&&(this.completed=!0,this.res(e))}reject(e){void 0!==this.rej&&(this.completed=!0,this.rej(e))}}Symbol.toStringTag;class $n{constructor(e,t,n,r,i,s){this.to=t,this.payloadSize=n,this.logger=r,this.requestCallback=i,this.responseCallback=s,this.results=new Map,this.workingState="working",this.requestsInFlight=0,this.endEvent=new Kn,this.requests=0,this.latestRequested=e,this.nextToDeliver=e,this.knewTo=void 0!==t}get working(){return"working"===this.workingState}get canceled(){return"canceled"===this.workingState}cancel(){this.working&&(this.workingState="canceled",this.endEvent.resolve())}async run(e){(0,nt.h)(e>0,258),(0,nt.h)(this.working,259);let t=e;for(;t>0;)t--,this.addRequest();return this.dispatch(),this.endEvent.promise}done(){(0,nt.h)(void 0!==this.to,260),(0,nt.h)(this.nextToDeliver>=this.to,261),this.working&&(this.workingState="done",this.endEvent.resolve())}fail(e){this.working&&(this.workingState="done",this.endEvent.reject(e))}dispatch(){for(;this.working;){const e=this.results.get(this.nextToDeliver);if(void 0===e)break;this.results.delete(this.nextToDeliver),(0,nt.h)(e.length<=this.payloadSize,473),this.nextToDeliver+=e.length,this.responseCallback(e)}this.working&&(0===this.requestsInFlight?((0,nt.h)(0===this.results.size,263),this.done()):void 0!==this.to&&this.nextToDeliver>=this.to&&((0,nt.h)(!this.knewTo,264),this.done()))}getNextChunk(){if(!this.working)return;const e=this.latestRequested;return void 0!==this.to&&this.to<=e?void 0:(this.latestRequested+=this.payloadSize,void 0!==this.to&&(this.latestRequested=Math.min(this.to,this.latestRequested)),(0,nt.h)(e<this.latestRequested,265),{from:e,to:this.latestRequested})}addRequest(){const e=this.getNextChunk();void 0!==e&&this.addRequestCore(e.from,e.to).catch(this.fail.bind(this))}async addRequestCore(e,t){(0,nt.h)(this.working,266);let n=e,r=t;for(this.requestsInFlight++;this.working;){const e=r-n;(0,nt.h)(e>0,267),void 0!==this.to&&((0,nt.h)(n<this.to,268),(0,nt.h)(r<=this.to,269)),this.requests++;const t=this.requestCallback(this.requests,n,r,void 0!==this.to,{});this.dispatch();const{payload:i,cancel:s,partial:o}=await t;if(s&&this.cancel(),void 0!==this.to&&n>=this.to){(0,nt.h)(!this.knewTo,270),0!==i.length&&this.logger.sendErrorEvent({eventName:"ParallelRequests_GotExtra",from:n,to:r,end:this.to,length:i.length});break}if(this.working){const t=n,s=i.length;let a=e<=s;if(0!==s){e<s&&this.logger.sendTelemetryEvent({eventName:"ParallelRequests_Over",from:n,to:r,length:s});const t=i.splice(0,e);this.results.set(n,t),n+=t.length}else(0,nt.h)(!o,271),(0,nt.h)(!this.knewTo,272);if(!o&&!a){if(!this.knewTo){(void 0===this.to||this.to>n)&&(this.to=n);break}this.logger.sendPerformanceEvent({eventName:"ParallelRequests_Partial",from:t,to:r,length:s})}if(r===this.latestRequested&&(0!==i.length&&(this.results.set(n,i),n+=i.length),this.latestRequested=n,a=!0),a){const e=this.getNextChunk();if(void 0===e)break;n=e.from,r=e.to}}}this.requestsInFlight--,this.dispatch()}}class Jn{constructor(){this.queue=[],this.done=!1}pushValue(e){this.pushCore(Promise.resolve({done:!1,value:e}))}pushError(e){this.pushCore(Promise.reject(e)),this.done=!0}pushDone(){this.pushCore(Promise.resolve({done:!0})),this.done=!0}pushCore(e){(0,nt.h)(!this.done,274),this.deferred?((0,nt.h)(0===this.queue.length,275),this.deferred.resolve(e),this.deferred=void 0):this.queue.push(e)}async read(){(0,nt.h)(void 0===this.deferred,276);const e=this.queue.shift();return void 0!==e?e:((0,nt.h)(!this.done,277),this.deferred=new Kn,this.deferred.promise)}}const Qn={read:async()=>({done:!0})};class Xn{send(e){}sendTelemetryEvent(e,t){}sendErrorEvent(e,t){}sendPerformanceEvent(e,t){}}class Zn{constructor(e,t,n,r){this.tenantId=e,this.id=t,this.deltaStorageService=n,this.documentStorageService=r,this.logtailSha=this.documentStorageService.logTailSha}fetchMessages(e,t,n,r,i){return r?Qn:function(e,t,n,r,i,s,o,a){let c,l=0,u=0;const d=new Jn,p={fromTotal:n,toTotal:r},f=h.Xr.start(s,Object.assign(Object.assign({eventName:"GetDeltas"},p),{reason:a})),g=new $n(n,r,i,s,(async(t,n,r,i,c)=>(l++,async function(e,t,n,r,i,s){let o,a=0;const c=[];for(;!0!==(null==i?void 0:i.aborted);){a++;let i=Math.min(1e4,100*Math.pow(2,a));const l=A.now();try{const r=e(Object.assign(Object.assign({},t),{retry:a})),{messages:i,partialResult:s}=await r;if(c.push(...i),0!==i.length||!n)return{payload:c,cancel:!1,partial:s};if(void 0===o)o=A.now();else if(A.now()-o>3e4)throw(0,O.jx)("Failed to retrieve ops from storage (Too Many Retries)",{canRetry:!1},Object.assign({retry:a,driverVersion:P},t))}catch(e){const n=(0,O.ms)(e);o=void 0;const c=(0,O.ZZ)(e);if(Le(r,Object.assign(Object.assign({eventName:"GetDeltas_Error"},t),{retry:a,duration:A.now()-l,retryAfter:c,reason:s}),e),!n)throw e;void 0!==c&&c>=0&&(i=c)}await _e(i)}return{partial:!1,cancel:!0,payload:[]}}((async t=>e(n,r,t)),Object.assign(Object.assign({request:t,from:n,to:r},p),c),i,s,o,a))),(e=>{void 0===c?(0,nt.h)(e[0].sequenceNumber===n,621):(0,nt.h)(e[0].sequenceNumber===c+1,622),c=e[e.length-1].sequenceNumber,(0,nt.h)(c-e[0].sequenceNumber+1===e.length,623),u+=e.length,d.pushValue(e)})),m=e=>{g.cancel()};return void 0!==o&&o.addEventListener("abort",m),g.run(t).finally((()=>{void 0!==o&&o.removeEventListener("abort",m)})).then((()=>{const e={lastFetch:c,length:u,requests:l};g.canceled?f.cancel(Object.assign(Object.assign({},e),{error:"ops request cancelled by client"})):((0,nt.h)(void 0===r||void 0!==c&&c>=r-1,624),f.end(e)),d.pushDone()})).catch((e=>{f.cancel({lastFetch:c,length:u,requests:l},e),d.pushError(e)})),d}(this.getCore.bind(this),1,e,t,2e3,new Xn,n,i)}async getCore(e,t){const n=this.logtailSha?await(0,M.g)(this.documentStorageService,this.logtailSha):[];if(this.logtailSha=void 0,n.length>0){const t=n.filter((t=>t.sequenceNumber>=e));if(t.length>0)return{messages:t,partialResult:!0}}return this.deltaStorageService.get(this.tenantId,this.id,e,t)}}class Yn{constructor(e,t,n,r=(async()=>this.restWrapper),i=(()=>this.url)){this.url=e,this.restWrapper=t,this.logger=n,this.getRestWrapper=r,this.getDeltaStorageUrl=i}async get(e,t,n,r){return{messages:await h.Xr.timedExecAsync(this.logger,{eventName:"getDeltas",from:n,to:r},(async e=>{const t=await this.getRestWrapper(),i=this.getDeltaStorageUrl(),s=await t.get(i,{from:n-1,to:r});return e.end({count:s.length}),s})),partialResult:!1}}}var er=n(6144);class tr extends er.P{constructor(){super(...arguments),this.prefetchCache=new Map,this.prefetchEnabled=!0}get policies(){const e=this.internalStorageService.policies;if(e)return Object.assign(Object.assign({},e),{caching:tt.NoCaching})}async getSnapshotTree(e){const t=this.internalStorageService.getSnapshotTree(e);return this.prefetchEnabled&&t.then((e=>{null!=e&&this.prefetchTree(e)})),t}async readBlob(e){return this.cachedRead(e)}stopPrefetch(){this.prefetchEnabled=!1,this.prefetchCache.clear()}async cachedRead(e){if(this.prefetchEnabled){const t=this.prefetchCache.get(e);if(void 0!==t)return t;const n=this.internalStorageService.readBlob(e);return this.prefetchCache.set(e,n.catch((t=>{throw(0,O.ms)(t)&&this.prefetchCache.delete(e),t}))),n}return this.internalStorageService.readBlob(e)}prefetchTree(e){const t=[];this.prefetchTreeCore(e,t);for(const e of t)this.cachedRead(e)}prefetchTreeCore(e,t){for(const n of Object.keys(e.blobs)){const r=e.blobs[n];n.startsWith(".")||"header"===n||n.startsWith("quorum")?null!==r&&this.cachedRead(r):n.startsWith("deltas")||null!==r&&t.push(r)}for(const n of Object.keys(e.trees))this.prefetchTreeCore(e.trees[n],t)}}function nr(e,t){switch(t){case"base64":return Ce.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}const rr=(e,t)=>sr.from(e,t).buffer;function ir(e){const t=e;return e instanceof ArrayBuffer||"object"==typeof t&&null!==t&&"number"==typeof t.byteLength&&"function"==typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}class sr extends Uint8Array{toString(e){return nr(this,e)}static from(e,t,n){if("string"==typeof e)return sr.fromString(e,t);if(null!==e&&"object"==typeof e&&ir(e.buffer))return et(0===e.byteOffset,0),et(e.byteLength===e.buffer.byteLength,1),sr.fromArrayBuffer(e.buffer,t,n);if(ir(e))return sr.fromArrayBuffer(e,t,n);throw new TypeError}static fromArrayBuffer(e,t,n){const r=null!=t?t:0,i=null!=n?n:e.byteLength-r;if(r<0||r>e.byteLength||i<0||i+r>e.byteLength)throw new RangeError;return new sr(e,r,i)}static fromString(e,t){switch(t){case"base64":{const t=this.sanitizeBase64(e),n=Ce.toByteArray(t);return new sr(n.buffer)}case"utf8":case"utf-8":case void 0:{const t=(new TextEncoder).encode(e);return new sr(t.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!=0&&(t+=["","===","==","="][t.length%4]),t}}var or,ar=n(7384);class cr{constructor(e){this.props=e,this.attachmentCounter=0,this.summaryTree={}}get summary(){var e;return{type:x.Tree,tree:Object.assign({},this.summaryTree),unreferenced:null===(e=this.props)||void 0===e?void 0:e.unreferenced}}addBlob(e,t){this.summaryTree[e]={type:x.Blob,content:t}}addHandle(e,t,n){this.summaryTree[e]={type:x.Handle,handleType:t,handle:n}}addTree(e,t){this.summaryTree[e]=t}addAttachment(e){this.summaryTree[this.attachmentCounter++]={id:e,type:x.Attachment}}}function lr(e,t){const n=new cr({unreferenced:e.unreferenced});for(const[r,i]of Object.entries(e.blobs)){const e=t.get(i);(0,nt.h)(void 0!==e,733),n.addBlob(r,ar.pv.from(e).toString("utf-8"))}for(const[r,i]of Object.entries(e.trees)){const e=lr(i,t);n.addTree(r,e)}return n.summary}function ur(e,t="Unreachable Case"){throw new Error(t)}!function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(or||(or={}));const hr=(...e)=>e.map((e=>e.replace(/^\//,"").replace(/\/$/,""))).filter((e=>!!e)).join("/");function dr(e,t,n="",r=""){const i={type:"tree",entries:[]},s=Object.keys(t.tree);for(const o of s){const s=t.tree[o];let a,c,l;const u=hr(""===n?r:n,o);switch(s.type){case or.Tree:c=dr(e,s,u,r),l=s.unreferenced||void 0;break;case or.Blob:c="string"==typeof s.content?{type:"blob",content:s.content,encoding:"utf-8"}:{type:"blob",content:st(s.content,"base64"),encoding:"base64"};break;case or.Handle:if(s.embedded)a=s.handle;else{if(!e)throw Error("Parent summary does not exist to reference by handle.");a=hr(e,r,s.handle)}break;case or.Attachment:a=s.id;break;default:ur(0,`Unknown type: ${s.type}`)}const h={path:encodeURIComponent(o),type:(0,Ct.FE)(s)};let d;if(c)it(void 0===a,173),d=Object.assign({value:c,unreferenced:l},h);else{if(!a)throw new Error(`Invalid tree entry for ${s.type}`);d=Object.assign(Object.assign({},h),{id:a})}i.entries.push(d)}return i}function pr(e,t=".app"){var n;const r=new Map;e.blobs&&e.blobs.forEach((e=>{var t,n,i;r.set(e.id,(n=e.content,i=null!==(t=e.encoding)&&void 0!==t?t:"utf-8",at.from(n,i).buffer))}));const i=null===(n=e.trees)||void 0===n?void 0:n[0],s=null==i?void 0:i.sequenceNumber,o=function(e,t){const n={},r={id:e.id,blobs:{},trees:{}};n[""]=r;for(const r of e.entries){const e=r.path.replace(new RegExp(`^${t}/`),""),i=e.lastIndexOf("/"),s=e.slice(0,Math.max(0,i)),o=e.slice(i+1),a=n[s];if("tree"===r.type){const t={blobs:{},trees:{},unreferenced:r.unreferenced};a.trees[decodeURIComponent(o)]=t,n[e]=t}else{if("blob"!==r.type)throw new Error("Unknown entry type!!");a.blobs[decodeURIComponent(o)]=r.id}}return r}(i,t);return{blobs:r,snapshotTree:o,sequenceNumber:s}}class fr{constructor(e){this.manager=e}async writeSummaryTree(e,t,n,r){const i=await this.writeSummaryTreeCore(t,e,n,null!=r?r:0);if(!i)throw new Error("Failed to write summary tree");return i}async writeSummaryTreeCore(e,t,n,r){const i={entries:dr(e,t,"","channel"===n?".app":"").entries,message:void 0,sequenceNumber:r,type:n};return this.manager.createSummary(i).then((e=>e.id))}}class gr{constructor(){this.cache=new Map}async get(e){return this.cache.get(e)}async put(e,t){this.cache.set(e,t)}}const mr="latest";class yr{constructor(e,t,n,r={},i,s=new gr,o=new gr,a,c=(async e=>e&&void 0!==this.noCacheGitManager?this.noCacheGitManager:this.manager)){this.id=e,this.manager=t,this.logger=n,this.policies=r,this.driverPolicies=i,this.blobCache=s,this.snapshotTreeCache=o,this.noCacheGitManager=a,this.getStorageManager=c,this.firstVersionsCall=!0}get repositoryUrl(){return""}async getSummaryUploadManager(){const e=await this.getStorageManager();return new fr(e)}async getVersions(e,t){var n;if(e!==this.id&&null!==e)return[{id:e,treeId:void 0}];if(this.firstVersionsCall&&1===t){this.firstVersionsCall=!1;const{id:e,snapshotTree:t}=(null===(n=this.driverPolicies)||void 0===n?void 0:n.enableDiscovery)?await this.fetchAndCacheSnapshotTree(mr,!0):await this.fetchAndCacheSnapshotTree(mr,!1);return[{id:e,treeId:t.id}]}const r=e||this.id;return(await h.Xr.timedExecAsync(this.logger,{eventName:"getVersions",versionId:r,count:t},(async()=>(await this.getStorageManager()).getCommits(r,t)))).map((e=>({date:e.commit.author.date,id:e.sha,treeId:e.commit.tree.sha})))}async getSnapshotTree(e){let t=e;if(!t){const e=await this.getVersions(this.id,1);if(0===e.length)return null;t=e[0]}return(await this.fetchAndCacheSnapshotTree(t.id)).snapshotTree}async readBlob(e){const t=await this.blobCache.get(this.getCacheKey(e));if(void 0!==t)return t;const n=await h.Xr.timedExecAsync(this.logger,{eventName:"readBlob",blobId:e},(async t=>{const n=await this.getStorageManager(),r=await n.getBlob(e);return t.end({size:r.size}),r})),r=rr(n.content,n.encoding);return await this.blobCache.put(this.getCacheKey(n.sha),r),r}async uploadSummaryWithContext(e,t){return await h.Xr.timedExecAsync(this.logger,{eventName:"uploadSummaryWithContext"},(async()=>{var n;return(await this.getSummaryUploadManager()).writeSummaryTree(e,null!==(n=t.ackHandle)&&void 0!==n?n:"","channel")}))}async downloadSummary(e){const t=await h.Xr.timedExecAsync(this.logger,{eventName:"getWholeFlatSummary",treeId:e.handle},(async t=>{var n;const r=await this.getStorageManager(),i=await r.getSummary(e.handle);return t.end({size:null===(n=i.trees[0])||void 0===n?void 0:n.entries.length}),i})),{blobs:n,snapshotTree:r}=pr(t,"");return lr(r,n)}async createBlob(e){const t=new Uint8Array(e);return h.Xr.timedExecAsync(this.logger,{eventName:"createBlob",size:t.length},(async e=>{const n=await this.getStorageManager(),r=await n.createBlob(nr(t,"base64"),"base64").then((e=>({id:e.sha,url:e.url})));return e.end({blobId:r.id}),r}))}async fetchAndCacheSnapshotTree(e,t){const n=await this.snapshotTreeCache.get(this.getCacheKey(e));if(void 0!==n)return{id:n.id,snapshotTree:n.snapshotTree};const r=await h.Xr.timedExecAsync(this.logger,{eventName:"getWholeFlatSummary",treeId:e},(async n=>{var r;const i=await this.getStorageManager(t),s=await i.getSummary(e);return n.end({size:null===(r=s.trees[0])||void 0===r?void 0:r.entries.length}),s})),i=pr(r),s=r.id,o=i.snapshotTree.id;et(void 0!==o,629);const a={id:s,snapshotTree:i.snapshotTree},c=[this.snapshotTreeCache.put(this.getCacheKey(o),a),this.initBlobCache(i.blobs)];return o!==e&&c.push(this.snapshotTreeCache.put(this.getCacheKey(e),a)),await Promise.all(c),a}async initBlobCache(e){const t=[];e.forEach(((e,n)=>{const r=this.getCacheKey(n);t.push(this.blobCache.put(r,e))})),await Promise.all(t)}getCacheKey(e){return`${this.id}:${e}`}}class vr{constructor(e,t,n){this.manager=e,this.blobsShaCache=t,this.getPreviousFullSnapshot=n}async writeSummaryTree(e,t,n,r){const i=await this.getPreviousFullSnapshot(t);return this.writeSummaryTreeCore(e,null!=i?i:void 0)}async writeSummaryTreeCore(e,t){const n=await Promise.all(Object.keys(e.tree).map((async n=>{const r=e.tree[n],i=await this.writeSummaryTreeObject(r,t);return{mode:(0,Ct.ZO)(r),path:encodeURIComponent(n),sha:i,type:(0,Ct.FE)(r)}})));return(await this.manager.createGitTree({tree:n})).sha}async writeSummaryTreeObject(e,t){switch(e.type){case or.Blob:return this.writeSummaryBlob(e.content);case or.Handle:if(void 0===t)throw Error("Parent summary does not exist to reference by handle.");return this.getIdFromPath(e.handleType,e.handle,t);case or.Tree:return this.writeSummaryTreeCore(e,t);case or.Attachment:return e.id;default:ur(0,`Unknown type: ${e.type}`)}}async writeSummaryBlob(e){const{parsedContent:t,encoding:r}="string"==typeof e?{parsedContent:e,encoding:"utf-8"}:{parsedContent:st(e,"base64"),encoding:"base64"},i=await async function(e){const t=`blob ${e.byteLength.toString()}${String.fromCharCode(0)}`;return async function(e,t="SHA-1",r="hex"){if(void 0===crypto.subtle)return n.e(564).then(n.bind(n,6715)).then((async n=>n.hashFile(e,t,r)));const i=await async function(e,t){const n=await crypto.subtle.digest(t,e);return new Uint8Array(n)}(e,t);return function(e,t){switch(t){case"hex":return Array.prototype.map.call(e,(e=>e.toString(16).padStart(2,"0"))).join("");case"base64":return Ce.fromByteArray(e)}}(i,r)}(at.from(t+e.toString()))}(at.from(t,r));return this.blobsShaCache.has(i)||(this.blobsShaCache.set(i,""),it(i===(await this.manager.createBlob(t,r)).sha,182)),i}getIdFromPath(e,t,n){const r=t.split("/").map((e=>decodeURIComponent(e)));return""===r[0]&&r.shift(),0===r.length?n.id:this.getIdFromPathCore(e,r,n)}getIdFromPathCore(e,t,n){var r;it(t.length>0,179);const i=t[0];if(1===t.length)switch(e){case or.Blob:{const e=n.blobs[i];return it(!!e,180),e}case or.Tree:{const e=null===(r=n.trees[i])||void 0===r?void 0:r.id;return it(!!e,181),e}default:throw Error(`Unexpected handle summary object type: "${e}".`)}return this.getIdFromPathCore(e,t.slice(1),n.trees[i])}}class br{constructor(e,t){this.internalGitManager=e,this.logger=t}async getHeader(e,t){return this.runWithRetry((async()=>this.internalGitManager.getHeader(e,t)),"gitManager_getHeader")}async getFullTree(e){return this.runWithRetry((async()=>this.internalGitManager.getFullTree(e)),"gitManager_getFullTree")}async getCommit(e){return this.runWithRetry((async()=>this.internalGitManager.getCommit(e)),"gitManager_getCommit")}async getCommits(e,t){return this.runWithRetry((async()=>this.internalGitManager.getCommits(e,t)),"gitManager_getCommits")}async getTree(e,t){return this.runWithRetry((async()=>this.internalGitManager.getTree(e,t)),"gitManager_getTree")}async getBlob(e){return this.runWithRetry((async()=>this.internalGitManager.getBlob(e)),"gitManager_getBlob")}getRawUrl(e){return this.internalGitManager.getRawUrl(e)}async getContent(e,t){return this.runWithRetry((async()=>this.internalGitManager.getContent(e,t)),"gitManager_getContent")}async createBlob(e,t){return this.runWithRetry((async()=>this.internalGitManager.createBlob(e,t)),"gitManager_createBlob")}async createGitTree(e){return this.runWithRetry((async()=>this.internalGitManager.createGitTree(e)),"gitManager_createGitTree")}async createTree(e){return this.runWithRetry((async()=>this.internalGitManager.createTree(e)),"gitManager_createTree")}async createCommit(e){return this.runWithRetry((async()=>this.internalGitManager.createCommit(e)),"gitManager_createCommit")}async getRef(e){return this.runWithRetry((async()=>this.internalGitManager.getRef(e)),"gitManager_getRef")}async createRef(e,t){return this.runWithRetry((async()=>this.internalGitManager.createRef(e,t)),"gitManager_createRef")}async upsertRef(e,t){return this.runWithRetry((async()=>this.internalGitManager.upsertRef(e,t)),"gitManager_upsertRef")}async write(e,t,n,r){return this.runWithRetry((async()=>this.internalGitManager.write(e,t,n,r)),"gitManager_write")}async createSummary(e){return this.runWithRetry((async()=>this.internalGitManager.createSummary(e)),"gitManager_createSummary")}async deleteSummary(e){return this.runWithRetry((async()=>this.internalGitManager.deleteSummary(e)),"gitManager_deleteSummary")}async getSummary(e){return this.runWithRetry((async()=>this.internalGitManager.getSummary(e)),"gitManager_getSummary")}async runWithRetry(e,t){return R(e,t,this.logger,{})}}const Sr="undefined"==typeof window;class wr{constructor(e,t,n,r={},i,s,o,a=(async()=>this.manager)){this.id=e,this.manager=t,this.logger=n,this.policies=r,this.getStorageManager=a,this.blobsShaCache=new Map,(!0===(null==i?void 0:i.enableRestLess)||Sr)&&(this.blobCache=null!=s?s:new gr,this.snapshotTreeCache=null!=o?o:new gr)}get repositoryUrl(){return""}async getSummaryUploadManager(){const e=await this.getStorageManager();return new vr(new br(e,this.logger),this.blobsShaCache,this.getPreviousFullSnapshot.bind(this))}async getVersions(e,t){const n=e||this.id;return(await h.Xr.timedExecAsync(this.logger,{eventName:"getVersions",versionId:n,count:t},(async()=>(await this.getStorageManager()).getCommits(n,t)))).map((e=>({date:e.commit.author.date,id:e.sha,treeId:e.commit.tree.sha})))}async getSnapshotTree(e){var t,n;let r=e;if(!r){const e=await this.getVersions(this.id,1);if(0===e.length)return null;r=e[0]}const i=await(null===(t=this.snapshotTreeCache)||void 0===t?void 0:t.get(this.getCacheKey(r.treeId)));if(i)return i.snapshotTree;const s=await h.Xr.timedExecAsync(this.logger,{eventName:"getSnapshotTree",treeId:r.treeId},(async e=>{const t=await this.getStorageManager(),n=await t.getTree(r.treeId);return e.end({size:n.tree.length}),n})),o=(0,Ct.eB)(s,this.blobsShaCache,!0);return await(null===(n=this.snapshotTreeCache)||void 0===n?void 0:n.put(this.getCacheKey(o.id),{id:r.id,snapshotTree:o})),o}async readBlob(e){var t,n;const r=await(null===(t=this.blobCache)||void 0===t?void 0:t.get(this.getCacheKey(e)));if(r)return r;const i=await h.Xr.timedExecAsync(this.logger,{eventName:"readBlob",blobId:e},(async t=>{const n=await this.getStorageManager(),r=await n.getBlob(e);return t.end({size:r.size}),r}));this.blobsShaCache.set(i.sha,"");const s=rr(i.content,i.encoding);return await(null===(n=this.blobCache)||void 0===n?void 0:n.put(this.getCacheKey(i.sha),s)),s}async uploadSummaryWithContext(e,t){return await h.Xr.timedExecAsync(this.logger,{eventName:"uploadSummaryWithContext"},(async()=>{var n;return(await this.getSummaryUploadManager()).writeSummaryTree(e,null!==(n=t.ackHandle)&&void 0!==n?n:"","channel")}))}async downloadSummary(e){throw new Error("NOT IMPLEMENTED!")}async createBlob(e){const t=new Uint8Array(e);return h.Xr.timedExecAsync(this.logger,{eventName:"createBlob",size:t.length},(async e=>{const n=await this.getStorageManager(),r=await n.createBlob(nr(t,"base64"),"base64").then((e=>({id:e.sha,url:e.url})));return e.end({blobId:r.id}),r}))}async getPreviousFullSnapshot(e){return e?this.getVersions(e,1).then((async e=>(this.blobsShaCache.clear(),this.getSnapshotTree(e[0])))):void 0}getCacheKey(e){return`${this.id}:${e}`}}class xr extends er.P{constructor(e,t,n,r={},i,s,o,a,c){super(xr.loadInternalDocumentStorageService(e,t,n,r,i,s,o,a,c)),this.id=e,this.manager=t,this.noCacheGitManager=a,this._logTailSha=void 0}get logTailSha(){return this._logTailSha}static loadInternalDocumentStorageService(e,t,n,r,i,s,o,a,c){const l=(null==i?void 0:i.enableWholeSummaryUpload)?new yr(e,t,n,r,i,s,o,a,c):new wr(e,t,n,r,i,s,o,c);return(null==i?void 0:i.enableWholeSummaryUpload)||r.caching!==tt.Prefetch?l:new tr(l)}async getSnapshotTree(e){const t=await this.internalStorageService.getSnapshotTree(e);return null!==t&&(this._logTailSha=".logTail"in t.trees?t.trees[".logTail"].blobs.logTail:void 0),t}}function Cr(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}var Er;!function(e){e.DocRead="doc:read",e.DocWrite="doc:write",e.SummaryWrite="summary:write"}(Er||(Er={}));const Tr="1.3.7";class Ar extends Z.M{constructor(e,t,n,r=!1){super(((e,t)=>{n.sendErrorEvent({eventName:"DeltaConnection:EventException",name:e},t)})),this.socket=e,this.documentId=t,this.enableLongPollingDowngrades=r,this.queuedMessages=[],this.queuedSignals=[],this.earlyOpHandlerAttached=!1,this.connectionListeners=new Map,this.trackedListeners=new Map,this._disposed=!1,this.earlyOpHandler=(e,t)=>{this.queuedMessages.push(...t)},this.earlySignalHandler=e=>{this.queuedSignals.push(e)},this.mc=(0,l.rZ)(h.G2.create(n,"DeltaConnection")),this.on("newListener",((e,t)=>{if(Cr(!this.disposed,522),Ar.eventsAlwaysForwarded.includes(e))Cr(this.trackedListeners.has(e),581);else{if(!Ar.eventsToForward.includes(e))throw new Error(`DocumentDeltaConnection: Registering for unknown event: ${e}`);Cr(0!==this.listeners(e).length===this.trackedListeners.has(e),523),this.trackedListeners.has(e)||this.addTrackedListener(e,((...t)=>{this.emit(e,...t)}))}}))}get hasDetails(){return!!this._details}get disposed(){return Cr(this._disposed||this.socket.connected,580),this._disposed}get logger(){return this.mc.logger}get details(){if(!this._details)throw new Error("Internal error: calling method before _details is initialized!");return this._details}get clientId(){return this.details.clientId}get mode(){return this.details.mode}get claims(){return this.details.claims}get existing(){return this.details.existing}get maxMessageSize(){return this.details.serviceConfiguration.maxMessageSize}get version(){return this.details.version}get serviceConfiguration(){return this.details.serviceConfiguration}checkNotClosed(){Cr(!this.disposed,524)}get initialMessages(){return this.checkNotClosed(),Cr(this.earlyOpHandlerAttached,142),Cr(0!==this.listeners("op").length,143),this.removeEarlyOpHandler(),this.queuedMessages.length>0&&(this.details.initialMessages.push(...this.queuedMessages),this.details.initialMessages.sort(((e,t)=>e.sequenceNumber-t.sequenceNumber)),this.queuedMessages.length=0),this.details.initialMessages}get initialSignals(){return this.checkNotClosed(),Cr(0!==this.listeners("signal").length,144),this.removeEarlySignalHandler(),this.queuedSignals.length>0&&(this.details.initialSignals.push(...this.queuedSignals),this.queuedSignals.length=0),this.details.initialSignals}get initialClients(){return this.checkNotClosed(),this.details.initialClients}emitMessages(e,t){this.disposed||this.socket.emit(e,this.clientId,t)}submitCore(e,t){this.emitMessages(e,[t])}submit(e){this.checkNotClosed(),this.submitCore("submitOp",e)}submitSignal(e){this.checkNotClosed(),this.submitCore("submitSignal",[e])}dispose(){this.disposeCore(!1,(0,O.jx)("Client closing delta connection",{canRetry:!0},{driverVersion:Tr}))}disposeCore(e,t){this._disposed||(this._disposed=!0,this.removeTrackedListeners(),this.disconnect(e,t))}disconnect(e,t){this.socket.disconnect()}async initialize(e,t){this.socket.on("op",this.earlyOpHandler),this.socket.on("signal",this.earlySignalHandler),this.earlyOpHandlerAttached=!0;let n=0;const r=()=>this.socket.io.reconnection(),i=()=>r()?this.socket.io.reconnectionAttempts():0;this._details=await new Promise(((s,o)=>{const a=(e,t)=>{this.disposeCore(e,t),o(t)};this.addConnectionListener("connect_error",(e=>{var t;n++;let s=!1;try{const t=null==e?void 0:e.description;t&&"object"==typeof t&&("TransportError"===e.type&&(s=!0),t.target=void 0)}catch(e){}s&&this.enableLongPollingDowngrades&&"polling"!==(null===(t=this.socket.io.opts.transports)||void 0===t?void 0:t[0])&&(this.socket.io.opts.transports=["polling","websocket"],r()||(this.socket.io.reconnection(!0),this.socket.io.reconnectionAttempts(1))),r()&&n<i()+1||a(!0,this.createErrorObject("connect_error",e))})),this.addConnectionListener("connect_timeout",(()=>{a(!0,this.createErrorObject("connect_timeout"))})),this.addConnectionListener("connect_document_success",(t=>{if(void 0!==e.nonce&&void 0!==t.nonce&&t.nonce!==e.nonce)return;const n=e.mode,r=t.mode;if(t.claims.scopes.includes(Er.DocWrite)){if(r!==n)return void a(!1,this.createErrorObject("connect_document_success","Connected in a different mode than was requested",!1))}else if("write"===r)return void a(!1,this.createErrorObject("connect_document_success","Connected in write mode without write permissions",!1));this.checkpointSequenceNumber=t.checkpointSequenceNumber,this.removeConnectionListeners(),s(t)})),this.addTrackedListener("disconnect",(e=>{const t=this.createErrorObject("disconnect",e);this.emit("disconnect",t),a(!0,t)})),this.addTrackedListener("error",(e=>{const t=this.createErrorObject("error",e,"Invalid namespace"!==e);this.emit("error",t),a(!0,t)})),this.addConnectionListener("connect_document_error",(t=>{void 0!==e.nonce&&void 0!==t.nonce&&t.nonce!==e.nonce||a(!1,this.createErrorObject("connect_document_error",t))})),this.socket.emit("connect_document",e),this.socketConnectionTimeout=setTimeout((()=>{a(!1,this.createErrorObject("orderingServiceHandshakeTimeout"))}),t+2e3)})),Cr(!this.disposed,582)}removeEarlyOpHandler(){this.socket.removeListener("op",this.earlyOpHandler),this.earlyOpHandlerAttached=!1}removeEarlySignalHandler(){this.socket.removeListener("signal",this.earlySignalHandler)}addConnectionListener(e,t){Cr(!Ar.eventsAlwaysForwarded.includes(e),583),Cr(!Ar.eventsToForward.includes(e),584),this.socket.on(e,t),Cr(!this.connectionListeners.has(e),525),this.connectionListeners.set(e,t)}addTrackedListener(e,t){this.socket.on(e,t),Cr(!this.trackedListeners.has(e),526),this.trackedListeners.set(e,t)}removeTrackedListeners(){for(const[e,t]of this.trackedListeners.entries())this.socket.off(e,t);this.removeConnectionListeners(),this.removeEarlyOpHandler(),this.removeEarlySignalHandler(),this.trackedListeners.clear()}removeConnectionListeners(){void 0!==this.socketConnectionTimeout&&clearTimeout(this.socketConnectionTimeout);for(const[e,t]of this.connectionListeners.entries())this.socket.off(e,t);this.connectionListeners.clear()}createErrorObject(e,t,n=!0){let r;return r="TransportError"===(null==t?void 0:t.type)?`${void 0!==(null==t?void 0:t.message)?`${t.message}: `:""}${JSON.stringify(t,(0,ee.fd)())}`:function(e){const t={message:"string"==typeof(null==e?void 0:e.message)?e.message:String(e)};if((e=>null!==e&&!Array.isArray(e)&&"object"==typeof e)(e)){const{errorType:n,stack:r,name:i}=e;if("string"==typeof n&&(t.errorType=n),"string"==typeof r){const e="string"==typeof i?i:void 0;t.stack=((e,t)=>{const n=e.split("\n");return n.shift(),void 0!==t&&n.unshift(t),n.join("\n")})(r,e)}}return t}(t).message,(0,O.jx)(`socket.io (${e}): ${r}`,{canRetry:n},{driverVersion:Tr})}}Ar.eventsToForward=["nack","op","signal","pong"],Ar.eventsAlwaysForwarded=["disconnect","error"];const kr="1.3.7";var Nr;function Or(e,t,n){const r={statusCode:t,driverVersion:kr};switch(t){case void 0:return new O.Xp(e,e.startsWith("NetworkError"),r);case 401:case 403:return new O.M_(e,void 0,void 0,r);case 404:const t=Nr.fileNotFoundOrAccessDeniedError;return new O.V2(e,t,r);case 429:return(0,O.jx)(e,{canRetry:!0,retryAfterMs:n},r);case 500:case 502:return new O.Xp(e,!0,r);default:const i={canRetry:void 0!==n,retryAfterMs:n};return(0,O.jx)(e,i,r)}}function Pr(e,t,n){throw Or(e,t,n)}!function(e){e.fileNotFoundOrAccessDeniedError="fileNotFoundOrAccessDeniedError"}(Nr||(Nr={}));const Rr=["^0.4.0","^0.3.0","^0.2.0","^0.1.0"];class Ir extends Ar{static async create(e,t,n,r,i,s,o,a=2e4){const c=r(s,{query:{documentId:t,tenantId:e},reconnection:!1,transports:["websocket"],timeout:a}),l={client:i,id:t,mode:i.mode,tenantId:e,token:n,versions:Rr,relayUserAgent:[i.details.environment,` driverVersion:${kr}`].join(";")},u=new Ir(c,t,o,!0);return await u.initialize(l,a),u}createErrorObject(e,t,n=!0){return n&&Number.isInteger(null==t?void 0:t.code)&&"string"==typeof(null==t?void 0:t.message)?function(e,t){return Or(`R11s socket error (${t}): ${e.message}`,e.code,e.retryAfterMs)}(t,e):super.createErrorObject(e,t,n)}}class Fr{get repositoryUrl(){throw new Error("Invalid operation")}async getSnapshotTree(e){return e?Promise.reject(new Error("Invalid operation")):null}async getVersions(e,t){return[]}async uploadSummaryWithContext(e,t){return Promise.reject(new Error("Invalid operation"))}async downloadSummary(e){return Promise.reject(new Error("Invalid operation"))}async createBlob(e){return Promise.reject(new Error("Null blob storage can not create blob"))}async readBlob(e){return Promise.reject(new Error("Null blob storage can not read blob"))}}var Dr;!function(e){e.Method="method",e.Header="header",e.Body="body"}(Dr||(Dr={}));const Mr=(e,t)=>`${e}: ${t}`;class Lr{translate(e){var t,n;const r=Object.assign({},e),i=new URLSearchParams;if(i.append(Dr.Method,null!==(t=r.method)&&void 0!==t?t:"GET"),r.headers)for(const[e,t]of Object.entries(r.headers)){const n=Mr(e,t);i.append(Dr.Header,n)}if(r.data&&["post","put","patch"].includes(null===(n=r.method)||void 0===n?void 0:n.toLowerCase())){const e=JSON.stringify(r.data);i.append(Dr.Body,e)}return r.data=i.toString(),r.method="POST",r.headers={"Content-Type":"application/x-www-form-urlencoded;restless"},r}}var _r,qr=n(4098),Br=n.n(qr);class jr extends yt{constructor(e,t,n,r,i,s={}){super(i,s),this.rateLimiter=t,this.getAuthorizationHeader=n,this.useRestLess=r,this.restLess=new Lr}async load(){this.authorizationHeader=await this.getAuthorizationHeader()}async request(e,t,n=!0){var r;const i=Object.assign(Object.assign({},e),{headers:this.generateHeaders(e.headers)}),s=(e=>{var t,n;return[void 0!==e.baseURL?`${e.baseURL}${null!==(t=e.url)&&void 0!==t?t:""}`:null!==(n=e.url)&&void 0!==n?n:"",{method:e.method,headers:e.headers,body:e.data}]})(this.useRestLess?this.restLess.translate(i):i),o=await this.rateLimiter.schedule((async()=>Br()(...s).catch((async e=>{Pr(["TypeError","FetchError"].includes(null==e?void 0:e.name)?`NetworkError: ${e.message}`:ut()(e))})))),a=(null===(r=o.headers.get("content-type"))||void 0===r?void 0:r.includes("application/json"))?await o.json():await o.text();return o.ok||o.status===t?a:401===o.status&&n?(this.authorizationHeader=await this.getAuthorizationHeader(!0),this.request(i,t,!1)):429===o.status&&(null==a?void 0:a.retryAfter)>0?new Promise(((e,n)=>setTimeout((()=>{this.request(i,t).then(e).catch(n)}),1e3*a.retryAfter))):void Pr(`R11s fetch error: ${void 0!==a?"string"==typeof a?a:ut()(a):o.statusText}`,o.status,null==a?void 0:a.retryAfter)}generateHeaders(e){const t=(null==e?void 0:e["x-correlation-id"])||(0,a.Z)();return Object.assign(Object.assign({},e),{"x-correlation-id":t,"x-driver-version":kr,Authorization:this.authorizationHeader})}}class zr extends jr{constructor(e,t,n,r,i,s={}){super(e,t,n,r,i,s)}static async load(e,t,n,r,i,s,o){const a={token:`${c=e,sr.from(c,"utf8").toString("base64")}`};var c;const l=new zr(r,i,(async r=>(e=>{return`Basic ${t=`${e.user}:${e.password}`,at.from(t,"utf8").toString("base64")}`;var t})({password:(await n.fetchStorageToken(e,t,r)).jwt,user:e})),s,o,a);try{await l.load()}catch(e){r.sendErrorEvent({eventName:"R11sRestWrapperLoadFailure"},e),await l.load()}return l}}class Hr extends jr{constructor(e,t,n,r,i,s={}){super(e,t,n,r,i,s)}static async load(e,t,n,r,i,s,o){const a=new Hr(r,i,(async r=>`Basic ${(await n.fetchOrdererToken(e,t,r)).jwt}`),s,o);try{await a.load()}catch(e){r.sendErrorEvent({eventName:"R11sRestWrapperLoadFailure"},e),await a.load()}return a}}class Ur{constructor(e,t,n,r,i,s,o,a,c,l,u,h){this._resolvedUrl=e,this.ordererUrl=t,this.deltaStorageUrl=n,this.storageUrl=r,this.logger=i,this.tokenProvider=s,this.tenantId=o,this.documentId=a,this.driverPolicies=c,this.blobCache=l,this.snapshotTreeCache=u,this.discoverFluidResolvedUrl=h,this.lastDiscoveredAt=Date.now()}get resolvedUrl(){return this._resolvedUrl}dispose(){}async connectToStorage(){if(void 0!==this.documentStorageService)return this.documentStorageService;if(void 0===this.storageUrl)return new Fr;const e=async e=>{const t=this.shouldUpdateDiscoveredSessionInfo();if(t&&await this.refreshDiscovery(),!this.storageManager||!this.noCacheStorageManager||t){const e=new rt(this.driverPolicies.maxConcurrentStorageRequests),t=await zr.load(this.tenantId,this.documentId,this.tokenProvider,this.logger,e,this.driverPolicies.enableRestLess,this.storageUrl),n=new St(this.storageUrl,!0,!1,t);this.storageManager=new Et(n);const r=new St(this.storageUrl,!0,!0,t);this.noCacheStorageManager=new Et(r)}return e?this.noCacheStorageManager:this.storageManager},t=await e(),n=await e(!0),r={caching:this.driverPolicies.enablePrefetch?tt.Prefetch:tt.NoCaching,minBlobSize:this.driverPolicies.aggregateBlobsSmallerThanBytes};return this.documentStorageService=new xr(this.documentId,t,this.logger,r,this.driverPolicies,this.blobCache,this.snapshotTreeCache,n,e),this.documentStorageService}async connectToDeltaStorage(){await this.connectToStorage(),et(!!this.documentStorageService,177);const e=async()=>{const e=this.shouldUpdateDiscoveredSessionInfo();if(e&&await this.refreshDiscovery(),!this.ordererRestWrapper||e){const e=new rt(this.driverPolicies.maxConcurrentOrdererRequests);this.ordererRestWrapper=await Hr.load(this.tenantId,this.documentId,this.tokenProvider,this.logger,e,this.driverPolicies.enableRestLess)}return this.ordererRestWrapper},t=await e(),n=new Yn(this.deltaStorageUrl,t,this.logger,e,(()=>this.deltaStorageUrl));return new Zn(this.tenantId,this.documentId,n,this.documentStorageService)}async connectToDeltaStream(e){const t=async t=>{this.shouldUpdateDiscoveredSessionInfo()&&await this.refreshDiscovery();const n=await this.tokenProvider.fetchOrdererToken(this.tenantId,this.documentId,t);return Ir.create(this.tenantId,this.documentId,n.jwt,Wn,e,this.ordererUrl,this.logger)};try{return await t()}catch(e){if(401===(null==e?void 0:e.statusCode))return t(!0);throw e}}async refreshDiscovery(){return this.discoverP||(this.discoverP=h.Xr.timedExecAsync(this.logger,{eventName:"refreshSessionDiscovery"},(async()=>this.refreshDiscoveryCore()))),this.discoverP}async refreshDiscoveryCore(){const e=await this.discoverFluidResolvedUrl();this._resolvedUrl=e,this.storageUrl=e.endpoints.storageUrl,this.ordererUrl=e.endpoints.ordererUrl,this.deltaStorageUrl=e.endpoints.deltaStorageUrl}shouldUpdateDiscoveredSessionInfo(){if(!this.driverPolicies.enableDiscovery)return!1;const e=Date.now()-this.lastDiscoveredAt>3e5;return e&&(this.lastDiscoveredAt=Date.now(),this.discoverP=void 0,this.refreshDiscovery().catch((()=>{this.lastDiscoveredAt=0}))),e}}function Vr(e){const t=Object.keys(e.tree);for(const n of t){const t=e.tree[n];switch(t.type){case _r.Tree:e.tree[n]=Vr(t);break;case _r.Blob:t.content="string"==typeof t.content?t.content:nr(t.content,"utf8");break;case _r.Handle:throw new Error("No handle should be present for first summary!!");default:throw new Error(`Unknown tree type ${t.type}`)}}return e}!function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(_r||(_r={}));var Gr=n(4564),Wr=n.n(Gr);const Kr=e=>new(Wr())(e,!0),$r=(e,t)=>e.split("/").slice(0,-1).concat([t]).join("/"),Jr=(e,t)=>{if(t){const n=new(Wr())(t.ordererUrl),r=new(Wr())(e.endpoints.deltaStorageUrl);r.set("host",n.host);const i=new(Wr())(t.historianUrl),s=new(Wr())(e.endpoints.storageUrl);s.set("host",i.host);const o=Kr(e.url);return{endpoints:{deltaStorageUrl:r.toString(),ordererUrl:t.ordererUrl,storageUrl:s.toString()},id:e.id,tokens:e.tokens,type:e.type,url:new(Wr())(`fluid://${n.host}${o.pathname}`).toString()}}return e},Qr={enablePrefetch:!0,maxConcurrentStorageRequests:100,maxConcurrentOrdererRequests:100,aggregateBlobsSmallerThanBytes:void 0,enableDiscovery:!1,enableWholeSummaryUpload:!1,enableRestLess:!0};class Xr{constructor(e,t={}){this.tokenProvider=e,this.protocolName="fluid:",this.blobCache=new gr,this.snapshotTreeCache=new gr,this.driverPolicies=Object.assign(Object.assign({},Qr),t)}async createContainer(e,t,n,r){if(p(t),void 0===e)throw new Error("Empty file summary creation isn't supported in this driver.");et(!!t.endpoints.ordererUrl,178);let i=Kr(t.url);if(!i.pathname)throw new Error("Parsed url should contain tenant and doc Id!!");const[,s]=i.pathname.split("/"),o=e.tree[".protocol"],a=e.tree[".app"];if(!o||!a)throw new Error("Protocol and App Summary required in the full summary");const c=function(e){var t;const n=e.tree.attributes,r=JSON.parse(n.content);return r.term=null!==(t=r.term)&&void 0!==t?t:1,r}(o),l=function(e){const t=e.tree.quorumValues;return JSON.parse(t.content)}(o),u=h.G2.create(n,"RouterliciousDriver"),d=new rt(this.driverPolicies.maxConcurrentOrdererRequests),f=await Hr.load(s,void 0,this.tokenProvider,u,d,this.driverPolicies.enableRestLess,t.endpoints.ordererUrl),g=await f.post(`/documents/${s}`,{summary:Vr(a),sequenceNumber:c.sequenceNumber,values:l,enableDiscovery:this.driverPolicies.enableDiscovery,generateToken:void 0!==this.tokenProvider.documentPostCreateCallback});let m,y,v;if("string"==typeof g?m=g:(m=g.id,y=g.token,v=this.driverPolicies.enableDiscovery?g.session:void 0),i=Kr(t.url),y&&void 0!==this.tokenProvider.documentPostCreateCallback)try{await this.tokenProvider.documentPostCreateCallback(m,y)}catch(e){throw new Zr(e)}i.set("pathname",$r(i.pathname,m));const b=t.endpoints.deltaStorageUrl;if(!b)throw new Error(`All endpoints urls must be provided. [deltaStorageUrl:${b}]`);const S=new URL(b);return S.pathname=$r(S.pathname,m),this.createDocumentService(Object.assign(Object.assign({},t),{url:i.toString(),id:m,endpoints:Object.assign(Object.assign({},t.endpoints),{deltaStorageUrl:S.toString()})}),n,r,v)}async createDocumentService(e,t,n,r){p(e);const i=Kr(e.url),[,s,o]=i.pathname.split("/");if(!o||!s)throw new Error(`Couldn't parse documentId and/or tenantId. [documentId:${o}][tenantId:${s}]`);const a=h.G2.create(t,"RouterliciousDriver",{all:{driverVersion:kr}}),c=async()=>{if(!this.driverPolicies.enableDiscovery)return e;const t=new rt(this.driverPolicies.maxConcurrentOrdererRequests),n=await Hr.load(s,o,this.tokenProvider,a,t,this.driverPolicies.enableRestLess,e.endpoints.ordererUrl),r=await n.get(`/documents/${s}/session/${o}`);return Jr(e,r)},l=void 0!==r?Jr(e,r):await c(),u=l.endpoints.storageUrl,d=l.endpoints.ordererUrl,f=l.endpoints.deltaStorageUrl;if(!d||!f)throw new Error(`All endpoints urls must be provided. [ordererUrl:${d}][deltaStorageUrl:${f}]`);return new Ur(l,d,f,u,a,this.tokenProvider,s,o,this.driverPolicies,this.blobCache,this.snapshotTreeCache,c)}}class Zr extends Error{constructor(e){super(e.message),this.innerError=e,this.name="DocumentPostCreateError"}get stack(){return this.innerError.stack}}var Yr=n(9703),ei=n(5761);class ti{constructor(){}async resolve(e){const{ordererUrl:t,storageUrl:n,tenantId:r,containerId:i}=function(e){const t=new URL(e),n=t.origin,r=t.searchParams,i=r.get("storage");if(null===i)throw new Error("Azure URL did not contain a storage URL");const s=r.get("tenantId");if(null===s)throw new Error("Azure URL did not contain a tenant ID");const o=decodeURIComponent(i),a=decodeURIComponent(s),c=r.get("containerId");return{ordererUrl:n,storageUrl:o,tenantId:a,containerId:null!==c?decodeURIComponent(c):void 0}}(e.url);if(e.headers&&!0===e.headers[ei.i.createNew])return{endpoints:{deltaStorageUrl:`${t}/deltas/${r}/new`,ordererUrl:t,storageUrl:`${n}/repos/${r}`},id:"",tokens:{},type:"fluid",url:`${t}/${r}/new`};if(void 0===i)throw new Error("Azure URL did not contain containerId");return{endpoints:{deltaStorageUrl:`${t}/deltas/${r}/${i}`,ordererUrl:t,storageUrl:`${n}/repos/${r}`},id:i,tokens:{},type:"fluid",url:`${t}/${r}/${i}`}}async getAbsoluteUrl(e,t){if("fluid"!==e.type)throw new Error("Invalid Resolved Url");return`${e.url}/${t}`}}function ni(e){return"remote"===e.type}const ri=e=>ni(e)?e.tenantId:"local";class ii{constructor(e){this.props=e,e.connection.endpoint=e.connection.endpoint.replace(/\/$/,""),this.urlResolver=new ti;const t=ni(this.props.connection);this.documentServiceFactory=new Xr(this.props.connection.tokenProvider,{enableWholeSummaryUpload:t,enableDiscovery:t})}async createContainer(e){const t=this.createLoader(e),n=await t.createDetachedContainer({package:"no-dynamic-package",config:{}});return{container:await this.createFluidContainer(n,this.props.connection),services:this.getContainerServices(n)}}async copyContainer(e,t,n){var r;const i=this.createLoader(t),s=new URL(this.props.connection.endpoint);s.searchParams.append("storage",encodeURIComponent(this.props.connection.endpoint)),s.searchParams.append("tenantId",encodeURIComponent(ri(this.props.connection))),s.searchParams.append("containerId",encodeURIComponent(e));const o=await i.resolve({url:s.href});if(void 0===o.resolvedUrl)throw new Error("Source container cannot resolve URL.");const a=await this.documentServiceFactory.createDocumentService(o.resolvedUrl),c=await a.connectToStorage(),l={type:Xe.Handle,handleType:Xe.Tree,handle:null!==(r=null==n?void 0:n.id)&&void 0!==r?r:"latest"},u=await c.downloadSummary(l),h=await i.rehydrateDetachedContainerFromSnapshot(JSON.stringify(u));return{container:await this.createFluidContainer(h,this.props.connection),services:this.getContainerServices(h)}}async getContainer(e,t){const n=this.createLoader(t),r=new URL(this.props.connection.endpoint);r.searchParams.append("storage",encodeURIComponent(this.props.connection.endpoint)),r.searchParams.append("tenantId",encodeURIComponent(ri(this.props.connection))),r.searchParams.append("containerId",encodeURIComponent(e));const i=await n.resolve({url:r.href}),s=await(0,Yr.bb)(i,"/");return{container:new Ze.G(i,s),services:this.getContainerServices(i)}}async getContainerVersions(e,t){var n;const r=new URL(this.props.connection.endpoint);r.searchParams.append("storage",encodeURIComponent(this.props.connection.endpoint)),r.searchParams.append("tenantId",encodeURIComponent(ri(this.props.connection))),r.searchParams.append("containerId",encodeURIComponent(e));const i=await this.urlResolver.resolve({url:r.href});if(!i)throw new Error("Unable to resolved URL");const s=await this.documentServiceFactory.createDocumentService(i),o=await s.connectToStorage();return(await o.getVersions(null,null!==(n=null==t?void 0:t.maxCount)&&void 0!==n?n:5)).map((e=>({id:e.id,date:e.date})))}getContainerServices(e){return{audience:new s(e)}}createLoader(e){const t=new Ye.Y(e),n={load:async()=>({module:{fluidExport:t},details:{package:"no-dynamic-package",config:{}}})};return new Qe({urlResolver:this.urlResolver,documentServiceFactory:this.documentServiceFactory,codeLoader:n,logger:this.props.logger})}async createFluidContainer(e,t){const n=((e,t)=>{const n=new URL(e);return n.searchParams.append("storage",encodeURIComponent(e)),n.searchParams.append("tenantId",encodeURIComponent(t)),{url:n.href,headers:{[ei.i.createNew]:!0}}})(t.endpoint,ri(t)),r=await(0,Yr.bb)(e,"/"),i=new Ze.G(e,r);return i.attach=async()=>{if(e.attachState!==o.mB.Detached)throw new Error("Cannot attach container. Container is not in detached state");await e.attach(n);const t=e.resolvedUrl;return p(t),t.id},i}}var si,oi=n(4458),ai=n.n(oi);class ci{constructor(e,t){this.azFunctionUrl=e,this.user=t}async fetchOrdererToken(e,t){return{jwt:await this.getToken(e,t)}}async fetchStorageToken(e,t){return{jwt:await this.getToken(e,t)}}async getToken(e,t){var n,r,i;return(await ai().get(this.azFunctionUrl,{params:{tenantId:e,documentId:t,userId:null===(n=this.user)||void 0===n?void 0:n.userId,userName:null===(r=this.user)||void 0===r?void 0:r.userName,additionalDetails:null===(i=this.user)||void 0===i?void 0:i.additionalDetails}})).data}}!function(e){e.DocRead="doc:read",e.DocWrite="doc:write",e.SummaryWrite="summary:write"}(si||(si={}))},4458:(e,t,n)=>{e.exports=n(9224)},3429:(e,t,n)=>{"use strict";var r=n(3739),i=n(8044),s=n(4017),o=n(4081),a=n(6022),c=n(1885),l=n(8734),u=n(2726);e.exports=function(e){return new Promise((function(t,n){var h=e.data,d=e.headers,p=e.responseType;r.isFormData(h)&&delete d["Content-Type"];var f=new XMLHttpRequest;if(e.auth){var g=e.auth.username||"",m=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";d.Authorization="Basic "+btoa(g+":"+m)}var y=a(e.baseURL,e.url);function v(){if(f){var r="getAllResponseHeaders"in f?c(f.getAllResponseHeaders()):null,s={data:p&&"text"!==p&&"json"!==p?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:r,config:e,request:f};i(t,n,s),f=null}}if(f.open(e.method.toUpperCase(),o(y,e.params,e.paramsSerializer),!0),f.timeout=e.timeout,"onloadend"in f?f.onloadend=v:f.onreadystatechange=function(){f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))&&setTimeout(v)},f.onabort=function(){f&&(n(u("Request aborted",e,"ECONNABORTED",f)),f=null)},f.onerror=function(){n(u("Network Error",e,null,f)),f=null},f.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(u(t,e,e.transitional&&e.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",f)),f=null},r.isStandardBrowserEnv()){var b=(e.withCredentials||l(y))&&e.xsrfCookieName?s.read(e.xsrfCookieName):void 0;b&&(d[e.xsrfHeaderName]=b)}"setRequestHeader"in f&&r.forEach(d,(function(e,t){void 0===h&&"content-type"===t.toLowerCase()?delete d[t]:f.setRequestHeader(t,e)})),r.isUndefined(e.withCredentials)||(f.withCredentials=!!e.withCredentials),p&&"json"!==p&&(f.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&f.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&f.upload&&f.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){f&&(f.abort(),n(e),f=null)})),h||(h=null),f.send(h)}))}},9224:(e,t,n)=>{"use strict";var r=n(3739),i=n(6956),s=n(2647),o=n(4652);function a(e){var t=new s(e),n=i(s.prototype.request,t);return r.extend(n,s.prototype,t),r.extend(n,t),n}var c=a(n(6397));c.Axios=s,c.create=function(e){return a(o(c.defaults,e))},c.Cancel=n(4770),c.CancelToken=n(9340),c.isCancel=n(2427),c.all=function(e){return Promise.all(e)},c.spread=n(4766),c.isAxiosError=n(837),e.exports=c,e.exports.default=c},4770:e=>{"use strict";function t(e){this.message=e}t.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},t.prototype.__CANCEL__=!0,e.exports=t},9340:(e,t,n)=>{"use strict";var r=n(4770);function i(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;e((function(e){n.reason||(n.reason=new r(e),t(n.reason))}))}i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.source=function(){var e;return{token:new i((function(t){e=t})),cancel:e}},e.exports=i},2427:e=>{"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},2647:(e,t,n)=>{"use strict";var r=n(3739),i=n(4081),s=n(3767),o=n(2896),a=n(4652),c=n(4584),l=c.validators;function u(e){this.defaults=e,this.interceptors={request:new s,response:new s}}u.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=a(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=e.transitional;void 0!==t&&c.assertOptions(t,{silentJSONParsing:l.transitional(l.boolean,"1.0.0"),forcedJSONParsing:l.transitional(l.boolean,"1.0.0"),clarifyTimeoutError:l.transitional(l.boolean,"1.0.0")},!1);var n=[],r=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(r=r&&t.synchronous,n.unshift(t.fulfilled,t.rejected))}));var i,s=[];if(this.interceptors.response.forEach((function(e){s.push(e.fulfilled,e.rejected)})),!r){var u=[o,void 0];for(Array.prototype.unshift.apply(u,n),u=u.concat(s),i=Promise.resolve(e);u.length;)i=i.then(u.shift(),u.shift());return i}for(var h=e;n.length;){var d=n.shift(),p=n.shift();try{h=d(h)}catch(e){p(e);break}}try{i=o(h)}catch(e){return Promise.reject(e)}for(;s.length;)i=i.then(s.shift(),s.shift());return i},u.prototype.getUri=function(e){return e=a(this.defaults,e),i(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},r.forEach(["delete","get","head","options"],(function(e){u.prototype[e]=function(t,n){return this.request(a(n||{},{method:e,url:t,data:(n||{}).data}))}})),r.forEach(["post","put","patch"],(function(e){u.prototype[e]=function(t,n,r){return this.request(a(r||{},{method:e,url:t,data:n}))}})),e.exports=u},3767:(e,t,n)=>{"use strict";var r=n(3739);function i(){this.handlers=[]}i.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},i.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},i.prototype.forEach=function(e){r.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=i},6022:(e,t,n)=>{"use strict";var r=n(289),i=n(3163);e.exports=function(e,t){return e&&!r(t)?i(e,t):t}},2726:(e,t,n)=>{"use strict";var r=n(8160);e.exports=function(e,t,n,i,s){var o=new Error(e);return r(o,t,n,i,s)}},2896:(e,t,n)=>{"use strict";var r=n(3739),i=n(8513),s=n(2427),o=n(6397);function a(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return a(e),e.headers=e.headers||{},e.data=i.call(e,e.data,e.headers,e.transformRequest),e.headers=r.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),r.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||o.adapter)(e).then((function(t){return a(e),t.data=i.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return s(t)||(a(e),t&&t.response&&(t.response.data=i.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},8160:e=>{"use strict";e.exports=function(e,t,n,r,i){return e.config=t,n&&(e.code=n),e.request=r,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}},4652:(e,t,n)=>{"use strict";var r=n(3739);e.exports=function(e,t){t=t||{};var n={},i=["url","method","data"],s=["headers","auth","proxy","params"],o=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],a=["validateStatus"];function c(e,t){return r.isPlainObject(e)&&r.isPlainObject(t)?r.merge(e,t):r.isPlainObject(t)?r.merge({},t):r.isArray(t)?t.slice():t}function l(i){r.isUndefined(t[i])?r.isUndefined(e[i])||(n[i]=c(void 0,e[i])):n[i]=c(e[i],t[i])}r.forEach(i,(function(e){r.isUndefined(t[e])||(n[e]=c(void 0,t[e]))})),r.forEach(s,l),r.forEach(o,(function(i){r.isUndefined(t[i])?r.isUndefined(e[i])||(n[i]=c(void 0,e[i])):n[i]=c(void 0,t[i])})),r.forEach(a,(function(r){r in t?n[r]=c(e[r],t[r]):r in e&&(n[r]=c(void 0,e[r]))}));var u=i.concat(s).concat(o).concat(a),h=Object.keys(e).concat(Object.keys(t)).filter((function(e){return-1===u.indexOf(e)}));return r.forEach(h,l),n}},8044:(e,t,n)=>{"use strict";var r=n(2726);e.exports=function(e,t,n){var i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(r("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)}},8513:(e,t,n)=>{"use strict";var r=n(3739),i=n(6397);e.exports=function(e,t,n){var s=this||i;return r.forEach(n,(function(n){e=n.call(s,e,t)})),e}},6397:(e,t,n)=>{"use strict";var r=n(3739),i=n(2366),s=n(8160),o={"Content-Type":"application/x-www-form-urlencoded"};function a(e,t){!r.isUndefined(e)&&r.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var c,l={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(c=n(3429)),c),transformRequest:[function(e,t){return i(t,"Accept"),i(t,"Content-Type"),r.isFormData(e)||r.isArrayBuffer(e)||r.isBuffer(e)||r.isStream(e)||r.isFile(e)||r.isBlob(e)?e:r.isArrayBufferView(e)?e.buffer:r.isURLSearchParams(e)?(a(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):r.isObject(e)||t&&"application/json"===t["Content-Type"]?(a(t,"application/json"),function(e,t,n){if(r.isString(e))try{return(0,JSON.parse)(e),r.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional,n=t&&t.silentJSONParsing,i=t&&t.forcedJSONParsing,o=!n&&"json"===this.responseType;if(o||i&&r.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(o){if("SyntaxError"===e.name)throw s(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};r.forEach(["delete","get","head"],(function(e){l.headers[e]={}})),r.forEach(["post","put","patch"],(function(e){l.headers[e]=r.merge(o)})),e.exports=l},6956:e=>{"use strict";e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}}},4081:(e,t,n)=>{"use strict";var r=n(3739);function i(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,n){if(!t)return e;var s;if(n)s=n(t);else if(r.isURLSearchParams(t))s=t.toString();else{var o=[];r.forEach(t,(function(e,t){null!=e&&(r.isArray(e)?t+="[]":e=[e],r.forEach(e,(function(e){r.isDate(e)?e=e.toISOString():r.isObject(e)&&(e=JSON.stringify(e)),o.push(i(t)+"="+i(e))})))})),s=o.join("&")}if(s){var a=e.indexOf("#");-1!==a&&(e=e.slice(0,a)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}},3163:e=>{"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},4017:(e,t,n)=>{"use strict";var r=n(3739);e.exports=r.isStandardBrowserEnv()?{write:function(e,t,n,i,s,o){var a=[];a.push(e+"="+encodeURIComponent(t)),r.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),r.isString(i)&&a.push("path="+i),r.isString(s)&&a.push("domain="+s),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},289:e=>{"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},837:e=>{"use strict";e.exports=function(e){return"object"==typeof e&&!0===e.isAxiosError}},8734:(e,t,n)=>{"use strict";var r=n(3739);e.exports=r.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function i(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=i(window.location.href),function(t){var n=r.isString(t)?i(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0}},2366:(e,t,n)=>{"use strict";var r=n(3739);e.exports=function(e,t){r.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))}},1885:(e,t,n)=>{"use strict";var r=n(3739),i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,n,s,o={};return e?(r.forEach(e.split("\n"),(function(e){if(s=e.indexOf(":"),t=r.trim(e.substr(0,s)).toLowerCase(),n=r.trim(e.substr(s+1)),t){if(o[t]&&i.indexOf(t)>=0)return;o[t]="set-cookie"===t?(o[t]?o[t]:[]).concat([n]):o[t]?o[t]+", "+n:n}})),o):o}},4766:e=>{"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},4584:(e,t,n)=>{"use strict";var r=n(2638),i={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){i[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));var s={},o=r.version.split(".");function a(e,t){for(var n=t?t.split("."):o,r=e.split("."),i=0;i<3;i++){if(n[i]>r[i])return!0;if(n[i]<r[i])return!1}return!1}i.transitional=function(e,t,n){var i=t&&a(t);function o(e,t){return"[Axios v"+r.version+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,r,a){if(!1===e)throw new Error(o(r," has been removed in "+t));return i&&!s[r]&&(s[r]=!0,console.warn(o(r," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,r,a)}},e.exports={isOlderVersion:a,assertOptions:function(e,t,n){if("object"!=typeof e)throw new TypeError("options must be an object");for(var r=Object.keys(e),i=r.length;i-- >0;){var s=r[i],o=t[s];if(o){var a=e[s],c=void 0===a||o(a,s,e);if(!0!==c)throw new TypeError("option "+s+" must be "+c)}else if(!0!==n)throw Error("Unknown option "+s)}},validators:i}},3739:(e,t,n)=>{"use strict";var r=n(6956),i=Object.prototype.toString;function s(e){return"[object Array]"===i.call(e)}function o(e){return void 0===e}function a(e){return null!==e&&"object"==typeof e}function c(e){if("[object Object]"!==i.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function l(e){return"[object Function]"===i.call(e)}function u(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),s(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}e.exports={isArray:s,isArrayBuffer:function(e){return"[object ArrayBuffer]"===i.call(e)},isBuffer:function(e){return null!==e&&!o(e)&&null!==e.constructor&&!o(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:a,isPlainObject:c,isUndefined:o,isDate:function(e){return"[object Date]"===i.call(e)},isFile:function(e){return"[object File]"===i.call(e)},isBlob:function(e){return"[object Blob]"===i.call(e)},isFunction:l,isStream:function(e){return a(e)&&l(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:u,merge:function e(){var t={};function n(n,r){c(t[r])&&c(n)?t[r]=e(t[r],n):c(n)?t[r]=e({},n):s(n)?t[r]=n.slice():t[r]=n}for(var r=0,i=arguments.length;r<i;r++)u(arguments[r],n);return t},extend:function(e,t,n){return u(t,(function(t,i){e[i]=n&&"function"==typeof t?r(t,n):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}},7819:(e,t,n)=>{"use strict";var r;n.d(t,{u:()=>r}),function(e){e.genericError="genericError",e.throttlingError="throttlingError",e.dataCorruptionError="dataCorruptionError",e.dataProcessingError="dataProcessingError",e.usageError="usageError",e.clientSessionExpiredError="clientSessionExpiredError"}(r||(r={}))},7846:(e,t,n)=>{"use strict";n.d(t,{Ai:()=>s,Tr:()=>i,s2:()=>r});const r=e=>"object"==typeof e&&"string"==typeof(null==e?void 0:e.name)&&"object"==typeof(null==e?void 0:e.fluid),i=e=>{const t=e;return"object"==typeof t&&("string"==typeof(null==t?void 0:t.package)||r(null==t?void 0:t.package))&&(void 0===(null==t?void 0:t.config)||"object"==typeof(null==t?void 0:t.config))},s="IFluidCodeDetailsComparer"},2994:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AttachState:()=>a.mB,BindState:()=>a.xU,ContainerErrorType:()=>s.u,IFluidCodeDetailsComparer:()=>r.Ai,IFluidTokenProvider:()=>c,IRuntimeFactory:()=>a.Wy,LoaderHeader:()=>o.A,isFluidBrowserPackage:()=>i,isFluidCodeDetails:()=>r.Tr,isFluidPackage:()=>r.s2});var r=n(7846);const i=e=>{var t,n,i,s,o,a;return(0,r.s2)(e)&&"string"==typeof(null===(i=null===(n=null===(t=null==e?void 0:e.fluid)||void 0===t?void 0:t.browser)||void 0===n?void 0:n.umd)||void 0===i?void 0:i.library)&&Array.isArray(null===(a=null===(o=null===(s=null==e?void 0:e.fluid)||void 0===s?void 0:s.browser)||void 0===o?void 0:o.umd)||void 0===a?void 0:a.files)};var s=n(7819),o=n(1783),a=n(3738);const c="IFluidTokenProvider"},1783:(e,t,n)=>{"use strict";var r;n.d(t,{A:()=>r}),function(e){e.cache="fluid-cache",e.clientDetails="fluid-client-details",e.loadMode="loadMode",e.reconnect="fluid-reconnect",e.sequenceNumber="fluid-sequence-number",e.version="version"}(r||(r={}))},3738:(e,t,n)=>{"use strict";var r,i;n.d(t,{Wy:()=>s,mB:()=>r,xU:()=>i}),function(e){e.Detached="Detached",e.Attaching="Attaching",e.Attached="Attached"}(r||(r={})),function(e){e.NotBound="NotBound",e.Binding="Binding",e.Bound="Bound"}(i||(i={}));const s="IRuntimeFactory"},1434:(e,t,n)=>{"use strict";var r;n.d(t,{e:()=>r}),function(e){e[e.Disconnected=0]="Disconnected",e[e.EstablishingConnection=3]="EstablishingConnection",e[e.Connecting=1]="Connecting",e[e.CatchingUp=1]="CatchingUp",e[e.Connected=2]="Connected"}(r||(r={}))},9752:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IContainerRuntime=void 0,t.IContainerRuntime="IContainerRuntime"},6734:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(9752),t)},1527:(e,t,n)=>{"use strict";n.d(t,{kE:()=>At,lf:()=>St});var r=n(3738),i=n(1783);function s(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}const o=window.performance;var a=n(7187);class c extends a.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}function l(e,t="Unreachable Case"){throw new Error(t)}class u{constructor(e){this.startTick=e,this.lastTick=e}static start(){const e=o.now();return new u(e)}trace(){const e=o.now(),t={totalTimeElapsed:e-this.startTick,duration:e-this.lastTick,tick:e};return this.lastTick=e,t}}var h,d,p,f=n(2738),g=n(4839),m=n(8595),y=n(5761),v=n(4025),b=n(9252),S=n(9268);!function(e){e.NoOp="noop",e.ClientJoin="join",e.ClientLeave="leave",e.Propose="propose",e.Reject="reject",e.Summarize="summarize",e.SummaryAck="summaryAck",e.SummaryNack="summaryNack",e.Operation="op",e.RemoteHelp="remoteHelp",e.NoClient="noClient",e.RoundTrip="tripComplete",e.Control="control"}(h||(h={})),function(e){e.ThrottlingError="ThrottlingError",e.InvalidScopeError="InvalidScopeError",e.BadRequestError="BadRequestError",e.LimitExceededError="LimitExceededError"}(d||(d={})),function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(p||(p={}));var w=n(7983),x=n(3953),C=n(262),E=n(9703),T=n(8991),A=n(1890),k=n(6705),N=n(2045),O=n(1096);class P{constructor(e,t,n){this.path=e,this.runtime=t,this.routeContext=n,this.absolutePath=(0,O.H)(e,this.routeContext)}get IFluidHandleContext(){return this}attachGraph(){throw new Error("can't attach container runtime form within container!")}get isAttached(){return this.runtime.attachState!==r.mB.Detached}async resolveHandle(e){return this.runtime.resolveHandle(e)}}var R=n(9680);class I{constructor(){this.completed=!1,this.p=new Promise(((e,t)=>{this.res=e,this.rej=t}))}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){void 0!==this.res&&(this.completed=!0,this.res(e))}reject(e){void 0!==this.rej&&(this.completed=!0,this.rej(e))}}class F{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return void 0===this.result&&(this.result=this.execute()),this.result}}var D=n(2505),M=n(2718),L=n(9203);const _="summarizer";class q extends c{constructor(e,t,n,r,i){super(),this.logger=e,this.summaryCollection=t,this.clientElection=n,this.maxOpsSinceLastSummary=r,this.electionEnabled=i,this.lastReportedSeq=0,this.summaryCollection.on("default",(({sequenceNumber:e})=>{var t,n,i;const s=this.electedClientId;if(void 0===s)return void(this.clientElection.eligibleCount>0&&this.clientElection.resetElectedClient(e));let o=this.clientElection.electionSequenceNumber;if(e-(null!==(t=this.lastSummaryAckSeqForClient)&&void 0!==t?t:o)>this.maxOpsSinceLastSummary){const t=e-this.lastReportedSeq;if(t>this.maxOpsSinceLastSummary&&(this.logger.sendErrorEvent({eventName:"ElectedClientNotSummarizing",electedClientId:s,lastSummaryAckSeqForClient:this.lastSummaryAckSeqForClient,electionSequenceNumber:o,nextElectedClientId:null===(n=this.clientElection.peekNextElectedClient())||void 0===n?void 0:n.clientId,electionEnabled:this.electionEnabled}),this.lastReportedSeq=e),this.electionEnabled){const n=this.electedParentId;this.clientElection.incrementElectedClient(e),o=this.clientElection.electionSequenceNumber,e>(null!==(i=this.lastSummaryAckSeqForClient)&&void 0!==i?i:o)&&t>this.maxOpsSinceLastSummary&&this.logger.sendErrorEvent({eventName:"UnexpectedElectionSequenceNumber",lastSummaryAckSeqForClient:this.lastSummaryAckSeqForClient,electionSequenceNumber:o,sequenceNumber:e,previousClientId:s,previousParentId:n,electedParentId:this.electedParentId,electedClientId:this.electedClientId,opsSinceLastReport:t,maxOpsSinceLastSummary:r})}}})),this.summaryCollection.on(h.SummaryAck,(e=>{this.lastSummaryAckSeqForClient=e.sequenceNumber})),this.clientElection.on("election",((e,t)=>{this.lastSummaryAckSeqForClient=void 0,void 0===e&&this.clientElection.eligibleCount>0&&this.clientElection.resetElectedClient(t),this.emit("electedSummarizerChanged")}))}get electedClientId(){var e;return null===(e=this.clientElection.electedClient)||void 0===e?void 0:e.clientId}get electedParentId(){var e;return null===(e=this.clientElection.electedParent)||void 0===e?void 0:e.clientId}serialize(){var e;const{electedClientId:t,electedParentId:n,electionSequenceNumber:r}=this.clientElection.serialize();return{electedClientId:t,electedParentId:n,electionSequenceNumber:null!==(e=this.lastSummaryAckSeqForClient)&&void 0!==e?e:r}}static isClientEligible(e){const t=e.client.details;return void 0===t||q.clientDetailsPermitElection(t)}}q.clientDetailsPermitElection=e=>e.capabilities.interactive||e.type===_;var B=n(8888);class j extends B.B{async get(){throw Error("Do not try to get a summarizer object from the handle. Reference it directly.")}attach(){}bind(e){}}class z{constructor(e,t,n=(()=>Date.now())){this.defaultTimeout=e,this.defaultHandler=t,this.getCurrentTick=n}get hasTimer(){return!!this.runningState}start(e=this.defaultTimeout,t=this.defaultHandler){this.startCore(e,t,e)}clear(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}restart(e,t){var n,r;if(this.runningState){const i=null!=e?e:this.runningState.intendedDuration,s=null!==(r=null!=t?t:null===(n=this.runningState.restart)||void 0===n?void 0:n.handler)&&void 0!==r?r:this.runningState.handler,o=this.calculateRemainingTime(this.runningState);i<o?this.start(i,s):i===o?(this.runningState.handler=s,this.runningState.restart=void 0,this.runningState.intendedDuration=i):this.runningState.restart={startTick:this.getCurrentTick(),duration:i,handler:s}}else this.start(e,t)}startCore(e,t,n){this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:e,intendedDuration:n,handler:t,timeout:setTimeout((()=>this.handler()),e)}}handler(){s(!!this.runningState,10);const e=this.runningState.restart;if(void 0!==e){const t=this.calculateRemainingTime(e);this.startCore(t,(()=>e.handler()),e.duration)}else{const e=this.runningState.handler;this.clear(),e()}}calculateRemainingTime(e){const t=this.getCurrentTick()-e.startTick;return e.duration-t}}class H{constructor(e,t){this.timer=new z(e,(()=>this.wrapHandler(t)))}get hasTimer(){return this.timer.hasTimer}async start(e,t){return this.clear(),this.deferred=new I,this.timer.start(e,t?()=>this.wrapHandler(t):void 0),this.deferred.promise}clear(){this.timer.clear(),this.deferred&&(this.deferred.resolve({timerResult:"cancel"}),this.deferred=void 0)}wrapHandler(e){e(),s(!!this.deferred,11),this.deferred.resolve({timerResult:"timeout"}),this.deferred=void 0}}const U=async e=>new Promise((t=>setTimeout((()=>t()),e)));class V{constructor(e,t){this.lastOpSequenceNumber=e,this._lastAttempt=t,this._lastSuccessfulSummary=Object.assign({},t)}get lastAttempt(){return this._lastAttempt}get lastSuccessfulSummary(){return this._lastSuccessfulSummary}updateWithLastSummaryAckInfo(e){this._lastAttempt=e,this._lastSuccessfulSummary=Object.assign({},e)}recordAttempt(e){this._lastAttempt={refSequenceNumber:null!=e?e:this.lastOpSequenceNumber,summaryTime:Date.now()}}markLastAttemptAsSuccessful(){this._lastSuccessfulSummary=Object.assign({},this.lastAttempt)}}class G{constructor(e,t,n,r){this.heuristicData=e,this.configuration=t,this.trySummarize=n,this.logger=r,this.idleTimer=new z(this.configuration.idleTime,(()=>this.trySummarize("idle"))),this.minOpsForLastSummaryAttempt=this.configuration.minOpsForLastSummaryAttempt}get opsSinceLastAck(){return this.heuristicData.lastOpSequenceNumber-this.heuristicData.lastSuccessfulSummary.refSequenceNumber}run(){const e=Date.now()-this.heuristicData.lastSuccessfulSummary.summaryTime,t=this.opsSinceLastAck;e>this.configuration.maxTime?(this.idleTimer.clear(),this.trySummarize("maxTime")):t>this.configuration.maxOps?(this.idleTimer.clear(),this.trySummarize("maxOps")):this.idleTimer.restart()}shouldRunLastSummary(){const e=this.opsSinceLastAck,t=this.minOpsForLastSummaryAttempt;return this.logger.sendTelemetryEvent({eventName:"ShouldRunLastSummary",opsSinceLastAck:e,minOpsForLastSummaryAttempt:t}),e>=t}dispose(){this.idleTimer.clear()}}var W=n(9077);async function K(e,t,n){const r=[e.then((e=>({result:"done",value:e}))),t.then((({timerResult:e})=>({result:e})))];return void 0!==n&&r.push(n.waitCancelled.then((()=>({result:"cancelled"})))),Promise.race(r)}const $={submitSummaryFailure:"Error while generating, uploading, or submitting summary",summaryOpWaitTimeout:"Timeout while waiting for summarize op broadcast",summaryAckWaitTimeout:"Timeout while waiting for summaryAck/summaryNack op",summaryNack:"Server rejected summary via summaryNack op",disconnect:"Summary cancelled due to summarizer or main client disconnect"};class J{constructor(){this.summarySubmitted=new I,this.summaryOpBroadcasted=new I,this.receivedSummaryAckOrNack=new I}fail(e,t,n,r){s(!this.receivedSummaryAckOrNack.isCompleted,606);const i={success:!1,message:e,data:void 0,error:t,retryAfterSeconds:r};this.summarySubmitted.resolve(i),this.summaryOpBroadcasted.resolve(i),this.receivedSummaryAckOrNack.resolve(Object.assign(Object.assign({},i),{data:n}))}build(){return{summarySubmitted:this.summarySubmitted.promise,summaryOpBroadcasted:this.summaryOpBroadcasted.promise,receivedSummaryAckOrNack:this.receivedSummaryAckOrNack.promise}}}class Q{constructor(e,t,n,r,i,s,o){this.pendingAckTimer=e,this.heuristicData=t,this.submitSummaryCallback=n,this.raiseSummarizingError=r,this.successfulSummaryCallback=i,this.summaryWatcher=s,this.logger=o,this.summarizeTimer=new z(2e4,(()=>this.summarizeTimerHandler(2e4,1)))}summarize(e,t,n,r=new J){return this.summarizeCore(e,t,r,n).catch((t=>{const n="UnexpectedSummarizeError";this.logger.sendErrorEvent(Object.assign({eventName:n},e),t),r.fail(n,t)})),r.build()}async summarizeCore(e,t,n,r){const{refreshLatestAck:i,fullTree:o}=t,a=f.G2.create(this.logger,void 0,{all:e});let c={fullTree:o,timeSinceLastAttempt:Date.now()-this.heuristicData.lastAttempt.summaryTime,timeSinceLastSummary:Date.now()-this.heuristicData.lastSuccessfulSummary.summaryTime};const l=f.Xr.start(a,Object.assign({eventName:"Summarize",refreshLatestAck:i},c)),u=(e,t,i,s)=>{this.raiseSummarizingError($[e]);const o=(0,W.GS)(t),a=r.cancelled||(null==t?void 0:t.errorType)===D.C.offlineError?"generic":"error";l.cancel(Object.assign(Object.assign({},i),{reason:e,category:a,retryAfterSeconds:o}),t),n.fail((e=>`${e}: ${$[e]}`)(e),t,s,o)};let d;this.summarizeTimer.start();try{d=await this.submitSummaryCallback({fullTree:o,refreshLatestAck:i,summaryLogger:a,cancellationToken:r});const e=d.referenceSequenceNumber,t=e-this.heuristicData.lastSuccessfulSummary.refSequenceNumber;if(c=Object.assign(Object.assign({},c),{referenceSequenceNumber:e,minimumSequenceNumber:d.minimumSequenceNumber,opsSinceLastAttempt:e-this.heuristicData.lastAttempt.refSequenceNumber,opsSinceLastSummary:t}),"base"!==d.stage&&(c=Object.assign(Object.assign(Object.assign({},c),d.summaryStats),{generateDuration:d.generateDuration}),"generate"!==d.stage&&(c=Object.assign(Object.assign({},c),{handle:d.handle,uploadDuration:d.uploadDuration}),"upload"!==d.stage&&(c=Object.assign(Object.assign({},c),{clientSequenceNumber:d.clientSequenceNumber})))),"submit"!==d.stage)return u("submitSummaryFailure",d.error,c);if(!o&&!d.forcedFullTree){const{summarizedDataStoreCount:e,gcStateUpdatedDataStoreCount:n=0}=d.summaryStats;e>n+t&&a.sendErrorEvent({eventName:"IncrementalSummaryViolation",summarizedDataStoreCount:e,gcStateUpdatedDataStoreCount:n,opsSinceLastSummary:t})}l.reportEvent("generate",Object.assign({},c)),n.summarySubmitted.resolve({success:!0,data:d})}catch(e){return u("submitSummaryFailure",e)}finally{this.heuristicData.recordAttempt(null==d?void 0:d.referenceSequenceNumber),this.summarizeTimer.clear()}try{const e=this.pendingAckTimer.start(),t=this.summaryWatcher.watchSummary(d.clientSequenceNumber),i=await K(t.waitBroadcast(),e,r);if("cancelled"===i.result)return u("disconnect");if("done"!==i.result)return u("summaryOpWaitTimeout");const o=i.value,p=Date.now()-this.heuristicData.lastAttempt.summaryTime;n.summaryOpBroadcasted.resolve({success:!0,data:{summarizeOp:o,broadcastDuration:p}}),this.heuristicData.lastAttempt.summarySequenceNumber=o.sequenceNumber,a.sendTelemetryEvent({eventName:"Summarize_Op",duration:p,referenceSequenceNumber:o.referenceSequenceNumber,summarySequenceNumber:o.sequenceNumber,handle:o.contents.handle});const f=await K(t.waitAckNack(),e,r);if("cancelled"===f.result)return u("disconnect");if("done"!==f.result)return u("summaryAckWaitTimeout");const g=f.value;this.pendingAckTimer.clear();const m=Date.now()-this.heuristicData.lastAttempt.summaryTime;if(c=Object.assign({ackWaitDuration:m,ackNackSequenceNumber:g.sequenceNumber,summarySequenceNumber:g.contents.summaryProposal.summarySequenceNumber},c),g.type!==h.SummaryAck){s(g.type===h.SummaryNack,628);const e=g.contents,t=null==e?void 0:e.message,n=null==e?void 0:e.retryAfter,r=new M.j4(`Received summaryNack: ${t}`,{retryAfterSeconds:n});return s((0,W.GS)(r)===n,607),u("summaryNack",r,Object.assign(Object.assign({},c),{nackRetryAfter:n}),{summaryNackOp:g,ackNackDuration:m})}this.heuristicData.markLastAttemptAsSuccessful(),this.successfulSummaryCallback(),l.end(Object.assign(Object.assign({},c),{handle:g.contents.handle})),n.receivedSummaryAckOrNack.resolve({success:!0,data:{summaryAckOp:g,ackNackDuration:m}})}finally{this.pendingAckTimer.clear()}}summarizeTimerHandler(e,t){if(this.logger.sendPerformanceEvent({eventName:"SummarizeTimeout",timeoutTime:e,timeoutCount:t}),t<5){const n=2*e;this.summarizeTimer.start(n,(()=>this.summarizeTimerHandler(n,t+1)))}}dispose(){this.summarizeTimer.clear()}}var X,Z=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class Y{constructor(e,t,n,r,i,o,a,c,l){this.summaryWatcher=t,this.configuration=n,this.submitSummaryCallback=r,this.heuristicData=i,this.raiseSummarizingError=o,this.summaryCollection=a,this.cancellationToken=c,this.stopSummarizerCallback=l,this.stopping=!1,this._disposed=!1,this.tryWhileSummarizing=!1,this.summarizeCount=0,this.totalSuccessfulAttempts=0,this.tryGetCorrelatedLogger=e=>this.heuristicData.lastAttempt.refSequenceNumber===e?this.logger:void 0;const u={summarizeCount:()=>this.summarizeCount,summarizerSuccessfulAttempts:()=>this.totalSuccessfulAttempts};this.logger=f.G2.create(e,"Running",{all:u}),"disableHeuristics"!==n.state&&(s("enabled"===this.configuration.state,746),this.heuristicRunner=new G(i,this.configuration,(e=>this.trySummarize(e)),this.logger)),s("disabled"!==this.configuration.state,747);const h=Math.min(this.configuration.maxAckWaitTime,6e5);this.pendingAckTimer=new H(h,(()=>{this.raiseSummarizingError("Pending summary ack not received in time"),this.logger.sendErrorEvent({eventName:"SummaryAckWaitTimeout",maxAckWaitTime:h,referenceSequenceNumber:this.heuristicData.lastAttempt.refSequenceNumber,summarySequenceNumber:this.heuristicData.lastAttempt.summarySequenceNumber,timePending:Date.now()-this.heuristicData.lastAttempt.summaryTime})})),a.setPendingAckTimerTimeoutCallback(h,(()=>{this.pendingAckTimer.hasTimer&&(this.logger.sendTelemetryEvent({eventName:"MissingSummaryAckFoundByOps",referenceSequenceNumber:this.heuristicData.lastAttempt.refSequenceNumber,summarySequenceNumber:this.heuristicData.lastAttempt.summarySequenceNumber}),this.pendingAckTimer.clear())})),this.generator=new Q(this.pendingAckTimer,this.heuristicData,this.submitSummaryCallback,this.raiseSummarizingError,(()=>{this.totalSuccessfulAttempts++}),this.summaryWatcher,this.logger)}static async start(e,t,n,r,i,s,o,a,c){var l;const u=new Y(e,t,n,r,i,s,o,a,c);return await u.waitStart(),null===(l=u.heuristicRunner)||void 0===l||l.run(),u}get disposed(){return this._disposed}dispose(){var e;this.summaryWatcher.dispose(),null===(e=this.heuristicRunner)||void 0===e||e.dispose(),this.heuristicRunner=void 0,this.generator.dispose(),this.pendingAckTimer.clear(),this.disposeEnqueuedSummary(),this._disposed=!0,this.stopping=!0}handleSystemOp(e){switch(e.type){case h.ClientLeave:case h.ClientJoin:case h.Propose:return void this.handleOp(void 0,e);default:return}}handleOp(e,{sequenceNumber:t,type:n,clientId:r,contents:i}){var s;void 0===e&&(this.heuristicData.lastOpSequenceNumber=t,this.tryRunEnqueuedSummary()||null===(s=this.heuristicRunner)||void 0===s||s.run())}async waitStop(e){var t;this.stopping||(this.stopping=!0,this.disposeEnqueuedSummary(),e&&(null===(t=this.heuristicRunner)||void 0===t?void 0:t.shouldRunLastSummary())&&void 0===this.summarizingLock&&this.trySummarizeOnce({reason:"lastSummary"},{}),await this.summarizingLock)}async waitStart(){const e=await K(this.summaryWatcher.waitFlushed(),this.pendingAckTimer.start());this.pendingAckTimer.clear(),this.summaryCollection.unsetPendingAckTimerTimeoutCallback(),"done"===e.result&&void 0!==e.value&&this.heuristicData.updateWithLastSummaryAckInfo({refSequenceNumber:e.value.summaryOp.referenceSequenceNumber,summaryTime:Date.now(),summarySequenceNumber:e.value.summaryOp.sequenceNumber})}async lockedRefreshSummaryAckAction(e){s(void 0===this.refreshSummaryAckLock,"Refresh Summary Ack - Caller is responsible for checking lock");const t=new I;return this.refreshSummaryAckLock=t.promise,e().finally((()=>{t.resolve(),this.refreshSummaryAckLock=void 0}))}async lockedSummaryAction(e){s(void 0===this.summarizingLock,603);const t=new I;return this.summarizingLock=t.promise,this.summarizeCount++,await this.refreshSummaryAckLock,e().finally((()=>{var e;t.resolve(),this.summarizingLock=void 0;const n=this.tryWhileSummarizing;this.tryWhileSummarizing=!1,this.stopping||this.tryRunEnqueuedSummary()||!n||null===(e=this.heuristicRunner)||void 0===e||e.run()}))}trySummarizeOnce(e,t,n=this.cancellationToken,r=new J){return this.lockedSummaryAction((async()=>this.generator.summarize(e,t,n,r).receivedSummaryAckOrNack)).catch((e=>{})),r.build()}trySummarize(e,t=this.cancellationToken){void 0===this.summarizingLock?this.lockedSummaryAction((async()=>{const n=[{refreshLatestAck:!1,fullTree:!1},{refreshLatestAck:!0,fullTree:!1},{refreshLatestAck:!0,fullTree:!1,delaySeconds:120},{refreshLatestAck:!0,fullTree:!0,delaySeconds:600}];let r,i,s=0,o=0;for(let a=0;a<n.length;){if(this.cancellationToken.cancelled)return;if(++s>1&&"lastSummary"===e)return;o++;const c=n[a],{delaySeconds:l=0}=c,u=Z(c,["delaySeconds"]),h=null!=r?r:l,d=Object.assign({reason:e,summaryAttempts:s,summaryAttemptsPerPhase:o,summaryAttemptPhase:a+1},u);h>0&&(this.logger.sendPerformanceEvent(Object.assign({eventName:"SummarizeAttemptDelay",duration:h,summaryNackDelay:void 0!==r},d)),await U(1e3*h)),await this.refreshSummaryAckLock;const p=this.generator.summarize(d,u,t),f=await p.receivedSummaryAckOrNack;if(f.success)return;r=f.retryAfterSeconds,(void 0===r||o>1)&&(a++,o=0),i=f}this.logger.sendErrorEvent({eventName:"FailToSummarize",reason:e,message:null==i?void 0:i.message},null==i?void 0:i.error),this.stopSummarizerCallback("failToSummarize")})).catch((e=>{this.logger.sendErrorEvent({eventName:"UnexpectedSummarizeError"},e)})):this.tryWhileSummarizing=!0}summarizeOnDemand(e=new J,t){var{reason:n}=t,r=Z(t,["reason"]);if(this.stopping)return e.fail("RunningSummarizer stopped or disposed",void 0),e.build();if(void 0!==this.summarizingLock)throw new S.Oi("Attempted to run an already-running summarizer on demand");return this.trySummarizeOnce({reason:`onDemand/${n}`},r,this.cancellationToken,e)}enqueueSummarize(e){var{reason:t,afterSequenceNumber:n=0,override:r=!1}=e,i=Z(e,["reason","afterSequenceNumber","override"]);const s=`enqueue;${t}`;let o=!1;if(void 0!==this.enqueuedSummary){if(!r)return{alreadyEnqueued:!0};this.enqueuedSummary.resultsBuilder.fail("Aborted; overridden by another enqueue summarize attempt",void 0),this.enqueuedSummary=void 0,o=!0}this.enqueuedSummary={reason:s,afterSequenceNumber:n,options:i,resultsBuilder:new J};const a=this.enqueuedSummary.resultsBuilder.build();return this.tryRunEnqueuedSummary(),o?Object.assign(Object.assign({},a),{alreadyEnqueued:!0,overridden:!0}):a}tryRunEnqueuedSummary(){if(this.stopping)return this.disposeEnqueuedSummary(),!1;if(void 0===this.enqueuedSummary||this.heuristicData.lastOpSequenceNumber<this.enqueuedSummary.afterSequenceNumber||void 0!==this.summarizingLock)return!1;const{reason:e,resultsBuilder:t,options:n}=this.enqueuedSummary;return this.enqueuedSummary=void 0,this.trySummarizeOnce({reason:`enqueuedSummary/${e}`},n,this.cancellationToken,t),!0}disposeEnqueuedSummary(){void 0!==this.enqueuedSummary&&(this.enqueuedSummary.resultsBuilder.fail("RunningSummarizer stopped or disposed",void 0),this.enqueuedSummary=void 0)}}class ee extends M.j4{constructor(e,t=!1){super(e),this.logged=t,this.errorType="summarizingError",this.canRetry=!0}static wrap(e,t=!1,n){return(0,M.bO)(e,(e=>new ee(e,t)),n)}}class te extends a.EventEmitter{constructor(e,t,n,r,i,s,o){super(),this.runtime=t,this.configurationGetter=n,this.internalsProvider=r,this.summaryCollection=s,this.runCoordinatorCreateFn=o,this._disposed=!1,this.starting=!1,this.stopDeferred=new I,this.summarizeOnDemand=(...e)=>{var t;try{if(this._disposed||(null===(t=this.runningSummarizer)||void 0===t?void 0:t.disposed))throw new S.Oi("Summarizer is already disposed.");if(void 0!==this.runtime.summarizerClientId&&this.runtime.summarizerClientId!==this.runtime.clientId)throw new S.Oi("On-demand summary attempted while an elected summarizer is present");const n=new J;return this.runningSummarizer?this.runningSummarizer.summarizeOnDemand(n,...e):(this.runCoordinatorCreateFn(this.runtime).then((t=>{this.start(this.runtime.clientId,t).then((async r=>{r.summarizeOnDemand(n,...e);const i=await Promise.race([this.stopDeferred.promise,t.waitCancelled]);await r.waitStop(!1),t.stop(i),this.close()})).catch((e=>{n.fail("Failed to start summarizer",e)}))})).catch((e=>{n.fail("Failed to create cancellation token",e)})),n.build())}catch(e){throw ee.wrap(e,!1,this.logger)}},this.enqueueSummarize=(...e)=>{if(this._disposed||void 0===this.runningSummarizer||this.runningSummarizer.disposed)throw new S.Oi("Summarizer is not running or already disposed.");return this.runningSummarizer.enqueueSummarize(...e)},this.logger=f.G2.create(this.runtime.logger,"Summarizer"),this.innerHandle=new j(this,e,i)}get IFluidLoadable(){return this}get ISummarizer(){return this}get handle(){return this.innerHandle}static async create(e,t){const n={headers:{[i.A.cache]:!1,[i.A.clientDetails]:{capabilities:{interactive:!1},type:_},[y.i.summarizingClient]:!0,[i.A.reconnect]:!1},url:t},r=await e.resolve(n),s=await(0,E.bb)(r,{url:"_summarizer"});if(void 0===s.ISummarizer)throw new S.Oi("Fluid object does not implement ISummarizer");return s.ISummarizer}async run(e){try{return await this.runCore(e)}catch(e){throw this.stop("summarizerException"),ee.wrap(e,!1,this.logger)}finally{this.close()}}stop(e){this.stopDeferred.resolve(e)}close(){this.dispose(),this.runtime.closeFn()}async runCore(e){const t=await this.runCoordinatorCreateFn(this.runtime),n=Promise.race([t.waitCancelled,this.stopDeferred.promise]);if(n.then((t=>{this.logger.sendTelemetryEvent({eventName:"StoppingSummarizer",onBehalfOf:e,reason:t})})),t.cancelled)return t.waitCancelled;const r=await this.start(e,t),i=await n;return await r.waitStop(!t.cancelled&&te.stopReasonCanRunLastSummary(i)),t.stop(i),i}static stopReasonCanRunLastSummary(e){return"parentNotConnected"===e}async start(e,t){if(this.runningSummarizer){if(this.runningSummarizer.disposed)throw new S.Oi("Starting a disposed summarizer");return this.runningSummarizer}if(this.starting)throw new S.Oi("Attempting to start a summarizer that is already starting");this.starting=!0,this.logger.sendTelemetryEvent({eventName:"RunningSummarizer",onBehalfOf:e,initSummarySeqNumber:this.runtime.deltaManager.initialSequenceNumber,config:JSON.stringify(this.configurationGetter())});const n=this.runtime.clientId;if(void 0===n)throw new S.Oi("clientId should be defined if connected.");const r=await Y.start(this.logger,this.summaryCollection.createWatcher(n),this.configurationGetter(),(async(...e)=>this.internalsProvider.submitSummary(...e)),new V(this.runtime.deltaManager.lastSequenceNumber,{refSequenceNumber:this.runtime.deltaManager.initialSequenceNumber,summaryTime:Date.now()}),(e=>{this._disposed||this.logger.sendErrorEvent({eventName:"summarizingError"},((e,t)=>new ee(e,!0))(e))}),this.summaryCollection,t,(e=>t.stop(e)));return this.runningSummarizer=r,this.starting=!1,this.handleSummaryAcks().catch((e=>{this.logger.sendErrorEvent({eventName:"HandleSummaryAckFatalError"},e)})),this.systemOpListener=e=>r.handleSystemOp(e),this.runtime.deltaManager.inbound.on("op",this.systemOpListener),this.opListener=(e,t)=>r.handleOp(e,t),this.runtime.on("batchEnd",this.opListener),r}dispose(){this.stop("summarizerClientDisconnected"),this._disposed=!0,this.runningSummarizer&&(this.runningSummarizer.dispose(),this.runningSummarizer=void 0),this.systemOpListener&&this.runtime.deltaManager.inbound.off("op",this.systemOpListener),this.opListener&&this.runtime.removeListener("batchEnd",this.opListener)}async handleSummaryAcks(){var e,t,n,r,i;let s,o=this.runtime.deltaManager.initialSequenceNumber;for(;this.runningSummarizer;){const a=null!==(e=this.runningSummarizer.tryGetCorrelatedLogger(o))&&void 0!==e?e:this.logger;try{s=void 0,s=await this.summaryCollection.waitSummaryAck(o),o=s.summaryOp.referenceSequenceNumber;const e=s.summaryOp.contents.handle,t=s.summaryAck.contents.handle;await this.runningSummarizer.lockedRefreshSummaryAckAction((async()=>this.internalsProvider.refreshLatestSummaryAck(e,t,o,a).catch((async n=>{if(!(0,L.IR)(n)||n.errorType!==D.C.fileNotFoundOrAccessDeniedError)throw n;a.sendTelemetryEvent({eventName:"HandleSummaryAckErrorIgnored",referenceSequenceNumber:o,proposalHandle:e,ackHandle:t},n)}))))}catch(e){a.sendErrorEvent({eventName:"HandleSummaryAckError",referenceSequenceNumber:o,handle:null===(n=null===(t=null==s?void 0:s.summaryOp)||void 0===t?void 0:t.contents)||void 0===n?void 0:n.handle,ackHandle:null===(i=null===(r=null==s?void 0:s.summaryAck)||void 0===r?void 0:r.contents)||void 0===i?void 0:i.handle},e)}o++}}}!function(e){e[e.Off=0]="Off",e[e.Starting=1]="Starting",e[e.Running=2]="Running",e[e.Stopping=3]="Stopping"}(X||(X={}));class ne{constructor(e,t,n,r,i,s,{initialDelayMs:o=5e3,opsToBypassInitialDelay:a=4e3}={},c){this.clientElection=e,this.connectedState=t,this.summaryCollection=n,this.requestSummarizerFn=i,this.startThrottler=s,this.disableHeuristics=c,this.state=X.Off,this._disposed=!1,this.handleConnected=e=>{this.latestClientId=e,this.refreshSummarizer()},this.handleDisconnected=()=>{this.refreshSummarizer()},this.refreshSummarizer=()=>{const e=this.getShouldSummarizeState();switch(this.state){case X.Off:return void(e.shouldSummarize&&this.startSummarization());case X.Starting:return;case X.Running:return void(!1===e.shouldSummarize&&this.stop(e.stopReason));case X.Stopping:default:return}},this.summarizeOnDemand=(...e)=>{if(void 0===this.summarizer)throw Error("No running summarizer client");return this.summarizer.summarizeOnDemand(...e)},this.enqueueSummarize=(...e)=>{if(void 0===this.summarizer)throw Error("No running summarizer client");return this.summarizer.enqueueSummarize(...e)},this.logger=f.G2.create(r,"SummaryManager",{all:{clientId:()=>this.latestClientId}}),this.connectedState.on("connected",this.handleConnected),this.connectedState.on("disconnected",this.handleDisconnected),this.latestClientId=this.connectedState.clientId,this.opsToBypassInitialDelay=a,this.initialDelayMs=o}get disposed(){return this._disposed}get currentState(){return this.state}start(){this.clientElection.on("electedSummarizerChanged",this.refreshSummarizer),this.refreshSummarizer()}getShouldSummarizeState(){return this.connectedState.clientId!==this.clientElection.electedParentId||this.state!==X.Running&&this.connectedState.clientId!==this.clientElection.electedClientId?{shouldSummarize:!1,stopReason:"parentShouldNotSummarize"}:this.connectedState.connected?this.disposed?void s(!1,608):{shouldSummarize:!0}:{shouldSummarize:!1,stopReason:"parentNotConnected"}}startSummarization(){s(this.state===X.Off,609),this.state=X.Starting,s(void 0===this.summarizer,610),this.delayBeforeCreatingSummarizer().then((async e=>{if(e&&!1===this.getShouldSummarizeState().shouldSummarize)return"early exit";s(this.state===X.Starting,611),this.state=X.Running;const t=await this.requestSummarizerFn();this.summarizer=t;const n=this.getShouldSummarizeState();if(!1===n.shouldSummarize)return this.state=X.Starting,t.stop(n.stopReason),"early exit after starting summarizer";const r=this.latestClientId;return f.Xr.timedExecAsync(this.logger,{eventName:"RunningSummarizer",attempt:this.startThrottler.numAttempts},(async()=>t.run(r,this.disableHeuristics)))})).then((e=>{this.logger.sendTelemetryEvent({eventName:"EndingSummarizer",reason:e})})).catch((e=>{if(this.logger.sendTelemetryEvent({eventName:"EndingSummarizer",reason:"exception"},e),this.getShouldSummarizeState().shouldSummarize||void 0!==this.summarizer){const t=(null==e?void 0:e.errorType)===D.C.offlineError?"generic":"error";this.logger.sendTelemetryEvent({eventName:"SummarizerException",category:t},e)}})).finally((()=>{var e;s(this.state!==X.Off,612),this.state=X.Off,null===(e=this.summarizer)||void 0===e||e.close(),this.summarizer=void 0,this.getShouldSummarizeState().shouldSummarize&&this.startSummarization()}))}stop(e){var t;ne.isStartingOrRunning(this.state)&&(this.state=X.Stopping,null===(t=this.summarizer)||void 0===t||t.stop(e))}async delayBeforeCreatingSummarizer(){let e=this.startThrottler.getDelay();this.logger.sendTelemetryEvent({eventName:"CreatingSummarizer",throttlerDelay:e,initialDelay:this.initialDelayMs,startThrottlerMaxDelayMs:this.startThrottler.maxDelayMs,opsSinceLastAck:this.summaryCollection.opsSinceLastAck,opsToBypassInitialDelay:this.opsToBypassInitialDelay});let t=!1;if(this.summaryCollection.opsSinceLastAck<this.opsToBypassInitialDelay&&(t=!0,e=Math.max(e,this.initialDelayMs)),e>0){let t,n;const r=()=>{this.summaryCollection.opsSinceLastAck>=this.opsToBypassInitialDelay&&(clearTimeout(t),n())},i=new Promise((n=>{t=setTimeout((()=>n()),e)})),s=new Promise((e=>{n=e}));this.summaryCollection.addOpListener(r),await Promise.race([i,s]),this.summaryCollection.removeOpListener(r)}return t}dispose(){this.clientElection.off("electedSummarizerChanged",this.refreshSummarizer),this.connectedState.off("connected",this.handleConnected),this.connectedState.off("disconnected",this.handleDisconnected),this._disposed=!0}}ne.isStartingOrRunning=e=>e===X.Starting||e===X.Running;class re{constructor(e,t){this.logger=t,this.processingTimeIncrement=10,this.currentAllowedProcessingTimeForTurn=re.processingTime,this.schedulingCount=0,this.deltaManager=e,this.deltaManager.inbound.on("idle",(()=>{this.inboundQueueIdle()}))}batchBegin(e){this.processingStartTime||(this.processingStartTime=o.now()),void 0===this.schedulingLog&&this.schedulingCount%500==0&&(this.schedulingLog={opsRemainingToProcess:0,numberOfTurns:1,totalProcessingTime:0,numberOfBatchesProcessed:0,firstSequenceNumber:e.sequenceNumber,lastSequenceNumber:e.sequenceNumber,startTime:o.now()})}batchEnd(e){if(this.schedulingLog&&(this.schedulingLog.numberOfBatchesProcessed++,this.schedulingLog.lastSequenceNumber=e.sequenceNumber,this.schedulingLog.opsRemainingToProcess=this.deltaManager.inbound.length),this.shouldRunScheduler()){const e=o.now(),t=e-this.processingStartTime;t>this.currentAllowedProcessingTimeForTurn&&(this.deltaManager.inbound.pause(),this.currentAllowedProcessingTimeForTurn+=this.processingTimeIncrement,this.schedulingLog&&(this.schedulingLog.numberOfTurns++,this.schedulingLog.totalProcessingTime+=t),setTimeout((()=>{this.schedulingLog&&this.logger.sendTelemetryEvent({eventName:"InboundOpsPartialProcessingTime",duration:f.hy.formatTick(t),opsProcessed:this.schedulingLog.lastSequenceNumber-this.schedulingLog.firstSequenceNumber+1,opsRemainingToProcess:this.deltaManager.inbound.length,processingTime:f.hy.formatTick(this.schedulingLog.totalProcessingTime),numberOfTurns:this.schedulingLog.numberOfTurns,batchesProcessed:this.schedulingLog.numberOfBatchesProcessed,timeToResume:f.hy.formatTick(o.now()-e)}),this.deltaManager.inbound.resume()})),this.processingStartTime=void 0)}}inboundQueueIdle(){if(this.schedulingLog){const e=o.now();this.schedulingLog.totalProcessingTime+=e-this.processingStartTime,this.logger.sendTelemetryEvent({eventName:"InboundOpsProcessingTime",opsRemainingToProcess:this.schedulingLog.opsRemainingToProcess,numberOfTurns:this.schedulingLog.numberOfTurns,processingTime:f.hy.formatTick(this.schedulingLog.totalProcessingTime),opsProcessed:this.schedulingLog.lastSequenceNumber-this.schedulingLog.firstSequenceNumber+1,batchesProcessed:this.schedulingLog.numberOfBatchesProcessed,duration:f.hy.formatTick(e-this.schedulingLog.startTime),schedulingCount:this.schedulingCount}),this.schedulingLog=void 0}this.schedulingCount++,this.processingStartTime=void 0,this.currentAllowedProcessingTimeForTurn=re.processingTime}shouldRunScheduler(){return this.deltaManager.inbound.length>0}}re.processingTime=50;class ie{constructor(e,t,n){this.clientId=e,this.deltaManager=t,this.pongCount=0,this.msnTrackingTimestamp=0,this.opProcessingTimes={},this.opPerfData={},this.firstConnection=!0,this.bootTime=o.now(),this.connectionStartTime=0,this.gap=0,this.logger=f.G2.create(n,"OpPerf"),this.deltaManager.on("pong",(e=>this.recordPingTime(e))),this.deltaManager.on("submitOp",(e=>this.beforeOpSubmit(e))),this.deltaManager.on("op",(e=>this.afterProcessingOp(e))),this.deltaManager.on("connect",((e,t)=>{this.clientId=e.clientId,void 0!==t&&(this.connectionOpSeqNumber=this.deltaManager.lastKnownSeqNumber,this.gap=t,this.connectionStartTime=o.now(),this.gap<=0&&this.reportGettingUpToDate())})),this.deltaManager.on("disconnect",(()=>{this.sequenceNumberForMsnTracking=void 0,this.clientSequenceNumberForLatencyStatistics=void 0,this.opProcessingTimes={},this.opPerfData={},this.connectionOpSeqNumber=void 0,this.firstConnection=!1,this.pongCount=0})),this.deltaManager.outbound.on("push",(e=>{for(const t of e)t.type===h.Operation&&this.clientSequenceNumberForLatencyStatistics===t.clientSequenceNumber&&(s(void 0===this.opProcessingTimes.outboundPushEventTime,712),s(void 0===this.opPerfData.durationNetwork,713),this.opProcessingTimes.outboundPushEventTime=Date.now(),s(void 0===this.opPerfData.durationOutboundBatching,714),s(void 0!==this.opProcessingTimes.submitOpEventTime,715),this.opPerfData.durationOutboundBatching=this.opProcessingTimes.outboundPushEventTime-this.opProcessingTimes.submitOpEventTime)})),this.deltaManager.inbound.on("push",(e=>{this.clientId===e.clientId&&e.type===h.Operation&&this.clientSequenceNumberForLatencyStatistics===e.clientSequenceNumber&&void 0!==this.opProcessingTimes.outboundPushEventTime&&(this.opProcessingTimes.inboundPushEventTime=Date.now(),this.opPerfData.durationNetwork=this.opProcessingTimes.inboundPushEventTime-this.opProcessingTimes.outboundPushEventTime,this.opProcessingTimes.outboundPushEventTime=void 0,this.opPerfData.lengthInboundQueue=this.deltaManager.inbound.length)})),this.deltaManager.inbound.on("idle",((e,t)=>{"number"==typeof e&&e>=100&&this.logger.sendPerformanceEvent({eventName:"GetDeltas_OpProcessing",count:e,duration:t})}))}reportGettingUpToDate(){this.connectionOpSeqNumber=void 0,this.logger.sendPerformanceEvent({eventName:"ConnectionSpeed",duration:o.now()-this.connectionStartTime,ops:this.gap,timeToConnect:this.firstConnection?f.hy.formatTick(this.connectionStartTime-this.bootTime):void 0,firstConnection:this.firstConnection})}recordPingTime(e){this.pingLatency=e,this.pongCount%100==0&&this.deltaManager.active&&this.logger.sendPerformanceEvent({eventName:"DeltaLatency",duration:e}),this.pongCount++}beforeOpSubmit(e){void 0===this.clientSequenceNumberForLatencyStatistics&&e.clientSequenceNumber%500==1&&(s(void 0===this.opProcessingTimes.outboundPushEventTime,716),s(void 0===this.opPerfData.durationNetwork,717),this.opProcessingTimes.submitOpEventTime=Date.now(),this.clientSequenceNumberForLatencyStatistics=e.clientSequenceNumber)}afterProcessingOp(e){const t=e.sequenceNumber;if(t===this.connectionOpSeqNumber&&this.reportGettingUpToDate(),void 0===this.sequenceNumberForMsnTracking&&t%1e3==0&&(this.sequenceNumberForMsnTracking=t,this.msnTrackingTimestamp=e.timestamp),void 0!==this.sequenceNumberForMsnTracking&&e.minimumSequenceNumber>=this.sequenceNumberForMsnTracking&&(s(void 0!==this.msnTrackingTimestamp,718),this.logger.sendPerformanceEvent({eventName:"MsnStatistics",sequenceNumber:t,msnDistance:t-this.sequenceNumberForMsnTracking,duration:e.timestamp-this.msnTrackingTimestamp}),this.sequenceNumberForMsnTracking=void 0),this.clientId===e.clientId&&this.clientSequenceNumberForLatencyStatistics===e.clientSequenceNumber){s(void 0!==this.opProcessingTimes.submitOpEventTime,288);const n=Date.now();void 0!==this.opProcessingTimes.inboundPushEventTime&&(this.opPerfData.durationInboundToProcessing=n-this.opProcessingTimes.inboundPushEventTime);const r=n-this.opProcessingTimes.submitOpEventTime,i=r>5e3?"error":"performance";this.logger.sendPerformanceEvent(Object.assign({eventName:"OpRoundtripTime",sequenceNumber:t,referenceSequenceNumber:e.referenceSequenceNumber,duration:r,category:i,pingLatency:this.pingLatency,msnDistance:this.deltaManager.lastSequenceNumber-this.deltaManager.minimumSequenceNumber},this.opPerfData)),this.clientSequenceNumberForLatencyStatistics=void 0,this.opPerfData={}}}}class se{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}}var oe=n(7237),ae=n.n(oe);class ce{constructor(e,t,n){var r;this.stateHandler=e,this.pendingStates=new(ae()),this.disposeOnce=new se((()=>{this.initialStates.clear(),this.pendingStates.clear()})),this._pendingMessagesCount=0,this.isProcessingBatch=!1,this.dispose=()=>this.disposeOnce.value,this.initialStates=new(ae())(null!==(r=null==n?void 0:n.pendingStates)&&void 0!==r?r:[]),this.flushModeForNextMessage=t,this.onFlushModeUpdated(t)}get pendingMessagesCount(){return this._pendingMessagesCount}hasPendingMessages(){return 0!==this._pendingMessagesCount||!this.initialStates.isEmpty()}getLocalState(){if(s(this.initialStates.isEmpty(),745),this.hasPendingMessages())return{pendingStates:this.pendingStates.toArray().map((e=>"message"===e.type?Object.assign(Object.assign({},e),{localOpMetadata:void 0}):e))}}get disposed(){return this.disposeOnce.evaluated}onSubmitMessage(e,t,n,r,i,s){const o={type:"message",messageType:e,clientSequenceNumber:t,referenceSequenceNumber:n,content:r,localOpMetadata:i,opMetadata:s};this.pendingStates.push(o),this._pendingMessagesCount++}onFlushModeUpdated(e){this.pendingStates.push({type:"flushMode",flushMode:e})}onFlush(){if(this.stateHandler.flushMode()===w.FlushMode.Immediate)return;const e=this.pendingStates.peekBack();"message"===(null==e?void 0:e.type)&&this.pendingStates.push({type:"flush"})}async applyStashedOpsAt(e){for(;!this.initialStates.isEmpty();){const t=this.initialStates.peekFront();if("message"===t.type){if(void 0!==e){if(t.referenceSequenceNumber>e)break;if(t.referenceSequenceNumber<e)throw new Error("loaded from snapshot too recent to apply stashed ops")}const n=await this.stateHandler.applyStashedOp(t.messageType,t.content);t.localOpMetadata=n}this.pendingStates.push(this.initialStates.shift())}}processPendingLocalMessage(e){this.maybeProcessBatchBegin(e);const t=this.peekNextPendingState();if(s("message"===t.type,361),this.pendingStates.shift(),t.clientSequenceNumber===e.clientSequenceNumber)return this._pendingMessagesCount--,this.maybeProcessBatchEnd(e),t.localOpMetadata;{const n=S.Hi.create("pending local message clientSequenceNumber mismatch","unexpectedAckReceived",e,{expectedClientSequenceNumber:t.clientSequenceNumber});this.stateHandler.close(n)}}maybeProcessBatchBegin(e){let t,n=!1,r=this.peekNextPendingState();for(;"message"!==r.type;)"flushMode"===r.type&&(t=r.flushMode),"flush"===r.type&&(n=!0),this.pendingStates.shift(),r=this.peekNextPendingState();void 0!==t&&(this.flushModeForNextMessage=t),t!==w.FlushMode.Immediate&&(t===w.FlushMode.TurnBased||n)&&(s(!this.isProcessingBatch&&void 0===this.pendingBatchBeginMessage,363),this.pendingBatchBeginMessage=e,this.isProcessingBatch=!0)}maybeProcessBatchEnd(e){var t,n;if(!this.isProcessingBatch)return;const r=this.peekNextPendingState();if("message"===r.type)return;s("flushMode"!==r.type,701),s(void 0!==this.pendingBatchBeginMessage,365);const i=null===(t=this.pendingBatchBeginMessage.metadata)||void 0===t?void 0:t.batch;if(this.pendingBatchBeginMessage===e)s(void 0===i,366);else{const t=null===(n=e.metadata)||void 0===n?void 0:n.batch;s(!0===i,367),s(!1===t,368)}this.pendingBatchBeginMessage=void 0,this.isProcessingBatch=!1}checkpoint(){const e=this.pendingStates.peekBack();return{rollback:()=>{try{for(;this.pendingStates.peekBack()!==e;)this.rollbackNextPendingState()}catch(e){const t=(0,M.Jn)(e,(e=>S.Hi.create(`RollbackError: ${e}`,"checkpointRollback",void 0)));throw this.stateHandler.close(t),t}}}}peekNextPendingState(){const e=this.pendingStates.peekFront();return s(!!e,369),e}rollbackNextPendingState(){if(0===this.pendingStates.length)return;this._pendingMessagesCount--;const e=this.pendingStates.pop();if("message"!==e.type)throw new Error(`Can't rollback state ${e.type}`);this.stateHandler.rollback(e.messageType,e.content,e.localOpMetadata)}replayPendingStates(){s(this.stateHandler.connected(),370),s(this.clientId!==this.stateHandler.clientId(),371),this.clientId=this.stateHandler.clientId(),s(this.initialStates.isEmpty(),372);let e=this.pendingStates.length;if(0===e)return;this._pendingMessagesCount=0;const t=this.stateHandler.flushMode();for(this.stateHandler.setFlushMode(this.flushModeForNextMessage);e>0;){const t=this.pendingStates.shift();switch(t.type){case"message":this.stateHandler.reSubmit(t.messageType,t.content,t.localOpMetadata,t.opMetadata);break;case"flushMode":this.stateHandler.setFlushMode(t.flushMode);break;case"flush":this.stateHandler.flush()}e--}this.stateHandler.setFlushMode(t)}}const le="1.3.7";class ue{constructor(e,t,n){this.path=e,this.routeContext=t,this.get=n,this.attached=!1,this.absolutePath=(0,O.H)(e,this.routeContext)}get IFluidHandle(){return this}get isAttached(){return this.attached}attachGraph(){this.attached=!0}bind(e){throw new Error("Cannot bind to blob handle")}}class he{constructor(e,t,n,r,i,s,o){this.routeContext=e,this.getStorage=n,this.attachBlobCallback=r,this.gcNodeUpdated=i,this.runtime=s,this.logger=o,this.blobIds=new Set,this.pendingBlobIds=new Map,this.detachedBlobIds=new Set,this.runtime.once("dispose",(()=>{for(const e of this.pendingBlobIds.values())e.reject(new Error("runtime disposed while blobAttach op in flight"))})),this.load(t)}hasBlob(e){return this.blobIds.has(e)||this.detachedBlobIds.has(e)}getBlobGCNodePath(e){return`/${he.basePath}/${e}`}async getBlob(e){var t,n;const r=null!==(n=null===(t=this.redirectTable)||void 0===t?void 0:t.get(e))&&void 0!==n?n:e;return s(this.hasBlob(r),287),this.gcNodeUpdated(this.getBlobGCNodePath(e)),new ue(`${he.basePath}/${r}`,this.routeContext,(async()=>f.Xr.timedExecAsync(this.logger,{eventName:"AttachmentReadBlob",id:r},(async()=>this.getStorage().readBlob(r)),{end:!0,cancel:"error"})))}async createBlob(e){var t,n;this.runtime.attachState===r.mB.Attaching&&(this.logger.sendTelemetryEvent({eventName:"CreateBlobWhileAttaching"}),await new Promise((e=>this.runtime.once("attached",e)))),this.runtime.connected||this.runtime.attachState!==r.mB.Attached||await new Promise((e=>this.runtime.once("connected",e)));const i=await f.Xr.timedExecAsync(this.logger,{eventName:"createBlob"},(async()=>this.getStorage().createBlob(e)),{end:!0,cancel:"error"}),s=new ue(`${he.basePath}/${i.id}`,this.routeContext,(async()=>this.getBlob(i.id).then((async e=>e.get()))));return this.runtime.attachState===r.mB.Detached?(this.detachedBlobIds.add(i.id),s):(this.pendingBlobIds.has(i.id)?await(null===(t=this.pendingBlobIds.get(i.id))||void 0===t?void 0:t.promise):this.blobIds.has(i.id)||(this.pendingBlobIds.set(i.id,new I),this.attachBlobCallback(i.id),await(null===(n=this.pendingBlobIds.get(i.id))||void 0===n?void 0:n.promise)),s)}processBlobAttachOp(e,t){if(t){const t=this.pendingBlobIds.get(e);s(void 0!==t,504),t.resolve(),this.pendingBlobIds.delete(e)}this.blobIds.add(e)}static async load(e,t){if(!e)return{};let n;const r=e.blobs[this.redirectTableBlobName];return r&&(n=await t(r)),{ids:Object.entries(e.blobs).filter((([e,t])=>e!==this.redirectTableBlobName)).map((([e,t])=>t)),redirectTable:n}}load(e){var t,n,i;if(e.ids){const t=this.runtime.attachState===r.mB.Detached;e.ids.map((e=>t?this.detachedBlobIds.add(e):this.blobIds.add(e)))}e.redirectTable&&(this.redirectTable=new Map(e.redirectTable)),this.logger.sendTelemetryEvent({eventName:"AttachmentBlobsLoaded",count:null!==(n=null===(t=e.ids)||void 0===t?void 0:t.length)&&void 0!==n?n:0,redirectTable:null===(i=e.redirectTable)||void 0===i?void 0:i.length})}getGCData(e=!1){const t={gcNodes:{}};if(this.blobIds.forEach((e=>{t.gcNodes[this.getBlobGCNodePath(e)]=[]})),void 0!==this.redirectTable)for(const[e,n]of this.redirectTable)t.gcNodes[this.getBlobGCNodePath(e)]=[this.getBlobGCNodePath(n)];return t}deleteUnusedRoutes(e){var t;for(const n of e){const e=n.split("/");s(3===e.length&&e[1]===he.basePath,725);const r=e[2];(null===(t=this.redirectTable)||void 0===t?void 0:t.has(r))?this.redirectTable.delete(r):this.blobIds.delete(r)}}summarize(e){const t=this.redirectTable||this.runtime.attachState!==r.mB.Detached?this.blobIds:this.detachedBlobIds,n=new T.x1;return t.forEach((e=>{n.addAttachment(e)})),this.redirectTable&&this.redirectTable.size>0&&n.addBlob(he.redirectTableBlobName,JSON.stringify(Array.from(this.redirectTable.entries()))),n.getSummaryTree()}setRedirectTable(e){s(this.runtime.attachState===r.mB.Detached,594),s(!this.redirectTable,595);for(const[t,n]of e)s(this.detachedBlobIds.delete(t),596),this.blobIds.add(n);s(0===this.detachedBlobIds.size,597),this.redirectTable=e}}he.basePath="_blobs",he.redirectTableBlobName=".redirectTable";var de=n(1748),pe=n(6144);class fe extends pe.P{constructor(e,t){super(e),this.blobs=t}get policies(){return this.internalStorageService.policies}async readBlob(e){const t=this.blobs.get(e);return void 0!==t?t:this.internalStorageService.readBlob(e)}}class ge{constructor(e){this.notBoundContexts=new Set,this._contexts=new Map,this.deferredContexts=new Map,this.disposeOnce=new se((()=>{for(const[e,t]of this.deferredContexts)t.promise.then((e=>{e.dispose()})).catch((t=>{this._logger.sendErrorEvent({eventName:"FluidDataStoreContextDisposeError",fluidDataStoreId:e},t)}))})),this.dispose=()=>this.disposeOnce.value,this._logger=f.G2.create(e)}[Symbol.iterator](){return this._contexts.entries()}get size(){return this._contexts.size}get disposed(){return this.disposeOnce.evaluated}notBoundLength(){return this.notBoundContexts.size}isNotBound(e){return this.notBoundContexts.has(e)}has(e){return this._contexts.has(e)}get(e){return this._contexts.get(e)}delete(e){return this.deferredContexts.delete(e),this.notBoundContexts.delete(e),this._contexts.delete(e)}getUnbound(e){if(void 0!==this._contexts.get(e)&&this.notBoundContexts.has(e))return this._contexts.get(e)}addUnbound(e){const t=e.id;s(!this._contexts.has(t),344),this._contexts.set(t,e),this.notBoundContexts.add(t),this.ensureDeferred(t)}async getBoundOrRemoted(e,t){const n=this.ensureDeferred(e);if(t||n.isCompleted)return n.promise}ensureDeferred(e){const t=this.deferredContexts.get(e);if(t)return t;const n=new I;return this.deferredContexts.set(e,n),n}bind(e){s(this.notBoundContexts.delete(e),345),this.resolveDeferred(e)}resolveDeferred(e){const t=this._contexts.get(e);s(!!t,346),s(!this.notBoundContexts.has(e),347);const n=this.deferredContexts.get(e);s(!!n,348),n.resolve(t)}addBoundOrRemoted(e){const t=e.id;s(!this._contexts.has(t),349),this._contexts.set(t,e),this.ensureDeferred(t),this.resolveDeferred(t)}}var me=n(1044),ye=n(6171);function ve(e,t){const n=new Set,r=[...t];for(const t of r){if(n.has(t))continue;n.add(t);const i=e[t];void 0!==i&&r.push(...i)}const i=[],s=[];for(const t of Object.keys(e))n.has(t)?i.push(t):s.push(t);return{referencedNodeIds:i,deletedNodeIds:s}}var be=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const Se="gc",we="__gc",xe="DataStore",Ce="SubDataStore",Ee="Blob",Te="Active",Ae="Inactive",ke="SweepReady";class Ne{constructor(e,t,n,r){this.unreferencedTimestampMs=e,this.inactiveTimeoutMs=t,this.sweepTimeoutMs=n,this._state=Te,void 0!==r&&this.updateTracking(r)}get state(){return this._state}updateTracking(e){const t=e-this.unreferencedTimestampMs;if(void 0!==this.sweepTimeoutMs&&t>=this.sweepTimeoutMs)return this._state=ke,void this.clearTimers();if(t>=this.inactiveTimeoutMs)return this._state=Ae,this.clearTimers(),void(void 0!==this.sweepTimeoutMs&&Ie(this.sweepTimeoutMs-t,(()=>{this._state=ke}),(e=>{this.sweepTimer=e})));const n=this.inactiveTimeoutMs-t;if(void 0===this.inactiveTimer){const e=()=>{this._state=Ae,void 0!==this.sweepTimeoutMs&&Ie(this.sweepTimeoutMs-this.inactiveTimeoutMs,(()=>{this._state=ke}),(e=>{this.sweepTimer=e}))};this.inactiveTimer=new z(n,(()=>e()))}this.inactiveTimer.restart(n)}clearTimers(){var e;null===(e=this.inactiveTimer)||void 0===e||e.clear(),void 0!==this.sweepTimer&&clearTimeout(this.sweepTimer)}stopTracking(){this.clearTimers(),this._state=Te}}class Oe{constructor(e){var t,n,r,i,o,a,c;this._writeDataAtRoot=!0,this.initialStateNeedsReset=!1,this.currentGCVersion=1,this.newReferencesSinceLastRun=new Map,this.unreferencedNodesState=new Map,this.loggedUnreferencedEvents=new Set,this.pendingEventsQueue=[],this.completedRuns=0,this.runtime=e.runtime,this.isSummarizerClient=e.isSummarizerClient,this.gcOptions=e.gcOptions,this.getNodePackagePath=e.getNodePackagePath,this.getLastSummaryTimestampMs=e.getLastSummaryTimestampMs;const l=e.baseSnapshot,u=e.metadata,h=e.readAndParseBlob;let d;if(this.mc=(0,g.rZ)(f.G2.create(e.baseLogger,"GarbageCollector",{all:{completedGCRuns:()=>this.completedRuns}})),e.existing)d=je(u),this.gcEnabled=d>0,this.sweepEnabled=null!==(t=null==u?void 0:u.sweepEnabled)&&void 0!==t&&t,this.sessionExpiryTimeoutMs=null==u?void 0:u.sessionExpiryTimeoutMs;else{if(this.gcOptions.sweepAllowed&&!1===this.gcOptions.gcAllowed)throw new S.Oi("GC sweep phase cannot be enabled without enabling GC mark phase");this.gcEnabled=!1!==this.gcOptions.gcAllowed,this.sweepEnabled=!0===this.gcOptions.sweepAllowed,this.mc.config.getBoolean("Fluid.GarbageCollection.RunSessionExpiry")&&this.gcEnabled&&(this.sessionExpiryTimeoutMs=2592e6)}if(void 0!==this.sessionExpiryTimeoutMs&&!0!==this.mc.config.getBoolean("Fluid.GarbageCollection.DisableSessionExpiry")){const t=this.mc.config.getNumber("Fluid.GarbageCollection.TestOverride.SessionExpiryMs"),n=null!=t?t:this.sessionExpiryTimeoutMs;Ie(n,(()=>{this.runtime.closeFn(new S.Lf("Client session expired.",n))}),(e=>{this.sessionExpiryTimer=e})),void 0!==e.snapshotCacheExpiryMs&&(this.sweepTimeoutMs=this.sessionExpiryTimeoutMs+e.snapshotCacheExpiryMs+864e5)}if(this.latestSummaryGCVersion=null!=d?d:this.currentGCVersion,this.shouldRunGC=null!==(n=this.mc.config.getBoolean("Fluid.GarbageCollection.RunGC"))&&void 0!==n?n:this.gcEnabled&&!this.gcOptions.disableGC,this.shouldRunSweep=this.shouldRunGC&&void 0!==this.sweepTimeoutMs&&(null!==(r=this.mc.config.getBoolean("Fluid.GarbageCollection.RunSweep"))&&void 0!==r?r:this.sweepEnabled),this.trackGCState=!0===this.mc.config.getBoolean("Fluid.GarbageCollection.TrackGCState"),this.inactiveTimeoutMs=null!==(o=null!==(i=this.mc.config.getNumber("Fluid.GarbageCollection.TestOverride.InactiveTimeoutMs"))&&void 0!==i?i:this.gcOptions.inactiveTimeoutMs)&&void 0!==o?o:6048e5,void 0!==this.sweepTimeoutMs&&this.inactiveTimeoutMs>this.sweepTimeoutMs)throw new S.Oi("inactive timeout should not be greated than the sweep timeout");if(this.testMode=null!==(a=this.mc.config.getBoolean("Fluid.GarbageCollection.GCTestMode"))&&void 0!==a?a:!0===this.gcOptions.runGCInTestMode,this._writeDataAtRoot=null===(c=this.mc.config.getBoolean("Fluid.GarbageCollection.WriteDataAtRoot"))||void 0===c||c,this._writeDataAtRoot){const e=void 0!==(null==l?void 0:l.trees[Se]);this.initialStateNeedsReset=e!==this.shouldRunGC}const p=new F((async()=>{var e;if(void 0===l)return;const t=l.trees[Se];if(void 0!==t){this._writeDataAtRoot=!0;const e=await Pe(t,h);return this.trackGCState&&(this.latestSerializedSummaryState=JSON.stringify(Re(e))),e}const n={gcNodes:{"/":{outboundRoutes:[]}}},r=rt(l,u);s(void 0!==r,680);for(const[t,i]of Object.entries(r.trees)){const r=i.blobs[w.gcBlobKey];if(void 0===r)continue;const o=await h(r);if(void 0===(null===(e=o.gcData)||void 0===e?void 0:e.gcNodes))continue;const a=`/${t}`;(await h(i.blobs[He])).isRootDataStore&&n.gcNodes["/"].outboundRoutes.push(a);for(const[e,t]of Object.entries(o.gcData.gcNodes)){const r="/"===e?a:`${a}${e}`;n.gcNodes[r]={outboundRoutes:Array.from(t)}}s(void 0!==n.gcNodes[a],681),n.gcNodes[a].unreferencedTimestampMs=o.unrefTimestamp}return 1===Object.keys(n.gcNodes).length?void 0:n}));this.initializeBaseStateP=new F((async()=>{const e=this.runtime.getCurrentReferenceTimestampMs(),t=await p;if(void 0===t)return;const n={};for(const[r,i]of Object.entries(t.gcNodes))void 0!==i.unreferencedTimestampMs&&this.unreferencedNodesState.set(r,new Ne(i.unreferencedTimestampMs,this.inactiveTimeoutMs,this.sweepTimeoutMs,e)),n[r]=Array.from(i.outboundRoutes);this.previousGCDataFromLastRun={gcNodes:n}})),this.baseGCDetailsP=new F((async()=>{const e=await p;if(void 0===e)return new Map;const t={};for(const[n,r]of Object.entries(e.gcNodes))t[n]=Array.from(r.outboundRoutes);const n=ve(t,["/"]).referencedNodeIds,r=(0,k.$I)({gcData:{gcNodes:t},usedRoutes:n});for(const[t,n]of Object.entries(e.gcNodes))if(void 0!==n.unreferencedTimestampMs){const e=r.get(t.slice(1));void 0!==e&&(e.unrefTimestamp=n.unreferencedTimestampMs)}return r}));const m=JSON.stringify(Object.assign({gcEnabled:this.gcEnabled,sweepEnabled:this.sweepEnabled,runGC:this.shouldRunGC,runSweep:this.shouldRunSweep,writeAtRoot:this._writeDataAtRoot,testMode:this.testMode,sessionExpiry:this.sessionExpiryTimeoutMs,inactiveTimeout:this.inactiveTimeoutMs,existing:e.existing,trackGCState:this.trackGCState},this.gcOptions));this.isSummarizerClient&&this.mc.logger.sendTelemetryEvent({eventName:"GarbageCollectorLoaded",gcConfigs:m}),this.shouldRunGC&&this.initializeBaseStateP.catch((e=>{const t=S.Hi.wrapIfUnrecognized(e,"FailedToInitializeGC");throw t.addTelemetryProperties({gcConfigs:m}),t}))}static create(e){return new Oe(e)}get summaryStateNeedsReset(){return this.initialStateNeedsReset||this.shouldRunGC&&this.latestSummaryGCVersion!==this.currentGCVersion}get writeDataAtRoot(){return this._writeDataAtRoot}async collectGarbage(e){const{fullGC:t=!0===this.gcOptions.runFullGC||this.summaryStateNeedsReset}=e,n=e.logger?f.G2.create(e.logger,void 0,{all:{completedGCRuns:()=>this.completedRuns}}):this.mc.logger;return f.Xr.timedExecAsync(n,{eventName:"GarbageCollection"},(async e=>{await this.runPreGCSteps();const r=await this.runtime.getGCData(t),i=ve(r.gcNodes,["/"]),s=await this.runPostGCSteps(r,i,n);return e.end(Object.assign({},s)),this.completedRuns++,s}),{end:!0,cancel:"error"})}async runPreGCSteps(){await this.initializeBaseStateP,await this.runtime.updateStateBeforeGC()}async runPostGCSteps(e,t,n){const r=this.generateStats(t);this.updateStateSinceLastRun(e,n);const i=this.runtime.getCurrentReferenceTimestampMs();return this.updateCurrentState(e,t,i),this.runtime.updateUsedRoutes(t.referencedNodeIds,i),this.logSweepEvents(n,i),this.testMode&&this.runtime.deleteUnusedRoutes(t.deletedNodeIds),await this.logUnreferencedEvents(n),r}summarize(e,t,n){var r;if(!this.shouldRunGC||void 0===this.previousGCDataFromLastRun)return;const i={gcNodes:{}};for(const[e,t]of Object.entries(this.previousGCDataFromLastRun.gcNodes))i.gcNodes[e]={outboundRoutes:t,unreferencedTimestampMs:null===(r=this.unreferencedNodesState.get(e))||void 0===r?void 0:r.unreferencedTimestampMs};const s=JSON.stringify(Re(i));if(this.trackGCState&&(this.pendingSerializedSummaryState=s,void 0!==this.latestSerializedSummaryState&&this.latestSerializedSummaryState===s&&!e&&t)){const e=(0,T.Jz)();return e.handleNodeCount++,{summary:{type:p.Handle,handle:`/${Se}`,handleType:p.Tree},stats:e}}const o=new T.x1;return o.addBlob(`${we}_root`,s),o.getSummaryTree()}getMetadata(){return{gcFeature:this.gcEnabled?this.currentGCVersion:0,sessionExpiryTimeoutMs:this.sessionExpiryTimeoutMs,sweepEnabled:this.sweepEnabled}}async getBaseGCDetails(){return this.baseGCDetailsP}async latestSummaryStateRefreshed(e,t){if(!this.shouldRunGC||!e.latestSummaryUpdated)return;if(e.wasSummaryTracked)return this.latestSummaryGCVersion=this.currentGCVersion,this.initialStateNeedsReset=!1,void(this.trackGCState&&(this.latestSerializedSummaryState=this.pendingSerializedSummaryState,this.pendingSerializedSummaryState=void 0));const n=e.snapshot,r=n.blobs[Le];if(r){const e=await t(r);this.latestSummaryGCVersion=je(e)}const i=n.trees[Se];if(void 0!==i&&this.trackGCState){const e=await Pe(i,t);this.latestSerializedSummaryState=JSON.stringify(Re(e))}else this.latestSerializedSummaryState=void 0;this.pendingSerializedSummaryState=void 0}nodeUpdated(e,t,n,r,i){if(!this.shouldRunGC)return;const s=this.unreferencedNodesState.get(e);s&&s.state!==Te&&this.inactiveNodeUsed(t,e,s,void 0,r,n,i)}addedOutboundReference(e,t){var n;if(!this.shouldRunGC)return;const r=null!==(n=this.newReferencesSinceLastRun.get(e))&&void 0!==n?n:[];r.push(t),this.newReferencesSinceLastRun.set(e,r);const i=this.unreferencedNodesState.get(t);i&&i.state!==Te&&this.inactiveNodeUsed("Revived",t,i,e)}dispose(){void 0!==this.sessionExpiryTimer&&(clearTimeout(this.sessionExpiryTimer),this.sessionExpiryTimer=void 0)}updateCurrentState(e,t,n){this.previousGCDataFromLastRun=(0,k.rn)(e),this.newReferencesSinceLastRun.clear();for(const e of t.referencedNodeIds){const t=this.unreferencedNodesState.get(e);void 0!==t&&(t.stopTracking(),this.unreferencedNodesState.delete(e))}if(void 0!==n)for(const e of t.deletedNodeIds){const t=this.unreferencedNodesState.get(e);void 0===t?this.unreferencedNodesState.set(e,new Ne(n,this.inactiveTimeoutMs,this.sweepTimeoutMs,n)):t.updateTracking(n)}}updateStateSinceLastRun(e,t){if(void 0===this.previousGCDataFromLastRun)return;const n=this.findMissingExplicitReferences(e,this.previousGCDataFromLastRun,this.newReferencesSinceLastRun);if(this.writeDataAtRoot&&n.length>0&&n.forEach((e=>{const n={eventName:"gcUnknownOutboundReferences",gcNodeId:e[0],gcRoutes:JSON.stringify(e[1])};t.sendPerformanceEvent(n)})),0===this.newReferencesSinceLastRun.size)return;const r=(0,k.$4)(this.previousGCDataFromLastRun,e);this.newReferencesSinceLastRun.forEach(((e,t)=>{void 0===r.gcNodes[t]?r.gcNodes[t]=e:r.gcNodes[t].push(...e)}));const i=ve(r.gcNodes,["/"]);for(const e of i.referencedNodeIds){const t=this.unreferencedNodesState.get(e);void 0!==t&&(t.stopTracking(),this.unreferencedNodesState.delete(e))}}findMissingExplicitReferences(e,t,n){s(void 0!==t,695);const r=Object.entries(e.gcNodes),i=[];return r.forEach((([e,r])=>{var s,o;const a=null!==(s=t.gcNodes[e])&&void 0!==s?s:[],c=null!==(o=n.get(e))&&void 0!==o?o:[],l=[];r.forEach((t=>{const n=this.runtime.getNodeType(t)===Ee||this.runtime.getNodeType(t)===xe,r=!e.startsWith(t);n&&r&&!a.includes(t)&&!c.includes(t)&&l.push(t)})),l.length>0&&i.push([e,l])})),i}generateStats(e){const t={nodeCount:0,dataStoreCount:0,attachmentBlobCount:0,unrefNodeCount:0,unrefDataStoreCount:0,unrefAttachmentBlobCount:0,updatedNodeCount:0,updatedDataStoreCount:0,updatedAttachmentBlobCount:0},n=(e,n)=>{t.nodeCount++;const r=void 0===this.previousGCDataFromLastRun||this.unreferencedNodesState.has(e)===n;r&&t.updatedNodeCount++,n||t.unrefNodeCount++,this.runtime.getNodeType(e)===xe&&(t.dataStoreCount++,r&&t.updatedDataStoreCount++,n||t.unrefDataStoreCount++),this.runtime.getNodeType(e)===Ee&&(t.attachmentBlobCount++,r&&t.updatedAttachmentBlobCount++,n||t.unrefAttachmentBlobCount++)};for(const t of e.referencedNodeIds)n(t,!0);for(const t of e.deletedNodeIds)n(t,!1);return t}logSweepEvents(e,t){!0!==this.mc.config.getBoolean("Fluid.GarbageCollection.DisableSweepLog")&&void 0!==t&&void 0!==this.sweepTimeoutMs&&this.unreferencedNodesState.forEach(((n,r)=>{if(n.state!==ke)return;const i=this.runtime.getNodeType(r);if(i!==xe&&i!==Ee)return;const s=`Deleted-${r}`;this.loggedUnreferencedEvents.has(s)||(this.loggedUnreferencedEvents.add(s),e.sendTelemetryEvent({eventName:"GCObjectDeleted",id:r,type:i,age:t-n.unreferencedTimestampMs,timeout:this.sweepTimeoutMs,completedGCRuns:this.completedRuns,lastSummaryTime:this.getLastSummaryTimestampMs()}))}))}inactiveNodeUsed(e,t,n,r,i,s=this.runtime.getCurrentReferenceTimestampMs(),o){if(void 0===s||n.state===Te)return;if(!this.isSummarizerClient&&"Loaded"!==e)return;const a=this.runtime.getNodeType(t);if(a!==xe&&a!==Ee)return;const c=n.state,l=`${c}-${t}-${e}`;if(this.loggedUnreferencedEvents.has(l))return;this.loggedUnreferencedEvents.add(l);const u={id:t,type:a,unrefTime:n.unreferencedTimestampMs,age:s-n.unreferencedTimestampMs,timeout:n.state===Ae?this.inactiveTimeoutMs:this.sweepTimeoutMs,completedGCRuns:this.completedRuns,lastSummaryTime:this.getLastSummaryTimestampMs(),externalRequest:null==o?void 0:o[St.externalRequest],viaHandle:null==o?void 0:o[St.viaHandle],fromId:r};this.isSummarizerClient?this.pendingEventsQueue.push(Object.assign(Object.assign({},u),{usageType:e,state:c})):this.mc.logger.sendErrorEvent(Object.assign(Object.assign({},u),{eventName:`${c}Object_${e}`,pkg:i?{value:i.join("/"),tag:f.XI.CodeArtifact}:void 0}))}async logUnreferencedEvents(e){for(const t of this.pendingEventsQueue){const{usageType:n,state:r}=t,i=be(t,["usageType","state"]),s=this.unreferencedNodesState.get(t.id);if("Revived"===n==(void 0===s||s.state===Te)){const s=await this.getNodePackagePath(t.id),o=t.fromId?await this.getNodePackagePath(t.fromId):void 0;e.sendErrorEvent(Object.assign(Object.assign({},i),{eventName:`${r}Object_${n}`,pkg:s?{value:s.join("/"),tag:f.XI.CodeArtifact}:void 0,fromPkg:o?{value:o.join("/"),tag:f.XI.CodeArtifact}:void 0}))}}this.pendingEventsQueue=[]}}async function Pe(e,t){let n={gcNodes:{}};for(const r of Object.keys(e.blobs)){if(!r.startsWith(we))continue;const i=e.blobs[r];if(void 0===i)continue;const o=await t(i);s(void 0!==o,685),n=(0,k.eF)(n,o)}return n}function Re(e){const t=Object.entries(e.gcNodes);t.sort((([e],[t])=>e.localeCompare(t)));const n={gcNodes:{}};for(const[e,r]of t)r.outboundRoutes.sort(),n.gcNodes[e]=r;return n}function Ie(e,t,n){const r=2147483647;let i;if(e>r){const s=e-r;i=setTimeout((()=>Ie(s,t,n)),r)}else i=setTimeout((()=>t()),e);n(i)}function Fe(e){return e.summaryFormatVersion?e.summaryFormatVersion:"0.1"===e.snapshotFormatVersion?1:0}function De(e){return!!e.summaryFormatVersion&&!e.disableIsolatedChannels}const Me=".aliases",Le=".metadata",_e=".chunks",qe=".electedSummarizer",Be=".blobs";function je(e){var t;return e&&null!==(t=e.gcFeature)&&void 0!==t?t:0}const ze=[".protocol",".logTail",".serviceProtocol",Be,Se],He=".component";function Ue(e){e.summary={type:p.Tree,tree:{[w.channelsTreeName]:e.summary}},e.stats.treeNodeCount++}function Ve(e,t,n){const r=JSON.stringify(e);return n?{pkg:r,snapshotFormatVersion:"0.1",isRootDataStore:t}:{pkg:r,summaryFormatVersion:2,isRootDataStore:t}}function Ge(e,t,n){const r=Ve(e,t,n);return new me.Qp(He,JSON.stringify(r))}class We extends c{constructor(e,t,n,i,o){super(),this.existing=t,this.bindState=n,this.isLocalDataStore=i,this.makeLocallyVisibleFn=o,this._disposed=!1,this.detachedRuntimeCreation=!1,this.loaded=!1,this.pending=[],this._isInMemoryRoot=!1,this._containerRuntime=e.runtime,this.id=e.id,this.storage=e.storage,this.scope=e.scope,this.writeGCDataAtRoot=e.writeGCDataAtRoot,this.disableIsolatedChannels=e.disableIsolatedChannels,this.pkg=e.pkg,s(!this.id.includes("/"),314),this._attachState=this.containerRuntime.attachState!==r.mB.Detached&&this.existing?this.containerRuntime.attachState:r.mB.Detached,this.bindToContext=()=>{s(this.bindState===r.xU.NotBound,315),this.bindState=r.xU.Binding,s(void 0!==this.channel,316),this.makeLocallyVisible(),this.bindState=r.xU.Bound},this.summarizerNode=e.createSummarizerNodeFn((async(e,t,n)=>this.summarizeInternal(e,t,n)),(async e=>this.getGCDataInternal(e)),(async()=>this.getBaseGCDetails())),this.subLogger=f.G2.create(this.logger,"FluidDataStoreContext"),this.thresholdOpsCounter=new ye.z(We.pendingOpsCountThreshold,this.subLogger)}get packagePath(){return s(void 0!==this.pkg,313),this.pkg}get options(){return this._containerRuntime.options}get clientId(){return this._containerRuntime.clientId}get clientDetails(){return this._containerRuntime.clientDetails}get logger(){return this._containerRuntime.logger}get deltaManager(){return this._containerRuntime.deltaManager}get connected(){return this._containerRuntime.connected}get IFluidHandleContext(){return this._containerRuntime.IFluidHandleContext}get containerRuntime(){return this._containerRuntime}get isLoaded(){return this.loaded}get baseSnapshot(){return this._baseSnapshot}get disposed(){return this._disposed}get attachState(){return this._attachState}get IFluidDataStoreRegistry(){return this.registry}async isRoot(){return this.isInMemoryRoot()||(await this.getInitialSnapshotDetails()).isRootDataStore}isInMemoryRoot(){return this._isInMemoryRoot}dispose(){this._disposed||(this._disposed=!0,this.channelDeferred&&this.channelDeferred.promise.then((e=>{e.dispose()})).catch((e=>{})))}rejectDeferredRealize(e,t){throw new M.j4(e,{packageName:{value:t,tag:f.XI.PackageData}})}async realize(){return s(!this.detachedRuntimeCreation,317),this.channelDeferred||(this.channelDeferred=new I,this.realizeCore(this.existing).catch((e=>{var t;const n=S.Hi.wrapIfUnrecognized(e,"realizeFluidDataStoreContext");n.addTelemetryProperties({fluidDataStoreId:{value:this.id,tag:"PackageData"}}),null===(t=this.channelDeferred)||void 0===t||t.reject(n),this.logger.sendErrorEvent({eventName:"RealizeError"},n)}))),this.channelDeferred.promise}async factoryFromPackagePath(e){let t;s(this.pkg===e,318),void 0===e&&this.rejectDeferredRealize("packages is undefined");let n,r=this._containerRuntime.IFluidDataStoreRegistry;for(const i of e)r||this.rejectDeferredRealize("No registry for package",n),n=i,t=await r.get(i),t||this.rejectDeferredRealize("Registry does not contain entry for the package",i),r=t.IFluidDataStoreRegistry;const i=null==t?void 0:t.IFluidDataStoreFactory;return void 0===i&&this.rejectDeferredRealize("Can't find factory for package",n),{factory:i,registry:r}}async realizeCore(e){const t=await this.getInitialSnapshotDetails();this._baseSnapshot=t.snapshot;const n=t.pkg,{factory:r,registry:i}=await this.factoryFromPackagePath(n);s(void 0===this.registry,319),this.registry=i;const o=await r.instantiateDataStore(this,e);s(void 0!==o,320),this.bindRuntime(o)}setConnectionState(e,t){this.verifyNotClosed(),this.loaded&&(s(this.connected===e,321),this.channel.setConnectionState(e,t))}process(e,t,n){var r;this.verifyNotClosed();const i=e.contents,o=Object.assign(Object.assign({},e),{type:i.type,contents:i.content});if(this.summarizerNode.recordChange(o),this.loaded)return null===(r=this.channel)||void 0===r?void 0:r.process(o,t,n);s(!t,322),s(void 0!==this.pending,573),this.pending.push(o),this.thresholdOpsCounter.sendIfMultiple("StorePendingOps",this.pending.length)}processSignal(e,t){var n;this.verifyNotClosed(),this.loaded&&(null===(n=this.channel)||void 0===n||n.processSignal(e,t))}getQuorum(){return this._containerRuntime.getQuorum()}getAudience(){return this._containerRuntime.getAudience()}async summarize(e=!1,t=!0,n){return this.summarizerNode.summarize(e,t,n)}async summarizeInternal(e,t,n){await this.realize();const r=await this.channel.summarize(e,t,n);let i;this.disableIsolatedChannels||(Ue(r),i=[w.channelsTreeName]);const{pkg:s}=await this.getInitialSnapshotDetails(),o=Ve(s,await this.isRoot(),this.disableIsolatedChannels);return(0,T.Rt)(r,He,JSON.stringify(o)),this.writeGCDataAtRoot||(0,T.Rt)(r,w.gcBlobKey,JSON.stringify(this.summarizerNode.getGCSummaryDetails())),this.summarizerNode.isReferenced()||(r.summary.unreferenced=!0,r.stats.unreferencedBlobSize=r.stats.totalBlobSize),Object.assign(Object.assign({},r),{id:this.id,pathPartsForChildren:i})}async getGCData(e=!1){return this.summarizerNode.getGCData(e)}async getGCDataInternal(e=!1){return await this.realize(),s(void 0!==this.channel,323),this.channel.getGCData(e)}updateUsedRoutes(e,t){this.summarizerNode.updateUsedRoutes(e,t),this.lastUsedState={usedRoutes:e,gcTimestamp:t},this.loaded&&this.updateChannelUsedRoutes()}addedGCOutboundReference(e,t){this._containerRuntime.addedGCOutboundReference(e,t)}updateChannelUsedRoutes(){if(s(this.loaded,324),s(void 0!==this.channel,325),void 0===this.lastUsedState)return;const e=this.lastUsedState.usedRoutes.filter((e=>"/"!==e&&""!==e));this.channel.updateUsedRoutes(e,this.lastUsedState.gcTimestamp)}async request(e){return(await this.realize()).request(e)}submitMessage(e,t,n){this.verifyNotClosed(),s(!!this.channel,326);const r={content:t,type:e};this._containerRuntime.submitDataStoreOp(this.id,r,n)}setChannelDirty(e){this.verifyNotClosed();const t=this.deltaManager.lastSequenceNumber;this.summarizerNode.invalidate(t);const n=this.summarizerNode.getChild(e);n&&n.invalidate(t)}submitSignal(e,t){return this.verifyNotClosed(),s(!!this.channel,327),this._containerRuntime.submitDataStoreSignal(this.id,e,t)}makeLocallyVisible(){s(void 0!==this.channel,719),this.makeLocallyVisibleFn()}bindRuntime(e){var t;if(this.channel)throw new Error("Runtime already bound");try{s(!this.detachedRuntimeCreation,328),s(void 0!==this.channelDeferred,329),s(void 0!==this.pkg,330);const t=this.pending;for(const n of t)e.process(n,!1,void 0);this.thresholdOpsCounter.send("ProcessPendingOps",t.length),this.pending=void 0,this.loaded=!0,this.channel=e,Object.freeze(this.pkg),this.updateChannelUsedRoutes(),this.channelDeferred.resolve(this.channel)}catch(e){null===(t=this.channelDeferred)||void 0===t||t.reject(e),this.logger.sendErrorEvent({eventName:"BindRuntimeError",fluidDataStoreId:{value:this.id,tag:"PackageData"}},e)}}async getAbsoluteUrl(e){if(this.attachState===r.mB.Attached)return this._containerRuntime.getAbsoluteUrl(e)}setInMemoryRoot(){this._isInMemoryRoot=!0}reSubmit(e,t){s(!!this.channel,331);const n=e;this.channel.reSubmit(n.type,n.content,t)}rollback(e,t){if(!this.channel)throw new Error("Channel must exist when rolling back ops");if(!this.channel.rollback)throw new Error("Channel doesn't support rollback");const n=e;this.channel.rollback(n.type,n.content,t)}async applyStashedOp(e){this.channel||await this.realize(),s(!!this.channel,332);const t=e;return this.channel.applyStashedOp(t.content)}verifyNotClosed(){if(this._disposed)throw new Error("Context is closed")}getCreateChildSummarizerNodeFn(e,t){return(n,r,i)=>this.summarizerNode.createChild(n,e,t,{throwOnFailure:!0},r,i)}async uploadBlob(e){return this.containerRuntime.uploadBlob(e)}}We.pendingOpsCountThreshold=1e3;class Ke extends We{constructor(e){super(e,!0,r.xU.Bound,!1,(()=>{throw new Error("Already attached")})),this.initialSnapshotDetailsP=new F((async()=>{var e,t;let n,r=!0;if("string"==typeof this.initSnapshotValue){const t=(await this.storage.getVersions(this.initSnapshotValue,1))[0];n=null!==(e=await this.storage.getSnapshotTree(t))&&void 0!==e?e:void 0}else n=this.initSnapshotValue;const i=async e=>(0,b.g)(this.storage,e);if(n){const e=await this.summarizerNode.loadBaseSummary(n,i);n=e.baseSummary,this.pending=e.outstandingOps.concat(this.pending)}if(n&&void 0!==n.blobs[He]){const e=await i(n.blobs[He]);let o;o=Fe(e)<1?e.pkg.startsWith('["')&&e.pkg.endsWith('"]')?JSON.parse(e.pkg):[e.pkg]:JSON.parse(e.pkg),this.pkg=o,r=null===(t=e.isRootDataStore)||void 0===t||t,De(e)&&(n=n.trees[w.channelsTreeName],s(void 0!==n,510))}return{pkg:this.pkg,isRootDataStore:r,snapshot:n}})),this.initSnapshotValue=e.snapshotTree,this.baseGCDetailsP=new F((async()=>{var t;return null!==(t=await e.getBaseGCDetails())&&void 0!==t?t:{}}))}async getInitialSnapshotDetails(){return this.initialSnapshotDetailsP}async getInitialGCSummaryDetails(){return this.getBaseGCDetails()}async getBaseGCDetails(){return this.baseGCDetailsP}generateAttachMessage(){throw new Error("Cannot attach remote store")}}class $e extends We{constructor(e){super(e,void 0!==e.snapshotTree,e.snapshotTree?r.xU.Bound:r.xU.NotBound,!0,e.makeLocallyVisibleFn),this.snapshotTree=e.snapshotTree,!0===e.isRootDataStore&&this.setInMemoryRoot(),this.createProps=e.createProps,this.attachListeners()}attachListeners(){this.once("attaching",(()=>{s(this.attachState===r.mB.Detached,333),this._attachState=r.mB.Attaching})),this.once("attached",(()=>{s(this.attachState===r.mB.Attaching,334),this._attachState=r.mB.Attached}))}generateAttachMessage(){s(void 0!==this.channel,335),s(void 0!==this.pkg,336);const e=this.channel.getAttachSummary();this.disableIsolatedChannels||Ue(e);const t=Ve(this.pkg,this.isInMemoryRoot(),this.disableIsolatedChannels);(0,T.Rt)(e,He,JSON.stringify(t));const n=(0,T.H4)(e.summary);return{id:this.id,snapshot:n,type:this.pkg[this.pkg.length-1]}}async getInitialSnapshotDetails(){var e;let t,n=this.snapshotTree,r=!1;return void 0!==n&&(t=await async function(e,t){const n=await(0,b.g)(e,t.blobs[He]);return s(Fe(n)>0,469),n}(this.storage,n),De(t)&&(n=n.trees[w.channelsTreeName],s(void 0!==n,511)),void 0===this.pkg&&(this.pkg=JSON.parse(t.pkg),(null===(e=t.isRootDataStore)||void 0===e||e)&&(r=!0,this.setInMemoryRoot()))),s(void 0!==this.pkg,338),{pkg:this.pkg,isRootDataStore:r,snapshot:n}}async getInitialGCSummaryDetails(){return{}}async getBaseGCDetails(){return{}}}class Je extends $e{constructor(e){super(e)}}class Qe extends $e{constructor(e){super(e),this.detachedRuntimeCreation=!0}async attachRuntime(e,t){s(this.detachedRuntimeCreation,340),s(void 0===this.channelDeferred,341);const n=e.IFluidDataStoreFactory,r=await this.factoryFromPackagePath(this.pkg);s(r.factory===n,342),s(void 0===this.registry,343),this.registry=r.registry,this.detachedRuntimeCreation=!1,this.channelDeferred=new I,super.bindRuntime(t),await this.isRoot()&&(void 0!==t.makeVisibleAndAttachGraph?t.makeVisibleAndAttachGraph():t.bindToContext())}async getInitialSnapshotDetails(){if(this.detachedRuntimeCreation)throw new Error("Detached Fluid Data Store context can't be realized! Please attach runtime first!");return super.getInitialSnapshotDetails()}}const Xe=e=>"string"==typeof(null==e?void 0:e.internalId)&&"string"==typeof(null==e?void 0:e.alias),Ze=(e,t,n,r,i)=>new tt(e,t,n,r,i);var Ye,et;!function(e){e.Aliased="Aliased",e.Aliasing="Aliasing",e.None="None"}(Ye||(Ye={}));class tt{constructor(e,t,n,r,i){this.fluidDataStoreChannel=e,this.internalId=t,this.runtime=n,this.datastores=r,this.logger=i,this.aliasState=Ye.None}async trySetAlias(e){if(e.includes("/"))throw new S.Oi(`The alias cannot contain slashes: '${e}'`);switch(this.aliasState){case Ye.Aliasing:return s(void 0!==this.aliasResult,790),await this.aliasResult,this.alias===e?"Success":"AlreadyAliased";case Ye.Aliased:return this.alias===e?"Success":"AlreadyAliased";case Ye.None:break;default:l(this.aliasState)}return this.aliasState=Ye.Aliasing,this.aliasResult=this.trySetAliasInternal(e),this.aliasResult}async trySetAliasInternal(e){const t={internalId:this.internalId,alias:e};if(void 0!==this.fluidDataStoreChannel.makeVisibleAndAttachGraph?this.fluidDataStoreChannel.makeVisibleAndAttachGraph():this.fluidDataStoreChannel.bindToContext(),this.runtime.attachState===r.mB.Detached){const e=this.datastores.processAliasMessageCore(t);return this.aliasState=Ye.Aliased,e?"Success":"Conflict"}return await this.ackBasedPromise((e=>{this.runtime.submitDataStoreAliasOp(t,e)})).then((t=>(this.aliasState=Ye.Aliased,t&&(this.alias=e),t))).catch((t=>(this.logger.sendErrorEvent({eventName:"AliasingException",alias:{value:e,tag:f.XI.UserData},internalId:{value:this.internalId,tag:f.XI.PackageData}},t),this.aliasState=Ye.None,!1)))?"Success":"Conflict"}async request(e){return this.fluidDataStoreChannel.request(e)}get IFluidRouter(){return this.fluidDataStoreChannel}async ackBasedPromise(e){let t;return new Promise(((n,r)=>{t=()=>r(new Error("ContainerRuntime disposed while this ack-based Promise was pending")),this.runtime.disposed?t():(this.runtime.on("dispose",t),e(n,r))})).finally((()=>{this.runtime.off("dispose",t)}))}}class nt{constructor(e,t,n,i,s,o,a,c,l,u,h=new ge(o)){this.baseSnapshot=e,this.runtime=t,this.submitAttachFn=n,this.getCreateChildSummarizerNodeFn=i,this.deleteChildSummarizerNodeFn=s,this.gcNodeUpdated=c,this.aliasMap=l,this.writeGCDataAtRoot=u,this.contexts=h,this.pendingAttach=new Map,this.attachOpFiredForDataStore=new Set,this.disposeOnce=new se((()=>this.contexts.dispose())),this.dataStoresSinceLastGC=[],this.dispose=()=>this.disposeOnce.value,this.logger=f.G2.create(o),this.containerRuntimeHandle=new B.B(this.runtime,"/",this.runtime.IFluidHandleContext);const d=new F((async()=>a())),p=async e=>(await d).get(e),g=new Map;if(e)for(const[t,n]of Object.entries(e.trees))g.set(t,n);let m=0;for(const[e,t]of g){let n;if(t.unreferenced&&m++,this.runtime.attachState!==r.mB.Detached)n=new Ke({id:e,snapshotTree:t,getBaseGCDetails:async()=>p(e),runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(e,{type:w.CreateSummarizerNodeSource.FromSummary}),writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels});else{if("object"!=typeof t)throw new M.j4("Snapshot should be there to load from!!");const r=t;n=new Je({id:e,pkg:void 0,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(e,{type:w.CreateSummarizerNodeSource.FromSummary}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(e),snapshotTree:r,isRootDataStore:void 0,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels})}this.contexts.addBoundOrRemoted(n)}this.containerLoadStats={containerLoadDataStoreCount:g.size,referencedDataStoreCount:g.size-m}}aliases(){return this.aliasMap}processAttachMessage(e,t){var n,r;const i=e.contents;if(this.dataStoresSinceLastGC.push(i.id),t)return s(this.pendingAttach.has(i.id),350),null===(n=this.contexts.get(i.id))||void 0===n||n.emit("attached"),void this.pendingAttach.delete(i.id);if(this.alreadyProcessed(i.id))throw new S.Jd("Duplicate DataStore created with existing id",Object.assign(Object.assign({},(0,S.HN)(e)),{dataStoreId:{value:i.id,tag:f.XI.PackageData}}));const o=new Map;let a;i.snapshot&&(a=(0,de.m)(i.snapshot.entries,o));const c=[i.type],l=new Ke({id:i.id,snapshotTree:a,getBaseGCDetails:async()=>({}),runtime:this.runtime,storage:new fe(this.runtime.storage,o),scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(i.id,{type:w.CreateSummarizerNodeSource.FromAttach,sequenceNumber:e.sequenceNumber,snapshot:null!==(r=i.snapshot)&&void 0!==r?r:{entries:[Ge(c,!0,this.runtime.disableIsolatedChannels)]}}),writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels,pkg:c});this.contexts.addBoundOrRemoted(l)}processAliasMessage(e,t,n){const r=e.contents;if(!Xe(r))throw new S.Jd("malformedDataStoreAliasMessage",Object.assign({},(0,S.HN)(e)));const i=t,s=this.processAliasMessageCore(r);n&&i(s)}processAliasMessageCore(e){if(this.alreadyProcessed(e.alias))return!1;const t=this.contexts.get(e.internalId);if(void 0===t)return this.logger.sendErrorEvent({eventName:"AliasFluidDataStoreNotFound",fluidDataStoreId:e.internalId}),!1;const n=new B.B(t,e.internalId,this.runtime.IFluidHandleContext);return this.runtime.addedGCOutboundReference(this.containerRuntimeHandle,n),this.aliasMap.set(e.alias,t.id),t.setInMemoryRoot(),!0}alreadyProcessed(e){return void 0!==this.aliasMap.get(e)||void 0!==this.contexts.get(e)}makeDataStoreLocallyVisible(e){const t=this.contexts.getUnbound(e);if(s(!!t,351),this.runtime.attachState!==r.mB.Detached){t.emit("attaching");const n=t.generateAttachMessage();this.pendingAttach.set(e,n),this.submitAttachFn(n),this.attachOpFiredForDataStore.add(e)}this.contexts.bind(e)}createDetachedDataStoreCore(e,t,n=(0,N.Z)()){s(!n.includes("/"),780);const r=new Qe({id:n,pkg:e,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(n,{type:w.CreateSummarizerNodeSource.Local}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(n),snapshotTree:void 0,isRootDataStore:t,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels});return this.contexts.addUnbound(r),r}_createFluidDataStoreContext(e,t,n,r){s(!t.includes("/"),781);const i=new Je({id:t,pkg:e,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(t,{type:w.CreateSummarizerNodeSource.Local}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(t),snapshotTree:void 0,isRootDataStore:n,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels,createProps:r});return this.contexts.addUnbound(i),i}get disposed(){return this.disposeOnce.evaluated}resubmitDataStoreOp(e,t){const n=e,r=this.contexts.get(n.address);s(!!r,352),r.reSubmit(n.contents,t)}rollbackDataStoreOp(e,t){const n=e,r=this.contexts.get(n.address);s(!!r,744),r.rollback(n.contents,t)}async applyStashedOp(e){const t=e,n=this.contexts.get(t.address);return s(!!n,353),n.applyStashedOp(t.contents)}async applyStashedAttachOp(e){this.pendingAttach.set(e.id,e),this.processAttachMessage({contents:e},!1)}processFluidDataStoreOp(e,t,n){const r=e.contents,i=Object.assign(Object.assign({},e),{contents:r.contents}),o=this.contexts.get(r.address);s(!!o,354),o.process(i,t,n),this.gcNodeUpdated(`/${r.address}`,e.timestamp,o.isLoaded?o.packagePath:void 0)}async getDataStore(e,t){const n=await this.contexts.getBoundOrRemoted(e,t);if(void 0===n){const t={url:e};throw(0,E.fu)((0,E.I4)(t),t)}return n}processSignal(e,t,n){const r=this.contexts.get(e);if(!r)return s(!n,355),void this.logger.sendTelemetryEvent({eventName:"SignalFluidDataStoreNotFound",fluidDataStoreId:{value:e,tag:f.XI.PackageData}});r.processSignal(t,n)}setConnectionState(e,t){for(const[n,r]of this.contexts)try{r.setConnectionState(e,t)}catch(e){this.logger.sendErrorEvent({eventName:"SetConnectionStateError",clientId:t,fluidDataStore:n},e)}}setAttachState(e){let t;t=e===r.mB.Attaching?"attaching":"attached";for(const[,e]of this.contexts)this.contexts.isNotBound(e.id)||e.emit(t)}get size(){return this.contexts.size}async summarize(e,t,n){const i=new T.x1;return await Promise.all(Array.from(this.contexts).filter((([e,t])=>(s(t.attachState!==r.mB.Attaching,357),t.attachState===r.mB.Attached))).map((async([r,s])=>{const o=await s.summarize(e,t,n);i.addWithStats(r,o)}))),i.getSummaryTree()}createSummary(e){const t=new T.x1;let n;do{const e=t.summary.tree;n=this.contexts.notBoundLength(),Array.from(this.contexts).filter((([t,n])=>!(this.contexts.isNotBound(t)||e[t]||this.attachOpFiredForDataStore.has(t)))).map((([e,n])=>{let r;if(n.isLoaded){const e=n.generateAttachMessage().snapshot;r=(0,T.j9)(e,!0)}else s(!!this.baseSnapshot,358),r=(0,T.S5)(this.baseSnapshot.trees[e]);t.addWithStats(e,r)}))}while(n!==this.contexts.notBoundLength());return t.getSummaryTree()}async updateStateBeforeGC(){for(const e of this.dataStoresSinceLastGC){const t=this.contexts.get(e);if(s(void 0!==t,694),await t.isRoot()){const n=new B.B(t,e,this.runtime.IFluidHandleContext);this.runtime.addedGCOutboundReference(this.containerRuntimeHandle,n)}}this.dataStoresSinceLastGC=[]}async getGCData(e=!1){const t=new k.iR;return await Promise.all(Array.from(this.contexts).filter((([e,t])=>t.attachState===r.mB.Attached)).map((async([n,r])=>{const i=await r.getGCData(e);t.prefixAndAddNodes(n,i.gcNodes)}))),t.addNode("/",await this.getOutboundRoutes()),t.getGCData()}updateUsedRoutes(e,t){var n;const r=(0,k.xu)(e);for(const[e]of r)s(this.contexts.has(e),359);for(const[e,i]of this.contexts)i.updateUsedRoutes(null!==(n=r.get(e))&&void 0!==n?n:[],t)}deleteUnusedRoutes(e){for(const t of e){const e=t.split("/");if(e.length>2)continue;const n=e[1];s(this.contexts.has(n),727),this.contexts.delete(n),this.deleteChildSummarizerNodeFn(n)}}async getOutboundRoutes(){const e=[];for(const[t,n]of this.contexts)await n.isRoot()&&e.push(`/${t}`);return e}async getDataStorePackagePath(e){var t;const n=this.contexts.get(e.split("/")[1]);return null===(t=await(null==n?void 0:n.getInitialSnapshotDetails()))||void 0===t?void 0:t.pkg}getGCNodeType(e){const t=e.split("/");if(this.contexts.has(t[1]))return 2===t.length?xe:Ce}}function rt(e,t){if(e){if(function(e){return!!e&&!e.disableIsolatedChannels}(t)){const t=e.trees[w.channelsTreeName];return s(!!t,360),t}{const t={};for(const[n,r]of Object.entries(e.trees))ze.includes(n)||(t[n]=r);return Object.assign(Object.assign({},e),{trees:t})}}}!function(e){e[e.Local=0]="Local",e[e.Broadcast=1]="Broadcast",e[e.Acked=2]="Acked",e[e.Nacked=-1]="Nacked"}(et||(et={}));class it{constructor(e,t){this.clientId=e,this.clientSequenceNumber=t,this.state=et.Local,this.defSummaryOp=new I,this.defSummaryAck=new I}static createLocal(e,t){return new it(e,t)}static createFromOp(e){const t=new it(e.clientId,e.clientSequenceNumber);return t.broadcast(e),t}get summaryOp(){return this._summaryOp}get summaryAckNack(){return this._summaryAckNack}hasBeenAcked(){return this.state===et.Acked}broadcast(e){return s(this.state===et.Local,373),this._summaryOp=e,this.defSummaryOp.resolve(),this.state=et.Broadcast,!0}ackNack(e){return s(this.state===et.Broadcast,374),this._summaryAckNack=e,this.defSummaryAck.resolve(),this.state=e.type===h.SummaryAck?et.Acked:et.Nacked,!0}async waitBroadcast(){return await this.defSummaryOp.promise,this._summaryOp}async waitAckNack(){return await this.defSummaryAck.promise,this._summaryAckNack}}class st{constructor(e,t){this.clientId=e,this.summaryCollection=t,this.localSummaries=new Map,this._disposed=!1}get disposed(){return this._disposed}watchSummary(e){let t=this.localSummaries.get(e);return t||(t=it.createLocal(this.clientId,e),this.localSummaries.set(t.clientSequenceNumber,t)),t}waitFlushed(){return this.summaryCollection.waitFlushed()}tryGetSummary(e){return this.localSummaries.get(e)}setSummary(e){this.localSummaries.set(e.clientSequenceNumber,e)}dispose(){this.summaryCollection.removeWatcher(this.clientId),this._disposed=!0}}class ot extends c{constructor(e,t){super(),this.deltaManager=e,this.logger=t,this.summaryWatchers=new Map,this.pendingSummaries=new Map,this.refreshWaitNextAck=new I,this.deltaManager.on("op",(e=>this.handleOp(e)))}get latestAck(){return this.lastAck}emit(e,...t){return super.emit(e,...t)}get opsSinceLastAck(){var e,t;return this.deltaManager.lastSequenceNumber-(null!==(t=null===(e=this.lastAck)||void 0===e?void 0:e.summaryAck.sequenceNumber)&&void 0!==t?t:this.deltaManager.initialSequenceNumber)}addOpListener(e){this.deltaManager.on("op",e)}removeOpListener(e){this.deltaManager.off("op",e)}createWatcher(e){const t=new st(e,this);return this.summaryWatchers.set(e,t),t}removeWatcher(e){this.summaryWatchers.delete(e)}setPendingAckTimerTimeoutCallback(e,t){this.maxAckWaitTime=e,this.pendingAckTimerTimeoutCallback=t}unsetPendingAckTimerTimeoutCallback(){this.maxAckWaitTime=void 0,this.pendingAckTimerTimeoutCallback=void 0}async waitFlushed(){for(;this.pendingSummaries.size>0;){const e=Array.from(this.pendingSummaries,(([,e])=>e.waitAckNack()));await Promise.all(e)}return this.lastAck}async waitSummaryAck(e){for(;!this.lastAck||this.lastAck.summaryOp.referenceSequenceNumber<e;)await this.refreshWaitNextAck.promise;return this.lastAck}handleOp(e){var t;switch(e.type){case h.Summarize:return void this.handleSummaryOp(e);case h.SummaryAck:return void this.handleSummaryAck(e);case h.SummaryNack:return void this.handleSummaryNack(e);default:{const n=e.timestamp;return void 0!==this.lastSummaryTimestamp&&void 0!==this.maxAckWaitTime&&n-this.lastSummaryTimestamp>=this.maxAckWaitTime&&(null===(t=this.pendingAckTimerTimeoutCallback)||void 0===t||t.call(this)),void this.emit("default",e)}}}handleSummaryOp(e){let t;const n=this.summaryWatchers.get(e.clientId);n&&(t=n.tryGetSummary(e.clientSequenceNumber),t&&t.broadcast(e)),t||(t=it.createFromOp(e),n&&n.setSummary(t)),this.pendingSummaries.set(e.sequenceNumber,t),this.lastSummaryTimestamp=e.timestamp,this.emit(h.Summarize,e)}handleSummaryAck(e){const t=e.contents.summaryProposal.summarySequenceNumber,n=this.pendingSummaries.get(t);n&&void 0!==n.summaryOp?(n.ackNack(e),this.pendingSummaries.delete(t),(!this.lastAck||t>this.lastAck.summaryAck.contents.summaryProposal.summarySequenceNumber)&&(this.lastAck={summaryOp:n.summaryOp,summaryAck:e},this.refreshWaitNextAck.resolve(),this.refreshWaitNextAck=new I,this.emit(h.SummaryAck,e))):t>=this.deltaManager.initialSequenceNumber&&this.logger.sendErrorEvent({eventName:"SummaryAckWithoutOp",sequenceNumber:e.sequenceNumber,summarySequenceNumber:t,initialSequenceNumber:this.deltaManager.initialSequenceNumber})}handleSummaryNack(e){const t=e.contents.summaryProposal.summarySequenceNumber,n=this.pendingSummaries.get(t);n&&(n.ackNack(e),this.pendingSummaries.delete(t),this.emit(h.SummaryNack,e))}}class at extends c{constructor(e,t,n){super(),this.clientMap=new Map,this.rootNode={sequenceNumber:-1,olderClient:void 0,youngerClient:void 0},this._youngestClient=this.rootNode,this.logger=f.G2.create(e,"OrderedClientCollection");const r=n.getMembers();for(const[e,t]of r)this.addClient(e,t);n.on("addMember",((e,n)=>{const r=this.addClient(e,n);this.emit("addClient",r,t.lastSequenceNumber)})),n.on("removeMember",(e=>{const n=t.lastSequenceNumber,r=this.removeClient(e);void 0===r?this.logger.sendErrorEvent({eventName:"ClientNotFound",clientId:e,sequenceNumber:n}):this.emit("removeClient",r,n)}))}get count(){return this.clientMap.size}get oldestClient(){return this.rootNode.youngerClient}addClient(e,t){s(t.sequenceNumber>-1,502);let n=this._youngestClient;for(;n.sequenceNumber>t.sequenceNumber;)s(void 0!==n.olderClient,503),n=n.olderClient;const r={clientId:e,sequenceNumber:t.sequenceNumber,client:Object.assign({},t.client),olderClient:n,youngerClient:n.youngerClient};return r.olderClient.youngerClient=r,void 0===r.youngerClient?this._youngestClient=r:r.youngerClient.olderClient=r,this.clientMap.set(e,r),r}removeClient(e){const t=this.clientMap.get(e);if(void 0!==t)return t.olderClient.youngerClient=t.youngerClient,void 0===t.youngerClient?this._youngestClient=t.olderClient:t.youngerClient.olderClient=t.olderClient,this.clientMap.delete(e),t}getAllClients(){const e=[];let t=this.rootNode;for(;void 0!==t.youngerClient;)e.push(t.youngerClient),t=t.youngerClient;return e}}class ct extends c{constructor(e,t,n,r){let i,s;super(),this.orderedClientCollection=t,this.isEligibleFn=r,this._eligibleCount=0;for(const e of t.getAllClients())this.addClient(e,0),"number"!=typeof n&&(e.clientId===n.electedClientId&&(i=e,void 0===n.electedParentId&&e.client.details.type!==_&&(s=e)),e.clientId===n.electedParentId&&(s=e));t.on("addClient",((e,t)=>this.addClient(e,t))),t.on("removeClient",((e,t)=>this.removeClient(e,t))),"number"==typeof n?this._electionSequenceNumber=n:((null==i?void 0:i.clientId)!==n.electedClientId?e.sendErrorEvent({eventName:"InitialElectedClientNotFound",electionSequenceNumber:n.electionSequenceNumber,expectedClientId:n.electedClientId,electedClientId:null==i?void 0:i.clientId,clientCount:t.count}):void 0===i||r(i)||(i=s=this.findFirstEligibleParent(s),e.sendErrorEvent({eventName:"InitialElectedClientIneligible",electionSequenceNumber:n.electionSequenceNumber,expectedClientId:n.electedClientId,electedClientId:null==i?void 0:i.clientId})),this._electedParent=s,this._electedClient=i,this._electionSequenceNumber=n.electionSequenceNumber)}get eligibleCount(){return this._eligibleCount}get electionSequenceNumber(){return this._electionSequenceNumber}get electedClient(){return this._electedClient}get electedParent(){return this._electedParent}tryElectingClient(e,t){let n=!1;const r=(null==e?void 0:e.client.details.type)===_,i=this._electedClient;this._electedClient!==e&&(this._electionSequenceNumber=t,this._electedClient=e,n=!0),this._electedParent===e||r||(this._electedParent=e,n=!0),n&&this.emit("election",e,t,i)}tryElectingParent(e,t){this._electedParent!==e&&(this._electedParent=e,this.emit("election",this._electedClient,t,this._electedClient))}findFirstEligibleParent(e){let t=e;for(;void 0!==t&&(!this.isEligibleFn(t)||t.client.details.type===_);)t=t.youngerClient;return t}addClient(e,t){var n;if(this.isEligibleFn(e)){this._eligibleCount++;const r=e.client.details.type===_,i=(null===(n=this._electedClient)||void 0===n?void 0:n.client.details.type)===_;void 0===this._electedClient||!i&&r?this.tryElectingClient(e,t):void 0!==this._electedParent||r||this.tryElectingParent(e,t)}}removeClient(e,t){var n,r,i,s,o;if(this.isEligibleFn(e))if(this._eligibleCount--,this._electedClient===e)if(this._electedParent!==e){if(this._electedClient.client.details.type!==_)throw new S.Oi("Elected client should be a summarizer client 1");this.tryElectingClient(this._electedParent,t)}else{const e=null!==(r=this.findFirstEligibleParent(null===(n=this._electedParent)||void 0===n?void 0:n.youngerClient))&&void 0!==r?r:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this.tryElectingClient(e,t)}else if(this._electedParent===e){if((null===(i=this._electedClient)||void 0===i?void 0:i.client.details.type)!==_)throw new S.Oi("Elected client should be a summarizer client 2");const e=null!==(o=this.findFirstEligibleParent(null===(s=this._electedParent)||void 0===s?void 0:s.youngerClient))&&void 0!==o?o:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this.tryElectingParent(e,t)}}getAllEligibleClients(){return this.orderedClientCollection.getAllClients().filter(this.isEligibleFn)}incrementElectedClient(e){var t,n;const r=null!==(n=this.findFirstEligibleParent(null===(t=this._electedParent)||void 0===t?void 0:t.youngerClient))&&void 0!==n?n:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);void 0===this._electedClient||this._electedClient===this._electedParent?this.tryElectingClient(r,e):this.tryElectingParent(r,e)}resetElectedClient(e){const t=this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);void 0===this._electedClient||this._electedClient===this._electedParent?this.tryElectingClient(t,e):this.tryElectingParent(t,e)}peekNextElectedClient(){var e,t;return null!==(t=this.findFirstEligibleParent(null===(e=this._electedParent)||void 0===e?void 0:e.youngerClient))&&void 0!==t?t:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient)}serialize(){var e,t;return{electionSequenceNumber:this.electionSequenceNumber,electedClientId:null===(e=this.electedClient)||void 0===e?void 0:e.clientId,electedParentId:null===(t=this.electedParent)||void 0===t?void 0:t.clientId}}}class lt{constructor(e,t,n){this.delayWindowMs=e,this.maxDelayMs=t,this.delayFn=n,this.startTimes=[]}get numAttempts(){return this.startTimes.length}getAttempts(){return[...this.startTimes]}get latestAttemptTime(){return this.startTimes.length>0?this.startTimes[this.startTimes.length-1]:void 0}getDelay(){const e=Date.now(),t=this.latestAttemptTime;if(void 0!==t){const n=t-e;n>0&&(this.startTimes=this.startTimes.map((e=>e-n)))}this.startTimes=this.startTimes.filter((t=>e-t<this.delayWindowMs));const n=Math.min(this.delayFn(this.startTimes.length),this.maxDelayMs);return this.startTimes.push(e),this.startTimes=this.startTimes.map((e=>e+n)),n===this.maxDelayMs&&this.startTimes.shift(),n}}new Promise((()=>{}));class ut{constructor(e){this.runtime=e,this._cancelled=!1,this.stopDeferred=new I}get cancelled(){return this._cancelled||s(this.runtime.deltaManager.active,605),this._cancelled}get waitCancelled(){return this.stopDeferred.promise}static async create(e){const t=new ut(e);return await t.waitStart(),t}async waitStart(){if(this.runtime.disposed)this.stop("summarizerClientDisconnected");else{if(this.runtime.once("dispose",(()=>this.stop("summarizerClientDisconnected"))),!this.runtime.connected){const e=new Promise((e=>this.runtime.once("connected",e)));await Promise.race([e,this.waitCancelled])}this.runtime.once("disconnected",(()=>this.stop("summarizerClientDisconnected")))}}stop(e){this._cancelled||(this._cancelled=!0,this.stopDeferred.resolve(e))}}class ht{constructor(e,t,n,r,i=(()=>o.now())){this.batchEventEmitter=e,this.trackedBatchCount=0,this.logger=f.G2.create(t,"Batching"),this.batchEventEmitter.on("batchBegin",(e=>{this.startBatchSequenceNumber=e.sequenceNumber,this.batchProcessingStartTimeStamp=i(),this.trackedBatchCount++})),this.batchEventEmitter.on("batchEnd",((e,t)=>{s(void 0!==this.startBatchSequenceNumber&&void 0!==this.batchProcessingStartTimeStamp,698);const o=t.sequenceNumber-this.startBatchSequenceNumber+1;o>=n&&this.logger.sendErrorEvent({eventName:"LengthTooBig",length:o,threshold:n,batchEndSequenceNumber:t.sequenceNumber,duration:i()-this.batchProcessingStartTimeStamp,batchError:void 0!==e}),this.trackedBatchCount%r==0&&this.logger.sendPerformanceEvent({eventName:"Length",length:o,samplingRate:r,batchEndSequenceNumber:t.sequenceNumber,duration:i()-this.batchProcessingStartTimeStamp}),this.startBatchSequenceNumber=void 0,this.batchProcessingStartTimeStamp=void 0}))}}var dt=n(9742);const pt=(e,t)=>gt.from(e).toString(t);function ft(e){const t=e;return e instanceof ArrayBuffer||"object"==typeof t&&null!==t&&"number"==typeof t.byteLength&&"function"==typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}class gt extends Uint8Array{toString(e){return function(e,t){switch(t){case"base64":return dt.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}(this,e)}static from(e,t,n){if("string"==typeof e)return gt.fromString(e,t);if(null!==e&&"object"==typeof e&&ft(e.buffer))return s(0===e.byteOffset,0),s(e.byteLength===e.buffer.byteLength,1),gt.fromArrayBuffer(e.buffer,t,n);if(ft(e))return gt.fromArrayBuffer(e,t,n);throw new TypeError}static fromArrayBuffer(e,t,n){const r=null!=t?t:0,i=null!=n?n:e.byteLength-r;if(r<0||r>e.byteLength||i<0||i+r>e.byteLength)throw new RangeError;return new gt(e,r,i)}static fromString(e,t){switch(t){case"base64":{const t=this.sanitizeBase64(e),n=dt.toByteArray(t);return new gt(n.buffer)}case"utf8":case"utf-8":case void 0:{const t=(new TextEncoder).encode(e);return new gt(t.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!=0&&(t+=["","===","==","="][t.length%4]),t}}class mt{constructor(e,t){this.storageGetter=e,this.blobs=t}static async serializeTree(e,t){const n={};return await this.serializeTreeCore(e,n,t),n}static async serializeTreeCore(e,t,n){const r=[];for(const i of Object.values(e.trees))r.push(this.serializeTreeCore(i,t,n));for(const r of Object.values(e.blobs)){const e=await n.readBlob(r);t[r]=pt(e,"utf8")}return Promise.all(r)}static serializeTreeWithBlobContents(e){const t={};return this.serializeTreeWithBlobContentsCore(e,t),t}static serializeTreeWithBlobContentsCore(e,t){for(const n of Object.values(e.trees))this.serializeTreeWithBlobContentsCore(n,t);for(const n of Object.values(e.blobs)){const r=e.blobsContents[n];s(!!r,748),t[n]=pt(r,"utf8")}}get storage(){return this._storage||(this._storage=this.storageGetter()),this._storage}get repositoryUrl(){return this.storage.repositoryUrl}async readBlob(e){return void 0!==this.blobs[e]?(t=this.blobs[e],"utf8",gt.from(t,"utf8").buffer):this.storage.readBlob(e);var t}async getSnapshotTree(e){return this.storage.getSnapshotTree(e)}async getVersions(e,t){return this.storage.getVersions(e,t)}async createBlob(e){return this.storage.createBlob(e)}async uploadSummaryWithContext(e,t){return this.storage.uploadSummaryWithContext(e,t)}async downloadSummary(e){return this.storage.downloadSummary(e)}}class yt{constructor(e,t){this.messageSize=new Map,this._nonSystemOpCount=0,this._opsSizeAccumulator=0,t||(e.inbound.on("push",(e=>{var t;const n="string"==typeof e.contents?e.contents:null!==(t=JSON.stringify(e.contents))&&void 0!==t?t:"",r=yt.messageHasData(e)?e.data:"";this.messageSize[yt.messageId(e)]=n.length+r.length})),e.on("op",(e=>{var t;this._nonSystemOpCount+=(0,v.LW)(e)?1:0;const n=yt.messageId(e);this._opsSizeAccumulator+=null!==(t=this.messageSize[n])&&void 0!==t?t:0,this.messageSize.delete(n)})))}get nonSystemOpCount(){return this._nonSystemOpCount}get opsSizeAccumulator(){return this._opsSizeAccumulator}static messageId(e){return e.sequenceNumber}static messageHasData(e){return void 0!==e.data}reset(){this._nonSystemOpCount=0,this._opsSizeAccumulator=0}}var vt;!function(e){e.FluidDataStoreOp="component",e.Attach="attach",e.ChunkedOp="chunkedOp",e.BlobAttach="blobAttach",e.Rejoin="rejoin",e.Alias="alias"}(vt||(vt={}));const bt={state:"enabled",idleTime:15e3,maxTime:6e4,maxOps:100,minOpsForLastSummaryAttempt:10,maxAckWaitTime:6e4,maxOpsSinceLastSummary:7e3,initialSummarizerDelayMs:5e3,summarizerClientElection:!1};var St;!function(e){e.wait="wait",e.externalRequest="externalRequest",e.viaHandle="viaHandle"}(St||(St={}));const wt=w.FlushMode.TurnBased;var xt;!function(e){e.FluidDataStoreOp="component",e.Attach="attach",e.ChunkedOp="chunkedOp",e.BlobAttach="blobAttach",e.Rejoin="rejoin",e.Alias="alias",e.Operation="op"}(xt||(xt={}));class Ct{constructor(e,t){this.deltaManager=e,this.logger=t,this.localPaused=!1,this.timePaused=0,this.batchCount=0,this.deltaManager.on("prepareSend",(e=>{if(0===e.length)return;const t=e[0].metadata;if(!(null==t?void 0:t.batch))return;if(1===e.length)return void delete t.batch;const n=e[e.length-1];n.metadata=Object.assign(Object.assign({},n.metadata),{batch:!1})})),this.deltaManager.inbound.on("push",(e=>{this.trackPending(e)})),s(!this.localPaused,659);const n=this.deltaManager.inbound.toArray();for(const e of n)this.trackPending(e);this.deltaManager.on("op",(e=>this.afterOpProcessing(e.sequenceNumber)))}afterOpProcessing(e){s(!this.localPaused,660),0!==this.deltaManager.inbound.length?void 0!==this.pauseSequenceNumber&&(s(e<this.pauseSequenceNumber,662),e+1===this.pauseSequenceNumber&&this.pauseQueue()):s(void 0===this.pauseSequenceNumber,661)}pauseQueue(){s(!this.localPaused,663),this.localPaused=!0,this.timePaused=o.now(),this.deltaManager.inbound.pause()}resumeQueue(e,t){const n=t.sequenceNumber,r=this.localPaused?o.now()-this.timePaused:void 0;this.batchCount++,this.batchCount%1e3==1&&this.logger.sendTelemetryEvent({eventName:"BatchStats",sequenceNumber:n,length:n-e+1,msnDistance:n-t.minimumSequenceNumber,duration:r,batchCount:this.batchCount,interrupted:this.localPaused}),this.localPaused&&(this.localPaused=!1,void 0!==r&&r>5e3&&this.logger.sendErrorEvent({eventName:"MaxBatchWaitTimeExceeded",duration:r,sequenceNumber:n,length:n-e}),this.deltaManager.inbound.resume())}trackPending(e){s(0!==this.deltaManager.inbound.length,664),s(void 0===this.currentBatchClientId==(void 0===this.pauseSequenceNumber),665);const t=e.metadata,n=null==t?void 0:t.batch;if(!(0,v._V)(e))return s(void 0===this.currentBatchClientId,666),s(void 0===n,667),void s(!this.localPaused,668);if(void 0!==this.currentBatchClientId||void 0!==n){if((void 0!==this.currentBatchClientId||!1===n)&&this.currentBatchClientId!==e.clientId)throw new S.Jd("OpBatchIncomplete",Object.assign({runtimeVersion:le,batchClientId:this.currentBatchClientId},(0,S.HN)(e)));n?(s(void 0===this.currentBatchClientId,670),s(!this.localPaused,671),this.pauseSequenceNumber=e.sequenceNumber,this.currentBatchClientId=e.clientId,1===this.deltaManager.inbound.length&&this.pauseQueue()):!1===n?(s(void 0!==this.pauseSequenceNumber,672),this.resumeQueue(this.pauseSequenceNumber,e),this.pauseSequenceNumber=void 0,this.currentBatchClientId=void 0):s(void 0!==this.currentBatchClientId,673)}else s(!this.localPaused,669)}}class Et{constructor(e,t,n){this.deltaManager=e,this.emitter=t,this.logger=n,this.hitError=!1,this.deltaScheduler=new re(this.deltaManager,f.G2.create(this.logger,"DeltaScheduler")),new Ct(e,n)}beforeOpProcessing(e){var t;if(this.batchClientId!==e.clientId){s(void 0===this.batchClientId,674),this.emitter.emit("batchBegin",e),this.deltaScheduler.batchBegin(e);const n=null===(t=null==e?void 0:e.metadata)||void 0===t?void 0:t.batch;this.batchClientId=n?e.clientId:void 0}}afterOpProcessing(e,t){var n;if(s(!this.hitError,675),e)return this.hitError=!0,this.batchClientId=void 0,this.emitter.emit("batchEnd",e,t),void this.deltaScheduler.batchEnd(t);const r=null===(n=null==t?void 0:t.metadata)||void 0===n?void 0:n.batch;return void 0===this.batchClientId||!1===r?(this.batchClientId=void 0,this.emitter.emit("batchEnd",void 0,t),void this.deltaScheduler.batchEnd(t)):void 0}}const Tt="_scheduler";class At extends c{constructor(e,t,n,i,o,a,c,l,u,d,p,m,y,v){var w,C,E,T,A,k,N,O,R;void 0===v&&(v=Object.assign(Object.assign({},bt),null===(w=c.summaryOptions)||void 0===w?void 0:w.summaryConfigOverrides)),super(),this.context=e,this.registry=t,this.runtimeOptions=c,this.containerScope=l,this.logger=u,this._storage=m,this.requestHandler=y,this.summaryConfiguration=v,this.defaultMaxConsecutiveReconnects=15,this._orderSequentiallyCalls=0,this.needsFlush=!1,this.flushTrigger=!1,this.savedOps=[],this.consecutiveReconnects=0,this._disposed=!1,this.emitDirtyDocumentEvent=!0,this.defaultTelemetrySignalSampleCount=100,this._perfSignalData={signalsLost:0,signalSequenceNumber:0,signalTimestamp:0,trackingSignalSequenceNumber:void 0},this.summarizeOnDemand=(...e)=>{if(this.clientDetails.type===_)return this.summarizer.summarizeOnDemand(...e);if(void 0!==this.summaryManager)return this.summaryManager.summarizeOnDemand(...e);throw new S.Oi(`Can't summarize, disableSummaries: ${this.summariesDisabled}`)},this.enqueueSummarize=(...e)=>{if(this.clientDetails.type===_)return this.summarizer.enqueueSummarize(...e);if(void 0!==this.summaryManager)return this.summaryManager.enqueueSummarize(...e);throw new S.Oi(`Can't summarize, disableSummaries: ${this.summariesDisabled}`)},this.messageAtLastSummary=null==n?void 0:n.message,this.disableIsolatedChannels=null!==(C=this.runtimeOptions.summaryOptions.disableIsolatedChannels)&&void 0!==C&&C,this._connected=this.context.connected,this.chunkMap=new Map(o),this.handleContext=new P("",this),this.mc=(0,g.rZ)(f.G2.create(this.logger,"ContainerRuntime")),this.summariesDisabled=this.isSummariesDisabled(),this.heuristicsDisabled=this.isHeuristicsDisabled(),this.summarizerClientElectionEnabled=this.isSummarizerClientElectionEnabled(),this.maxOpsSinceLastSummary=this.getMaxOpsSinceLastSummary(),this.initialSummarizerDelayMs=this.getInitialSummarizerDelayMs(),this._aliasingEnabled=null!==(E=this.mc.config.getBoolean("Fluid.ContainerRuntime.UseDataStoreAliasing"))&&void 0!==E&&E||null!==(T=c.useDataStoreAliasing)&&void 0!==T&&T,this._maxOpSizeInBytes=null!==(A=this.mc.config.getNumber("Fluid.ContainerRuntime.MaxOpSizeInBytes"))&&void 0!==A?A:768e3,this.maxConsecutiveReconnects=null!==(k=this.mc.config.getNumber("Fluid.ContainerRuntime.MaxConsecutiveReconnects"))&&void 0!==k?k:this.defaultMaxConsecutiveReconnects,this._flushMode=c.flushMode;const I=e.pendingLocalState,F=null!==(N=null==I?void 0:I.baseSnapshot)&&void 0!==N?N:e.baseSnapshot;this.garbageCollector=Oe.create({runtime:this,gcOptions:this.runtimeOptions.gcOptions,baseSnapshot:F,baseLogger:this.mc.logger,existing:d,metadata:n,isSummarizerClient:this.context.clientDetails.type===_,getNodePackagePath:async e=>this.getGCNodePackagePath(e),getLastSummaryTimestampMs:()=>{var e;return null===(e=this.messageAtLastSummary)||void 0===e?void 0:e.timestamp},readAndParseBlob:async e=>(0,b.g)(this.storage,e)});const D=this.deltaManager.initialSequenceNumber;if(this.summarizerNode=(0,x.G)(f.G2.create(this.logger,"SummarizerNode"),(async(e,t,n)=>this.summarizeInternal(e,t,n)),D,F?D:void 0,{canReuseHandle:!1,throwOnFailure:!0,gcDisabled:!this.garbageCollector.shouldRunGC}),F&&this.summarizerNode.loadBaseSummaryWithoutDifferential(F),this.dataStores=new nt(rt(F,n),this,(e=>this.submit(vt.Attach,e)),((e,t)=>(n,r,i)=>this.summarizerNode.createChild(n,e,t,void 0,r,i)),(e=>this.summarizerNode.deleteChild(e)),this.mc.logger,(async()=>this.garbageCollector.getBaseGCDetails()),((e,t,n)=>this.garbageCollector.nodeUpdated(e,"Changed",t,n)),new Map(a),this.garbageCollector.writeDataAtRoot),this.blobManager=new he(this.handleContext,p,(()=>this.storage),(e=>this.submit(vt.BlobAttach,void 0,void 0,{blobId:e})),(e=>this.garbageCollector.nodeUpdated(e,"Loaded")),this,this.logger),this.scheduleManager=new Et(e.deltaManager,this,f.G2.create(this.logger,"ScheduleManager")),this.deltaSender=this.deltaManager,this.pendingStateManager=new ce({applyStashedOp:this.applyStashedOp.bind(this),clientId:()=>this.clientId,close:this.closeFn,connected:()=>this.connected,flush:this.flush.bind(this),flushMode:()=>this.flushMode,reSubmit:this.reSubmit.bind(this),rollback:this.rollback.bind(this),setFlushMode:e=>this.setFlushMode(e)},this._flushMode,null==I?void 0:I.pending),this.context.quorum.on("removeMember",(e=>{this.clearPartialChunks(e)})),this.summaryCollection=new ot(this.deltaManager,this.logger),this.dirtyContainer=this.context.attachState!==r.mB.Attached||this.pendingStateManager.hasPendingMessages(),this.context.updateDirtyContainerState(this.dirtyContainer),this.summariesDisabled)this.mc.logger.sendTelemetryEvent({eventName:"SummariesDisabled"});else{const e=f.G2.create(this.logger,"OrderedClientElection"),t=new at(e,this.context.deltaManager,this.context.quorum),n=new ct(e,t,null!=i?i:this.context.deltaManager.lastSequenceNumber,q.isClientEligible);if(this.summarizerClientElection=new q(e,this.summaryCollection,n,this.maxOpsSinceLastSummary,this.summarizerClientElectionEnabled),this.context.clientDetails.type===_)this._summarizer=new te("/_summarizer",this,(()=>this.summaryConfiguration),this,this.handleContext,this.summaryCollection,(async e=>ut.create(e)));else if(q.clientDetailsPermitElection(this.context.clientDetails)){const e=()=>{this.summaryCollection.opsSinceLastAck>this.maxOpsSinceLastSummary&&(this.logger.sendErrorEvent({eventName:"SummaryStatus:Behind"}),this.summaryCollection.once(h.SummaryAck,(()=>{this.logger.sendTelemetryEvent({eventName:"SummaryStatus:CaughtUp"}),this.summaryCollection.on("default",e)})),this.summaryCollection.off("default",e))};this.summaryCollection.on("default",e),this.summaryManager=new ne(this.summarizerClientElection,this,this.summaryCollection,this.logger,this.formRequestSummarizerFn(this.context.loader),new lt(6e4,3e4,(({multiplier:e=2,coefficient:t=1,offset:n=0,initialDelay:r}={})=>i=>Math.max(0,i<=0&&void 0!==r?r:t*Math.pow(e,i)+n))({coefficient:20,initialDelay:0})),{initialDelayMs:this.initialSummarizerDelayMs},this.heuristicsDisabled),this.summaryManager.start()}}let M;this.deltaManager.on("readonly",(e=>{s(e===this.deltaManager.readOnlyInfo.readonly,292),s(!e||!this.connected,293),this.replayPendingStates()})),u.sendTelemetryEvent(Object.assign({eventName:"DeviceSpec"},function(){try{if("object"==typeof navigator&&null!==navigator)return{deviceMemory:navigator.deviceMemory,hardwareConcurrency:navigator.hardwareConcurrency}}catch(e){}return{}}())),d?(this.createContainerMetadata={createContainerRuntimeVersion:null==n?void 0:n.createContainerRuntimeVersion,createContainerTimestamp:null==n?void 0:n.createContainerTimestamp},M=null!==(R=null!==(O=null==n?void 0:n.summaryNumber)&&void 0!==O?O:null==n?void 0:n.summaryCount)&&void 0!==R?R:0):(this.createContainerMetadata={createContainerRuntimeVersion:le,createContainerTimestamp:Date.now()},M=0),this.nextSummaryNumber=M+1,this.logger.sendTelemetryEvent(Object.assign(Object.assign(Object.assign({eventName:"ContainerLoadStats"},this.createContainerMetadata),this.dataStores.containerLoadStats),{summaryNumber:M,summaryFormatVersion:null==n?void 0:n.summaryFormatVersion,disableIsolatedChannels:null==n?void 0:n.disableIsolatedChannels,gcVersion:null==n?void 0:n.gcFeature})),function(e,t,n){new ie(e,t,n)}(this.context.clientId,this.deltaManager,this.logger),((e,t,n=1e3,r=1e3)=>{new ht(e,t,n,r)})(this,this.logger),this.opTracker=new yt(this.deltaManager,!0===this.mc.config.getBoolean("Fluid.ContainerRuntime.DisableOpTracking"))}get IContainerRuntime(){return this}get IFluidRouter(){return this}static async load(e,t,n,r={},i=e.scope,o){var a,c,l;const u=e,h=null!==(a=u.taggedLogger)&&void 0!==a?a:new f.cP(u.logger),d=f.G2.create(h,void 0,{all:{runtimeVersion:le}}),{summaryOptions:p={},gcOptions:g={},loadSequenceNumberVerification:m="close",useDataStoreAliasing:y=!1,flushMode:v=wt,enableOfflineLoad:w=!1}=r,x=e.pendingLocalState,C=null!==(c=null==x?void 0:x.baseSnapshot)&&void 0!==c?c:e.baseSnapshot,E=x?new mt((()=>e.storage),x.snapshotBlobs):e.storage,T=new R.P(t),A=async e=>{const t=null==C?void 0:C.blobs[e];if(C&&t)return s(void 0!==E,501),(0,b.g)(E,t)},[k,N,O,P]=await Promise.all([A(_e),A(Le),A(qe),A(Me)]),I=!0===o||!0===e.existing,F=await he.load(null==C?void 0:C.trees[Be],(async e=>(s(void 0!==E,598),(0,b.g)(E,e)))),D=null===(l=null==N?void 0:N.message)||void 0===l?void 0:l.sequenceNumber;if(!x&&void 0!==D){const t=e.deltaManager.initialSequenceNumber;if("bypass"!==m&&D!==t){const n=new S.Jd("Summary metadata mismatch",{runtimeVersion:le,runtimeSequenceNumber:D,protocolSequenceNumber:t});"log"===m?d.sendErrorEvent({eventName:"SequenceNumberMismatch"},n):e.closeFn(n)}}const M=new At(e,T,N,O,null!=k?k:[],null!=P?P:[],{summaryOptions:p,gcOptions:g,loadSequenceNumberVerification:m,useDataStoreAliasing:y,flushMode:v,enableOfflineLoad:w},i,d,I,F,E,n);return x&&(await M.processSavedOps(x),x.savedOps=[]),await M.getSnapshotBlobs(),M}get options(){return this.context.options}get clientId(){return this.context.clientId}get clientDetails(){return this.context.clientDetails}get deltaManager(){return this.context.deltaManager}get storage(){return this._storage}get reSubmitFn(){return this.reSubmit}get closeFn(){return this.context.closeFn}get flushMode(){return this._flushMode}get scope(){return this.containerScope}get IFluidDataStoreRegistry(){return this.registry}get attachState(){return this.context.attachState}get IFluidHandleContext(){return this.handleContext}get connected(){return this._connected}get summarizerClientId(){var e;return null===(e=this.summarizerClientElection)||void 0===e?void 0:e.electedClientId}get disposed(){return this._disposed}get summarizer(){return s(void 0!==this._summarizer,599),this._summarizer}isSummariesDisabled(){return!0===this.runtimeOptions.summaryOptions.disableSummaries||"disabled"===this.summaryConfiguration.state}isHeuristicsDisabled(){var e;return!0===(null===(e=this.runtimeOptions.summaryOptions.summarizerOptions)||void 0===e?void 0:e.disableHeuristics)||"disableHeuristics"===this.summaryConfiguration.state}isSummarizerClientElectionEnabled(){var e;return this.mc.config.getBoolean("Fluid.ContainerRuntime.summarizerClientElection")?null===(e=this.mc.config.getBoolean("Fluid.ContainerRuntime.summarizerClientElection"))||void 0===e||e:!0===this.runtimeOptions.summaryOptions.summarizerClientElection||"disabled"!==this.summaryConfiguration.state&&!0===this.summaryConfiguration.summarizerClientElection}getMaxOpsSinceLastSummary(){return void 0!==this.runtimeOptions.summaryOptions.maxOpsSinceLastSummary?this.runtimeOptions.summaryOptions.maxOpsSinceLastSummary:"disabled"!==this.summaryConfiguration.state?this.summaryConfiguration.maxOpsSinceLastSummary:0}getInitialSummarizerDelayMs(){return void 0!==this.runtimeOptions.summaryOptions.initialSummarizerDelayMs?this.runtimeOptions.summaryOptions.initialSummarizerDelayMs:"disabled"!==this.summaryConfiguration.state?this.summaryConfiguration.initialSummarizerDelayMs:0}dispose(e){var t;this._disposed||(this._disposed=!0,this.logger.sendTelemetryEvent({eventName:"ContainerRuntimeDisposed",isDirty:this.isDirty,lastSequenceNumber:this.deltaManager.lastSequenceNumber,attachState:this.attachState},e),void 0!==this.summaryManager&&this.summaryManager.dispose(),this.garbageCollector.dispose(),null===(t=this._summarizer)||void 0===t||t.dispose(),this.dataStores.dispose(),this.pendingStateManager.dispose(),this.emit("dispose"),this.removeAllListeners())}get IFluidTokenProvider(){var e;if(null===(e=this.options)||void 0===e?void 0:e.intelligence)return{intelligence:this.options.intelligence}}async request(e){try{const t=C.R.create(e);return"_summarizer"===t.pathParts[0]&&1===t.pathParts.length?void 0!==this._summarizer?{status:200,mimeType:"fluid/object",value:this.summarizer}:(0,E.I4)(e):void 0!==this.requestHandler?this.requestHandler(t,this):(0,E.I4)(e)}catch(e){return(0,E.Nj)(e)}}async resolveHandle(e){try{const t=C.R.create(e),n=t.pathParts[0];if("_channels"===n)return this.resolveHandle(t.createSubRequest(1));if(n===he.basePath&&t.isLeaf(2)){const n=await this.blobManager.getBlob(t.pathParts[1]);return n?{status:200,mimeType:"fluid/object",value:n.get()}:(0,E.I4)(e)}if(t.pathParts.length>0){const r=await this.getDataStoreFromRequest(n,e),i=t.createSubRequest(1);return s(i.url.startsWith("/"),294),r.IFluidRouter.request(i)}return(0,E.I4)(e)}catch(e){return(0,E.Nj)(e)}}internalId(e){var t;return null!==(t=this.dataStores.aliases().get(e))&&void 0!==t?t:e}async getDataStoreFromRequest(e,t){var n,r,i;const s="boolean"!=typeof(null===(n=t.headers)||void 0===n?void 0:n[St.wait])||(null===(r=t.headers)||void 0===r?void 0:r[St.wait]),o=this.internalId(e),a=await this.dataStores.getDataStore(o,s);if((null===(i=t.headers)||void 0===i?void 0:i[St.externalRequest])&&this.garbageCollector.shouldRunGC){const e=(await a.getBaseGCDetails()).usedRoutes;if(void 0!==e&&!e.includes("")&&!e.includes("/"))throw(0,E.fu)((0,E.I4)(t),t)}const c=await a.realize(),l=(0,k.aG)(t.url.split("?")[0]);return this.garbageCollector.nodeUpdated(`/${l}`,"Loaded",void 0,a.packagePath,null==t?void 0:t.headers),c}addMetadataToSummary(e){var t;const n=Object.assign(Object.assign(Object.assign(Object.assign({},this.createContainerMetadata),{summaryCount:this.nextSummaryNumber,summaryNumber:this.nextSummaryNumber++,summaryFormatVersion:1,disableIsolatedChannels:this.disableIsolatedChannels||void 0}),this.garbageCollector.getMetadata()),{message:null!==(r=this.deltaManager.lastMessage,t=void 0===r?void 0:{clientId:r.clientId,clientSequenceNumber:r.clientSequenceNumber,minimumSequenceNumber:r.minimumSequenceNumber,referenceSequenceNumber:r.referenceSequenceNumber,sequenceNumber:r.sequenceNumber,timestamp:r.timestamp,type:r.type})&&void 0!==t?t:this.messageAtLastSummary});var r;(0,T.Rt)(e,Le,JSON.stringify(n))}addContainerStateToSummary(e,t,n,r){var i;if(this.addMetadataToSummary(e),this.chunkMap.size>0){const t=JSON.stringify([...this.chunkMap]);(0,T.Rt)(e,_e,t)}const s=this.dataStores.aliases();if(s.size>0&&(0,T.Rt)(e,Me,JSON.stringify([...s])),this.summarizerClientElection){const t=JSON.stringify(null===(i=this.summarizerClientElection)||void 0===i?void 0:i.serialize());(0,T.Rt)(e,qe,t)}const o=this.blobManager.summarize();if(Object.keys(o.summary.tree).length>0&&(0,T.Jv)(e,Be,o),this.garbageCollector.writeDataAtRoot){const i=this.garbageCollector.summarize(t,n,r);void 0!==i&&(0,T.QA)(e,Se,i)}}shouldContinueReconnecting(){return this.maxConsecutiveReconnects<=0||(this.pendingStateManager.hasPendingMessages()?(this.consecutiveReconnects===Math.floor(this.maxConsecutiveReconnects/2)&&this.mc.logger.sendTelemetryEvent({eventName:"ReconnectsWithNoProgress",attempts:this.consecutiveReconnects,pendingMessages:this.pendingStateManager.pendingMessagesCount}),this.consecutiveReconnects<this.maxConsecutiveReconnects):(this.resetReconnectCount(),!0))}resetReconnectCount(){this.consecutiveReconnects=0}replayPendingStates(){if(!this.canSendOps())return;const e=this.dirtyContainer;let t;this.dirtyContainer=!1,s(this.emitDirtyDocumentEvent,295),this.emitDirtyDocumentEvent=!1;try{this.pendingStateManager.replayPendingStates()}finally{t=this.dirtyContainer,this.dirtyContainer=e,this.emitDirtyDocumentEvent=!0}this.updateDocumentDirtyState(t)}async applyStashedOp(e,t){switch(e){case vt.FluidDataStoreOp:return this.dataStores.applyStashedOp(t);case vt.Attach:return this.dataStores.applyStashedAttachOp(t);case vt.Alias:case vt.BlobAttach:return;case vt.ChunkedOp:throw new Error("chunkedOp not expected here");case vt.Rejoin:throw new Error("rejoin not expected here");default:l(0,`Unknown ContainerMessageType: ${e}`)}}setConnectionState(e,t){this.verifyNotClosed();const n=this._connected!==e,r=n&&e;this._connected=e,e||(this._perfSignalData.signalsLost=0,this._perfSignalData.signalTimestamp=0,this._perfSignalData.trackingSignalSequenceNumber=void 0),!r||(this.consecutiveReconnects++,this.shouldContinueReconnecting())?(n&&this.replayPendingStates(),this.dataStores.setConnectionState(e,t),(0,m.Qq)(this.mc.logger,this,e,t)):this.closeFn(S.Hi.create("Runtime detected too many reconnects with no progress syncing local ops","setConnectionState",void 0,{dataLoss:1,attempts:this.consecutiveReconnects,pendingMessages:this.pendingStateManager.pendingMessagesCount}))}process(e,t){var n,r;if(this.verifyNotClosed(),!(0,v._V)(e))return;(null!==(n=this.mc.config.getBoolean("enableOfflineLoad"))&&void 0!==n?n:this.runtimeOptions.enableOfflineLoad)&&this.savedOps.push(e);let i=Object.assign({},e);this.scheduleManager.beforeOpProcessing(i);try{let e;switch(i=function(e){if(e.type===h.Operation){if(void 0!==e.contents.address&&void 0===e.contents.type)e.type=vt.FluidDataStoreOp;else{const t=e.contents;s(void 0!==t.type,289),e.type=t.type,e.contents=t.contents}s((0,v._V)(e),290)}return e}(i),i=this.processRemoteChunkedMessage(i),t&&i.type!==vt.ChunkedOp&&(e=this.pendingStateManager.processPendingLocalMessage(i)),this.pendingStateManager.hasPendingMessages()||this.updateDocumentDirtyState(!1),i.type){case vt.Attach:this.dataStores.processAttachMessage(i,t);break;case vt.Alias:this.processAliasMessage(i,e,t);break;case vt.FluidDataStoreOp:this.dataStores.processFluidDataStoreOp(i,t,e);break;case vt.BlobAttach:s(null===(r=null==i?void 0:i.metadata)||void 0===r?void 0:r.blobId,298),this.blobManager.processBlobAttachOp(i.metadata.blobId,t)}this.emit("op",i),this.scheduleManager.afterOpProcessing(void 0,i),t&&this.resetReconnectCount()}catch(e){throw this.scheduleManager.afterOpProcessing(e,i),e}}processAliasMessage(e,t,n){this.dataStores.processAliasMessage(e,t,n)}sendSignalTelemetryEvent(e){const t=Date.now()-this._perfSignalData.signalTimestamp;this.logger.sendPerformanceEvent({eventName:"SignalLatency",duration:t,signalsLost:this._perfSignalData.signalsLost}),this._perfSignalData.signalsLost=0,this._perfSignalData.signalTimestamp=0}processSignal(e,t){const n=e.content,r={clientId:e.clientId,content:n.contents.content,type:n.contents.type};e.clientId===this.clientId&&this.connected&&(void 0!==this._perfSignalData.trackingSignalSequenceNumber&&n.clientSignalSequenceNumber>this._perfSignalData.trackingSignalSequenceNumber?(this._perfSignalData.signalsLost++,this._perfSignalData.trackingSignalSequenceNumber=void 0,this.logger.sendErrorEvent({eventName:"SignalLost",type:n.contents.type,signalsLost:this._perfSignalData.signalsLost,trackingSequenceNumber:this._perfSignalData.trackingSignalSequenceNumber,clientSignalSequenceNumber:n.clientSignalSequenceNumber})):n.clientSignalSequenceNumber===this._perfSignalData.trackingSignalSequenceNumber&&(this.sendSignalTelemetryEvent(n.clientSignalSequenceNumber),this._perfSignalData.trackingSignalSequenceNumber=void 0)),void 0!==n.address?this.dataStores.processSignal(n.address,r,t):this.emit("signal",r,t)}async getRootDataStore(e,t=!0){const n=this.internalId(e),r=await this.dataStores.getDataStore(n,t);return s(await r.isRoot(),299),r.realize()}setFlushMode(e){e!==this._flushMode&&(this.mc.logger.sendTelemetryEvent({eventName:"FlushMode Updated",old:this._flushMode,new:e}),e===w.FlushMode.Immediate&&this.flush(),this._flushMode=e,this.pendingStateManager.onFlushModeUpdated(e))}flush(){if(s(0===this._orderSequentiallyCalls,588),this.deltaSender&&(this.pendingStateManager.onFlush(),this.needsFlush&&(this.needsFlush=!1,this.canSendOps())))return this.deltaSender.flush()}orderSequentially(e){if(this.flushMode===w.FlushMode.TurnBased)return void this.trackOrderSequentiallyCalls(e);const t=this.flushMode;this.setFlushMode(w.FlushMode.TurnBased);try{this.trackOrderSequentiallyCalls(e),this.flush()}finally{this.setFlushMode(t)}}trackOrderSequentiallyCalls(e){let t;this.mc.config.getBoolean("Fluid.ContainerRuntime.EnableRollback")&&(t=this.pendingStateManager.checkpoint());try{this._orderSequentiallyCalls++,e()}catch(e){throw t?t.rollback():this.closeFn(new S.pY("orderSequentially callback exception",e)),e}finally{this._orderSequentiallyCalls--}}async createDataStore(e){const t=(0,N.Z)();return Ze(await this._createDataStore(e,!1,t),t,this,this.dataStores,this.mc.logger)}async createRootDataStoreLegacy(e,t){const n=await this._createDataStore(e,!0,t);return void 0!==n.makeVisibleAndAttachGraph?n.makeVisibleAndAttachGraph():n.bindToContext(),n}async createRootDataStore(e,t){if(t.includes("/"))throw new S.Oi(`Id cannot contain slashes: '${t}'`);return!0===this._aliasingEnabled?this.createAndAliasDataStore(e,t):this.createRootDataStoreLegacy(e,t)}async createAndAliasDataStore(e,t,n){const r=(0,N.Z)(),i=await this._createDataStore(e,!1,r,n),s=Ze(i,r,this,this.dataStores,this.mc.logger),o=await s.trySetAlias(t);if("Success"!==o)throw new S.pY("dataStoreAliasFailure",void 0,{alias:{value:t,tag:f.XI.UserData},internalId:{value:r,tag:f.XI.PackageData},aliasResult:o});return s}createDetachedRootDataStore(e,t){if(t.includes("/"))throw new S.Oi(`Id cannot contain slashes: '${t}'`);return this.dataStores.createDetachedDataStoreCore(e,!0,t)}createDetachedDataStore(e){return this.dataStores.createDetachedDataStoreCore(e,!1)}async _createDataStoreWithPropsLegacy(e,t,n=(0,N.Z)(),r=!1){const i=await this.dataStores._createFluidDataStoreContext(Array.isArray(e)?e:[e],n,r,t).realize();return r&&(void 0!==i.makeVisibleAndAttachGraph?i.makeVisibleAndAttachGraph():i.bindToContext(),this.logger.sendTelemetryEvent({eventName:"Root datastore with props",hasProps:void 0!==t})),Ze(i,n,this,this.dataStores,this.mc.logger)}async _createDataStoreWithProps(e,t,n=(0,N.Z)(),r=!1){return!0===this._aliasingEnabled&&r?this.createAndAliasDataStore(e,n,t):this._createDataStoreWithPropsLegacy(e,t,n,r)}async _createDataStore(e,t,n=(0,N.Z)(),r){return this.dataStores._createFluidDataStoreContext(Array.isArray(e)?e:[e],n,t,r).realize()}canSendOps(){return this.connected&&!this.deltaManager.readOnlyInfo.readonly}getQuorum(){return this.context.quorum}getAudience(){return this.context.audience}get isDirty(){return this.dirtyContainer}isContainerMessageDirtyable(e,t){if(e===vt.Attach){if(t.id===Tt)return!1}else if(e===vt.FluidDataStoreOp&&t.address===Tt)return!1;return!0}createNewSignalEnvelope(e,t,n){const r=++this._perfSignalData.signalSequenceNumber,i={address:e,clientSignalSequenceNumber:r,contents:{type:t,content:n}};return r%this.defaultTelemetrySignalSampleCount==1&&void 0===this._perfSignalData.trackingSignalSequenceNumber&&(this._perfSignalData.signalTimestamp=Date.now(),this._perfSignalData.trackingSignalSequenceNumber=r),i}submitSignal(e,t){this.verifyNotClosed();const n=this.createNewSignalEnvelope(void 0,e,t);return this.context.submitSignalFn(n)}submitDataStoreSignal(e,t,n){const r=this.createNewSignalEnvelope(e,t,n);return this.context.submitSignalFn(r)}setAttachState(e){e===r.mB.Attaching?s(this.attachState===r.mB.Attaching,301):(s(this.attachState===r.mB.Attached,302),this.emit("attached")),e!==r.mB.Attached||this.pendingStateManager.hasPendingMessages()||this.updateDocumentDirtyState(!1),this.dataStores.setAttachState(e)}createSummary(e,t){e&&this.blobManager.setRedirectTable(e);const n=this.dataStores.createSummary(t);return this.disableIsolatedChannels||Ue(n),this.addContainerStateToSummary(n,!0,!1,t),n.summary}async getAbsoluteUrl(e){if(void 0===this.context.getAbsoluteUrl)throw new Error("Driver does not implement getAbsoluteUrl");if(this.attachState===r.mB.Attached)return this.context.getAbsoluteUrl(e)}async summarizeInternal(e,t,n){const r=await this.dataStores.summarize(e,t,n);let i;return this.disableIsolatedChannels||(Ue(r),i=[w.channelsTreeName]),this.addContainerStateToSummary(r,e,t,n),Object.assign(Object.assign({},r),{id:"",pathPartsForChildren:i})}async summarize(e){this.verifyNotClosed();const{fullTree:t=!1,trackState:n=!0,summaryLogger:r=this.mc.logger,runGC:i=this.garbageCollector.shouldRunGC,runSweep:o,fullGC:a}=e;let c;i&&(c=await this.collectGarbage({logger:r,runSweep:o,fullGC:a}));const l=new T.TA,{stats:u,summary:h}=await this.summarizerNode.summarize(t,n,l);return this.logger.sendTelemetryEvent({eventName:"SummarizeTelemetry",details:l.serialize()}),s(h.type===p.Tree,303),{stats:u,summary:h,gcStats:c}}async updateStateBeforeGC(){return this.dataStores.updateStateBeforeGC()}async getGCData(e){const t=new k.iR,n=await this.dataStores.getGCData(e);t.addNodes(n.gcNodes);const r=this.blobManager.getGCData(e);return t.addNodes(r.gcNodes),t.getGCData()}updateUsedRoutes(e,t){this.summarizerNode.updateUsedRoutes([""]);const n=[];for(const t of e)t.split("/")[1]!==he.basePath&&n.push(t);return this.dataStores.updateUsedRoutes(n,t)}deleteUnusedRoutes(e){const t=[],n=[];for(const r of e)this.isBlobPath(r)?t.push(r):n.push(r);this.blobManager.deleteUnusedRoutes(t),this.dataStores.deleteUnusedRoutes(n)}getCurrentReferenceTimestampMs(){var e,t,n;return null!==(t=null===(e=this.deltaManager.lastMessage)||void 0===e?void 0:e.timestamp)&&void 0!==t?t:null===(n=this.messageAtLastSummary)||void 0===n?void 0:n.timestamp}getNodeType(e){var t;return this.isBlobPath(e)?Ee:null!==(t=this.dataStores.getGCNodeType(e))&&void 0!==t?t:"Other"}async getGCNodePackagePath(e){switch(this.getNodeType(e)){case Ee:return["_blobs"];case xe:case Ce:return this.dataStores.getDataStorePackagePath(e);default:s(!1,734)}}isBlobPath(e){const t=e.split("/");return!(t.length<2||t[1]!==he.basePath)}async collectGarbage(e){return this.garbageCollector.collectGarbage(e)}addedGCOutboundReference(e,t){this.garbageCollector.addedOutboundReference(e.absolutePath,t.absolutePath)}async submitSummary(e){var t,n,r;const{fullTree:i,refreshLatestAck:o,summaryLogger:a}=e,c=this.nextSummaryNumber,l=f.G2.create(a,void 0,{all:{summaryNumber:c}});let d;if(o){const e=await this.refreshLatestSummaryAckFromServer(f.G2.create(l,void 0,{all:{safeSummary:!0}})),t=e.latestSnapshotRefSeq;d=e.latestSnapshotVersionId,t>this.deltaManager.lastSequenceNumber&&await f.Xr.timedExecAsync(l,{eventName:"WaitingForSeq",lastSequenceNumber:this.deltaManager.lastSequenceNumber,targetSequenceNumber:t,lastKnownSeqNumber:this.deltaManager.lastKnownSeqNumber},(async()=>kt(this.deltaManager,t)),{start:!0,end:!0,cancel:"error"})}try{await this.deltaManager.inbound.pause();const o=this.deltaManager.lastSequenceNumber,a=this.deltaManager.minimumSequenceNumber,f=`Summary @${o}:${this.deltaManager.minimumSequenceNumber}`;o!==(null===(t=this.deltaManager.lastMessage)||void 0===t?void 0:t.sequenceNumber)&&l.sendErrorEvent({eventName:"LastSequenceMismatch",error:f}),this.summarizerNode.startSummary(o,l);const g=()=>e.cancellationToken.cancelled?{continue:!1,error:"disconnected"}:(s(this.connected,600),this.deltaManager.lastSequenceNumber!==o?{continue:!1,error:`lastSequenceNumber changed before uploading to storage. ${this.deltaManager.lastSequenceNumber} !== ${o}`}:{continue:!0});let m=g();if(!m.continue)return{stage:"base",referenceSequenceNumber:o,minimumSequenceNumber:a,error:m.error};const y=u.start();let v;const b=this.garbageCollector.summaryStateNeedsReset;try{v=await this.summarize({fullTree:i||b,trackState:!0,summaryLogger:l,runGC:this.garbageCollector.shouldRunGC})}catch(e){return{stage:"base",referenceSequenceNumber:o,minimumSequenceNumber:a,error:e}}const{summary:S,stats:x}=v;this.messageAtLastSummary=this.deltaManager.lastMessage;const C=this.disableIsolatedChannels?S:S.tree[w.channelsTreeName];s(C.type===p.Tree,508);const E=Object.values(C.tree).filter((e=>e.type===p.Handle)).length,A=S.tree[Se]?(0,T.i6)(S.tree[Se]):void 0,k=Object.assign({dataStoreCount:this.dataStores.size,summarizedDataStoreCount:this.dataStores.size-E,gcStateUpdatedDataStoreCount:null===(n=v.gcStats)||void 0===n?void 0:n.updatedDataStoreCount,gcBlobNodeCount:null==A?void 0:A.blobNodeCount,gcTotalBlobsSize:null==A?void 0:A.totalBlobSize,opsSizesSinceLastSummary:this.opTracker.opsSizeAccumulator,nonSystemOpsSinceLastSummary:this.opTracker.nonSystemOpCount,summaryNumber:c},x),N={referenceSequenceNumber:o,minimumSequenceNumber:a,summaryTree:S,summaryStats:k,generateDuration:y.trace().duration,forcedFullTree:b};if(m=g(),!m.continue)return Object.assign(Object.assign({stage:"generate"},N),{error:m.error});const O=this.summaryCollection.latestAck;let P,R;P=(null==O?void 0:O.summaryAck.contents.handle)!==d&&void 0!==d?{proposalHandle:void 0,ackHandle:d,referenceSequenceNumber:o}:void 0===O?{proposalHandle:void 0,ackHandle:null===(r=this.context.getLoadedFromVersion())||void 0===r?void 0:r.id,referenceSequenceNumber:o}:{proposalHandle:O.summaryOp.contents.handle,ackHandle:O.summaryAck.contents.handle,referenceSequenceNumber:o};try{R=await this.storage.uploadSummaryWithContext(v.summary,P)}catch(e){return Object.assign(Object.assign({stage:"generate"},N),{error:e})}const I=P.ackHandle,F={handle:R,head:I,message:f,parents:I?[I]:[]},D=Object.assign(Object.assign({},N),{handle:R,uploadDuration:y.trace().duration});if(m=g(),!m.continue)return Object.assign(Object.assign({stage:"upload"},D),{error:m.error});let M;try{M=this.submitSystemMessage(h.Summarize,F)}catch(e){return Object.assign(Object.assign({stage:"upload"},D),{error:e})}const L=Object.assign(Object.assign({stage:"submit"},D),{clientSequenceNumber:M,submitOpDuration:y.trace().duration});return this.summarizerNode.completeSummary(R),this.opTracker.reset(),L}finally{this.summarizerNode.clearSummary(),this.deltaManager.inbound.resume()}}processRemoteChunkedMessage(e){if(e.type!==vt.ChunkedOp)return e;const t=e.clientId,n=e.contents;if(this.addChunk(t,n),n.chunkId===n.totalChunks){const r=Object.assign({},e),i=this.chunkMap.get(t).join("");return r.contents=JSON.parse(i),r.type=n.originalType,this.clearPartialChunks(t),r}return e}addChunk(e,t){let n=this.chunkMap.get(e);void 0===n&&(n=[],this.chunkMap.set(e,n)),s(t.chunkId===n.length+1,305),n.push(t.contents)}clearPartialChunks(e){this.chunkMap.has(e)&&this.chunkMap.delete(e)}updateDocumentDirtyState(e){this.dirtyContainer!==e&&(this.dirtyContainer=e,this.emitDirtyDocumentEvent&&(this.emit(e?"dirty":"saved"),this.context.updateDirtyContainerState(e)))}submitDataStoreOp(e,t,n=void 0){const r={address:e,contents:t};this.submit(vt.FluidDataStoreOp,r,n)}submitDataStoreAliasOp(e,t){if(!Xe(e))throw new S.Oi("malformedDataStoreAliasMessage");this.submit(vt.Alias,e,t)}async uploadBlob(e){return this.verifyNotClosed(),this.blobManager.createBlob(e)}submit(e,t,n=void 0,i=void 0){this.verifyNotClosed(),s(this.attachState!==r.mB.Detached,306);let o=-1,a=i;if(this.canSendOps()){const n=JSON.stringify(t),r=this.context.deltaManager.maxMessageSize;this.flushMode!==w.FlushMode.TurnBased||this.needsFlush||(a=Object.assign(Object.assign({},i),{batch:!0}),this.needsFlush=!0,this.flushTrigger||Promise.resolve().then((()=>{this.flushTrigger=!1,this.flush()}))),o=this.submitMaybeChunkedMessages(e,t,n,r,this._flushMode===w.FlushMode.TurnBased,a)}this.pendingStateManager.onSubmitMessage(e,o,this.deltaManager.lastSequenceNumber,t,n,a),this.isContainerMessageDirtyable(e,t)&&this.updateDocumentDirtyState(!0)}submitMaybeChunkedMessages(e,t,n,r,i,s=void 0){return this._maxOpSizeInBytes>=0?!n||n.length<=this._maxOpSizeInBytes?this.submitRuntimeMessage(e,t,i,s):(this.closeFn(new S.pY("OpTooLarge",void 0,{length:{value:n.length,tag:f.XI.PackageData},limit:{value:this._maxOpSizeInBytes,tag:f.XI.PackageData}})),-1):!n||n.length<=r?this.submitRuntimeMessage(e,t,i,s):this.submitChunkedMessage(e,n,r)}submitChunkedMessage(e,t,n){const r=t.length,i=Math.floor((r-1)/n)+1;let s=0,o=0;for(let r=1;r<=i;r+=1){const a={chunkId:r,contents:t.substr(s,n),originalType:e,totalChunks:i};s+=n,o=this.submitRuntimeMessage(vt.ChunkedOp,a,!1)}return o}submitSystemMessage(e,t){this.verifyNotClosed(),s(this.connected,307);const n=this.flushMode===w.FlushMode.TurnBased&&this.needsFlush;return n&&this.mc.logger.sendErrorEvent({eventName:"submitSystemMessageError",type:e}),this.context.submitFn(e,t,n)}submitRuntimeMessage(e,t,n,r){this.verifyNotClosed(),s(this.connected,601);const i={type:e,contents:t};return this.context.submitFn(h.Operation,i,n,r)}verifyNotClosed(){if(this._disposed)throw new Error("Runtime is closed")}reSubmit(e,t,n,r){switch(e){case vt.FluidDataStoreOp:this.dataStores.resubmitDataStoreOp(t,n);break;case vt.Attach:case vt.Alias:this.submit(e,t,n);break;case vt.ChunkedOp:throw new Error("chunkedOp not expected here");case vt.BlobAttach:this.submit(e,t,n,r);break;case vt.Rejoin:this.submit(e,t);break;default:l(0,`Unknown ContainerMessageType: ${e}`)}}rollback(e,t,n){if(e!==vt.FluidDataStoreOp)throw new Error(`Can't rollback ${e}`);this.dataStores.rollbackDataStoreOp(t,n)}async refreshLatestSummaryAck(e,t,n,r){const i=async e=>(0,b.g)(this.storage,e),{snapshotTree:s}=await this.fetchSnapshotFromStorage(t,r,{eventName:"RefreshLatestSummaryGetSnapshot",ackHandle:t,summaryRefSeq:n,fetchLatest:!1}),o=await this.summarizerNode.refreshLatestSummary(e,n,(async()=>s),i,r);await this.garbageCollector.latestSummaryStateRefreshed(o,i)}async refreshLatestSummaryAckFromServer(e){const{snapshotTree:t,versionId:n}=await this.fetchSnapshotFromStorage(null,e,{eventName:"RefreshLatestSummaryGetSnapshot",fetchLatest:!0}),r=async e=>(0,b.g)(this.storage,e),i=await(0,A.G)(t,r),s=await this.summarizerNode.refreshLatestSummary(void 0,i,(async()=>t),r,e);return await this.garbageCollector.latestSummaryStateRefreshed(s,r),{latestSnapshotRefSeq:i,latestSnapshotVersionId:n}}async fetchSnapshotFromStorage(e,t,n){return f.Xr.timedExecAsync(t,n,(async t=>{const n={},r=u.start(),i=await this.storage.getVersions(e,1);s(!!i&&!!i[0],311),n.getVersionDuration=r.trace().duration;const o=await this.storage.getSnapshotTree(i[0]);return s(!!o,312),n.getSnapshotDuration=r.trace().duration,t.end(n),{snapshotTree:o,versionId:i[0].id}}))}notifyAttaching(e){var t;(null!==(t=this.mc.config.getBoolean("enableOfflineLoad"))&&void 0!==t?t:this.runtimeOptions.enableOfflineLoad)&&(this.baseSnapshotBlobs=mt.serializeTreeWithBlobContents(e))}async getSnapshotBlobs(){var e;(null!==(e=this.mc.config.getBoolean("enableOfflineLoad"))&&void 0!==e?e:this.runtimeOptions.enableOfflineLoad)&&this.attachState===r.mB.Attached&&!this.context.pendingLocalState&&(s(!!this.context.baseSnapshot,741),this.baseSnapshotBlobs=await mt.serializeTree(this.context.baseSnapshot,this.storage))}getPendingLocalState(){var e;if(!(null!==(e=this.mc.config.getBoolean("enableOfflineLoad"))&&void 0!==e?e:this.runtimeOptions.enableOfflineLoad))throw new S.Oi("can't get state when offline load disabled");const t=this.context.pendingLocalState;return t?{pending:this.pendingStateManager.getLocalState(),snapshotBlobs:t.snapshotBlobs,baseSnapshot:t.baseSnapshot,savedOps:this.savedOps}:(s(!!this.context.baseSnapshot,742),s(!!this.baseSnapshotBlobs,743),{pending:this.pendingStateManager.getLocalState(),snapshotBlobs:this.baseSnapshotBlobs,baseSnapshot:this.context.baseSnapshot,savedOps:this.savedOps})}formRequestSummarizerFn(e){return async()=>{const t={headers:{[i.A.cache]:!1,[i.A.clientDetails]:{capabilities:{interactive:!1},type:_},[y.i.summarizingClient]:!0,[i.A.reconnect]:!1},url:"/_summarizer"},n=(await(0,E.bb)(e,t)).ISummarizer;if(!n)throw new S.Oi("Fluid object does not implement ISummarizer");return n}}async processSavedOps(e){for(const t of e.savedOps)this.process(t,!1),await this.pendingStateManager.applyStashedOpsAt(t.sequenceNumber);await this.pendingStateManager.applyStashedOpsAt()}}const kt=async(e,t)=>new Promise(((n,r)=>{e.on("closed",r);const i=r=>{r.sequenceNumber>=t&&(n(),e.off("op",i))};e.on("op",i)}))},9680:(e,t,n)=>{"use strict";n.d(t,{P:()=>i});var r=n(9268);class i{constructor(e){this.map=new Map;for(const t of e){if(this.map.has(t[0]))throw new r.Oi("Duplicate entry names exist");this.map.set(t[0],t[1])}}get IFluidDataStoreRegistry(){return this}async get(e){if(this.map.has(e))return this.map.get(e)}}},9268:(e,t,n)=>{"use strict";n.d(t,{FQ:()=>o,HN:()=>h,Hi:()=>u,Jd:()=>l,Lf:()=>c,Oi:()=>a,pY:()=>s});var r=n(7819),i=n(2718);class s extends i.j4{constructor(e,t,n){super(e,n,new Set(["error"])),this.error=t,this.errorType=r.u.genericError}}class o extends i.j4{constructor(e,t,n){super(e,n),this.retryAfterSeconds=t,this.errorType=r.u.throttlingError}static wrap(e,t,n){return(0,i.bO)(e,(e=>new o(e,t)),n)}}class a extends i.j4{constructor(e){super(e,{usageError:!0}),this.errorType="usageError"}}class c extends i.j4{constructor(e,t){super(e,{timeoutMs:t}),this.expiryMs=t,this.errorType=r.u.clientSessionExpiredError}}class l extends i.j4{constructor(e,t){super(e,Object.assign(Object.assign({},t),{dataProcessingError:1})),this.errorType=r.u.dataCorruptionError,this.canRetry=!1}}class u extends i.j4{constructor(e){super(e),this.errorType=r.u.dataProcessingError,this.canRetry=!1}static create(e,t,n,r={}){const i=u.wrapIfUnrecognized(e,t,n);return i.addTelemetryProperties(r),i}static wrapIfUnrecognized(e,t,n){const r=Object.assign({dataProcessingError:1,dataProcessingCodepath:t},void 0===n?void 0:h(n)),s=(0,i.SC)(e,{props:r});if(!(0,i.XY)(s))return s;const o=(0,i.Jn)(s,(e=>new u(e)));return o.addTelemetryProperties(s.getTelemetryProperties()),o}}const h=e=>({messageClientId:e.clientId,messageSequenceNumber:e.sequenceNumber,messageClientSequenceNumber:e.clientSequenceNumber,messageReferenceSequenceNumber:e.referenceSequenceNumber,messageMinimumSequenceNumber:e.minimumSequenceNumber,messageTimestamp:e.timestamp})},8888:(e,t,n)=>{"use strict";n.d(t,{B:()=>i});var r=n(1096);class i{constructor(e,t,n){this.value=e,this.path=t,this.routeContext=n,this.pendingHandlesToMakeVisible=new Set,this.locallyVisible=!1,this.absolutePath=(0,r.H)(t,this.routeContext)}get IFluidHandle(){return this}get isAttached(){return this.routeContext.isAttached}get visible(){return this.isAttached||this.locallyVisible}async get(){return this.value}attachGraph(){this.visible||(this.locallyVisible=!0,this.pendingHandlesToMakeVisible.forEach((e=>{e.attachGraph()})),this.pendingHandlesToMakeVisible.clear(),this.routeContext.attachGraph())}bind(e){this.visible?e.attachGraph():this.pendingHandlesToMakeVisible.add(e)}}},2505:(e,t,n)=>{"use strict";var r;n.d(t,{C:()=>r}),function(e){e.genericError="genericError",e.genericNetworkError="genericNetworkError",e.authorizationError="authorizationError",e.fileNotFoundOrAccessDeniedError="fileNotFoundOrAccessDeniedError",e.throttlingError="throttlingError",e.offlineError="offlineError",e.unsupportedClientProtocolVersion="unsupportedClientProtocolVersion",e.writeError="writeError",e.fetchFailure="fetchFailure",e.incorrectServerResponse="incorrectServerResponse",e.fileOverwrittenInStorage="fileOverwrittenInStorage",e.deltaStreamConnectionForbidden="deltaStreamConnectionForbidden",e.locationRedirection="locationRedirection"}(r||(r={}))},5761:(e,t,n)=>{"use strict";var r;n.d(t,{i:()=>r}),function(e){e.summarizingClient="fluid-client-summarizer",e.createNew="createNew"}(r||(r={}))},1748:(e,t,n)=>{"use strict";n.d(t,{m:()=>u});var r,i,s=n(7384),o=n(686);!function(e){e.File="100644",e.Executable="100755",e.Directory="040000",e.Symlink="120000"}(r||(r={})),function(e){e.Blob="Blob",e.Tree="Tree",e.Attachment="Attachment"}(i||(i={}));var a=n(1044),c=n(2045);function l(e,t,n){const a=[];for(const u of t){const t=`${e}${u.path}`;if(u.type===i.Blob){const e=u.value,i=(0,s.k8)(e.contents,e.encoding),o=(0,c.Z)();n.set(o,i);const l={mode:r[u.mode],path:t,sha:o,size:0,type:"blob",url:""};a.push(l)}else if(u.type===i.Tree){(0,o.h)(u.type===i.Tree,257);const e=u.value,s={mode:r[u.mode],path:t,sha:"",size:-1,type:"tree",url:""};a.push(s);const c=l(`${t}/`,e.entries,n);a.push(...c)}}return a}function u(e,t){const n=function(e,t){return{sha:"",tree:l("",e,t),url:""}}(e,t);return(0,a.eB)(n)}},6144:(e,t,n)=>{"use strict";n.d(t,{P:()=>r});class r{constructor(e){this.internalStorageService=e}set policies(e){this._policies=e}get policies(){var e;return null!==(e=this._policies)&&void 0!==e?e:this.internalStorageService.policies}get repositoryUrl(){return this.internalStorageService.repositoryUrl}async getSnapshotTree(e,t){return this.internalStorageService.getSnapshotTree(e,t)}async getVersions(e,t,n){return this.internalStorageService.getVersions(e,t,n)}async uploadSummaryWithContext(e,t){return this.internalStorageService.uploadSummaryWithContext(e,t)}async downloadSummary(e){return this.internalStorageService.downloadSummary(e)}async createBlob(e){return this.internalStorageService.createBlob(e)}async readBlob(e){return this.internalStorageService.readBlob(e)}}},4025:(e,t,n)=>{"use strict";var r,i,s;function o(e){if(a(e))return!0;switch(e.type){case r.Propose:case r.Reject:case r.NoOp:return!0;default:return!1}}function a(e){return e.type===r.Operation||e.type===r.Summarize}function c(e){return!!Object.values(s).includes(e.type)}n.d(t,{ag:()=>o,LW:()=>a,_V:()=>c}),function(e){e.NoOp="noop",e.ClientJoin="join",e.ClientLeave="leave",e.Propose="propose",e.Reject="reject",e.Summarize="summarize",e.SummaryAck="summaryAck",e.SummaryNack="summaryNack",e.Operation="op",e.RemoteHelp="remoteHelp",e.NoClient="noClient",e.RoundTrip="tripComplete",e.Control="control"}(r||(r={})),function(e){e.ThrottlingError="ThrottlingError",e.InvalidScopeError="InvalidScopeError",e.BadRequestError="BadRequestError",e.LimitExceededError="LimitExceededError"}(i||(i={})),function(e){e.FluidDataStoreOp="component",e.Attach="attach",e.ChunkedOp="chunkedOp",e.BlobAttach="blobAttach",e.Rejoin="rejoin",e.Alias="alias",e.Operation="op"}(s||(s={}))},9077:(e,t,n)=>{"use strict";n.d(t,{GS:()=>v,Gg:()=>a,M_:()=>h,V2:()=>p,Xp:()=>c,Yz:()=>i,ZZ:()=>b,j:()=>g,jx:()=>m,ms:()=>y,y7:()=>u});var r,i,s=n(2505),o=n(2718);function a(){return"object"==typeof navigator&&null!==navigator&&"boolean"==typeof navigator.onLine?navigator.onLine?i.Online:i.Offline:i.Unknown}!function(e){e[e.Offline=0]="Offline",e[e.Online=1]="Online",e[e.Unknown=2]="Unknown"}(i||(i={}));class c extends o.j4{constructor(e,t,n){super(e,n),this.canRetry=t,this.errorType=s.C.genericNetworkError}}const l="deltaStreamConnectionForbidden";class u extends o.j4{constructor(e,t){super(e,Object.assign(Object.assign({},t),{statusCode:400})),this.errorType=u.errorType,this.canRetry=!1}}u.errorType=null!==(r=s.C[l])&&void 0!==r?r:l;class h extends o.j4{constructor(e,t,n,r){super(e,r,new Set(["claims","tenantId"])),this.claims=t,this.tenantId=n,this.errorType=s.C.authorizationError,this.canRetry=!1}}class d extends o.j4{constructor(e,t,n,r){super(e,r),this.errorType=t,this.canRetry=n}}class p extends d{constructor(e,t,n){super(e,t,!1,n),this.errorType=t}}class f extends o.j4{constructor(e,t,n){super(e,n),this.retryAfterSeconds=t,this.errorType=s.C.throttlingError,this.canRetry=!0}}const g=(e,t)=>new p(e,s.C.writeError,t);function m(e,t,n){return void 0!==t.retryAfterMs&&t.canRetry?new f(e,t.retryAfterMs/1e3,n):new c(e,t.canRetry,n)}const y=e=>!0===(null==e?void 0:e.canRetry),v=e=>null==e?void 0:e.retryAfterSeconds,b=e=>void 0!==(null==e?void 0:e.retryAfterSeconds)?1e3*e.retryAfterSeconds:void 0},9252:(e,t,n)=>{"use strict";n.d(t,{g:()=>i});var r=n(7384);async function i(e,t){const n=await e.readBlob(t),i=(0,r.zT)(n,"utf8");return JSON.parse(i)}},686:(e,t,n)=>{"use strict";function r(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}n.d(t,{h:()=>r})},7384:(e,t,n)=>{"use strict";n.d(t,{k8:()=>s,pv:()=>c,zT:()=>o});var r=n(9742),i=n(686);const s=(e,t)=>c.from(e,t).buffer,o=(e,t)=>c.from(e).toString(t);function a(e){const t=e;return e instanceof ArrayBuffer||"object"==typeof t&&null!==t&&"number"==typeof t.byteLength&&"function"==typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}class c extends Uint8Array{toString(e){return function(e,t){switch(t){case"base64":return r.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}(this,e)}static from(e,t,n){if("string"==typeof e)return c.fromString(e,t);if(null!==e&&"object"==typeof e&&a(e.buffer))return(0,i.h)(0===e.byteOffset,0),(0,i.h)(e.byteLength===e.buffer.byteLength,1),c.fromArrayBuffer(e.buffer,t,n);if(a(e))return c.fromArrayBuffer(e,t,n);throw new TypeError}static fromArrayBuffer(e,t,n){const r=null!=t?t:0,i=null!=n?n:e.byteLength-r;if(r<0||r>e.byteLength||i<0||i+r>e.byteLength)throw new RangeError;return new c(e,r,i)}static fromString(e,t){switch(t){case"base64":{const t=this.sanitizeBase64(e),n=r.toByteArray(t);return new c(n.buffer)}case"utf8":case"utf-8":case void 0:{const t=(new TextEncoder).encode(e);return new c(t.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!=0&&(t+=["","===","==","="][t.length%4]),t}}},1:(e,t,n)=>{"use strict";n.d(t,{G:()=>i});var r=n(6239);class i extends r.L{constructor(e,t){super(),this.container=e,this.rootDataObject=t,this.connectedHandler=()=>this.emit("connected"),this.disconnectedHandler=()=>this.emit("disconnected"),this.disposedHandler=e=>this.emit("disposed",e),this.savedHandler=()=>this.emit("saved"),this.dirtyHandler=()=>this.emit("dirty"),e.on("connected",this.connectedHandler),e.on("closed",this.disposedHandler),e.on("disconnected",this.disconnectedHandler),e.on("saved",this.savedHandler),e.on("dirty",this.dirtyHandler)}get isDirty(){return this.container.isDirty}get attachState(){return this.container.attachState}get disposed(){return this.container.closed}get connectionState(){return this.container.connectionState}get initialObjects(){return this.rootDataObject.initialObjects}async attach(){throw new Error("Cannot attach container. Container is not in detached state")}async connect(){var e,t;null===(t=(e=this.container).connect)||void 0===t||t.call(e)}async disconnect(){var e,t;null===(t=(e=this.container).disconnect)||void 0===t||t.call(e)}async create(e){return this.rootDataObject.create(e)}dispose(){this.container.close(),this.container.off("connected",this.connectedHandler),this.container.off("closed",this.disposedHandler),this.container.off("disconnected",this.disconnectedHandler),this.container.off("saved",this.savedHandler),this.container.off("dirty",this.dirtyHandler)}}},2434:(e,t,n)=>{"use strict";n.d(t,{Y:()=>de,i:()=>ue});var r=n(7648),i=n(5759),s=n(262),o=n(9703),a=n(7187);class c extends a.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}class l extends c{constructor(e){if(super(),this.isDisposed=!1,this.forwardingEvents=new Map,void 0!==e){const t=t=>this.unforwardEvent(e,t),n=t=>this.forwardEvent(e,t);this.on(l.removeListenerEvent,t),this.on(l.newListenerEvent,n)}}static isEmitterEvent(e){return e===l.newListenerEvent||e===l.removeListenerEvent}get disposed(){return this.isDisposed}dispose(){this.isDisposed=!0;for(const e of this.forwardingEvents.values())for(const t of e.values())try{t()}catch(e){}this.removeAllListeners(),this.forwardingEvents.clear()}forwardEvent(e,...t){for(const n of t)if(void 0!==e&&void 0!==n&&!l.isEmitterEvent(n)){let t=this.forwardingEvents.get(n);if(void 0===t&&(t=new Map,this.forwardingEvents.set(n,t)),!t.has(e)){const r=(...e)=>this.emit(n,...e);t.set(e,(()=>e.off(n,r))),e.on(n,r)}}}unforwardEvent(e,...t){for(const n of t)if(void 0!==n&&!l.isEmitterEvent(n)){const t=this.forwardingEvents.get(n);if((null==t?void 0:t.has(e))&&0===this.listenerCount(n)){const r=t.get(e);void 0!==r&&r(),t.delete(e),0===t.size&&this.forwardingEvents.delete(n)}}}}function u(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}l.newListenerEvent="newListener",l.removeListenerEvent="removeListener";var h=n(8888);class d{constructor(e,t){this.absolutePath=e,this.runtime=t,this.isAttached=!0}get IFluidHandle(){return this}attachGraph(){!function(e,t){throw new Error(`0x${202..toString(16).padStart(3,"0")}`)}()}async get(){const e=await this.runtime.IFluidHandleContext.resolveHandle({url:this.absolutePath});if(200===e.status&&"fluid/object"===e.mimeType)return e.value;throw new Error(`Failed to resolve container path ${this.absolutePath}`)}bind(e){throw new Error("Cannot bind to LegacyUriHandle")}}class p extends l{constructor(e){super(),this._disposed=!1,this.runtime=e.runtime,this.context=e.context,this.providers=e.providers,this.initProps=e.initProps,u(void 0===this.runtime._dataObject,189),this.runtime._dataObject=this,this.innerHandle=new h.B(this,"",this.runtime.objectsRoutingContext),this.runtime.once("dispose",(()=>{this._disposed=!0,this.dispose()}))}get disposed(){return this._disposed}get id(){return this.runtime.id}get IFluidRouter(){return this}get IFluidLoadable(){return this}get IFluidHandle(){return this.innerHandle}get handle(){return this.innerHandle}static async getDataObject(e){const t=e._dataObject;return u(void 0!==t,188),await t.finishInitialization(!0),t}async request(e){return this,""===(t=e).url||"/"===t.url||t.url.startsWith("/?")?{mimeType:"fluid/object",status:200,value:this}:(0,o.I4)(t);var t}async finishInitialization(e){return void 0!==this.initializeP||(this.initializeP=this.initializeInternal(e)),this.initializeP}async initializeInternal(e){var t;await this.preInitialize(),e?(u(void 0===this.initProps,190),await this.initializingFromExisting()):await this.initializingFirstTime(null!==(t=this.context.createProps)&&void 0!==t?t:this.initProps),await this.hasInitialized()}async getFluidObjectFromDirectory(e,t,n){const r=n?n(e,t):t.get(e),i=null==r?void 0:r.IFluidHandle;if(i)return i.get()}async getService(e){return function(e,t){return new d(e,t)}(`/_services/${e}`,this.context.containerRuntime).get()}async preInitialize(){}async initializingFirstTime(e){}async initializingFromExisting(){}async hasInitialized(){}dispose(){super.dispose()}}class f extends p{constructor(){super(...arguments),this.rootDirectoryId="root"}async request(e){const t=s.R.create(e);if("bigBlobs"===t.pathParts[0]){const e=this.root.get(t.pathParts.join("/"));return void 0===e?(0,o.I4)(t):{mimeType:"fluid/object",status:200,value:e}}return super.request(t)}get root(){if(!this.internalRoot)throw new Error(this.getUninitializedErrorString("root"));return this.internalRoot}async initializeInternal(e){e?(this.internalRoot=await this.runtime.getChannel(this.rootDirectoryId),this.internalRoot.attributes.type===i.c.Type&&this.runtime.logger.send({category:"generic",eventName:"MapDataObject",message:"Legacy document, SharedMap is masquerading as SharedDirectory in DataObject"})):(this.internalRoot=r.u.create(this.runtime,this.rootDirectoryId),this.internalRoot.bindToContext()),await super.initializeInternal(e)}getUninitializedErrorString(e){return`${e} must be initialized before being accessed.`}}var g=n(9680),m=n(1527),y=n(6734);class v{constructor(){this.handlers=[]}pushHandler(...e){void 0!==e&&this.handlers.push(...e)}async handleRequest(e,t){const n=s.R.create(e);for(const e of this.handlers){const r=await e(n,t);if(void 0!==r)return r}return(0,o.I4)(e)}}const b="IFluidDependencySynthesizer";class S{constructor(...e){this.providers=new Map,this.parents=e.filter((e=>void 0!==e))}get IFluidDependencySynthesizer(){return this}register(e,t){if(this.providers.has(e))throw new Error(`Attempting to register a provider of type ${e} that already exists`);this.providers.set(e,t)}unregister(e){this.providers.has(e)&&this.providers.delete(e)}synthesize(e,t){const n={};return this.generateRequired(n,t),this.generateOptional(n,e),Object.defineProperty(n,b,{get:()=>this}),n}has(e,t){return!!this.providers.has(e)||!0!==t&&this.parents.some((t=>t.has(e)))}getProvider(e){if(this.has(e)){if(this.providers.has(e))return this.providers.get(e);for(const t of this.parents){if(t instanceof S)return t.getProvider(e);{const n=t;if(void 0!==(null==n?void 0:n.getProvider))return n.getProvider(e)}}}}generateRequired(e,t){if(void 0!==t)for(const n of Object.keys(t)){const t=this.resolveProvider(n);if(void 0===t)throw new Error(`Object attempted to be created without registered required provider ${n}`);Object.defineProperty(e,n,t)}}generateOptional(e,t){var n;if(void 0!==t)for(const r of Object.keys(t)){const t=null!==(n=this.resolveProvider(r))&&void 0!==n?n:{get:async()=>{}};Object.defineProperty(e,r,t)}}resolveProvider(e){const t=this.providers.get(e);if(void 0!==t)return"function"==typeof t?{get(){if(t&&"function"==typeof t)return Promise.resolve(this[b]).then((async e=>t(e))).then((t=>null==t?void 0:t[e]))}}:{get(){if(t)return Promise.resolve(t).then((t=>{if(t)return t[e]}))}};for(const t of this.parents){const n={[e]:e},r=t.synthesize(n,{}),i=Object.getOwnPropertyDescriptor(r,e);if(void 0!==i)return i}}}var w=n(4263);class x extends w._{constructor(e,t,n=[],r){super(),this.registryEntries=e,this.dependencyContainer=t,this.requestHandlers=n,this.runtimeOptions=r,this.registry=new g.P(e)}get IFluidDataStoreRegistry(){return this.registry}async instantiateFirstTime(e){await this.containerInitializingFirstTime(e),await this.containerHasInitialized(e)}async instantiateFromExisting(e){await this.containerHasInitialized(e)}async preInitialize(e,t){const n=e.scope,r=new S(this.dependencyContainer,n.IFluidDependencySynthesizer);n.IFluidDependencySynthesizer=r;const i=await m.kE.load(e,this.registryEntries,function(...e){const t=new v;return t.pushHandler(...e),async(e,n)=>t.handleRequest(e,n)}(...this.requestHandlers),this.runtimeOptions,n,t);return r.register(y.IContainerRuntime,i),i}async containerInitializingFirstTime(e){}async containerHasInitialized(e){}}var C=n(3738),E=n(9268);class T extends a.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}class A{constructor(){this.completed=!1,this.p=new Promise(((e,t)=>{this.res=e,this.rej=t}))}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){void 0!==this.res&&(this.completed=!0,this.res(e))}reject(e){void 0!==this.rej&&(this.completed=!0,this.rej(e))}}class k{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return void 0===this.result&&(this.result=this.execute()),this.result}}function N(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}var O,P,R=n(2738),I=n(8595),F=n(2718),D=n(1748);(P=O||(O={})).Tree=1,P.Blob=2,P.Handle=3,P.Attachment=4;var M=n(7983),L=n(1096),_=n(8991),q=n(6705),B=n(2045);class j{constructor(e,t,n,r,i){this.objectId=e,this._connected=t,this.submit=n,this.dirty=r,this.addedGCOutboundReference=i}get handler(){return N(!!this._handler,375),this._handler}get connected(){return this._connected}attach(e){N(void 0===this._handler,376),this._handler=e}setConnectionState(e){this._connected=e,this.handler.setConnectionState(e)}process(e,t,n){try{this.handler.process(e,t,n)}catch(t){throw E.Hi.wrapIfUnrecognized(t,"channelDeltaConnectionFailedToProcessMessage",e)}}reSubmit(e,t){this.handler.reSubmit(e,t)}rollback(e,t){if(void 0===this.handler.rollback)throw new Error("Handler doesn't support rollback");this.handler.rollback(e,t)}applyStashedOp(e){return this.handler.applyStashedOp(e)}}var z=n(484);class H{constructor(e,t,n,r){this.tree=e,this.storage=t,this.logger=n,this.extraBlobs=r,this.flattenedTree={},void 0!==e&&H.flattenTree("",e,this.flattenedTree)}static flattenTree(e,t,n){for(const r in t.trees)H.flattenTree(`${e}${r}/`,t.trees[r],n);for(const r in t.blobs)n[`${e}${r}`]=t.blobs[r]}async contains(e){return void 0!==this.flattenedTree[e]}async readBlob(e){const t=await this.getIdForPath(e),n=void 0!==this.extraBlobs?this.extraBlobs.get(t):void 0;if(void 0!==n)return n;const r=this.storage.readBlob(t);return r.catch((e=>this.logger.sendErrorEvent({eventName:"ChannelStorageBlobError"},e))),r}async list(e){var t;let n=this.tree;const r=(0,z.g)(e);for(;void 0!==n&&r.length>0;){const e=r.shift();n=n.trees[e]}if(void 0===n||0!==r.length)throw new Error("path does not exist");return Object.keys(null!==(t=null==n?void 0:n.blobs)&&void 0!==t?t:{})}async getIdForPath(e){return this.flattenedTree[e]}}const U=".attributes";function V(e,t,n,r,i,s,o,a,c){return{deltaConnection:new j(e,t,((e,t)=>n(e,t)),r,i),objectStorage:new H(a,s,o,c)}}function G(e,t=!1,n=!1,r){const i=e.getAttachSummary(t,n,r);return(0,_.Rt)(i,U,JSON.stringify(e.attributes)),i}async function W(e,t=!1,n=!1,r){const i=await e.summarize(t,n,r);return(0,_.Rt)(i,U,JSON.stringify(e.attributes)),i}var K=n(361),$=n.n(K),J=n(9252);class Q{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}}class X{constructor(e,t,n,r){this.id=e,this.registry=t,this.runtime=n,this.servicesGetter=r,this.globallyVisible=!1,this.pending=[],N(!this.id.includes("/"),783)}async getChannel(){return N(void 0!==this.channel,519),this.channel}get isLoaded(){return void 0!==this.channel}setConnectionState(e,t){this.globallyVisible&&this.isLoaded&&this.servicesGetter().value.deltaConnection.setConnectionState(e)}processOp(e,t,n){N(this.globallyVisible,723),this.isLoaded?this.servicesGetter().value.deltaConnection.process(e,t,n):(N(!1===t,393),this.pending.push(e))}reSubmit(e,t){N(this.isLoaded,394),N(this.globallyVisible,724),this.servicesGetter().value.deltaConnection.reSubmit(e,t)}rollback(e,t){N(this.isLoaded,750),N(this.globallyVisible,751),this.servicesGetter().value.deltaConnection.rollback(e,t)}applyStashedOp(){throw new Error("no stashed ops on local channel")}async summarize(e=!1,t=!1,n){return N(this.isLoaded&&void 0!==this.channel,396),W(this.channel,e,t,n)}getAttachSummary(e){return N(this.isLoaded&&void 0!==this.channel,397),G(this.channel,!0,!1,e)}makeVisible(){if(this.globallyVisible)throw new Error("Channel is already globally visible");this.isLoaded&&(N(!!this.channel,402),this.channel.connect(this.servicesGetter().value)),this.globallyVisible=!0}async getGCData(e=!1){return N(this.isLoaded&&void 0!==this.channel,403),this.channel.getGCData(e)}updateUsedRoutes(e,t){}}class Z extends X{constructor(e,t,n,r,i,s,o,a,c,l){super(e,t,n,(()=>this.services)),this.snapshotTree=l;const u=new Map,h=$()(this.snapshotTree);this.isSnapshotInOldFormatAndCollectBlobs(h,u)&&this.sanitizeSnapshot(h),this.services=new Q((()=>V(this.id,r.connected,o,this.dirtyFn,c,i,s,h,u))),this.dirtyFn=()=>{a(e)}}async getChannel(){return void 0===this.channel&&(this.channel=await this.loadChannel().catch((e=>{throw E.Hi.wrapIfUnrecognized(e,"rehydratedLocalChannelContextFailedToLoadChannel",void 0)}))),this.channel}async loadChannel(){N(!this.isLoaded,398),N(await this.services.value.objectStorage.contains(".attributes"),400);const e=await(0,J.g)(this.services.value.objectStorage,".attributes");if(N(void 0===this.factory,520),this.factory=this.registry.get(e.type),void 0===this.factory)throw new Error(`Channel Factory ${e.type} not registered`);const t=await this.factory.load(this.runtime,this.id,this.services.value,e);this.channel=t;for(const e of this.pending)this.services.value.deltaConnection.process(e,!1,void 0);return this.channel}isSnapshotInOldFormatAndCollectBlobs(e,t){let n=!1;const r=e.blobsContents;Object.entries(r).forEach((([r,i])=>{t.set(r,i),void 0!==e.blobs[r]&&(n=!0)}));for(const r of Object.values(e.trees))n=n||this.isSnapshotInOldFormatAndCollectBlobs(r,t);return n}sanitizeSnapshot(e){const t=new Map(Object.entries(e.blobs));for(const[n,r]of t.entries())void 0===t.get(r)&&delete e.blobs[n];for(const t of Object.values(e.trees))this.sanitizeSnapshot(t)}}class Y extends X{constructor(e,t,n,r,i,s,o,a,c,l){if(super(e,t,r,(()=>this.services)),N(void 0!==n,521),this.factory=t.get(n),void 0===this.factory)throw new Error(`Channel Factory ${n} not registered`);this.channel=this.factory.create(r,e),this.services=new Q((()=>V(this.id,i.connected,a,this.dirtyFn,l,s,o))),this.dirtyFn=()=>{c(e)}}}var ee,te=n(6171);class ne{constructor(e,t,n,r,i,s,o,a,c,l,u,h,d){this.runtime=e,this.dataStoreContext=t,this.id=o,this.registry=c,this.attachMessageType=d,this.isLoaded=!1,this.pending=[],N(!this.id.includes("/"),784),this.subLogger=R.G2.create(this.runtime.logger,"RemoteChannelContext"),this.services=V(this.id,this.dataStoreContext.connected,r,(()=>i(this.id)),s,n,this.subLogger,a,l),this.summarizerNode=u((async(e,t,n)=>this.summarizeInternal(e,t,n)),(async e=>this.getGCDataInternal(e)),(async()=>h())),this.thresholdOpsCounter=new te.z(ne.pendingOpsCountThreshold,this.subLogger)}getChannel(){return void 0===this.channelP&&(this.channelP=this.loadChannel()),this.channelP}setConnectionState(e,t){this.isLoaded&&this.services.deltaConnection.setConnectionState(e)}applyStashedOp(e){return N(this.isLoaded,404),this.services.deltaConnection.applyStashedOp(e)}processOp(e,t,n){this.summarizerNode.invalidate(e.sequenceNumber),this.isLoaded?this.services.deltaConnection.process(e,t,n):(N(!t,405),N(void 0!==this.pending,574),this.pending.push(e),this.thresholdOpsCounter.sendIfMultiple("StorePendingOps",this.pending.length))}reSubmit(e,t){N(this.isLoaded,406),this.services.deltaConnection.reSubmit(e,t)}rollback(e,t){N(this.isLoaded,752),this.services.deltaConnection.rollback(e,t)}async summarize(e=!1,t=!0,n){return this.summarizerNode.summarize(e,t,n)}async summarizeInternal(e,t,n){const r=await this.getChannel(),i=await W(r,e,t,n);return Object.assign(Object.assign({},i),{id:this.id})}async loadChannel(){let e,t;if(N(!this.isLoaded,407),await this.services.objectStorage.contains(U)&&(e=await(0,J.g)(this.services.objectStorage,U)),void 0===e){if(void 0===this.attachMessageType)throw new E.Jd("channelTypeNotAvailable",{channelId:{value:this.id,tag:R.XI.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:R.XI.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/")});if(t=this.registry.get(this.attachMessageType),void 0===t)throw new E.Jd("channelFactoryNotRegisteredForAttachMessageType",{channelId:{value:this.id,tag:R.XI.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:R.XI.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/"),channelFactoryType:this.attachMessageType});e=t.attributes}else if(t=this.registry.get(e.type),void 0===t)throw new E.Jd("channelFactoryNotRegisteredForGivenType",{channelId:{value:this.id,tag:R.XI.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:R.XI.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/"),channelFactoryType:e.type});void 0!==e.snapshotFormatVersion&&e.snapshotFormatVersion!==t.attributes.snapshotFormatVersion&&this.subLogger.sendTelemetryEvent({eventName:"ChannelAttributesVersionMismatch",channelType:{value:e.type,tag:R.XI.PackageData},channelSnapshotVersion:{value:`${e.snapshotFormatVersion}@${e.packageVersion}`,tag:R.XI.PackageData},channelCodeVersion:{value:`${t.attributes.snapshotFormatVersion}@${t.attributes.packageVersion}`,tag:R.XI.PackageData}});const n=await t.load(this.runtime,this.id,this.services,e);N(void 0!==this.pending,575);for(const e of this.pending)this.services.deltaConnection.process(e,!1,void 0);return this.thresholdOpsCounter.send("ProcessPendingOps",this.pending.length),this.channel=n,this.pending=void 0,this.isLoaded=!0,this.services.deltaConnection.setConnectionState(this.dataStoreContext.connected),this.channel}async getGCData(e=!1){return this.summarizerNode.getGCData(e)}async getGCDataInternal(e=!1){return(await this.getChannel()).getGCData(e)}updateUsedRoutes(e,t){this.summarizerNode.updateUsedRoutes([""])}}ne.pendingOpsCountThreshold=1e3,function(e){e.Attach="attach",e.ChannelOp="op"}(ee||(ee={}));class re extends T{constructor(e,t,n){super(),this.dataStoreContext=e,this.sharedObjectRegistry=t,this._disposed=!1,this.contexts=new Map,this.contextsDeferred=new Map,this.pendingAttach=new Map,this.deferredAttached=new A,this.localChannelContextQueue=new Map,this.notBoundedChannelContextSet=new Set,this.pendingHandlesToMakeVisible=new Set,N(!e.id.includes("/"),782),this.logger=R.G2.create(e.logger,"FluidDataStoreRuntime",{all:{dataStoreId:(0,B.Z)()}}),this.id=e.id,this.options=e.options,this.deltaManager=e.deltaManager,this.quorum=e.getQuorum(),this.audience=e.getAudience();const r=e.baseSnapshot;this.channelsBaseGCDetails=new k((async()=>{var e,t,n;const r=await(null!==(n=null===(t=(e=this.dataStoreContext).getBaseGCDetails)||void 0===t?void 0:t.call(e))&&void 0!==n?n:this.dataStoreContext.getInitialGCSummaryDetails());return(0,q.$I)(r)})),void 0!==(null==r?void 0:r.trees)&&Object.keys(r.trees).forEach((t=>{if("_search"===t)return;let n;e.isLocalDataStore?(n=new Z(t,this.sharedObjectRegistry,this,this.dataStoreContext,this.dataStoreContext.storage,this.logger,((e,n)=>this.submitChannelOp(t,e,n)),(e=>this.setChannelDirty(e)),((e,t)=>this.addedGCOutboundReference(e,t)),r.trees[t]),e.attachState!==C.mB.Detached?n.makeVisible():this.localChannelContextQueue.set(t,n)):n=new ne(this,e,e.storage,((e,n)=>this.submitChannelOp(t,e,n)),(e=>this.setChannelDirty(e)),((e,t)=>this.addedGCOutboundReference(e,t)),t,r.trees[t],this.sharedObjectRegistry,void 0,this.dataStoreContext.getCreateChildSummarizerNodeFn(t,{type:M.CreateSummarizerNodeSource.FromSummary}),(async()=>this.getChannelBaseGCDetails(t)));const i=new A;i.resolve(n),this.contexts.set(t,n),this.contextsDeferred.set(t,i)})),this.attachListener(),this.bindState=n?C.xU.Bound:C.xU.NotBound,this._attachState=e.attachState,this.visibilityState=n?e.attachState===C.mB.Detached?M.VisibilityState.LocallyVisible:M.VisibilityState.GloballyVisible:M.VisibilityState.NotVisible,n&&this.deferredAttached.resolve()}static load(e,t,n){return new re(e,t,n)}get IFluidRouter(){return this}get connected(){return this.dataStoreContext.connected}get clientId(){return this.dataStoreContext.clientId}get clientDetails(){return this.dataStoreContext.clientDetails}get isAttached(){return this.attachState!==C.mB.Detached}get attachState(){return this._attachState}get absolutePath(){return(0,L.H)(this.id,this.routeContext)}get routeContext(){return this.dataStoreContext.IFluidHandleContext}get IFluidHandleContext(){return this}get rootRoutingContext(){return this}get channelsRoutingContext(){return this}get objectsRoutingContext(){return this}get disposed(){return this._disposed}dispose(){this._disposed||(this._disposed=!0,this.emit("dispose"),this.removeAllListeners())}async resolveHandle(e){return this.request(e)}async request(e){try{const t=s.R.create(e),n=t.pathParts[0];if("_channels"===n||"_custom"===n)return this.request(t.createSubRequest(1));if(this.contextsDeferred.has(n)&&t.isLeaf(1))try{const e=await this.contextsDeferred.get(n).promise;return{mimeType:"fluid/object",status:200,value:await e.getChannel()}}catch(t){return this.logger.sendErrorEvent({eventName:"GetChannelFailedInRequest"},t),(0,o.Ys)(500,`Failed to get Channel: ${t}`,e)}return(0,o.I4)(e)}catch(e){return(0,o.Nj)(e)}}async getChannel(e){this.verifyNotClosed(),this.contextsDeferred.has(e)||this.contextsDeferred.set(e,new A);const t=await this.contextsDeferred.get(e).promise;return await t.getChannel()}createChannel(e=(0,B.Z)(),t){if(e.includes("/"))throw new E.Oi(`Id cannot contain slashes: ${e}`);this.verifyNotClosed(),N(!this.contexts.has(e),377),this.notBoundedChannelContextSet.add(e);const n=new Y(e,this.sharedObjectRegistry,t,this,this.dataStoreContext,this.dataStoreContext.storage,this.logger,((t,n)=>this.submitChannelOp(e,t,n)),(e=>this.setChannelDirty(e)),((e,t)=>this.addedGCOutboundReference(e,t)));if(this.contexts.set(e,n),this.contextsDeferred.has(e))this.contextsDeferred.get(e).resolve(n);else{const t=new A;t.resolve(n),this.contextsDeferred.set(e,t)}return N(!!n.channel,378),n.channel}bindChannel(e){N(this.notBoundedChannelContextSet.has(e.id),379),this.notBoundedChannelContextSet.delete(e.id),this.isAttached?this.attachChannel(e):this.pendingHandlesToMakeVisible.has(e.handle)||(this.bind(e.handle),this.localChannelContextQueue.has(e.id)||this.localChannelContextQueue.set(e.id,this.contexts.get(e.id)))}makeVisibleAndAttachGraph(){this.visibilityState===M.VisibilityState.NotVisible&&(this.visibilityState=M.VisibilityState.LocallyVisible,this.pendingHandlesToMakeVisible.forEach((e=>{e.attachGraph()})),this.pendingHandlesToMakeVisible.clear(),this.bindToContext())}attachGraph(){this.makeVisibleAndAttachGraph()}bindToContext(){this.bindState===C.xU.NotBound&&(this.bindState=C.xU.Binding,this.dataStoreContext.bindToContext(),this.bindState=C.xU.Bound)}bind(e){this.visibilityState===M.VisibilityState.NotVisible?this.pendingHandlesToMakeVisible.add(e):e.attachGraph()}setConnectionState(e,t){this.verifyNotClosed();for(const[,n]of this.contexts)n.setConnectionState(e,t);(0,I.Qq)(this.logger,this,e,t)}getQuorum(){return this.quorum}getAudience(){return this.audience}async uploadBlob(e){return this.verifyNotClosed(),this.dataStoreContext.uploadBlob(e)}process(e,t,n){this.verifyNotClosed();try{switch(e.type){case ee.Attach:{const n=e.contents,r=n.id;if(t)N(this.pendingAttach.has(r),380),this.pendingAttach.delete(r);else{N(!this.contexts.has(r),381);const t=new Map,i=(0,D.m)(n.snapshot.entries,t),s=new ne(this,this.dataStoreContext,this.dataStoreContext.storage,((e,t)=>this.submitChannelOp(r,e,t)),(e=>this.setChannelDirty(e)),((e,t)=>this.addedGCOutboundReference(e,t)),r,i,this.sharedObjectRegistry,t,this.dataStoreContext.getCreateChildSummarizerNodeFn(r,{type:M.CreateSummarizerNodeSource.FromAttach,sequenceNumber:e.sequenceNumber,snapshot:n.snapshot}),(async()=>this.getChannelBaseGCDetails(r)),n.type);if(this.contexts.set(r,s),this.contextsDeferred.has(r))this.contextsDeferred.get(r).resolve(s);else{const e=new A;e.resolve(s),this.contextsDeferred.set(r,e)}}break}case ee.ChannelOp:this.processChannelOp(e,t,n)}this.emit("op",e)}catch(t){throw E.Hi.wrapIfUnrecognized(t,"fluidDataStoreRuntimeFailedToProcessMessage",e)}}processSignal(e,t){this.emit("signal",e,t)}isChannelAttached(e){return!this.notBoundedChannelContextSet.has(e)&&!this.localChannelContextQueue.has(e)&&!this.pendingAttach.has(e)}getOutboundRoutes(){const e=[];for(const[t]of this.contexts)e.push(`${this.absolutePath}/${t}`);return e}updateGCNodes(e){e.addRouteToAllNodes(this.absolutePath),e.addNode("/",this.getOutboundRoutes())}async getGCData(e=!1){const t=new q.iR;return await Promise.all(Array.from(this.contexts).filter((([e,t])=>this.isChannelAttached(e))).map((async([n,r])=>{const i=await r.getGCData(e);t.prefixAndAddNodes(n,i.gcNodes)}))),this.updateGCNodes(t),t.getGCData()}updateUsedRoutes(e,t){var n;const r=(0,q.xu)(e);for(const[e]of r)N(this.contexts.has(e),382);for(const[e,i]of this.contexts)i.updateUsedRoutes(null!==(n=r.get(e))&&void 0!==n?n:[],t)}addedGCOutboundReference(e,t){var n,r;null===(r=(n=this.dataStoreContext).addedGCOutboundReference)||void 0===r||r.call(n,e,t)}async getChannelBaseGCDetails(e){var t;let n=(await this.channelsBaseGCDetails).get(e);return void 0===n?n={}:void 0!==(null===(t=n.gcData)||void 0===t?void 0:t.gcNodes)&&(0,q.DJ)(n.gcData.gcNodes,this.absolutePath),void 0!==n.usedRoutes&&0!==n.usedRoutes.length||(n.usedRoutes=[""]),n}async summarize(e=!1,t=!0,n){const r=new _.x1;return await Promise.all(Array.from(this.contexts).filter((([e,t])=>{const n=this.isChannelAttached(e);return N(n,383),n})).map((async([i,s])=>{const o=await s.summarize(e,t,n);r.addWithStats(i,o)}))),r.getSummaryTree()}getAttachSummary(e){this.attachGraph();const t=new _.x1;for(const[n,r]of this.contexts){if(!(r instanceof X))throw new F.j4("Should only be called with local channel handles");if(!this.notBoundedChannelContextSet.has(n)){let i;if(r.isLoaded){const t=r.getAttachSummary(e);N(t.summary.type===O.Tree,384),i={stats:t.stats,summary:t.summary}}else N(!!this.dataStoreContext.baseSnapshot,385),i=(0,_.S5)(this.dataStoreContext.baseSnapshot.trees[n]);t.addWithStats(n,i)}}return t.getSummaryTree()}submitMessage(e,t,n){this.submit(e,t,n)}submitSignal(e,t){return this.verifyNotClosed(),this.dataStoreContext.submitSignal(e,t)}async waitAttached(){return this.deferredAttached.promise}attachChannel(e){if(this.verifyNotClosed(),e.handle.isAttached)return;e.handle.attachGraph(),N(this.isAttached,386),N(this.visibilityState===M.VisibilityState.GloballyVisible,720);const t=G(e,!0,!1),n=(0,_.H4)(t.summary),r={id:e.id,snapshot:n,type:e.attributes.type};this.pendingAttach.set(e.id,r),this.submit(ee.Attach,r),this.contexts.get(e.id).makeVisible()}submitChannelOp(e,t,n){const r={address:e,contents:t};this.submit(ee.ChannelOp,r,n)}submit(e,t,n=void 0){this.verifyNotClosed(),this.dataStoreContext.submitMessage(e,t,n)}reSubmit(e,t,n){switch(this.verifyNotClosed(),e){case ee.ChannelOp:{const e=t,r=this.contexts.get(e.address);N(!!r,387),r.reSubmit(e.contents,n);break}case ee.Attach:this.submit(e,t,n);break;default:!function(e,t="Unreachable Case"){throw new Error(t)}()}}rollback(e,t,n){switch(this.verifyNotClosed(),e){case ee.ChannelOp:{const e=t,r=this.contexts.get(e.address);N(!!r,749),r.rollback(e.contents,n);break}default:throw new F.j4(`Can't rollback ${e} message`)}}async applyStashedOp(e){const t=e,n=this.contexts.get(t.address);return N(!!n,388),await n.getChannel(),n.applyStashedOp(t.contents)}setChannelDirty(e){this.verifyNotClosed(),this.dataStoreContext.setChannelDirty(e)}processChannelOp(e,t,n){this.verifyNotClosed();const r=e.contents,i=Object.assign(Object.assign({},e),{contents:r.contents}),s=this.contexts.get(r.address);return N(!!s,389),s.processOp(i,t,n),s}attachListener(){this.setMaxListeners(Number.MAX_SAFE_INTEGER),this.dataStoreContext.once("attaching",(()=>{this.attachGraph(),this._attachState=C.mB.Attaching,N(this.visibilityState===M.VisibilityState.LocallyVisible,721),this.visibilityState=M.VisibilityState.GloballyVisible,this.localChannelContextQueue.forEach((e=>{e.makeVisible()})),this.localChannelContextQueue.clear(),this.deferredAttached.resolve(),this.emit("attaching")})),this.dataStoreContext.once("attached",(()=>{N(this.visibilityState===M.VisibilityState.GloballyVisible,722),this._attachState=C.mB.Attached,this.emit("attached")}))}verifyNotClosed(){if(this._disposed)throw new F.j4("Runtime is closed")}}const ie=(e,t=re)=>class extends t{async request(t){const n=await super.request(t);return 404===n.status?e(t,this):n}};async function se(e,t,n,r,i,s,o){let a=i;a=ie((async(e,t)=>(await p.getDataObject(t)).request(e)),a);const c=new a(t,n,s),l=t.scope,u=new e({runtime:c,context:t,providers:new S(l.IFluidDependencySynthesizer).synthesize(r,{}),initProps:o});return s||await u.finishInitialization(s),{instance:u,runtime:c}}class oe{constructor(e,t,n,r,i,s=re){if(this.type=e,this.ctor=t,this.optionalProviders=r,this.runtimeClass=s,""===this.type)throw new Error("undefined type member");void 0!==i&&(this.registry=new g.P(i)),this.sharedObjectRegistry=new Map(n.map((e=>[e.type,e])))}get IFluidDataStoreFactory(){return this}get IFluidDataStoreRegistry(){return this.registry}get registryEntry(){return[this.type,Promise.resolve(this)]}async instantiateDataStore(e,t){const{runtime:n}=await se(this.ctor,e,this.sharedObjectRegistry,this.optionalProviders,this.runtimeClass,t);return n}async createChildInstance(e,t){return this.createNonRootInstanceCore(e.containerRuntime,[...e.packagePath,this.type],t)}async createPeerInstance(e,t){return this.createNonRootInstanceCore(e.containerRuntime,e.packagePath,t)}async createInstance(e,t){return this.createNonRootInstanceCore(e,[this.type],t)}async createRootInstance(e,t,n){const r=t.createDetachedRootDataStore([this.type],e);return this.createInstanceCore(r,n)}async createNonRootInstanceCore(e,t,n){const r=e.createDetachedDataStore(t);return this.createInstanceCore(r,n)}async createInstanceCore(e,t){const{instance:n,runtime:r}=await se(this.ctor,e,this.sharedObjectRegistry,this.optionalProviders,this.runtimeClass,!1,t);return await e.attachRuntime(this,r),n}}class ae extends oe{constructor(e,t,n=[],s,o,a=re){const c=[...n];n.find((e=>e.type===r.y.Type))||c.push(r.u.getFactory()),n.find((e=>e.type===i.c.Type))||c.push(i.G.getFactory()),super(e,t,c,s,o,a)}}const ce=e=>void 0!==(null==e?void 0:e.factory),le=e=>void 0!==(null==e?void 0:e.getFactory);class ue extends f{constructor(){super(...arguments),this.initialObjectsDirKey="initial-objects-key",this._initialObjects={}}get initialObjectsDir(){const e=this.root.getSubDirectory(this.initialObjectsDirKey);if(void 0===e)throw new Error("InitialObjects sub-directory was not initialized");return e}async initializingFirstTime(e){this.root.createSubDirectory(this.initialObjectsDirKey);const t=[];Object.entries(e.initialObjects).forEach((([e,n])=>{t.push((async()=>{const t=await this.create(n);this.initialObjectsDir.set(e,t.handle)})())})),await Promise.all(t)}async hasInitialized(){const e=[];for(const[t,n]of Array.from(this.initialObjectsDir.entries())){const r=async()=>{const e=await n.get();Object.assign(this._initialObjects,{[t]:e})};e.push(r())}await Promise.all(e)}get initialObjects(){if(0===Object.keys(this._initialObjects).length)throw new Error("Initial Objects were not correctly initialized");return this._initialObjects}async create(e){if(ce(e))return this.createDataObject(e);if(le(e))return this.createSharedObject(e);throw new Error("Could not create new Fluid object because an unknown object was passed")}async createDataObject(e){const t=e.factory,n=[...this.context.packagePath,t.type],r=await this.context.containerRuntime.createDataStore(n);return(0,o.bb)(r,"/")}createSharedObject(e){const t=e.getFactory();return this.runtime.createChannel(void 0,t.type)}}const he="rootDOId";class de extends x{constructor(e){const[t,n]=(e=>{var t;const n=new Set,r=new Set;if(new Set([...Object.values(e.initialObjects),...null!==(t=e.dynamicObjectTypes)&&void 0!==t?t:[]]).forEach((e=>{if(le(e))r.add(e.getFactory());else{if(!ce(e))throw new Error("Entry is neither a DataObject or a SharedObject");n.add([e.factory.type,Promise.resolve(e.factory)])}})),0===n.size&&0===r.size)throw new Error("Container cannot be initialized without any DataTypes");return[Array.from(n),Array.from(r)]})(e),r=new ae("rootDO",ue,n,{},t);var i;super([r.registryEntry],void 0,[(i=he,async(e,t)=>{const n=s.R.create(e);if(0===n.pathParts.length)return t.IFluidHandleContext.resolveHandle({url:`/${i}${n.query}`,headers:e.headers})})],{flushMode:M.FlushMode.Immediate}),this.rootDataObjectFactory=r,this.initialObjects=e.initialObjects}async containerInitializingFirstTime(e){await this.rootDataObjectFactory.createRootInstance(he,e,{initialObjects:this.initialObjects})}}},9074:(e,t,n)=>{"use strict";n.d(t,{c:()=>i});var r=n(6239);class i extends r.L{constructor(e){super(),this.container=e,this.lastMembers=new Map,this.audience=e.audience,this.getMembers(),this.audience.on("addMember",((e,t)=>{if(this.shouldIncludeAsMember(t)){const t=this.getMember(e);this.emit("memberAdded",e,t),this.emit("membersChanged")}})),this.audience.on("removeMember",(e=>{this.lastMembers.has(e)&&(this.emit("memberRemoved",e,this.lastMembers.get(e)),this.emit("membersChanged"))})),this.container.on("connected",(()=>this.emit("membersChanged")))}getMembers(){const e=new Map,t=new Map;return this.audience.getMembers().forEach(((n,r)=>{if(this.shouldIncludeAsMember(n)){const i=n.user.id;let s=e.get(i);void 0===s&&(s=this.createServiceMember(n),e.set(i,s)),s.connections.push({id:r,mode:n.mode}),t.set(r,s)}})),this.lastMembers=t,e}getMyself(){const e=this.container.clientId;if(void 0!==e)return this.getMember(e)}getMember(e){const t=this.audience.getMember(e);if(void 0===t)return;const n=this.getMembers().get(null==t?void 0:t.user.id);if(void 0===n)throw Error(`Attempted to fetch client ${e} that is not part of the current member list`);return n}shouldIncludeAsMember(e){return e.details.capabilities.interactive}}},6239:(e,t,n)=>{"use strict";n.d(t,{L:()=>i});var r=n(7187);class i extends r.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}},6705:(e,t,n)=>{"use strict";function r(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}function i(e){return e.replace(/^\/+|\/+$/g,"")}function s(e){const t={};for(const[n,r]of Object.entries(e.gcNodes))t[n]=Array.from(r);return{gcNodes:t}}function o(e){const t=new Map;if(void 0===e.gcData)return t;const n=e.gcData.gcNodes;delete n["/"];for(const[e,i]of Object.entries(n)){r(e.startsWith("/"),686);const n=e.split("/")[1];let s=e.slice(n.length+1);""===s&&(s="/");let o=t.get(n);void 0===o&&(o={gcData:{gcNodes:{}},usedRoutes:[]}),r(void 0!==o.gcData,687),o.gcData.gcNodes[s]=[...new Set(i)],t.set(n,o)}if(void 0===e.usedRoutes)return t;const i=e.usedRoutes.filter((e=>""!==e&&"/"!==e));for(const e of i){r(e.startsWith("/"),688);const n=e.split("/")[1],i=e.slice(n.length+1),s=t.get(n);r(void 0!==(null==s?void 0:s.usedRoutes),689),s.usedRoutes.push(i),t.set(n,s)}return t}function a(e){const t=e.filter((e=>""!==e&&"/"!==e)),n=new Map;for(const e of t){r(e.startsWith("/"),408);const t=e.split("/")[1],i=e.slice(t.length+1),s=n.get(t);void 0!==s?s.push(i):n.set(t,[i])}return n}function c(e,t){const n=Object.entries(e);for(const[r,i]of n){const n=new Set(i);n.delete(t),e[r]=[...n]}}function l(e,t){var n;const i={};for(const[t,n]of Object.entries(e.gcNodes))i[t]={outboundRoutes:Array.from(n.outboundRoutes),unreferencedTimestampMs:n.unreferencedTimestampMs};for(const[e,s]of Object.entries(t.gcNodes)){let t=i[e];void 0===t?t={outboundRoutes:Array.from(s.outboundRoutes),unreferencedTimestampMs:s.unreferencedTimestampMs}:(void 0!==s.unreferencedTimestampMs&&void 0!==t.unreferencedTimestampMs&&r(s.unreferencedTimestampMs===t.unreferencedTimestampMs,690),t={outboundRoutes:[...new Set([...s.outboundRoutes,...t.outboundRoutes])],unreferencedTimestampMs:null!==(n=s.unreferencedTimestampMs)&&void 0!==n?n:t.unreferencedTimestampMs}),i[e]=t}return{gcNodes:i}}function u(e,t){const n=s(e);for(const[e,r]of Object.entries(t.gcNodes))if(void 0===n.gcNodes[e])n.gcNodes[e]=Array.from(r);else{const t=[...r,...n.gcNodes[e]];n.gcNodes[e]=[...new Set(t)]}return n}n.d(t,{iR:()=>h,rn:()=>s,$4:()=>u,eF:()=>l,DJ:()=>c,aG:()=>i,$I:()=>o,xu:()=>a});class h{constructor(){this.gcNodesSet={}}get gcNodes(){const e={};for(const[t,n]of Object.entries(this.gcNodesSet))e[t]=[...n];return e}addNode(e,t){this.gcNodesSet[e]=new Set(t)}prefixAndAddNodes(e,t){for(const[n,r]of Object.entries(t)){let t=n.replace(/^\/+/g,"");t=`/${e}/${t}`,t=t.replace(/\/+$/g,""),this.gcNodesSet[t]=new Set(r)}}addNodes(e){for(const[t,n]of Object.entries(e))this.gcNodesSet[t]=new Set(n)}addRouteToAllNodes(e){for(const t of Object.values(this.gcNodesSet))t.add(e)}getGCData(){return{gcNodes:this.gcNodes}}}},7648:(e,t,n)=>{"use strict";n.d(t,{y:()=>b,u:()=>S});var r=n(5537),i=n(7187);class s extends i.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}var o,a,c=n(9268),l=n(9252),u=n(4469),h=n(7583),d=n(4148),p=n(8991),f=n(6470),g=n(3080),m=n(7285);const y=f.posix,v="header";class b{get type(){return b.Type}get attributes(){return b.Attributes}async load(e,t,n,r){const i=new S(t,e,r);return await i.load(n),i}create(e,t){const n=new S(t,e,b.Attributes);return n.initializeLocal(),n}}b.Type="https://graph.microsoft.com/types/directory",b.Attributes={type:b.Type,snapshotFormatVersion:"0.1",packageVersion:m.Z};class S extends h.h{constructor(e,t,n){super(e,t,n,"fluid_directory_"),this[o]="SharedDirectory",this.root=new E(this,this.runtime,this.serializer,y.sep),this.messageHandlers=new Map,this.localValueMaker=new g.oU(this.serializer),this.setMessageHandlers(),this.root.on("containedValueChanged",((e,t)=>{this.emit("containedValueChanged",e,t,this)})),this.root.on("subDirectoryCreated",((e,t)=>{this.emit("subDirectoryCreated",e,t,this)})),this.root.on("subDirectoryDeleted",((e,t)=>{this.emit("subDirectoryDeleted",e,t,this)}))}static create(e,t){return e.createChannel(t,b.Type)}static getFactory(){return new b}get absolutePath(){return this.root.absolutePath}get(e){return this.root.get(e)}set(e,t){return this.root.set(e,t),this}dispose(e){this.root.dispose(e)}get disposed(){return this.root.disposed}delete(e){return this.root.delete(e)}clear(){this.root.clear()}has(e){return this.root.has(e)}get size(){return this.root.size}forEach(e){this.root.forEach(e)}[(o=Symbol.toStringTag,Symbol.iterator)](){return this.root[Symbol.iterator]()}entries(){return this.root.entries()}countSubDirectory(){return this.root.countSubDirectory()}keys(){return this.root.keys()}values(){return this.root.values()}createSubDirectory(e){return this.root.createSubDirectory(e)}getSubDirectory(e){return this.root.getSubDirectory(e)}hasSubDirectory(e){return this.root.hasSubDirectory(e)}deleteSubDirectory(e){return this.root.deleteSubDirectory(e)}subdirectories(){return this.root.subdirectories()}getWorkingDirectory(e){const t=this.makeAbsolute(e);if(t===y.sep)return this.root;let n=this.root;const r=t.substr(1).split(y.sep);for(const e of r)if(n=n.getSubDirectory(e),!n)return;return n}summarizeCore(e,t){return this.serializeDirectory(this.root,e)}submitDirectoryMessage(e,t){this.submitLocalMessage(e,t)}onDisconnect(){}reSubmitCore(e,t){const n=e,i=this.messageHandlers.get(n.type);(0,r.h)(void 0!==i,13),i.submit(n,t)}async loadCore(e){const t=await(0,l.g)(e,v),n=t;Array.isArray(n.blobs)?(this.populate(n.content),await Promise.all(n.blobs.map((async t=>{const n=await(0,l.g)(e,t);this.populate(n)})))):this.populate(t)}populate(e){const t=[];for(t.push([this.root,e]);t.length>0;){const[e,n]=t.pop();if(n.subdirectories)for(const[r,i]of Object.entries(n.subdirectories)){let n=e.getSubDirectory(r);n||(n=new E(this,this.runtime,this.serializer,y.join(e.absolutePath,r)),e.populateSubDirectory(r,n)),t.push([n,i])}if(n.storage)for(const[t,r]of Object.entries(n.storage)){const n=this.makeLocal(t,e.absolutePath,r);e.populateStorage(t,n)}}}processCore(e,t,n){if(e.type===u.C.Operation){const i=e.contents,s=this.messageHandlers.get(i.type);(0,r.h)(void 0!==s,14),s.process(i,t,n)}}rollback(e,t){const n=e,r=this.getWorkingDirectory(n.path);r&&r.rollback(n,t)}makeAbsolute(e){return y.resolve(y.sep,e)}makeLocal(e,t,n){return(0,r.h)(n.type===d.G[d.G.Plain]||n.type===d.G[d.G.Shared],484),this.localValueMaker.fromSerializable(n)}setMessageHandlers(){this.messageHandlers.set("clear",{process:(e,t,n)=>{const r=this.getWorkingDirectory(e.path);r&&r.processClearMessage(e,t,n)},submit:(e,t)=>{const n=this.getWorkingDirectory(e.path);n&&n.resubmitClearMessage(e,t)}}),this.messageHandlers.set("delete",{process:(e,t,n)=>{const r=this.getWorkingDirectory(e.path);r&&r.processDeleteMessage(e,t,n)},submit:(e,t)=>{const n=this.getWorkingDirectory(e.path);n&&n.resubmitKeyMessage(e,t)}}),this.messageHandlers.set("set",{process:(e,t,n)=>{const r=this.getWorkingDirectory(e.path);if(r){const i=t?void 0:this.makeLocal(e.key,e.path,e.value);r.processSetMessage(e,i,t,n)}},submit:(e,t)=>{const n=this.getWorkingDirectory(e.path);n&&n.resubmitKeyMessage(e,t)}}),this.messageHandlers.set("createSubDirectory",{process:(e,t,n)=>{const r=this.getWorkingDirectory(e.path);r&&r.processCreateSubDirectoryMessage(e,t,n)},submit:(e,t)=>{const n=this.getWorkingDirectory(e.path);n&&n.resubmitSubDirectoryMessage(e,t)}}),this.messageHandlers.set("deleteSubDirectory",{process:(e,t,n)=>{const r=this.getWorkingDirectory(e.path);r&&r.processDeleteSubDirectoryMessage(e,t,n)},submit:(e,t)=>{const n=this.getWorkingDirectory(e.path);n&&n.resubmitSubDirectoryMessage(e,t)}})}applyStashedOp(){throw new Error("not implemented")}serializeDirectory(e,t,n){const r=new p.x1;let i=0;const s=[],o=[],a={};for(o.push([e,a]);o.length>0;){const[e,n]=o.pop();for(const[o,a]of e.getSerializedStorage(t)){n.storage||(n.storage={});const t={type:a.type,value:a.value&&JSON.parse(a.value)};if(a.value&&a.value.length>=8192){const n={};let a=n;if(e.absolutePath!==y.sep)for(const t of e.absolutePath.substr(1).split(y.sep)){const e={};a.subdirectories={[t]:e},a=e}a.storage={[o]:t};const c=`blob${i}`;i++,s.push(c),r.addBlob(c,JSON.stringify(n))}else n.storage[o]=t}for(const[t,r]of e.subdirectories()){n.subdirectories||(n.subdirectories={});const e={};n.subdirectories[t]=e,o.push([r,e])}}const c={blobs:s,content:a};return r.addBlob(v,JSON.stringify(c)),r.getSummaryTree()}}function w(e){return void 0!==e&&"number"==typeof e.pendingMessageId&&"edit"===e.type}function x(e){return void 0!==e&&"clear"===e.type&&"number"==typeof e.pendingMessageId&&"object"==typeof e.previousStorage}function C(e){return void 0!==e&&"number"==typeof e.pendingMessageId&&("createSubDir"===e.type&&"boolean"==typeof e.previouslyExisted||"deleteSubDir"===e.type)}class E extends s{constructor(e,t,n,r){super(),this.directory=e,this.runtime=t,this.serializer=n,this.absolutePath=r,this._deleted=!1,this[a]="SubDirectory",this._storage=new Map,this._subdirectories=new Map,this.pendingKeys=new Map,this.pendingSubDirectories=new Map,this.pendingMessageId=-1,this.pendingClearMessageIds=[]}dispose(e){this._deleted=!0,this.emit("disposed",this)}undispose(){this._deleted=!1}get disposed(){return this._deleted}throwIfDisposed(){if(this._deleted)throw new c.Oi("Cannot access Disposed subDirectory")}has(e){return this.throwIfDisposed(),this._storage.has(e)}get(e){var t;return this.throwIfDisposed(),null===(t=this._storage.get(e))||void 0===t?void 0:t.value}set(e,t){if(this.throwIfDisposed(),null==e)throw new Error("Undefined and null keys are not supported");const n=this.directory.localValueMaker.fromInMemory(t),r=(0,g.wA)(n,this.serializer,this.directory.handle),i=this.setCore(e,n,!0);if(!this.directory.isAttached())return this;const s={key:e,path:this.absolutePath,type:"set",value:r};return this.submitKeyMessage(s,i),this}countSubDirectory(){return this._subdirectories.size}createSubDirectory(e){if(this.throwIfDisposed(),null==e)throw new Error("SubDirectory name may not be undefined or null");if(e.includes(y.sep))throw new Error(`SubDirectory name may not contain ${y.sep}`);const t=this.createSubDirectoryCore(e,!0),n=this._subdirectories.get(e);if(!this.directory.isAttached())return n;const r={path:this.absolutePath,subdirName:e,type:"createSubDirectory"};return this.submitCreateSubDirectoryMessage(r,!t),n}getSubDirectory(e){return this.throwIfDisposed(),this._subdirectories.get(e)}hasSubDirectory(e){return this.throwIfDisposed(),this._subdirectories.has(e)}deleteSubDirectory(e){this.throwIfDisposed();const t=this.deleteSubDirectoryCore(e,!0);if(!this.directory.isAttached())return void 0!==t;const n={path:this.absolutePath,subdirName:e,type:"deleteSubDirectory"};return this.submitDeleteSubDirectoryMessage(n,t),void 0!==t}subdirectories(){return this.throwIfDisposed(),this._subdirectories.entries()}getWorkingDirectory(e){return this.throwIfDisposed(),this.directory.getWorkingDirectory(this.makeAbsolute(e))}delete(e){this.throwIfDisposed();const t=this.deleteCore(e,!0);if(!this.directory.isAttached())return void 0!==t;const n={key:e,path:this.absolutePath,type:"delete"};return this.submitKeyMessage(n,t),void 0!==t}clear(){if(this.throwIfDisposed(),!this.directory.isAttached())return void this.clearCore(!0);const e=new Map(this._storage);this.clearCore(!0);const t={path:this.absolutePath,type:"clear"};this.submitClearMessage(t,e)}forEach(e){this.throwIfDisposed(),this._storage.forEach(((t,n,r)=>{e(t.value,n,r)}))}get size(){return this.throwIfDisposed(),this._storage.size}entries(){this.throwIfDisposed();const e=this._storage.entries();return{next(){const t=e.next();return t.done?{value:void 0,done:!0}:{value:[t.value[0],t.value[1].value],done:!1}},[Symbol.iterator](){return this}}}keys(){return this.throwIfDisposed(),this._storage.keys()}values(){this.throwIfDisposed();const e=this._storage.values();return{next(){const t=e.next();return t.done?{value:void 0,done:!0}:{value:t.value.value,done:!1}},[Symbol.iterator](){return this}}}[(a=Symbol.toStringTag,Symbol.iterator)](){return this.throwIfDisposed(),this.entries()}processClearMessage(e,t,n){if(this.throwIfDisposed(),t){(0,r.h)(x(n),15);const e=this.pendingClearMessageIds.shift();(0,r.h)(e===n.pendingMessageId,810)}else this.clearExceptPendingKeys()}processDeleteMessage(e,t,n){this.throwIfDisposed(),this.needProcessStorageOperation(e,t,n)&&this.deleteCore(e.key,t)}processSetMessage(e,t,n,r){this.throwIfDisposed(),this.needProcessStorageOperation(e,n,r)&&this.setCore(e.key,t,n)}processCreateSubDirectoryMessage(e,t,n){this.throwIfDisposed(),this.needProcessSubDirectoryOperation(e,t,n)&&this.createSubDirectoryCore(e.subdirName,t)}processDeleteSubDirectoryMessage(e,t,n){this.throwIfDisposed(),this.needProcessSubDirectoryOperation(e,t,n)&&this.deleteSubDirectoryCore(e.subdirName,t)}submitClearMessage(e,t){this.throwIfDisposed();const n=++this.pendingMessageId;this.pendingClearMessageIds.push(n);const r={type:"clear",pendingMessageId:n,previousStorage:t};this.directory.submitDirectoryMessage(e,r)}resubmitClearMessage(e,t){(0,r.h)(x(t),811);const n=this.pendingClearMessageIds.shift();(0,r.h)(n===t.pendingMessageId,812),this.submitClearMessage(e,t.previousStorage)}getKeyMessageId(e){const t=++this.pendingMessageId,n=this.pendingKeys.get(e.key);return void 0!==n?n.push(t):this.pendingKeys.set(e.key,[t]),t}submitKeyMessage(e,t){this.throwIfDisposed();const n={type:"edit",pendingMessageId:this.getKeyMessageId(e),previousValue:t};this.directory.submitDirectoryMessage(e,n)}resubmitKeyMessage(e,t){(0,r.h)(w(t),813);const n=this.pendingKeys.get(e.key);(0,r.h)(void 0!==n&&n[0]===t.pendingMessageId,814),n.shift(),0===n.length&&this.pendingKeys.delete(e.key),this.submitKeyMessage(e,t.previousValue)}getSubDirMessageId(e){const t=++this.pendingMessageId,n=this.pendingSubDirectories.get(e.subdirName);return void 0!==n?n.push(t):this.pendingSubDirectories.set(e.subdirName,[t]),t}submitCreateSubDirectoryMessage(e,t){this.throwIfDisposed();const n={type:"createSubDir",pendingMessageId:this.getSubDirMessageId(e),previouslyExisted:t};this.directory.submitDirectoryMessage(e,n)}submitDeleteSubDirectoryMessage(e,t){this.throwIfDisposed();const n={type:"deleteSubDir",pendingMessageId:this.getSubDirMessageId(e),subDirectory:t};this.directory.submitDirectoryMessage(e,n)}resubmitSubDirectoryMessage(e,t){(0,r.h)(C(t),815);const n=this.pendingSubDirectories.get(e.subdirName);(0,r.h)(void 0!==n&&n[0]===t.pendingMessageId,816),n.shift(),0===n.length&&this.pendingSubDirectories.delete(e.subdirName),"createSubDir"===t.type?this.submitCreateSubDirectoryMessage(e,t.previouslyExisted):this.submitDeleteSubDirectoryMessage(e,t.subDirectory)}*getSerializedStorage(e){this.throwIfDisposed();for(const[t,n]of this._storage){const r=[t,n.makeSerialized(e,this.directory.handle)];yield r}}populateStorage(e,t){this.throwIfDisposed(),this._storage.set(e,t)}populateSubDirectory(e,t){this.throwIfDisposed(),this._subdirectories.set(e,t)}getLocalValue(e){return this.throwIfDisposed(),this._storage.get(e)}rollbackPendingMessageId(e,t,n){const r=e.get(t),i=null==r?void 0:r.pop();if(!r||i!==n)throw new Error("Rollback op does not match last pending");0===r.length&&e.delete(t)}rollback(e,t){if(void 0===(n=t)||"number"!=typeof n.pendingMessageId||!("edit"===n.type||"deleteSubDir"===n.type||"clear"===n.type&&"object"==typeof n.previousStorage||"createSubDir"===n.type&&"boolean"==typeof n.previouslyExisted))throw new Error("Invalid localOpMetadata");var n;if("clear"===e.type&&"clear"===t.type){t.previousStorage.forEach(((e,t)=>{this.setCore(t,e,!0)}));const e=this.pendingClearMessageIds.pop();if(void 0===e||e!==t.pendingMessageId)throw new Error("Rollback op does match last clear")}else if("delete"!==e.type&&"set"!==e.type||"edit"!==t.type)if("createSubDirectory"===e.type&&"createSubDir"===t.type)t.previouslyExisted||this.deleteSubDirectoryCore(e.subdirName,!0),this.rollbackPendingMessageId(this.pendingSubDirectories,e.subdirName,t.pendingMessageId);else{if("deleteSubDirectory"!==e.type||"deleteSubDir"!==t.type)throw new Error("Unsupported op for rollback");void 0!==t.subDirectory&&(this.undeleteSubDirectoryTree(t.subDirectory),this._subdirectories.set(e.subdirName,t.subDirectory),this.emit("subDirectoryCreated",e.subdirName,!0,this)),this.rollbackPendingMessageId(this.pendingSubDirectories,e.subdirName,t.pendingMessageId)}else void 0===t.previousValue?this.deleteCore(e.key,!0):this.setCore(e.key,t.previousValue,!0),this.rollbackPendingMessageId(this.pendingKeys,e.key,t.pendingMessageId)}makeAbsolute(e){return y.resolve(this.absolutePath,e)}needProcessStorageOperation(e,t,n){if(this.pendingClearMessageIds.length>0)return t&&(0,r.h)(void 0!==n&&w(n)&&n.pendingMessageId<this.pendingClearMessageIds[0],16),!1;if(void 0!==this.pendingKeys.get(e.key)){if(t){(0,r.h)(void 0!==n&&w(n),17);const t=this.pendingKeys.get(e.key);(0,r.h)(void 0!==t&&t[0]===n.pendingMessageId,817),t.shift(),0===t.length&&this.pendingKeys.delete(e.key)}return!1}return!t}needProcessSubDirectoryOperation(e,t,n){if(void 0!==this.pendingSubDirectories.get(e.subdirName)){if(t){(0,r.h)(C(n),18);const t=this.pendingSubDirectories.get(e.subdirName);(0,r.h)(void 0!==t&&t[0]===n.pendingMessageId,818),t.shift(),0===t.length&&this.pendingSubDirectories.delete(e.subdirName)}return!1}return!t}clearExceptPendingKeys(){const e=new Map;this.pendingKeys.forEach(((t,n,r)=>{e.set(n,this._storage.get(n))})),this.clearCore(!1),e.forEach(((e,t,n)=>{this.setCore(t,e,!0)}))}clearCore(e){this._storage.clear(),this.directory.emit("clear",e,this.directory)}deleteCore(e,t){const n=this._storage.get(e),r=null==n?void 0:n.value;if(this._storage.delete(e)){const n={key:e,path:this.absolutePath,previousValue:r};this.directory.emit("valueChanged",n,t,this.directory);const i={key:e,previousValue:r};this.emit("containedValueChanged",i,t,this)}return n}setCore(e,t,n){const r=this._storage.get(e),i=null==r?void 0:r.value;this._storage.set(e,t);const s={key:e,path:this.absolutePath,previousValue:i};this.directory.emit("valueChanged",s,n,this.directory);const o={key:e,previousValue:i};return this.emit("containedValueChanged",o,n,this),r}createSubDirectoryCore(e,t){if(!this._subdirectories.has(e)){const n=y.join(this.absolutePath,e),r=new E(this.directory,this.runtime,this.serializer,n);return this.registerEventsOnSubDirectory(r,e),this._subdirectories.set(e,r),this.emit("subDirectoryCreated",e,t,this),!0}return!1}registerEventsOnSubDirectory(e,t){e.on("subDirectoryCreated",((e,n)=>{this.emit("subDirectoryCreated",y.join(t,e),n,this)})),e.on("subDirectoryDeleted",((e,n)=>{this.emit("subDirectoryDeleted",y.join(t,e),n,this)}))}deleteSubDirectoryCore(e,t){const n=this._subdirectories.get(e);return void 0!==n&&(this._subdirectories.delete(e),this.disposeSubDirectoryTree(n),this.emit("subDirectoryDeleted",e,t,this)),n}disposeSubDirectoryTree(e){if(!e)return;const t=e.subdirectories();for(const[e,n]of t)this.disposeSubDirectoryTree(n);"function"==typeof e.dispose&&e.dispose()}undeleteSubDirectoryTree(e){for(const[e,t]of this._subdirectories.entries())this.undeleteSubDirectoryTree(t);e.undispose()}}},3080:(e,t,n)=>{"use strict";n.d(t,{oU:()=>a,wA:()=>s});var r=n(4148),i=n(8343);function s(e,t,n){const r=e.makeSerialized(t,n);return{type:r.type,value:r.value&&JSON.parse(r.value)}}class o{constructor(e){this.value=e}get type(){return r.G[r.G.Plain]}makeSerialized(e,t){const n=(0,i.Yv)(this.value,e,t);return{type:this.type,value:n}}}class a{constructor(e){this.serializer=e}fromSerializable(e){if(e.type===r.G[r.G.Shared]){e.type=r.G[r.G.Plain];const t={type:"__fluid_handle__",url:e.value};e.value=t}const t=(0,i.lB)(e.value,this.serializer);return new o(t)}fromInMemory(e){return new o(e)}}},5759:(e,t,n)=>{"use strict";n.d(t,{c:()=>m,G:()=>y});var r=n(4469),i=n(9252),s=n(7583),o=n(8991),a=n(4148),c=n(5537),l=n(3080);function u(e){return void 0!==e&&"number"==typeof e.pendingMessageId&&("add"===e.type||"edit"===e.type)}function h(e){return void 0!==e&&"clear"===e.type&&"number"==typeof e.pendingMessageId}class d{constructor(e,t,n,r,i){this.serializer=e,this.handle=t,this.submitMessage=n,this.isAttached=r,this.eventEmitter=i,this.messageHandlers=new Map,this.data=new Map,this.pendingKeys=new Map,this.pendingMessageId=-1,this.pendingClearMessageIds=[],this.localValueMaker=new l.oU(e),this.messageHandlers=this.getMessageHandlers()}get size(){return this.data.size}keys(){return this.data.keys()}entries(){const e=this.data.entries();return{next(){const t=e.next();return t.done?{value:void 0,done:!0}:{value:[t.value[0],t.value[1].value],done:!1}},[Symbol.iterator](){return this}}}values(){const e=this.data.values();return{next(){const t=e.next();return t.done?{value:void 0,done:!0}:{value:t.value.value,done:!1}},[Symbol.iterator](){return this}}}[Symbol.iterator](){return this.entries()}forEach(e){this.data.forEach(((t,n,r)=>{e(t.value,n,r)}))}get(e){const t=this.data.get(e);return void 0===t?void 0:t.value}has(e){return this.data.has(e)}set(e,t){if(null==e)throw new Error("Undefined and null keys are not supported");const n=this.localValueMaker.fromInMemory(t),r=(0,l.wA)(n,this.serializer,this.handle),i=this.setCore(e,n,!0);if(!this.isAttached())return;const s={key:e,type:"set",value:r};this.submitMapKeyMessage(s,i)}delete(e){const t=this.deleteCore(e,!0);if(!this.isAttached())return void 0!==t;const n={key:e,type:"delete"};return this.submitMapKeyMessage(n,t),void 0!==t}clear(){const e=this.isAttached()?new Map(this.data):void 0;this.clearCore(!0),this.isAttached()&&this.submitMapClearMessage({type:"clear"},e)}getSerializedStorage(e){const t={};return this.data.forEach(((n,r)=>{t[r]=n.makeSerialized(e,this.handle)})),t}getSerializableStorage(e){const t={};return this.data.forEach(((n,r)=>{t[r]=(0,l.wA)(n,e,this.handle)})),t}serialize(e){return JSON.stringify(this.getSerializableStorage(e))}populateFromSerializable(e){for(const[t,n]of Object.entries(e)){const e={key:t,value:this.makeLocal(t,n)};this.data.set(e.key,e.value)}}populate(e){this.populateFromSerializable(JSON.parse(e))}trySubmitMessage(e,t){const n=this.messageHandlers.get(e.type);return void 0!==n&&(n.submit(e,t),!0)}tryGetStashedOpLocalMetadata(e){const t=this.messageHandlers.get(e.type);if(void 0===t)throw new Error("no apply stashed op handler");return t.getStashedOpLocalMetadata(e)}tryProcessMessage(e,t,n){const r=this.messageHandlers.get(e.type);return void 0!==r&&(r.process(e,t,n),!0)}rollback(e,t){if(void 0===(n=t)||"number"!=typeof n.pendingMessageId||"add"!==n.type&&"edit"!==n.type&&"clear"!==n.type)throw new Error("Invalid localOpMetadata");var n;if("clear"===e.type&&"clear"===t.type){if(void 0===t.previousMap)throw new Error("Cannot rollback without previous map");t.previousMap.forEach(((e,t)=>{this.setCore(t,e,!0)}));const e=this.pendingClearMessageIds.pop();if(void 0===e||e!==t.pendingMessageId)throw new Error("Rollback op does match last clear")}else{if("delete"!==e.type&&"set"!==e.type)throw new Error("Unsupported op for rollback");{if("add"===t.type)this.deleteCore(e.key,!0);else{if("edit"!==t.type||void 0===t.previousValue)throw new Error("Cannot rollback without previous value");this.setCore(e.key,t.previousValue,!0)}const n=this.pendingKeys.get(e.key),r=null==n?void 0:n.pop();if(!n||r!==t.pendingMessageId)throw new Error("Rollback op does not match last pending");0===n.length&&this.pendingKeys.delete(e.key)}}}setCore(e,t,n){const r=this.data.get(e),i=null==r?void 0:r.value;return this.data.set(e,t),this.eventEmitter.emit("valueChanged",{key:e,previousValue:i},n,this.eventEmitter),r}clearCore(e){this.data.clear(),this.eventEmitter.emit("clear",e,this.eventEmitter)}deleteCore(e,t){const n=this.data.get(e),r=null==n?void 0:n.value;return this.data.delete(e)&&this.eventEmitter.emit("valueChanged",{key:e,previousValue:r},t,this.eventEmitter),n}clearExceptPendingKeys(){const e=new Map;this.pendingKeys.forEach(((t,n)=>{e.set(n,this.data.get(n))})),this.clearCore(!1),e.forEach(((e,t)=>{this.setCore(t,e,!0)}))}makeLocal(e,t){if(t.type===a.G[a.G.Plain]||t.type===a.G[a.G.Shared])return this.localValueMaker.fromSerializable(t);throw new Error("Unknown local value type")}needProcessKeyOperation(e,t,n){if(this.pendingClearMessageIds.length>0)return t&&(0,c.h)(void 0!==n&&u(n)&&n.pendingMessageId<this.pendingClearMessageIds[0],19),!1;if(void 0!==this.pendingKeys.get(e.key)){if(t){(0,c.h)(void 0!==n&&u(n),20);const t=this.pendingKeys.get(e.key);(0,c.h)(void 0!==t&&t[0]===n.pendingMessageId,762),t.shift(),0===t.length&&this.pendingKeys.delete(e.key)}return!1}return!t}getMessageHandlers(){const e=new Map;return e.set("clear",{process:(e,t,n)=>{if(t){(0,c.h)(h(n),21);const e=this.pendingClearMessageIds.shift();(0,c.h)(e===n.pendingMessageId,763)}else 0===this.pendingKeys.size?this.clearCore(t):this.clearExceptPendingKeys()},submit:(e,t)=>{(0,c.h)(h(t),764);const n=this.pendingClearMessageIds.shift();(0,c.h)(n===t.pendingMessageId,765),this.submitMapClearMessage(e,t.previousMap)},getStashedOpLocalMetadata:e=>({type:"clear",pendingMessageId:this.getMapClearMessageId()})}),e.set("delete",{process:(e,t,n)=>{this.needProcessKeyOperation(e,t,n)&&this.deleteCore(e.key,t)},submit:(e,t)=>{this.resubmitMapKeyMessage(e,t)},getStashedOpLocalMetadata:e=>({type:"edit",pendingMessageId:this.getMapKeyMessageId(e)})}),e.set("set",{process:(e,t,n)=>{if(!this.needProcessKeyOperation(e,t,n))return;const r=this.makeLocal(e.key,e.value);this.setCore(e.key,r,t)},submit:(e,t)=>{this.resubmitMapKeyMessage(e,t)},getStashedOpLocalMetadata:e=>({type:"edit",pendingMessageId:this.getMapKeyMessageId(e)})}),e}getMapClearMessageId(){const e=++this.pendingMessageId;return this.pendingClearMessageIds.push(e),e}submitMapClearMessage(e,t){const n={type:"clear",pendingMessageId:this.getMapClearMessageId(),previousMap:t};this.submitMessage(e,n)}getMapKeyMessageId(e){const t=++this.pendingMessageId,n=this.pendingKeys.get(e.key);return void 0!==n?n.push(t):this.pendingKeys.set(e.key,[t]),t}submitMapKeyMessage(e,t){const n=this.getMapKeyMessageId(e),r=t?{type:"edit",pendingMessageId:n,previousValue:t}:{type:"add",pendingMessageId:n};this.submitMessage(e,r)}resubmitMapKeyMessage(e,t){(0,c.h)(u(t),766);const n=this.pendingKeys.get(e.key);(0,c.h)(void 0!==n&&n[0]===t.pendingMessageId,767),n.shift(),0===n.length&&this.pendingKeys.delete(e.key);const r=this.getMapKeyMessageId(e),i="edit"===t.type?{type:"edit",pendingMessageId:r,previousValue:t.previousValue}:{type:"add",pendingMessageId:r};this.submitMessage(e,i)}}var p,f=n(7285);const g="header";class m{get type(){return m.Type}get attributes(){return m.Attributes}async load(e,t,n,r){const i=new y(t,e,r);return await i.load(n),i}create(e,t){const n=new y(t,e,m.Attributes);return n.initializeLocal(),n}}m.Type="https://graph.microsoft.com/types/map",m.Attributes={type:m.Type,snapshotFormatVersion:"0.2",packageVersion:f.Z};class y extends s.h{constructor(e,t,n){super(e,t,n,"fluid_map_"),this[p]="SharedMap",this.kernel=new d(this.serializer,this.handle,((e,t)=>this.submitLocalMessage(e,t)),(()=>this.isAttached()),this)}static create(e,t){return e.createChannel(t,m.Type)}static getFactory(){return new m}keys(){return this.kernel.keys()}entries(){return this.kernel.entries()}values(){return this.kernel.values()}[(p=Symbol.toStringTag,Symbol.iterator)](){return this.kernel.entries()}get size(){return this.kernel.size}forEach(e){this.kernel.forEach(e)}get(e){return this.kernel.get(e)}has(e){return this.kernel.has(e)}set(e,t){return this.kernel.set(e,t),this}delete(e){return this.kernel.delete(e)}clear(){this.kernel.clear()}summarizeCore(e,t){let n=0,r=0,i={};const s=[],a=new o.x1,c=this.kernel.getSerializedStorage(e);for(const e of Object.keys(c)){const t=c[e];if(t.value&&t.value.length>=8192){const n=`blob${r}`;r++,s.push(n);const i={[e]:{type:t.type,value:JSON.parse(t.value)}};a.addBlob(n,JSON.stringify(i))}else{if(n+=t.type.length+21,t.value&&(n+=t.value.length),n>16384){const e=`blob${r}`;r++,s.push(e),a.addBlob(e,JSON.stringify(i)),i={},n=0}i[e]={type:t.type,value:void 0===t.value?void 0:JSON.parse(t.value)}}}const l={blobs:s,content:i};return a.addBlob(g,JSON.stringify(l)),a.getSummaryTree()}async loadCore(e){const t=await(0,i.g)(e,g),n=t;Array.isArray(n.blobs)?(this.kernel.populateFromSerializable(n.content),await Promise.all(n.blobs.map((async t=>{const n=await(0,i.g)(e,t);this.kernel.populateFromSerializable(n)})))):this.kernel.populateFromSerializable(t)}onDisconnect(){}reSubmitCore(e,t){this.kernel.trySubmitMessage(e,t)}applyStashedOp(e){return this.kernel.tryProcessMessage(e,!1,void 0),this.kernel.tryGetStashedOpLocalMetadata(e)}processCore(e,t,n){e.type===r.C.Operation&&this.kernel.tryProcessMessage(e.contents,t,n)}rollback(e,t){this.kernel.rollback(e,t)}}},7285:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r="1.3.7"},5537:(e,t,n)=>{"use strict";function r(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}n.d(t,{h:()=>r})},4469:(e,t,n)=>{"use strict";var r,i;n.d(t,{C:()=>r}),function(e){e.NoOp="noop",e.ClientJoin="join",e.ClientLeave="leave",e.Propose="propose",e.Reject="reject",e.Summarize="summarize",e.SummaryAck="summaryAck",e.SummaryNack="summaryNack",e.Operation="op",e.RemoteHelp="remoteHelp",e.NoClient="noClient",e.RoundTrip="tripComplete",e.Control="control"}(r||(r={})),function(e){e.ThrottlingError="ThrottlingError",e.InvalidScopeError="InvalidScopeError",e.BadRequestError="BadRequestError",e.LimitExceededError="LimitExceededError"}(i||(i={}))},1044:(e,t,n)=>{"use strict";var r,i,s,o,a;function c(e,t="Unreachable Case"){throw new Error(t)}function l(e){const t=e.type===r.Handle?e.handleType:e.type;switch(t){case r.Blob:case r.Attachment:return i.File;case r.Tree:return i.Directory;default:c(0,`Unknown type: ${t}`)}}function u(e){const t=e.type===r.Handle?e.handleType:e.type;switch(t){case r.Blob:case r.Attachment:return"blob";case r.Tree:return"tree";default:c(0,`Unknown type: ${t}`)}}function h(e,t=new Map,n=!1){const r={},i={id:e.sha,blobs:{},trees:{}};r[""]=i;for(const i of e.tree){const e=n?i.path.replace(/^\.app\//,""):i.path,s=e.lastIndexOf("/"),o=e.slice(0,Math.max(0,s)),a=e.slice(s+1),c=r[o];if("tree"===i.type){const t={id:i.sha,blobs:{},commits:{},trees:{}};c.trees[decodeURIComponent(a)]=t,r[e]=t}else{if("blob"!==i.type)throw new Error("Unknown entry type!!");c.blobs[decodeURIComponent(a)]=i.sha,t.set(i.sha,`/${e}`)}}return i}n.d(t,{sG:()=>f,Qp:()=>d,VN:()=>p,eB:()=>h,ZO:()=>l,FE:()=>u}),function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(r||(r={})),(a=i||(i={})).File="100644",a.Executable="100755",a.Directory="040000",a.Symlink="120000",(o=s||(s={})).Blob="Blob",o.Tree="Tree",o.Attachment="Attachment";class d{constructor(e,t,n="utf-8"){this.path=e,this.mode=i.File,this.type=s.Blob,this.value={contents:t,encoding:n}}}class p{constructor(e,t){this.path=e,this.value=t,this.mode=i.Directory,this.type=s.Tree}}class f{constructor(e,t){this.path=e,this.id=t,this.mode=i.File,this.type=s.Attachment,this.value={id:t}}}},2527:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.VisibilityState=t.FlushMode=void 0,(n=t.FlushMode||(t.FlushMode={}))[n.Immediate=0]="Immediate",n[n.TurnBased=1]="TurnBased",t.VisibilityState={NotVisible:"NotVisible",LocallyVisible:"LocallyVisible",GloballyVisible:"GloballyVisible"}},5397:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IFluidDataStoreFactory=void 0,t.IFluidDataStoreFactory="IFluidDataStoreFactory"},9768:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IFluidDataStoreRegistry=void 0,t.IFluidDataStoreRegistry="IFluidDataStoreRegistry"},739:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.gcBlobKey=void 0,t.gcBlobKey="gc"},7983:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(5397),t),i(n(9768),t),i(n(2527),t),i(n(739),t),i(n(7288),t),i(n(5574),t)},7288:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},5574:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.totalBlobSizePropertyName=t.blobCountPropertyName=t.channelsTreeName=t.CreateSummarizerNodeSource=void 0,(n=t.CreateSummarizerNodeSource||(t.CreateSummarizerNodeSource={}))[n.FromSummary=0]="FromSummary",n[n.FromAttach=1]="FromAttach",n[n.Local=2]="Local",t.channelsTreeName=".channels",t.blobCountPropertyName="BlobCount",t.totalBlobSizePropertyName="TotalBlobSize"},1096:(e,t,n)=>{"use strict";function r(e,t){if(""===e)return void 0===t?"":t.absolutePath;{let n=e.startsWith("/")?e.slice(1):e;return n=n.endsWith("/")?n.slice(0,-1):n,void 0===t?`/${n}`:`${"/"===t.absolutePath?"":t.absolutePath}/${n}`}}n.d(t,{H:()=>r})},9703:(e,t,n)=>{"use strict";n.d(t,{I4:()=>c,N_:()=>u,Nj:()=>s,Ys:()=>l,bb:()=>a,fu:()=>o});var r=n(477),i=n(2718);function s(e){if(null!==e&&"object"==typeof e&&!0===e.errorFromRequestFluidObject){const t=e;return{mimeType:"text/plain",status:t.code,value:t.message,get stack(){return t.stack}}}const t=(0,i.FM)();return{mimeType:"text/plain",status:500,value:`${e}`,get stack(){var n;return null!==(n=null==e?void 0:e.stack)&&void 0!==n?n:t.stack}}}function o(e,t){const n=e.value,r=(0,i.FM)();return{errorFromRequestFluidObject:!0,message:n,name:"Error",code:e.status,get stack(){var t;return null!==(t=e.stack)&&void 0!==t?t:r.stack}}}async function a(e,t){const n="string"==typeof t?{url:t}:t,i=await e.request(n);if(200!==i.status||"fluid/object"!==i.mimeType)throw o(i);return(0,r.h)(i.value,410),i.value}const c=e=>l(404,"not found",e);function l(e,t,n){var s;(0,r.h)(200!==e,411);const o=null===(s=n.url)||void 0===s?void 0:s.split("?")[0],a=(0,i.FM)();return{mimeType:"text/plain",status:e,value:void 0===o?t:`${t}: ${o}`,get stack(){return a.stack}}}function u(e,t){return{type:e,get IFluidDataStoreFactory(){return this},get IFluidDataStoreRegistry(){return this},instantiateDataStore:async(e,n)=>(await t).instantiateDataStore(e,n),get:async e=>{var n;return null===(n=(await t).IFluidDataStoreRegistry)||void 0===n?void 0:n.get(e)}}}},9251:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ObjectStoragePartition:()=>s.M,RequestParser:()=>a.R,RuntimeFactoryHelper:()=>c._,SummaryTreeBuilder:()=>h.x1,TelemetryContext:()=>h.TA,addBlobToSummary:()=>h.Rt,addSummarizeResultToSummary:()=>h.QA,addTreeToSummary:()=>h.Jv,calculateStats:()=>h.i6,convertSnapshotTreeToSummaryTree:()=>h.S5,convertSummaryTreeToITree:()=>h.H4,convertToSummaryTree:()=>h.j9,convertToSummaryTreeWithStats:()=>h.MH,create404Response:()=>i.I4,createDataStoreFactory:()=>i.N_,createResponseError:()=>i.Ys,createRootSummarizerNode:()=>l.j,createRootSummarizerNodeWithGC:()=>u.G,exceptionToResponse:()=>i.Nj,generateHandleContextPath:()=>r.H,getBlobSize:()=>h.$A,getNormalizedObjectStoragePathParts:()=>o.g,listBlobsAtTreePath:()=>o.W,mergeStats:()=>h.Jz,requestFluidObject:()=>i.bb,responseToException:()=>i.fu,seqFromTree:()=>d.G,utf8ByteLength:()=>h.mL});var r=n(1096),i=n(9703),s=n(8597),o=n(484),a=n(262),c=n(4263),l=n(8118),u=n(3953),h=n(8991),d=n(1890)},8597:(e,t,n)=>{"use strict";n.d(t,{M:()=>i});var r=n(477);class i{constructor(e,t){this.storage=e,this.path=t,(0,r.h)(!t.endsWith("/"),412)}async readBlob(e){return this.storage.readBlob(`${this.path}/${e}`)}async contains(e){return this.storage.contains(`${this.path}/${e}`)}async list(e){return this.storage.list(`${this.path}/${e}`)}}},484:(e,t,n)=>{"use strict";function r(e){let t=e;return t.startsWith("/")&&(t=t.substr(1)),t.endsWith("/")&&(t=t.substr(0,t.length-1)),t.length>0?t.split("/"):[]}async function i(e,t){const n=r(t);let i=e;for(;void 0!==(null==i?void 0:i.entries)&&n.length>0;){const e=n.shift(),t=i.entries.find((t=>"Tree"===t.type&&t.path===e));i="Tree"===(null==t?void 0:t.type)?t.value:void 0}if(void 0===(null==i?void 0:i.entries)||0!==n.length)throw new Error("path does not exist");return i.entries.filter((e=>"Blob"===e.type)).map((e=>e.path))}n.d(t,{W:()=>i,g:()=>r})},262:(e,t,n)=>{"use strict";n.d(t,{R:()=>r});class r{constructor(e){this.request=e;const t=this.request.url.indexOf("?");this.query=t>=0?this.request.url.substring(t):""}static getPathParts(e){const t=e.indexOf("?");return e.substring(0,t<0?e.length:t).split("/").reduce(((e,t)=>(void 0!==t&&t.length>0&&e.push(decodeURIComponent(t)),e)),[])}static create(e){return e instanceof r?e:new r(e)}get url(){return this.request.url}get headers(){return this.request.headers}get pathParts(){return void 0===this.requestPathParts&&(this.requestPathParts=r.getPathParts(this.url)),this.requestPathParts}isLeaf(e){return""===this.query&&this.pathParts.length===e}createSubRequest(e){const t=this.pathParts.length;if(e<0||e>t)throw new Error("incorrect sub-request");if(e===t&&this.url.includes("?"))return{url:`/${this.query}`,headers:this.headers};const n=`/${this.pathParts.slice(e).join("/")}`;return{url:""===this.query?n:`${n}/${this.query}`,headers:this.headers}}}},4263:(e,t,n)=>{"use strict";n.d(t,{_:()=>r});class r{get IRuntimeFactory(){return this}async instantiateRuntime(e,t){const n=void 0===t?!0===e.existing:t,r=await this.preInitialize(e,n);return n?await this.instantiateFromExisting(r):await this.instantiateFirstTime(r),await this.hasInitialized(r),r}async instantiateFirstTime(e){}async instantiateFromExisting(e){}async hasInitialized(e){}}},8118:(e,t,n)=>{"use strict";n.d(t,{j:()=>u,z:()=>l});var r=n(7983),i=n(6378),s=n(477),o=n(845),a=n(8991),c=n(3945);class l{constructor(e,t,n,r,i,s,o){var a;this.defaultLogger=e,this.summarizeInternalFn=t,this._changeSequenceNumber=r,this._latestSummary=i,this.initialSummary=s,this.wipSummaryLogger=o,this.children=new Map,this.pendingSummaries=new Map,this.outstandingOps=[],this.wipSkipRecursion=!1,this.canReuseHandle=null===(a=n.canReuseHandle)||void 0===a||a,this.throwOnError=!0,this.trackingSequenceNumber=this._changeSequenceNumber}get referenceSequenceNumber(){var e,t;return null!==(t=null===(e=this._latestSummary)||void 0===e?void 0:e.referenceSequenceNumber)&&void 0!==t?t:0}startSummary(e,t){(0,s.h)(void 0===this.wipSummaryLogger,415),(0,s.h)(void 0===this.wipReferenceSequenceNumber,416),this.wipSummaryLogger=t;for(const t of this.children.values())t.startSummary(e,this.wipSummaryLogger);this.wipReferenceSequenceNumber=e}async summarize(e,t=!0,n){if((0,s.h)(this.isTrackingInProgress(),417),(0,s.h)(void 0!==this.wipSummaryLogger,418),this.canReuseHandle&&!e&&!this.hasChanged()){const e=this._latestSummary;if(void 0!==e){this.wipLocalPaths={localPath:e.localPath,additionalPath:e.additionalPath},this.wipSkipRecursion=!0;const t=(0,a.Jz)();return t.handleNodeCount++,{summary:{type:i.J.Handle,handle:e.fullPath.path,handleType:i.J.Tree},stats:t}}}try{const t=await this.summarizeInternalFn(e,!0,n);return this.wipLocalPaths={localPath:c.Zo.create(t.id)},void 0!==t.pathPartsForChildren&&(this.wipLocalPaths.additionalPath=c.Zo.createAndConcat(t.pathPartsForChildren)),{summary:t.summary,stats:t.stats}}catch(e){if(this.throwOnError||this.trackingSequenceNumber<this._changeSequenceNumber)throw e;const t=this._latestSummary,n=this.initialSummary;let r,i;if(void 0!==t)r={fromSummary:!0,summaryNode:t},i=t.localPath;else{if(void 0===(null==n?void 0:n.summary))throw e;r={fromSummary:!1,initialSummary:n.summary},i=c.Zo.create(n.id)}this.wipSummaryLogger.sendErrorEvent({eventName:"SummarizingWithBasePlusOps"},e);const s=(0,c.Cr)(r,this.outstandingOps);return this.wipLocalPaths={localPath:i,additionalPath:s.additionalPath},this.wipSkipRecursion=!0,{summary:s.summary,stats:s.stats}}}completeSummary(e){this.completeSummaryCore(e,void 0,!1)}completeSummaryCore(e,t,n){(0,s.h)(void 0!==this.wipSummaryLogger,419),(0,s.h)(void 0!==this.wipReferenceSequenceNumber,420);let r=this.wipLocalPaths;if(n){const e=this._latestSummary;if(void 0===e)return void this.clearSummary();r={localPath:e.localPath,additionalPath:e.additionalPath}}(0,s.h)(!!r,421);const i=new c.Yl(Object.assign(Object.assign({},r),{referenceSequenceNumber:this.wipReferenceSequenceNumber,basePath:t})),o=i.fullPathForChildren;for(const t of this.children.values())t.completeSummaryCore(e,o,this.wipSkipRecursion||n);this.pendingSummaries.set(e,i),this.clearSummary()}clearSummary(){this.wipReferenceSequenceNumber=void 0,this.wipLocalPaths=void 0,this.wipSkipRecursion=!1,this.wipSummaryLogger=void 0;for(const e of this.children.values())e.clearSummary()}async refreshLatestSummary(e,t,n,r,i){if(void 0!==e){const t=this.pendingSummaries.get(e);if(void 0!==t)return this.refreshLatestSummaryFromPending(e,t.referenceSequenceNumber),{latestSummaryUpdated:!0,wasSummaryTracked:!0}}if(this.referenceSequenceNumber>=t)return{latestSummaryUpdated:!1};const s=await n();return await this.refreshLatestSummaryFromSnapshot(t,s,void 0,c.Zo.create(""),i,r),{latestSummaryUpdated:!0,wasSummaryTracked:!1,snapshot:s}}refreshLatestSummaryFromPending(e,t){const n=this.pendingSummaries.get(e);if(void 0!==n){(0,s.h)(t===n.referenceSequenceNumber,423),this.pendingSummaries.delete(e),this.refreshLatestSummaryCore(t),this._latestSummary=n;for(const n of this.children.values())n.refreshLatestSummaryFromPending(e,t)}else(0,s.h)(void 0===this._latestSummary,422)}async refreshLatestSummaryFromSnapshot(e,t,n,r,i,s){if(this.referenceSequenceNumber>=e)return;this.refreshLatestSummaryCore(e);const{baseSummary:o,pathParts:a}=(0,c.MD)(t,i);this._latestSummary=new c.Yl({referenceSequenceNumber:e,basePath:n,localPath:r});const{childrenTree:l,childrenPathPart:u}=(0,c.TI)(o);void 0!==u&&a.push(u),a.length>0&&(this._latestSummary.additionalPath=c.Zo.createAndConcat(a));const h=this._latestSummary.fullPathForChildren;await Promise.all(Array.from(this.children).filter((([e])=>void 0!==l.trees[e])).map((async([t,n])=>n.refreshLatestSummaryFromSnapshot(e,l.trees[t],h,c.Zo.create(t),i,s))))}refreshLatestSummaryCore(e){for(const[t,n]of this.pendingSummaries)n.referenceSequenceNumber<e&&this.pendingSummaries.delete(t);for(;this.outstandingOps.length>0&&this.outstandingOps[0].sequenceNumber<=e;)this.outstandingOps.shift()}loadBaseSummaryWithoutDifferential(e){const{childrenPathPart:t}=(0,c.TI)(e);void 0!==t&&void 0!==this._latestSummary&&(this._latestSummary.additionalPath=c.Zo.create(t))}async loadBaseSummary(e,t){const n=(0,c.MD)(e,this.defaultLogger),r=await n.getOutstandingOps(t),{childrenPathPart:i}=(0,c.TI)(n.baseSummary);if(void 0!==i&&n.pathParts.push(i),n.pathParts.length>0&&void 0!==this._latestSummary&&(this._latestSummary.additionalPath=c.Zo.createAndConcat(n.pathParts)),r.length>0){const e=r[r.length-1].sequenceNumber;(0,s.h)(e<=this.trackingSequenceNumber,425)}return{baseSummary:n.baseSummary,outstandingOps:r}}recordChange(e){const t=this.outstandingOps[this.outstandingOps.length-1];void 0!==t&&(0,s.h)(t.sequenceNumber<e.sequenceNumber,426),this.invalidate(e.sequenceNumber),this.trackingSequenceNumber=e.sequenceNumber,this.outstandingOps.push(e)}invalidate(e){e>this._changeSequenceNumber&&(this._changeSequenceNumber=e)}hasChanged(){return this._changeSequenceNumber>this.referenceSequenceNumber}get latestSummary(){return this._latestSummary}createChild(e,t,n,r={}){(0,s.h)(!this.children.has(t),427);const i=this.getCreateDetailsForChild(t,n),o=new l(this.defaultLogger,e,r,i.changeSequenceNumber,i.latestSummary,i.initialSummary,this.wipSummaryLogger);return this.maybeUpdateChildState(o),this.children.set(t,o),o}getChild(e){return this.children.get(e)}getCreateDetailsForChild(e,t){var n;let l,u,h;const d=this._latestSummary;switch(t.type){case r.CreateSummarizerNodeSource.FromAttach:if(void 0!==d&&t.sequenceNumber<=d.referenceSequenceNumber)u=d.createForChild(e);else{const n=(0,a.j9)(t.snapshot);l={sequenceNumber:t.sequenceNumber,id:e,summary:n}}h=t.sequenceNumber;break;case r.CreateSummarizerNodeSource.FromSummary:void 0===this.initialSummary&&(0,s.h)(!!d,428);case r.CreateSummarizerNodeSource.Local:{const o=this.initialSummary;if(void 0!==o){let n,u;if(void 0!==o.summary){const{childrenTree:t}=(0,c.ZI)(o.summary.summary);(0,s.h)(t.type===i.J.Tree,470),n=t.tree[e]}t.type===r.CreateSummarizerNodeSource.FromSummary&&(0,s.h)(!!n,429),void 0!==n&&((0,s.h)(n.type===i.J.Tree,430),u={summary:n,stats:(0,a.i6)(n)}),l={sequenceNumber:o.sequenceNumber,id:e,summary:u}}u=null==d?void 0:d.createForChild(e),h=null!==(n=null==d?void 0:d.referenceSequenceNumber)&&void 0!==n?n:-1;break}default:{const e=t.type;(0,o.U)(t,`Unexpected CreateSummarizerNodeSource: ${e}`)}}return{initialSummary:l,latestSummary:u,changeSequenceNumber:h}}maybeUpdateChildState(e){if(this.isTrackingInProgress()&&(e.wipReferenceSequenceNumber=this.wipReferenceSequenceNumber),void 0!==e._latestSummary)for(const[t,n]of this.pendingSummaries.entries()){const r=new c.Yl({referenceSequenceNumber:n.referenceSequenceNumber,basePath:e._latestSummary.basePath,localPath:e._latestSummary.localPath});e.addPendingSummary(t,r)}}addPendingSummary(e,t){this.pendingSummaries.set(e,t)}isTrackingInProgress(){return void 0!==this.wipReferenceSequenceNumber}}const u=(e,t,n,r,i={})=>new l(e,t,i,n,void 0===r?void 0:c.Yl.createForRoot(r))},3945:(e,t,n)=>{"use strict";n.d(t,{Cr:()=>p,MD:()=>d,TI:()=>f,Yl:()=>h,ZI:()=>g,Zo:()=>u});var r=n(477),i=n(6378),s=n(7983),o=n(8991);const a="_baseSummary",c="_outstandingOps",l=100;class u{constructor(e){this.path=e}static create(e){return new u(encodeURIComponent(e))}static createAndConcat(e){var t;let n=u.create(null!==(t=e[0])&&void 0!==t?t:"");for(let t=1;t<e.length;t++)n=n.concat(u.create(e[t]));return n}toString(){return this.path}concat(e){return new u(`${this.path}/${e.path}`)}}class h{constructor(e){this.summary=e}static createForRoot(e){return new h({referenceSequenceNumber:e,basePath:void 0,localPath:u.create("")})}get referenceSequenceNumber(){return this.summary.referenceSequenceNumber}get basePath(){return this.summary.basePath}get localPath(){return this.summary.localPath}get additionalPath(){return this.summary.additionalPath}set additionalPath(e){this.summary.additionalPath=e}get fullPath(){var e,t;return null!==(t=null===(e=this.basePath)||void 0===e?void 0:e.concat(this.localPath))&&void 0!==t?t:this.localPath}get fullPathForChildren(){return void 0!==this.additionalPath?this.fullPath.concat(this.additionalPath):this.fullPath}createForChild(e){return new h({referenceSequenceNumber:this.referenceSequenceNumber,basePath:this.fullPathForChildren,localPath:u.create(e)})}}function d(e,t){let n=e;const i=[],s=[];for(let e=0;;e++){e>l&&t.sendTelemetryEvent({eventName:"DecodeSummaryMaxDepth",maxDecodeDepth:l});const o=n.blobs[c],u=n.trees[a];if(void 0===o&&void 0===u)return{baseSummary:n,pathParts:i,async getOutstandingOps(e){let n=[];for(const r of s){const i=await e(r);if(n.length>0&&i.length>0){const e=n[n.length-1].sequenceNumber,r=i[0].sequenceNumber;if(r<=e)for(t.sendTelemetryEvent({eventName:"DuplicateOutstandingOps",message:`newEarliestSeq <= latestSeq in decodeSummary: ${r} <= ${e}`});i.length>0&&i[0].sequenceNumber<=e;)i.shift()}n=n.concat(i)}return n}};(0,r.h)(!!o,431),(0,r.h)(void 0!==u,432),n=u,i.push(a),s.unshift(o)}}function p(e,t){let n=u.create(a);const r=new o.x1;if(r.addBlob(c,JSON.stringify(t)),e.fromSummary){const t=e.summaryNode;void 0!==t.additionalPath&&(n=n.concat(t.additionalPath)),r.addHandle(a,i.J.Tree,t.fullPath.path)}else r.addWithStats(a,e.initialSummary);const s=r.getSummaryTree();return Object.assign(Object.assign({},s),{additionalPath:n})}function f(e){const t=e.trees[s.channelsTreeName];return void 0!==t?{childrenTree:t,childrenPathPart:s.channelsTreeName}:{childrenTree:e,childrenPathPart:void 0}}function g(e){const t=e.tree[s.channelsTreeName];return void 0!==t?{childrenTree:t,childrenPathPart:s.channelsTreeName}:{childrenTree:e,childrenPathPart:void 0}}},3953:(e,t,n)=>{"use strict";n.d(t,{G:()=>h});class r{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return void 0===this.result&&(this.result=this.execute()),this.result}}var i=n(477),s=n(6705),o=n(7983),a=n(8118),c=n(3945);class l extends c.Yl{constructor(e,t){super(t),this.serializedUsedRoutes=e}}class u extends a.z{constructor(e,t,n,i,s,o,a,c,l){super(e,(async(e,n,r)=>t(e,!0,r)),n,i,s,o,a),this.summarizeFn=t,this.getGCDataFn=c,this.baseGCDetailsLoaded=!1,this.usedRoutes=[""],this.gcDisabled=!0===n.gcDisabled,this.baseGCDetailsP=new r((async()=>{var e;return null!==(e=await(null==l?void 0:l()))&&void 0!==e?e:{usedRoutes:[]}}))}getGCSummaryDetails(){return this.getBaseGCDetails()}getBaseGCDetails(){return{gcData:this.gcData,usedRoutes:this.usedRoutes,unrefTimestamp:this.unreferencedTimestampMs}}async loadBaseGCDetails(){var e;const t=await this.baseGCDetailsP;this.baseGCDetailsLoaded||(this.baseGCDetailsLoaded=!0,void 0!==t.gcData&&(this.gcData=(0,s.rn)(t.gcData)),this.referenceUsedRoutes=null===(e=t.usedRoutes)||void 0===e?void 0:e.sort(),this.unreferencedTimestampMs=t.unrefTimestamp)}async summarize(e,t=!0,n){return!this.gcDisabled&&this.isTrackingInProgress()&&(0,i.h)(void 0!==this.wipSerializedUsedRoutes,433),t?super.summarize(e,!0,n):this.summarizeFn(e,t,n)}async getGCData(e=!1){if((0,i.h)(!this.gcDisabled,434),(0,i.h)(void 0!==this.getGCDataFn,435),await this.loadBaseGCDetails(),!e&&!this.hasDataChanged()&&void 0!==this.gcData)return(0,s.rn)(this.gcData);const t=await this.getGCDataFn(e);return this.gcData=(0,s.rn)(t),t}startSummary(e,t){this.gcDisabled||(0,i.h)(void 0===this.wipSerializedUsedRoutes,436),super.startSummary(e,t)}completeSummaryCore(e,t,n){let r;if(this.gcDisabled||(r=this.wipSerializedUsedRoutes,(0,i.h)(void 0!==r,437)),super.completeSummaryCore(e,t,n),!this.gcDisabled){const t=this.pendingSummaries.get(e);if(void 0!==t){const n=new l(r,t);this.pendingSummaries.set(e,n)}}}clearSummary(){this.wipSerializedUsedRoutes=void 0,super.clearSummary()}refreshLatestSummaryFromPending(e,t){if(!this.gcDisabled){const t=this.pendingSummaries.get(e);void 0!==t&&(this.referenceUsedRoutes=JSON.parse(t.serializedUsedRoutes))}return super.refreshLatestSummaryFromPending(e,t)}async refreshLatestSummaryFromSnapshot(e,t,n,r,i,s){if(!this.gcDisabled){const n=t.blobs[o.gcBlobKey];if(void 0!==n){const t=await s(n);if(this.referenceSequenceNumber>=e)return;this.referenceUsedRoutes=t.usedRoutes}}return super.refreshLatestSummaryFromSnapshot(e,t,n,r,i,s)}createChild(e,t,n,r={},s,o){var a;(0,i.h)(!this.children.has(t),438);const c=this.getCreateDetailsForChild(t,n),l=new u(this.defaultLogger,e,Object.assign(Object.assign({},r),{gcDisabled:null!==(a=r.gcDisabled)&&void 0!==a?a:this.gcDisabled}),c.changeSequenceNumber,c.latestSummary,c.initialSummary,this.wipSummaryLogger,s,o);return this.maybeUpdateChildState(l),this.children.set(t,l),l}deleteChild(e){this.children.delete(e)}getChild(e){return this.children.get(e)}isReferenced(){return this.usedRoutes.includes("")||this.usedRoutes.includes("/")}updateUsedRoutes(e,t){this.usedRoutes=e.sort(),!this.gcDisabled&&this.isTrackingInProgress()&&(this.wipSerializedUsedRoutes=JSON.stringify(this.usedRoutes)),this.isReferenced()?this.unreferencedTimestampMs=void 0:void 0===this.unreferencedTimestampMs&&(this.unreferencedTimestampMs=t)}hasChanged(){return this.hasDataChanged()||this.hasUsedStateChanged()}hasDataChanged(){return super.hasChanged()}hasUsedStateChanged(){return!this.gcDisabled&&(void 0===this.referenceUsedRoutes||JSON.stringify(this.usedRoutes)!==JSON.stringify(this.referenceUsedRoutes))}}const h=(e,t,n,r,i={},s,o)=>new u(e,t,i,n,void 0===r?void 0:c.Yl.createForRoot(r),void 0,void 0,s,o)},8991:(e,t,n)=>{"use strict";n.d(t,{x1:()=>C,TA:()=>N,Rt:()=>S,QA:()=>x,Jv:()=>w,i6:()=>b,S5:()=>A,H4:()=>k,j9:()=>T,MH:()=>E,$A:()=>y,Jz:()=>g,mL:()=>m});var r=n(9742),i=n(477);function s(e,t){switch(t){case"base64":return r.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}const o=(e,t)=>c.from(e).toString(t);function a(e){const t=e;return e instanceof ArrayBuffer||"object"==typeof t&&null!==t&&"number"==typeof t.byteLength&&"function"==typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}class c extends Uint8Array{toString(e){return s(this,e)}static from(e,t,n){if("string"==typeof e)return c.fromString(e,t);if(null!==e&&"object"==typeof e&&a(e.buffer))return(0,i.h)(0===e.byteOffset,0),(0,i.h)(e.byteLength===e.buffer.byteLength,1),c.fromArrayBuffer(e.buffer,t,n);if(a(e))return c.fromArrayBuffer(e,t,n);throw new TypeError}static fromArrayBuffer(e,t,n){const r=null!=t?t:0,i=null!=n?n:e.byteLength-r;if(r<0||r>e.byteLength||i<0||i+r>e.byteLength)throw new RangeError;return new c(e,r,i)}static fromString(e,t){switch(t){case"base64":{const t=this.sanitizeBase64(e),n=r.toByteArray(t);return new c(n.buffer)}case"utf8":case"utf-8":case void 0:{const t=(new TextEncoder).encode(e);return new c(t.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!=0&&(t+=["","===","==","="][t.length%4]),t}}const l=e=>c.from(e,"base64").toString("utf-8");var u,h,d=n(845),p=n(1044),f=n(6378);function g(...e){const t={treeNodeCount:0,blobNodeCount:0,handleNodeCount:0,totalBlobSize:0,unreferencedBlobSize:0};for(const n of e)t.treeNodeCount+=n.treeNodeCount,t.blobNodeCount+=n.blobNodeCount,t.handleNodeCount+=n.handleNodeCount,t.totalBlobSize+=n.totalBlobSize,t.unreferencedBlobSize+=n.unreferencedBlobSize;return t}function m(e){let t=e.length;for(let n=e.length-1;n>=0;n--){const r=e.charCodeAt(n);r>127&&r<=2047?t++:r>2047&&r<=65535&&(t+=2),r>=56320&&r<=57343&&n--}return t}function y(e){return"string"==typeof e?m(e):e.byteLength}function v(e,t){switch(e.type){case f.J.Tree:t.treeNodeCount++;for(const n of Object.values(e.tree))v(n,t);return;case f.J.Handle:return void t.handleNodeCount++;case f.J.Blob:return t.blobNodeCount++,void(t.totalBlobSize+=y(e.content));default:return}}function b(e){const t=g();return v(e,t),t}function S(e,t,n){const r={type:f.J.Blob,content:n};e.summary.tree[t]=r,e.stats.blobNodeCount++,e.stats.totalBlobSize+=y(n)}function w(e,t,n){e.summary.tree[t]=n.summary,e.stats=g(e.stats,n.stats)}function x(e,t,n){e.summary.tree[t]=n.summary,e.stats=g(e.stats,n.stats)}!function(e){e.File="100644",e.Executable="100755",e.Directory="040000",e.Symlink="120000"}(u||(u={})),function(e){e.Blob="Blob",e.Tree="Tree",e.Attachment="Attachment"}(h||(h={}));class C{constructor(){this.attachmentCounter=0,this.summaryTree={},this.summaryStats=g(),this.summaryStats.treeNodeCount++}get summary(){return{type:f.J.Tree,tree:Object.assign({},this.summaryTree)}}get stats(){return Object.assign({},this.summaryStats)}addBlob(e,t){S({summary:{type:f.J.Tree,tree:this.summaryTree},stats:this.summaryStats},e,t)}addHandle(e,t,n){this.summaryTree[e]={type:f.J.Handle,handleType:t,handle:n},this.summaryStats.handleNodeCount++}addWithStats(e,t){this.summaryTree[e]=t.summary,this.summaryStats=g(this.summaryStats,t.stats)}addAttachment(e){this.summaryTree[this.attachmentCounter++]={id:e,type:f.J.Attachment}}getSummaryTree(){return{summary:this.summary,stats:this.stats}}}function E(e,t=!1){const n=new C;for(const r of e.entries)switch(r.type){case h.Blob:{const e=r.value;let t;t="base64"===e.encoding?c.from(e.contents,"base64"):e.contents,n.addBlob(r.path,t);break}case h.Tree:{const e=T(r.value,t);n.addWithStats(r.path,e);break}case h.Attachment:{const e=r.value.id;n.addAttachment(e);break}default:throw new Error("Unexpected TreeEntry type")}const r=n.getSummaryTree();return r.summary.unreferenced=e.unreferenced,r}function T(e,t=!1){if(e.id&&!t){const t=g();return t.handleNodeCount++,{summary:{handle:e.id,handleType:f.J.Tree,type:f.J.Handle},stats:t}}return E(e,t)}function A(e){const t=new C;for(const[n,r]of Object.entries(e.blobs)){let i;if(void 0!==e.blobsContents){const t=e.blobsContents[r];void 0!==t&&(i=o(t,"utf-8"))}else void 0!==e.blobs[r]&&(i=l(e.blobs[r]));void 0!==i&&t.addBlob(n,i)}for(const[n,r]of Object.entries(e.trees)){const e=A(r);t.addWithStats(n,e)}const n=t.getSummaryTree();return n.summary.unreferenced=e.unreferenced,n}function k(e){const t=[];for(const[n,r]of Object.entries(e.tree))switch(r.type){case f.J.Blob:{let e,i="utf-8";"string"==typeof r.content?e=r.content:(e=s(r.content,"base64"),i="base64"),t.push(new p.Qp(n,e,i));break}case f.J.Tree:t.push(new p.VN(n,k(r)));break;case f.J.Attachment:t.push(new p.sG(n,r.id));break;case f.J.Handle:throw new Error("Should not have Handle type in summary tree");default:(0,d.U)(r,"Unexpected summary tree type")}return{entries:t,unreferenced:e.unreferenced}}class N{constructor(){this.telemetry=new Map}set(e,t,n){this.telemetry.set(`${e}${t}`,n)}get(e,t){return this.telemetry.get(`${e}${t}`)}serialize(){const e={};return this.telemetry.forEach(((t,n)=>{e[n]=t})),JSON.stringify(e)}}},1890:(e,t,n)=>{"use strict";async function r(e,t){const n=e.trees[".protocol"].blobs.attributes;return(await t(n)).sequenceNumber}n.d(t,{G:()=>r})},477:(e,t,n)=>{"use strict";function r(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}n.d(t,{h:()=>r})},845:(e,t,n)=>{"use strict";function r(e,t="Unreachable Case"){throw new Error(t)}n.d(t,{U:()=>r})},6378:(e,t,n)=>{"use strict";var r;n.d(t,{J:()=>r}),function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(r||(r={}))},4200:(e,t,n)=>{e.exports=n(4460)},6431:(e,t,n)=>{"use strict";var r=n(637),i=n(6059),s=n(4110),o=n(6354),a=n(1325),c=n(5502),l=n(5097),u=n(4232),h=n(6894),d=n(7274);e.exports=function(e){return new Promise((function(t,n){var p,f=e.data,g=e.headers,m=e.responseType;function y(){e.cancelToken&&e.cancelToken.unsubscribe(p),e.signal&&e.signal.removeEventListener("abort",p)}r.isFormData(f)&&delete g["Content-Type"];var v=new XMLHttpRequest;if(e.auth){var b=e.auth.username||"",S=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";g.Authorization="Basic "+btoa(b+":"+S)}var w=a(e.baseURL,e.url);function x(){if(v){var r="getAllResponseHeaders"in v?c(v.getAllResponseHeaders()):null,s={data:m&&"text"!==m&&"json"!==m?v.response:v.responseText,status:v.status,statusText:v.statusText,headers:r,config:e,request:v};i((function(e){t(e),y()}),(function(e){n(e),y()}),s),v=null}}if(v.open(e.method.toUpperCase(),o(w,e.params,e.paramsSerializer),!0),v.timeout=e.timeout,"onloadend"in v?v.onloadend=x:v.onreadystatechange=function(){v&&4===v.readyState&&(0!==v.status||v.responseURL&&0===v.responseURL.indexOf("file:"))&&setTimeout(x)},v.onabort=function(){v&&(n(u("Request aborted",e,"ECONNABORTED",v)),v=null)},v.onerror=function(){n(u("Network Error",e,null,v)),v=null},v.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",r=e.transitional||h;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(u(t,e,r.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",v)),v=null},r.isStandardBrowserEnv()){var C=(e.withCredentials||l(w))&&e.xsrfCookieName?s.read(e.xsrfCookieName):void 0;C&&(g[e.xsrfHeaderName]=C)}"setRequestHeader"in v&&r.forEach(g,(function(e,t){void 0===f&&"content-type"===t.toLowerCase()?delete g[t]:v.setRequestHeader(t,e)})),r.isUndefined(e.withCredentials)||(v.withCredentials=!!e.withCredentials),m&&"json"!==m&&(v.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&v.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&v.upload&&v.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(p=function(e){v&&(n(!e||e&&e.type?new d("canceled"):e),v.abort(),v=null)},e.cancelToken&&e.cancelToken.subscribe(p),e.signal&&(e.signal.aborted?p():e.signal.addEventListener("abort",p))),f||(f=null),v.send(f)}))}},4460:(e,t,n)=>{"use strict";var r=n(637),i=n(9292),s=n(3665),o=n(7561),a=function e(t){var n=new s(t),a=i(s.prototype.request,n);return r.extend(a,s.prototype,n),r.extend(a,n),a.create=function(n){return e(o(t,n))},a}(n(7994));a.Axios=s,a.Cancel=n(7274),a.CancelToken=n(4194),a.isCancel=n(4733),a.VERSION=n(6714).version,a.all=function(e){return Promise.all(e)},a.spread=n(5992),a.isAxiosError=n(844),e.exports=a,e.exports.default=a},7274:e=>{"use strict";function t(e){this.message=e}t.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},t.prototype.__CANCEL__=!0,e.exports=t},4194:(e,t,n)=>{"use strict";var r=n(7274);function i(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;this.promise.then((function(e){if(n._listeners){var t,r=n._listeners.length;for(t=0;t<r;t++)n._listeners[t](e);n._listeners=null}})),this.promise.then=function(e){var t,r=new Promise((function(e){n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e){n.reason||(n.reason=new r(e),t(n.reason))}))}i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},i.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},i.source=function(){var e;return{token:new i((function(t){e=t})),cancel:e}},e.exports=i},4733:e=>{"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},3665:(e,t,n)=>{"use strict";var r=n(637),i=n(6354),s=n(353),o=n(9262),a=n(7561),c=n(5369),l=c.validators;function u(e){this.defaults=e,this.interceptors={request:new s,response:new s}}u.prototype.request=function(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},(t=a(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var n=t.transitional;void 0!==n&&c.assertOptions(n,{silentJSONParsing:l.transitional(l.boolean),forcedJSONParsing:l.transitional(l.boolean),clarifyTimeoutError:l.transitional(l.boolean)},!1);var r=[],i=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(i=i&&e.synchronous,r.unshift(e.fulfilled,e.rejected))}));var s,u=[];if(this.interceptors.response.forEach((function(e){u.push(e.fulfilled,e.rejected)})),!i){var h=[o,void 0];for(Array.prototype.unshift.apply(h,r),h=h.concat(u),s=Promise.resolve(t);h.length;)s=s.then(h.shift(),h.shift());return s}for(var d=t;r.length;){var p=r.shift(),f=r.shift();try{d=p(d)}catch(e){f(e);break}}try{s=o(d)}catch(e){return Promise.reject(e)}for(;u.length;)s=s.then(u.shift(),u.shift());return s},u.prototype.getUri=function(e){return e=a(this.defaults,e),i(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},r.forEach(["delete","get","head","options"],(function(e){u.prototype[e]=function(t,n){return this.request(a(n||{},{method:e,url:t,data:(n||{}).data}))}})),r.forEach(["post","put","patch"],(function(e){u.prototype[e]=function(t,n,r){return this.request(a(r||{},{method:e,url:t,data:n}))}})),e.exports=u},353:(e,t,n)=>{"use strict";var r=n(637);function i(){this.handlers=[]}i.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},i.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},i.prototype.forEach=function(e){r.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=i},1325:(e,t,n)=>{"use strict";var r=n(5339),i=n(5963);e.exports=function(e,t){return e&&!r(t)?i(e,t):t}},4232:(e,t,n)=>{"use strict";var r=n(2950);e.exports=function(e,t,n,i,s){var o=new Error(e);return r(o,t,n,i,s)}},9262:(e,t,n)=>{"use strict";var r=n(637),i=n(5459),s=n(4733),o=n(7994),a=n(7274);function c(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new a("canceled")}e.exports=function(e){return c(e),e.headers=e.headers||{},e.data=i.call(e,e.data,e.headers,e.transformRequest),e.headers=r.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),r.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||o.adapter)(e).then((function(t){return c(e),t.data=i.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return s(t)||(c(e),t&&t.response&&(t.response.data=i.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},2950:e=>{"use strict";e.exports=function(e,t,n,r,i){return e.config=t,n&&(e.code=n),e.request=r,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e}},7561:(e,t,n)=>{"use strict";var r=n(637);e.exports=function(e,t){t=t||{};var n={};function i(e,t){return r.isPlainObject(e)&&r.isPlainObject(t)?r.merge(e,t):r.isPlainObject(t)?r.merge({},t):r.isArray(t)?t.slice():t}function s(n){return r.isUndefined(t[n])?r.isUndefined(e[n])?void 0:i(void 0,e[n]):i(e[n],t[n])}function o(e){if(!r.isUndefined(t[e]))return i(void 0,t[e])}function a(n){return r.isUndefined(t[n])?r.isUndefined(e[n])?void 0:i(void 0,e[n]):i(void 0,t[n])}function c(n){return n in t?i(e[n],t[n]):n in e?i(void 0,e[n]):void 0}var l={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:c};return r.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=l[e]||s,i=t(e);r.isUndefined(i)&&t!==c||(n[e]=i)})),n}},6059:(e,t,n)=>{"use strict";var r=n(4232);e.exports=function(e,t,n){var i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(r("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)}},5459:(e,t,n)=>{"use strict";var r=n(637),i=n(7994);e.exports=function(e,t,n){var s=this||i;return r.forEach(n,(function(n){e=n.call(s,e,t)})),e}},7994:(e,t,n)=>{"use strict";var r=n(637),i=n(2191),s=n(2950),o=n(6894),a={"Content-Type":"application/x-www-form-urlencoded"};function c(e,t){!r.isUndefined(e)&&r.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var l,u={transitional:o,adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(l=n(6431)),l),transformRequest:[function(e,t){return i(t,"Accept"),i(t,"Content-Type"),r.isFormData(e)||r.isArrayBuffer(e)||r.isBuffer(e)||r.isStream(e)||r.isFile(e)||r.isBlob(e)?e:r.isArrayBufferView(e)?e.buffer:r.isURLSearchParams(e)?(c(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):r.isObject(e)||t&&"application/json"===t["Content-Type"]?(c(t,"application/json"),function(e,t,n){if(r.isString(e))try{return(0,JSON.parse)(e),r.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||u.transitional,n=t&&t.silentJSONParsing,i=t&&t.forcedJSONParsing,o=!n&&"json"===this.responseType;if(o||i&&r.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(o){if("SyntaxError"===e.name)throw s(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};r.forEach(["delete","get","head"],(function(e){u.headers[e]={}})),r.forEach(["post","put","patch"],(function(e){u.headers[e]=r.merge(a)})),e.exports=u},6894:e=>{"use strict";e.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}},6714:e=>{e.exports={version:"0.26.1"}},9292:e=>{"use strict";e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}}},6354:(e,t,n)=>{"use strict";var r=n(637);function i(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,n){if(!t)return e;var s;if(n)s=n(t);else if(r.isURLSearchParams(t))s=t.toString();else{var o=[];r.forEach(t,(function(e,t){null!=e&&(r.isArray(e)?t+="[]":e=[e],r.forEach(e,(function(e){r.isDate(e)?e=e.toISOString():r.isObject(e)&&(e=JSON.stringify(e)),o.push(i(t)+"="+i(e))})))})),s=o.join("&")}if(s){var a=e.indexOf("#");-1!==a&&(e=e.slice(0,a)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}},5963:e=>{"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},4110:(e,t,n)=>{"use strict";var r=n(637);e.exports=r.isStandardBrowserEnv()?{write:function(e,t,n,i,s,o){var a=[];a.push(e+"="+encodeURIComponent(t)),r.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),r.isString(i)&&a.push("path="+i),r.isString(s)&&a.push("domain="+s),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},5339:e=>{"use strict";e.exports=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}},844:(e,t,n)=>{"use strict";var r=n(637);e.exports=function(e){return r.isObject(e)&&!0===e.isAxiosError}},5097:(e,t,n)=>{"use strict";var r=n(637);e.exports=r.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function i(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=i(window.location.href),function(t){var n=r.isString(t)?i(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0}},2191:(e,t,n)=>{"use strict";var r=n(637);e.exports=function(e,t){r.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))}},5502:(e,t,n)=>{"use strict";var r=n(637),i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,n,s,o={};return e?(r.forEach(e.split("\n"),(function(e){if(s=e.indexOf(":"),t=r.trim(e.substr(0,s)).toLowerCase(),n=r.trim(e.substr(s+1)),t){if(o[t]&&i.indexOf(t)>=0)return;o[t]="set-cookie"===t?(o[t]?o[t]:[]).concat([n]):o[t]?o[t]+", "+n:n}})),o):o}},5992:e=>{"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},5369:(e,t,n)=>{"use strict";var r=n(6714).version,i={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){i[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));var s={};i.transitional=function(e,t,n){function i(e,t){return"[Axios v"+r+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,r,o){if(!1===e)throw new Error(i(r," has been removed"+(t?" in "+t:"")));return t&&!s[r]&&(s[r]=!0,console.warn(i(r," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,r,o)}},e.exports={assertOptions:function(e,t,n){if("object"!=typeof e)throw new TypeError("options must be an object");for(var r=Object.keys(e),i=r.length;i-- >0;){var s=r[i],o=t[s];if(o){var a=e[s],c=void 0===a||o(a,s,e);if(!0!==c)throw new TypeError("option "+s+" must be "+c)}else if(!0!==n)throw Error("Unknown option "+s)}},validators:i}},637:(e,t,n)=>{"use strict";var r=n(9292),i=Object.prototype.toString;function s(e){return Array.isArray(e)}function o(e){return void 0===e}function a(e){return"[object ArrayBuffer]"===i.call(e)}function c(e){return null!==e&&"object"==typeof e}function l(e){if("[object Object]"!==i.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function u(e){return"[object Function]"===i.call(e)}function h(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),s(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}e.exports={isArray:s,isArrayBuffer:a,isBuffer:function(e){return null!==e&&!o(e)&&null!==e.constructor&&!o(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"[object FormData]"===i.call(e)},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&a(e.buffer)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:c,isPlainObject:l,isUndefined:o,isDate:function(e){return"[object Date]"===i.call(e)},isFile:function(e){return"[object File]"===i.call(e)},isBlob:function(e){return"[object Blob]"===i.call(e)},isFunction:u,isStream:function(e){return c(e)&&u(e.pipe)},isURLSearchParams:function(e){return"[object URLSearchParams]"===i.call(e)},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:h,merge:function e(){var t={};function n(n,r){l(t[r])&&l(n)?t[r]=e(t[r],n):l(n)?t[r]=e({},n):s(n)?t[r]=n.slice():t[r]=n}for(var r=0,i=arguments.length;r<i;r++)h(arguments[r],n);return t},extend:function(e,t,n){return h(t,(function(t,i){e[i]=n&&"function"==typeof t?r(t,n):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}},921:(e,t,n)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=n(4990)(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},4990:(e,t,n)=>{e.exports=function(e){function t(e){let n,i,s,o=null;function a(...e){if(!a.enabled)return;const r=a,i=Number(new Date),s=i-(n||i);r.diff=s,r.prev=n,r.curr=i,n=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,i)=>{if("%%"===n)return"%";o++;const s=t.formatters[i];if("function"==typeof s){const t=e[o];n=s.call(r,t),e.splice(o,1),o--}return n})),t.formatArgs.call(r,e),(r.log||t.log).apply(r,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=r,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(i!==t.namespaces&&(i=t.namespaces,s=t.enabled(e)),s),set:e=>{o=e}}),"function"==typeof t.init&&t.init(a),a}function r(e,n){const r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(i),...t.skips.map(i).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(3473),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},3473:e=>{var t=1e3,n=60*t,r=60*n,i=24*r;function s(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}e.exports=function(e,o){o=o||{};var a,c,l=typeof e;if("string"===l&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var s=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(s){var o=parseFloat(s[1]);switch((s[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return o*i;case"hours":case"hour":case"hrs":case"hr":case"h":return o*r;case"minutes":case"minute":case"mins":case"min":case"m":return o*n;case"seconds":case"second":case"secs":case"sec":case"s":return o*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}(e);if("number"===l&&isFinite(e))return o.long?(a=e,(c=Math.abs(a))>=i?s(a,c,i,"day"):c>=r?s(a,c,r,"hour"):c>=n?s(a,c,n,"minute"):c>=t?s(a,c,t,"second"):a+" ms"):function(e){var s=Math.abs(e);return s>=i?Math.round(e/i)+"d":s>=r?Math.round(e/r)+"h":s>=n?Math.round(e/n)+"m":s>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},7583:(e,t,n)=>{"use strict";n.d(t,{h:()=>w});var r=n(2045);function i(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}var s=n(3738),o=n(7983),a=n(120),c=n(2738),l=n(4839),u=n(1468),h=n(9268),d=n(1096),p=n(1527),f=n(9703);class g{constructor(e,t){this.absolutePath=e,this.routeContext=t,this.isAttached=!0,i(e.startsWith("/"),413)}get IFluidRouter(){return this}get IFluidHandleContext(){return this}get IFluidHandle(){return this}async get(){if(void 0===this.objectP){const e={url:this.absolutePath,headers:{[p.lf.viaHandle]:!0}};this.objectP=this.routeContext.resolveHandle(e).then((t=>{if("fluid/object"===t.mimeType)return t.value;throw(0,f.fu)(t,e)}))}return this.objectP}attachGraph(){}bind(e){e.attachGraph()}async request(e){try{const t=(await this.get()).IFluidRouter;return void 0!==t?t.request(e):(0,f.I4)(e)}catch(e){return(0,f.Nj)(e)}}}class m{constructor(e,t){for(this.context=e,this.handleParsedCb=t,this.encodeValue=(e,t)=>{const n=null==e?void 0:e.IFluidHandle;return void 0!==n?this.serializeHandle(n,t):e},this.decodeValue=e=>{if((e=>"__fluid_handle__"===(null==e?void 0:e.type))(e)){const t=e.url.startsWith("/")?e.url:(0,d.H)(e.url,this.context),n=new g(t,this.root);return this.handleParsedCb(n),n}return e},this.root=this.context;void 0!==this.root.routeContext;)this.root=this.root.routeContext}get IFluidSerializer(){return this}encode(e,t){return e&&"object"==typeof e?this.recursivelyReplace(e,this.encodeValue,t):e}decode(e){return e&&"object"==typeof e?this.recursivelyReplace(e,this.decodeValue):e}stringify(e,t){return JSON.stringify(e,((e,n)=>this.encodeValue(n,t)))}parse(e){return JSON.parse(e,((e,t)=>this.decodeValue(t)))}recursivelyReplace(e,t,n){const r=t(e,n);if(r!==e)return r;let i;for(const r of Object.keys(e)){const s=e[r];if(s&&"object"==typeof s){const o=this.recursivelyReplace(s,t,n);o!==s&&(i=null!=i?i:Array.isArray(e)?[...e]:Object.assign({},e),i[r]=o)}}return null!=i?i:e}serializeHandle(e,t){return t.bind(e),{type:"__fluid_handle__",url:e.absolutePath}}}var y=n(8888);class v extends y.B{get isAttached(){return this.value.isAttached()}constructor(e,t,n){super(e,t,n)}attachGraph(){this.value.bindToContext(),super.attachGraph()}}class b extends m{constructor(){super(...arguments),this.serializedRoutes=new Set}getSerializedRoutes(){return Array.from(this.serializedRoutes)}serializeHandle(e,t){return this.serializedRoutes.add(e.absolutePath),super.serializeHandle(e,t)}}class S extends a.M{constructor(e,t,n){super(((e,t)=>this.eventListenerErrorHandler(e,t))),this.id=e,this.runtime=t,this.attributes=n,this._connected=!1,this._isBoundToContext=!1,i(!e.includes("/"),772),this.handle=new v(this,e,t.IFluidHandleContext),this.logger=c.G2.create(t.logger,void 0,{all:{sharedObjectId:(0,r.Z)(),ddsType:{value:this.attributes.type,tag:c.XI.CodeArtifact}}}),this.mc=(0,l.rZ)(this.logger),[this.opProcessingHelper,this.callbacksHelper]=this.setUpSampledTelemetryHelpers(),this.attachListeners()}get IFluidLoadable(){return this}get connected(){return this._connected}setUpSampledTelemetryHelpers(){var e,t;i(void 0!==this.mc&&void 0!==this.logger,"this.mc and/or this.logger has not been set");const n=new u.E({eventName:"ddsOpProcessing",category:"performance"},this.logger,null!==(e=this.mc.config.getNumber("Fluid.SharedObject.OpProcessingTelemetrySampling"))&&void 0!==e?e:100,!0,new Map([["local",{localOp:!0}],["remote",{localOp:!1}]])),r=new u.E({eventName:"ddsEventCallbacks",category:"performance"},this.logger,null!==(t=this.mc.config.getNumber("Fluid.SharedObject.DdsCallbacksTelemetrySampling"))&&void 0!==t?t:100,!0);return this.runtime.once("dispose",(()=>{this.callbacksHelper.dispose(),this.opProcessingHelper.dispose()})),[n,r]}closeWithError(e){void 0===this.closeError&&(this.closeError=e)}verifyNotClosed(){if(void 0!==this.closeError)throw this.closeError}eventListenerErrorHandler(e,t){const n=h.Hi.wrapIfUnrecognized(t,"SharedObjectEventListenerException");throw n.addTelemetryProperties({emittedEventName:String(e)}),this.closeWithError(n),n}attachListeners(){this.isAttached()||this.runtime.once("attaching",(()=>{this.didAttach()}))}async load(e){this.runtime.attachState!==s.mB.Detached&&(this.services=e),await this.loadCore(e.objectStorage),this.runtime.attachState!==s.mB.Detached&&this.attachDeltaHandler()}initializeLocal(){this.initializeLocalCore()}bindToContext(){this._isBoundToContext||(this._isBoundToContext=!0,this.runtime.bindChannel(this))}connect(e){this.services=e,this.attachDeltaHandler()}isAttached(){return void 0!==this.services&&this.runtime.attachState!==s.mB.Detached}handleDecoded(e){var t,n,r;this.isAttached()&&(null===(r=null===(t=this.services)||void 0===t?void 0:(n=t.deltaConnection).addedGCOutboundReference)||void 0===r||r.call(n,this.handle,e))}initializeLocalCore(){}didAttach(){}submitLocalMessage(e,t=void 0){this.verifyNotClosed(),this.isAttached()&&this.services.deltaConnection.submit(e,t)}dirty(){this.isAttached()&&this.services.deltaConnection.dirty()}onConnect(){}reSubmitCore(e,t){this.submitLocalMessage(e,t)}async newAckBasedPromise(e){let t;return new Promise(((n,r)=>{t=()=>r(new Error("FluidDataStoreRuntime disposed while this ack-based Promise was pending")),this.runtime.disposed?t():(this.runtime.on("dispose",t),e(n,r))})).finally((()=>{this.runtime.off("dispose",t)}))}attachDeltaHandler(){i(void 0!==this.services,122),this._isBoundToContext=!0,this.didAttach(),this.services.deltaConnection.attach({process:(e,t,n)=>{this.process(e,t,n)},setConnectionState:e=>{this.setConnectionState(e)},reSubmit:(e,t)=>{this.reSubmit(e,t)},applyStashedOp:e=>this.applyStashedOp(e),rollback:(e,t)=>{this.rollback(e,t)}}),this.setConnectionState(this.services.deltaConnection.connected)}setConnectionState(e){this._connected!==e&&(this._connected=e,e?this.onConnect():this.onDisconnect())}process(e,t,n){this.verifyNotClosed(),this.emitInternal("pre-op",e,t,this),this.opProcessingHelper.measure((()=>{this.processCore(e,t,n)}),t?"local":"remote"),this.emitInternal("op",e,t,this)}reSubmit(e,t){this.reSubmitCore(e,t)}rollback(e,t){throw new Error("rollback not supported")}emit(e,...t){return this.callbacksHelper.measure((()=>super.emit(e,...t)))}emitInternal(e,...t){return super.emit(e,...t)}}class w extends S{constructor(e,t,n,r){super(e,t,n),this.telemetryContextPrefix=r,this._isGCing=!1,this._serializer=new m(this.runtime.channelsRoutingContext,(e=>this.handleDecoded(e)))}get serializer(){return i(!this._isGCing,117),this._serializer}getAttachSummary(e=!1,t=!1,n){const r=this.summarizeCore(this.serializer,n);return this.incrementTelemetryMetric(o.blobCountPropertyName,r.stats.blobNodeCount,n),this.incrementTelemetryMetric(o.totalBlobSizePropertyName,r.stats.totalBlobSize,n),r}async summarize(e=!1,t=!1,n){const r=this.summarizeCore(this.serializer,n);return this.incrementTelemetryMetric(o.blobCountPropertyName,r.stats.blobNodeCount,n),this.incrementTelemetryMetric(o.totalBlobSizePropertyName,r.stats.totalBlobSize,n),r}getGCData(e=!1){let t;i(!this._isGCing,120),this._isGCing=!0;try{const e=new b(this.runtime.channelsRoutingContext,(e=>this.handleDecoded(e)));this.processGCDataCore(e),t={gcNodes:{"/":e.getSerializedRoutes()}},i(this._isGCing,121)}finally{this._isGCing=!1}return t}processGCDataCore(e){this.summarizeCore(e)}incrementTelemetryMetric(e,t,n){var r;const i=null!==(r=null==n?void 0:n.get(this.telemetryContextPrefix,e))&&void 0!==r?r:0;null==n||n.set(this.telemetryContextPrefix,e,i+t)}}},8343:(e,t,n)=>{"use strict";n.d(t,{Ho:()=>a,Yv:()=>i,i8:()=>s,lB:()=>o});var r=n(8991);function i(e,t,n){return void 0!==e?t.stringify(e,n):e}function s(e,t,n){return t.encode(e,n)}function o(e,t){return void 0!==e?t.parse(JSON.stringify(e)):e}function a(e,t){const n=new r.x1;return n.addBlob(e,t),n.getSummaryTree()}},4148:(e,t,n)=>{"use strict";var r;n.d(t,{G:()=>r}),function(e){e[e.Shared=0]="Shared",e[e.Plain=1]="Plain"}(r||(r={}))},4839:(e,t,n)=>{"use strict";n.d(t,{MD:()=>l,yV:()=>u,rZ:()=>h,UK:()=>d,of:()=>r});const r=new class{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}}((()=>s(c()))),i={getRawConfig:()=>{}},s=e=>null!=e?new l({getRawConfig:t=>{var n,r;try{return null===(r=a(null!==(n=e.getItem(t))&&void 0!==n?n:void 0))||void 0===r?void 0:r.raw}catch(e){}}}):i;function o(e){switch(e){case"boolean":case"number":case"string":return!0;default:return!1}}function a(e){let t,n=e;if("string"==typeof e)try{n=JSON.parse(e),t={raw:e,string:e}}catch(e){}if(void 0===n)return t;const r=typeof n;if(o(r))return Object.assign(Object.assign({},t),{raw:e,[r]:n});if(Array.isArray(n)){const r=typeof n[0];if(!o(r))return t;for(const e of n)if(typeof e!==r)return t;return Object.assign(Object.assign({},t),{raw:e,[`${r}[]`]:n})}return t}const c=()=>{try{return null!==sessionStorage?sessionStorage:void 0}catch(e){return}};class l{constructor(...e){this.configCache=new Map,this.orderedBaseProviders=[];const t=new Set,n=[...e];for(;n.length>0;){const e=n.shift();void 0!==e&&p(e)&&!t.has(e)&&(t.add(e),e instanceof l?n.push(...e.orderedBaseProviders):this.orderedBaseProviders.push(e))}}getBoolean(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.boolean}getNumber(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.number}getString(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.string}getBooleanArray(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["boolean[]"]}getNumberArray(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["number[]"]}getStringArray(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["string[]"]}getRawConfig(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.raw}getCacheEntry(e){if(!this.configCache.has(e)){for(const t of this.orderedBaseProviders){const n=a(null==t?void 0:t.getRawConfig(e));if(void 0!==n)return this.configCache.set(e,n),n}this.configCache.set(e,{raw:void 0})}return this.configCache.get(e)}}function u(e){const t=e;return p(null==t?void 0:t.config)&&void 0!==(null==t?void 0:t.logger)}function h(e){return u(e)?e:d(e,r.value)}function d(e,...t){if(u(e))throw new Error("Logger is already a monitoring context");const n=e;return n.config=new l(...t),n.logger=e,n}function p(e){return"function"==typeof(null==e?void 0:e.getRawConfig)}},2186:(e,t,n)=>{"use strict";n.d(t,{b:()=>o});var r=n(1836),i=n(4501),s=n(2738);class o extends s.hy{constructor(e,t,n){super(void 0,n),this.debug=e,this.debugErr=t}static create(e,t){const n=(0,i.debug)(e),r=(0,i.debug)(e);return r.log=console.error.bind(console),r.enabled=!0,new o(n,r,t)}static mixinDebugLogger(e,t,n){if(!t)return o.create(e,n);const r=new s.yw(void 0,n);return r.addLogger(o.create(e,this.tryGetBaseLoggerProps(t))),r.addLogger(s.G2.create(t,e)),r}static tryGetBaseLoggerProps(e){if(e instanceof s.hy)return e.properties}send(e){const t=this.prepareEvent(e),n="error"===t.category;let i=n?this.debugErr:this.debug;const o=e.eventName.lastIndexOf(s.hy.eventNamespaceSeparator),a=e.eventName.substring(o+1);o>0&&(i=i.extend(e.eventName.substring(0,o))),t.eventName=void 0;let c="";c=`tick=${s.hy.formatTick(r.S.now())}`;const l=t.stack?t.stack:"";let u;t.stack=void 0;try{u=JSON.stringify(t)}catch(e){t.error=void 0,u=JSON.stringify(t)}"{}"===u&&(u=""),n&&(i.enabled=!0),i(`${a} ${u} ${c} ${l}`)}}},2718:(e,t,n)=>{"use strict";n.d(t,{FM:()=>u,Jn:()=>d,SC:()=>c,XY:()=>g,YC:()=>o,bO:()=>p,fd:()=>y,gr:()=>h,j4:()=>v,nE:()=>a,zt:()=>m});var r=n(2045),i=n(9203);const s=e=>null!==e&&!Array.isArray(e)&&"object"==typeof e;function o(e,t){const n={message:"string"==typeof(null==e?void 0:e.message)?e.message:String(e)};if(s(e)){const{errorType:r,stack:i,name:s}=e;if("string"==typeof r&&(n.errorType=r),"string"==typeof i){const e="string"==typeof s?s:void 0;n.stack=((e,n)=>{if(!t)return e;const r=e.split("\n");return r.shift(),void 0!==n&&r.unshift(n),r.join("\n")})(i,e)}}return n}const a=e=>"function"==typeof(null==e?void 0:e.getTelemetryProperties);function c(e,t={}){var n;if((0,i.n5)(e)&&function(e){const t=e;void 0===t.errorInstanceId&&(t.errorInstanceId=(0,r.Z)())}(e),(0,i.IR)(e))return e.addTelemetryProperties(null!==(n=t.props)&&void 0!==n?n:{}),e;const{message:s,stack:l}=o(e,!1),u=new b({message:s,stack:l});if("object"==typeof e&&null!==e){const{canRetry:t,retryAfterSeconds:n}=e;Object.assign(c,{canRetry:t,retryAfterSeconds:n})}"object"!=typeof e&&u.addTelemetryProperties({typeofError:typeof e});const h=a(e)?e.getTelemetryProperties():{};return u.addTelemetryProperties(Object.assign(Object.assign(Object.assign({},h),t.props),{untrustedOrigin:1})),u}let l;function u(){const e=new Error("<<generated stack>>");if(void 0===l&&(l=void 0!==e.stack),l)return e;try{throw e}catch(e){return e}}function h(){return u().stack}function d(e,t){const{message:n,stack:r}=o(e,!1),s=t(n);return void 0!==r&&f(s,r),g(e)&&s.addTelemetryProperties({untrustedOrigin:1}),(0,i.uD)(e)&&(s.overwriteErrorInstanceId(e.errorInstanceId),s.addTelemetryProperties({innerErrorInstanceId:e.errorInstanceId})),a(e)&&s.addTelemetryProperties(e.getTelemetryProperties()),s}function p(e,t,n){const r=d(e,t),i=r.errorInstanceId,s=i;return n.sendTelemetryEvent({eventName:"WrapError",errorInstanceId:i,wrappedByErrorInstanceId:s},e),r}function f(e,t){try{Object.assign(e,{stack:t})}catch(n){e.addTelemetryProperties({stack2:t})}}function g(e){return!(0,i.n5)(e)||1===e.getTelemetryProperties().untrustedOrigin&&e.errorType===b.normalizedErrorType}function m(e){return"object"!=typeof(null==e?void 0:e.value)&&"string"==typeof(null==e?void 0:e.tag)}const y=()=>{const e=new WeakSet;return(t,n)=>{if("object"==typeof n&&null!==n){if(e.has(n))return"<removed/circular>";e.add(n)}return n}};class v extends Error{constructor(e,t,n=new Set){super(e),this.omitPropsFromLogging=n,this._errorInstanceId=(0,r.Z)(),this.fluidErrorCode="-",n.add("omitPropsFromLogging"),n.add("_errorInstanceId"),t&&this.addTelemetryProperties(t)}get errorInstanceId(){return this._errorInstanceId}overwriteErrorInstanceId(e){this._errorInstanceId=e}addTelemetryProperties(e){!function(e,t){for(const n of Object.keys(t))void 0===e[n]&&(e[n]=t[n])}(this,e)}getTelemetryProperties(){const e=function(e,t){const n={};for(const r of Object.keys(e)){if(t.has(r))continue;const i=e[r];switch(typeof i){case"string":case"number":case"boolean":case"undefined":n[r]=i;break;default:m(i)?n[r]=i:n[r]="REDACTED (arbitrary object)"}}return n}(this,this.omitPropsFromLogging);return Object.assign(Object.assign({},e),{stack:this.stack,message:this.message,errorInstanceId:this._errorInstanceId})}}class b extends v{constructor(e){super(e.message),this.errorType=b.normalizedErrorType,void 0!==e.stack&&f(this,e.stack)}}b.normalizedErrorType="genericError"},120:(e,t,n)=>{"use strict";n.d(t,{M:()=>s});var r=n(7187);class i extends r.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}class s extends i{constructor(e){super(),this.errorHandler=e}emit(e,...t){try{return super.emit(e,...t)}catch(t){return this.errorHandler(e,t),!0}}}},8595:(e,t,n)=>{"use strict";n.d(t,{Eb:()=>s,Qq:()=>o,h$:()=>i,tZ:()=>r});const r="connected",i="disconnected";function s(e,t,n,...r){try{e.emit(n,...r)}catch(e){t.sendErrorEvent({eventName:"RaiseEventError",event:n},e)}}function o(e,t,n,s){try{n?t.emit(r,s):t.emit(i)}catch(t){e.sendErrorEvent({eventName:"RaiseConnectedEventError"},t)}}},9203:(e,t,n)=>{"use strict";n.d(t,{IR:()=>s,n5:()=>o,uD:()=>i});const r=e=>"function"==typeof(null==e?void 0:e.getTelemetryProperties)&&"function"==typeof(null==e?void 0:e.addTelemetryProperties),i=e=>"string"==typeof(null==e?void 0:e.errorInstanceId);function s(e){return"string"==typeof(null==e?void 0:e.errorType)&&"string"==typeof(null==e?void 0:e.message)&&i(e)&&r(e)}function o(e){return"string"==typeof(null==e?void 0:e.errorType)&&"string"==typeof(null==e?void 0:e.message)&&r(e)}},2609:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ChildLogger:()=>c.G2,DebugLogger:()=>r.b,EventEmitterWithErrorHandling:()=>s.M,LoggingError:()=>i.j4,MockLogger:()=>l,MultiSinkLogger:()=>c.yw,PerformanceEvent:()=>c.Xr,SampledTelemetryHelper:()=>d.E,TaggedLoggerAdapter:()=>c.cP,TelemetryDataTag:()=>c.XI,TelemetryLogger:()=>c.hy,TelemetryUTLogger:()=>c.nI,ThresholdCounter:()=>u.z,connectedEventName:()=>o.tZ,disconnectedEventName:()=>o.h$,extractLogSafeErrorProperties:()=>i.YC,generateErrorWithStack:()=>i.FM,generateStack:()=>i.gr,getCircularReplacer:()=>i.fd,hasErrorInstanceId:()=>a.uD,isExternalError:()=>i.XY,isFluidError:()=>a.IR,isILoggingError:()=>i.nE,isTaggedTelemetryPropertyValue:()=>i.zt,isValidLegacyError:()=>a.n5,logIfFalse:()=>h.M,loggerToMonitoringContext:()=>p.rZ,mixinMonitoringContext:()=>p.UK,normalizeError:()=>i.SC,raiseConnectedEvent:()=>o.Qq,safeRaiseEvent:()=>o.Eb,sessionStorageConfigProvider:()=>p.of,wrapError:()=>i.Jn,wrapErrorAndLog:()=>i.bO});var r=n(2186),i=n(2718),s=n(120),o=n(8595),a=n(9203),c=n(2738);class l extends c.hy{constructor(){super(),this.events=[]}clear(){this.events=[]}send(e){this.events.push(e)}matchEvents(e){const t=this.getMatchedEventsCount(e);return 0==e.length-t}assertMatch(e,t){const n=this.events;if(!this.matchEvents(e))throw new Error(`${t}\nexpected:\n${JSON.stringify(e)}\n\nactual:\n${JSON.stringify(n)}`)}matchAnyEvent(e){return this.getMatchedEventsCount(e)>0}assertMatchAny(e,t){const n=this.events;if(!this.matchAnyEvent(e))throw new Error(`${t}\nexpected:\n${JSON.stringify(e)}\n\nactual:\n${JSON.stringify(n)}`)}getMatchedEventsCount(e){let t=0;return this.events.forEach((n=>{t<e.length&&l.eventsMatch(n,e[t])&&++t})),this.events=[],t}static eventsMatch(e,t){const n=Object.assign(Object.assign({},e),t);return JSON.stringify(n)===JSON.stringify(e)}}var u=n(6171),h=n(5708),d=n(1468),p=n(4839)},2738:(e,t,n)=>{"use strict";n.d(t,{G2:()=>u,yw:()=>h,Xr:()=>d,cP:()=>l,XI:()=>i,hy:()=>c,nI:()=>p});class r{send(e){}}var i,s=n(1836),o=n(4839),a=n(2718);!function(e){e.PackageData="PackageData",e.CodeArtifact="CodeArtifact",e.UserData="UserData"}(i||(i={}));class c{constructor(e,t){this.namespace=e,this.properties=t}static formatTick(e){return Math.floor(e)}static numberFromString(e){if(null==e)return;const t=Number(e);return Number.isNaN(t)?e:t}static sanitizePkgName(e){return e.replace("@","").replace("/","-")}static prepareErrorObject(e,t,n){const{message:r,errorType:i,stack:s}=(0,a.YC)(t,!0);if(e.stack=s,e.error=r,e.errorType=i,(0,a.nE)(t)){const n=t.getTelemetryProperties();for(const t of Object.keys(n))void 0===e[t]&&(e[t]=n[t])}void 0===e.stack&&n&&(e.stack=(0,a.gr)())}sendTelemetryEvent(e,t){var n;this.sendTelemetryEventCore(Object.assign(Object.assign({},e),{category:null!==(n=e.category)&&void 0!==n?n:"generic"}),t)}sendTelemetryEventCore(e,t){const n=Object.assign({},e);void 0!==t&&c.prepareErrorObject(n,t,!1),"number"==typeof n.duration&&(n.duration=c.formatTick(n.duration)),this.send(n)}sendErrorEvent(e,t){this.sendTelemetryEventCore(Object.assign(Object.assign({error:e.eventName},e),{category:"error"}),t)}sendPerformanceEvent(e,t){var n;const r=Object.assign(Object.assign({},e),{category:null!==(n=e.category)&&void 0!==n?n:"performance"});this.sendTelemetryEventCore(r,t)}prepareEvent(e){const t="error"===e.category||void 0!==e.error,n=Object.assign({},e);if(void 0!==this.namespace&&(n.eventName=`${this.namespace}${c.eventNamespaceSeparator}${n.eventName}`),this.properties){const r=[];r.push(this.properties.all),t&&r.push(this.properties.error);for(const t of r)if(void 0!==t)for(const r of Object.keys(t)){if(void 0!==e[r])continue;const i=t[r],s="function"==typeof i?i():i;void 0!==s&&(n[r]=s)}}return n}}c.eventNamespaceSeparator=":";class l{constructor(e){this.logger=e}send(e){const t={category:e.category,eventName:e.eventName};for(const n of Object.keys(e)){const r=e[n],{value:s,tag:o}="object"==typeof r?r:{value:r,tag:void 0};switch(o){case void 0:case i.PackageData:t[n]=s;break;case i.UserData:t[n]="REDACTED (UserData)";break;default:t[n]="REDACTED (unknown tag)"}}this.logger.send(t)}}class u extends c{constructor(e,t,n){super(t,n),this.baseLogger=e,(0,o.yV)(e)&&(0,o.UK)(this,new o.MD(e.config))}static create(e,t,n){if(e instanceof u){const r={};for(const t of[e.properties,n])void 0!==t&&(void 0!==t.all&&(r.all=Object.assign(Object.assign({},r.all),t.all)),void 0!==t.error&&(r.error=Object.assign(Object.assign({},r.error),t.error)));const i=void 0===e.namespace?t:void 0===t?e.namespace:`${e.namespace}${c.eventNamespaceSeparator}${t}`;return new u(e.baseLogger,i,r)}return new u(e||new r,t,n)}send(e){this.baseLogger.send(this.prepareEvent(e))}}class h extends c{constructor(e,t){super(e,t),this.loggers=[]}addLogger(e){null!=e&&this.loggers.push(e)}send(e){const t=this.prepareEvent(e);this.loggers.forEach((e=>{e.send(t)}))}}class d{constructor(e,t,n={end:!0,cancel:"generic"}){this.logger=e,this.markers=n,this.startTime=s.S.now(),this.event=Object.assign({},t),this.markers.start&&this.reportEvent("start"),"object"==typeof window&&null!=window&&window.performance&&(this.startMark=`${t.eventName}-start`,window.performance.mark(this.startMark))}static start(e,t,n){return new d(e,t,n)}static timedExec(e,t,n,r){const i=d.start(e,t,r);try{const e=n(i);return i.autoEnd(),e}catch(e){throw i.cancel(void 0,e),e}}static async timedExecAsync(e,t,n,r){const i=d.start(e,t,r);try{const e=await n(i);return i.autoEnd(),e}catch(e){throw i.cancel(void 0,e),e}}get duration(){return s.S.now()-this.startTime}reportProgress(e,t="update"){this.reportEvent(t,e)}autoEnd(){this.event&&this.markers.end&&this.reportEvent("end"),this.performanceEndMark(),this.event=void 0}end(e){this.reportEvent("end",e),this.performanceEndMark(),this.event=void 0}performanceEndMark(){if(this.startMark&&this.event){const e=`${this.event.eventName}-end`;window.performance.mark(e),window.performance.measure(`${this.event.eventName}`,this.startMark,e),this.startMark=void 0}}cancel(e,t){void 0!==this.markers.cancel&&this.reportEvent("cancel",Object.assign({category:this.markers.cancel},e),t),this.event=void 0}reportEvent(e,t,n){if(!this.event)return;const r=Object.assign(Object.assign({},this.event),t);r.eventName=`${r.eventName}_${e}`,"start"!==e&&(r.duration=this.duration),this.logger.sendPerformanceEvent(r,n)}}class p{send(e){}sendTelemetryEvent(e,t){}sendErrorEvent(e,t){this.reportError("errorEvent in UT logger!",e,t)}sendPerformanceEvent(e,t){}logGenericError(e,t){this.reportError("genericError in UT logger!",{eventName:e},t)}logException(e,t){this.reportError("exception in UT logger!",e,t)}debugAssert(e,t){this.reportError("debugAssert in UT logger!")}shipAssert(e,t){this.reportError("shipAssert in UT logger!")}reportError(e,t,n){const r=new Error(e);throw r.error=r,r.event=t,console.error(e),console.error(r),r}}},1468:(e,t,n)=>{"use strict";n.d(t,{E:()=>i});var r=n(1836);class i{constructor(e,t,n,r=!1,i=new Map){this.eventBase=e,this.logger=t,this.sampleThreshold=n,this.includeAggregateMetrics=r,this.perBucketProperties=i,this.disposed=!1,this.measurementsMap=new Map}measure(e,t=""){var n,i,s;const o=r.S.now(),a=e(),c=r.S.now()-o;let l=this.measurementsMap.get(t);return void 0===l&&(l={count:0,duration:-1},this.measurementsMap.set(t,l)),l.count++,l.duration=c,this.includeAggregateMetrics&&(l.totalDuration=(null!==(n=l.totalDuration)&&void 0!==n?n:0)+c,l.minDuration=Math.min(null!==(i=l.minDuration)&&void 0!==i?i:c,c),l.maxDuration=Math.max(null!==(s=l.maxDuration)&&void 0!==s?s:0,c)),l.count>=this.sampleThreshold&&this.flushBucket(t),a}flushBucket(e){const t=this.measurementsMap.get(e);if(void 0!==t&&0!==t.count){const n=this.perBucketProperties.get(e),r=Object.assign(Object.assign(Object.assign({},this.eventBase),n),t);this.logger.sendPerformanceEvent(r),this.measurementsMap.delete(e)}}dispose(e){this.measurementsMap.forEach(((e,t)=>this.flushBucket(t)))}}},6171:(e,t,n)=>{"use strict";n.d(t,{z:()=>r});class r{constructor(e,t,n=e){this.threshold=e,this.logger=t,this.thresholdMultiple=n}send(e,t){t<this.threshold||this.logger.sendPerformanceEvent({eventName:e,value:t})}sendIfMultiple(e,t){t===this.thresholdMultiple&&(this.logger.sendPerformanceEvent({eventName:e,value:t}),this.thresholdMultiple=2*this.thresholdMultiple)}}},5708:(e,t,n)=>{"use strict";function r(e,t,n){if(e)return!0;const r="string"==typeof n?{eventName:n,category:"error"}:Object.assign({category:"error"},n);return t.send(r),!1}n.d(t,{M:()=>r})},1836:(e,t,n)=>{"use strict";n.d(t,{S:()=>r});const r=window.performance},4501:(e,t,n)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=n(1588)(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},1588:(e,t,n)=>{e.exports=function(e){function t(e){let n,i,s,o=null;function a(...e){if(!a.enabled)return;const r=a,i=Number(new Date),s=i-(n||i);r.diff=s,r.prev=n,r.curr=i,n=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,i)=>{if("%%"===n)return"%";o++;const s=t.formatters[i];if("function"==typeof s){const t=e[o];n=s.call(r,t),e.splice(o,1),o--}return n})),t.formatArgs.call(r,e),(r.log||t.log).apply(r,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=r,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(i!==t.namespaces&&(i=t.namespaces,s=t.enabled(e)),s),set:e=>{o=e}}),"function"==typeof t.init&&t.init(a),a}function r(e,n){const r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(i),...t.skips.map(i).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(2326),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},2326:e=>{var t=1e3,n=60*t,r=60*n,i=24*r;function s(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}e.exports=function(e,o){o=o||{};var a,c,l=typeof e;if("string"===l&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var s=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(s){var o=parseFloat(s[1]);switch((s[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return o*i;case"hours":case"hour":case"hrs":case"hr":case"h":return o*r;case"minutes":case"minute":case"mins":case"min":case"m":return o*n;case"seconds":case"second":case"secs":case"sec":case"s":return o*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}(e);if("number"===l&&isFinite(e))return o.long?(a=e,(c=Math.abs(a))>=i?s(a,c,i,"day"):c>=r?s(a,c,r,"hour"):c>=n?s(a,c,n,"minute"):c>=t?s(a,c,t,"second"):a+" ms"):function(e){var s=Math.abs(e);return s>=i?Math.round(e/i)+"d":s>=r?Math.round(e/r)+"h":s>=n?Math.round(e/n)+"m":s>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},9894:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.generateTestUser=void 0;const i=r(n(8280)),s=n(8410);t.generateTestUser=()=>({id:(0,s.v4)(),name:(0,i.default)()})},7719:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateTestUser=t.InsecureTokenProvider=void 0;var r=n(2098);Object.defineProperty(t,"InsecureTokenProvider",{enumerable:!0,get:function(){return r.InsecureTokenProvider}});var i=n(9894);Object.defineProperty(t,"generateTestUser",{enumerable:!0,get:function(){return i.generateTestUser}})},979:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shortCodeMap=void 0,t.shortCodeMap={"0x000":"nonzero isobuffer byte offset","0x001":"unexpected isobuffer byte length","0x003":"Primary to add to range < last primary!","0x004":"Secondary to add to range < last secondary!","0x005":"Target primary to retrieve < first range's primary!","0x006":"Target primary to retrieve < last range's primary!","0x007":"Target primary to update < first range's primary!","0x008":"Target primary to update < last range's primary!","0x009":"After update, target primary is not first range's primary!","0x00a":"Running timer missing handler","0x00b":"Handler executed without deferred","0x00c":"messageId is incorrect from from the local client's ACK","0x00d":"Missing message handler for message type","0x00e":"Missing message handler for message type","0x00f":"pendingMessageId is missing from the local client's operation","0x010":"Received out of order storage op when there is an unackd clear message","0x011":"pendingMessageId is missing from the local client's operation","0x012":"pendingMessageId is missing from the local client's operation","0x013":"Received out of order op when there is an unackd clear message","0x014":"pendingMessageId is missing from the local client's operation","0x015":"pendingMessageId is missing from the local client's clear operation","0x016":"apply stashed op not implemented for custom value type ops","0x017":"Trying to add invalid handle!","0x018":"Trying to insert handle into position with already valid handle!","0x019":"SharedMatrix.openUndo() supports at most a single IUndoConsumer.","0x01a":"Trying to set out-of-bounds cell!","0x01b":"Trying to set multiple out-of-bounds cells!","0x01c":"The 'localSeq' of the vector submitting an op must >= the 'localSeq' of the other vector.","0x01d":"Trying to submit message to runtime while detached!","0x01e":"Row and col collab window 'localSeq' desynchronized!","0x01f":"Row and col collab window 'collaborating' status desynchronized!","0x020":"Unknown SharedMatrix 'op' type.","0x021":"SharedMatrix message contents have unexpected type!","0x022":"SharedMatrix row and/or col handles are invalid!","0x023":"The 'localSeq' of pending write (if any) must be <= the localSeq of the currently processed op.","0x024":"Start of PermutationSegment already allocated!","0x025":"Trying to set start of PermutationSegment to invalid handle!","0x026":"Trying to split segment at out-of-bounds position!","0x027":"Trying to get handle of out-of-bounds position!","0x028":"'localSeq' for op being resubmitted must be <= the 'localSeq' of the last submitted op.","0x029":"Invalid handle at start of containing segment!","0x02a":"On vector undo, unexpected 'currentOp' type/state!","0x02b":"Must not nest calls to IRevertible.revert()","0x02c":"On cellSet(), invalid row and/or column handles!","0x02d":"Unexpected op type on range remove!","0x02e":"Unexpected op type on range annotate!","0x02f":"Unexpected op type on range insert!","0x030":"Incoming remote op sequence# <= local collabWindow's currentSequence#","0x031":"Incoming remote op minSequence# < local collabWindow's minSequence#","0x032":"localSeq greater than collab window","0x033":"Segment group undefined","0x034":"Segment group not at head of merge tree pending queue","0x035":"Segment group not at head of segment pending queue","0x036":"Segment has no pending properties","0x037":"Segment already has assigned sequence number","0x038":"Incoming op sequence# < local collabWindow's currentSequence#","0x039":"Incoming op sequence# < minSequence#","0x03a":"Number of ops in 'resetOp' must match the number of segment groups provided.","0x03b":"Number of ops in 'resetOp' must match the number of segment groups provided.","0x03c":"Reset op has 'group' delta type!","0x03d":"segmentGroup is array rather than singleton!","0x03e":"minSeq mismatch between collab window and delta manager!","0x03f":"New format should not emit catchup ops","0x040":"Child count is not within [1,7] range!","0x041":"Unexpected child ordinal length!","0x043":"On ack, unexpected segmentGroup!","0x044":"On annotate ack, missing segment property manager!","0x045":"On insert, seq number already assigned!","0x046":"On remove ack, missing removal info!","0x048":"onMinGE()","0x049":"Trying to reload from segments while collaborating!","0x04f":"minSeq of collab window > target minSeq!","0x050":"Next segment changes are undefined!","0x051":"Too many children on merge block!","0x054":"Sequence number less than minSeq!","0x055":"Sequence number is not sorted!","0x056":"Unexpected total for accumulation of all seglen adjustments!","0x057":"Negative length after length adjustment!","0x058":"Both overlapRemoveClients and clientPartials are set!","0x059":"Client view exists but flat view does not!","0x05a":"Mismatch between number of partial lengths on client and flat views!","0x05b":"Flat view exists but client view does not!","0x05c":"Trying to update more annotate props than do exist!","0x05d":"emit: mismatch in segmentsTotalLength","0x05e":"emit: mismatch in totalSegmentCount","0x05f":"Missing blob header on legacy snapshot!","0x060":"There should be only one blob with catch up ops","0x061":"Mismatch in totalLength","0x062":"Mismatch in totalSegmentCount","0x063":"Mismatch in totalLength","0x064":"Mismatch in totalSegmentCount","0x065":"On removal info preservation, segment has invalid removed sequence number!","0x066":"Corrupted preservation of segment metadata!","0x067":"Missing clientId for removal!","0x068":"On consensusOrderedCollection load, job tracking size > 0","0x069":"On consensusOrderedCollection load, data size > 0","0x06a":"Trying to submit message while detached!","0x06b":"Loading snapshot into a non-empty collection","0x06c":"Value should be undefined or non-empty","0x06d":"SharedObjects contained in ConsensusRegisterCollection can no longer be deserialized as of 0.17","0x06e":"Message's reference sequence number < op's reference sequence number!","0x06f":"data missing for non-atomic inbound update!","0x070":"sequence numbers are expected to be 0 when unattached","0x071":"Versions should naturally be ordered by sequenceNumber","0x072":"Unexpected local op when loading not finished","0x073":"Sequence message not operation","0x074":"Snapshot called when not fully loaded","0x075":"SummarySerializer should be used for serializing data during summary.","0x078":"Possible re-entrancy! Summary should not already be in progress.","0x079":"Possible re-entrancy! Summary should have been in progress.","0x07a":"Services should be there to attach delta handler","0x07b":"Unexpected op","0x07c":"Unexpected op type","0x07d":"Unexpected op","0x07e":"Unexpected op type","0x07f":"clientId undefined","0x080":"Invalid document service!","0x081":"Document service already set!","0x082":"Document storage service already set!","0x083":"User selection status does not match replay controller use status!","0x084":"On storage resolve, user selection already made!","0x085":"On storage resolve, missing storage!","0x086":"After storage resolve, user selection status still false!","0x088":"Missing button ops button!","0x089":"Stringified length of chunk contents > total starting length","0x08a":"resetting ChunkedOpProcessor that never wrote back its contents","0x08b":"Unexpected type on contents for fix of an attach!","0x08c":"innerContent for fixing op contents is undefined!","0x08d":"After sanitize, pending incomplete ops!","0x08e":"Potentially missed initial messages","0x08f":"No op handler is setup!","0x090":"No signal handler is setup!","0x091":"Retrieved ops' first sequence number has unexpected value!","0x092":"version input for reading snapshot tree is null!","0x093":"invalid version input for reading snapshot tree!","0x094":"Missing snapshot tree!","0x096":"Trying to remove valid tree IDs in removeNullTreeIds()!","0x097":"Missing param from office.com URL parameter","0x098":"OuterDocumentServiceFactoryProxy unavailable","0x099":"OuterUrlResolverProxy unavailable","0x09a":"'documentId' must be a defined, non-zero length string.","0x09d":"Connection details should contain epoch","0x09f":"No more socketIO refs to remove!","0x0a0":"Unexpected socketIO references on timeout","0x0a1":"Socket reference set unexpectedly does not point to this socket!","0x0a2":"reentrancy not supported!","0x0a4":"Unexpected blob encoding type","0x0a5":"Trying to set ops when they are already set!","0x0a8":"Docid should not contain slashes!!","0x0ad":"Snapshot entry has both a tree value and a referenced id!","0x0ae":"Tried to create rate limiter with 0 max requests!","0x0b0":"Missing document snapshot tree!","0x0b1":"Storage service not initialized","0x0b2":"Missing orderer URL!","0x0b7":"Pathname should be defined","0x0b8":"'tenantId' and 'documentId' must be defined, non-zero length strings.","0x0b9":"PathName should exist","0x0ba":"Tenant id should exist","0x0bb":"Document id should exist","0x0bc":"Runtime has no DataObject!","0x0bd":"Object runtime already has DataObject!","0x0be":"Trying to initialize from existing while initProps is set!","0x0bf":"set called recursively from the interception callback","0x0c0":"set called recursively from the interception callback","0x0c1":"Interception wrapper methods called recursively from the interception callback","0x0c2":"Interception wrapper methods called recursively from the interception callback","0x0c3":"Interception wrapper methods called recursively from the interception callback","0x0c4":"Interception wrapper methods called recursively from the interception callback","0x0c5":"Interception wrapper methods called recursively from the interception callback","0x0c6":"Interception wrapper methods called recursively from the interception callback","0x0c7":"Interception wrapper methods called recursively from the interception callback","0x0c8":"Interception wrapper methods called recursively from the interception callback","0x0c9":"Interception wrapper methods called recursively from the interception callback","0x0ca":"Trying to use legacy graph attach!","0x0cd":"Container disconnected while waiting for ops!","0x0cf":"disconnect event was not raised!","0x0d1":"Container should be attached before close","0x0d2":"resolved url should be valid Fluid url","0x0d3":"Should only be called in detached container","0x0d6":"Inbound queue should be empty when attaching","0x0d9":"Attempting to connect() a closed DeltaManager","0x0dd":"Existing context not disposed","0x0de":"Mismatch in connection state while setting","0x0df":"Missing active connection","0x0e0":"lost minBlobSize policy","0x0e2":"DeltaManager already has attached op handler!","0x0e3":"Newly set op handler is null/undefined!","0x0e4":"Lost old connection!","0x0e6":"old connection exists on new connection setup","0x0e7":"claims/connectionMode mismatch","0x0e8":"readonly perf with write connection","0x0e9":"messageBuffer is not empty on new connection","0x0eb":"Missing connection for reconnect","0x0ec":"Unexpected value for previously processed message's sequence number","0x0ed":"non-system message have to have clientId","0x0ee":"Not accounting local messages correctly","0x0ef":"client seq# not growing","0x0f0":"Incoming local client seq# > generated by this client","0x0f2":"previouslyProcessedMessage","0x0f3":"not positive","0x0f4":"Nonzero pause-count on resume()","0x0f6":"real blob ID exists","0x0f7":"aggregate blob missing","0x0f8":"blob from aggregate blob exists on its own","0x0f9":"never read summary","0x0fa":"virtual blob not found","0x0fb":"logic err with aggregator","0x0fc":"tree reuse at lower level","0x0fd":"data stores are writing incremental summaries!","0x0fe":"attachment is aggregate blob","0x0ff":"duplicate aggregate blob","0x100":"logic error","0x101":"Unexpected tree entry type on flatten!","0x102":"invalid level of concurrency","0x103":"trying to parallel run while not working","0x104":"undefined end point for parallel fetch","0x105":"unexpected end point for parallel fetch","0x107":"ending dispatch with remaining results to be sent","0x108":"ending results dispatch but knew in advance about more requests","0x109":"unexpected next chunk position","0x10a":"cannot add parallel request while not working","0x10b":"invalid parallel request range","0x10c":"invalid parallel request start point","0x10d":"invalid parallel request end point","0x10e":"should not throw result if we knew about boundary in advance","0x10f":"empty/partial chunks should not be returned by caching","0x110":"callback should retry until valid fetch before it learns new boundary","0x112":"cannot push onto queue if done","0x113":"deferred queue should be empty","0x114":"cannot pop if deferred","0x115":"queue should not be done during pop","0x116":"Missing handle on scheduler load","0x117":"Trying to get missing clientId!","0x118":"Bad client interactive check","0x119":"This agent became inactive while releasing","0x11a":"Unsuccessful registration","0x11b":"Trying to clear tasks on inactive agent","0x11c":"Detached object routing context","0x11d":"task is already running","0x11e":"client is undefined","0x11f":"requesting unknown blobs","0x120":"Undefined latency statistics (op send time)","0x121":"Undefined inner contents type!","0x122":"Message to unpack is not proper runtime message","0x124":"inconsistent readonly property/event state","0x125":"Unsafe to transition to read-only state!","0x126":"Expected createSubRequest url to include a leading slash","0x127":"dirty document event not set on replay","0x12a":"Missing blob id on metadata","0x12b":"did not get root data store","0x12d":"Container Context should already be in attaching state","0x12e":"Container Context should already be in attached state","0x12f":"Container Runtime's summarize should always return a tree","0x131":"Mismatch between new chunkId and expected chunkMap","0x132":"sending ops in detached container","0x133":"Container disconnected when trying to submit system message","0x137":"Failed to get version from storage","0x138":"Failed to get snapshot from storage","0x139":"Undefined package path","0x13a":"Data store ID contains slash","0x13b":"datastore context is already in bound state","0x13c":"undefined channel on datastore context","0x13d":"Detached runtime creation on realize()","0x13e":"Unexpected package path","0x13f":"datastore context registry is already set","0x140":"undefined channel on datastore context","0x141":"Unexpected connected state","0x142":"local store channel is not loaded","0x143":"Channel should not be undefined when running GC","0x144":"Channel should be loaded when updating used routes","0x145":"Channel should be present when data store is loaded","0x146":"Channel must exist when submitting message","0x147":"Channel must exist on submitting signal","0x148":"Detached runtime creation on runtime bind","0x149":"Undefined channel deferral","0x14a":"Undefined package path","0x14b":"Channel must exist when resubmitting ops","0x14c":"Channel must exist when rebasing ops","0x14d":"Should move from detached to attaching","0x14e":"Should move from attaching to attached","0x14f":"There should be a channel when generating attach message","0x150":"pkg should be available in local data store context","0x152":"pkg should be available in local data store","0x154":"runtime creation is already attached","0x155":"channel deferral is already set","0x156":"Unexpected factory for package path","0x157":"datastore registry already attached","0x158":"Creating store with existing ID","0x159":"The given id was not found in notBoundContexts to delete","0x15a":"Cannot find context to resolve to","0x15b":"Expected this id to already be removed from notBoundContexts","0x15c":"Cannot find deferred to resolve","0x15d":"Creating store with existing ID","0x15e":"Local object does not have matching attach message id","0x15f":"Could not find unbound context to bind","0x160":"There should be a store context for the op","0x161":"There should be a store context for the op","0x162":"There should be a store context for the op","0x163":"Missing datastore for local signal","0x165":"Summarizer cannot work if client has local changes","0x166":"BaseSnapshot should be there as detached container loaded from snapshot","0x167":"Used route does not belong to any known data store","0x168":"Expected tree in snapshot not found","0x169":"No pending message found for this remote message","0x16b":"The pending batch state indicates we are already processing a batch","0x16d":"There is no pending batch begin message","0x16e":"Batch with single message should not have batch metadata","0x16f":"Did not receive batch begin metadata","0x170":"Did not receive batch end metadata","0x171":"No pending state found for the remote message","0x172":"The connection state is not consistent with the runtime","0x173":"replayPendingStates called twice for same clientId!","0x174":"initial states should be empty before replaying pending","0x175":"Can only broadcast if summarizer starts in local state","0x176":"Can only ack/nack if summarizer is in broadcasting state","0x177":"Missing delta handler","0x178":"Missing delta handler on attach","0x179":"createChannel() with existing ID","0x17a":"Channel should be loaded when created!!","0x17b":"Channel to be binded should be in not bounded set","0x17c":"Unexpected attach (local) channel OP","0x17e":"Used route does not belong to any known context","0x17f":"Not expecting detached channels during summarize","0x180":"getAttachSummary should always return a tree","0x181":"BaseSnapshot should be there as detached container loaded from snapshot","0x182":"Data store should be attached to attach the channel.","0x183":"There should be a channel context for the op","0x184":"There should be a channel context for the op","0x185":"Channel not found","0x189":"Should always be remote because a local dds shouldn't generate ops before loading","0x18a":"Channel should be loaded to resubmit ops","0x18c":"Channel should be loaded to summarize","0x18d":"Channel should be loaded to take snapshot","0x18e":"Channel must not already be loaded when loading","0x190":".attributes blob should be present","0x192":"Channel should be there if loaded!!","0x193":"Channel should be loaded to run GC","0x194":"Remote channel must be loaded when rebasing op","0x195":"Remote channel must not be local when processing op","0x196":"Remote channel must be loaded when resubmitting op","0x197":"Remote channel must not already be loaded when loading","0x198":"Used route should always be an absolute route","0x19a":"Invalid response value for Fluid object request","0x19b":"Cannot not create response error on 200 status","0x19c":"storage service path has trailing separator","0x19d":"Handles should always have absolute paths","0x19f":"wipSummaryLogger should not be set yet in startSummary","0x1a0":"Already tracking a summary","0x1a1":"summarize should not be called when not tracking the summary","0x1a2":"wipSummaryLogger should have been set in startSummary or ctor","0x1a3":"wipSummaryLogger should have been set in startSummary or ctor","0x1a4":"Not tracking a summary","0x1a5":"Tracked summary local paths not set","0x1a6":"Not found pending summary, but this node has previously completed a summary","0x1a7":"Pending summary reference sequence number should be consistent","0x1a9":"When loading base summary, expected outstanding ops <= tracking sequence number","0x1aa":"Out of order change recorded","0x1ab":"Create SummarizerNode child already exists","0x1ac":"Cannot create child from summary if parent does not have latest summary","0x1ad":"Missing child summary tree","0x1ae":"Child summary object is not a tree","0x1af":"Outstanding ops blob missing, but base summary tree exists","0x1b0":"Base summary tree missing, but outstanding ops blob exists","0x1b1":"wip used routes should be set if tracking a summary","0x1b2":"Getting GC data should not be called when GC is disabled!","0x1b3":"GC data cannot be retrieved without getGCDataFn","0x1b4":"We should not already be tracking used routes when to track a new summary","0x1b5":"We should have been tracking used routes","0x1b6":"Create SummarizerNode child already exists","0x1b7":"Bad session state for processing quorum messages","0x1b8":"Bad session state for processing quorum messages","0x1b9":"Unexpected value for sequence number of first message in file","0x1ba":"should not return empty buckets","0x1bb":"Unexpected sequence number on first of messages to save","0x1bc":"Unexpected sequence number on last of messages to save","0x1bd":"Stopped writing at unexpected sequence number","0x1c5":"snapshot should be set before retrieving it","0x1c6":"snapshot should be set before retrieving it","0x1c7":"snapshot should be set before retrieving it as expanded string","0x1c8":"Mismatch between document sequence number and current op number","0x1c9":"Leftover documents after replay!","0x1ca":"replay-to target is <= current op in replay cycle","0x1cb":"Bad window to verify snapshot","0x1cc":"Unexpected previous snapshot op number","0x1ce":"clientId not found","0x1cf":"clientId not found","0x1d0":"sequenceNumber not found","0x1d3":"Missing client id on disconnect","0x1d5":"Invalid snapshot format version","0x1d6":"Parent summary object is not a tree","0x1d8":"Should only transition from Connecting state","0x1d9":"addRequestCore() should break into smaller chunks","0x1da":"Client id should be set if connected","0x1db":"epoch exists","0x1dc":"all entries have to have epoch","0x1dd":"no epoch","0x1de":"Not an ODSP resolved url","0x1e0":"Protocol and App summary trees should be present","0x1e2":"Caller must ensure 'isAttached()' before calling 'sendSetCellOp'.","0x1e4":"Unexpected serializable type","0x1e5":"Storage token should not be null","0x1e6":"Epoch  should be present in response","0x1e7":"caching was not performed!","0x1e8":"reentrancy","0x1e9":"Pending ops","0x1ea":"Prefetch snapshot only available for odsp!","0x1eb":"Snapshot should be prefetched!","0x1ec":"No refresh token provided.","0x1ed":"Share link should be present","0x1ef":"services must be defined","0x1f0":"Unexpected mismatch in readonly","0x1f5":"Attached state should have storage","0x1f6":"Negative client sequence number not allowed","0x1f7":"Previous client should always be defined","0x1f8":"local BlobAttach op with no pending blob","0x1fc":"summary is not a tree","0x1fe":"isolated channels subtree should exist in remote datastore snapshot","0x1ff":"isolated channels subtree should exist in local datastore snapshot","0x200":"Returned odsp snapshot is malformed. No trees!","0x201":"Returned odsp snapshot is malformed. No blobs!","0x203":"Summary handle is undefined","0x205":"attach() called more than once","0x207":"Channel should be defined","0x208":"Factory should be undefined before loading","0x209":"Factory Type should be defined","0x20a":"register for event on disposed object","0x20b":"mismatch","0x20c":"connection disposed","0x20d":"double connection listener","0x20e":"double tracked listener","0x20f":"Driver min read version should >= to server minReadVersion","0x210":"Snapshot should be created with minReadVersion or above","0x219":"1 root should be there","0x21b":"Snapshot id should be provided","0x21c":"Seq number should be provided","0x21d":"body is not string","0x21e":"improper boundary format","0x220":"socket key collision","0x221":"Root tree should contain the id","0x222":"Root tree should contain the id!!","0x223":"unexpected end of buffer","0x224":"Skip length should be positive","0x225":"Data should be there","0x226":"Should write complete data","0x227":"Data should be there","0x22b":"Should be a pair","0x22c":"reading pairs","0x231":"Number should be an integer","0x232":"Payload should not be negative","0x233":"Unexpected data at the end of buffer","0x234":"has joinOpTimer","0x235":"no joinOpTimer","0x236":"In all cases it should be already installed","0x237":"Snapshot should exist","0x238":"called only in connected state","0x239":"called only in disconnected state","0x23a":"seq#'s","0x23b":"we are not packing at the right level","0x23c":"we are not packing at the right level","0x23d":"pending is undefined","0x23e":"pending is undefined","0x23f":"pending undefined","0x240":"Binary format snapshot only for odsp driver!!","0x241":"disconnect should result in stopSequenceNumberUpdate() call","0x242":"has timer","0x243":"stopSequenceNumberUpdate should be called as result of sending any op!","0x244":"Socket is closed, but connection is not!","0x245":"tracked listener","0x246":"checking consistency of socket & _disposed flags","0x247":"Use addTrackedListener instead","0x248":"should not subscribe to forwarded events","0x24c":"Cannot call `flush()` from `orderSequentially`'s callback","0x24e":"assertion for type narrowing","0x250":"serialized container with attachment blobs must be rehydrated with detached blob storage","0x251":"creation summary has to have seq=0 && handle === undefined","0x252":"redirect table can only be set in detached container","0x253":"redirect table already exists","0x254":"unrecognized id in redirect table","0x255":"detached blob id absent in redirect table","0x256":"storage undefined in attached container","0x257":"This is not summarizing container","0x258":"connected","0x259":"Container disconnected when trying to submit system message","0x25b":"Caller is responsible for checking lock","0x25d":"We should never connect as 'read'","0x25e":"no reason to call fail if all promises have been completed","0x25f":"retryAfterSeconds","0x260":"Disposed should mean disconnected!","0x261":"Expected: off","0x262":"Old summarizer is still working!","0x263":"Expected: starting","0x264":"Expected: Not Off","0x266":"lastKnownSeqNumber should never be below last processed sequence number","0x267":"lastObservedSeqNumber should be updated first","0x268":"There can't be pending fetch that early in boot sequence!","0x269":"pending ops are not dropped","0x26a":"not closed","0x26b":"initial state","0x26c":"handler should be installed","0x26d":"wrong start","0x26e":"wrong start","0x26f":"continuous and no duplicates","0x270":"All requested ops fetched","0x272":"empty request","0x273":"Invalid document id from parsed URL","0x274":"type check","0x275":"Root tree should contain the id","0x278":"API is not supported for non-connecting or closed container","0x27b":"reentrancy may result in incorrect behavior","0x280":"Validate first op seq number","0x281":"Unreferenced if present should be true","0x282":"Headers should be present now","0x283":"Length of data len should fit in the bytes from the map","0x284":"Length of id should fit in the bytes from the map","0x285":"Start code should not undefined","0x286":"End code should not undefined","0x287":"key must exist in the map","0x288":"All properties should exist","0x289":"logic error","0x28a":"can't be disposed - Callers need to ensure that!","0x292":"Unexpected undefined result from getFileLinkCore","0x293":"initial state","0x294":"can't have op processing paused if we are processing an op","0x295":"there should be no pending batch if we have no ops","0x296":"we should never start processing incomplete batch!","0x297":"always called from resumed state","0x298":"we have something in the queue that generates this event","0x299":"non-synchronized state","0x29a":"System message in the middle of batch!","0x29b":"system op in a batch?","0x29c":"we should be processing ops when there is no active batch","0x29d":"we should be processing ops when there is no active batch","0x29e":"there can't be active batch","0x29f":"we should be processing ops when there is no active batch","0x2a0":"batch presence was validated above","0x2a1":"logic error","0x2a2":"Batch is interrupted by other client op. Should be caught by trackPending()","0x2a3":"container should be closed on any error","0x2a5":"join timer","0x2a6":"waitingForLeaveOp should imply writeConnection (we need to be ready to flush pending ops)","0x2a7":"Container is not attached","0x2a8":"Expected data store snapshot tree in base snapshot","0x2a9":"GC nodes for data store not in GC blob","0x2ac":"Connected when timeout waiting for leave from previous session fired!","0x2ad":"GC blob missing from snapshot","0x2ae":"node id should always be an absolute route","0x2af":"Child GC data should have been initialized","0x2b0":"Used route should always be an absolute route","0x2b1":"This should have be initiallized when generate GC nodes above","0x2b2":"Two entries for the same GC node with different unreferenced timestamp","0x2b3":"logic error","0x2b4":"not connected on sending ops!","0x2b5":"logic error","0x2b6":"Missing data store context","0x2b8":"Chunk should be set in map","0x2ba":"batchBegin must fire before batchEnd","0x2bb":"Instrumented token fetcher with throwOnNullToken = true should never return null","0x2bc":"Instrumented token fetcher with throwOnNullToken =true should never return null","0x2bd":"We should not see a pending FlushMode until we see a flush when processing a batch","0x2be":"LocalReferences array contains a gap","0x2bf":"both removedClientIds and removedSeq should be set or not set","0x2c0":"ID must be created before adding interval to collection","0x2c1":"Creating an interval collection that already exists?","0x2c2":"Create Version should be equal to currentReadVersion","0x2c4":"client should not be summarizer before container is created","0x2c5":"Attempting to connect() a closed Container","0x2c6":"Attempting to connect() a container that is not attached","0x2c7":"Attempting to disconnect() a closed Container","0x2c8":"outboundPushEventTime should be undefined","0x2c9":"durationNetwork should be undefined","0x2ca":"durationOutboundBatching should be undefined","0x2cb":"submitOpEventTime should be undefined","0x2cc":"OpTimeSittingInboundQueue should be undefined","0x2cd":"durationNetwork should be undefined","0x2ce":"msnTrackingTimestamp should not be undefined","0x2cf":"undefined channel on datastore context","0x2d0":"Data store should be globally visible to attach channels.","0x2d1":"Data store should be locally visible before it can become globally visible.","0x2d2":"Data store should be globally visible when its attached.","0x2d3":"Local channel must be globally visible when processing op","0x2d4":"Local channel must be globally visible when resubmitting op","0x2d5":"Invalid blob node id in unused routes.","0x2d7":"No data store with specified id","0x2d8":"Empty change event should not be emitted.","0x2da":"Unknown SharedMatrix 'op' type.","0x2db":"Applying op must generate a pending segment","0x2dc":"Cannot find code proposal","0x2dd":"Cannot find blob for a given id","0x2de":"Package path requested for unsupported node type.","0x2df":"transient references cannot be bound to segments","0x2e0":"lref not a Local Reference","0x2e1":"Support for plain value types removed.","0x2e2":"Must only wait for leave message when clientId in quorum","0x2e3":"Must have a valid protocol handler instance","0x2e4":"there should be service config for active connection","0x2e5":"Must have a base snapshot","0x2e6":"Must have a base snapshot","0x2e7":"Must serialize base snapshot blobs before getting runtime state","0x2e8":"There should be a store context for the op","0x2e9":"Must call getLocalState() after applying initial states","0x2ea":"Configuration state should be enabled","0x2eb":"Summary not supported with configuration disabled","0x2ec":"Blob must be present in blobsContents","0x2ed":"There should be a channel context for the op","0x2ee":"Channel should be loaded to rollback ops","0x2ef":"Local channel must be globally visible when rolling back op","0x2f0":"Remote channel must be loaded when rolling back op","0x2f1":"slideReferences from a segment which has not been removed and acked","0x2f2":"Ref not in the segment localRefs","0x2f3":"Ref not in the segment localRefs","0x2f4":"localRefs must be allocated","0x2f5":"op create references must be SlideOnRemove","0x2f6":"SlideOnRemove references must be op created","0x2f8":"Unexpected accept op, nothing pending","0x2f9":"Unexpected accept op, client not in expectedSignoffs","0x2fa":"Unexpected pending message received","0x2fb":"pendingMessageId does not match","0x2fc":"Invalid localOpMetadata for clear","0x2fd":"pendingMessageId does not match","0x2fe":"Invalid localOpMetadata in submit","0x2ff":"Unexpected pending message received","0x300":"localSeq greater than collab window","0x301":"Either seq or localSeq should be defined","0x302":"No segment found","0x303":"Invalid offset","0x304":"Id cannot contain slashes","0x305":"registerDependent on disposed Dependee","0x306":"invalidateDependents on disposed Dependee","0x307":"endInitialization should be called exactly once","0x308":"onDispose should be set when disposing","0x309":"Cannot unregister dependees on a disposed SimpleObservingDependent.","0x30a":"shouldClientJoinWrite should imply this is a writeConnection","0x30b":"Must have a valid protocol handler instance","0x30c":"Id cannot contain slashes","0x30d":"Id cannot contain slashes","0x30e":"Id cannot contain slashes. DataStoreContext should have validated this.","0x30f":"Channel context ID cannot contain slashes","0x310":"Channel context ID cannot contain slashes","0x311":"expected id to exist on interval","0x312":"snapshot should be parsed","0x313":'Specified user was not of type "TinyliciousUser".',"0x314":"Container properly closed","0x315":"re-entrancy","0x316":"There should be a cached promise of in-progress aliasing","0x317":"dataStoreFactory is undefined","0x318":"resolvedUrl is undefined","0x319":"No delta connection server associated with specified document ID","0x31a":"resolvedUrl is undefined","0x31b":"container1.resolvedUrl is undefined","0x31c":"rightDiv is undefined","0x31d":'options are not of type "IRouterliciousRouteOptions" as expected',"0x31e":"options.tenantId is undefined","0x320":"options.tenantId is undefined","0x322":"options.fluidHost is undefined","0x324":"options.server is undefined","0x325":"options.odspAccessToken is undefined","0x326":"lockResolver is undefined","0x327":"options.server is undefined","0x328":"options.server is undefined","0x329":"browser.umd property is undefined","0x32a":"pendingMessageId does not match","0x32b":"Invalid localOpMetadata for clear","0x32c":"pendingMessageId does not match","0x32d":"Invalid localOpMetadata in submit","0x32e":"Unexpected pending message received","0x32f":"Invalid localOpMetadata for sub directory op","0x330":"Unexpected pending message received","0x331":"Unexpected pending message received","0x332":"Unexpected pending message received","0x333":"PathShared.splice can only insert detached ranges","0x334":"Anchor must not be double freed","0x335":"ObjectForest.getRoot only valid for existing roots","0x336":"ObjectForest must only be given its own Anchors","0x337":"ObjectForest must only be given its own Cursor type","0x338":"ObjectForest must only be given its own Cursor","0x339":"Anchor must not be double freed","0x33a":"Anchor must not be double freed","0x33b":"Cursor must not be freed","0x33c":"Cursor must not be freed","0x33d":"Cursor must be current to be used","0x33e":"Cursor must be current to be used","0x33f":"Cursor must not be double freed","0x340":"Cursor must be current to be used","0x341":"Cursor must be current to be used","0x342":'Invalid usage. "blobid" should always be null',"0x343":'Invalid usage. "count" should always be 1',"0x344":"this.pendingConnection should be undefined","0x345":"this.pendingConnection is undefined when trying to cancel","0x346":"inboundQueuePausedFromInit should be true"}},9477:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateUser=t.generateToken=void 0;const r=n(1166),i=n(8410);function s(){return{id:(0,i.v4)(),name:(0,i.v4)()}}t.generateToken=function(e,t,n,o,a,c=3600,l="1.0"){let u=a||s();""!==u.id&&void 0!==u.id||(u=s());const h=Math.round(Date.now()/1e3),d={documentId:null!=o?o:"",scopes:n,tenantId:e,user:u,iat:h,exp:h+c,ver:l,jti:(0,i.v4)()},p={utf8:t};return r.KJUR.jws.JWS.sign(null,JSON.stringify({alg:"HS256",typ:"JWT"}),d,p)},t.generateUser=s},2098:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(4926),t),i(n(2697),t),i(n(3891),t),i(n(591),t),i(n(2248),t),i(n(6749),t),i(n(3261),t),i(n(726),t)},4926:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InsecureTokenProvider=void 0;const r=n(2499),i=n(9477);t.InsecureTokenProvider=class{constructor(e,t){this.tenantKey=e,this.user=t}async fetchOrdererToken(e,t){return{fromCache:!0,jwt:(0,i.generateToken)(e,this.tenantKey,[r.ScopeType.DocRead,r.ScopeType.DocWrite,r.ScopeType.SummaryWrite],t,this.user)}}async fetchStorageToken(e,t){return{fromCache:!0,jwt:(0,i.generateToken)(e,this.tenantKey,[r.ScopeType.DocRead,r.ScopeType.DocWrite,r.ScopeType.SummaryWrite],t,this.user)}}}},3891:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MockDeltaManager=t.MockDeltaQueue=void 0;const r=n(7187),i=n(4690);class s extends r.EventEmitter{constructor(){super(),this.queue=[],this.pauseCount=0,this.processCallback=()=>{}}get disposed(){}get paused(){return 0!==this.pauseCount}get length(){return this.queue.length}get idle(){return 0===this.queue.length}process(){Promise.resolve().then((()=>{for(;0===this.pauseCount&&this.length>0;){const e=this.pop();(0,i.assert)(void 0!==e,"this is impossible due to the above length check"),this.processCallback(e)}}))}push(e){this.queue.push(e),this.emit("push",e),this.process()}pop(){return this.queue.shift()}async pause(){this.pauseCount++}resume(){this.pauseCount--,this.process()}peek(){return this.queue[0]}toArray(){return this.queue}dispose(){}async waitTillProcessingDone(){throw new Error("NYI")}}t.MockDeltaQueue=s;class o extends i.TypedEventEmitter{constructor(){super(),this.readOnlyInfo={readonly:!1},this.clientType=void 0,this.clientDetails=void 0,this._inbound=void 0,this._inboundSignal=void 0,this._outbound=void 0,this.minimumSequenceNumber=0,this.lastSequenceNumber=0,this.lastKnownSeqNumber=0,this.initialSequenceNumber=0,this.hasCheckpointSequenceNumber=!1,this._inbound=new s,this._outbound=new s,this._inboundSignal=new s}get disposed(){}get IDeltaSender(){return this}get inbound(){return this._inbound}get outbound(){return this._outbound}get inboundSignal(){return this._inboundSignal}get version(){}get maxMessageSize(){return 0}get serviceConfiguration(){}get active(){return!0}close(){}submitSignal(e){}flush(){}submit(e,t,n=!1,r){return 0}dispose(){}}t.MockDeltaManager=o},591:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MockHandle=void 0;const r=n(2994);t.MockHandle=class{constructor(e,t=`mock-handle-${Math.random().toString(36).slice(2)}`,n=`/${t}`){this.value=e,this.path=t,this.absolutePath=n,this.graphAttachState=r.AttachState.Detached}get IFluidHandle(){return this}get isAttached(){return this.graphAttachState===r.AttachState.Attached}async get(){return this.value}attachGraph(){this.graphAttachState=r.AttachState.Attached}bind(){throw Error("MockHandle.bind() unimplemented.")}}},3261:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MockStorage=void 0;const r=n(4690),i=n(9251);class s{constructor(e){this.tree=e}static createFromSummary(e){const t=(0,i.convertSummaryTreeToITree)(e);return new s(t)}static readBlobCore(e,t){if(e)for(const n of e.entries)if(n.path===t[0])return"Blob"===n.type?((0,r.assert)(1===t.length,JSON.stringify(Object.assign({},arguments))),n.value):"Tree"===n.type?s.readBlobCore(n.value,t.slice(1)):void 0}async readBlob(e){const t=s.readBlobCore(this.tree,e.split("/"));return(0,r.assert)(void 0!==t,`Blob does not exist: ${e}`),(0,r.stringToBuffer)(t.contents,t.encoding)}async contains(e){return void 0!==s.readBlobCore(this.tree,e.split("/"))}async list(e){return(0,i.listBlobsAtTreePath)(this.tree,e)}}t.MockStorage=s},2248:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MockSharedObjectServices=t.MockObjectStorageService=t.MockEmptyDeltaConnection=t.MockFluidDataStoreRuntime=t.MockQuorumClients=t.MockContainerRuntimeFactory=t.MockContainerRuntime=t.MockDeltaConnection=void 0;const r=n(7187),i=n(4690),s=n(2994),o=n(2609),a=n(2499),c=n(9251),l=n(8410),u=n(3891);class h{constructor(e,t){this.submitFn=e,this.dirtyFn=t,this._connected=!0}get connected(){return this._connected}attach(e){this.handler=e,e.setConnectionState(this.connected)}submit(e,t){return this.submitFn(e,t)}dirty(){this.dirtyFn()}setConnectionState(e){var t;this._connected=e,null===(t=this.handler)||void 0===t||t.setConnectionState(e)}process(e,t,n){var r;null===(r=this.handler)||void 0===r||r.process(e,t,n)}reSubmit(e,t){var n;null===(n=this.handler)||void 0===n||n.reSubmit(e,t)}}t.MockDeltaConnection=h;class d{constructor(e,t){var n;this.dataStoreRuntime=e,this.factory=t,this.clientSequenceNumber=0,this.deltaConnections=[],this.pendingMessages=[],this.deltaManager=new u.MockDeltaManager,this.dataStoreRuntime.deltaManager=this.deltaManager,this.dataStoreRuntime.quorum=t.quorum,this.clientId=null!==(n=this.dataStoreRuntime.clientId)&&void 0!==n?n:(0,l.v4)(),t.quorum.addMember(this.clientId,{})}createDeltaConnection(){const e=new h(((e,t)=>this.submit(e,t)),(()=>this.dirty()));return this.deltaConnections.push(e),e}submit(e,t){const n=this.clientSequenceNumber++,r={clientId:this.clientId,clientSequenceNumber:n,contents:e,referenceSequenceNumber:this.deltaManager.lastSequenceNumber,type:a.MessageType.Operation};return this.factory.pushMessage(r),this.addPendingMessage(e,t,n),n}dirty(){}process(e){this.deltaManager.lastSequenceNumber=e.sequenceNumber,this.deltaManager.lastMessage=e,this.deltaManager.minimumSequenceNumber=e.minimumSequenceNumber;const[t,n]=this.processInternal(e);this.deltaConnections.forEach((r=>{r.process(e,t,n)}))}addPendingMessage(e,t,n){const r={content:e,clientSequenceNumber:n,localOpMetadata:t};this.pendingMessages.push(r)}processInternal(e){let t;const n=this.clientId===e.clientId;if(n){const n=this.pendingMessages.shift();(0,i.assert)((null==n?void 0:n.clientSequenceNumber)===e.clientSequenceNumber,"Unexpected client sequence number from message"),t=n.localOpMetadata}return[n,t]}}t.MockContainerRuntime=d,t.MockContainerRuntimeFactory=class{constructor(){this.sequenceNumber=0,this.minSeq=new Map,this.quorum=new p,this.messages=[],this.runtimes=[]}get outstandingMessageCount(){return this.messages.length}getMinSeq(){let e;for(const[t,n]of this.minSeq)void 0!==this.quorum.getMember(t)&&(e=void 0===e?n:Math.min(e,n));return null!=e?e:0}createContainerRuntime(e){const t=new d(e,this);return this.runtimes.push(t),t}pushMessage(e){e.clientId&&void 0!==e.referenceSequenceNumber&&!this.minSeq.has(e.clientId)&&this.minSeq.set(e.clientId,e.referenceSequenceNumber),this.messages.push(e)}processOneMessage(){if(0===this.messages.length)throw new Error("Tried to process a message that did not exist");let e=this.messages.shift();e=JSON.parse(JSON.stringify(e)),this.minSeq.set(e.clientId,e.referenceSequenceNumber),e.sequenceNumber=++this.sequenceNumber,e.minimumSequenceNumber=this.getMinSeq();for(const t of this.runtimes)t.process(e)}processSomeMessages(e){if(e>this.messages.length)throw new Error("Tried to process more messages than exist");for(let t=0;t<e;t++)this.processOneMessage()}processAllMessages(){for(;this.messages.length>0;)this.processOneMessage()}};class p{constructor(...e){var t;this.eventEmitter=new r.EventEmitter,this.disposed=!1,this.members=new Map(null!==(t=e)&&void 0!==t?t:[])}addMember(e,t){this.members.set(e,t),this.eventEmitter.emit("addMember",e,t)}removeMember(e){this.members.delete(e)&&this.eventEmitter.emit("removeMember",e)}getMembers(){return this.members}getMember(e){return this.getMembers().get(e)}dispose(){throw new Error("Method not implemented.")}addListener(e,t){throw new Error("Method not implemented.")}on(e,t){switch(e){case"afterOn":return this.eventEmitter.on(e,t),this;case"addMember":case"removeMember":return this.eventEmitter.on(e,t),this.eventEmitter.emit("afterOn",e),this;default:throw new Error("Method not implemented.")}}once(e,t){throw new Error("Method not implemented.")}prependListener(e,t){throw new Error("Method not implemented.")}prependOnceListener(e,t){throw new Error("Method not implemented.")}removeListener(e,t){return this.eventEmitter.removeListener(e,t),this}off(e,t){return this.eventEmitter.off(e,t),this}removeAllListeners(e){throw new Error("Method not implemented.")}setMaxListeners(e){throw new Error("Method not implemented.")}getMaxListeners(){throw new Error("Method not implemented.")}listeners(e){throw new Error("Method not implemented.")}rawListeners(e){throw new Error("Method not implemented.")}emit(e,...t){throw new Error("Method not implemented.")}eventNames(){throw new Error("Method not implemented.")}listenerCount(e){throw new Error("Method not implemented.")}}t.MockQuorumClients=p;class f extends r.EventEmitter{constructor(){super(...arguments),this.documentId=void 0,this.id=(0,l.v4)(),this.existing=void 0,this.options={},this.clientId=(0,l.v4)(),this.path="",this.connected=!0,this.deltaManager=new u.MockDeltaManager,this.loader=void 0,this.logger=o.DebugLogger.create("fluid:MockFluidDataStoreRuntime"),this.quorum=new p,this._local=!1,this._disposed=!1}get IFluidHandleContext(){return this}get rootRoutingContext(){return this}get channelsRoutingContext(){return this}get objectsRoutingContext(){return this}get IFluidRouter(){return this}get absolutePath(){return`/${this.id}`}get local(){return this._local}set local(e){this._local=e}get disposed(){return this._disposed}dispose(){this._disposed=!0}async getChannel(e){return null}createChannel(e,t){return null}get isAttached(){return!this.local}get attachState(){return this.local?s.AttachState.Detached:s.AttachState.Attached}bindChannel(e){}attachGraph(){}bindToContext(){}bind(e){}getQuorum(){return this.quorum}getAudience(){return null}save(e){}async close(){}async uploadBlob(e){return null}async getBlob(e){return null}submitMessage(e,t){return null}submitSignal(e,t){return null}process(e,t){}processSignal(e,t){}updateMinSequenceNumber(e){}setConnectionState(e,t){}async resolveHandle(e){return this.request(e)}async request(e){return null}addedGCOutboundReference(e,t){}async summarize(e,t){const n=(0,c.mergeStats)();return n.treeNodeCount++,{summary:{type:a.SummaryType.Tree,tree:{}},stats:n}}async getGCData(){return{gcNodes:{}}}updateUsedRoutes(e,t){}getAttachSnapshot(){return[]}getAttachSummary(){const e=(0,c.mergeStats)();return e.treeNodeCount++,{summary:{type:a.SummaryType.Tree,tree:{}},stats:e}}setAttachState(e){}async waitAttached(){}async requestDataStore(e){return null}reSubmit(e,t){}async applyStashedOp(e){}rollback(e,t){}}t.MockFluidDataStoreRuntime=f;class g{constructor(){this.connected=!1}attach(e){}submit(e){return(0,i.assert)(!1,"Throw submit error on mock empty delta connection"),0}dirty(){}}t.MockEmptyDeltaConnection=g;class m{constructor(e){this.contents=e}async readBlob(e){return(0,i.stringToBuffer)(this.contents[e],"utf8")}async contains(e){return void 0!==this.contents[e]}async list(e){const t=(0,c.getNormalizedObjectStoragePathParts)(e).length;return Object.keys(this.contents).filter((n=>n.startsWith(e)&&n.split("/").length===t+1))}}t.MockObjectStorageService=m;class y{constructor(e){this.deltaConnection=new g,this.objectStorage=new m(e)}static createFromSummary(e){const t={};for(const[n,r]of Object.entries(e.tree))(0,i.assert)(r.type===a.SummaryType.Blob,"Unexpected summary type on mock createFromSummary"),t[n]=r.content;return new y(t)}}t.MockSharedObjectServices=y},2697:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MockFluidDataStoreContext=void 0;const r=n(2609),i=n(8410);t.MockFluidDataStoreContext=class{constructor(e=(0,i.v4)(),t=!1,n=r.DebugLogger.create("fluid:MockFluidDataStoreContext")){this.id=e,this.existing=t,this.logger=n,this.documentId=void 0,this.isLocalDataStore=!0,this.packagePath=void 0,this.options=void 0,this.clientId=(0,i.v4)(),this.clientDetails=void 0,this.connected=!0,this.deltaManager=void 0,this.containerRuntime=void 0,this.storage=void 0,this.IFluidDataStoreRegistry=void 0,this.IFluidHandleContext=void 0,this.attachState=void 0,this.scope=void 0}on(e,t){switch(e){case"attaching":case"attached":return this;default:throw new Error("Method not implemented.")}}once(e,t){return this}off(e,t){throw new Error("Method not implemented.")}getQuorum(){}getAudience(){}submitMessage(e,t,n){throw new Error("Method not implemented.")}submitSignal(e,t){throw new Error("Method not implemented.")}bindToContext(){throw new Error("Method not implemented.")}setChannelDirty(e){throw new Error("Method not implemented.")}async getAbsoluteUrl(e){throw new Error("Method not implemented.")}getCreateChildSummarizerNodeFn(e,t){throw new Error("Method not implemented.")}async uploadBlob(e){throw new Error("Method not implemented.")}async getInitialGCSummaryDetails(){throw new Error("Method not implemented.")}async getBaseGCDetails(){throw new Error("Method not implemented.")}}},6749:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MockContainerRuntimeFactoryForReconnection=t.MockContainerRuntimeForReconnection=void 0;const r=n(8410),i=n(4690),s=n(2248);class o extends s.MockContainerRuntime{constructor(e,t){super(e,t),this.pendingRemoteMessages=[],this._connected=!0}get connected(){return this._connected}set connected(e){if(this._connected!==e){if(this._connected=e,e){for(const e of this.pendingRemoteMessages)this.process(e);this.pendingRemoteMessages.length=0,this.clientSequenceNumber=0,this.clientId=(0,r.v4)(),this.dataStoreRuntime.clientId=this.clientId,this.factory.quorum.addMember(this.clientId,{}),this.reSubmitMessages()}else this.factory.clearOutstandingClientMessages(this.clientId),this.factory.quorum.removeMember(this.clientId);this.deltaConnections.forEach((e=>{e.setConnectionState(this.connected)}))}}process(e){this.connected?super.process(e):this.pendingRemoteMessages.push(e)}submit(e,t){return this.connected?super.submit(e,t):(this.addPendingMessage(e,t,-1),-1)}reSubmitMessages(){let e=this.pendingMessages.length;for(;e>0;){const t=this.pendingMessages.shift();(0,i.assert)(void 0!==t,"this is impossible due to the above length check"),this.deltaConnections.forEach((e=>{e.reSubmit(t.content,t.localOpMetadata)})),e--}}}t.MockContainerRuntimeForReconnection=o;class a extends s.MockContainerRuntimeFactory{createContainerRuntime(e){const t=new o(e,this);return this.runtimes.push(t),t}clearOutstandingClientMessages(e){this.messages=this.messages.filter((t=>t.clientId!==e))}}t.MockContainerRuntimeFactoryForReconnection=a},726:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateAssertionError=void 0;const r=n(979);t.validateAssertionError=function(e,t){var n;const i=null!==(n=r.shortCodeMap[e.message])&&void 0!==n?n:e.message;if(i!==t)throw new Error(`Unexpected assertion thrown: ${e.message} ('${i}')`);return!0}},4690:(e,t,n)=>{"use strict";function r(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}n.r(t),n.d(t,{BaseTelemetryNullLogger:()=>C,BatchManager:()=>m,Deferred:()=>N,EventForwarder:()=>S,Heap:()=>x,IsoBuffer:()=>l,Lazy:()=>B,LazyPromise:()=>O,NumberComparer:()=>w,PromiseCache:()=>k,PromiseTimer:()=>L,RangeTracker:()=>I,RateLimiter:()=>F,TelemetryNullLogger:()=>E,Timer:()=>M,Trace:()=>_,TypedEventEmitter:()=>b,Uint8ArrayToArrayBuffer:()=>z,Uint8ArrayToString:()=>s,assert:()=>r,bufferToString:()=>a,delay:()=>j,doIfNotDisposed:()=>y,extractLogSafeErrorProperties:()=>T,fromBase64ToUtf8:()=>p,fromUtf8ToBase64:()=>f,gitHashFile:()=>h,hashFile:()=>u,isArrayBuffer:()=>c,performance:()=>d,safelyParseJSON:()=>D,stringToBuffer:()=>o,toUtf8:()=>g,unreachableCase:()=>q});var i=n(9742);function s(e,t){switch(t){case"base64":return i.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}const o=(e,t)=>l.from(e,t).buffer,a=(e,t)=>l.from(e).toString(t);function c(e){const t=e;return e instanceof ArrayBuffer||"object"==typeof t&&null!==t&&"number"==typeof t.byteLength&&"function"==typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}class l extends Uint8Array{toString(e){return s(this,e)}static from(e,t,n){if("string"==typeof e)return l.fromString(e,t);if(null!==e&&"object"==typeof e&&c(e.buffer))return r(0===e.byteOffset,0),r(e.byteLength===e.buffer.byteLength,1),l.fromArrayBuffer(e.buffer,t,n);if(c(e))return l.fromArrayBuffer(e,t,n);throw new TypeError}static fromArrayBuffer(e,t,n){const r=null!=t?t:0,i=null!=n?n:e.byteLength-r;if(r<0||r>e.byteLength||i<0||i+r>e.byteLength)throw new RangeError;return new l(e,r,i)}static fromString(e,t){switch(t){case"base64":{const t=this.sanitizeBase64(e),n=i.toByteArray(t);return new l(n.buffer)}case"utf8":case"utf-8":case void 0:{const t=(new TextEncoder).encode(e);return new l(t.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!=0&&(t+=["","===","==","="][t.length%4]),t}}async function u(e,t="SHA-1",r="hex"){if(void 0===crypto.subtle)return n.e(564).then(n.bind(n,4569)).then((async n=>n.hashFile(e,t,r)));const s=await async function(e,t){const n=await crypto.subtle.digest(t,e);return new Uint8Array(n)}(e,t);return function(e,t){switch(t){case"hex":return Array.prototype.map.call(e,(e=>e.toString(16).padStart(2,"0"))).join("");case"base64":return i.fromByteArray(e)}}(s,r)}async function h(e){const t=`blob ${e.byteLength.toString()}${String.fromCharCode(0)}`;return u(l.from(t+e.toString()))}const d=window.performance,p=e=>l.from(e,"base64").toString("utf-8"),f=e=>l.from(e,"utf8").toString("base64"),g=(e,t)=>{switch(t){case"utf8":case"utf-8":return e;default:return l.from(e,t).toString()}};class m{constructor(e,t=100){this.process=e,this.maxBatchSize=t,this.pendingWork=new Map}add(e,t){this.pendingWork.has(e)||this.pendingWork.set(e,[]),this.pendingWork.get(e).push(t),this.pendingWork.get(e).length>=this.maxBatchSize?(void 0!==this.pendingTimer&&clearTimeout(this.pendingTimer),this.pendingTimer=void 0,this.startWork()):void 0===this.pendingTimer&&(this.pendingTimer=setTimeout((()=>{this.pendingTimer=void 0,this.startWork()}),0))}drain(){this.startWork()}startWork(){const e=this.pendingWork;this.pendingWork=new Map;for(const[t,n]of e)this.process(t,n)}}function y(e,t){return(...n)=>{if(e.disposed)throw new Error("Already disposed");return t(...n)}}var v=n(7187);class b extends v.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}class S extends b{constructor(e){if(super(),this.isDisposed=!1,this.forwardingEvents=new Map,void 0!==e){const t=t=>this.unforwardEvent(e,t),n=t=>this.forwardEvent(e,t);this.on(S.removeListenerEvent,t),this.on(S.newListenerEvent,n)}}static isEmitterEvent(e){return e===S.newListenerEvent||e===S.removeListenerEvent}get disposed(){return this.isDisposed}dispose(){this.isDisposed=!0;for(const e of this.forwardingEvents.values())for(const t of e.values())try{t()}catch(e){}this.removeAllListeners(),this.forwardingEvents.clear()}forwardEvent(e,...t){for(const n of t)if(void 0!==e&&void 0!==n&&!S.isEmitterEvent(n)){let t=this.forwardingEvents.get(n);if(void 0===t&&(t=new Map,this.forwardingEvents.set(n,t)),!t.has(e)){const r=(...e)=>this.emit(n,...e);t.set(e,(()=>e.off(n,r))),e.on(n,r)}}}unforwardEvent(e,...t){for(const n of t)if(void 0!==n&&!S.isEmitterEvent(n)){const t=this.forwardingEvents.get(n);if((null==t?void 0:t.has(e))&&0===this.listenerCount(n)){const r=t.get(e);void 0!==r&&r(),t.delete(e),0===t.size&&this.forwardingEvents.delete(n)}}}}S.newListenerEvent="newListener",S.removeListenerEvent="removeListener";const w={compare:(e,t)=>e-t,min:Number.MIN_VALUE};class x{constructor(e){this.comp=e,this.L=[{value:e.min,position:0}]}peek(){return this.L[1]}get(){this.swap(1,this.count());const e=this.L.pop();return this.fixdown(1),e.value}add(e){const t={value:e,position:this.L.length};return this.L.push(t),this.fixup(this.count()),t}update(e){const t=e.position;this.isGreaterThanParent(t)?this.fixup(t):this.fixdown(t)}remove(e){const t=e.position;this.swap(e.position,this.L.length-1),this.L.splice(this.L.length-1),t!==this.L.length&&this.update(this.L[t])}count(){return this.L.length-1}fixup(e){let t=e;for(;this.isGreaterThanParent(t);){const e=t>>1;this.swap(t,e),t=e}}isGreaterThanParent(e){return e>1&&this.comp.compare(this.L[e>>1].value,this.L[e].value)>0}fixdown(e){let t=e;for(;t<<1<=this.count();){let e=t<<1;if(e<this.count()&&this.comp.compare(this.L[e].value,this.L[e+1].value)>0&&e++,this.comp.compare(this.L[t].value,this.L[e].value)<=0)break;this.swap(t,e),t=e}}swap(e,t){const n=this.L[e];this.L[e]=this.L[t],this.L[e].position=e,this.L[t]=n,this.L[t].position=t}}class C{send(e){}}class E{send(e){}sendTelemetryEvent(e,t){}sendErrorEvent(e,t){}sendPerformanceEvent(e,t){}}function T(e){const t={message:"string"==typeof(null==e?void 0:e.message)?e.message:String(e)};if(null!==(n=e)&&!Array.isArray(n)&&"object"==typeof n){const{errorType:n,stack:r,name:i}=e;if("string"==typeof n&&(t.errorType=n),"string"==typeof r){const e="string"==typeof i?i:void 0;t.stack=((e,t)=>{const n=e.split("\n");return n.shift(),void 0!==t&&n.unshift(t),n.join("\n")})(r,e)}}var n;return t}class A{constructor(e,t){this.expiry=e,this.cleanup=t,this.gcTimeouts=new Map}schedule(e){"indefinite"!==this.expiry.policy&&this.gcTimeouts.set(e,setTimeout((()=>{this.cleanup(e),this.cancel(e)}),this.expiry.durationMs))}cancel(e){const t=this.gcTimeouts.get(e);void 0!==t&&(clearTimeout(t),this.gcTimeouts.delete(e))}update(e){"sliding"===this.expiry.policy&&(this.cancel(e),this.schedule(e))}}class k{constructor({expiry:e={policy:"indefinite"},removeOnError:t=(()=>!0)}={}){this.cache=new Map,this.removeOnError=t,this.gc=new A(e,(e=>this.remove(e)))}has(e){return this.cache.has(e)}get(e){return this.has(e)&&this.gc.update(e),this.cache.get(e)}remove(e){return this.gc.cancel(e),this.cache.delete(e)}async addOrGet(e,t){let n=this.get(e);return void 0===n&&(n=(async()=>t())(),this.cache.set(e,n),n.catch((t=>{this.removeOnError(t)&&this.remove(e)})),this.gc.schedule(e)),n}add(e,t){const n=this.has(e);return this.addOrGet(e,t).catch((()=>{})),!n}async addValueOrGet(e,t){return this.addOrGet(e,(async()=>t))}addValue(e,t){return this.add(e,(async()=>t))}}class N{constructor(){this.completed=!1,this.p=new Promise(((e,t)=>{this.res=e,this.rej=t}))}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){void 0!==this.res&&(this.completed=!0,this.res(e))}reject(e){void 0!==this.rej&&(this.completed=!0,this.rej(e))}}class O{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return void 0===this.result&&(this.result=this.execute()),this.result}}var P=n(361),R=n.n(P);class I{constructor(e,t){"number"==typeof e?(this.ranges=[{length:0,primary:e,secondary:t}],this.lastPrimary=e,this.lastSecondary=t):(this.ranges=R()(e.ranges),this.lastPrimary=e.lastPrimary,this.lastSecondary=e.lastSecondary)}get base(){return this.ranges[0].primary}get primaryHead(){return this.lastPrimary}get secondaryHead(){return this.lastSecondary}serialize(){return{lastPrimary:this.lastPrimary,lastSecondary:this.lastSecondary,ranges:R()(this.ranges)}}add(e,t){r(e>=this.lastPrimary,3),void 0!==this.lastSecondary&&r(t>=this.lastSecondary,4),this.lastPrimary=e,this.lastSecondary=t;const n=this.ranges[this.ranges.length-1],i=n.primary+n.length,s=n.secondary+n.length;t!==s&&(e===i?0===n.length?n.secondary=t:(n.length--,this.ranges.push({length:0,primary:e,secondary:t})):i+1===e&&s+1===t?n.length++:this.ranges.push({length:0,primary:e,secondary:t}))}get(e){r(e>=this.ranges[0].primary,5);let t=1;for(;t<this.ranges.length&&!(e<this.ranges[t].primary);t++);r(e>=this.ranges[t-1].primary,6);const n=this.ranges[t-1];return Math.min(e-n.primary,n.length)+n.secondary}updateBase(e){r(e>=this.ranges[0].primary,7);let t=1;for(;t<this.ranges.length&&!(e<this.ranges[t].primary);t++);r(e>=this.ranges[t-1].primary,8);const n=this.ranges[t-1],i=e-n.primary;n.secondary=n.secondary+Math.min(i,n.length),n.length=Math.max(n.length-i,0),n.primary=e,this.ranges=t-1>0?this.ranges.slice(t-1):this.ranges,r(e===this.ranges[0].primary,9)}}class F{constructor(e){this.windowMSec=e,this.requestMap=new Map}filter(e,t){const n=[],r=Date.now();for(const i of t){const t=`${e}/${i}`;if(this.requestMap.has(t)){if(this.requestMap.get(t)+this.windowMSec>r)continue;this.requestMap.set(t,r),n.push(i)}else this.requestMap.set(t,r),n.push(i)}return n}}function D(e){let t;try{t=JSON.parse(e)}catch(e){}return t}class M{constructor(e,t,n=(()=>Date.now())){this.defaultTimeout=e,this.defaultHandler=t,this.getCurrentTick=n}get hasTimer(){return!!this.runningState}start(e=this.defaultTimeout,t=this.defaultHandler){this.startCore(e,t,e)}clear(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}restart(e,t){var n,r;if(this.runningState){const i=null!=e?e:this.runningState.intendedDuration,s=null!==(r=null!=t?t:null===(n=this.runningState.restart)||void 0===n?void 0:n.handler)&&void 0!==r?r:this.runningState.handler,o=this.calculateRemainingTime(this.runningState);i<o?this.start(i,s):i===o?(this.runningState.handler=s,this.runningState.restart=void 0,this.runningState.intendedDuration=i):this.runningState.restart={startTick:this.getCurrentTick(),duration:i,handler:s}}else this.start(e,t)}startCore(e,t,n){this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:e,intendedDuration:n,handler:t,timeout:setTimeout((()=>this.handler()),e)}}handler(){r(!!this.runningState,10);const e=this.runningState.restart;if(void 0!==e){const t=this.calculateRemainingTime(e);this.startCore(t,(()=>e.handler()),e.duration)}else{const e=this.runningState.handler;this.clear(),e()}}calculateRemainingTime(e){const t=this.getCurrentTick()-e.startTick;return e.duration-t}}class L{constructor(e,t){this.timer=new M(e,(()=>this.wrapHandler(t)))}get hasTimer(){return this.timer.hasTimer}async start(e,t){return this.clear(),this.deferred=new N,this.timer.start(e,t?()=>this.wrapHandler(t):void 0),this.deferred.promise}clear(){this.timer.clear(),this.deferred&&(this.deferred.resolve({timerResult:"cancel"}),this.deferred=void 0)}wrapHandler(e){e(),r(!!this.deferred,11),this.deferred.resolve({timerResult:"timeout"}),this.deferred=void 0}}class _{constructor(e){this.startTick=e,this.lastTick=e}static start(){const e=d.now();return new _(e)}trace(){const e=d.now(),t={totalTimeElapsed:e-this.startTick,duration:e-this.lastTick,tick:e};return this.lastTick=e,t}}function q(e,t="Unreachable Case"){throw new Error(t)}class B{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}}const j=async e=>new Promise((t=>setTimeout((()=>t()),e)));function z(e){return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}},2499:(e,t,n)=>{"use strict";var r,i,s,o,a,c;n.r(t),n.d(t,{FileMode:()=>s,MessageType:()=>r,NackErrorType:()=>i,ScopeType:()=>c,SummaryType:()=>a,TreeEntry:()=>o}),function(e){e.NoOp="noop",e.ClientJoin="join",e.ClientLeave="leave",e.Propose="propose",e.Reject="reject",e.Summarize="summarize",e.SummaryAck="summaryAck",e.SummaryNack="summaryNack",e.Operation="op",e.RemoteHelp="remoteHelp",e.NoClient="noClient",e.RoundTrip="tripComplete",e.Control="control"}(r||(r={})),function(e){e.ThrottlingError="ThrottlingError",e.InvalidScopeError="InvalidScopeError",e.BadRequestError="BadRequestError",e.LimitExceededError="LimitExceededError"}(i||(i={})),function(e){e.File="100644",e.Executable="100755",e.Directory="040000",e.Symlink="120000"}(s||(s={})),function(e){e.Blob="Blob",e.Tree="Tree",e.Attachment="Attachment"}(o||(o={})),function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(a||(a={})),function(e){e.DocRead="doc:read",e.DocWrite="doc:write",e.SummaryWrite="summary:write"}(c||(c={}))},8599:e=>{"use strict";const{AbortController:t,AbortSignal:n}="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0;e.exports=t,e.exports.AbortSignal=n,e.exports.default=t},9742:(e,t)=>{"use strict";t.byteLength=function(e){var t=a(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,s=a(e),o=s[0],c=s[1],l=new i(function(e,t,n){return 3*(t+n)/4-n}(0,o,c)),u=0,h=c>0?o-4:o;for(n=0;n<h;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],l[u++]=t>>16&255,l[u++]=t>>8&255,l[u++]=255&t;return 2===c&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,l[u++]=255&t),1===c&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,l[u++]=t>>8&255,l[u++]=255&t),l},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,s=[],o=16383,a=0,l=r-i;a<l;a+=o)s.push(c(e,a,a+o>l?l:a+o));return 1===i?(t=e[r-1],s.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],s.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"=")),s.join("")};for(var n=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0;o<64;++o)n[o]=s[o],r[s.charCodeAt(o)]=o;function a(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function c(e,t,r){for(var i,s,o=[],a=t;a<r;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(n[(s=i)>>18&63]+n[s>>12&63]+n[s>>6&63]+n[63&s]);return o.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},1924:(e,t,n)=>{"use strict";var r=n(210),i=n(5559),s=i(r("String.prototype.indexOf"));e.exports=function(e,t){var n=r(e,!!t);return"function"==typeof n&&s(e,".prototype.")>-1?i(n):n}},5559:(e,t,n)=>{"use strict";var r=n(2514),i=n(210),s=n(7771),o=i("%TypeError%"),a=i("%Function.prototype.apply%"),c=i("%Function.prototype.call%"),l=i("%Reflect.apply%",!0)||r.call(c,a),u=i("%Object.defineProperty%",!0),h=i("%Math.max%");if(u)try{u({},"a",{value:1})}catch(e){u=null}e.exports=function(e){if("function"!=typeof e)throw new o("a function is required");var t=l(r,c,arguments);return s(t,1+h(0,e.length-(arguments.length-1)),!0)};var d=function(){return l(r,a,arguments)};u?u(e.exports,"apply",{value:d}):e.exports.apply=d},4098:function(e,t){var n="undefined"!=typeof self?self:this,r=function(){function e(){this.fetch=!1,this.DOMException=n.DOMException}return e.prototype=n,new e}();!function(e){!function(t){var n="URLSearchParams"in e,r="Symbol"in e&&"iterator"in Symbol,i="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),s="FormData"in e,o="ArrayBuffer"in e;if(o)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],c=ArrayBuffer.isView||function(e){return e&&a.indexOf(Object.prototype.toString.call(e))>-1};function l(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function u(e){return"string"!=typeof e&&(e=String(e)),e}function h(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return r&&(t[Symbol.iterator]=function(){return t}),t}function d(e){this.map={},e instanceof d?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function p(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function f(e){return new Promise((function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}}))}function g(e){var t=new FileReader,n=f(t);return t.readAsArrayBuffer(e),n}function m(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function y(){return this.bodyUsed=!1,this._initBody=function(e){var t;this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:i&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:s&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:n&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():o&&i&&(t=e)&&DataView.prototype.isPrototypeOf(t)?(this._bodyArrayBuffer=m(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):o&&(ArrayBuffer.prototype.isPrototypeOf(e)||c(e))?this._bodyArrayBuffer=m(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},i&&(this.blob=function(){var e=p(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?p(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(g)}),this.text=function(){var e,t,n,r=p(this);if(r)return r;if(this._bodyBlob)return e=this._bodyBlob,n=f(t=new FileReader),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},s&&(this.formData=function(){return this.text().then(S)}),this.json=function(){return this.text().then(JSON.parse)},this}d.prototype.append=function(e,t){e=l(e),t=u(t);var n=this.map[e];this.map[e]=n?n+", "+t:t},d.prototype.delete=function(e){delete this.map[l(e)]},d.prototype.get=function(e){return e=l(e),this.has(e)?this.map[e]:null},d.prototype.has=function(e){return this.map.hasOwnProperty(l(e))},d.prototype.set=function(e,t){this.map[l(e)]=u(t)},d.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},d.prototype.keys=function(){var e=[];return this.forEach((function(t,n){e.push(n)})),h(e)},d.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),h(e)},d.prototype.entries=function(){var e=[];return this.forEach((function(t,n){e.push([n,t])})),h(e)},r&&(d.prototype[Symbol.iterator]=d.prototype.entries);var v=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function b(e,t){var n,r,i=(t=t||{}).body;if(e instanceof b){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new d(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new d(t.headers)),this.method=(r=(n=t.method||this.method||"GET").toUpperCase(),v.indexOf(r)>-1?r:n),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function S(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(i))}})),t}function w(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new d(t.headers),this.url=t.url||"",this._initBody(e)}b.prototype.clone=function(){return new b(this,{body:this._bodyInit})},y.call(b.prototype),y.call(w.prototype),w.prototype.clone=function(){return new w(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},w.error=function(){var e=new w(null,{status:0,statusText:""});return e.type="error",e};var x=[301,302,303,307,308];w.redirect=function(e,t){if(-1===x.indexOf(t))throw new RangeError("Invalid status code");return new w(null,{status:t,headers:{location:e}})},t.DOMException=e.DOMException;try{new t.DOMException}catch(e){t.DOMException=function(e,t){this.message=e,this.name=t;var n=Error(e);this.stack=n.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function C(e,n){return new Promise((function(r,s){var o=new b(e,n);if(o.signal&&o.signal.aborted)return s(new t.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function c(){a.abort()}a.onload=function(){var e,t,n={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new d,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var n=e.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();t.append(r,i)}})),t)};n.url="responseURL"in a?a.responseURL:n.headers.get("X-Request-URL");var i="response"in a?a.response:a.responseText;r(new w(i,n))},a.onerror=function(){s(new TypeError("Network request failed"))},a.ontimeout=function(){s(new TypeError("Network request failed"))},a.onabort=function(){s(new t.DOMException("Aborted","AbortError"))},a.open(o.method,o.url,!0),"include"===o.credentials?a.withCredentials=!0:"omit"===o.credentials&&(a.withCredentials=!1),"responseType"in a&&i&&(a.responseType="blob"),o.headers.forEach((function(e,t){a.setRequestHeader(t,e)})),o.signal&&(o.signal.addEventListener("abort",c),a.onreadystatechange=function(){4===a.readyState&&o.signal.removeEventListener("abort",c)}),a.send(void 0===o._bodyInit?null:o._bodyInit)}))}C.polyfill=!0,e.fetch||(e.fetch=C,e.Headers=d,e.Request=b,e.Response=w),t.Headers=d,t.Request=b,t.Response=w,t.fetch=C,Object.defineProperty(t,"__esModule",{value:!0})}({})}(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var i=r;(t=i.fetch).default=i.fetch,t.fetch=i.fetch,t.Headers=i.Headers,t.Request=i.Request,t.Response=i.Response,e.exports=t},2296:(e,t,n)=>{"use strict";var r=n(3596)(),i=n(210),s=r&&i("%Object.defineProperty%",!0);if(s)try{s({},"a",{value:1})}catch(e){s=!1}var o=i("%SyntaxError%"),a=i("%TypeError%"),c=n(7296);e.exports=function(e,t,n){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new a("`obj` must be an object or a function`");if("string"!=typeof t&&"symbol"!=typeof t)throw new a("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new a("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new a("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new a("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new a("`loose`, if provided, must be a boolean");var r=arguments.length>3?arguments[3]:null,i=arguments.length>4?arguments[4]:null,l=arguments.length>5?arguments[5]:null,u=arguments.length>6&&arguments[6],h=!!c&&c(e,t);if(s)s(e,t,{configurable:null===l&&h?h.configurable:!l,enumerable:null===r&&h?h.enumerable:!r,value:n,writable:null===i&&h?h.writable:!i});else{if(!u&&(r||i||l))throw new o("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");e[t]=n}}},7237:e=>{"use strict";function t(e){if(this._capacity=r(e),this._length=0,this._front=0,n(e)){for(var t=e.length,i=0;i<t;++i)this[i]=e[i];this._length=t}}t.prototype.toArray=function(){for(var e=this._length,t=new Array(e),n=this._front,r=this._capacity,i=0;i<e;++i)t[i]=this[n+i&r-1];return t},t.prototype.push=function(e){var t=arguments.length,n=this._length;if(t>1){var r=this._capacity;if(n+t>r){for(var i=0;i<t;++i)this._checkCapacity(n+1),this[s=this._front+n&this._capacity-1]=arguments[i],n++,this._length=n;return n}var s=this._front;for(i=0;i<t;++i)this[s+n&r-1]=arguments[i],s++;return this._length=n+t,n+t}return 0===t?n:(this._checkCapacity(n+1),this[i=this._front+n&this._capacity-1]=e,this._length=n+1,n+1)},t.prototype.pop=function(){var e=this._length;if(0!==e){var t=this._front+e-1&this._capacity-1,n=this[t];return this[t]=void 0,this._length=e-1,n}},t.prototype.shift=function(){var e=this._length;if(0!==e){var t=this._front,n=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length=e-1,n}},t.prototype.unshift=function(e){var t=this._length,n=arguments.length;if(n>1){if(t+n>(i=this._capacity)){for(var r=n-1;r>=0;r--){this._checkCapacity(t+1);var i=this._capacity;this[o=(this._front-1&i-1^i)-i]=arguments[r],t++,this._length=t,this._front=o}return t}var s=this._front;for(r=n-1;r>=0;r--){var o;this[o=(s-1&i-1^i)-i]=arguments[r],s=o}return this._front=s,this._length=t+n,t+n}return 0===n?t:(this._checkCapacity(t+1),i=this._capacity,this[r=(this._front-1&i-1^i)-i]=e,this._length=t+1,this._front=r,t+1)},t.prototype.peekBack=function(){var e=this._length;if(0!==e)return this[this._front+e-1&this._capacity-1]},t.prototype.peekFront=function(){if(0!==this._length)return this[this._front]},t.prototype.get=function(e){var t=e;if(t===(0|t)){var n=this._length;if(t<0&&(t+=n),!(t<0||t>=n))return this[this._front+t&this._capacity-1]}},t.prototype.isEmpty=function(){return 0===this._length},t.prototype.clear=function(){for(var e=this._length,t=this._front,n=this._capacity,r=0;r<e;++r)this[t+r&n-1]=void 0;this._length=0,this._front=0},t.prototype.toString=function(){return this.toArray().toString()},t.prototype.valueOf=t.prototype.toString,t.prototype.removeFront=t.prototype.shift,t.prototype.removeBack=t.prototype.pop,t.prototype.insertFront=t.prototype.unshift,t.prototype.insertBack=t.prototype.push,t.prototype.enqueue=t.prototype.push,t.prototype.dequeue=t.prototype.shift,t.prototype.toJSON=t.prototype.toArray,Object.defineProperty(t.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}}),t.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(r(1.5*this._capacity+16))},t.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var n=this._front,r=this._length;n+r>t&&function(e,t,n,r,i){for(var s=0;s<i;++s)n[s+r]=e[s+0],e[s+0]=void 0}(this,0,this,t,n+r&t-1)};var n=Array.isArray;function r(e){if("number"!=typeof e){if(!n(e))return 16;e=e.length}return t=Math.min(Math.max(16,e),1073741824),t>>>=0,t-=1,t|=t>>1,t|=t>>2,t|=t>>4,1+((t|=t>>8)|t>>16);var t}e.exports=t},7187:e=>{"use strict";var t,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,s),r(n)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}g(e,t,s,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&g(e,"error",t,{once:!0})}(e,i)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function l(e,t,n,r){var i,s,o,l;if(a(n),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),o=s[t]),void 0===o)o=s[t]=n,++e._eventsCount;else if("function"==typeof o?o=s[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),(i=c(e))>0&&o.length>i&&!o.warned){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,l=u,console&&console.warn&&console.warn(l)}return e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=u.bind(r);return i.listener=n,r.wrapFn=i,i}function d(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):f(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function f(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function g(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(s){r.once&&e.removeEventListener(t,i),n(s)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,s=this._events;if(void 0!==s)i=i&&void 0===s.error;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(void 0===c)return!1;if("function"==typeof c)r(c,this,t);else{var l=c.length,u=f(c,l);for(n=0;n<l;++n)r(u[n],this,t)}return!0},s.prototype.addListener=function(e,t){return l(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return l(this,e,t,!0)},s.prototype.once=function(e,t){return a(t),this.on(e,h(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,h(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,r,i,s,o;if(a(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){o=n[s].listener,i=s;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,s=Object.keys(n);for(r=0;r<s.length;++r)"removeListener"!==(i=s[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},s.prototype.listeners=function(e){return d(this,e,!0)},s.prototype.rawListeners=function(e){return d(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},s.prototype.listenerCount=p,s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},2580:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AttachState:()=>r.mB,ConnectionState:()=>s.e,ContainerErrorType:()=>i.u,DOProviderContainerRuntimeFactory:()=>c.Y,DirectoryFactory:()=>h.y,DriverErrorType:()=>o.C,FluidContainer:()=>a.G,Interval:()=>te,IntervalCollection:()=>fe,IntervalCollectionIterator:()=>pe,IntervalType:()=>ee,LocalValueMaker:()=>d.oU,MapFactory:()=>u.c,PaddingSegment:()=>$t,RootDataObject:()=>c.i,RunSegment:()=>Jt,SequenceDeltaEvent:()=>Ft,SequenceEvent:()=>It,SequenceInterval:()=>ne,SequenceMaintenanceEvent:()=>Dt,ServiceAudience:()=>l.c,SharedDirectory:()=>h.u,SharedIntervalCollection:()=>ln,SharedIntervalCollectionFactory:()=>cn,SharedMap:()=>u.G,SharedNumberSequence:()=>Ht,SharedNumberSequenceFactory:()=>Wt,SharedObjectSequence:()=>Ut,SharedObjectSequenceFactory:()=>Gt,SharedSegmentSequence:()=>qt,SharedSequence:()=>zt,SharedString:()=>Kt,SharedStringFactory:()=>Vt,SparseMatrix:()=>rn,SparseMatrixFactory:()=>sn,SubSequence:()=>jt,maxCellPosition:()=>en,maxCol:()=>Qt,maxCols:()=>Xt,maxRow:()=>Zt,maxRows:()=>Yt,positionToRowCol:()=>nn,rowColToPosition:()=>tn});var r=n(3738),i=n(7819),s=n(1434),o=n(2505),a=n(1),c=n(2434),l=n(9074),u=n(5759),h=n(7648),d=n(3080);function p(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}var f=n(7187);class g extends f.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}var m,y=n(9268);!function(e){e[e.Simple=0]="Simple",e[e.Tile=1]="Tile",e[e.NestBegin=2]="NestBegin",e[e.NestEnd=4]="NestEnd",e[e.RangeBegin=16]="RangeBegin",e[e.RangeEnd=32]="RangeEnd",e[e.SlideOnRemove=64]="SlideOnRemove",e[e.StayOnRemove=128]="StayOnRemove",e[e.Transient=256]="Transient"}(m||(m={}));const v={INSERT:0,REMOVE:1,ANNOTATE:2,GROUP:3},b="referenceRangeLabels";function S(e,t){return 0!=(("number"==typeof e?e:e.refType)&t)}const w=e=>S(e,m.Tile)&&e.properties?e.properties.referenceTileLabels:void 0,x=e=>S(e,m.NestBegin|m.NestEnd)&&e.properties?e.properties[b]:void 0;function C(e,t){const n=w(e);if(n)for(const e of n)if(t===e)return!0;return!1}function E(e,t){const n=x(e);if(n)for(const e of n)if(t===e)return!0;return!1}function T(e){return void 0!==w(e)}function A(e){return void 0!==x(e)}function k(e,t){const n=e.getSegment(),r=t.getSegment();return n===r?e.getOffset()-t.getOffset():void 0===n||void 0!==r&&n.ordinal<r.ordinal?-1:1}function N(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}const O=-1,P=-2,R=-1,I=-2;function F(e,t,n,r){let i=t;switch(void 0===i&&(i=e.defaultValue),e.name){case"incr":i+=n,e.minValue&&i<e.minValue&&(i=e.minValue);break;case"consensus":if(void 0===i)i={value:n,seq:r};else{const e=i;-1===e.seq&&(e.seq=r)}}return i}function D(e,t){if(e){if(!t)return!1;for(const n in e){if(void 0===t[n])return!1;if("object"==typeof t[n]){if(!D(e[n],t[n]))return!1}else if(t[n]!==e[n])return!1}for(const n in t)if(void 0===e[n])return!1}else if(t)return!1;return!0}function M(e,t,n,r){if(void 0!==t)for(const i in t){const s=t[i];null===s?delete e[i]:n&&"rewrite"!==n.name?e[i]=F(n,e[i],s,r):e[i]=s}return e}function L(e,t,n,r){let i=e;return(!i||n&&"rewrite"===n.name)&&(i=_()),M(i,t,n,r),i}function _(){return Object.create(null)}class q{constructor(){this.pendingRewriteCount=0}ackPendingProperties(e){var t,n;e.combiningOp&&"rewrite"===e.combiningOp.name&&this.pendingRewriteCount--;for(const r of Object.keys(e.props))void 0!==(null===(t=this.pendingKeyUpdateCount)||void 0===t?void 0:t[r])&&(N(this.pendingKeyUpdateCount[r]>0,92),this.pendingKeyUpdateCount[r]--,0===(null===(n=this.pendingKeyUpdateCount)||void 0===n?void 0:n[r])&&delete this.pendingKeyUpdateCount[r])}addProperties(e,t,n,r,i=!1){var s;if(this.pendingKeyUpdateCount||(this.pendingKeyUpdateCount=_()),this.pendingRewriteCount>0&&r!==O&&i)return;const o=n&&"rewrite"===n.name,a=o?void 0:n||void 0,c=e=>{var t;return!(r!==O&&void 0!==(null===(t=this.pendingKeyUpdateCount)||void 0===t?void 0:t[e])&&!a)},l={};if(o){i&&r===O&&this.pendingRewriteCount++;for(const n of Object.keys(e))!t[n]&&c(n)&&(l[n]=e[n],delete e[n])}for(const n of Object.keys(t)){if(i)if(r===O)void 0===(null===(s=this.pendingKeyUpdateCount)||void 0===s?void 0:s[n])&&(this.pendingKeyUpdateCount[n]=0),this.pendingKeyUpdateCount[n]++;else if(!c(n))continue;const o=e[n];let u;l[n]=void 0===o?null:o,u=a?F(a,o,u,r):t[n],null===u?delete e[n]:e[n]=u}return l}copyTo(e,t,n){if(e){if(t||(t=_()),!n)throw new Error("Must provide new PropertyManager");for(const n of Object.keys(e))t[n]=e[n];n.pendingRewriteCount=this.pendingRewriteCount,n.pendingKeyUpdateCount=_();for(const e of Object.keys(this.pendingKeyUpdateCount))n.pendingKeyUpdateCount[e]=this.pendingKeyUpdateCount[e]}return t}hasPendingProperties(){return this.pendingRewriteCount>0||Object.keys(this.pendingKeyUpdateCount).length>0}}class B{constructor(){this.items=[]}push(e){this.items.push(e)}empty(){return 0===this.items.length}top(){return this.items[this.items.length-1]}pop(){return this.items.pop()}}function j(e){if(void 0!==e&&!e.isHead)return e.next.prev=e.prev,e.prev.next=e.next,e}function z(e){return new U(!1,e)}function H(){return new U(!0,void 0)}class U{constructor(e,t){this.isHead=e,this.data=t,this.prev=this,this.next=this}clear(){this.isHead&&(this.prev=this,this.next=this)}add(e){const t=z(e);return this.prev.next=t,t.next=this,t.prev=this.prev,this.prev=t,t}dequeue(){if(!this.empty())return j(this.next).data}enqueue(e){return this.add(e)}walk(e){for(let t=this.next;!t.isHead;t=t.next)e(t.data,t)}some(e,t){const n=[];for(let r=t?this.prev:this.next;!r.isHead;r=t?r.prev:r.next){const i=r.data;e(i,r)&&(t?n.unshift(i):n.push(i))}return n}count(){let e,t;for(e=this.next,t=0;!e.isHead;t++)e=e.next;return t}first(){if(!this.empty())return this.next.data}last(){if(!this.empty())return this.prev.data}empty(){return this.next===this}push(e){this.unshift(e)}unshift(e){const t=z(e);t.data=e,t.isHead=!1,t.next=this.next,t.prev=this,this.next=t,t.next.prev=t}[Symbol.iterator](){let e=this;return{next(){for(;e&&!1===e.next.isHead;)if(e=e.next,void 0!==e.data)return{value:e.data,done:!1};return{value:void 0,done:!0}},[Symbol.iterator](){return this}}}}class V{constructor(e,t){this.comp=t,this.L=[t.min];for(let t=0,n=e.length;t<n;t++)this.add(e[t])}count(){return this.L.length-1}peek(){return this.L[1]}get(){const e=this.L[1];return this.L[1]=this.L[this.count()],this.L.pop(),this.fixDown(1),e}add(e){this.L.push(e),this.fixup(this.count())}fixup(e){let t=e;for(;t>1&&this.comp.compare(this.L[t>>1],this.L[t])>0;){const e=this.L[t>>1];this.L[t>>1]=this.L[t],this.L[t]=e,t>>=1}}fixDown(e){let t=e;for(;t<<1<=this.count();){let e=t<<1;if(e<this.count()&&this.comp.compare(this.L[e],this.L[e+1])>0&&e++,this.comp.compare(this.L[t],this.L[e])<=0)break;const n=this.L[t];this.L[t]=this.L[e],this.L[e]=n,t=e}}}class G{constructor(e,t){this.compareKeys=e,this.aug=t}makeNode(e,t,n,r){return{key:e,data:t,color:n,size:r}}isRed(e){return!!e&&0===e.color}nodeSize(e){return e?e.size:0}size(){return this.nodeSize(this.root)}isEmpty(){return!this.root}get(e){if(void 0!==e)return this.nodeGet(this.root,e)}nodeGet(e,t){let n=e;for(;n;){const e=this.compareKeys(t,n.key);if(e<0)n=n.left;else{if(!(e>0))return n;n=n.right}}}contains(e){return this.get(e)}gather(e,t){const n=[];return void 0!==e&&this.nodeGather(this.root,n,e,t),n}nodeGather(e,t,n,r){e&&(r.continueSubtree(e.left,n)&&this.nodeGather(e.left,t,n,r),r.matchNode(e,n)&&t.push(e),r.continueSubtree(e.right,n)&&this.nodeGather(e.right,t,n,r))}walkExactMatchesForward(e,t,n,r){this.nodeWalkExactMatchesForward(this.root,e,t,n,r)}nodeWalkExactMatchesForward(e,t,n,r,i){if(!e)return;const s=t(e);r(s)&&this.nodeWalkExactMatchesForward(e.left,t,n,r,i),0===s&&n(e),i(s)&&this.nodeWalkExactMatchesForward(e.right,t,n,r,i)}walkExactMatchesBackward(e,t,n,r){this.nodeWalkExactMatchesBackward(this.root,e,t,n,r)}nodeWalkExactMatchesBackward(e,t,n,r,i){if(!e)return;const s=t(e);i(s)&&this.nodeWalkExactMatchesBackward(e.right,t,n,r,i),0===s&&n(e),r(s)&&this.nodeWalkExactMatchesBackward(e.left,t,n,r,i)}put(e,t,n){void 0!==e&&(void 0===t?this.remove(e):(this.root=this.nodePut(this.root,e,t,n),this.root.color=1))}nodePut(e,t,n,r){let i=e;if(i){const e=this.compareKeys(t,i.key);if(e<0)i.left=this.nodePut(i.left,t,n,r);else if(e>0)i.right=this.nodePut(i.right,t,n,r);else if(r){const e=r(t,i.key,n,i.data);e.key&&(i.key=e.key),e.data?i.data=e.data:i.data=n}else i.data=n;return this.isRed(i.right)&&!this.isRed(i.left)&&(i=this.rotateLeft(i)),this.isRed(i.left)&&this.isRed(i.left.left)&&(i=this.rotateRight(i)),this.isRed(i.left)&&this.isRed(i.right)&&this.flipColors(i),i.size=this.nodeSize(i.left)+this.nodeSize(i.right)+1,this.aug&&this.updateLocal(i),i}return this.makeNode(t,n,0,1)}updateLocal(e){this.aug&&(this.isRed(e.left)&&this.aug.update(e.left),this.isRed(e.right)&&this.aug.update(e.right),this.aug.update(e))}nodeRemoveMin(e){let t=e;if(t.left)return this.isRed(t.left)||this.isRed(t.left.left)||(t=this.moveRedLeft(t)),t.left=this.nodeRemoveMin(t.left),this.balance(t)}remove(e){if(void 0!==e){if(!this.contains(e))return;this.removeExisting(e)}}removeExisting(e){this.isRed(this.root.left)||this.isRed(this.root.right)||(this.root.color=0),this.root=this.nodeRemove(this.root,e)}nodeRemove(e,t){let n=e;if(this.compareKeys(t,n.key)<0)this.isRed(n.left)||this.isRed(n.left.left)||(n=this.moveRedLeft(n)),n.left=this.nodeRemove(n.left,t);else{if(this.isRed(n.left)&&(n=this.rotateRight(n)),0===this.compareKeys(t,n.key)&&!n.right)return;if(this.isRed(n.right)||this.isRed(n.right.left)||(n=this.moveRedRight(n)),0===this.compareKeys(t,n.key)){const e=this.nodeMin(n.right);n.key=e.key,n.data=e.data,n.right=this.nodeRemoveMin(n.right)}else n.right=this.nodeRemove(n.right,t)}return this.balance(n)}floor(e){if(!this.isEmpty())return this.nodeFloor(this.root,e)}nodeFloor(e,t){if(e){const n=this.compareKeys(t,e.key);if(0===n)return e;if(n<0)return this.nodeFloor(e.left,t);return this.nodeFloor(e.right,t)||e}}ceil(e){if(!this.isEmpty())return this.nodeCeil(this.root,e)}nodeCeil(e,t){if(e){const n=this.compareKeys(t,e.key);if(0===n)return e;if(n>0)return this.nodeCeil(e.right,t);return this.nodeCeil(e.left,t)||e}}min(){if(this.root)return this.nodeMin(this.root)}nodeMin(e){return e.left?this.nodeMin(e.left):e}max(){if(this.root)return this.nodeMax(this.root)}nodeMax(e){return e.right?this.nodeMax(e.right):e}rotateRight(e){const t=e.left;return e.left=t.right,t.right=e,t.color=t.right.color,t.right.color=0,t.size=e.size,e.size=this.nodeSize(e.left)+this.nodeSize(e.right)+1,this.aug&&(this.updateLocal(e),this.updateLocal(t)),t}rotateLeft(e){const t=e.right;return e.right=t.left,t.left=e,t.color=t.left.color,t.left.color=0,t.size=e.size,e.size=this.nodeSize(e.left)+this.nodeSize(e.right)+1,this.aug&&(this.updateLocal(e),this.updateLocal(t)),t}oppositeColor(e){return 1===e?0:1}flipColors(e){e.color=this.oppositeColor(e.color),e.left.color=this.oppositeColor(e.left.color),e.right.color=this.oppositeColor(e.right.color)}moveRedLeft(e){let t=e;return this.flipColors(t),this.isRed(t.right.left)&&(t.right=this.rotateRight(t.right),t=this.rotateLeft(t),this.flipColors(t)),t}moveRedRight(e){let t=e;return this.flipColors(t),this.isRed(t.left.left)&&(t=this.rotateRight(t),this.flipColors(t)),t}balance(e){let t=e;return this.isRed(t.right)&&(t=this.rotateLeft(t)),this.isRed(t.left)&&this.isRed(t.left.left)&&(t=this.rotateRight(t)),this.isRed(t.left)&&this.isRed(t.right)&&this.flipColors(t),t.size=this.nodeSize(t.left)+this.nodeSize(t.right)+1,this.aug&&this.aug.update(t),t}mapRange(e,t,n,r){this.nodeMap(this.root,e,n,r)}map(e,t){this.nodeMap(this.root,e,t)}keys(){const e=[],t={showStructure:!0,infix:t=>(e.push(t.key),!0)};return this.walk(t),e}walk(e){this.nodeWalk(this.root,e)}walkBackward(e){this.nodeWalkBackward(this.root,e)}nodeWalk(e,t){let n=!0;return e&&(t.pre&&(t.showStructure||1===e.color)&&(n=t.pre(e)),e.left&&(n=this.nodeWalk(e.left,t)),n&&t.infix&&(t.showStructure||1===e.color)&&(n=t.infix(e)),n&&(n=this.nodeWalk(e.right,t)),n&&t.post&&(t.showStructure||1===e.color)&&(n=t.post(e))),n}nodeWalkBackward(e,t){let n=!0;return e&&(t.pre&&(t.showStructure||1===e.color)&&(n=t.pre(e)),e.right&&(n=this.nodeWalkBackward(e.right,t)),n&&t.infix&&(t.showStructure||1===e.color)&&(n=t.infix(e)),n&&(n=this.nodeWalkBackward(e.left,t)),n&&t.post&&(t.showStructure||1===e.color)&&(n=t.post(e))),n}nodeMap(e,t,n,r,i){let s=r,o=i;if(!e)return!0;void 0===s&&(s=this.nodeMin(e).key),void 0===o&&(o=this.nodeMax(e).key);const a=this.compareKeys(s,e.key),c=this.compareKeys(o,e.key);let l=!0;return a<0&&(l=this.nodeMap(e.left,t,n,s,o)),l&&a<=0&&c>=0&&(l=t(e,n)),l&&c>0&&(l=this.nodeMap(e.right,t,n,s,o)),l}}const W=(e,t)=>e.compare(t);class K{constructor(){this.intervals=new G(W,this)}remove(e){this.intervals.remove(e)}removeExisting(e){this.intervals.removeExisting(e)}put(e,t){let n;t&&(n=(e,n)=>({key:t(e,n)})),this.intervals.put(e,{minmax:e.clone()},n)}map(e){const t={infix:t=>(e(t.key),!0),showStructure:!0};this.intervals.walk(t)}mapUntil(e){const t={infix:t=>e(t.key),showStructure:!0};this.intervals.walk(t)}mapBackward(e){const t={infix:t=>(e(t.key),!0),showStructure:!0};this.intervals.walkBackward(t)}match(e){return this.intervals.gather(e,this)}matchNode(e,t){return!!e&&e.key.overlaps(t)}continueSubtree(e,t){return!!e&&e.data.minmax.overlaps(t)}update(e){e.left&&e.right?e.data.minmax=e.key.union(e.left.data.minmax.union(e.right.data.minmax)):e.left?e.data.minmax=e.key.union(e.left.data.minmax):e.right?e.data.minmax=e.key.union(e.right.data.minmax):e.data.minmax=e.key.clone()}}class ${constructor(e,t,n=0,r=m.Simple,i){this.client=e,this.offset=n,this.refType=r,function(e){let t=0;if(S(e,m.Transient)&&++t,S(e,m.SlideOnRemove)&&++t,S(e,m.StayOnRemove)&&++t,t>1)throw new y.Oi("Reference types can only be one of Transient, SlideOnRemove, and StayOnRemove")}(r),this.segment=t,this.properties=i}min(e){return function(e,t){return k(e,t)<0?e:t}(this,e)}max(e){return function(e,t){return k(e,t)>0?e:t}(this,e)}compare(e){return k(this,e)}toPosition(){return this.getClient().localReferencePositionToPosition(this)}hasTileLabels(){return T(this)}hasRangeLabels(){return A(this)}hasTileLabel(e){return C(this,e)}hasRangeLabel(e){return E(this,e)}getTileLabels(){return w(this)}getRangeLabels(){return x(this)}isLeaf(){return!1}addProperties(e,t){this.properties=L(this.properties,e,t)}getClient(){return this.client}getSegment(){return this.segment}getOffset(){return this.offset}getProperties(){return this.properties}}function J(e){N(e instanceof $,736)}$.DetachedPosition=-1;class Q{constructor(e,t=new Array(e.cachedLength)){this.segment=e,this.hierRefCount=0,this.refCount=0,this.refsByOffset=t}static append(e,t){t.localRefs&&!t.localRefs.empty?(e.localRefs||(e.localRefs=new Q(e)),N(e.localRefs.refsByOffset.length===e.cachedLength,702),e.localRefs.append(t.localRefs)):e.localRefs&&(e.localRefs.refsByOffset.length+=t.cachedLength)}[Symbol.iterator](){const e=[];for(const t of this.refsByOffset)t&&(t.before&&e.push(t.before[Symbol.iterator]()),t.at&&e.push(t.at[Symbol.iterator]()),t.after&&e.push(t.after[Symbol.iterator]()));return{next(){for(;e.length>0;){const t=e[0].next();if(!0!==t.done)return t;e.shift()}return{value:void 0,done:!0}},[Symbol.iterator](){return this}}}clear(){this.refCount=0,this.hierRefCount=0;const e=e=>{if(e)for(const t of e)t.segment===this.segment&&(t.segment=void 0)};for(let t=0;t<this.refsByOffset.length;t++){const n=this.refsByOffset[t];n&&(e(n.before),e(n.at),e(n.before),this.refsByOffset[t]=void 0)}}get empty(){return 0===this.refCount}createLocalRef(e,t,n,r){const i=new $(r,this.segment,e,t,n);return S(i,m.Transient)||this.addLocalRef(i),i}addLocalRef(e){var t,n;N(!S(e,m.Transient),735),J(e);const r=this.refsByOffset[e.offset]=null!==(t=this.refsByOffset[e.offset])&&void 0!==t?t:{at:H()};(r.at=null!==(n=r.at)&&void 0!==n?n:H()).enqueue(e),(A(e)||T(e))&&this.hierRefCount++,this.refCount++}removeLocalRef(e){J(e);const t=t=>{if(t){let n=t;do{if(n=n.next,n.data===e)return j(n),(A(e)||T(e))&&this.hierRefCount--,this.refCount--,e}while(!n.isHead)}},n=this.refsByOffset[e.offset];if(void 0!==n){let e=t(n.before);if(e)return e;if(e=t(n.at),e)return e;if(e=t(n.after),e)return e}}append(e){if(e&&!e.empty){this.hierRefCount+=e.hierRefCount,this.refCount+=e.refCount,e.hierRefCount=0;for(const t of e)t.segment=this.segment,t.offset+=this.refsByOffset.length;this.refsByOffset.push(...e.refsByOffset)}}split(e,t){if(this.empty)this.refsByOffset.length=e;else{const n=new Q(t,this.refsByOffset.splice(e,this.refsByOffset.length-e));t.localRefs=n;for(const r of n)r.segment=t,r.offset-=e,(A(r)||T(r))&&(this.hierRefCount--,n.hierRefCount++),this.refCount--,n.refCount++}}addBeforeTombstones(...e){var t,n,r,i,s;const o=null!==(n=null===(t=this.refsByOffset[0])||void 0===t?void 0:t.before)&&void 0!==n?n:H();for(const t of e)for(const e of t)J(e),S(e,m.SlideOnRemove)?(o.push(e),e.segment=this.segment,e.offset=0,(A(e)||T(e))&&this.hierRefCount++,this.refCount++):e.segment=void 0;if(!o.empty()&&void 0===(null===(r=this.refsByOffset[0])||void 0===r?void 0:r.before)){const e=this.refsByOffset[0]=null!==(i=this.refsByOffset[0])&&void 0!==i?i:{before:o};e.before=null!==(s=e.before)&&void 0!==s?s:o}}addAfterTombstones(...e){var t,n,r,i,s;const o=this.refsByOffset.length-1,a=null!==(n=null===(t=this.refsByOffset[o])||void 0===t?void 0:t.after)&&void 0!==n?n:H();for(const t of e)for(const e of t)J(e),S(e,m.SlideOnRemove)?(a.push(e),e.segment=this.segment,e.offset=this.segment.cachedLength-1,(A(e)||T(e))&&this.hierRefCount++,this.refCount++):e.segment=void 0;if(!a.empty()&&void 0===(null===(r=this.refsByOffset[o])||void 0===r?void 0:r.after)){const e=this.refsByOffset[o]=null!==(i=this.refsByOffset[o])&&void 0!==i?i:{after:a};e.after=null!==(s=e.after)&&void 0!==s?s:a}}}var X=n(2718),Z=n(2045);const Y="intervalId";var ee;!function(e){e[e.Simple=0]="Simple",e[e.Nest=1]="Nest",e[e.SlideOnRemove=2]="SlideOnRemove",e[e.Transient=4]="Transient"}(ee||(ee={}));class te{constructor(e,t,n){this.start=e,this.end=t,this.propertyManager=new q,this.properties={},n&&this.addProperties(n)}getIntervalId(){var e;const t=null===(e=this.properties)||void 0===e?void 0:e[Y];if(void 0!==t)return`${t}`}getAdditionalPropertySets(){return this.auxProps}addPropertySet(e){void 0===this.auxProps&&(this.auxProps=[]),this.auxProps.push(e)}serialize(e){let t=0;e&&(t=e.getCurrentSeq());const n={end:this.end,intervalType:0,sequenceNumber:t,start:this.start};return this.properties&&(n.properties=this.properties),n}clone(){return new te(this.start,this.end,this.properties)}compare(e){const t=this.compareStart(e);if(0===t){const t=this.compareEnd(e);if(0===t){const t=this.getIntervalId();if(t){const n=e.getIntervalId();return n?t>n?1:t<n?-1:0:0}return 0}return t}return t}compareStart(e){return this.start-e.start}compareEnd(e){return this.end-e.end}overlaps(e){return this.start<=e.end&&this.end>=e.start}union(e){return new te(Math.min(this.start,e.start),Math.max(this.end,e.end),this.properties)}getProperties(){return this.properties}addProperties(e,t=!1,n,r){if(e)return this.initializeProperties(),this.propertyManager.addProperties(this.properties,e,r,n,t)}modify(e,t,n,r){const i=null!=t?t:this.start,s=null!=n?n:this.end;if(this.start===i&&this.end===s)return;const o=new te(i,s);return this.properties&&(o.initializeProperties(),this.propertyManager.copyTo(this.properties,o.properties,o.propertyManager)),o}initializeProperties(){this.propertyManager||(this.propertyManager=new q),this.properties||(this.properties=_())}}class ne{constructor(e,t,n,r){this.start=e,this.end=t,this.intervalType=n,this.propertyManager=new q,this.properties={},r&&this.addProperties(r)}addPositionChangeListeners(e,t){var n,r,i,s;if(void 0===this.callbacks){this.callbacks={beforePositionChange:e,afterPositionChange:t};const o=null!==(n=(i=this.start).callbacks)&&void 0!==n?n:i.callbacks={},a=null!==(r=(s=this.end).callbacks)&&void 0!==r?r:s.callbacks={};o.beforeSlide=a.beforeSlide=e,o.afterSlide=a.afterSlide=t}}removePositionChangeListeners(){this.callbacks&&(this.callbacks=void 0,this.start.callbacks=void 0,this.end.callbacks=void 0)}serialize(e){const t=this.start.toPosition(),n={end:this.end.toPosition(),intervalType:this.intervalType,sequenceNumber:e.getCurrentSeq(),start:t};return this.properties&&(n.properties=this.properties),n}clone(){return new ne(this.start,this.end,this.intervalType,this.properties)}compare(e){const t=this.compareStart(e);if(0===t){const t=this.compareEnd(e);if(0===t){const t=this.getIntervalId();if(t){const n=e.getIntervalId();return n?t>n?1:t<n?-1:0:0}return 0}return t}return t}compareStart(e){return this.start.compare(e.start)}compareEnd(e){return this.end.compare(e.end)}overlaps(e){return this.start.compare(e.end)<=0&&this.end.compare(e.start)>=0}getIntervalId(){var e;const t=null===(e=this.properties)||void 0===e?void 0:e[Y];if(void 0!==t)return`${t}`}union(e){return new ne(this.start.min(e.start),this.end.max(e.end),this.intervalType)}addProperties(e,t=!1,n,r){return this.initializeProperties(),this.propertyManager.addProperties(this.properties,e,r,n,t)}overlapsPos(e,t){const n=this.start.toPosition();return this.start.toPosition()>e&&n<t}modify(e,t,n,r){const i=e=>{let t=e;return void 0===r&&(t&=~m.SlideOnRemove,t|=m.StayOnRemove),t};let s=this.start;void 0!==t&&(s=ie(this.start.getClient(),t,i(this.start.refType),r),s.addProperties(this.start.properties));let o=this.end;void 0!==n&&(o=ie(this.end.getClient(),n,i(this.end.refType),r),o.addProperties(this.end.properties)),s.pairedRef=o,o.pairedRef=s;const a=new ne(s,o,this.intervalType);return this.properties&&(a.initializeProperties(),this.propertyManager.copyTo(this.properties,a.properties,a.propertyManager)),a}initializeProperties(){this.propertyManager||(this.propertyManager=new q),this.properties||(this.properties=_())}}function re(e,t,n,r){if(t.segment)return e.createLocalReferencePosition(t.segment,t.offset,n,void 0);if(!r&&!S(n,m.Transient))throw new y.Oi("Non-transient references need segment");return new $(e,void 0,0,n)}function ie(e,t,n,r){let i;return r?(p(0!=(n&m.SlideOnRemove),757),i=e.getContainingSegment(t,r),i=e.getSlideToSegment(i)):(p(0==(n&m.SlideOnRemove),758),i=e.getContainingSegment(t)),re(e,i,n,r)}function se(e,t,n,r,i,s){let o=m.RangeBegin,a=m.RangeEnd;i===ee.Transient?(o=m.Transient,a=m.Transient):(i===ee.Nest&&(o=m.NestBegin,a=m.NestEnd),s?(o|=m.SlideOnRemove,a|=m.SlideOnRemove):(o|=m.StayOnRemove,a|=m.StayOnRemove));const c=ie(r,t,o,s),l=ie(r,n,a,s);c.pairedRef=l,l.pairedRef=c;const u={[b]:[e]};return c.addProperties(u),l.addProperties(u),new ne(c,l,i,u)}class oe{constructor(e,t,n,r){this.client=e,this.label=t,this.helpers=n,this.onPositionChange=r,this.intervalTree=new K,this.intervalIdMap=new Map,this.endIntervalTree=new G(n.compareEnds)}addConflictResolver(e){this.conflictResolver=e,this.endConflictResolver=(t,n)=>{const r=e(t,n);return{data:r,key:r}}}map(e){this.intervalTree.map(e)}createLegacyId(e,t){return`${oe.legacyIdPrefix}${e}-${t}`}ensureSerializedId(e){var t;let n=null===(t=e.properties)||void 0===t?void 0:t[Y];if(void 0===n){n=this.createLegacyId(e.start,e.end);const t={[Y]:n};e.properties=L(e.properties,t)}return Object.defineProperty(e.properties,Y,{configurable:!1,enumerable:!0,writable:!1}),n}mapUntil(e){this.intervalTree.mapUntil(e)}gatherIterationResults(e,t,n,r){if(!this.intervalTree.intervals.isEmpty())if(void 0===n&&void 0===r)t?this.intervalTree.map((t=>{e.push(t)})):this.intervalTree.mapBackward((t=>{e.push(t)}));else{const i=this.helpers.create("transient",n,r,this.client,ee.Transient);if(void 0===n)t?this.intervalTree.map((t=>{0===i.compareEnd(t)&&e.push(t)})):this.intervalTree.mapBackward((t=>{0===i.compareEnd(t)&&e.push(t)}));else{const n=void 0===r?e=>i.compareStart(e.key):e=>i.compare(e.key),s=e=>e<=0,o=e=>e>=0,a=t=>{e.push(t.key)};t?this.intervalTree.intervals.walkExactMatchesForward(n,a,s,o):this.intervalTree.intervals.walkExactMatchesBackward(n,a,s,o)}}}findOverlappingIntervals(e,t){if(t<e||this.intervalTree.intervals.isEmpty())return[];const n=this.helpers.create("transient",e,t,this.client,ee.Transient);return this.intervalTree.match(n).map((e=>e.key))}previousInterval(e){const t=this.helpers.create("transient",e,e,this.client,ee.Transient),n=this.endIntervalTree.floor(t);if(n)return n.data}nextInterval(e){const t=this.helpers.create("transient",e,e,this.client,ee.Transient),n=this.endIntervalTree.ceil(t);if(n)return n.data}removeInterval(e,t){const n=this.helpers.create("transient",e,t,this.client,ee.Transient);return this.intervalTree.remove(n),this.endIntervalTree.remove(n),n}removeIntervalFromIndex(e){this.intervalTree.removeExisting(e),this.endIntervalTree.remove(e);const t=e.getIntervalId();p(void 0!==t,785),this.intervalIdMap.delete(t)}removeExistingInterval(e){this.removeIntervalFromIndex(e),this.removeIntervalListeners(e)}createInterval(e,t,n,r){return this.helpers.create(this.label,e,t,this.client,n,r)}addInterval(e,t,n,r,i){const s=this.createInterval(e,t,n,i);return s&&(s.properties||(s.properties=_()),r&&s.addProperties(r),void 0===s.properties[Y]&&(s.properties[Y]=(0,Z.Z)()),this.add(s)),s}addIntervalToIndex(e){const t=e.getIntervalId();p(void 0!==t,704),Object.defineProperty(e.properties,Y,{configurable:!1,enumerable:!0,writable:!1}),this.intervalTree.put(e,this.conflictResolver),this.endIntervalTree.put(e,e,this.endConflictResolver),this.intervalIdMap.set(t,e)}add(e){this.addIntervalToIndex(e),this.addIntervalListeners(e)}getIntervalById(e){return this.intervalIdMap.get(e)}changeInterval(e,t,n,r){const i=e.modify(this.label,t,n,r);return i&&(this.removeExistingInterval(e),this.add(i)),i}serialize(){const e=this.client,t=this.intervalTree.intervals.keys();return{label:this.label,intervals:t.map((t=>function(e){const{start:t,end:n,sequenceNumber:r,intervalType:i,properties:s}=e;return[t,n,r,i,Object.assign(Object.assign({},s),{[b]:void 0})]}(t.serialize(e)))),version:2}}addIntervalListeners(e){e instanceof ne&&e.addPositionChangeListeners((()=>this.removeIntervalFromIndex(e)),(()=>{var t;this.addIntervalToIndex(e),null===(t=this.onPositionChange)||void 0===t||t.call(this,e)}))}removeIntervalListeners(e){e instanceof ne&&e.removePositionChangeListeners()}}oe.legacyIdPrefix="legacy";const ae=(e,t)=>e.end.compare(t.end);class ce{get name(){return ce.Name}get factory(){return ce._factory}get ops(){return ce._ops}}ce.Name="sharedStringIntervalCollection",ce._factory=new class{load(e,t=[]){return new fe({compareEnds:ae,create:se},!0,e,t)}store(e){return e.serializeInternal()}},ce._ops=de();const le=(e,t)=>e.end-t.end;function ue(e,t,n,r){const i={};return e&&e.length>0&&(i[b]=[e]),new te(t,n,i)}class he{get name(){return he.Name}get factory(){return he._factory}get ops(){return he._ops}}function de(){const e=(e,t,n)=>{const{localSeq:r}=n,i=e.rebaseLocalInterval(t.opName,t.value,r);return{rebasedOp:Object.assign(Object.assign({},t),{value:i}),rebasedLocalOpMetadata:n}};return new Map([["add",{process:(e,t,n,r)=>{e.ackAdd(t,n,r)},rebase:e}],["delete",{process:(e,t,n,r)=>{e.ackDelete(t,n,r)},rebase:(e,t,n)=>({rebasedOp:t,rebasedLocalOpMetadata:n})}],["change",{process:(e,t,n,r)=>{e.ackChange(t,n,r)},rebase:e}]])}he.Name="sharedIntervalCollection",he._factory=new class{load(e,t=[]){const n=new fe({compareEnds:le,create:ue},!1,e,t);return n.attachGraph(void 0,""),n}store(e){return e.serializeInternal()}},he._ops=de();class pe{constructor(e,t=!0,n,r){this.results=[],this.index=0,e.gatherIterationResults(this.results,t,n,r)}next(){let e,t=!0;return this.index<this.results.length&&(e=this.results[this.index++],t=!1),{value:e,done:t}}}class fe extends g{constructor(e,t,n,r){super(),this.helpers=e,this.requiresClient=t,this.emitter=n,this.pendingChangesStart=new Map,this.pendingChangesEnd=new Map,Array.isArray(r)?this.savedSerializedIntervals=r:this.savedSerializedIntervals=r.intervals.map((e=>{return t=e,n=r.label,{start:t[0],end:t[1],sequenceNumber:t[2],intervalType:t[3],properties:Object.assign(Object.assign({},t[4]),{[b]:n})};var t,n}))}get attached(){return!!this.localCollection}attachGraph(e,t){if(this.attached)throw new X.j4("Only supports one Sequence attach");if(void 0===e&&this.requiresClient)throw new X.j4("Client required for this collection");if(this.client=e,this.localCollection=new oe(e,t,this.helpers,(e=>this.emit("changeInterval",e,!0,void 0))),this.savedSerializedIntervals)for(const e of this.savedSerializedIntervals)this.localCollection.ensureSerializedId(e),this.localCollection.addInterval(e.start,e.end,e.intervalType,e.properties);this.savedSerializedIntervals=void 0}getNextLocalSeq(){return++this.client.getCollabWindow().localSeq}getIntervalById(e){if(!this.attached)throw new X.j4("attach must be called before accessing intervals");return this.localCollection.getIntervalById(e)}add(e,t,n,r){var i,s;if(!this.attached)throw new X.j4("attach must be called prior to adding intervals");if(n&ee.Transient)throw new X.j4("Can not add transient intervals");const o=this.localCollection.addInterval(e,t,n,r);if(o){const r={end:t,intervalType:n,properties:o.properties,sequenceNumber:null!==(s=null===(i=this.client)||void 0===i?void 0:i.getCurrentSeq())&&void 0!==s?s:0,start:e};this.emitter.emit("add",void 0,r,{localSeq:this.getNextLocalSeq()})}return this.emit("addInterval",o,!0,void 0),o}deleteExistingInterval(e,t,n){this.localCollection.removeExistingInterval(e),e&&(t?this.emitter.emit("delete",void 0,e.serialize(this.client),{localSeq:this.getNextLocalSeq()}):this.onDeserialize&&this.onDeserialize(e)),this.emit("deleteInterval",e,t,n)}removeIntervalById(e){const t=this.localCollection.getIntervalById(e);return t&&this.deleteExistingInterval(t,!0,void 0),t}changeProperties(e,t){if(!this.attached)throw new X.j4("Attach must be called before accessing intervals");if("string"!=typeof e)throw new X.j4("Change API requires an ID that is a string");if(!t)throw new X.j4("changeProperties should be called with a property set");const n=this.getIntervalById(e);if(n){const e=n.addProperties(t,!0,O),r=n.serialize(this.client);r.start=void 0,r.end=void 0,r.properties=t,r.properties[Y]=n.getIntervalId(),this.emitter.emit("change",void 0,r,{localSeq:this.getNextLocalSeq()}),this.emit("propertyChanged",n,e)}this.emit("changeInterval",n,!0,void 0)}change(e,t,n){if(!this.attached)throw new X.j4("Attach must be called before accessing intervals");if("string"!=typeof e)throw new X.j4("Change API requires an ID that is a string");const r=this.getIntervalById(e);if(r){const i=this.localCollection.changeInterval(r,t,n),s=r.serialize(this.client);return s.start=t,s.end=n,s.properties={[Y]:r.getIntervalId()},this.emitter.emit("change",void 0,s,{localSeq:this.getNextLocalSeq()}),this.addPendingChange(e,s),this.emit("changeInterval",i,!0,void 0),i}}addPendingChange(e,t){void 0!==t.start&&this.addPendingChangeHelper(e,this.pendingChangesStart,t),void 0!==t.end&&this.addPendingChangeHelper(e,this.pendingChangesEnd,t)}addPendingChangeHelper(e,t,n){let r=t.get(e);r||(r=[],t.set(e,r)),r.push(n)}removePendingChange(e){var t;const n=null===(t=e.properties)||void 0===t?void 0:t[Y];void 0!==e.start&&this.removePendingChangeHelper(n,this.pendingChangesStart,e),void 0!==e.end&&this.removePendingChangeHelper(n,this.pendingChangesEnd,e)}removePendingChangeHelper(e,t,n){const r=t.get(e);if(r){const i=r.shift();if(0===r.length&&t.delete(e),(null==i?void 0:i.start)!==n.start||(null==i?void 0:i.end)!==n.end)throw new X.j4("Mismatch in pending changes")}}hasPendingChangeStart(e){const t=this.pendingChangesStart.get(e);return t&&0!==t.length}hasPendingChangeEnd(e){const t=this.pendingChangesEnd.get(e);return t&&0!==t.length}changeInterval(e,t,n){return this.ackChange(e,t,n)}ackChange(e,t,n){var r,i,s,o;if(!this.attached)throw new X.j4("Attach must be called before accessing intervals");let a;if(t){this.removePendingChange(e);const t=null===(r=e.properties)||void 0===r?void 0:r[Y];a=this.getIntervalById(t),a&&(null===(i=a.propertyManager)||void 0===i||i.ackPendingProperties({type:v.ANNOTATE,props:null!==(s=e.properties)&&void 0!==s?s:{}}),this.ackInterval(a,n))}else{const t=e.properties,r=Y,i=t[r],s=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(t,["symbol"==typeof r?r:r+""]);if(a=this.getIntervalById(i),a){let t,r;this.hasPendingChangeStart(i)||(t=e.start),this.hasPendingChangeEnd(i)||(r=e.end),void 0===t&&void 0===r||(a=null!==(o=this.localCollection.changeInterval(a,t,r,n))&&void 0!==o?o:a);const c=a.addProperties(s,!0,n.sequenceNumber);this.onDeserialize&&this.onDeserialize(a),this.emit("propertyChanged",a,c)}}a&&this.emit("changeInterval",a,t,n)}addConflictResolver(e){if(!this.attached)throw new X.j4("attachSequence must be called");this.localCollection.addConflictResolver(e)}attachDeserializer(e){e&&(this.onDeserialize=e,this.localCollection.map((t=>{e(t)})))}rebaseLocalInterval(e,t,n){var r,i;if(!this.attached)throw new X.j4("attachSequence must be called");const{start:s,end:o,intervalType:a,properties:c,sequenceNumber:l}=t,u=void 0===s?void 0:this.client.rebasePosition(s,l,n),h=void 0===o?void 0:this.client.rebasePosition(o,l,n),d=null==c?void 0:c[Y],p={start:u,end:h,intervalType:a,sequenceNumber:null!==(i=null===(r=this.client)||void 0===r?void 0:r.getCurrentSeq())&&void 0!==i?i:0,properties:c};return"change"===e&&(this.hasPendingChangeStart(d)||this.hasPendingChangeEnd(d))&&(this.removePendingChange(t),this.addPendingChange(d,p)),p}getSlideToSegment(e){const t={segment:e.segment,offset:e.offset},n=this.client.getSlideToSegment(t);return t.segment===n.segment&&t.offset===n.offset?void 0:n}setSlideOnRemove(e){let t=e.refType;t&=~m.StayOnRemove,t|=m.SlideOnRemove,e.refType=t}ackInterval(e,t){if(!(e instanceof ne))return;if(!S(e.start,m.StayOnRemove)&&!S(e.end,m.StayOnRemove))return;const n=this.getSlideToSegment(e.start),r=this.getSlideToSegment(e.end),i=e.properties[Y],s=this.hasPendingChangeStart(i),o=this.hasPendingChangeEnd(i);s||this.setSlideOnRemove(e.start),o||this.setSlideOnRemove(e.end);const a=void 0!==n&&!s,c=void 0!==r&&!o;if(a||c){if(this.localCollection.removeExistingInterval(e),a){const r=e.start.properties;this.client.removeLocalReferencePosition(e.start),e.start=re(this.client,n,e.start.refType,t),r&&e.start.addProperties(r)}if(c){const n=e.end.properties;this.client.removeLocalReferencePosition(e.end),e.end=re(this.client,r,e.end.refType,t),n&&e.end.addProperties(n)}this.localCollection.add(e)}}addInternal(e,t,n){return this.ackAdd(e,t,n)}ackAdd(e,t,n){var r;if(t){const t=null===(r=e.properties)||void 0===r?void 0:r[Y],i=this.getIntervalById(t);return void(i&&this.ackInterval(i,n))}if(!this.attached)throw new X.j4("attachSequence must be called");this.localCollection.ensureSerializedId(e);const i=this.localCollection.addInterval(e.start,e.end,e.intervalType,e.properties,n);return i&&this.onDeserialize&&this.onDeserialize(i),this.emit("addInterval",i,t,n),i}deleteInterval(e,t,n){return this.ackDelete(e,t,n)}ackDelete(e,t,n){if(t)return;if(!this.attached)throw new X.j4("attach must be called prior to deleting intervals");const r=this.localCollection.ensureSerializedId(e),i=this.localCollection.getIntervalById(r);i&&this.deleteExistingInterval(i,t,n)}serializeInternal(){if(!this.attached)throw new X.j4("attachSequence must be called");return this.localCollection.serialize()}[Symbol.iterator](){return new pe(this)}CreateForwardIteratorWithStartPosition(e){return new pe(this,!0,e)}CreateBackwardIteratorWithStartPosition(e){return new pe(this,!1,e)}CreateForwardIteratorWithEndPosition(e){return new pe(this,!0,void 0,e)}CreateBackwardIteratorWithEndPosition(e){return new pe(this,!1,void 0,e)}gatherIterationResults(e,t,n,r){this.attached&&this.localCollection.gatherIterationResults(e,t,n,r)}findOverlappingIntervals(e,t){if(!this.attached)throw new X.j4("attachSequence must be called");return this.localCollection.findOverlappingIntervals(e,t)}map(e){if(!this.attached)throw new X.j4("attachSequence must be called");this.localCollection.map(e)}previousInterval(e){if(!this.attached)throw new X.j4("attachSequence must be called");return this.localCollection.previousInterval(e)}nextInterval(e){if(!this.attached)throw new X.j4("attachSequence must be called");return this.localCollection.nextInterval(e)}}class ge{constructor(e){this.segment=e,this.trackingGroups=new Set}link(e){e&&(this.trackingGroups.has(e)||this.trackingGroups.add(e),e.has(this.segment)||e.link(this.segment))}unlink(e){e.has(this.segment)&&e.unlink(this.segment),this.trackingGroups.delete(e)}copyTo(e){this.trackingGroups.forEach((t=>e.trackingCollection.link(t)))}get empty(){return 0===this.trackingGroups.size}matches(e){if(!e||this.trackingGroups.size!==e.trackingGroups.size)return!1;for(const t of this.trackingGroups.values())if(!e.trackingGroups.has(t))return!1;return!0}}function me(e,t){let n=-1,r=0,i=e.length-1;for(;r<=i;){const s=r+Math.floor((i-r)/2);e[s].seq<=t?((n<0||e[n].seq<e[s].seq)&&(n=s),r=s+1):i=s-1}return n}class ye{constructor(e){this.minSeq=e,this.minLength=0,this.segmentCount=0,this.partialLengths=[],this.clientSeqNumbers=[]}static combine(e,t,n,r=!1){return ye.combineBranch(e,t,n,r)}static combineBranch(e,t,n,r=!1){let i,s=new ye(n.minSeq);function o(e){if(!e)return;const t=new G(De);return e.map((e=>(t.put(e.data.clientId,Object.assign({},e.data)),!0))),t}function a(e){const t=e.seq;let n=0;if(i){if(i.seq===e.seq)return i.seglen+=e.seglen,i.len+=e.seglen,void function(e,t){const n=e.overlapRemoveClients;n?t.overlapRemoveClients&&t.overlapRemoveClients.map((e=>{const t=n.get(e.key);return t?t.data.seglen+=e.data.seglen:n.put(e.data.clientId,Object.assign({},e.data)),!0})):e.overlapRemoveClients=o(t.overlapRemoveClients)}(i,e);n=i.len,s.addClientSeqNumberFromPartial(i)}i={clientId:e.clientId,len:n+e.seglen,overlapRemoveClients:o(e.overlapRemoveClients),seglen:e.seglen,seq:t},s.partialLengths.push(i)}ye.fromLeaves(s,t,n);const c=[];for(let i=0;i<t.childCount;i++){const s=t.children[i];if(!s.isLeaf()){const t=s;r&&(t.partialLengths=ye.combine(e,t,n,!0)),c.push(t.partialLengths)}}let l=c.length;if(0!==l){s.partialLengths.length>0&&(c.push(s),l++,s=new ye(n.minSeq));const e=new Array(l),t=new Array(l);for(let n=0;n<l;n++)e[n]=0,t[n]=c[n].partialLengths.length,s.minLength+=c[n].minLength,s.segmentCount+=c[n].segmentCount;let r,o=0;for(;o>=0;){o=-1;for(let n=0;n<l;n++)if(e[n]<t[n]){const t=c[n].partialLengths[e[n]];(o<0||t.seq<r.seq)&&(o=n,r=t)}o>=0&&(a(r),e[o]++)}i&&s.addClientSeqNumberFromPartial(i)}return ye.options.zamboni&&s.zamboni(n),ye.options.verify&&s.verify(),s}static fromLeaves(e,t,n){function r(e,t){return void 0!==e&&e!==O&&e<=t}e.minLength=0,e.segmentCount=t.childCount;for(let i=0;i<t.childCount;i++){const s=t.children[i];if(s.isLeaf()){const t=s;r(t.seq,n.minSeq)?e.minLength+=t.cachedLength:t.seq!==O&&ye.insertSegment(e,t);const i=be(t);r(null==i?void 0:i.removedSeq,n.minSeq)?e.minLength-=t.cachedLength:void 0!==i&&i.removedSeq!==O&&ye.insertSegment(e,t,i)}}const i=e.partialLengths,s=i.length;let o=0;for(let t=0;t<s;t++)i[t].len=o+i[t].seglen,o=i[t].len,e.addClientSeqNumberFromPartial(i[t]);ye.options.verify&&e.verify()}static getOverlapClients(e,t){const n=new G(De);for(const r of e)n.put(r,{clientId:r,seglen:t});return n}static accumulateRemoveClientOverlap(e,t,n){if(e.overlapRemoveClients)for(const r of t){const t=e.overlapRemoveClients.get(r);t?t.data.seglen+=n:e.overlapRemoveClients.put(r,{clientId:r,seglen:n})}else e.overlapRemoveClients=ye.getOverlapClients(t,n)}static insertSegment(e,t,n){let r,i=t.seq,s=t.cachedLength,o=t.clientId;n&&(i=n.removedSeq,s=-s,o=n.removedClientIds[0],r=n.removedClientIds.length>1?n.removedClientIds.slice(1):void 0);const a=e.partialLengths,c=a.length;let l=0;for(;l<c&&!(a[l].seq>=i);l++);if(l<c&&a[l].seq===i)a[l].seglen+=s,r&&ye.accumulateRemoveClientOverlap(a[l],r,s);else{let e;if(e=r?{seq:i,clientId:o,len:0,seglen:s,overlapRemoveClients:ye.getOverlapClients(r,s)}:{seq:i,clientId:o,len:0,seglen:s},l<c){for(let e=c;e>l;e--)a[e]=a[e-1];a[l]=e}else a.push(e)}}static addSeq(e,t,n,r){let i,s,o=me(e,t);if(o>=0){const n=e[o];n.seq===t?(i=n,o=me(e,t-1),o>=0&&(s=e[o])):s=n}void 0===i?(i={clientId:r,seglen:n,seq:t},e.push(i)):i.seglen=n,i.len=void 0!==s?i.seglen+s.len:i.seglen}update(e,t,n,r,i){let s=0,o=0;for(let e=0;e<t.childCount;e++){const r=t.children[e];if(r.isLeaf()){const e=r,t=be(e);e.seq===n?(null==t?void 0:t.removedSeq)!==n&&(s+=e.cachedLength):(null==t?void 0:t.removedSeq)===n&&(s-=e.cachedLength),o++}else{const e=r.partialLengths,t=e.partialLengths,i=me(t,n);if(i>=0){const e=t[i];e.seq===n&&(s+=e.seglen)}o+=e.segmentCount}}this.segmentCount=o,ye.addSeq(this.partialLengths,n,s,r),void 0===this.clientSeqNumbers[r]&&(this.clientSeqNumbers[r]=[]),ye.addSeq(this.clientSeqNumbers[r],n,s),ye.options.zamboni&&this.zamboni(i),ye.options.verify&&this.verify()}getPartialLength(e,t){let n=this.minLength;const r=me(this.partialLengths,e),i=this.cliLatest(t),s=this.clientSeqNumbers[t];if(r>=0){if(n+=this.partialLengths[r].len,i>=0){const r=s[i];if(r.seq>e){n+=r.len;const i=this.cliLatestLEQ(t,e);i>=0&&(n-=s[i].len)}}}else i>=0&&(n+=s[i].len);return n}toString(e,t=0){let n="";for(const e of this.partialLengths)n+=`(${e.seq},${e.len}) `;for(const t in this.clientSeqNumbers)if(this.clientSeqNumbers[t].length>0){n+="Client ",n+=e?`${e(+t)}`:`${t}`,n+="[";for(const e of this.clientSeqNumbers[t])n+=`(${e.seq},${e.len})`;n+="]"}return n=`min(seq ${this.minSeq}): ${this.minLength}; sc: ${this.segmentCount};${n}`,n}zamboni(e){function t(t){const n=me(t,e.minSeq);let r=0;if(n>=0){r=t[n].len;const e=t.length;if(n<=e-1){const i=e-n-1;for(let e=0;e<i;e++)t[e]=t[e+n+1],t[e].len-=r;t.length=i}}return r}this.minLength+=t(this.partialLengths);for(const e in this.clientSeqNumbers){const n=this.clientSeqNumbers[e];n&&t(n)}}addClientSeqNumber(e,t,n){void 0===this.clientSeqNumbers[e]&&(this.clientSeqNumbers[e]=[]);const r=this.clientSeqNumbers[e];let i=n;r.length>0&&(i+=r[r.length-1].len),r.push({seq:t,len:i,seglen:n})}addClientSeqNumberFromPartial(e){this.addClientSeqNumber(e.clientId,e.seq,e.seglen),e.overlapRemoveClients&&e.overlapRemoveClients.map((t=>(this.addClientSeqNumber(t.data.clientId,e.seq,t.data.seglen),!0)))}cliLatestLEQ(e,t){const n=this.clientSeqNumbers[e];return n?me(n,t):-1}cliLatest(e){const t=this.clientSeqNumbers[e];return t&&t.length>0?t.length-1:-1}verifyPartialLengths(e,t){if(0===e.length)return 0;let n=0,r=0,i=0;for(const s of e)i++,N(this.minSeq<=s.seq,84),N(n<s.seq,85),n=s.seq,r+=s.seglen,r!==s.len&&N(!1,86),t||this.minLength+s.len<0&&N(!1,87),s.overlapRemoveClients&&(N(!t,88),i+=s.overlapRemoveClients.size());return i}verify(){if(this.clientSeqNumbers){let e=0;for(const t of this.clientSeqNumbers)t&&(e+=this.verifyPartialLengths(t,!0));N(!!this.partialLengths,89),N(this.verifyPartialLengths(this.partialLengths,!1)===e,90)}else N(!this.partialLengths,91)}}ye.options={verify:!1,zamboni:!0};class ve{constructor(e){this.segment=e,this.segmentGroups=H()}get size(){return this.segmentGroups.count()}get empty(){return this.segmentGroups.empty()}enqueue(e){this.segmentGroups.enqueue(e),e.segments.push(this.segment)}dequeue(){return this.segmentGroups.dequeue()}clear(){this.segmentGroups.clear()}copyTo(e){this.segmentGroups.walk((t=>e.segmentGroups.enqueue(t)))}}function be(e){if(void 0!==(null==e?void 0:e.removedClientIds)&&void 0!==(null==e?void 0:e.removedSeq))return e;N(void 0===(null==e?void 0:e.removedClientIds)&&void 0===(null==e?void 0:e.removedSeq),703)}function Se(e){const t=be(e);return void 0!==t&&t.removedSeq!==O}class we{constructor(){this.index=0,this.ordinal="",this.cachedLength=0}isLeaf(){return!1}}function xe(e,t){const n=w(e);if(n)for(const r of n)t[r]=e}function Ce(e,t){const n=w(e);if(n)for(const r of n)void 0===t[r]&&(t[r]=e)}function Ee(e,t){for(const n in t){const r=t[n];if(!r.empty()){let t=e[n];void 0===t&&(t=new B,e[n]=t);for(const e of r.items)Te(t,e)}}}function Te(e,t){if(S(t,m.NestBegin))return e.push(t),!0;{const n=e.top();return n&&S(n,m.NestBegin)?e.pop():e.push(t),!1}}class Ae extends we{constructor(e){super(),this.childCount=e,this.children=new Array(8)}hierBlock(){}setOrdinal(e,t){let n,r=this.childCount;8===r&&(r=7),N(r>=1&&r<=7,64);const i=1<<8-(r+1);if(0===t)n=i-1;else{const e=this.children[t-1].ordinal;n=e.charCodeAt(e.length-1)+i}e.ordinal=this.ordinal+String.fromCharCode(n),N(e.ordinal.length===this.ordinal.length+1,65),t>0&&N(e.ordinal>this.children[t-1].ordinal,66)}assignChild(e,t,n=!0){e.parent=this,e.index=t,n&&this.setOrdinal(e,t),this.children[t]=e}}class ke extends Ae{constructor(e){super(e),this.rightmostTiles=_(),this.leftmostTiles=_(),this.rangeStacks=_()}addNodeReferences(e,t){!function(e,t,n,r,i){var s;function o(e,t){let n=i[e];void 0===n&&(n=new B,i[e]=n),Te(n,t)}if(t.isLeaf()){const i=t;if((null!==(s=e.localNetLength(i))&&void 0!==s?s:0)>0)if(Pe.is(i)){const t=i.getId();if(t&&e.mapIdToSegment(t,i),S(i,m.Tile)&&(xe(i,n),Ce(i,r)),i.refType&(m.NestBegin|m.NestEnd)){const e=x(i);if(e)for(const t of e)o(t,i)}}else{const e=t;if(e.localRefs&&void 0!==e.localRefs.hierRefCount&&e.localRefs.hierRefCount>0)for(const t of e.localRefs)if(S(t,m.Tile)&&(xe(t,n),Ce(t,r)),t.refType&(m.NestBegin|m.NestEnd))for(const e of x(t))o(e,t)}}else{const e=t;Ee(i,e.rangeStacks),M(n,e.rightmostTiles),function(e,t){if(void 0!==t)for(const n in t)void 0===e[n]&&(e[n]=t[n])}(r,e.leftmostTiles)}}(e,t,this.rightmostTiles,this.leftmostTiles,this.rangeStacks)}hierBlock(){return this}hierToString(e){let t="";for(const n in this.rangeStacks){const r=this.rangeStacks[n];t+=_e(e),t+=`${n}: `;for(const e of r.items)t+=`${e.toString()} `;t+="\n"}return t}}class Ne extends we{constructor(){super(...arguments),this.clientId=R,this.seq=0,this.segmentGroups=new ve(this),this.trackingCollection=new ge(this)}addProperties(e,t,n,r){return this.propertyManager||(this.propertyManager=new q),this.properties||(this.properties=_()),this.propertyManager.addProperties(this.properties,e,t,n,r&&r.collaborating)}hasProperty(e){return!!this.properties&&void 0!==this.properties[e]}isLeaf(){return!0}cloneInto(e){var t;e.clientId=this.clientId,e.properties=function(e){if(void 0===e)return;const t=_();for(const n in e){const r=e[n];null!==r&&(t[n]=r)}return t}(this.properties),e.removedClientIds=null===(t=this.removedClientIds)||void 0===t?void 0:t.slice(),e.removedSeq=this.removedSeq,e.seq=this.seq}canAppend(e){return!1}addSerializedProps(e){this.properties&&(e.props=this.properties)}ack(e,t,n){switch(N(this.segmentGroups.dequeue()===e,67),t.op.type){case v.ANNOTATE:return N(!!this.propertyManager,68),this.propertyManager.ackPendingProperties(t.op),!0;case v.INSERT:return N(this.seq===O,69),this.seq=t.sequencedMessage.sequenceNumber,this.localSeq=void 0,!0;case v.REMOVE:const e=be(this);return N(void 0!==e,70),this.localRemovedSeq=void 0,e.removedSeq===O&&(e.removedSeq=t.sequencedMessage.sequenceNumber,!0);default:throw new Error(`${t.op.type} is in unrecognized operation type`)}}splitAt(e){var t;if(e>0){const n=this.createSplitSegmentAt(e);return n&&(this.copyPropertiesTo(n),n.parent=this.parent,n.ordinal=this.ordinal+String.fromCharCode(0),n.removedClientIds=null===(t=this.removedClientIds)||void 0===t?void 0:t.slice(),n.removedSeq=this.removedSeq,n.localRemovedSeq=this.localRemovedSeq,n.seq=this.seq,n.localSeq=this.localSeq,n.clientId=this.clientId,this.segmentGroups.copyTo(n),this.trackingCollection.copyTo(n),this.localRefs&&this.localRefs.split(e,n)),n}}copyPropertiesTo(e){this.propertyManager&&this.properties&&(e.propertyManager=new q,e.properties=this.propertyManager.copyTo(this.properties,e.properties,e.propertyManager))}}const Oe="markerId";class Pe extends Ne{constructor(e){super(),this.refType=e,this.type=Pe.type,this.cachedLength=1}static is(e){return e.type===Pe.type}static make(e,t){const n=new Pe(e);return t&&n.addProperties(t),n}toJSONObject(){const e={marker:{refType:this.refType}};return super.addSerializedProps(e),e}static fromJSONObject(e){if(e&&"object"==typeof e&&"marker"in e)return Pe.make(e.marker.refType,e.props)}clone(){const e=Pe.make(this.refType,this.properties);return this.cloneInto(e),e}getSegment(){return this}getOffset(){return 0}hasSimpleType(e){return!!this.properties&&this.properties.markerSimpleType===e}getProperties(){return this.properties}getId(){if(this.properties&&this.properties[Oe])return this.properties[Oe]}hasTileLabels(){return T(this)}hasRangeLabels(){return A(this)}hasTileLabel(e){return C(this,e)}hasRangeLabel(e){return E(this,e)}getTileLabels(){return w(this)}getRangeLabels(){return x(this)}toString(){let e="";S(this,m.Tile)&&(e+="Tile"),S(this,m.NestBegin)&&(e.length>0&&(e+="; "),e+="RangeBegin"),S(this,m.NestEnd)&&(e.length>0&&(e+="; "),e+="RangeEnd");let t="";const n=this.getId();n&&(e+=` (${n}) `);const r=w(this);if(r){t+="tile -- ";for(let e=0,n=r.length;e<n;e++)e>0&&(t+="; "),t+=r[e]}const i=x(this);if(i){let e="begin";S(this,m.NestEnd)&&(e="end"),r&&(t+=" "),t+=`range ${e} -- `;const n=i;for(let e=0,r=n.length;e<r;e++)e>0&&(t+="; "),t+=n[e]}let s="";return this.properties&&(s+=JSON.stringify(this.properties,((e,t)=>{const n=!!t&&t.IFluidHandle;return n?`#Handle(${n.routeContext.path}/${n.path})`:t}))),`M ${e}: ${t} ${s}`}createSplitSegmentAt(e){}canAppend(e){return!1}append(){throw new Error("Can not append to marker")}}var Re;Pe.type="Marker",function(e){e[e.Go=0]="Go",e[e.Stop=1]="Stop",e[e.Yield=2]="Yield"}(Re||(Re={}));class Ie{constructor(e,t,n,r,i,s,o,a,c=0){this.block=e,this.actions=t,this.pos=n,this.refSeq=r,this.clientId=i,this.context=s,this.start=o,this.end=a,this.childIndex=c,this.op=Re.Go}}class Fe{constructor(){this.clientId=R,this.collaborating=!1,this.minSeq=0,this.currentSeq=0,this.localSeq=0}loadFrom(e){this.clientId=e.clientId,this.collaborating=e.collaborating,this.minSeq=e.minSeq,this.currentSeq=e.currentSeq}}const De=(e,t)=>e-t,Me=(e,t)=>e.localeCompare(t),Le=[""," ","  "];function _e(e){if(void 0===Le[e]){Le[e]="";for(let t=0;t<e;t++)Le[e]+=" "}return Le[e]}const qe={min:{maxSeq:-2},compare:(e,t)=>e.maxSeq-t.maxSeq};function Be(e,t){for(const n of t.rangeLabels)if(E(e,n)){let r=t.stacks[n];void 0===r&&(r=new B,t.stacks[n]=r),Te(r,e)}}function je(e,t,n,r,i,s,o){return Pe.is(e)&&e.refType&(m.NestBegin|m.NestEnd)&&Be(e,o),!1}function ze(e,t,n,r,i,s,o){var a;if(e.isLeaf()){const t=e;(null!==(a=o.mergeTree.localNetLength(t))&&void 0!==a?a:0)>0&&Pe.is(t)&&t.refType&(m.NestBegin|m.NestEnd)&&Be(t,o)}else{const t=e;Ee(o.stacks,t.rangeStacks)}return!0}function He(e,t,n,r,i,s,o){return Pe.is(e)&&C(e,o.tileLabel)&&(o.tile=e),!1}function Ue(e,t,n,r,i,s,o){if(e.isLeaf()){const t=e;o.mergeTree.localNetLength(t)>0&&Pe.is(t)&&C(t,o.tileLabel)&&(o.tile=t)}else{const t=e;let n;n=o.posPrecedesTile?t.rightmostTiles[o.tileLabel]:t.leftmostTiles[o.tileLabel],void 0!==n&&(o.tile=n)}return!0}const Ve={min:{minRequired:Number.MIN_VALUE,onMinGE:()=>{N(!1,72)}},compare:(e,t)=>e.minRequired-t.minRequired};class Ge{constructor(e){this.options=e,this.blockUpdateActions=Ge.initBlockUpdateActions,this.collabWindow=new Fe,this.idToSegment=new Map,this.splitLeafSegment=(e,t)=>{if(!(t>0&&e))return{};const n=e.splitAt(t);return this.mergeTreeMaintenanceCallback&&this.mergeTreeMaintenanceCallback({operation:-2,deltaSegments:[{segment:e},{segment:n}]},void 0),{next:n}},this.root=this.makeBlock(0)}makeBlock(e){const t=new ke(e);return t.ordinal="",t}clone(){const e=new Ge(this.options);e.root=e.blockClone(this.root)}blockClone(e,t){const n=this.makeBlock(e.childCount);for(let r=0;r<e.childCount;r++){const i=e.children[r];if(i.isLeaf()){const e=this.segmentClone(i);n.assignChild(e,r),t&&t.push(e)}else n.assignChild(this.blockClone(i,t),r)}return this.nodeUpdateLengthNewStructure(n),this.nodeUpdateOrdinals(n),n}segmentClone(e){return e.clone()}localNetLength(e){return void 0!==be(e)?0:e.cachedLength}mapIdToSegment(e,t){this.idToSegment.set(e,t)}addNode(e,t){const n=e.childCount++;return e.assignChild(t,n,!1),n}reloadFromSegments(e){N(!this.collabWindow.collaborating,73);const t=e=>{const n=Math.ceil(e.length/7),r=new Array(n);for(let t=0,i=0;i<n;i++){const n=r[i]=this.makeBlock(0);for(let r=0;r<7&&t<e.length;r++,t++)this.addNode(n,e[t]);this.blockUpdate(n)}return 1===r.length?r[0]:t(r)};e.length>0?(this.root=t(e),this.nodeUpdateOrdinals(this.root)):this.root=this.makeBlock(0)}startCollaboration(e,t,n){this.collabWindow.clientId=e,this.collabWindow.minSeq=t,this.collabWindow.collaborating=!0,this.collabWindow.currentSeq=n,this.segmentsToScour=new V([],qe),this.pendingSegments=H(),this.nodeUpdateLengthNewStructure(this.root,!0)}addToLRUSet(e,t){!0!==e.parent.needsScour&&t>this.collabWindow.currentSeq&&(e.parent.needsScour=!0,this.segmentsToScour.add({segment:e,maxSeq:t}))}underflow(e){return e.childCount<4}scourNode(e,t){let n;for(let r=0;r<e.childCount;r++){const i=e.children[r];if(i.isLeaf()){const e=i;e.segmentGroups.empty?void 0!==e.removedSeq?(e.removedSeq>this.collabWindow.minSeq?t.push(e):e.trackingCollection.empty?(this.mergeTreeMaintenanceCallback&&this.mergeTreeMaintenanceCallback({operation:-3,deltaSegments:[{segment:e}]},void 0),e.parent=void 0):t.push(e),n=void 0):e.seq<=this.collabWindow.minSeq?n&&n.canAppend(e)&&D(n.properties,e.properties)&&n.trackingCollection.matches(e.trackingCollection)&&this.localNetLength(e)>0?(n.append(e),this.mergeTreeMaintenanceCallback&&this.mergeTreeMaintenanceCallback({operation:-1,deltaSegments:[{segment:n},{segment:e}]},void 0),e.parent=void 0,e.trackingCollection.trackingGroups.forEach((t=>t.unlink(e)))):(t.push(e),n=this.localNetLength(e)>0?e:void 0):(t.push(e),n=void 0):(t.push(e),n=void 0)}else t.push(i),n=void 0}}packParent(e){const t=e.children;let n,r;const i=[];for(n=0;n<e.childCount;n++)r=t[n],this.scourNode(r,i),r.parent=void 0;const s=i.length;let o=Math.min(7,Math.floor(s/4));o<1&&(o=1);const a=Math.floor(s/o);let c=s%o;const l=new Array(8);let u=0;for(let t=0;t<o;t++){let n=a;c>0&&(n++,c--);const r=this.makeBlock(n);for(let e=0;e<n;e++){const t=i[u++];r.assignChild(t,e,!1)}r.parent=e,l[t]=r,this.nodeUpdateLengthNewStructure(r)}e.children=l;for(let t=0;t<o;t++)e.assignChild(l[t],t,!1);e.childCount=o,this.underflow(e)&&e.parent?this.packParent(e.parent):(this.nodeUpdateOrdinals(e),this.blockUpdatePathLengths(e,O,-1,!0))}zamboniSegments(e=Ge.zamboniSegmentsMaxCount){if(this.collabWindow.collaborating)for(let t=0;t<e;t++){let e=this.segmentsToScour.peek();if(!e||e.maxSeq>this.collabWindow.minSeq)break;if(e=this.segmentsToScour.get(),e.segment.parent&&!1!==e.segment.parent.needsScour){const t=e.segment.parent,n=[];this.scourNode(t,n),t.needsScour=!1;const r=n.length;if(r<t.childCount){t.childCount=r,t.children=n;for(let e=0;e<r;e++)t.assignChild(n[e],e,!1);this.underflow(t)&&t.parent?this.packParent(t.parent):(this.nodeUpdateOrdinals(t),this.blockUpdatePathLengths(t,O,-1,!0))}}}}getCollabWindow(){return this.collabWindow}getStats(){const e=t=>{const n={maxHeight:0,nodeCount:0,leafCount:0,removedLeafCount:0,liveCount:0,histo:[]};for(let e=0;e<8;e++)n.histo[e]=0;for(let r=0;r<t.childCount;r++){const i=t.children[r];let s=1;if(i.isLeaf())n.leafCount++,void 0!==i.removedSeq&&n.removedLeafCount++;else{const t=e(i);s=1+t.maxHeight,n.nodeCount+=t.nodeCount,n.leafCount+=t.leafCount,n.removedLeafCount+=t.removedLeafCount,n.liveCount+=t.liveCount;for(let e=0;e<8;e++)n.histo[e]+=t.histo[e]}s>n.maxHeight&&(n.maxHeight=s)}return n.histo[t.childCount]++,n.nodeCount++,n.liveCount+=t.childCount,n};return e(this.root)}getLength(e,t){return this.blockLength(this.root,e,t)}get length(){return this.root.cachedLength}getPosition(e,t,n){var r;let i,s=0,o=e.parent;for(;o;){const a=o.children;for(let c=0;c<o.childCount;c++){const o=a[c];if(i&&o===i||o===e)break;s+=null!==(r=this.nodeLength(o,t,n))&&void 0!==r?r:0}i=o,o=o.parent}return s}getContainingSegment(e,t,n){let r,i;return this.searchBlock(this.root,e,0,t,n,{leaf:(e,t,n,s,o)=>(r=e,i=o,!1)},void 0),{segment:r,offset:i}}_getSlideToSegment(e){if(!e.segment||!Se(e.segment))return e;let t;const n=e=>!(e.seq!==O&&!Se(e)&&(t=e,1));return this.rightExcursion(e.segment,n),t?{segment:t,offset:0}:(this.leftExcursion(e.segment,n),t?{segment:t,offset:t.cachedLength-1}:{segment:void 0,offset:0})}slideReferences(e,t){var n,r,i,s,o;N(Se(e),753),N(!!e.localRefs,754);const a=this._getSlideToSegment({segment:e,offset:0}),c=a.segment;c&&!c.localRefs&&(c.localRefs=new Q(c));for(const l of t)null===(r=null===(n=l.callbacks)||void 0===n?void 0:n.beforeSlide)||void 0===r||r.call(n),N(l===e.localRefs.removeLocalRef(l),755),c?(l.segment=c,l.offset=null!==(i=a.offset)&&void 0!==i?i:0,N(!!c.localRefs,756),c.localRefs.addLocalRef(l)):(l.segment=void 0,l.offset=0),null===(o=null===(s=l.callbacks)||void 0===s?void 0:s.afterSlide)||void 0===o||o.call(s);c&&this.blockUpdatePathLengths(c.parent,P,R)}updateSegmentRefsAfterMarkRemoved(e,t){if(!e.localRefs||e.localRefs.empty)return;const n=[],r=[];for(const i of e.localRefs)S(i,m.StayOnRemove)?r.push(i):S(i,m.SlideOnRemove)&&(t?r.push(i):n.push(i));t||this.slideReferences(e,n),e.localRefs.clear();for(const t of r)t.segment=e,e.localRefs.addLocalRef(t)}blockLength(e,t,n){return this.collabWindow.collaborating&&n!==this.collabWindow.clientId?e.partialLengths.getPartialLength(t,n):e.cachedLength}nodeLength(e,t,n){if(this.collabWindow.collaborating&&this.collabWindow.clientId!==n){if(e.isLeaf()){const r=e,i=be(r);if(void 0!==i&&i.removedSeq!==O&&i.removedSeq<=t)return;if(r.clientId===n||r.seq!==O&&r.seq<=t)return void 0!==i&&i.removedClientIds.includes(n)?0:r.cachedLength;if(void 0!==i&&i.removedSeq!==O)return;return 0}return e.partialLengths.getPartialLength(t,n)}return e.isLeaf()?this.localNetLength(e):e.cachedLength}addMinSeqListener(e,t){this.minSeqListeners||(this.minSeqListeners=new V([],Ve)),this.minSeqListeners.add({minRequired:e,onMinGE:t})}notifyMinSeqListeners(){if(this.minSeqListeners)for(;this.minSeqListeners.count()>0&&this.minSeqListeners.peek().minRequired<=this.collabWindow.minSeq;)this.minSeqListeners.get().onMinGE(this.collabWindow.minSeq)}setMinSeq(e){N(e<=this.collabWindow.currentSeq,78),N(this.collabWindow.minSeq<=e,79),e>this.collabWindow.minSeq&&(this.collabWindow.minSeq=e,Ge.options.zamboniSegments&&this.zamboniSegments(),this.notifyMinSeqListeners())}referencePositionToLocalPosition(e,t=this.collabWindow.currentSeq,n=this.collabWindow.clientId){const r=e.getSegment();return r&&r.parent?(r.removedSeq?0:e.getOffset())+this.getPosition(r,t,n):$.DetachedPosition}getStackContext(e,t,n){const r={mergeTree:this,stacks:_(),rangeLabels:n};return this.search(e,0,t,{leaf:je,shift:ze},r),r.stacks}findTile(e,t,n,r=!0){const i={mergeTree:this,posPrecedesTile:r,tileLabel:n};if(r?this.search(e,0,t,{leaf:He,shift:Ue},i):this.backwardSearch(e,0,t,{leaf:He,shift:Ue},i),i.tile){let e;if(i.tile.isLeaf()){const n=i.tile;e=this.getPosition(n,0,t)}else e=i.tile.toPosition();return{tile:i.tile,pos:e}}}search(e,t,n,r,i){return this.searchBlock(this.root,e,0,t,n,r,i)}searchBlock(e,t,n,r,i,s,o){var a;let c=t,l=n;const u=e.children;s&&s.pre&&s.pre(e,l,r,i,void 0,void 0,o);const h=s&&s.contains;for(let t=0;t<e.childCount;t++){const e=u[t],n=null!==(a=this.nodeLength(e,r,i))&&void 0!==a?a:0;if(!h&&c<n||h&&h(e,c,r,i,void 0,void 0,o))return e.isLeaf()?(s&&s.leaf&&s.leaf(e,l,r,i,c,-1,o),e):this.searchBlock(e,c,l,r,i,s,o);s&&s.shift&&s.shift(e,l,r,i,c,void 0,o),c-=n,l+=n}s&&s.post&&s.post(e,l,r,i,void 0,void 0,o)}backwardSearch(e,t,n,r,i){const s=this.getLength(t,n);if(!(e>s))return this.backwardSearchBlock(this.root,e,s,t,n,r,i)}backwardSearchBlock(e,t,n,r,i,s,o){var a;let c=n;const l=e.children;s&&s.pre&&s.pre(e,c,r,i,void 0,void 0,o);const u=s&&s.contains;for(let n=e.childCount-1;n>=0;n--){const e=l[n],h=c-(null!==(a=this.nodeLength(e,r,i))&&void 0!==a?a:0);if(!u&&t>=h||u&&u(e,t,r,i,void 0,void 0,o))return e.isLeaf()?(s&&s.leaf&&s.leaf(e,h,r,i,t,-1,o),e):this.backwardSearchBlock(e,t,c,r,i,s,o);s&&s.shift&&s.shift(e,h,r,i,t,void 0,o),c=h}s&&s.post&&s.post(e,c,r,i,void 0,void 0,o)}updateRoot(e){if(void 0!==e){const t=this.makeBlock(2);t.assignChild(this.root,0,!1),t.assignChild(e,1,!1),this.root=t,this.nodeUpdateOrdinals(this.root),this.nodeUpdateLengthNewStructure(this.root)}}ackPendingSegment(e){const t=e.sequencedMessage.sequenceNumber,n=this.pendingSegments.dequeue(),r=[];let i=!1;if(void 0!==n){const s=[];n.segments.map((o=>{const a=!o.ack(n,e,this);i=a||i,a||e.op.type!==v.REMOVE||this.updateSegmentRefsAfterMarkRemoved(o,!1),Ge.options.zamboniSegments&&this.addToLRUSet(o,t),r.includes(o.parent)||r.push(o.parent),s.push({segment:o})})),this.mergeTreeMaintenanceCallback&&this.mergeTreeMaintenanceCallback({deltaSegments:s,operation:-4},e);const o=this.collabWindow.clientId;for(const e of r)this.blockUpdatePathLengths(e,t,o,i)}Ge.options.zamboniSegments&&this.zamboniSegments()}addToPendingList(e,t,n){let r=t;return void 0===r&&(r={segments:[],localSeq:n},this.pendingSegments.enqueue(r)),e.segmentGroups.enqueue(r),r}getMarkerFromId(e){return this.idToSegment.get(e)}posFromRelativePos(e,t=this.collabWindow.currentSeq,n=this.collabWindow.clientId){let r,i=-1;return e.id&&(r=this.getMarkerFromId(e.id)),r&&(i=this.getPosition(r,t,n),e.before?void 0!==e.offset&&(i-=e.offset):(i+=r.cachedLength,void 0!==e.offset&&(i+=e.offset))),i}insertSegments(e,t,n,r,i,s){this.ensureIntervalBoundary(e,n,r);const o=i===O?++this.collabWindow.localSeq:void 0;this.blockInsert(e,n,r,i,o,t),this.mergeTreeDeltaCallback&&void 0!==s&&this.mergeTreeDeltaCallback(s,{operation:v.INSERT,deltaSegments:t.map((e=>({segment:e})))}),this.collabWindow.collaborating&&Ge.options.zamboniSegments&&i!==O&&this.zamboniSegments()}insertAtReferencePosition(e,t,n){if(0===t.cachedLength)return;if(t.parent||t.removedSeq||0!==t.seq)throw new Error("Cannot insert segment that has already been inserted.");const r=e=>{let t=e.parent,n=t;for(;void 0!==t;){if(t.childCount>=8){const e=this.split(t);t===this.root?(this.updateRoot(e),n=void 0):(this.insertChildNode(t.parent,e,t.index+1),n=e.parent,this.blockUpdateLength(t.parent,O,i))}else this.blockUpdateLength(t,O,i);t=t.parent}n&&this.nodeUpdateOrdinals(n)},i=this.collabWindow.clientId,s=e.getSegment(),o=e.getOffset(),a=this.nodeLength(s,this.collabWindow.currentSeq,i);let c=s;if(0!==o&&void 0!==a&&0!==a){const e=this.splitLeafSegment(s,o);N(!!e.next,80),this.insertChildNode(s.parent,e.next,s.index+1),r(e.next),c=e.next}if(this.leftExcursion(c,(e=>{if(!e.isLeaf())return!0;const t=this.nodeLength(e,this.collabWindow.currentSeq,i);return void 0===t||0===t&&(this.breakTie(0,e,O)&&(c=e),!0)})),this.collabWindow.collaborating?(t.localSeq=++this.collabWindow.localSeq,t.seq=O):t.seq=0,t.clientId=i,Pe.is(t)){const e=t.getId();e&&this.mapIdToSegment(e,t)}this.insertChildNode(c.parent,t,c.index),r(t),this.mergeTreeDeltaCallback&&this.mergeTreeDeltaCallback(n,{deltaSegments:[{segment:t}],operation:v.INSERT}),this.collabWindow.collaborating&&this.addToPendingList(t,void 0,t.localSeq)}resolveRemoteClientPosition(e,t,n){if(t<this.collabWindow.minSeq)return;const r=this.getContainingSegment(e,t,n),i=this.getCollabWindow();return r&&r.segment?this.getPosition(r.segment,i.currentSeq,i.clientId)+r.offset:e===this.getLength(t,n)?this.getLength(i.currentSeq,i.clientId):void 0}insertChildNode(e,t,n){N(e.childCount<8,81);for(let t=e.childCount;t>n;t--)e.children[t]=e.children[t-1],e.children[t].index=t;e.childCount++,e.assignChild(t,n,!1)}blockInsert(e,t,n,r,i,s){let o=!1;const a=e=>(e.seq===O&&(o=!0),!1),c=e=>(o=!1,this.rightExcursion(e,a),o);let l;const u=e=>{this.collabWindow.collaborating&&(e.seq===O&&n===this.collabWindow.clientId?l=this.addToPendingList(e,l,i):e.seq>this.collabWindow.minSeq&&Ge.options.zamboniSegments&&this.addToLRUSet(e,e.seq))},h=(e,t,n)=>{const r={};return e?(r.replaceCurrent=n.candidateSegment,r.next=e):r.next=n.candidateSegment,r};let d=e;for(const e of s)if(o=!1,e.cachedLength>0){if(e.seq=r,e.localSeq=i,e.clientId=n,Pe.is(e)){const t=e.getId();t&&this.mapIdToSegment(t,e)}const s=this.insertingWalk(this.root,d,t,n,r,{leaf:h,candidateSegment:e,continuePredicate:c});if(void 0===e.parent)throw new Error(`MergeTree insert failed: ${JSON.stringify({currentSeq:this.collabWindow.currentSeq,minSeq:this.collabWindow.minSeq,segSeq:e.seq})}`);this.updateRoot(s),u(e),d+=e.cachedLength}}ensureIntervalBoundary(e,t,n){const r=this.insertingWalk(this.root,e,t,n,P,{leaf:this.splitLeafSegment});this.updateRoot(r)}breakTie(e,t,n){var r;return!t.isLeaf()||0===e&&(n===O?Number.MAX_SAFE_INTEGER:n)>(t.seq===O?Number.MAX_SAFE_INTEGER-1:null!==(r=t.seq)&&void 0!==r?r:0)}leftExcursion(e,t){let n=!0,r=e,i=r.parent;for(;i;){const e=i.children;let s,o,a=!1;for(s=i.childCount-1;s>=0;s--)if(o=e[s],a){if(o.isLeaf())n=t(o,0,0,this.collabWindow.clientId,0,0,void 0);else{const e=o;n=this.nodeMapReverse(e,t,0,0,this.collabWindow.clientId)}if(!n)return}else a=r===o;r=i,i=i.parent}}rightExcursion(e,t){let n=!0,r=e,i=r.parent;for(;i;){const e=i.children;let s,o,a=!1;for(s=0;s<i.childCount;s++)if(o=e[s],a){if(o.isLeaf())n=t(o);else{const e=o;n=this.walkAllSegments(e,t)}if(!n)return}else a=r===o;r=i,i=i.parent}}insertingWalk(e,t,n,r,i,s){let o=t;const a=e.children;let c,l,u,h;for(c=0;c<e.childCount;c++){l=a[c];const t=this.nodeLength(l,n,r);if(void 0!==t){if(o<t||o===t&&this.breakTie(o,l,i)){if(l.isLeaf()){const t=l,n=s.leaf(t,o,s);if(n.replaceCurrent&&(e.assignChild(n.replaceCurrent,c,!1),n.replaceCurrent.ordinal=l.ordinal),!n.next)return void(s.structureChange&&this.nodeUpdateLengthNewStructure(e));u=n.next,c++}else{const a=l,d=this.insertingWalk(a,o,n,r,i,s);if(void 0===d)return void(s.structureChange?this.nodeUpdateLengthNewStructure(e):this.blockUpdateLength(e,i,r));if(d===Ge.theUnfinishedNode){o-=t;continue}u=d,h=d,c++}break}o-=t}}if(!u&&0===o){if(i!==O&&s.continuePredicate&&s.continuePredicate(e))return Ge.theUnfinishedNode;u=s.leaf(void 0,o,s).next}if(u){for(let t=e.childCount;t>c;t--)e.children[t]=e.children[t-1],e.children[t].index=t;return e.assignChild(u,c,!1),e.childCount++,e.setOrdinal(u,c),e.childCount<8?(h&&this.nodeUpdateOrdinals(h),void(s.structureChange?this.nodeUpdateLengthNewStructure(e):this.blockUpdateLength(e,i,r))):this.split(e)}}split(e){const t=this.makeBlock(4);e.childCount=4,this.nodeUpdateOrdinals(e);for(let n=0;n<4;n++)t.assignChild(e.children[4+n],n,!1),e.children[4+n]=void 0;return this.nodeUpdateLengthNewStructure(e),this.nodeUpdateLengthNewStructure(t),t}nodeUpdateOrdinals(e){for(let t=0;t<e.childCount;t++){const n=e.children[t];e.setOrdinal(n,t),n.isLeaf()||this.nodeUpdateOrdinals(n)}}annotateRange(e,t,n,r,i,s,o,a){this.ensureIntervalBoundary(e,i,s),this.ensureIntervalBoundary(t,i,s);const c=[],l=o===O?++this.collabWindow.localSeq:void 0;let u;this.mapRange({leaf:e=>{const t=e.addProperties(n,r,o,this.collabWindow);return c.push({segment:e,propertyDeltas:t}),this.collabWindow.collaborating&&(o===O?u=this.addToPendingList(e,u,l):Ge.options.zamboniSegments&&this.addToLRUSet(e,o)),!0}},i,s,void 0,e,t),this.mergeTreeDeltaCallback&&c.length>0&&this.mergeTreeDeltaCallback(a,{operation:v.ANNOTATE,deltaSegments:c}),this.collabWindow.collaborating&&o!==O&&Ge.options.zamboniSegments&&this.zamboniSegments()}markRangeRemoved(e,t,n,r,i,s=!1,o){let a,c=s;this.ensureIntervalBoundary(e,n,r),this.ensureIntervalBoundary(t,n,r);const l=[],u=[],h=i===O?++this.collabWindow.localSeq:void 0;this.mapRange({leaf:(e,t,n,s)=>{const o=be(e);return void 0!==o?(c=!0,o.removedSeq===O?(o.removedClientIds.unshift(r),o.removedSeq=i,e.localRemovedSeq=void 0):o.removedClientIds.push(r)):(e.removedClientIds=[r],e.removedSeq=i,e.localRemovedSeq=h,l.push({segment:e})),e.localRefs&&!e.localRefs.empty&&u.push(e),this.collabWindow.collaborating&&(e.removedSeq===O&&r===this.collabWindow.clientId?a=this.addToPendingList(e,a,h):Ge.options.zamboniSegments&&this.addToLRUSet(e,i)),!0},post:(e,t,n,s)=>(c?this.nodeUpdateLengthNewStructure(e):this.blockUpdateLength(e,i,r),!0)},n,r,void 0,e,t);const d=this.collabWindow.collaborating&&r===this.collabWindow.clientId;for(const e of u)this.updateSegmentRefsAfterMarkRemoved(e,d);this.mergeTreeDeltaCallback&&l.length>0&&this.mergeTreeDeltaCallback(o,{operation:v.REMOVE,deltaSegments:l}),this.collabWindow.collaborating&&i!==O&&Ge.options.zamboniSegments&&this.zamboniSegments()}nodeUpdateLengthNewStructure(e,t=!1){this.blockUpdate(e),this.collabWindow.collaborating&&(e.partialLengths=ye.combine(this,e,this.collabWindow,t))}removeLocalReferencePosition(e){var t;const n=e.getSegment();if(n){const r=null===(t=null==n?void 0:n.localRefs)||void 0===t?void 0:t.removeLocalRef(e);return void 0!==r&&this.blockUpdatePathLengths(n.parent,P,R),r}}createLocalReferencePosition(e,t,n,r,i){var s;if(function(e){return void 0!==be(e)}(e)&&!S(n,m.SlideOnRemove|m.Transient))throw new y.Oi("Can only create SlideOnRemove or Transient local reference position on a removed segment");const o=null!==(s=e.localRefs)&&void 0!==s?s:new Q(e);e.localRefs=o;const a=o.createLocalRef(t,n,r,i);return this.blockUpdatePathLengths(e.parent,P,R),a}removeLocalReference(e,t){e.localRefs&&e.localRefs.removeLocalRef(t)&&this.blockUpdatePathLengths(e.parent,P,R)}addLocalReference(e){const t=e.segment;let n=t.localRefs;n||(n=new Q(t),t.localRefs=n),n.addLocalRef(e),this.blockUpdatePathLengths(t.parent,P,R)}blockUpdate(e){var t;let n=0;const r=e.hierBlock();r&&(r.rightmostTiles=_(),r.leftmostTiles=_(),r.rangeStacks={});for(let s=0;s<e.childCount;s++){const o=e.children[s];n+=null!==(this,t=(i=o).isLeaf()?this.localNetLength(i):i.cachedLength)&&void 0!==t?t:0,r&&r.addNodeReferences(this,o),this.blockUpdateActions&&this.blockUpdateActions.child(e,s)}var i;e.cachedLength=n}blockUpdatePathLengths(e,t,n,r=!1){let i=e;for(;void 0!==i;)r?this.nodeUpdateLengthNewStructure(i):this.blockUpdateLength(i,t,n),i=i.parent}blockUpdateLength(e,t,n){this.blockUpdate(e),this.collabWindow.collaborating&&t!==O&&t!==P&&(void 0!==e.partialLengths&&Ge.options.incrementalUpdate&&n!==I?e.partialLengths.update(this,e,t,n,this.collabWindow):e.partialLengths=ye.combine(this,e,this.collabWindow))}map(e,t,n,r){this.nodeMap(this.root,e,0,t,n,r)}mapRange(e,t,n,r,i,s,o=!1){o&&(i&&this.ensureIntervalBoundary(i,t,n),s&&this.ensureIntervalBoundary(s,t,n)),this.nodeMap(this.root,e,0,t,n,r,i,s)}incrementalBlockMap(e){for(var t;!e.empty();){const n=e.top();if(n.op!==Re.Go)return;if(0===n.childIndex&&(void 0===n.start&&(n.start=0),void 0===n.end&&(n.end=this.blockLength(n.block,n.refSeq,n.clientId)),n.actions.pre&&n.actions.pre(n)),n.op===Re.Go&&n.childIndex<n.block.childCount){const r=n.block.children[n.childIndex],i=null!==(t=this.nodeLength(r,n.refSeq,n.clientId))&&void 0!==t?t:0;if(i>0&&n.start<i&&n.end>0)if(r.isLeaf())n.actions.leaf(r,n);else{const t=new Ie(r,n.actions,n.pos,n.refSeq,n.clientId,n.context,n.start,n.end,0);e.push(t)}n.pos+=i,n.start-=i,n.end-=i,n.childIndex++}else n.childIndex===n.block.childCount&&(n.op===Re.Go&&n.actions.post&&n.actions.post(n),e.pop())}}nodeMap(e,t,n,r,i,s,o,a){var c;let l=o,u=a,h=n;void 0===l&&(l=0),void 0===u&&(u=this.blockLength(e,r,i));let d=!0;if(t.pre&&(d=t.pre(e,h,r,i,l,u,s),!d))return!0;const p=e.children;for(let n=0;n<e.childCount;n++){const e=p[n],o=null!==(c=this.nodeLength(e,r,i))&&void 0!==c?c:0;if(d&&u>0&&o>0&&l<o&&(e.isLeaf()?t.leaf&&(d=t.leaf(e,h,r,i,l,u,s)):d&&(d=this.nodeMap(e,t,h,r,i,s,l,u))),!d)break;t.shift&&t.shift(e,h,r,i,l,u,s),h+=o,l-=o,u-=o}return d&&t.post&&(d=t.post(e,h,r,i,l,u,s)),d}walkAllSegments(e,t,n){let r=!0;const i=e.children;for(let s=0;r&&s<e.childCount;s++){const e=i[s];r=e.isLeaf()?t(e,n):this.walkAllSegments(e,t,n)}return r}nodeMapReverse(e,t,n,r,i){let s=!0;const o=e.children;for(let a=e.childCount-1;a>=0;a--){const e=o[a];if(s&&(e.isLeaf()?s=t(e,n,r,i,0,0,void 0):s&&(s=this.nodeMapReverse(e,t,n,r,i))),!s)break}return s}}Ge.zamboniSegmentsMaxCount=2,Ge.options={incrementalUpdate:!0,insertAfterRemovedSegs:!0,zamboniSegments:!0},Ge.theUnfinishedNode={childCount:-1};class We extends Ne{constructor(e){super(),this.text=e,this.type=We.type,this.cachedLength=e.length}static is(e){return e.type===We.type}static make(e,t){const n=new We(e);return t&&n.addProperties(t),n}static fromJSONObject(e){if("string"==typeof e)return new We(e);if(e&&"object"==typeof e&&"text"in e){const t=e;return We.make(t.text,t.props)}}toJSONObject(){return this.properties?{text:this.text,props:this.properties}:this.text}clone(e=0,t){const n=this.text.substring(e,t),r=We.make(n,this.properties);return this.cloneInto(r),r}canAppend(e){return!this.text.endsWith("\n")&&We.is(e)&&(this.cachedLength<=256||e.cachedLength<=256)}toString(){return this.text}append(e){if(!We.is(e))throw new Error("can only append text segment");Q.append(this,e),this.text+=e.text,this.cachedLength=this.text.length}removeRange(e,t){let n="";const r=this.text.length;return e>0&&(n+=this.text.substring(0,e)),t<r&&(n+=this.text.substring(t)),this.text=n,this.cachedLength=n.length,0===n.length}createSplitSegmentAt(e){if(e>0){const t=this.text.substring(e);return this.text=this.text.substring(0,e),this.cachedLength=this.text.length,new We(t)}}}function Ke(e){return!0===e.parallelArrays}We.type="TextSegment";class $e{constructor(e){this.mergeTree=e,this.gatherText=(e,t,n,r,i,s,o)=>{var a,c;let l=i;if(We.is(e)){let t="",n="";if(Ke(o)){const r=[],i=[];(null===(a=e.properties)||void 0===a?void 0:a["font-weight"])&&r.push("b"),(null===(c=e.properties)||void 0===c?void 0:c["text-decoration"])&&r.push("u");const s=[];if(r.length>0){for(const e of r)o.tagsInProgress.includes(e)||(t+=`<${e}>`,i.push(e));for(const e of o.tagsInProgress)r.includes(e)||(n+=`</${e}>`,s.push(e));for(const e of i.reverse())o.tagsInProgress.push(e)}else for(const e of o.tagsInProgress)n+=`</${e}>`,s.push(e);for(const e of s){const t=o.tagsInProgress.indexOf(e);t>=0&&o.tagsInProgress.splice(t,1)}}o.textSegment.text+=n,o.textSegment.text+=t,l<=0&&s>=e.text.length?o.textSegment.text+=e.text:(l<0&&(l=0),s>=e.text.length?o.textSegment.text+=e.text.substring(l):o.textSegment.text+=e.text.substring(l,s))}else if(o.placeholder&&o.placeholder.length>0)if("*"===o.placeholder){const t=e;o.textSegment.text+=`\n${t.toString()}`}else for(let t=0;t<e.cachedLength;t++)o.textSegment.text+=o.placeholder;else if(Ke(o)){const t=e;t.hasTileLabel(o.parallelMarkerLabel)&&(o.parallelMarkers.push(t),o.parallelText.push(o.textSegment.text),o.textSegment.text="")}return!0}}getTextAndMarkers(e,t,n,r,i){const s=this.getValidRange(r,i,e,t),o={parallelArrays:!0,parallelMarkerLabel:n,parallelMarkers:[],parallelText:[],tagsInProgress:[],textSegment:new We("")};return this.mergeTree.mapRange({leaf:this.gatherText},e,t,o,s.start,s.end),{parallelText:o.parallelText,parallelMarkers:o.parallelMarkers}}getText(e,t,n="",r,i){const s=this.getValidRange(r,i,e,t),o={textSegment:new We(""),placeholder:n};return this.mergeTree.mapRange({leaf:this.gatherText},e,t,o,s.start,s.end),o.textSegment.text}getValidRange(e,t,n,r){return{end:null!=t?t:this.mergeTree.getLength(n,r),start:null!=e?e:0}}}class Je{constructor(){this.completed=!1,this.p=new Promise(((e,t)=>{this.res=e,this.rej=t}))}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){void 0!==this.res&&(this.completed=!0,this.res(e))}reject(e){void 0!==this.rej&&(this.completed=!0,this.rej(e))}}Symbol.toStringTag;var Qe=n(9742);const Xe=(e,t)=>Ye.from(e).toString(t);function Ze(e){const t=e;return e instanceof ArrayBuffer||"object"==typeof t&&null!==t&&"number"==typeof t.byteLength&&"function"==typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}class Ye extends Uint8Array{toString(e){return function(e,t){switch(t){case"base64":return Qe.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}(this,e)}static from(e,t,n){if("string"==typeof e)return Ye.fromString(e,t);if(null!==e&&"object"==typeof e&&Ze(e.buffer))return p(0===e.byteOffset,0),p(e.byteLength===e.buffer.byteLength,1),Ye.fromArrayBuffer(e.buffer,t,n);if(Ze(e))return Ye.fromArrayBuffer(e,t,n);throw new TypeError}static fromArrayBuffer(e,t,n){const r=null!=t?t:0,i=null!=n?n:e.byteLength-r;if(r<0||r>e.byteLength||i<0||i+r>e.byteLength)throw new RangeError;return new Ye(e,r,i)}static fromString(e,t){switch(t){case"base64":{const t=this.sanitizeBase64(e),n=Qe.toByteArray(t);return new Ye(n.buffer)}case"utf8":case"utf-8":case void 0:{const t=(new TextEncoder).encode(e);return new Ye(t.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!=0&&(t+=["","===","==","="][t.length%4]),t}}var et,tt,nt,rt,it=n(2738);!function(e){e.NoOp="noop",e.ClientJoin="join",e.ClientLeave="leave",e.Propose="propose",e.Reject="reject",e.Summarize="summarize",e.SummaryAck="summaryAck",e.SummaryNack="summaryNack",e.Operation="op",e.RemoteHelp="remoteHelp",e.NoClient="noClient",e.RoundTrip="tripComplete",e.Control="control"}(et||(et={})),function(e){e.ThrottlingError="ThrottlingError",e.InvalidScopeError="InvalidScopeError",e.BadRequestError="BadRequestError",e.LimitExceededError="LimitExceededError"}(tt||(tt={})),function(e){e.NoOp="noop",e.ClientJoin="join",e.ClientLeave="leave",e.Propose="propose",e.Reject="reject",e.Summarize="summarize",e.SummaryAck="summaryAck",e.SummaryNack="summaryNack",e.Operation="op",e.RemoteHelp="remoteHelp",e.NoClient="noClient",e.RoundTrip="tripComplete",e.Control="control"}(nt||(nt={})),function(e){e.ThrottlingError="ThrottlingError",e.InvalidScopeError="InvalidScopeError",e.BadRequestError="BadRequestError",e.LimitExceededError="LimitExceededError"}(rt||(rt={}));const st=window.performance;class ot{constructor(e){this.startTick=e,this.lastTick=e}static start(){const e=st.now();return new ot(e)}trace(){const e=st.now(),t={totalTimeElapsed:e-this.startTick,duration:e-this.lastTick,tick:e};return this.lastTick=e,t}}function at(e,t,n,r){return{combiningOp:r,pos1:e,pos2:t,props:n,type:v.ANNOTATE}}function ct(e,t){return{pos1:e,pos2:t,type:v.REMOVE}}function lt(e,t){return ut(e,t.toJSONObject())}function ut(e,t){return{pos1:e,seg:t,type:v.INSERT}}function ht(...e){return{ops:e,type:v.GROUP}}var dt=n(8991);function pt(e,t,n,r,i,s){let o;switch(void 0!==t.version&&n.send({eventName:"MergeTreeChunk:serializeAsMinSupportedVersion",category:"generic",fromChunkVersion:t.version,toChunkVersion:void 0}),t.version){case void 0:o=t,o.headerMetadata=mt(e,o);break;case"1":const n=t,r=e===yt.header?n.headerMetadata:void 0;o={version:void 0,chunkStartSegmentIndex:n.startIndex,chunkLengthChars:n.length,chunkSegmentCount:n.segmentCount,segmentTexts:n.segments,totalLengthChars:null==r?void 0:r.totalLength,totalSegmentCount:null==r?void 0:r.totalSegmentCount,chunkSequenceNumber:null==r?void 0:r.sequenceNumber,chunkMinSequenceNumber:null==r?void 0:r.minSequenceNumber,headerMetadata:r};break;default:throw new Error(`Unsupported chunk path: ${e} version: ${t.version}`)}return i.stringify(o,s)}function ft(e,t,n,r,i,s){const o=gt(e,t,0,r);return i.stringify(o,s)}function gt(e,t,n,r){switch(t.version){case void 0:{const n=t;return{version:"1",length:n.chunkLengthChars,segmentCount:n.chunkSegmentCount,headerMetadata:mt(e,n),segments:n.segmentTexts,startIndex:n.chunkStartSegmentIndex}}case"1":return t;default:throw new Error(`Unsupported chunk path: ${e} version: ${t.version}`)}}function mt(e,t,n){if(e===yt.header){if(void 0!==t.headerMetadata)return t.headerMetadata;const e=[{id:yt.header}];return t.chunkLengthChars<t.totalLengthChars&&e.push({id:yt.body}),{orderedChunkMetadata:e,minSequenceNumber:t.chunkMinSequenceNumber,sequenceNumber:t.chunkSequenceNumber,totalLength:t.totalLengthChars,totalSegmentCount:t.totalSegmentCount}}}class yt{constructor(e,t,n,r){var i,s;this.mergeTree=e,this.filename=n,this.onCompletion=r,this.logger=it.G2.create(t,"Snapshot"),this.chunkSize=null!==(s=null===(i=null==e?void 0:e.options)||void 0===i?void 0:i.mergeTreeSnapshotChunkSize)&&void 0!==s?s:yt.sizeOfFirstChunk}getSeqLengthSegs(e,t,n,r=0){const i=[];let s=0,o=0;for(;s<n&&r+o<e.length;){const n=e[r+o];i.push(n),s+=t[r+o],o++}return{version:void 0,chunkStartSegmentIndex:r,chunkSegmentCount:o,chunkLengthChars:s,totalLengthChars:this.header.segmentsTotalLength,totalSegmentCount:e.length,chunkSequenceNumber:this.header.seq,segmentTexts:i}}emit(e,t,n){var r,i;const s=this.getSeqLengthSegs(this.segments,this.segmentLengths,this.chunkSize);let o=s.chunkLengthChars,a=s.chunkSegmentCount;const c=new dt.x1;if(c.addBlob(yt.header,pt(yt.header,s,this.logger,this.mergeTree.options,t,n)),s.chunkSegmentCount<s.totalSegmentCount){const e=this.getSeqLengthSegs(this.segments,this.segmentLengths,this.header.segmentsTotalLength,s.chunkSegmentCount);o+=e.chunkLengthChars,a+=e.chunkSegmentCount,c.addBlob(yt.body,pt(yt.body,e,this.logger,this.mergeTree.options,t,n))}return N(o===this.header.segmentsTotalLength,93),N(a===s.totalSegmentCount,94),void 0!==e&&e.length>0&&c.addBlob(null!==(i=null===(r=this.mergeTree.options)||void 0===r?void 0:r.catchUpBlobName)&&void 0!==i?i:yt.catchupOps,t?t.stringify(e,n):JSON.stringify(e)),c.getSummaryTree()}extractSync(){const e=this.mergeTree.getCollabWindow();this.seq=e.minSeq,this.header={segmentsTotalLength:this.mergeTree.getLength(this.mergeTree.collabWindow.minSeq,I),seq:this.mergeTree.collabWindow.minSeq};const t=[];let n;this.mergeTree.map({leaf:(e,r,i,s,o,a)=>(e.seq!==O&&e.seq<=this.seq&&(void 0===e.removedSeq||e.removedSeq===O||e.removedSeq>this.seq)&&((null==n?void 0:n.canAppend(e))&&D(n.properties,e.properties)?(n=n.clone(),n.append(e.clone())):(n&&t.push(n),n=e)),!0)},this.seq,I,void 0),n&&t.push(n),this.segments=[],this.segmentLengths=[];let r=0;return t.map((e=>{r+=e.cachedLength,this.segments.push(e.toJSONObject()),this.segmentLengths.push(e.cachedLength)})),this.header.segmentsTotalLength!==r&&(this.logger.sendErrorEvent({eventName:"SegmentsTotalLengthMismatch",totalLength:r,segmentsTotalLength:this.header.segmentsTotalLength}),this.header.segmentsTotalLength=r),this.segments}}yt.header="header",yt.body="body",yt.catchupOps="catchupOps",yt.sizeOfFirstChunk=1e4;const vt=(e,t)=>St.from(e).toString(t);function bt(e){const t=e;return e instanceof ArrayBuffer||"object"==typeof t&&null!==t&&"number"==typeof t.byteLength&&"function"==typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}class St extends Uint8Array{toString(e){return function(e,t){switch(t){case"base64":return Qe.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}(this,e)}static from(e,t,n){if("string"==typeof e)return St.fromString(e,t);if(null!==e&&"object"==typeof e&&bt(e.buffer))return N(0===e.byteOffset,0),N(e.byteLength===e.buffer.byteLength,1),St.fromArrayBuffer(e.buffer,t,n);if(bt(e))return St.fromArrayBuffer(e,t,n);throw new TypeError}static fromArrayBuffer(e,t,n){const r=null!=t?t:0,i=null!=n?n:e.byteLength-r;if(r<0||r>e.byteLength||i<0||i+r>e.byteLength)throw new RangeError;return new St(e,r,i)}static fromString(e,t){switch(t){case"base64":{const t=this.sanitizeBase64(e),n=Qe.toByteArray(t);return new St(n.buffer)}case"utf8":case"utf-8":case void 0:{const t=(new TextEncoder).encode(e);return new St(t.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!=0&&(t+=["","===","==","="][t.length%4]),t}}class wt{constructor(e,t,n,r,i){var s,o;this.mergeTree=e,this.getLongClientId=n,this.filename=r,this.onCompletion=i,this.logger=it.G2.create(t,"Snapshot"),this.chunkSize=null!==(o=null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.mergeTreeSnapshotChunkSize)&&void 0!==o?o:wt.chunkSize;const{currentSeq:a,minSeq:c}=e.getCollabWindow();this.header={minSequenceNumber:c,sequenceNumber:a,orderedChunkMetadata:[],totalLength:0,totalSegmentCount:0},this.segments=[],this.segmentLengths=[]}getSeqLengthSegs(e,t,n,r=0){const i=[];let s=0,o=0;for(;s<n&&r+o<e.length;){const n=e[r+o];i.push(n),s+=t[r+o],o++}return{version:"1",segmentCount:o,length:s,segments:i,startIndex:r,headerMetadata:void 0}}emit(e,t){const n=[];this.header.totalSegmentCount=0,this.header.totalLength=0;do{const e=this.getSeqLengthSegs(this.segments,this.segmentLengths,this.chunkSize,this.header.totalSegmentCount);n.push(e),this.header.totalSegmentCount+=e.segmentCount,this.header.totalLength+=e.length}while(this.header.totalSegmentCount<this.segments.length);const r=n.shift();r.headerMetadata=this.header,r.headerMetadata.orderedChunkMetadata=[{id:yt.header}];const i=[];n.forEach(((n,r)=>{const s=`${yt.body}_${r}`;this.header.orderedChunkMetadata.push({id:s}),i.push([s,ft(s,n,this.logger,this.mergeTree.options,e,t)])}));const s=new dt.x1;return s.addBlob(yt.header,ft(yt.header,r,this.logger,this.mergeTree.options,e,t)),i.forEach((e=>{s.addBlob(e[0],e[1])})),s.getSummaryTree()}extractSync(){const e=this.mergeTree,t=this.header.minSequenceNumber,n=(e,t)=>{this.segments.push(e),this.segmentLengths.push(t)},r=e=>{e&&n(e.toJSONObject(),e.cachedLength)};let i;return e.walkAllSegments(e.root,(e=>{var s;if(e.seq===O||e.removedSeq<=t)return!0;if(e.seq<=t&&(void 0===e.removedSeq||e.removedSeq===O))i?i.canAppend(e)&&D(i.properties,e.properties)?(i=i.clone(),i.append(e.clone())):(r(i),i=e):i=e;else{r(i),i=void 0;const o={json:e.toJSONObject()};e.seq>t&&(o.seq=e.seq,o.client=this.getLongClientId(e.clientId)),void 0!==e.removedSeq&&(N(e.removedSeq!==O&&e.removedSeq>t,101),o.removedSeq=e.removedSeq,o.removedClient=void 0!==e.removedClientIds?this.getLongClientId(e.removedClientIds[0]):void 0,o.removedClientIds=null===(s=e.removedClientIds)||void 0===s?void 0:s.map((e=>this.getLongClientId(e)))),N(void 0!==o.seq&&void 0!==o.client||void 0!==o.removedSeq&&void 0!==o.removedClient,102),n(o,e.cachedLength)}return!0}),this),r(i),this.segments}static async loadChunk(e,t,n,r,i){const s=await e.readBlob(t),o=vt(s,"utf8");return wt.processChunk(t,o,n,r,i)}static processChunk(e,t,n,r,i){return gt(e,i?i.parse(t):JSON.parse(t))}}wt.chunkSize=1e4;class xt{constructor(e,t,n,r,i){this.runtime=e,this.client=t,this.mergeTree=n,this.serializer=i,this.specToSegment=e=>{var t;let n;return function(e){return!!e&&"object"==typeof e&&"json"in e}(e)?(n=this.client.specToSegment(e.json),n.clientId=void 0!==e.client?this.client.getOrAddShortClientId(e.client):I,n.seq=void 0!==e.seq?e.seq:0,void 0!==e.removedSeq&&(n.removedSeq=e.removedSeq),void 0!==e.removedClient&&(n.removedClientIds=[this.client.getOrAddShortClientId(e.removedClient)]),void 0!==e.removedClientIds&&(n.removedClientIds=null===(t=e.removedClientIds)||void 0===t?void 0:t.map((e=>this.client.getOrAddShortClientId(e))))):(n=this.client.specToSegment(e),n.seq=0,n.clientId=I),n},this.logger=it.G2.create(r,"SnapshotLoader")}async initialize(e){const t=e.readBlob(yt.header).then((e=>(N(!!e,95),this.loadHeader(vt(e,"utf8"))))),n=this.loadBodyAndCatchupOps(t,e);return n.catch((e=>this.logger.sendErrorEvent({eventName:"CatchupOpsLoadFailure"},e))),await t,{catchupOpsP:n}}async loadBodyAndCatchupOps(e,t){const n=t.list(""),r=await e;await this.loadBody(r,t);const i=await n;if(i.length===r.headerMetadata.orderedChunkMetadata.length+1)return r.headerMetadata.orderedChunkMetadata.forEach((e=>i.splice(i.indexOf(e.id),1))),N(1===i.length,96),this.loadCatchupOps(t.readBlob(i[0]));if(i.length!==r.headerMetadata.orderedChunkMetadata.length)throw new Error("Unexpected blobs in snapshot");return[]}loadHeader(e){var t;const n=wt.processChunk(yt.header,e,this.logger,this.mergeTree.options,this.serializer),i=n.segments.map(this.specToSegment);if(this.mergeTree.reloadFromSegments(i),void 0===n.headerMetadata)throw new Error("header metadata not available");return this.runtime.attachState!==r.mB.Detached&&this.client.startOrUpdateCollaboration(null!==(t=this.runtime.clientId)&&void 0!==t?t:"snapshot",void 0!==n.headerMetadata.minSequenceNumber?n.headerMetadata.minSequenceNumber:n.headerMetadata.sequenceNumber,n.headerMetadata.sequenceNumber),n}async loadBody(e,t){if(N(e.length<=e.headerMetadata.totalLength,97),N(e.segmentCount<=e.headerMetadata.totalSegmentCount,98),e.segmentCount===e.headerMetadata.totalSegmentCount)return;const n=[];let r=e.length;for(let i=1;i<e.headerMetadata.orderedChunkMetadata.length;i++){const s=await wt.loadChunk(t,e.headerMetadata.orderedChunkMetadata[i].id,this.logger,this.mergeTree.options,this.serializer);r+=s.length,n.push(...s.segments.map(this.specToSegment))}N(r===e.headerMetadata.totalLength,99),N(e.segmentCount+n.length===e.headerMetadata.totalSegmentCount,100);const i=this.mergeTree,s=(e,t,n)=>{i.insertSegments(i.root.cachedLength,e,0,t,n,void 0)},o=[],a=()=>{o.length>0&&s(o,I,0)};for(const e of n){const t=e.clientId,n=e.seq;t===I&&0===n?o.push(e):(a(),s([e],t,n))}a()}async loadCatchupOps(e){return JSON.parse(vt(await e,"utf8"))}}function Ct(e){return 1e3*e.trace().duration}class Et{constructor(e,t,n){this.specToSegment=e,this.logger=t,this.measureOps=!1,this.accumTime=0,this.localTime=0,this.localOps=0,this.accumWindowTime=0,this.accumWindow=0,this.accumOps=0,this.maxWindowTime=0,this.clientNameToIds=new G(Me),this.shortClientIdMap=[],this.pendingConsensus=new Map,this.mergeTree=new Ge(n)}get mergeTreeDeltaCallback(){return this.mergeTree.mergeTreeDeltaCallback}set mergeTreeDeltaCallback(e){this.mergeTree.mergeTreeDeltaCallback=e}get mergeTreeMaintenanceCallback(){return this.mergeTree.mergeTreeMaintenanceCallback}set mergeTreeMaintenanceCallback(e){this.mergeTree.mergeTreeMaintenanceCallback=e}peekPendingSegmentGroups(e=1){var t,n;if(1===e)return null===(t=this.mergeTree.pendingSegments)||void 0===t?void 0:t.last();let r=0;return null===(n=this.mergeTree.pendingSegments)||void 0===n?void 0:n.some((()=>r<e&&(r++,!0)),!0)}annotateMarkerNotifyConsensus(e,t,n){const r=this.annotateMarker(e,t,{name:"consensus"});if(r){const t={callback:n,marker:e};return this.pendingConsensus.set(e.getId(),t),r}}annotateMarker(e,t,n){const r=function(e,t,n){const r=e.getId();if(r)return{combiningOp:n,props:t,relativePos1:{id:r,before:!0},relativePos2:{id:r},type:v.ANNOTATE}}(e,t,n);return this.applyAnnotateRangeOp({op:r})?r:void 0}annotateRangeLocal(e,t,n,r){const i=at(e,t,n,r);if(this.applyAnnotateRangeOp({op:i}))return i}removeRangeLocal(e,t){const n=ct(e,t);if(this.applyRemoveRangeOp({op:n}))return n}insertSegmentLocal(e,t){if(t.cachedLength<=0)return;const n=lt(e,t);return this.applyInsertOp({op:n})?n:void 0}insertAtReferencePositionLocal(e,t){const n=this.mergeTree.referencePositionToLocalPosition(e,this.getCurrentSeq(),this.getClientId());if(n===$.DetachedPosition)return;const r=lt(n,t),i={op:r};let s;return this.measureOps&&(s=ot.start()),this.mergeTree.insertAtReferencePosition(e,t,i),this.completeAndLogOp(i,this.getClientSequenceArgs(i),{start:r.pos1},s),r}walkSegments(e,t,n,r,i=!1){this.mergeTree.mapRange({leaf:e},this.getCurrentSeq(),this.getClientId(),r,t,n,i)}serializeGCData(e,t){this.mergeTree.walkAllSegments(this.mergeTree.root,(n=>(void 0===n.removedSeq&&t.stringify(n.clone().toJSONObject(),e),!0)))}getCollabWindow(){return this.mergeTree.getCollabWindow()}getPosition(e){return void 0===(null==e?void 0:e.parent)?-1:this.mergeTree.getPosition(e,this.getCurrentSeq(),this.getClientId())}addLocalReference(e){return this.mergeTree.addLocalReference(e)}removeLocalReference(e){return this.removeLocalReferencePosition(e)}createLocalReferencePosition(e,t,n,r){return this.mergeTree.createLocalReferencePosition(e,t,n,r,this)}removeLocalReferencePosition(e){return this.mergeTree.removeLocalReferencePosition(e)}localReferencePositionToPosition(e){return this.mergeTree.referencePositionToLocalPosition(e)}posFromRelativePos(e){return this.mergeTree.posFromRelativePos(e)}getMarkerFromId(e){return this.mergeTree.getMarkerFromId(e)}applyRemoveRangeOp(e){N(e.op.type===v.REMOVE,45);const t=e.op,n=this.getClientSequenceArgs(e),r=this.getValidOpRange(t,n);if(!r)return!1;let i;return this.measureOps&&(i=ot.start()),this.mergeTree.markRangeRemoved(r.start,r.end,n.referenceSequenceNumber,n.clientId,n.sequenceNumber,!1,e),this.completeAndLogOp(e,n,r,i),!0}applyAnnotateRangeOp(e){N(e.op.type===v.ANNOTATE,46);const t=e.op,n=this.getClientSequenceArgs(e),r=this.getValidOpRange(t,n);if(!r)return!1;let i;return this.measureOps&&(i=ot.start()),this.mergeTree.annotateRange(r.start,r.end,t.props,t.combiningOp,n.referenceSequenceNumber,n.clientId,n.sequenceNumber,e),this.completeAndLogOp(e,n,r,i),!0}applyInsertOp(e){N(e.op.type===v.INSERT,47);const t=e.op,n=this.getClientSequenceArgs(e),r=this.getValidOpRange(t,n);if(!r)return!1;let i,s;return t.seg&&(i=[this.specToSegment(t.seg)]),!(!i||0===i.length||(this.measureOps&&(s=ot.start()),this.mergeTree.insertSegments(r.start,i,n.referenceSequenceNumber,n.clientId,n.sequenceNumber,e),this.completeAndLogOp(e,n,r,s),0))}completeAndLogOp(e,t,n,r){e.sequencedMessage?(N(this.mergeTree.getCollabWindow().currentSeq<t.sequenceNumber,48),N(this.mergeTree.getCollabWindow().minSeq<=e.sequencedMessage.minimumSequenceNumber,49),r&&(this.accumTime+=Ct(r),this.accumOps++,this.accumWindow+=this.getCurrentSeq()-this.getCollabWindow().minSeq)):r&&(this.localTime+=Ct(r),this.localOps++)}getValidOpRange(e,t){let n=e.pos1;void 0===n&&e.relativePos1&&(n=this.mergeTree.posFromRelativePos(e.relativePos1,t.referenceSequenceNumber,t.clientId));let r=e.pos2;if(void 0===r&&e.relativePos2&&(r=this.mergeTree.posFromRelativePos(e.relativePos2,t.referenceSequenceNumber,t.clientId)),t.clientId===this.getClientId()){const t=this.getLength(),i=[];if((void 0===n||n<0||n>t||n===t&&e.type!==v.INSERT)&&i.push("start"),e.type===v.INSERT&&void 0===r||(void 0===r||r<=n)&&i.push("end"),i.length>0)throw new X.j4("RangeOutOfBounds",{usageError:!0,end:r,invalidPositions:i.toString(),length:t,opPos1:e.pos1,opPos1Relative:void 0!==e.relativePos1,opPos2:e.pos2,opPos2Relative:void 0!==e.relativePos2,opType:e.type,start:n})}return{start:n,end:r}}getClientSequenceArgsForMessage(e){if(e)return{clientId:this.getOrAddShortClientId(e.clientId),referenceSequenceNumber:e.referenceSequenceNumber,sequenceNumber:e.sequenceNumber};{const e=this.getCollabWindow();return{clientId:e.clientId,referenceSequenceNumber:e.currentSeq,sequenceNumber:this.getLocalSequenceNumber()}}}getClientSequenceArgs(e){return this.getClientSequenceArgsForMessage(e.sequencedMessage)}ackPendingSegment(e){const t=e=>{let t;this.measureOps&&(t=ot.start()),this.mergeTree.ackPendingSegment(e),e.op.type===v.ANNOTATE&&e.op.combiningOp&&"consensus"===e.op.combiningOp.name&&this.updateConsensusProperty(e.op,e.sequencedMessage),t&&(this.accumTime+=Ct(t),this.accumOps++,this.accumWindow+=this.getCurrentSeq()-this.getCollabWindow().minSeq)};if(e.op.type===v.GROUP)for(const n of e.op.ops)t({groupOp:e.op,op:n,sequencedMessage:e.sequencedMessage});else t(e)}cloneFromSegments(){const e=new Et(this.specToSegment,this.logger,this.mergeTree.options),t=this.mergeTree.blockClone(this.mergeTree.root,[]);return e.mergeTree.root=t,e}getOrAddShortClientId(e){return this.clientNameToIds.get(e)||this.addLongClientId(e),this.getShortClientId(e)}getShortClientId(e){return this.clientNameToIds.get(e).data}getLongClientId(e){return e>=0?this.shortClientIdMap[e]:"original"}addLongClientId(e){this.clientNameToIds.put(e,this.shortClientIdMap.length),this.shortClientIdMap.push(e)}findReconnectionPosition(e,t){N(t<=this.mergeTree.collabWindow.localSeq,50);let n=0;return this.mergeTree.walkAllSegments(this.mergeTree.root,(r=>r!==e&&((void 0===r.localSeq||r.localSeq<=t)&&(void 0===r.removedSeq||r.localRemovedSeq>t)&&(n+=r.cachedLength),!0))),n}rebasePosition(e,t,n){let r;N(n<=this.mergeTree.collabWindow.localSeq,768);let i=0,s=e;this.mergeTree.walkAllSegments(this.mergeTree.root,(o=>(N(void 0!==o.seq||void 0!==o.localSeq,769),r=o,(e=>void 0!==e.seq&&e.seq!==O&&e.seq<=t||void 0!==e.localSeq&&e.localSeq<=n)(o)&&!(({removedSeq:e,localRemovedSeq:r})=>void 0!==e&&e!==O&&e<=t||void 0!==r&&r<=n)(o)&&(i+=o.cachedLength,s>=o.cachedLength&&(s-=o.cachedLength)),i<=e))),N(void 0!==r,770);const o=this.getCollabWindow().currentSeq;return(void 0!==r.removedSeq&&r.removedSeq!==O&&r.removedSeq<=o||void 0!==r.localRemovedSeq&&r.localRemovedSeq<=n)&&(s=0),N(0<=s&&s<r.cachedLength,771),this.findReconnectionPosition(r,n)+s}resetPendingDeltaToOps(e,t){var n,r;N(!!t,51),N(t===(null===(n=this.mergeTree.pendingSegments)||void 0===n?void 0:n.dequeue()),52);const i=[];for(const n of t.segments.sort(((e,t)=>e.ordinal<t.ordinal?-1:1))){N(t===n.segmentGroups.dequeue(),53);const s=this.findReconnectionPosition(n,t.localSeq);let o;switch(e.type){case v.ANNOTATE:N(!0===(null===(r=n.propertyManager)||void 0===r?void 0:r.hasPendingProperties()),54),void 0!==n.removedSeq&&void 0===n.localRemovedSeq||(o=at(s,s+n.cachedLength,e.props,e.combiningOp));break;case v.INSERT:N(n.seq===O,55);let t=n;"object"==typeof e.seg&&void 0!==e.seg.props&&(t=n.clone(),t.properties=e.seg.props),o=lt(s,t);break;case v.REMOVE:void 0!==n.localRemovedSeq&&(o=ct(s,s+n.cachedLength));break;default:throw new Error("Invalid op type")}if(o){const e={segments:[],localSeq:t.localSeq};n.segmentGroups.enqueue(e),this.mergeTree.pendingSegments.enqueue(e),i.push(o)}}return i}applyRemoteOp(e){const t=e.op,n=e.sequencedMessage;switch(this.getOrAddShortClientId(n.clientId),t.type){case v.INSERT:this.applyInsertOp(e);break;case v.REMOVE:this.applyRemoveRangeOp(e);break;case v.ANNOTATE:this.applyAnnotateRangeOp(e);break;case v.GROUP:for(const e of t.ops)this.applyRemoteOp({op:e,groupOp:t,sequencedMessage:n})}}applyStashedOp(e){let t;switch(e.type){case v.INSERT:this.applyInsertOp({op:e}),t=this.peekPendingSegmentGroups();break;case v.REMOVE:this.applyRemoveRangeOp({op:e}),t=this.peekPendingSegmentGroups();break;case v.ANNOTATE:this.applyAnnotateRangeOp({op:e}),t=this.peekPendingSegmentGroups();break;case v.GROUP:return e.ops.map((e=>this.applyStashedOp(e)));default:!function(e,t="Unreachable Case"){throw new Error(t)}(0,"unrecognized op type")}return N(!!t,731),t}applyMsg(e,t=!1){var n;if(this.getOrAddShortClientId(e.clientId),e.type===nt.Operation){const r={op:e.contents,sequencedMessage:e};(null===(n=r.sequencedMessage)||void 0===n?void 0:n.clientId)===this.longClientId||t?this.ackPendingSegment(r):this.applyRemoteOp(r)}this.updateSeqNumbers(e.minimumSequenceNumber,e.sequenceNumber)}updateSeqNumbers(e,t){const n=this.mergeTree.getCollabWindow();N(n.currentSeq<=t,56),n.currentSeq=t,N(e<=t,57),this.updateMinSeq(e)}resolveRemoteClientPosition(e,t,n){const r=this.getOrAddShortClientId(n);return this.mergeTree.resolveRemoteClientPosition(e,t,r)}regeneratePendingOp(e,t){const n=[];if(e.type===v.GROUP)if(Array.isArray(t)){N(e.ops.length===t.length,58);for(let r=0;r<e.ops.length;r++)n.push(...this.resetPendingDeltaToOps(e.ops[r],t[r]))}else N(1===e.ops.length,59),n.push(...this.resetPendingDeltaToOps(e.ops[0],t));else N(e.type!==v.GROUP,60),N(!Array.isArray(t),61),n.push(...this.resetPendingDeltaToOps(e,t));return 1===n.length?n[0]:ht(...n)}createTextHelper(){return new $e(this.mergeTree)}summarize(e,t,n,r){var i;const s=e.deltaManager,o=s.minimumSequenceNumber;if(this.updateSeqNumbers(o,s.lastSequenceNumber),N(this.getCollabWindow().minSeq===o,62),!0===(null===(i=this.mergeTree.options)||void 0===i?void 0:i.newMergeTreeSnapshotFormat)){N(void 0===r||0===r.length,63);const e=new wt(this.mergeTree,this.logger,(e=>this.getLongClientId(e)));return e.extractSync(),e.emit(n,t)}{const e=new yt(this.mergeTree,this.logger);return e.extractSync(),e.emit(r,n,t)}}async load(e,t,n){return new xt(e,this,this.mergeTree,this.logger,n).initialize(t)}getStackContext(e,t){return this.mergeTree.getStackContext(e,this.getCollabWindow().clientId,t)}getLocalSequenceNumber(){return this.getCollabWindow().collaborating?O:0}localTransaction(e){for(const t of e.ops){const n={op:t,groupOp:e};switch(t.type){case v.INSERT:this.applyInsertOp(n);break;case v.ANNOTATE:this.applyAnnotateRangeOp(n);break;case v.REMOVE:this.applyRemoveRangeOp(n)}}}updateConsensusProperty(e,t){const n=e.relativePos1.id,r=this.pendingConsensus.get(n);r&&r.marker.addProperties(e.props,e.combiningOp,t.sequenceNumber),this.mergeTree.addMinSeqListener(t.sequenceNumber,(()=>r.callback(r.marker)))}updateMinSeq(e){let t;if(this.measureOps&&(t=ot.start()),this.mergeTree.setMinSeq(e),t){const e=Ct(t);this.accumWindowTime+=e,e>this.maxWindowTime&&(this.maxWindowTime=e)}}getContainingSegment(e,t){const n=this.getClientSequenceArgsForMessage(t);return this.mergeTree.getContainingSegment(e,n.referenceSequenceNumber,n.clientId)}getSlideToSegment(e){return this.mergeTree._getSlideToSegment(e)}getPropertiesAtPosition(e){let t;const n=this.getContainingSegment(e).segment;return n&&(t=n.properties),t}getRangeExtentsOfPosition(e){let t,n;const r=this.getContainingSegment(e).segment;return r&&(t=this.getPosition(r),n=t+r.cachedLength),{posStart:t,posAfterEnd:n}}getCurrentSeq(){return this.getCollabWindow().currentSeq}getClientId(){return this.getCollabWindow().clientId}getLength(){return this.mergeTree.length}startOrUpdateCollaboration(e,t=0,n=0){if(void 0!==e)if(void 0===this.longClientId)this.longClientId=e,this.addLongClientId(this.longClientId),this.mergeTree.startCollaboration(this.getShortClientId(this.longClientId),t,n);else{const t=this.longClientId,n=this.clientNameToIds.get(t).data;this.longClientId=e,this.clientNameToIds.put(e,n),this.shortClientIdMap[n]=e}}findTile(e,t,n=!0){const r=this.getClientId();return this.mergeTree.findTile(e,r,t,n)}}var Tt=n(8597),At=n(7583),kt=n(8343),Nt=n(4148);class Ot{constructor(e,t){this.value=e,this.valueType=t}get type(){return this.valueType.name}makeSerialized(e,t){const n=this.valueType.factory.store(this.value),r=(0,kt.Yv)(n,e,t);return{type:this.type,value:r}}getOpHandler(e){const t=this.valueType.ops.get(e);if(!t)throw new Error("Unknown type message");return t}}class Pt{constructor(e,t,n,r,i=new g){this.serializer=e,this.handle=t,this.submitMessage=n,this.type=r,this.eventEmitter=i,this.messageHandlers=new Map,this.data=new Map,this.messageHandlers=this.getMessageHandlers()}get size(){return this.data.size}keys(){return this.data.keys()}entries(){const e=this.data.entries();return{next(){const t=e.next();return t.done?{value:void 0,done:!0}:{value:[t.value[0],t.value[1].value],done:!1}},[Symbol.iterator](){return this}}}values(){const e=this.data.values();return{next(){const t=e.next();return t.done?{value:void 0,done:!0}:{value:t.value.value,done:!1}},[Symbol.iterator](){return this}}}[Symbol.iterator](){return this.entries()}forEach(e){this.data.forEach(((t,n,r)=>{e(t.value,n,r)}))}get(e){var t;return(null!==(t=this.data.get(e))&&void 0!==t?t:this.createCore(e,!0)).value}has(e){return this.data.has(e)}getSerializedStorage(e){const t={};return this.data.forEach(((n,r)=>{t[r]=n.makeSerialized(e,this.handle)})),t}getSerializableStorage(e){const t={};return this.data.forEach(((n,r)=>{t[r]=function(e,t,n){const r=e.makeSerialized(t,n);return{type:r.type,value:r.value&&JSON.parse(r.value)}}(n,e,this.handle)})),t}serialize(e){return JSON.stringify(this.getSerializableStorage(e))}populateFromSerializable(e){for(const[t,n]of Object.entries(e)){if(n.type===Nt.G[Nt.G.Plain]||n.type===Nt.G[Nt.G.Shared])continue;const e={key:t.startsWith("intervalCollections/")?t.substring(20):t,value:this.makeLocal(t,n)};this.data.set(e.key,e.value)}}populate(e){this.populateFromSerializable(JSON.parse(e))}tryResubmitMessage(e,t){const n=e.type,r=this.messageHandlers.get(n);return void 0!==r&&(r.resubmit(e,t),!0)}tryGetStashedOpLocalMetadata(e){const t=e.type;if(this.messageHandlers.has(t))return this.messageHandlers.get(t).getStashedOpLocalMetadata(e);throw new Error("no apply stashed op handler")}tryProcessMessage(e,t,n,r){const i=this.messageHandlers.get(e.type);return void 0!==i&&(i.process(e,t,n,r),!0)}createCore(e,t){const n=new Ot(this.type.factory.load(this.makeMapValueOpEmitter(e),void 0),this.type),r=this.data.get(e);this.data.set(e,n);const i={key:e,previousValue:r};return this.eventEmitter.emit("create",i,t,this.eventEmitter),n}makeLocal(e,t){p(t.type!==Nt.G[Nt.G.Plain]&&t.type!==Nt.G[Nt.G.Shared],737),t.value=(0,kt.lB)(t.value,this.serializer);const n=this.type.factory.load(this.makeMapValueOpEmitter(e),t.value);return new Ot(n,this.type)}getMessageHandlers(){const e=new Map;return e.set("act",{process:(e,t,n,r)=>{var i;const s=null!==(i=this.data.get(e.key))&&void 0!==i?i:this.createCore(e.key,t),o=s.getOpHandler(e.value.opName),a=s.value,c=(0,kt.lB)(e.value.value,this.serializer);o.process(a,c,t,n,r);const l={key:e.key,previousValue:a};this.eventEmitter.emit("valueChanged",l,t,n,this.eventEmitter)},submit:(e,t)=>{this.submitMessage(e,t)},resubmit:(e,t)=>{const n=this.data.get(e.key),r=n.getOpHandler(e.value.opName),{rebasedOp:i,rebasedLocalOpMetadata:s}=r.rebase(n.value,e.value,t);this.submitMessage(Object.assign(Object.assign({},e),{value:i}),s)},getStashedOpLocalMetadata:e=>{p(!1,22)}}),e}makeMapValueOpEmitter(e){return{emit:(t,n,r,i)=>{const s=(0,kt.i8)(r,this.serializer,this.handle),o={key:e,type:"act",value:{opName:t,value:s}};this.submitMessage(o,i);const a={key:e,previousValue:n};this.eventEmitter.emit("valueChanged",a,!0,null,this.eventEmitter)}}}}class Rt{constructor(){this.ordinalSortedItems=[]}get size(){return this.ordinalSortedItems.length}get items(){return this.ordinalSortedItems}addOrUpdate(e,t){const n=this.findOrdinalPosition(this.getOrdinal(e));n.exists?t&&t(this.ordinalSortedItems[n.index],e):this.ordinalSortedItems.splice(n.index,0,e)}remove(e){const t=this.findOrdinalPosition(this.getOrdinal(e));return!!t.exists&&(this.ordinalSortedItems.splice(t.index,1),!0)}has(e){return this.findOrdinalPosition(this.getOrdinal(e)).exists}getOrdinal(e){const t=e;return(null==t?void 0:t.segment)?t.segment.ordinal:e.ordinal}findOrdinalPosition(e,t,n){if(0===this.ordinalSortedItems.length)return{exists:!1,index:0};if(void 0===t||void 0===n)return this.findOrdinalPosition(e,0,this.ordinalSortedItems.length-1);const r=t+Math.floor((n-t)/2);return this.getOrdinal(this.ordinalSortedItems[r])>e?t===r?{exists:!1,index:r}:this.findOrdinalPosition(e,t,r-1):this.getOrdinal(this.ordinalSortedItems[r])<e?r===n?{exists:!1,index:r+1}:this.findOrdinalPosition(e,r+1,n):{exists:!0,index:r}}}class It{constructor(e,t){this.deltaArgs=e,this.mergeTreeClient=t,p(e.deltaSegments.length>0,728),this.isEmpty=!1,this.deltaOperation=e.operation,this.sortedRanges=new Mt((()=>{const e=new Rt;return this.deltaArgs.deltaSegments.forEach((t=>{const n={operation:this.deltaArgs.operation,position:this.mergeTreeClient.getPosition(t.segment),propertyDeltas:t.propertyDeltas,segment:t.segment};e.addOrUpdate(n)})),e})),this.pFirst=new Mt((()=>this.sortedRanges.value.items[0])),this.pLast=new Mt((()=>this.sortedRanges.value.items[this.sortedRanges.value.size-1]))}get ranges(){return this.sortedRanges.value.items}get clientId(){return this.mergeTreeClient.longClientId}get first(){return this.pFirst.value}get last(){return this.pLast.value}}class Ft extends It{constructor(e,t,n){super(t,n),this.opArgs=e,this.isLocal=void 0===e.sequencedMessage}}class Dt extends It{constructor(e,t,n){super(t,n),this.opArgs=e}}class Mt{constructor(e){this.valueGenerator=e,this.pEvaluated=!1}get evaluated(){return this.pEvaluated}get value(){return this.pEvaluated||(this.pEvaluated=!0,this.pValue=this.valueGenerator()),this.pValue}}const Lt="header",_t="content";class qt extends At.h{constructor(e,t,n,r){super(t,e,n,"fluid_sequence_"),this.dataStoreRuntime=e,this.id=t,this.segmentFromSpec=r,this.loadedDeferred=new Je,this.loadedDeferredOutgoingOps=[],this.deferIncomingOps=!0,this.loadedDeferredIncomingOps=[],this.messagesSinceMSNChange=[],this.loadedDeferred.promise.catch((e=>{this.logger.sendErrorEvent({eventName:"SequenceLoadFailed"},e)})),this.client=new Et(r,it.G2.create(this.logger,"SharedSegmentSequence.MergeTreeClient"),e.options),super.on("newListener",(e=>{switch(e){case"sequenceDelta":this.client.mergeTreeDeltaCallback||(this.client.mergeTreeDeltaCallback=(e,t)=>{this.emit("sequenceDelta",new Ft(e,t,this.client),this)});break;case"maintenance":this.client.mergeTreeMaintenanceCallback||(this.client.mergeTreeMaintenanceCallback=(e,t)=>{this.emit("maintenance",new Dt(t,e,this.client),this)})}})),super.on("removeListener",(e=>{switch(e){case"sequenceDelta":0===super.listenerCount(e)&&(this.client.mergeTreeDeltaCallback=void 0);break;case"maintenance":0===super.listenerCount(e)&&(this.client.mergeTreeMaintenanceCallback=void 0)}})),this.intervalCollections=new Pt(this.serializer,this.handle,((e,t)=>this.submitLocalMessage(e,t)),new ce)}get loaded(){return this.loadedDeferred.promise}static createOpsFromDelta(e){var t,n;const r=[];for(const i of e.ranges)switch(e.deltaOperation){case v.ANNOTATE:{const e=r[r.length-1],s={};for(const e of Object.keys(i.propertyDeltas))s[e]=null!==(n=null===(t=i.segment.properties)||void 0===t?void 0:t[e])&&void 0!==n?n:null;e&&e.pos2===i.position&&D(e.props,s)?e.pos2+=i.segment.cachedLength:r.push(at(i.position,i.position+i.segment.cachedLength,s,void 0));break}case v.INSERT:r.push(ut(i.position,i.segment.clone().toJSONObject()));break;case v.REMOVE:{const e=r[r.length-1];(null==e?void 0:e.pos1)===i.position?e.pos2+=i.segment.cachedLength:r.push(ct(i.position,i.position+i.segment.cachedLength));break}}return r}removeRange(e,t){const n=this.client.removeRangeLocal(e,t);return n&&this.submitSequenceMessage(n),n}groupOperation(e){this.client.localTransaction(e),this.submitSequenceMessage(e)}getContainingSegment(e){return this.client.getContainingSegment(e)}getLength(){return this.client.getLength()}getPosition(e){return this.client.getPosition(e)}annotateRange(e,t,n,r){const i=this.client.annotateRangeLocal(e,t,n,r);i&&this.submitSequenceMessage(i)}getPropertiesAtPosition(e){return this.client.getPropertiesAtPosition(e)}getRangeExtentsOfPosition(e){return this.client.getRangeExtentsOfPosition(e)}createPositionReference(e,t,n){const r=new $(this.client,e,t,n);return n!==m.Transient&&this.addLocalReference(r),r}createLocalReferencePosition(e,t,n,r){return this.client.createLocalReferencePosition(e,t,n,r)}localRefToPos(e){return this.client.localReferencePositionToPosition(e)}localReferencePositionToPosition(e){return this.client.localReferencePositionToPosition(e)}resolveRemoteClientPosition(e,t,n){return this.client.resolveRemoteClientPosition(e,t,n)}submitSequenceMessage(e){if(!this.isAttached())return;const t=(0,kt.i8)(e,this.serializer,this.handle),n=this.client.peekPendingSegmentGroups(e.type===v.GROUP?e.ops.length:1);this.loadedDeferred.isCompleted?this.submitLocalMessage(t,n):this.loadedDeferredOutgoingOps.push([t,n])}addLocalReference(e){return this.client.addLocalReference(e)}removeLocalReference(e){return this.client.removeLocalReferencePosition(e)}removeLocalReferencePosition(e){return this.client.removeLocalReferencePosition(e)}posFromRelativePos(e){return this.client.posFromRelativePos(e)}walkSegments(e,t,n,r,i=!1){return this.client.walkSegments(e,t,n,r,i)}getStackContext(e,t){return this.client.getStackContext(e,t)}getCurrentSeq(){return this.client.getCurrentSeq()}insertAtReferencePosition(e,t){const n=this.client.insertAtReferencePositionLocal(e,t);n&&this.submitSequenceMessage(n)}async waitIntervalCollection(e){return this.intervalCollections.get(e)}getIntervalCollection(e){return this.intervalCollections.get(e)}getIntervalCollectionLabels(){return this.intervalCollections.keys()}summarizeCore(e,t){const n=new dt.x1;return this.intervalCollections.size>0&&n.addBlob(Lt,this.intervalCollections.serialize(e)),n.addWithStats(_t,this.summarizeMergeTree(e)),n.getSummaryTree()}processGCDataCore(e){this.intervalCollections.size>0&&this.intervalCollections.serialize(e),this.client.serializeGCData(this.handle,e)}replaceRange(e,t,n){const r=Math.max(e,t),i=this.client.insertSegmentLocal(r,n);if(i)if(e<t){const n=this.client.removeRangeLocal(e,t);this.submitSequenceMessage(ht(i,n))}else this.submitSequenceMessage(i)}onConnect(){this.client.startOrUpdateCollaboration(this.runtime.clientId)}onDisconnect(){}reSubmitCore(e,t){this.intervalCollections.tryResubmitMessage(e,t)||this.submitSequenceMessage(this.client.regeneratePendingOp(e,t))}async loadCore(e){var t;if(await e.contains(Lt)){const t=await e.readBlob(Lt),n=Xe(t,"utf8");this.intervalCollections.populate(n)}try{const{catchupOpsP:n}=await this.client.load(this.runtime,new Tt.M(e,_t),this.serializer),r=n.then((e=>{e.forEach((e=>{const t=this.client.getCollabWindow();if(e.minimumSequenceNumber<t.minSeq||e.referenceSequenceNumber<t.minSeq||e.sequenceNumber<=t.minSeq||e.sequenceNumber<=t.currentSeq)throw new Error(`Invalid catchup operations in snapshot: ${JSON.stringify({op:{seq:e.sequenceNumber,minSeq:e.minimumSequenceNumber,refSeq:e.referenceSequenceNumber},collabWindow:{seq:t.currentSeq,minSeq:t.minSeq}})}`);this.processMergeTreeMsg(e)})),this.loadFinished()})).catch((e=>{this.loadFinished(e)}));!0!==(null===(t=this.dataStoreRuntime.options)||void 0===t?void 0:t.sequenceInitializeFromHeaderOnly)&&await r}catch(e){this.loadFinished(e)}}processCore(e,t,n){this.deferIncomingOps?(p(!t,114),this.loadedDeferredIncomingOps.push(e)):(p(e.type===et.Operation,115),this.intervalCollections.tryProcessMessage(e.contents,t,e,n)||this.processMergeTreeMsg(e,t))}didAttach(){var e;this.isAttached()&&this.client.startOrUpdateCollaboration(null!==(e=this.runtime.clientId)&&void 0!==e?e:"attached")}initializeLocalCore(){super.initializeLocalCore(),this.loadFinished()}applyStashedOp(e){return this.client.applyStashedOp(e)}summarizeMergeTree(e){p(this.loadedDeferred.isCompleted,116);const t=this.runtime.deltaManager.minimumSequenceNumber;return this.processMinSequenceNumberChanged(t),this.messagesSinceMSNChange.forEach((e=>{e.minimumSequenceNumber=t})),this.client.summarize(this.runtime,this.handle,e,this.messagesSinceMSNChange)}processMergeTreeMsg(e,t){var n,r;const i=(0,kt.lB)(e,this.serializer),s=[];function o(e){s.push(...qt.createOpsFromDelta(e))}const a=i.referenceSequenceNumber!==i.sequenceNumber-1;let c=i;!0!==(null===(n=this.runtime.options)||void 0===n?void 0:n.newMergeTreeSnapshotFormat)&&a&&this.on("sequenceDelta",o),this.client.applyMsg(i,t),!0!==(null===(r=this.runtime.options)||void 0===r?void 0:r.newMergeTreeSnapshotFormat)&&(a&&(this.removeListener("sequenceDelta",o),c=Object.assign(Object.assign({},i),{referenceSequenceNumber:c.sequenceNumber-1,contents:1!==s.length?ht(...s):s[0]})),this.messagesSinceMSNChange.push(c),this.messagesSinceMSNChange.length>20&&this.messagesSinceMSNChange[20].sequenceNumber<i.minimumSequenceNumber&&this.processMinSequenceNumberChanged(i.minimumSequenceNumber))}processMinSequenceNumberChanged(e){let t=0;for(;t<this.messagesSinceMSNChange.length&&!(this.messagesSinceMSNChange[t].sequenceNumber>e);t++);0!==t&&(this.messagesSinceMSNChange=this.messagesSinceMSNChange.slice(t))}loadFinished(e){if(!this.loadedDeferred.isCompleted){if(this.initializeIntervalCollections(),e)throw this.loadedDeferred.reject(e),e;this.deferIncomingOps=!1;for(const e of this.loadedDeferredIncomingOps)this.processCore(e,!1,void 0);this.loadedDeferredIncomingOps.length=0,this.loadedDeferred.resolve();for(const[e,t]of this.loadedDeferredOutgoingOps)this.reSubmitCore(e,t);this.loadedDeferredOutgoingOps.length=0}}initializeIntervalCollections(){this.intervalCollections.eventEmitter.on("create",(({key:e,previousValue:t},n)=>{const r=this.intervalCollections.get(e);r.attached||r.attachGraph(this.client,e),p(void 0===t,705),this.emit("createIntervalCollection",e,n,this)}));for(const e of this.intervalCollections.keys())this.intervalCollections.get(e).attachGraph(this.client,e)}}const Bt="1.3.7";class jt extends Ne{constructor(e){super(),this.items=e,this.type=jt.typeString,this.cachedLength=e.length}static is(e){return e.type===jt.typeString}static fromJSONObject(e){if(e&&"object"==typeof e&&"items"in e){const t=new jt(e.items);return e.props&&t.addProperties(e.props),t}}toJSONObject(){const e={items:this.items};return super.addSerializedProps(e),e}clone(e=0,t){const n=this.items.slice(e,t),r=new jt(n);return this.cloneInto(r),r}canAppend(e){return jt.is(e)&&(this.cachedLength<=128||e.cachedLength<=128)}toString(){return this.items.toString()}append(e){if(!jt.is(e))throw new Error("can only append another run segment");Q.append(this,e),this.items=this.items.concat(e.items),this.cachedLength=this.items.length}removeRange(e,t){let n=[];const r=this.items.length;return e>0&&(n=n.concat(this.items.slice(0,e))),t<r&&(n=n.concat(this.items.slice(t))),this.items=n,this.cachedLength=this.items.length,0===this.items.length}createSplitSegmentAt(e){if(e>0){const t=this.items.slice(e);return this.items=this.items.slice(0,e),this.cachedLength=this.items.length,new jt(t)}}}jt.typeString="SubSequence";class zt extends qt{constructor(e,t,n,r){super(e,t,n,r),this.id=t}insert(e,t,n){const r=new jt(t);n&&r.addProperties(n);const i=this.client.insertSegmentLocal(e,r);i&&this.submitSequenceMessage(i)}remove(e,t){this.removeRange(e,t)}getItemCount(){return this.getLength()}getItems(e,t){const n=[];let r;return void 0!==t&&t<=e||(this.walkSegments((e=>(jt.is(e)&&(void 0===r&&(r=e),n.push(...e.items)),!0)),e,t),void 0!==r&&n.splice(0,e-this.getPosition(r)),void 0!==t&&n.splice(t-e)),n}}class Ht extends zt{constructor(e,t,n){super(e,t,n,Wt.segmentFromSpec),this.id=t}static create(e,t){return e.createChannel(t,Wt.Type)}static getFactory(){return new Wt}getRange(e,t){return this.getItems(e,t)}}class Ut extends zt{constructor(e,t,n){super(e,t,n,Gt.segmentFromSpec),this.id=t}static create(e,t){return e.createChannel(t,Gt.Type)}static getFactory(){return new Gt}getRange(e,t){return this.getItems(e,t)}}class Vt{static segmentFromSpec(e){const t=We.fromJSONObject(e);if(t)return t;return Pe.fromJSONObject(e)||void 0}get type(){return Vt.Type}get attributes(){return Vt.Attributes}async load(e,t,n,r){const i=new Kt(e,t,r);return await i.load(n),i}create(e,t){const n=new Kt(e,t,this.attributes);return n.initializeLocal(),n}}Vt.Type="https://graph.microsoft.com/types/mergeTree",Vt.Attributes={type:Vt.Type,snapshotFormatVersion:"0.1",packageVersion:Bt};class Gt{static segmentFromSpec(e){const t=e;if(t.items){const e=new jt(t.items);return t.props&&e.addProperties(t.props),e}}get type(){return Gt.Type}get attributes(){return Gt.Attributes}async load(e,t,n,r){const i=new Ut(e,t,r);return await i.load(n),i}create(e,t){const n=new Ut(e,t,this.attributes);return n.initializeLocal(),n}}Gt.Type="https://graph.microsoft.com/types/mergeTree/object-sequence",Gt.Attributes={type:Gt.Type,snapshotFormatVersion:"0.1",packageVersion:Bt};class Wt{static segmentFromSpec(e){const t=e;if(t.items){const e=new jt(t.items);return t.props&&e.addProperties(t.props),e}}get type(){return Wt.Type}get attributes(){return Wt.Attributes}async load(e,t,n,r){const i=new Ht(e,t,r);return await i.load(n),i}create(e,t){const n=new Ht(e,t,this.attributes);return n.initializeLocal(),n}}Wt.Type="https://graph.microsoft.com/types/mergeTree/number-sequence",Wt.Attributes={type:Wt.Type,snapshotFormatVersion:"0.1",packageVersion:Bt};class Kt extends qt{constructor(e,t,n){super(e,t,n,Vt.segmentFromSpec),this.id=t,this.mergeTreeTextHelper=this.client.createTextHelper()}static create(e,t){return e.createChannel(t,Vt.Type)}static getFactory(){return new Vt}get ISharedString(){return this}insertMarkerRelative(e,t,n){const r=new Pe(t);n&&r.addProperties(n);const i=this.posFromRelativePos(e),s=this.client.insertSegmentLocal(i,r);s&&this.submitSequenceMessage(s)}insertMarker(e,t,n){const r=new Pe(t);n&&r.addProperties(n);const i=this.client.insertSegmentLocal(e,r);return i&&this.submitSequenceMessage(i),i}insertTextRelative(e,t,n){const r=new We(t);n&&r.addProperties(n);const i=this.posFromRelativePos(e),s=this.client.insertSegmentLocal(i,r);s&&this.submitSequenceMessage(s)}insertText(e,t,n){const r=new We(t);n&&r.addProperties(n);const i=this.client.insertSegmentLocal(e,r);i&&this.submitSequenceMessage(i)}replaceText(e,t,n,r){this.replaceRange(e,t,We.make(n,r))}removeText(e,t){return this.removeRange(e,t)}annotateMarkerNotifyConsensus(e,t,n){const r=this.client.annotateMarkerNotifyConsensus(e,t,n);r&&this.submitSequenceMessage(r)}annotateMarker(e,t,n){const r=this.client.annotateMarker(e,t,n);r&&this.submitSequenceMessage(r)}findTile(e,t,n=!0){return this.client.findTile(e,t,n)}getTextAndMarkers(e){const t=this.client.getCollabWindow();return this.mergeTreeTextHelper.getTextAndMarkers(t.currentSeq,t.clientId,e)}getText(e,t){const n=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(n.currentSeq,n.clientId,"",e,t)}getTextWithPlaceholders(){const e=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(e.currentSeq,e.clientId," ")}getTextRangeWithPlaceholders(e,t){const n=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(n.currentSeq,n.clientId," ",e,t)}getTextRangeWithMarkers(e,t){const n=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(n.currentSeq,n.clientId,"*",e,t)}getMarkerFromId(e){return this.client.getMarkerFromId(e)}}class $t extends Ne{constructor(e){super(),this.type=$t.typeString,this.cachedLength=e}static is(e){return e.type===$t.typeString}static fromJSONObject(e){if(e&&"object"==typeof e&&"pad"in e){const t=new $t(e.pad);return e.props&&t.addProperties(e.props),t}}toJSONObject(){return{pad:this.cachedLength,props:this.properties}}clone(e=0,t){const n=new $t(this.cachedLength);return this.cloneInto(n),n}canAppend(e){return $t.is(e)}toString(){return`[padding: ${this.cachedLength}]`}append(e){if(!$t.is(e))throw new Error("can only append padding segment");Q.append(this,e),this.cachedLength+=e.cachedLength}removeRange(e,t){return this.cachedLength-=t-e,0===this.cachedLength}createSplitSegmentAt(e){const t=e,n=this.cachedLength-e;return this.cachedLength=t,new $t(n)}}$t.typeString="PaddingSegment";class Jt extends jt{constructor(e){super(e),this.items=e,this.type=Jt.typeString,this.tags=new Array(e.length).fill(void 0)}static is(e){return e.type===Jt.typeString}static fromJSONObject(e){if(e&&"object"==typeof e&&"items"in e){const t=new Jt(e.items);return e.props&&t.addProperties(e.props),t}}clone(e=0,t){const n=new Jt(this.items.slice(e,t));return this.tags&&(n.tags=this.tags.slice(e,t)),this.cloneInto(n),n}append(e){super.append(e);const t=e;return t.tags&&this.tags&&this.tags.splice(this.items.length,0,...t.tags),this}removeRange(e,t){return this.tags.splice(e,t-e),super.removeRange(e,t)}getTag(e){return this.tags[e]}setTag(e,t){this.tags[e]=t}createSplitSegmentAt(e){if(e>0){const t=this.items.slice(e);this.items=this.items.slice(0,e),this.cachedLength=this.items.length;const n=new Jt(t);return n.tags=this.tags.slice(e),this.tags.length=e,n}}}Jt.typeString="RunSegment";const Qt=2097152,Xt=Qt+1,Zt=4294967295,Yt=Zt+1,en=Qt*Zt,tn=(e,t)=>e*Xt+t;function nn(e){const t=Math.floor(e/Xt);return{row:t,col:e-t*Xt}}class rn extends qt{constructor(e,t,n){super(e,t,n,sn.segmentFromSpec),this.id=t}static create(e,t){return e.createChannel(t,sn.Type)}static getFactory(){return new sn}get numRows(){return nn(this.getLength()).row}setItems(e,t,n,r){const i=tn(e,t),s=i+n.length,o=new Jt(n);r&&o.addProperties(r),this.replaceRange(i,s,o)}getItem(e,t){const n=tn(e,t),{segment:r,offset:i}=this.getContainingSegment(n);if(r&&Jt.is(r))return r.items[i];if(!r||!$t.is(r))throw new Error("Unrecognized Segment type")}getTag(e,t){const{segment:n,offset:r}=this.getSegment(e,t);if(Jt.is(n))return n.getTag(r)}setTag(e,t,n){const{segment:r,offset:i}=this.getSegment(e,t);if(Jt.is(r))r.setTag(i,n);else if(void 0!==n)throw new Error(`Must not attempt to set tags on '${r.constructor.name}'.`)}insertRows(e,t){const n=tn(e,0),r=new $t(Xt*t),i=this.client.insertSegmentLocal(n,r);i&&this.submitSequenceMessage(i)}removeRows(e,t){const n=tn(e,0),r=Xt*t;this.removeRange(n,n+r)}insertCols(e,t){this.moveAsPadding(Qt-t,e,t)}removeCols(e,t){this.moveAsPadding(e,Qt-t,t)}annotatePosition(e,t,n){const r=tn(e,t);this.annotateRange(r,r+1,n)}getPositionProperties(e,t){const n=tn(e,t);return this.getPropertiesAtPosition(n)}moveAsPadding(e,t,n){const r=e,i=e+n,s=[];for(let e=0,o=0;e<this.numRows;e++,o+=Xt){s.push(this.client.removeRangeLocal(o+r,o+i));const e=o+t,a=new $t(n);s.push(this.client.insertSegmentLocal(e,a))}this.submitSequenceMessage(ht(...s))}getSegment(e,t){const n=tn(e,t);return this.getContainingSegment(n)}}class sn{static segmentFromSpec(e){const t=$t.fromJSONObject(e);if(t)return t;const n=Jt.fromJSONObject(e);if(n)return n;throw new Error(`Unrecognized IJSONObject: '${JSON.stringify(e)}'`)}get type(){return sn.Type}get attributes(){return sn.Attributes}async load(e,t,n,r){const i=new rn(e,t,r);return await i.load(n),i}create(e,t){const n=new rn(e,t,this.attributes);return n.initializeLocal(),n}}var on;sn.Type="https://graph.microsoft.com/types/mergeTree/sparse-matrix",sn.Attributes={type:sn.Type,snapshotFormatVersion:"0.1",packageVersion:Bt};const an="header";class cn{get type(){return cn.Type}get attributes(){return cn.Attributes}async load(e,t,n,r){const i=new ln(t,e,r);return await i.load(n),i}create(e,t){const n=new ln(t,e,this.attributes);return n.initializeLocal(),n}}cn.Type="https://graph.microsoft.com/types/sharedIntervalCollection",cn.Attributes={type:cn.Type,snapshotFormatVersion:"0.1",packageVersion:Bt};class ln extends At.h{constructor(e,t,n){super(e,t,n,"fluid_sharedIntervalCollection_"),this[on]="SharedIntervalCollection",this.intervalCollections=new Pt(this.serializer,this.handle,((e,t)=>this.submitLocalMessage(e,t)),new he)}static create(e,t){return e.createChannel(t,cn.Type)}static getFactory(){return new cn}async waitIntervalCollection(e){return this.intervalCollections.get(this.getIntervalCollectionPath(e))}getIntervalCollection(e){const t=this.getIntervalCollectionPath(e);return this.intervalCollections.get(t)}summarizeCore(e){return(0,kt.Ho)(an,this.intervalCollections.serialize(e))}reSubmitCore(e,t){this.intervalCollections.tryResubmitMessage(e,t)}onDisconnect(){}async loadCore(e){const t=await e.readBlob(an),n=Xe(t,"utf8");this.intervalCollections.populate(n)}processCore(e,t,n){e.type===et.Operation&&this.intervalCollections.tryProcessMessage(e.contents,t,e,n)}getIntervalCollectionPath(e){return e}applyStashedOp(){throw new Error("not implemented")}}on=Symbol.toStringTag},9092:e=>{"use strict";var t=Object.prototype.toString,n=Math.max,r=function(e,t){for(var n=[],r=0;r<e.length;r+=1)n[r]=e[r];for(var i=0;i<t.length;i+=1)n[i+e.length]=t[i];return n};e.exports=function(e){var i=this;if("function"!=typeof i||"[object Function]"!==t.apply(i))throw new TypeError("Function.prototype.bind called on incompatible "+i);for(var s,o=function(e,t){for(var n=[],r=1,i=0;r<e.length;r+=1,i+=1)n[i]=e[r];return n}(arguments),a=n(0,i.length-o.length),c=[],l=0;l<a;l++)c[l]="$"+l;if(s=Function("binder","return function ("+function(e,t){for(var n="",r=0;r<e.length;r+=1)n+=e[r],r+1<e.length&&(n+=",");return n}(c)+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof s){var t=i.apply(this,r(o,arguments));return Object(t)===t?t:this}return i.apply(e,r(o,arguments))})),i.prototype){var u=function(){};u.prototype=i.prototype,s.prototype=new u,u.prototype=null}return s}},2514:(e,t,n)=>{"use strict";var r=n(9092);e.exports=Function.prototype.bind||r},210:(e,t,n)=>{"use strict";var r,i=SyntaxError,s=Function,o=TypeError,a=function(e){try{return s('"use strict"; return ('+e+").constructor;")()}catch(e){}},c=Object.getOwnPropertyDescriptor;if(c)try{c({},"")}catch(e){c=null}var l=function(){throw new o},u=c?function(){try{return l}catch(e){try{return c(arguments,"callee").get}catch(e){return l}}}():l,h=n(1405)(),d=n(8185)(),p=Object.getPrototypeOf||(d?function(e){return e.__proto__}:null),f={},g="undefined"!=typeof Uint8Array&&p?p(Uint8Array):r,m={"%AggregateError%":"undefined"==typeof AggregateError?r:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?r:ArrayBuffer,"%ArrayIteratorPrototype%":h&&p?p([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":f,"%AsyncGenerator%":f,"%AsyncGeneratorFunction%":f,"%AsyncIteratorPrototype%":f,"%Atomics%":"undefined"==typeof Atomics?r:Atomics,"%BigInt%":"undefined"==typeof BigInt?r:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?r:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?r:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?r:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?r:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?r:FinalizationRegistry,"%Function%":s,"%GeneratorFunction%":f,"%Int8Array%":"undefined"==typeof Int8Array?r:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?r:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":h&&p?p(p([][Symbol.iterator]())):r,"%JSON%":"object"==typeof JSON?JSON:r,"%Map%":"undefined"==typeof Map?r:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&h&&p?p((new Map)[Symbol.iterator]()):r,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?r:Promise,"%Proxy%":"undefined"==typeof Proxy?r:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?r:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?r:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&h&&p?p((new Set)[Symbol.iterator]()):r,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":h&&p?p(""[Symbol.iterator]()):r,"%Symbol%":h?Symbol:r,"%SyntaxError%":i,"%ThrowTypeError%":u,"%TypedArray%":g,"%TypeError%":o,"%Uint8Array%":"undefined"==typeof Uint8Array?r:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?r:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?r:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?r:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?r:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?r:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?r:WeakSet};if(p)try{null.error}catch(e){var y=p(p(e));m["%Error.prototype%"]=y}var v=function e(t){var n;if("%AsyncFunction%"===t)n=a("async function () {}");else if("%GeneratorFunction%"===t)n=a("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=a("async function* () {}");else if("%AsyncGenerator%"===t){var r=e("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if("%AsyncIteratorPrototype%"===t){var i=e("%AsyncGenerator%");i&&p&&(n=p(i.prototype))}return m[t]=n,n},b={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},S=n(2514),w=n(8824),x=S.call(Function.call,Array.prototype.concat),C=S.call(Function.apply,Array.prototype.splice),E=S.call(Function.call,String.prototype.replace),T=S.call(Function.call,String.prototype.slice),A=S.call(Function.call,RegExp.prototype.exec),k=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,N=/\\(\\)?/g,O=function(e,t){var n,r=e;if(w(b,r)&&(r="%"+(n=b[r])[0]+"%"),w(m,r)){var s=m[r];if(s===f&&(s=v(r)),void 0===s&&!t)throw new o("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:s}}throw new i("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new o('"allowMissing" argument must be a boolean');if(null===A(/^%?[^%]*%?$/,e))throw new i("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=function(e){var t=T(e,0,1),n=T(e,-1);if("%"===t&&"%"!==n)throw new i("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new i("invalid intrinsic syntax, expected opening `%`");var r=[];return E(e,k,(function(e,t,n,i){r[r.length]=n?E(i,N,"$1"):t||e})),r}(e),r=n.length>0?n[0]:"",s=O("%"+r+"%",t),a=s.name,l=s.value,u=!1,h=s.alias;h&&(r=h[0],C(n,x([0,1],h)));for(var d=1,p=!0;d<n.length;d+=1){var f=n[d],g=T(f,0,1),y=T(f,-1);if(('"'===g||"'"===g||"`"===g||'"'===y||"'"===y||"`"===y)&&g!==y)throw new i("property names with quotes must have matching quotes");if("constructor"!==f&&p||(u=!0),w(m,a="%"+(r+="."+f)+"%"))l=m[a];else if(null!=l){if(!(f in l)){if(!t)throw new o("base intrinsic for "+e+" exists, but the property is not available.");return}if(c&&d+1>=n.length){var v=c(l,f);l=(p=!!v)&&"get"in v&&!("originalValue"in v.get)?v.get:l[f]}else p=w(l,f),l=l[f];p&&!u&&(m[a]=l)}}return l}},7296:(e,t,n)=>{"use strict";var r=n(210)("%Object.getOwnPropertyDescriptor%",!0);if(r)try{r([],"length")}catch(e){r=null}e.exports=r},3596:(e,t,n)=>{"use strict";var r=n(210)("%Object.defineProperty%",!0),i=function(){if(r)try{return r({},"a",{value:1}),!0}catch(e){return!1}return!1};i.hasArrayLengthDefineBug=function(){if(!i())return null;try{return 1!==r([],"length",{value:1}).length}catch(e){return!0}},e.exports=i},8185:e=>{"use strict";var t={foo:{}},n=Object;e.exports=function(){return{__proto__:t}.foo===t.foo&&!({__proto__:null}instanceof n)}},1405:(e,t,n)=>{"use strict";var r="undefined"!=typeof Symbol&&Symbol,i=n(5419);e.exports=function(){return"function"==typeof r&&"function"==typeof Symbol&&"symbol"==typeof r("foo")&&"symbol"==typeof Symbol("bar")&&i()}},5419:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var r=Object.getOwnPropertySymbols(e);if(1!==r.length||r[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(e,t);if(42!==i.value||!0!==i.enumerable)return!1}return!0}},8824:(e,t,n)=>{"use strict";var r=Function.prototype.call,i=Object.prototype.hasOwnProperty,s=n(2514);e.exports=s.call(r,i)},4530:(e,t)=>{function n(e,t){var n=[],r=[];return null==t&&(t=function(e,t){return n[0]===t?"[Circular ~]":"[Circular ~."+r.slice(0,n.indexOf(t)).join(".")+"]"}),function(i,s){if(n.length>0){var o=n.indexOf(this);~o?n.splice(o+1):n.push(this),~o?r.splice(o,1/0,i):r.push(i),~n.indexOf(s)&&(s=t.call(this,i,s))}else n.push(s);return null==e?s:e.call(this,i,s)}}(e.exports=function(e,t,r,i){return JSON.stringify(e,n(t,i),r)}).getSerialize=n},1166:(e,t)=>{var n,r,i,s,o,a,c,l,u,h={userAgent:!1},d={},p=p||function(e,t){var n={},r=n.lib={},i=r.Base=function(){function e(){}return{extend:function(t){e.prototype=this;var n=new e;return t&&n.mixIn(t),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),s=r.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;if(this.clamp(),r%4)for(var s=0;s<i;s++){var o=n[s>>>2]>>>24-s%4*8&255;t[r+s>>>2]|=o<<24-(r+s)%4*8}else for(s=0;s<i;s+=4)t[r+s>>>2]=n[s>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new s.init(n,t)}}),o=n.enc={},a=o.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var s=t[i>>>2]>>>24-i%4*8&255;r.push((s>>>4).toString(16)),r.push((15&s).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new s.init(n,t/2)}},c=o.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var s=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(s))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new s.init(n,t)}},l=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},u=r.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,o=this.blockSize,a=i/(4*o),c=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*o,l=e.min(4*c,i);if(c){for(var u=0;u<c;u+=o)this._doProcessBlock(r,u);var h=r.splice(0,c);n.sigBytes-=l}return new s.init(h,l)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),h=(r.Hasher=u.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}}),n.algo={});return n}(Math);r=(n=p).lib,i=r.Base,s=r.WordArray,(n=n.x64={}).Word=i.extend({init:function(e,t){this.high=e,this.low=t}}),n.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,n=[],r=0;r<t;r++){var i=e[r];n.push(i.high),n.push(i.low)}return s.create(n,this.sigBytes)},clone:function(){for(var e=i.clone.call(this),t=e.words=this.words.slice(0),n=t.length,r=0;r<n;r++)t[r]=t[r].clone();return e}}),p.lib.Cipher||function(e){var t=(f=p).lib,n=t.Base,r=t.WordArray,i=t.BufferedBlockAlgorithm,s=f.enc.Base64,o=f.algo.EvpKDF,a=t.Cipher=i.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){i.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,n,r){return("string"==typeof n?g:d).encrypt(e,t,n,r)},decrypt:function(t,n,r){return("string"==typeof n?g:d).decrypt(e,t,n,r)}}}});t.StreamCipher=a.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var c=f.mode={},l=function(e,t,n){var r=this._iv;r?this._iv=void 0:r=this._prevBlock;for(var i=0;i<n;i++)e[t+i]^=r[i]},u=(t.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();u.Encryptor=u.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize;l.call(this,e,t,r),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+r)}}),u.Decryptor=u.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,i=e.slice(t,t+r);n.decryptBlock(e,t),l.call(this,e,t,r),this._prevBlock=i}}),c=c.CBC=u,u=(f.pad={}).Pkcs7={pad:function(e,t){for(var n,i=(n=(n=4*t)-e.sigBytes%n)<<24|n<<16|n<<8|n,s=[],o=0;o<n;o+=4)s.push(i);n=r.create(s,n),e.concat(n)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},t.BlockCipher=a.extend({cfg:a.cfg.extend({mode:c,padding:u}),reset:function(){a.reset.call(this);var e=(t=this.cfg).iv,t=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=t.createEncryptor;else n=t.createDecryptor,this._minBufferSize=1;this._mode=n.call(t,this,e&&e.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var h=t.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),d=(c=(f.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return((e=e.salt)?r.create([1398893684,1701076831]).concat(e).concat(t):t).toString(s)},parse:function(e){var t=(e=s.parse(e)).words;if(1398893684==t[0]&&1701076831==t[1]){var n=r.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return h.create({ciphertext:e,salt:n})}},t.SerializableCipher=n.extend({cfg:n.extend({format:c}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var i=e.createEncryptor(n,r);return t=i.finalize(t),i=i.cfg,h.create({ciphertext:t,key:n,iv:i.iv,algorithm:e,mode:i.mode,padding:i.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),e.createDecryptor(n,r).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}})),f=(f.kdf={}).OpenSSL={execute:function(e,t,n,i){return i||(i=r.random(8)),e=o.create({keySize:t+n}).compute(e,i),n=r.create(e.words.slice(t),4*n),e.sigBytes=4*t,h.create({key:e,iv:n,salt:i})}},g=t.PasswordBasedCipher=d.extend({cfg:d.cfg.extend({kdf:f}),encrypt:function(e,t,n,r){return n=(r=this.cfg.extend(r)).kdf.execute(n,e.keySize,e.ivSize),r.iv=n.iv,(e=d.encrypt.call(this,e,t,n.key,r)).mixIn(n),e},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),n=r.kdf.execute(n,e.keySize,e.ivSize,t.salt),r.iv=n.iv,d.decrypt.call(this,e,t,n.key,r)}})}(),function(){for(var e=p,t=e.lib.BlockCipher,n=e.algo,r=[],i=[],s=[],o=[],a=[],c=[],l=[],u=[],h=[],d=[],f=[],g=0;256>g;g++)f[g]=128>g?g<<1:g<<1^283;var m=0,y=0;for(g=0;256>g;g++){var v=(v=y^y<<1^y<<2^y<<3^y<<4)>>>8^255&v^99;r[m]=v,i[v]=m;var b=f[m],S=f[b],w=f[S],x=257*f[v]^16843008*v;s[m]=x<<24|x>>>8,o[m]=x<<16|x>>>16,a[m]=x<<8|x>>>24,c[m]=x,x=16843009*w^65537*S^257*b^16843008*m,l[v]=x<<24|x>>>8,u[v]=x<<16|x>>>16,h[v]=x<<8|x>>>24,d[v]=x,m?(m=b^f[f[f[w^b]]],y^=f[f[y]]):m=y=1}var C=[0,1,2,4,8,16,32,64,128,27,54];n=n.AES=t.extend({_doReset:function(){for(var e=(n=this._key).words,t=n.sigBytes/4,n=4*((this._nRounds=t+6)+1),i=this._keySchedule=[],s=0;s<n;s++)if(s<t)i[s]=e[s];else{var o=i[s-1];s%t?6<t&&4==s%t&&(o=r[o>>>24]<<24|r[o>>>16&255]<<16|r[o>>>8&255]<<8|r[255&o]):(o=r[(o=o<<8|o>>>24)>>>24]<<24|r[o>>>16&255]<<16|r[o>>>8&255]<<8|r[255&o],o^=C[s/t|0]<<24),i[s]=i[s-t]^o}for(e=this._invKeySchedule=[],t=0;t<n;t++)s=n-t,o=t%4?i[s]:i[s-4],e[t]=4>t||4>=s?o:l[r[o>>>24]]^u[r[o>>>16&255]]^h[r[o>>>8&255]]^d[r[255&o]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,s,o,a,c,r)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,l,u,h,d,i),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,r,i,s,o,a){for(var c=this._nRounds,l=e[t]^n[0],u=e[t+1]^n[1],h=e[t+2]^n[2],d=e[t+3]^n[3],p=4,f=1;f<c;f++){var g=r[l>>>24]^i[u>>>16&255]^s[h>>>8&255]^o[255&d]^n[p++],m=r[u>>>24]^i[h>>>16&255]^s[d>>>8&255]^o[255&l]^n[p++],y=r[h>>>24]^i[d>>>16&255]^s[l>>>8&255]^o[255&u]^n[p++];d=r[d>>>24]^i[l>>>16&255]^s[u>>>8&255]^o[255&h]^n[p++],l=g,u=m,h=y}g=(a[l>>>24]<<24|a[u>>>16&255]<<16|a[h>>>8&255]<<8|a[255&d])^n[p++],m=(a[u>>>24]<<24|a[h>>>16&255]<<16|a[d>>>8&255]<<8|a[255&l])^n[p++],y=(a[h>>>24]<<24|a[d>>>16&255]<<16|a[l>>>8&255]<<8|a[255&u])^n[p++],d=(a[d>>>24]<<24|a[l>>>16&255]<<16|a[u>>>8&255]<<8|a[255&h])^n[p++],e[t]=g,e[t+1]=m,e[t+2]=y,e[t+3]=d},keySize:8}),e.AES=t._createHelper(n)}(),function(){function e(e,t){var n=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=n,this._lBlock^=n<<e}function t(e,t){var n=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=n,this._rBlock^=n<<e}var n=p,r=(i=n.lib).WordArray,i=i.BlockCipher,s=n.algo,o=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],a=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],l=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],u=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],h=s.DES=i.extend({_doReset:function(){for(var e=this._key.words,t=[],n=0;56>n;n++){var r=o[n]-1;t[n]=e[r>>>5]>>>31-r%32&1}for(e=this._subKeys=[],r=0;16>r;r++){var i=e[r]=[],s=c[r];for(n=0;24>n;n++)i[n/6|0]|=t[(a[n]-1+s)%28]<<31-n%6,i[4+(n/6|0)]|=t[28+(a[n+24]-1+s)%28]<<31-n%6;for(i[0]=i[0]<<1|i[0]>>>31,n=1;7>n;n++)i[n]>>>=4*(n-1)+3;i[7]=i[7]<<5|i[7]>>>27}for(t=this._invSubKeys=[],n=0;16>n;n++)t[n]=e[15-n]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(n,r,i){this._lBlock=n[r],this._rBlock=n[r+1],e.call(this,4,252645135),e.call(this,16,65535),t.call(this,2,858993459),t.call(this,8,16711935),e.call(this,1,1431655765);for(var s=0;16>s;s++){for(var o=i[s],a=this._lBlock,c=this._rBlock,h=0,d=0;8>d;d++)h|=l[d][((c^o[d])&u[d])>>>0];this._lBlock=c,this._rBlock=a^h}i=this._lBlock,this._lBlock=this._rBlock,this._rBlock=i,e.call(this,1,1431655765),t.call(this,8,16711935),t.call(this,2,858993459),e.call(this,16,65535),e.call(this,4,252645135),n[r]=this._lBlock,n[r+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});n.DES=i._createHelper(h),s=s.TripleDES=i.extend({_doReset:function(){var e=this._key.words;this._des1=h.createEncryptor(r.create(e.slice(0,2))),this._des2=h.createEncryptor(r.create(e.slice(2,4))),this._des3=h.createEncryptor(r.create(e.slice(4,6)))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2}),n.TripleDES=i._createHelper(s)}(),function(){var e=p,t=e.lib.WordArray;e.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp(),e=[];for(var i=0;i<n;i+=3)for(var s=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,o=0;4>o&&i+.75*o<n;o++)e.push(r.charAt(s>>>6*(3-o)&63));if(t=r.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var n=e.length,r=this._map;(i=r.charAt(64))&&-1!=(i=e.indexOf(i))&&(n=i);for(var i=[],s=0,o=0;o<n;o++)if(o%4){var a=r.indexOf(e.charAt(o-1))<<o%4*2,c=r.indexOf(e.charAt(o))>>>6-o%4*2;i[s>>>2]|=(a|c)<<24-s%4*8,s++}return t.create(i,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(e){function t(e,t,n,r,i,s,o){return((e=e+(t&n|~t&r)+i+o)<<s|e>>>32-s)+t}function n(e,t,n,r,i,s,o){return((e=e+(t&r|n&~r)+i+o)<<s|e>>>32-s)+t}function r(e,t,n,r,i,s,o){return((e=e+(t^n^r)+i+o)<<s|e>>>32-s)+t}function i(e,t,n,r,i,s,o){return((e=e+(n^(t|~r))+i+o)<<s|e>>>32-s)+t}for(var s=p,o=(c=s.lib).WordArray,a=c.Hasher,c=s.algo,l=[],u=0;64>u;u++)l[u]=4294967296*e.abs(e.sin(u+1))|0;c=c.MD5=a.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,s){for(var o=0;16>o;o++){var a=e[c=s+o];e[c]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}o=this._hash.words;var c=e[s+0],u=(a=e[s+1],e[s+2]),h=e[s+3],d=e[s+4],p=e[s+5],f=e[s+6],g=e[s+7],m=e[s+8],y=e[s+9],v=e[s+10],b=e[s+11],S=e[s+12],w=e[s+13],x=e[s+14],C=e[s+15],E=t(E=o[0],k=o[1],A=o[2],T=o[3],c,7,l[0]),T=t(T,E,k,A,a,12,l[1]),A=t(A,T,E,k,u,17,l[2]),k=t(k,A,T,E,h,22,l[3]);E=t(E,k,A,T,d,7,l[4]),T=t(T,E,k,A,p,12,l[5]),A=t(A,T,E,k,f,17,l[6]),k=t(k,A,T,E,g,22,l[7]),E=t(E,k,A,T,m,7,l[8]),T=t(T,E,k,A,y,12,l[9]),A=t(A,T,E,k,v,17,l[10]),k=t(k,A,T,E,b,22,l[11]),E=t(E,k,A,T,S,7,l[12]),T=t(T,E,k,A,w,12,l[13]),A=t(A,T,E,k,x,17,l[14]),E=n(E,k=t(k,A,T,E,C,22,l[15]),A,T,a,5,l[16]),T=n(T,E,k,A,f,9,l[17]),A=n(A,T,E,k,b,14,l[18]),k=n(k,A,T,E,c,20,l[19]),E=n(E,k,A,T,p,5,l[20]),T=n(T,E,k,A,v,9,l[21]),A=n(A,T,E,k,C,14,l[22]),k=n(k,A,T,E,d,20,l[23]),E=n(E,k,A,T,y,5,l[24]),T=n(T,E,k,A,x,9,l[25]),A=n(A,T,E,k,h,14,l[26]),k=n(k,A,T,E,m,20,l[27]),E=n(E,k,A,T,w,5,l[28]),T=n(T,E,k,A,u,9,l[29]),A=n(A,T,E,k,g,14,l[30]),E=r(E,k=n(k,A,T,E,S,20,l[31]),A,T,p,4,l[32]),T=r(T,E,k,A,m,11,l[33]),A=r(A,T,E,k,b,16,l[34]),k=r(k,A,T,E,x,23,l[35]),E=r(E,k,A,T,a,4,l[36]),T=r(T,E,k,A,d,11,l[37]),A=r(A,T,E,k,g,16,l[38]),k=r(k,A,T,E,v,23,l[39]),E=r(E,k,A,T,w,4,l[40]),T=r(T,E,k,A,c,11,l[41]),A=r(A,T,E,k,h,16,l[42]),k=r(k,A,T,E,f,23,l[43]),E=r(E,k,A,T,y,4,l[44]),T=r(T,E,k,A,S,11,l[45]),A=r(A,T,E,k,C,16,l[46]),E=i(E,k=r(k,A,T,E,u,23,l[47]),A,T,c,6,l[48]),T=i(T,E,k,A,g,10,l[49]),A=i(A,T,E,k,x,15,l[50]),k=i(k,A,T,E,p,21,l[51]),E=i(E,k,A,T,S,6,l[52]),T=i(T,E,k,A,h,10,l[53]),A=i(A,T,E,k,v,15,l[54]),k=i(k,A,T,E,a,21,l[55]),E=i(E,k,A,T,m,6,l[56]),T=i(T,E,k,A,C,10,l[57]),A=i(A,T,E,k,f,15,l[58]),k=i(k,A,T,E,w,21,l[59]),E=i(E,k,A,T,d,6,l[60]),T=i(T,E,k,A,b,10,l[61]),A=i(A,T,E,k,u,15,l[62]),k=i(k,A,T,E,y,21,l[63]),o[0]=o[0]+E|0,o[1]=o[1]+k|0,o[2]=o[2]+A|0,o[3]=o[3]+T|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;n[i>>>5]|=128<<24-i%32;var s=e.floor(r/4294967296);for(n[15+(i+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),n[14+(i+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t.sigBytes=4*(n.length+1),this._process(),n=(t=this._hash).words,r=0;4>r;r++)i=n[r],n[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);return t},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}}),s.MD5=a._createHelper(c),s.HmacMD5=a._createHmacHelper(c)}(Math),a=(u=(o=p).lib).WordArray,c=u.Hasher,l=[],u=o.algo.SHA1=c.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],s=n[2],o=n[3],a=n[4],c=0;80>c;c++){if(16>c)l[c]=0|e[t+c];else{var u=l[c-3]^l[c-8]^l[c-14]^l[c-16];l[c]=u<<1|u>>>31}u=(r<<5|r>>>27)+a+l[c],u=20>c?u+(1518500249+(i&s|~i&o)):40>c?u+(1859775393+(i^s^o)):60>c?u+((i&s|i&o|s&o)-1894007588):u+((i^s^o)-899497514),a=o,o=s,s=i<<30|i>>>2,i=r,r=u}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+s|0,n[3]=n[3]+o|0,n[4]=n[4]+a|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(r+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=c.clone.call(this);return e._hash=this._hash.clone(),e}}),o.SHA1=c._createHelper(u),o.HmacSHA1=c._createHmacHelper(u),function(e){for(var t=p,n=(i=t.lib).WordArray,r=i.Hasher,i=t.algo,s=[],o=[],a=function(e){return 4294967296*(e-(0|e))|0},c=2,l=0;64>l;){var u;e:{u=c;for(var h=e.sqrt(u),d=2;d<=h;d++)if(!(u%d)){u=!1;break e}u=!0}u&&(8>l&&(s[l]=a(e.pow(c,.5))),o[l]=a(e.pow(c,1/3)),l++),c++}var f=[];i=i.SHA256=r.extend({_doReset:function(){this._hash=new n.init(s.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],s=n[2],a=n[3],c=n[4],l=n[5],u=n[6],h=n[7],d=0;64>d;d++){if(16>d)f[d]=0|e[t+d];else{var p=f[d-15],g=f[d-2];f[d]=((p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3)+f[d-7]+((g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10)+f[d-16]}p=h+((c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25))+(c&l^~c&u)+o[d]+f[d],g=((r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22))+(r&i^r&s^i&s),h=u,u=l,l=c,c=a+p|0,a=s,s=i,i=r,r=p+g|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+s|0,n[3]=n[3]+a|0,n[4]=n[4]+c|0,n[5]=n[5]+l|0,n[6]=n[6]+u|0,n[7]=n[7]+h|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=e.floor(r/4294967296),n[15+(i+64>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}}),t.SHA256=r._createHelper(i),t.HmacSHA256=r._createHmacHelper(i)}(Math),function(){var e=p,t=e.lib.WordArray,n=(r=e.algo).SHA256,r=r.SHA224=n.extend({_doReset:function(){this._hash=new t.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=n._doFinalize.call(this);return e.sigBytes-=4,e}});e.SHA224=n._createHelper(r),e.HmacSHA224=n._createHmacHelper(r)}(),function(){function e(){return r.create.apply(r,arguments)}for(var t=p,n=t.lib.Hasher,r=(s=t.x64).Word,i=s.WordArray,s=t.algo,o=[e(1116352408,3609767458),e(1899447441,602891725),e(3049323471,3964484399),e(3921009573,2173295548),e(961987163,4081628472),e(1508970993,3053834265),e(2453635748,2937671579),e(2870763221,3664609560),e(3624381080,2734883394),e(310598401,1164996542),e(607225278,1323610764),e(1426881987,3590304994),e(1925078388,4068182383),e(2162078206,991336113),e(2614888103,633803317),e(3248222580,3479774868),e(3835390401,2666613458),e(4022224774,944711139),e(264347078,2341262773),e(604807628,2007800933),e(770255983,1495990901),e(1249150122,1856431235),e(1555081692,3175218132),e(1996064986,2198950837),e(2554220882,3999719339),e(2821834349,766784016),e(2952996808,2566594879),e(3210313671,3203337956),e(3336571891,1034457026),e(3584528711,2466948901),e(113926993,3758326383),e(338241895,168717936),e(666307205,1188179964),e(773529912,1546045734),e(1294757372,1522805485),e(1396182291,2643833823),e(1695183700,2343527390),e(1986661051,1014477480),e(2177026350,1206759142),e(2456956037,344077627),e(2730485921,1290863460),e(2820302411,3158454273),e(3259730800,3505952657),e(3345764771,106217008),e(3516065817,3606008344),e(3600352804,1432725776),e(4094571909,1467031594),e(275423344,851169720),e(430227734,3100823752),e(506948616,1363258195),e(659060556,3750685593),e(883997877,3785050280),e(958139571,3318307427),e(1322822218,3812723403),e(1537002063,2003034995),e(1747873779,3602036899),e(1955562222,1575990012),e(2024104815,1125592928),e(2227730452,2716904306),e(2361852424,442776044),e(2428436474,593698344),e(2756734187,3733110249),e(3204031479,2999351573),e(3329325298,3815920427),e(3391569614,3928383900),e(3515267271,566280711),e(3940187606,3454069534),e(4118630271,4000239992),e(116418474,1914138554),e(174292421,2731055270),e(289380356,3203993006),e(460393269,320620315),e(685471733,587496836),e(852142971,1086792851),e(1017036298,365543100),e(1126000580,2618297676),e(1288033470,3409855158),e(1501505948,4234509866),e(1607167915,987167468),e(1816402316,1246189591)],a=[],c=0;80>c;c++)a[c]=e();s=s.SHA512=n.extend({_doReset:function(){this._hash=new i.init([new r.init(1779033703,4089235720),new r.init(3144134277,2227873595),new r.init(1013904242,4271175723),new r.init(2773480762,1595750129),new r.init(1359893119,2917565137),new r.init(2600822924,725511199),new r.init(528734635,4215389547),new r.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=(h=this._hash.words)[0],r=h[1],i=h[2],s=h[3],c=h[4],l=h[5],u=h[6],h=h[7],d=n.high,p=n.low,f=r.high,g=r.low,m=i.high,y=i.low,v=s.high,b=s.low,S=c.high,w=c.low,x=l.high,C=l.low,E=u.high,T=u.low,A=h.high,k=h.low,N=d,O=p,P=f,R=g,I=m,F=y,D=v,M=b,L=S,_=w,q=x,B=C,j=E,z=T,H=A,U=k,V=0;80>V;V++){var G=a[V];if(16>V)var W=G.high=0|e[t+2*V],K=G.low=0|e[t+2*V+1];else{W=((K=(W=a[V-15]).high)>>>1|($=W.low)<<31)^(K>>>8|$<<24)^K>>>7;var $=($>>>1|K<<31)^($>>>8|K<<24)^($>>>7|K<<25),J=((K=(J=a[V-2]).high)>>>19|(Q=J.low)<<13)^(K<<3|Q>>>29)^K>>>6,Q=(Q>>>19|K<<13)^(Q<<3|K>>>29)^(Q>>>6|K<<26),X=(K=a[V-7]).high,Z=(Y=a[V-16]).high,Y=Y.low;W=(W=(W=W+X+((K=$+K.low)>>>0<$>>>0?1:0))+J+((K+=Q)>>>0<Q>>>0?1:0))+Z+((K+=Y)>>>0<Y>>>0?1:0),G.high=W,G.low=K}X=L&q^~L&j,Y=_&B^~_&z,G=N&P^N&I^P&I;var ee=O&R^O&F^R&F,te=($=(N>>>28|O<<4)^(N<<30|O>>>2)^(N<<25|O>>>7),J=(O>>>28|N<<4)^(O<<30|N>>>2)^(O<<25|N>>>7),(Q=o[V]).high),ne=Q.low;Z=H+((L>>>14|_<<18)^(L>>>18|_<<14)^(L<<23|_>>>9))+((Q=U+((_>>>14|L<<18)^(_>>>18|L<<14)^(_<<23|L>>>9)))>>>0<U>>>0?1:0),H=j,U=z,j=q,z=B,q=L,B=_,L=D+(Z=(Z=(Z=Z+X+((Q+=Y)>>>0<Y>>>0?1:0))+te+((Q+=ne)>>>0<ne>>>0?1:0))+W+((Q+=K)>>>0<K>>>0?1:0))+((_=M+Q|0)>>>0<M>>>0?1:0)|0,D=I,M=F,I=P,F=R,P=N,R=O,N=Z+(G=$+G+((K=J+ee)>>>0<J>>>0?1:0))+((O=Q+K|0)>>>0<Q>>>0?1:0)|0}p=n.low=p+O,n.high=d+N+(p>>>0<O>>>0?1:0),g=r.low=g+R,r.high=f+P+(g>>>0<R>>>0?1:0),y=i.low=y+F,i.high=m+I+(y>>>0<F>>>0?1:0),b=s.low=b+M,s.high=v+D+(b>>>0<M>>>0?1:0),w=c.low=w+_,c.high=S+L+(w>>>0<_>>>0?1:0),C=l.low=C+B,l.high=x+q+(C>>>0<B>>>0?1:0),T=u.low=T+z,u.high=E+j+(T>>>0<z>>>0?1:0),k=h.low=k+U,h.high=A+H+(k>>>0<U>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[30+(r+128>>>10<<5)]=Math.floor(n/4294967296),t[31+(r+128>>>10<<5)]=n,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32}),t.SHA512=n._createHelper(s),t.HmacSHA512=n._createHmacHelper(s)}(),function(){var e=p,t=(i=e.x64).Word,n=i.WordArray,r=(i=e.algo).SHA512,i=i.SHA384=r.extend({_doReset:function(){this._hash=new n.init([new t.init(3418070365,3238371032),new t.init(1654270250,914150663),new t.init(2438529370,812702999),new t.init(355462360,4144912697),new t.init(1731405415,4290775857),new t.init(2394180231,1750603025),new t.init(3675008525,1694076839),new t.init(1203062813,3204075428)])},_doFinalize:function(){var e=r._doFinalize.call(this);return e.sigBytes-=16,e}});e.SHA384=r._createHelper(i),e.HmacSHA384=r._createHmacHelper(i)}(),function(){var e=p,t=(r=e.lib).WordArray,n=r.Hasher,r=e.algo,i=t.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),s=t.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),o=t.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),a=t.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),c=t.create([0,1518500249,1859775393,2400959708,2840853838]),l=t.create([1352829926,1548603684,1836072691,2053994217,0]);r=r.RIPEMD160=n.extend({_doReset:function(){this._hash=t.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=0;16>n;n++){var r=e[w=t+n];e[w]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}var u,h,d,p,f,g,m,y,v,b,S,w=this._hash.words,x=(r=c.words,l.words),C=i.words,E=s.words,T=o.words,A=a.words;for(g=u=w[0],m=h=w[1],y=d=w[2],v=p=w[3],b=f=w[4],n=0;80>n;n+=1)S=u+e[t+C[n]]|0,S=16>n?S+((h^d^p)+r[0]):32>n?S+((h&d|~h&p)+r[1]):48>n?S+(((h|~d)^p)+r[2]):64>n?S+((h&p|d&~p)+r[3]):S+((h^(d|~p))+r[4]),S=(S=(S|=0)<<T[n]|S>>>32-T[n])+f|0,u=f,f=p,p=d<<10|d>>>22,d=h,h=S,S=g+e[t+E[n]]|0,S=16>n?S+((m^(y|~v))+x[0]):32>n?S+((m&v|y&~v)+x[1]):48>n?S+(((m|~y)^v)+x[2]):64>n?S+((m&y|~m&v)+x[3]):S+((m^y^v)+x[4]),S=(S=(S|=0)<<A[n]|S>>>32-A[n])+b|0,g=b,b=v,v=y<<10|y>>>22,y=m,m=S;S=w[1]+d+v|0,w[1]=w[2]+p+b|0,w[2]=w[3]+f+g|0,w[3]=w[4]+u+m|0,w[4]=w[0]+h+y|0,w[0]=S},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;for(t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(t.length+1),this._process(),t=(e=this._hash).words,n=0;5>n;n++)r=t[n],t[n]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8);return e},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}}),e.RIPEMD160=n._createHelper(r),e.HmacRIPEMD160=n._createHmacHelper(r)}(Math),function(){var e=p,t=e.enc.Utf8;e.algo.HMAC=e.lib.Base.extend({init:function(e,n){e=this._hasher=new e.init,"string"==typeof n&&(n=t.parse(n));var r=e.blockSize,i=4*r;n.sigBytes>i&&(n=e.finalize(n)),n.clamp();for(var s=this._oKey=n.clone(),o=this._iKey=n.clone(),a=s.words,c=o.words,l=0;l<r;l++)a[l]^=1549556828,c[l]^=909522486;s.sigBytes=o.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}})}(),function(){var e,t=p,n=(e=t.lib).Base,r=e.WordArray,i=(e=t.algo).HMAC,s=e.PBKDF2=n.extend({cfg:n.extend({keySize:4,hasher:e.SHA1,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){var n=this.cfg,s=i.create(n.hasher,e),o=r.create(),a=r.create([1]),c=o.words,l=a.words,u=n.keySize;for(n=n.iterations;c.length<u;){var h=s.update(t).finalize(a);s.reset();for(var d=h.words,p=d.length,f=h,g=1;g<n;g++){f=s.finalize(f),s.reset();for(var m=f.words,y=0;y<p;y++)d[y]^=m[y]}o.concat(h),l[0]++}return o.sigBytes=4*u,o}});t.PBKDF2=function(e,t,n){return s.create(n).compute(e,t)}}();var f,g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",m="=";function y(e){var t,n,r="";for(t=0;t+3<=e.length;t+=3)n=parseInt(e.substring(t,t+3),16),r+=g.charAt(n>>6)+g.charAt(63&n);if(t+1==e.length?(n=parseInt(e.substring(t,t+1),16),r+=g.charAt(n<<2)):t+2==e.length&&(n=parseInt(e.substring(t,t+2),16),r+=g.charAt(n>>2)+g.charAt((3&n)<<4)),m)for(;(3&r.length)>0;)r+=m;return r}function v(e){var t,n,r,i="",s=0;for(t=0;t<e.length&&e.charAt(t)!=m;++t)(r=g.indexOf(e.charAt(t)))<0||(0==s?(i+=A(r>>2),n=3&r,s=1):1==s?(i+=A(n<<2|r>>4),n=15&r,s=2):2==s?(i+=A(n),i+=A(r>>2),n=3&r,s=3):(i+=A(n<<2|r>>4),i+=A(15&r),s=0));return 1==s&&(i+=A(n<<2)),i}function b(e){var t,n=v(e),r=new Array;for(t=0;2*t<n.length;++t)r[t]=parseInt(n.substring(2*t,2*t+2),16);return r}function S(e,t,n){null!=e&&("number"==typeof e?this.fromNumber(e,t,n):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function w(){return new S(null)}"Microsoft Internet Explorer"==h.appName?(S.prototype.am=function(e,t,n,r,i,s){for(var o=32767&t,a=t>>15;--s>=0;){var c=32767&this[e],l=this[e++]>>15,u=a*c+l*o;i=((c=o*c+((32767&u)<<15)+n[r]+(1073741823&i))>>>30)+(u>>>15)+a*l+(i>>>30),n[r++]=1073741823&c}return i},f=30):"Netscape"!=h.appName?(S.prototype.am=function(e,t,n,r,i,s){for(;--s>=0;){var o=t*this[e++]+n[r]+i;i=Math.floor(o/67108864),n[r++]=67108863&o}return i},f=26):(S.prototype.am=function(e,t,n,r,i,s){for(var o=16383&t,a=t>>14;--s>=0;){var c=16383&this[e],l=this[e++]>>14,u=a*c+l*o;i=((c=o*c+((16383&u)<<14)+n[r]+i)>>28)+(u>>14)+a*l,n[r++]=268435455&c}return i},f=28),S.prototype.DB=f,S.prototype.DM=(1<<f)-1,S.prototype.DV=1<<f,S.prototype.FV=Math.pow(2,52),S.prototype.F1=52-f,S.prototype.F2=2*f-52;var x,C,E="0123456789abcdefghijklmnopqrstuvwxyz",T=new Array;for(x="0".charCodeAt(0),C=0;C<=9;++C)T[x++]=C;for(x="a".charCodeAt(0),C=10;C<36;++C)T[x++]=C;for(x="A".charCodeAt(0),C=10;C<36;++C)T[x++]=C;function A(e){return E.charAt(e)}function k(e,t){var n=T[e.charCodeAt(t)];return null==n?-1:n}function N(e){var t=w();return t.fromInt(e),t}function O(e){var t,n=1;return 0!=(t=e>>>16)&&(e=t,n+=16),0!=(t=e>>8)&&(e=t,n+=8),0!=(t=e>>4)&&(e=t,n+=4),0!=(t=e>>2)&&(e=t,n+=2),0!=(t=e>>1)&&(e=t,n+=1),n}function P(e){this.m=e}function R(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function I(e,t){return e&t}function F(e,t){return e|t}function D(e,t){return e^t}function M(e,t){return e&~t}function L(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function _(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function q(){}function B(e){return e}function j(e){this.r2=w(),this.q3=w(),S.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}P.prototype.convert=function(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},P.prototype.revert=function(e){return e},P.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},P.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n),this.reduce(n)},P.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},R.prototype.convert=function(e){var t=w();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(S.ZERO)>0&&this.m.subTo(t,t),t},R.prototype.revert=function(e){var t=w();return e.copyTo(t),this.reduce(t),t},R.prototype.reduce=function(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var n=32767&e[t],r=n*this.mpl+((n*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[n=t+this.m.t]+=this.m.am(0,r,e,t,0,this.m.t);e[n]>=e.DV;)e[n]-=e.DV,e[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},R.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n),this.reduce(n)},R.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},S.prototype.copyTo=function(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s},S.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0},S.prototype.fromString=function(e,t){var n;if(16==t)n=4;else if(8==t)n=3;else if(256==t)n=8;else if(2==t)n=1;else if(32==t)n=5;else{if(4!=t)return void this.fromRadix(e,t);n=2}this.t=0,this.s=0;for(var r=e.length,i=!1,s=0;--r>=0;){var o=8==n?255&e[r]:k(e,r);o<0?"-"==e.charAt(r)&&(i=!0):(i=!1,0==s?this[this.t++]=o:s+n>this.DB?(this[this.t-1]|=(o&(1<<this.DB-s)-1)<<s,this[this.t++]=o>>this.DB-s):this[this.t-1]|=o<<s,(s+=n)>=this.DB&&(s-=this.DB))}8==n&&0!=(128&e[0])&&(this.s=-1,s>0&&(this[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),i&&S.ZERO.subTo(this,this)},S.prototype.clamp=function(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t},S.prototype.dlShiftTo=function(e,t){var n;for(n=this.t-1;n>=0;--n)t[n+e]=this[n];for(n=e-1;n>=0;--n)t[n]=0;t.t=this.t+e,t.s=this.s},S.prototype.drShiftTo=function(e,t){for(var n=e;n<this.t;++n)t[n-e]=this[n];t.t=Math.max(this.t-e,0),t.s=this.s},S.prototype.lShiftTo=function(e,t){var n,r=e%this.DB,i=this.DB-r,s=(1<<i)-1,o=Math.floor(e/this.DB),a=this.s<<r&this.DM;for(n=this.t-1;n>=0;--n)t[n+o+1]=this[n]>>i|a,a=(this[n]&s)<<r;for(n=o-1;n>=0;--n)t[n]=0;t[o]=a,t.t=this.t+o+1,t.s=this.s,t.clamp()},S.prototype.rShiftTo=function(e,t){t.s=this.s;var n=Math.floor(e/this.DB);if(n>=this.t)t.t=0;else{var r=e%this.DB,i=this.DB-r,s=(1<<r)-1;t[0]=this[n]>>r;for(var o=n+1;o<this.t;++o)t[o-n-1]|=(this[o]&s)<<i,t[o-n]=this[o]>>r;r>0&&(t[this.t-n-1]|=(this.s&s)<<i),t.t=this.t-n,t.clamp()}},S.prototype.subTo=function(e,t){for(var n=0,r=0,i=Math.min(e.t,this.t);n<i;)r+=this[n]-e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r-=e.s;n<this.t;)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<e.t;)r-=e[n],t[n++]=r&this.DM,r>>=this.DB;r-=e.s}t.s=r<0?-1:0,r<-1?t[n++]=this.DV+r:r>0&&(t[n++]=r),t.t=n,t.clamp()},S.prototype.multiplyTo=function(e,t){var n=this.abs(),r=e.abs(),i=n.t;for(t.t=i+r.t;--i>=0;)t[i]=0;for(i=0;i<r.t;++i)t[i+n.t]=n.am(0,r[i],t,i,0,n.t);t.s=0,t.clamp(),this.s!=e.s&&S.ZERO.subTo(t,t)},S.prototype.squareTo=function(e){for(var t=this.abs(),n=e.t=2*t.t;--n>=0;)e[n]=0;for(n=0;n<t.t-1;++n){var r=t.am(n,t[n],e,2*n,0,1);(e[n+t.t]+=t.am(n+1,2*t[n],e,2*n+1,r,t.t-n-1))>=t.DV&&(e[n+t.t]-=t.DV,e[n+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(n,t[n],e,2*n,0,1)),e.s=0,e.clamp()},S.prototype.divRemTo=function(e,t,n){var r=e.abs();if(!(r.t<=0)){var i=this.abs();if(i.t<r.t)return null!=t&&t.fromInt(0),void(null!=n&&this.copyTo(n));null==n&&(n=w());var s=w(),o=this.s,a=e.s,c=this.DB-O(r[r.t-1]);c>0?(r.lShiftTo(c,s),i.lShiftTo(c,n)):(r.copyTo(s),i.copyTo(n));var l=s.t,u=s[l-1];if(0!=u){var h=u*(1<<this.F1)+(l>1?s[l-2]>>this.F2:0),d=this.FV/h,p=(1<<this.F1)/h,f=1<<this.F2,g=n.t,m=g-l,y=null==t?w():t;for(s.dlShiftTo(m,y),n.compareTo(y)>=0&&(n[n.t++]=1,n.subTo(y,n)),S.ONE.dlShiftTo(l,y),y.subTo(s,s);s.t<l;)s[s.t++]=0;for(;--m>=0;){var v=n[--g]==u?this.DM:Math.floor(n[g]*d+(n[g-1]+f)*p);if((n[g]+=s.am(0,v,n,m,0,l))<v)for(s.dlShiftTo(m,y),n.subTo(y,n);n[g]<--v;)n.subTo(y,n)}null!=t&&(n.drShiftTo(l,t),o!=a&&S.ZERO.subTo(t,t)),n.t=l,n.clamp(),c>0&&n.rShiftTo(c,n),o<0&&S.ZERO.subTo(n,n)}}},S.prototype.invDigit=function(){if(this.t<1)return 0;var e=this[0];if(0==(1&e))return 0;var t=3&e;return(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)>0?this.DV-t:-t},S.prototype.isEven=function(){return 0==(this.t>0?1&this[0]:this.s)},S.prototype.exp=function(e,t){if(e>4294967295||e<1)return S.ONE;var n=w(),r=w(),i=t.convert(this),s=O(e)-1;for(i.copyTo(n);--s>=0;)if(t.sqrTo(n,r),(e&1<<s)>0)t.mulTo(r,i,n);else{var o=n;n=r,r=o}return t.revert(n)},S.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var n,r=(1<<t)-1,i=!1,s="",o=this.t,a=this.DB-o*this.DB%t;if(o-- >0)for(a<this.DB&&(n=this[o]>>a)>0&&(i=!0,s=A(n));o>=0;)a<t?(n=(this[o]&(1<<a)-1)<<t-a,n|=this[--o]>>(a+=this.DB-t)):(n=this[o]>>(a-=t)&r,a<=0&&(a+=this.DB,--o)),n>0&&(i=!0),i&&(s+=A(n));return i?s:"0"},S.prototype.negate=function(){var e=w();return S.ZERO.subTo(this,e),e},S.prototype.abs=function(){return this.s<0?this.negate():this},S.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var n=this.t;if(0!=(t=n-e.t))return this.s<0?-t:t;for(;--n>=0;)if(0!=(t=this[n]-e[n]))return t;return 0},S.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+O(this[this.t-1]^this.s&this.DM)},S.prototype.mod=function(e){var t=w();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(S.ZERO)>0&&e.subTo(t,t),t},S.prototype.modPowInt=function(e,t){var n;return n=e<256||t.isEven()?new P(t):new R(t),this.exp(e,n)},S.ZERO=N(0),S.ONE=N(1),q.prototype.convert=B,q.prototype.revert=B,q.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n)},q.prototype.sqrTo=function(e,t){e.squareTo(t)},j.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=w();return e.copyTo(t),this.reduce(t),t},j.prototype.revert=function(e){return e},j.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},j.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n),this.reduce(n)},j.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)};var z=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],H=(1<<26)/z[z.length-1];function U(){this.i=0,this.j=0,this.S=new Array}S.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},S.prototype.toRadix=function(e){if(null==e&&(e=10),0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),n=Math.pow(e,t),r=N(n),i=w(),s=w(),o="";for(this.divRemTo(r,i,s);i.signum()>0;)o=(n+s.intValue()).toString(e).substr(1)+o,i.divRemTo(r,i,s);return s.intValue().toString(e)+o},S.prototype.fromRadix=function(e,t){this.fromInt(0),null==t&&(t=10);for(var n=this.chunkSize(t),r=Math.pow(t,n),i=!1,s=0,o=0,a=0;a<e.length;++a){var c=k(e,a);c<0?"-"==e.charAt(a)&&0==this.signum()&&(i=!0):(o=t*o+c,++s>=n&&(this.dMultiply(r),this.dAddOffset(o,0),s=0,o=0))}s>0&&(this.dMultiply(Math.pow(t,s)),this.dAddOffset(o,0)),i&&S.ZERO.subTo(this,this)},S.prototype.fromNumber=function(e,t,n){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,n),this.testBit(e-1)||this.bitwiseTo(S.ONE.shiftLeft(e-1),F,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(S.ONE.shiftLeft(e-1),this);else{var r=new Array,i=7&e;r.length=1+(e>>3),t.nextBytes(r),i>0?r[0]&=(1<<i)-1:r[0]=0,this.fromString(r,256)}},S.prototype.bitwiseTo=function(e,t,n){var r,i,s=Math.min(e.t,this.t);for(r=0;r<s;++r)n[r]=t(this[r],e[r]);if(e.t<this.t){for(i=e.s&this.DM,r=s;r<this.t;++r)n[r]=t(this[r],i);n.t=this.t}else{for(i=this.s&this.DM,r=s;r<e.t;++r)n[r]=t(i,e[r]);n.t=e.t}n.s=t(this.s,e.s),n.clamp()},S.prototype.changeBit=function(e,t){var n=S.ONE.shiftLeft(e);return this.bitwiseTo(n,t,n),n},S.prototype.addTo=function(e,t){for(var n=0,r=0,i=Math.min(e.t,this.t);n<i;)r+=this[n]+e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r+=e.s;n<this.t;)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<e.t;)r+=e[n],t[n++]=r&this.DM,r>>=this.DB;r+=e.s}t.s=r<0?-1:0,r>0?t[n++]=r:r<-1&&(t[n++]=this.DV+r),t.t=n,t.clamp()},S.prototype.dMultiply=function(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},S.prototype.dAddOffset=function(e,t){if(0!=e){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=e;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}},S.prototype.multiplyLowerTo=function(e,t,n){var r,i=Math.min(this.t+e.t,t);for(n.s=0,n.t=i;i>0;)n[--i]=0;for(r=n.t-this.t;i<r;++i)n[i+this.t]=this.am(0,e[i],n,i,0,this.t);for(r=Math.min(e.t,t);i<r;++i)this.am(0,e[i],n,i,0,t-i);n.clamp()},S.prototype.multiplyUpperTo=function(e,t,n){--t;var r=n.t=this.t+e.t-t;for(n.s=0;--r>=0;)n[r]=0;for(r=Math.max(t-this.t,0);r<e.t;++r)n[this.t+r-t]=this.am(t-r,e[r],n,0,0,this.t+r-t);n.clamp(),n.drShiftTo(1,n)},S.prototype.modInt=function(e){if(e<=0)return 0;var t=this.DV%e,n=this.s<0?e-1:0;if(this.t>0)if(0==t)n=this[0]%e;else for(var r=this.t-1;r>=0;--r)n=(t*n+this[r])%e;return n},S.prototype.millerRabin=function(e){var t=this.subtract(S.ONE),n=t.getLowestSetBit();if(n<=0)return!1;var r=t.shiftRight(n);(e=e+1>>1)>z.length&&(e=z.length);for(var i=w(),s=0;s<e;++s){i.fromInt(z[Math.floor(Math.random()*z.length)]);var o=i.modPow(r,this);if(0!=o.compareTo(S.ONE)&&0!=o.compareTo(t)){for(var a=1;a++<n&&0!=o.compareTo(t);)if(0==(o=o.modPowInt(2,this)).compareTo(S.ONE))return!1;if(0!=o.compareTo(t))return!1}}return!0},S.prototype.clone=function(){var e=w();return this.copyTo(e),e},S.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},S.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},S.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},S.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},S.prototype.toByteArray=function(){var e=this.t,t=new Array;t[0]=this.s;var n,r=this.DB-e*this.DB%8,i=0;if(e-- >0)for(r<this.DB&&(n=this[e]>>r)!=(this.s&this.DM)>>r&&(t[i++]=n|this.s<<this.DB-r);e>=0;)r<8?(n=(this[e]&(1<<r)-1)<<8-r,n|=this[--e]>>(r+=this.DB-8)):(n=this[e]>>(r-=8)&255,r<=0&&(r+=this.DB,--e)),0!=(128&n)&&(n|=-256),0==i&&(128&this.s)!=(128&n)&&++i,(i>0||n!=this.s)&&(t[i++]=n);return t},S.prototype.equals=function(e){return 0==this.compareTo(e)},S.prototype.min=function(e){return this.compareTo(e)<0?this:e},S.prototype.max=function(e){return this.compareTo(e)>0?this:e},S.prototype.and=function(e){var t=w();return this.bitwiseTo(e,I,t),t},S.prototype.or=function(e){var t=w();return this.bitwiseTo(e,F,t),t},S.prototype.xor=function(e){var t=w();return this.bitwiseTo(e,D,t),t},S.prototype.andNot=function(e){var t=w();return this.bitwiseTo(e,M,t),t},S.prototype.not=function(){for(var e=w(),t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e},S.prototype.shiftLeft=function(e){var t=w();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},S.prototype.shiftRight=function(e){var t=w();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},S.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this[e])return e*this.DB+L(this[e]);return this.s<0?this.t*this.DB:-1},S.prototype.bitCount=function(){for(var e=0,t=this.s&this.DM,n=0;n<this.t;++n)e+=_(this[n]^t);return e},S.prototype.testBit=function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this[t]&1<<e%this.DB)},S.prototype.setBit=function(e){return this.changeBit(e,F)},S.prototype.clearBit=function(e){return this.changeBit(e,M)},S.prototype.flipBit=function(e){return this.changeBit(e,D)},S.prototype.add=function(e){var t=w();return this.addTo(e,t),t},S.prototype.subtract=function(e){var t=w();return this.subTo(e,t),t},S.prototype.multiply=function(e){var t=w();return this.multiplyTo(e,t),t},S.prototype.divide=function(e){var t=w();return this.divRemTo(e,t,null),t},S.prototype.remainder=function(e){var t=w();return this.divRemTo(e,null,t),t},S.prototype.divideAndRemainder=function(e){var t=w(),n=w();return this.divRemTo(e,t,n),new Array(t,n)},S.prototype.modPow=function(e,t){var n,r,i=e.bitLength(),s=N(1);if(i<=0)return s;n=i<18?1:i<48?3:i<144?4:i<768?5:6,r=i<8?new P(t):t.isEven()?new j(t):new R(t);var o=new Array,a=3,c=n-1,l=(1<<n)-1;if(o[1]=r.convert(this),n>1){var u=w();for(r.sqrTo(o[1],u);a<=l;)o[a]=w(),r.mulTo(u,o[a-2],o[a]),a+=2}var h,d,p=e.t-1,f=!0,g=w();for(i=O(e[p])-1;p>=0;){for(i>=c?h=e[p]>>i-c&l:(h=(e[p]&(1<<i+1)-1)<<c-i,p>0&&(h|=e[p-1]>>this.DB+i-c)),a=n;0==(1&h);)h>>=1,--a;if((i-=a)<0&&(i+=this.DB,--p),f)o[h].copyTo(s),f=!1;else{for(;a>1;)r.sqrTo(s,g),r.sqrTo(g,s),a-=2;a>0?r.sqrTo(s,g):(d=s,s=g,g=d),r.mulTo(g,o[h],s)}for(;p>=0&&0==(e[p]&1<<i);)r.sqrTo(s,g),d=s,s=g,g=d,--i<0&&(i=this.DB-1,--p)}return r.revert(s)},S.prototype.modInverse=function(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return S.ZERO;for(var n=e.clone(),r=this.clone(),i=N(1),s=N(0),o=N(0),a=N(1);0!=n.signum();){for(;n.isEven();)n.rShiftTo(1,n),t?(i.isEven()&&s.isEven()||(i.addTo(this,i),s.subTo(e,s)),i.rShiftTo(1,i)):s.isEven()||s.subTo(e,s),s.rShiftTo(1,s);for(;r.isEven();)r.rShiftTo(1,r),t?(o.isEven()&&a.isEven()||(o.addTo(this,o),a.subTo(e,a)),o.rShiftTo(1,o)):a.isEven()||a.subTo(e,a),a.rShiftTo(1,a);n.compareTo(r)>=0?(n.subTo(r,n),t&&i.subTo(o,i),s.subTo(a,s)):(r.subTo(n,r),t&&o.subTo(i,o),a.subTo(s,a))}return 0!=r.compareTo(S.ONE)?S.ZERO:a.compareTo(e)>=0?a.subtract(e):a.signum()<0?(a.addTo(e,a),a.signum()<0?a.add(e):a):a},S.prototype.pow=function(e){return this.exp(e,new q)},S.prototype.gcd=function(e){var t=this.s<0?this.negate():this.clone(),n=e.s<0?e.negate():e.clone();if(t.compareTo(n)<0){var r=t;t=n,n=r}var i=t.getLowestSetBit(),s=n.getLowestSetBit();if(s<0)return t;for(i<s&&(s=i),s>0&&(t.rShiftTo(s,t),n.rShiftTo(s,n));t.signum()>0;)(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),(i=n.getLowestSetBit())>0&&n.rShiftTo(i,n),t.compareTo(n)>=0?(t.subTo(n,t),t.rShiftTo(1,t)):(n.subTo(t,n),n.rShiftTo(1,n));return s>0&&n.lShiftTo(s,n),n},S.prototype.isProbablePrime=function(e){var t,n=this.abs();if(1==n.t&&n[0]<=z[z.length-1]){for(t=0;t<z.length;++t)if(n[0]==z[t])return!0;return!1}if(n.isEven())return!1;for(t=1;t<z.length;){for(var r=z[t],i=t+1;i<z.length&&r<H;)r*=z[i++];for(r=n.modInt(r);t<i;)if(r%z[t++]==0)return!1}return n.millerRabin(e)},S.prototype.square=function(){var e=w();return this.squareTo(e),e},U.prototype.init=function(e){var t,n,r;for(t=0;t<256;++t)this.S[t]=t;for(n=0,t=0;t<256;++t)n=n+this.S[t]+e[t%e.length]&255,r=this.S[t],this.S[t]=this.S[n],this.S[n]=r;this.i=0,this.j=0},U.prototype.next=function(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]};var V,G,W,K=256;function $(){!function(e){G[W++]^=255&e,G[W++]^=e>>8&255,G[W++]^=e>>16&255,G[W++]^=e>>24&255,W>=K&&(W-=K)}((new Date).getTime())}if(null==G){var J;if(G=new Array,W=0,void 0!==d&&(void 0!==d.crypto||void 0!==d.msCrypto)){var Q=d.crypto||d.msCrypto;if(Q.getRandomValues){var X=new Uint8Array(32);for(Q.getRandomValues(X),J=0;J<32;++J)G[W++]=X[J]}else if("Netscape"==h.appName&&h.appVersion<"5"){var Z=d.crypto.random(32);for(J=0;J<Z.length;++J)G[W++]=255&Z.charCodeAt(J)}}for(;W<K;)J=Math.floor(65536*Math.random()),G[W++]=J>>>8,G[W++]=255&J;W=0,$()}function Y(){if(null==V){for($(),(V=new U).init(G),W=0;W<G.length;++W)G[W]=0;W=0}return V.next()}function ee(){}function te(e,t){return new S(e,t)}function ne(e,t,n){for(var r="",i=0;r.length<t;)r+=n(String.fromCharCode.apply(String,e.concat([(4278190080&i)>>24,(16711680&i)>>16,(65280&i)>>8,255&i]))),i+=1;return r}function re(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function ie(e,t,n){for(var r="",i=0;r.length<t;)r+=n(e+String.fromCharCode.apply(String,[(4278190080&i)>>24,(16711680&i)>>16,(65280&i)>>8,255&i])),i+=1;return r}function se(e,t){this.x=t,this.q=e}function oe(e,t,n,r){this.curve=e,this.x=t,this.y=n,this.z=null==r?S.ONE:r,this.zinv=null}function ae(e,t,n){this.q=e,this.a=this.fromBigInteger(t),this.b=this.fromBigInteger(n),this.infinity=new oe(this,null,null)}ee.prototype.nextBytes=function(e){var t;for(t=0;t<e.length;++t)e[t]=Y()},re.prototype.doPublic=function(e){return e.modPowInt(this.e,this.n)},re.prototype.setPublic=function(e,t){if(this.isPublic=!0,this.isPrivate=!1,"string"!=typeof e)this.n=e,this.e=t;else{if(!(null!=e&&null!=t&&e.length>0&&t.length>0))throw"Invalid RSA public key";this.n=te(e,16),this.e=parseInt(t,16)}},re.prototype.encrypt=function(e){var t=function(e,t){if(t<e.length+11)throw"Message too long for RSA";for(var n=new Array,r=e.length-1;r>=0&&t>0;){var i=e.charCodeAt(r--);i<128?n[--t]=i:i>127&&i<2048?(n[--t]=63&i|128,n[--t]=i>>6|192):(n[--t]=63&i|128,n[--t]=i>>6&63|128,n[--t]=i>>12|224)}n[--t]=0;for(var s=new ee,o=new Array;t>2;){for(o[0]=0;0==o[0];)s.nextBytes(o);n[--t]=o[0]}return n[--t]=2,n[--t]=0,new S(n)}(e,this.n.bitLength()+7>>3);if(null==t)return null;var n=this.doPublic(t);if(null==n)return null;var r=n.toString(16);return 0==(1&r.length)?r:"0"+r},re.prototype.encryptOAEP=function(e,t,n){var r=this.n.bitLength()+7>>3,i=function(e,t,n,r){var i=le.crypto.MessageDigest,s=le.crypto.Util,o=null;if(n||(n="sha1"),"string"==typeof n&&(o=i.getCanonicalAlgName(n),r=i.getHashLength(o),n=function(e){return Ee(s.hashHex(Te(e),o))}),e.length+2*r+2>t)throw"Message too long for RSA";var a,c="";for(a=0;a<t-e.length-2*r-2;a+=1)c+="\0";var l=n("")+c+""+e,u=new Array(r);(new ee).nextBytes(u);var h=ne(u,l.length,n),d=[];for(a=0;a<l.length;a+=1)d[a]=l.charCodeAt(a)^h.charCodeAt(a);var p=ne(d,u.length,n),f=[0];for(a=0;a<u.length;a+=1)f[a+1]=u[a]^p.charCodeAt(a);return new S(f.concat(d))}(e,r,t,n);if(null==i)return null;var s=this.doPublic(i);if(null==s)return null;for(var o=s.toString(16);o.length<2*r;)o="0"+o;return o},re.prototype.type="RSA",re.prototype.doPrivate=function(e){if(null==this.p||null==this.q)return e.modPow(this.d,this.n);for(var t=e.mod(this.p).modPow(this.dmp1,this.p),n=e.mod(this.q).modPow(this.dmq1,this.q);t.compareTo(n)<0;)t=t.add(this.p);return t.subtract(n).multiply(this.coeff).mod(this.p).multiply(this.q).add(n)},re.prototype.setPrivate=function(e,t,n){if(this.isPrivate=!0,"string"!=typeof e)this.n=e,this.e=t,this.d=n;else{if(!(null!=e&&null!=t&&e.length>0&&t.length>0))throw"Invalid RSA private key";this.n=te(e,16),this.e=parseInt(t,16),this.d=te(n,16)}},re.prototype.setPrivateEx=function(e,t,n,r,i,s,o,a){if(this.isPrivate=!0,this.isPublic=!1,null==e)throw"RSASetPrivateEx N == null";if(null==t)throw"RSASetPrivateEx E == null";if(0==e.length)throw"RSASetPrivateEx N.length == 0";if(0==t.length)throw"RSASetPrivateEx E.length == 0";if(!(null!=e&&null!=t&&e.length>0&&t.length>0))throw"Invalid RSA private key in RSASetPrivateEx";this.n=te(e,16),this.e=parseInt(t,16),this.d=te(n,16),this.p=te(r,16),this.q=te(i,16),this.dmp1=te(s,16),this.dmq1=te(o,16),this.coeff=te(a,16)},re.prototype.generate=function(e,t){var n=new ee,r=e>>1;this.e=parseInt(t,16);for(var i=new S(t,16),s=e/2-100,o=S.ONE.shiftLeft(s);;){for(;this.p=new S(e-r,1,n),0!=this.p.subtract(S.ONE).gcd(i).compareTo(S.ONE)||!this.p.isProbablePrime(10););for(;this.q=new S(r,1,n),0!=this.q.subtract(S.ONE).gcd(i).compareTo(S.ONE)||!this.q.isProbablePrime(10););if(this.p.compareTo(this.q)<=0){var a=this.p;this.p=this.q,this.q=a}var c=this.q.subtract(this.p).abs();if(!(c.bitLength()<s||c.compareTo(o)<=0)){var l=this.p.subtract(S.ONE),u=this.q.subtract(S.ONE),h=l.multiply(u);if(0==h.gcd(i).compareTo(S.ONE)&&(this.n=this.p.multiply(this.q),this.n.bitLength()==e)){this.d=i.modInverse(h),this.dmp1=this.d.mod(l),this.dmq1=this.d.mod(u),this.coeff=this.q.modInverse(this.p);break}}}this.isPrivate=!0},re.prototype.decrypt=function(e){if(e.length!=Math.ceil(this.n.bitLength()/4))throw new Error("wrong ctext length");var t=te(e,16),n=this.doPrivate(t);return null==n?null:function(e,t){for(var n=e.toByteArray(),r=0;r<n.length&&0==n[r];)++r;if(n.length-r!=t-1||2!=n[r])return null;for(++r;0!=n[r];)if(++r>=n.length)return null;for(var i="";++r<n.length;){var s=255&n[r];s<128?i+=String.fromCharCode(s):s>191&&s<224?(i+=String.fromCharCode((31&s)<<6|63&n[r+1]),++r):(i+=String.fromCharCode((15&s)<<12|(63&n[r+1])<<6|63&n[r+2]),r+=2)}return i}(n,this.n.bitLength()+7>>3)},re.prototype.decryptOAEP=function(e,t,n){if(e.length!=Math.ceil(this.n.bitLength()/4))throw new Error("wrong ctext length");var r=te(e,16),i=this.doPrivate(r);return null==i?null:function(e,t,n,r){var i=le.crypto.MessageDigest,s=le.crypto.Util,o=null;for(n||(n="sha1"),"string"==typeof n&&(o=i.getCanonicalAlgName(n),r=i.getHashLength(o),n=function(e){return Ee(s.hashHex(Te(e),o))}),e=e.toByteArray(),a=0;a<e.length;a+=1)e[a]&=255;for(;e.length<t;)e.unshift(0);if((e=String.fromCharCode.apply(String,e)).length<2*r+2)throw"Cipher too short";var a,c=e.substr(1,r),l=e.substr(r+1),u=ie(l,r,n),h=[];for(a=0;a<c.length;a+=1)h[a]=c.charCodeAt(a)^u.charCodeAt(a);var d=ie(String.fromCharCode.apply(String,h),e.length-r,n),p=[];for(a=0;a<l.length;a+=1)p[a]=l.charCodeAt(a)^d.charCodeAt(a);if((p=String.fromCharCode.apply(String,p)).substr(0,r)!==n(""))throw"Hash mismatch";var f=(p=p.substr(r)).indexOf("");if((-1!=f?p.substr(0,f).lastIndexOf("\0"):-1)+1!=f)throw"Malformed data";return p.substr(f+1)}(i,this.n.bitLength()+7>>3,t,n)},se.prototype.equals=function(e){return e==this||this.q.equals(e.q)&&this.x.equals(e.x)},se.prototype.toBigInteger=function(){return this.x},se.prototype.negate=function(){return new se(this.q,this.x.negate().mod(this.q))},se.prototype.add=function(e){return new se(this.q,this.x.add(e.toBigInteger()).mod(this.q))},se.prototype.subtract=function(e){return new se(this.q,this.x.subtract(e.toBigInteger()).mod(this.q))},se.prototype.multiply=function(e){return new se(this.q,this.x.multiply(e.toBigInteger()).mod(this.q))},se.prototype.square=function(){return new se(this.q,this.x.square().mod(this.q))},se.prototype.divide=function(e){return new se(this.q,this.x.multiply(e.toBigInteger().modInverse(this.q)).mod(this.q))},se.prototype.sqrt=function(){return new se(this.q,this.x.sqrt().mod(this.q))},oe.prototype.getX=function(){return null==this.zinv&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))},oe.prototype.getY=function(){return null==this.zinv&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))},oe.prototype.equals=function(e){return e==this||(this.isInfinity()?e.isInfinity():e.isInfinity()?this.isInfinity():!!e.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(e.z)).mod(this.curve.q).equals(S.ZERO)&&e.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(e.z)).mod(this.curve.q).equals(S.ZERO))},oe.prototype.isInfinity=function(){return null==this.x&&null==this.y||this.z.equals(S.ZERO)&&!this.y.toBigInteger().equals(S.ZERO)},oe.prototype.negate=function(){return new oe(this.curve,this.x,this.y.negate(),this.z)},oe.prototype.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var t=e.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(e.z)).mod(this.curve.q),n=e.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(e.z)).mod(this.curve.q);if(S.ZERO.equals(n))return S.ZERO.equals(t)?this.twice():this.curve.getInfinity();var r=new S("3"),i=this.x.toBigInteger(),s=this.y.toBigInteger(),o=(e.x.toBigInteger(),e.y.toBigInteger(),n.square()),a=o.multiply(n),c=i.multiply(o),l=t.square().multiply(this.z),u=l.subtract(c.shiftLeft(1)).multiply(e.z).subtract(a).multiply(n).mod(this.curve.q),h=c.multiply(r).multiply(t).subtract(s.multiply(a)).subtract(l.multiply(t)).multiply(e.z).add(t.multiply(a)).mod(this.curve.q),d=a.multiply(this.z).multiply(e.z).mod(this.curve.q);return new oe(this.curve,this.curve.fromBigInteger(u),this.curve.fromBigInteger(h),d)},oe.prototype.twice=function(){if(this.isInfinity())return this;if(0==this.y.toBigInteger().signum())return this.curve.getInfinity();var e=new S("3"),t=this.x.toBigInteger(),n=this.y.toBigInteger(),r=n.multiply(this.z),i=r.multiply(n).mod(this.curve.q),s=this.curve.a.toBigInteger(),o=t.square().multiply(e);S.ZERO.equals(s)||(o=o.add(this.z.square().multiply(s)));var a=(o=o.mod(this.curve.q)).square().subtract(t.shiftLeft(3).multiply(i)).shiftLeft(1).multiply(r).mod(this.curve.q),c=o.multiply(e).multiply(t).subtract(i.shiftLeft(1)).shiftLeft(2).multiply(i).subtract(o.square().multiply(o)).mod(this.curve.q),l=r.square().multiply(r).shiftLeft(3).mod(this.curve.q);return new oe(this.curve,this.curve.fromBigInteger(a),this.curve.fromBigInteger(c),l)},oe.prototype.multiply=function(e){if(this.isInfinity())return this;if(0==e.signum())return this.curve.getInfinity();var t,n=e,r=n.multiply(new S("3")),i=this.negate(),s=this,o=this.curve.q.subtract(e),a=o.multiply(new S("3")),c=new oe(this.curve,this.x,this.y),l=c.negate();for(t=r.bitLength()-2;t>0;--t){s=s.twice();var u=r.testBit(t);u!=n.testBit(t)&&(s=s.add(u?this:i))}for(t=a.bitLength()-2;t>0;--t){c=c.twice();var h=a.testBit(t);h!=o.testBit(t)&&(c=c.add(h?c:l))}return s},oe.prototype.multiplyTwo=function(e,t,n){var r;r=e.bitLength()>n.bitLength()?e.bitLength()-1:n.bitLength()-1;for(var i=this.curve.getInfinity(),s=this.add(t);r>=0;)i=i.twice(),e.testBit(r)?i=n.testBit(r)?i.add(s):i.add(this):n.testBit(r)&&(i=i.add(t)),--r;return i},ae.prototype.getQ=function(){return this.q},ae.prototype.getA=function(){return this.a},ae.prototype.getB=function(){return this.b},ae.prototype.equals=function(e){return e==this||this.q.equals(e.q)&&this.a.equals(e.a)&&this.b.equals(e.b)},ae.prototype.getInfinity=function(){return this.infinity},ae.prototype.fromBigInteger=function(e){return new se(this.q,e)},ae.prototype.decodePointHex=function(e){switch(parseInt(e.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:var t=e.substr(0,2),n=(e.substr(2),this.fromBigInteger(new S(a,16))),r=this.getA(),i=this.getB(),s=n.square().add(r).multiply(n).add(i).sqrt();return"03"==t&&(s=s.negate()),new oe(this,n,s);case 4:case 6:case 7:var o=(e.length-2)/2,a=e.substr(2,o),c=e.substr(o+2,o);return new oe(this,this.fromBigInteger(new S(a,16)),this.fromBigInteger(new S(c,16)));default:return null}},se.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)},oe.prototype.getEncoded=function(e){var t=function(e,t){var n=e.toByteArrayUnsigned();if(t<n.length)n=n.slice(n.length-t);else for(;t>n.length;)n.unshift(0);return n},n=this.getX().toBigInteger(),r=this.getY().toBigInteger(),i=t(n,32);return e?r.isEven()?i.unshift(2):i.unshift(3):(i.unshift(4),i=i.concat(t(r,32))),i},oe.decodeFrom=function(e,t){t[0];var n=t.length-1,r=t.slice(1,1+n/2),i=t.slice(1+n/2,1+n);r.unshift(0),i.unshift(0);var s=new S(r),o=new S(i);return new oe(e,e.fromBigInteger(s),e.fromBigInteger(o))},oe.decodeFromHex=function(e,t){t.substr(0,2);var n=t.length-2,r=t.substr(2,n/2),i=t.substr(2+n/2,n/2),s=new S(r,16),o=new S(i,16);return new oe(e,e.fromBigInteger(s),e.fromBigInteger(o))},oe.prototype.add2D=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;if(this.x.equals(e.x))return this.y.equals(e.y)?this.twice():this.curve.getInfinity();var t=e.x.subtract(this.x),n=e.y.subtract(this.y).divide(t),r=n.square().subtract(this.x).subtract(e.x),i=n.multiply(this.x.subtract(r)).subtract(this.y);return new oe(this.curve,r,i)},oe.prototype.twice2D=function(){if(this.isInfinity())return this;if(0==this.y.toBigInteger().signum())return this.curve.getInfinity();var e=this.curve.fromBigInteger(S.valueOf(2)),t=this.curve.fromBigInteger(S.valueOf(3)),n=this.x.square().multiply(t).add(this.curve.a).divide(this.y.multiply(e)),r=n.square().subtract(this.x.multiply(e)),i=n.multiply(this.x.subtract(r)).subtract(this.y);return new oe(this.curve,r,i)},oe.prototype.multiply2D=function(e){if(this.isInfinity())return this;if(0==e.signum())return this.curve.getInfinity();var t,n=e,r=n.multiply(new S("3")),i=this.negate(),s=this;for(t=r.bitLength()-2;t>0;--t){s=s.twice();var o=r.testBit(t);o!=n.testBit(t)&&(s=s.add2D(o?this:i))}return s},oe.prototype.isOnCurve=function(){var e=this.getX().toBigInteger(),t=this.getY().toBigInteger(),n=this.curve.getA().toBigInteger(),r=this.curve.getB().toBigInteger(),i=this.curve.getQ(),s=t.multiply(t).mod(i),o=e.multiply(e).multiply(e).add(n.multiply(e)).add(r).mod(i);return s.equals(o)},oe.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"},oe.prototype.validate=function(){var e=this.curve.getQ();if(this.isInfinity())throw new Error("Point is at infinity.");var t=this.getX().toBigInteger(),n=this.getY().toBigInteger();if(t.compareTo(S.ONE)<0||t.compareTo(e.subtract(S.ONE))>0)throw new Error("x coordinate out of bounds");if(n.compareTo(S.ONE)<0||n.compareTo(e.subtract(S.ONE))>0)throw new Error("y coordinate out of bounds");if(!this.isOnCurve())throw new Error("Point is not on the curve.");if(this.multiply(e).isInfinity())throw new Error("Point is not a scalar multiple of G.");return!0};var ce=function(){var e=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),t=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),n={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};function r(e,t,r){return t?n[t]:String.fromCharCode(parseInt(r,16))}var i=new String(""),s=Object.hasOwnProperty;return function(n,o){var a,c,l=n.match(e),u=l[0],h=!1;"{"===u?a={}:"["===u?a=[]:(a=[],h=!0);for(var d=[a],p=1-h,f=l.length;p<f;++p){var g;switch((u=l[p]).charCodeAt(0)){default:(g=d[0])[c||g.length]=+u,c=void 0;break;case 34:if(-1!==(u=u.substring(1,u.length-1)).indexOf("\\")&&(u=u.replace(t,r)),g=d[0],!c){if(!(g instanceof Array)){c=u||i;break}c=g.length}g[c]=u,c=void 0;break;case 91:g=d[0],d.unshift(g[c||g.length]=[]),c=void 0;break;case 93:case 125:d.shift();break;case 102:(g=d[0])[c||g.length]=!1,c=void 0;break;case 110:(g=d[0])[c||g.length]=null,c=void 0;break;case 116:(g=d[0])[c||g.length]=!0,c=void 0;break;case 123:g=d[0],d.unshift(g[c||g.length]={}),c=void 0}}if(h){if(1!==d.length)throw new Error;a=a[0]}else if(d.length)throw new Error;if(o){var m=function(e,t){var n=e[t];if(n&&"object"==typeof n){var r=null;for(var i in n)if(s.call(n,i)&&n!==e){var a=m(n,i);void 0!==a?n[i]=a:(r||(r=[]),r.push(i))}if(r)for(var c=r.length;--c>=0;)delete n[r[c]]}return o.call(e,t,n)};a=m({"":a},"")}return a}}();void 0!==le&&le||(le={}),void 0!==le.asn1&&le.asn1||(le.asn1={}),le.asn1.ASN1Util=new function(){this.integerToByteHex=function(e){var t=e.toString(16);return t.length%2==1&&(t="0"+t),t},this.bigIntToMinTwosComplementsHex=function(e){return Qe(e)},this.getPEMStringFromHex=function(e,t){return Oe(e,t)},this.newObject=function(e){var t=le.asn1,n=t.ASN1Object,r=t.DERBoolean,i=t.DERInteger,s=t.DERBitString,o=t.DEROctetString,a=t.DERNull,c=t.DERObjectIdentifier,l=t.DEREnumerated,u=t.DERUTF8String,h=t.DERNumericString,d=t.DERPrintableString,p=t.DERTeletexString,f=t.DERIA5String,g=t.DERUTCTime,m=t.DERGeneralizedTime,y=t.DERVisibleString,v=t.DERBMPString,b=t.DERSequence,S=t.DERSet,w=t.DERTaggedObject,x=t.ASN1Util.newObject;if(e instanceof t.ASN1Object)return e;var C=Object.keys(e);if(1!=C.length)throw new Error("key of param shall be only one.");var E=C[0];if(-1==":asn1:bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:visstr:bmpstr:seq:set:tag:".indexOf(":"+E+":"))throw new Error("undefined key: "+E);if("bool"==E)return new r(e[E]);if("int"==E)return new i(e[E]);if("bitstr"==E)return new s(e[E]);if("octstr"==E)return new o(e[E]);if("null"==E)return new a(e[E]);if("oid"==E)return new c(e[E]);if("enum"==E)return new l(e[E]);if("utf8str"==E)return new u(e[E]);if("numstr"==E)return new h(e[E]);if("prnstr"==E)return new d(e[E]);if("telstr"==E)return new p(e[E]);if("ia5str"==E)return new f(e[E]);if("utctime"==E)return new g(e[E]);if("gentime"==E)return new m(e[E]);if("visstr"==E)return new y(e[E]);if("bmpstr"==E)return new v(e[E]);if("asn1"==E)return new n(e[E]);if("seq"==E){for(var T=e[E],A=[],k=0;k<T.length;k++){var N=x(T[k]);A.push(N)}return new b({array:A})}if("set"==E){for(T=e[E],A=[],k=0;k<T.length;k++)N=x(T[k]),A.push(N);return new S({array:A})}if("tag"==E){var O=e[E];if("[object Array]"===Object.prototype.toString.call(O)&&3==O.length){var P=x(O[2]);return new w({tag:O[0],explicit:O[1],obj:P})}return new w(O)}},this.jsonToASN1HEX=function(e){return this.newObject(e).tohex()}},le.asn1.ASN1Util.oidHexToInt=function(e){for(var t="",n=parseInt(e.substr(0,2),16),r=(t=Math.floor(n/40)+"."+n%40,""),i=2;i<e.length;i+=2){var s=("00000000"+parseInt(e.substr(i,2),16).toString(2)).slice(-8);r+=s.substr(1,7),"0"==s.substr(0,1)&&(t=t+"."+new S(r,2).toString(10),r="")}return t},le.asn1.ASN1Util.oidIntToHex=function(e){var t=function(e){var t=e.toString(16);return 1==t.length&&(t="0"+t),t},n=function(e){var n="",r=new S(e,10).toString(2),i=7-r.length%7;7==i&&(i=0);for(var s="",o=0;o<i;o++)s+="0";for(r=s+r,o=0;o<r.length-1;o+=7){var a=r.substr(o,7);o!=r.length-7&&(a="1"+a),n+=t(parseInt(a,2))}return n};if(!e.match(/^[0-9.]+$/))throw"malformed oid string: "+e;var r="",i=e.split("."),s=40*parseInt(i[0])+parseInt(i[1]);r+=t(s),i.splice(0,2);for(var o=0;o<i.length;o++)r+=n(i[o]);return r},le.asn1.ASN1Object=function(e){this.params=null,this.getLengthHexFromValue=function(){if(void 0===this.hV||null==this.hV)throw new Error("this.hV is null or undefined");if(this.hV.length%2==1)throw new Error("value hex must be even length: n=0,v="+this.hV);var e=this.hV.length/2,t=e.toString(16);if(t.length%2==1&&(t="0"+t),e<128)return t;var n=t.length/2;if(n>15)throw new Error("ASN.1 length too long to represent by 8x: n = "+e.toString(16));return(128+n).toString(16)+t},this.tohex=function(){return(null==this.hTLV||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getEncodedHex=function(){return this.tohex()},this.getValueHex=function(){return this.tohex(),this.hV},this.getFreshValueHex=function(){return""},this.setByParam=function(e){this.params=e},null!=e&&null!=e.tlv&&(this.hTLV=e.tlv,this.isModified=!1)},le.asn1.DERAbstractString=function(e){le.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(e){this.hTLV=null,this.isModified=!0,this.s=e,this.hV=we(this.s).toLowerCase()},this.setStringHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.getFreshValueHex=function(){return this.hV},void 0!==e&&("string"==typeof e?this.setString(e):void 0!==e.str?this.setString(e.str):void 0!==e.hex&&this.setStringHex(e.hex))},rt(le.asn1.DERAbstractString,le.asn1.ASN1Object),le.asn1.DERAbstractTime=function(e){le.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(e){var t=e.getTime()+6e4*e.getTimezoneOffset();return new Date(t)},this.formatDate=function(e,t,n){var r=this.zeroPadding,i=this.localDateToUTC(e),s=String(i.getFullYear());"utc"==t&&(s=s.substr(2,2));var o=s+r(String(i.getMonth()+1),2)+r(String(i.getDate()),2)+r(String(i.getHours()),2)+r(String(i.getMinutes()),2)+r(String(i.getSeconds()),2);if(!0===n){var a=i.getMilliseconds();if(0!=a){var c=r(String(a),3);o=o+"."+(c=c.replace(/[0]+$/,""))}}return o+"Z"},this.zeroPadding=function(e,t){return e.length>=t?e:new Array(t-e.length+1).join("0")+e},this.setByParam=function(e){this.hV=null,this.hTLV=null,this.params=e},this.getString=function(){},this.setString=function(e){this.hTLV=null,this.isModified=!0,null==this.params&&(this.params={}),this.params.str=e},this.setByDate=function(e){this.hTLV=null,this.isModified=!0,null==this.params&&(this.params={}),this.params.date=e},this.setByDateValue=function(e,t,n,r,i,s){var o=new Date(Date.UTC(e,t-1,n,r,i,s,0));this.setByDate(o)},this.getFreshValueHex=function(){return this.hV}},rt(le.asn1.DERAbstractTime,le.asn1.ASN1Object),le.asn1.DERAbstractStructured=function(e){le.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array=e},this.appendASN1Object=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array.push(e)},this.asn1Array=new Array,void 0!==e&&void 0!==e.array&&(this.asn1Array=e.array)},rt(le.asn1.DERAbstractStructured,le.asn1.ASN1Object),le.asn1.DERBoolean=function(e){le.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV=0==e?"010100":"0101ff"},rt(le.asn1.DERBoolean,le.asn1.ASN1Object),le.asn1.DERInteger=function(e){le.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.params=null;var t=Qe;this.setByBigInteger=function(e){this.isModified=!0,this.params={bigint:e}},this.setByInteger=function(e){this.isModified=!0,this.params=e},this.setValueHex=function(e){this.isModified=!0,this.params={hex:e}},this.getFreshValueHex=function(){var e=this.params,n=null;if(null==e)throw new Error("value not set");if("object"==typeof e&&null!=e.hex)return this.hV=e.hex,this.hV;if("number"==typeof e)n=new S(String(e),10);else if(null!=e.int)n=new S(String(e.int),10);else{if(null==e.bigint)throw new Error("wrong parameter");n=e.bigint}return this.hV=t(n),this.hV},null!=e&&(this.params=e)},rt(le.asn1.DERInteger,le.asn1.ASN1Object),le.asn1.DERBitString=function(e){if(void 0!==e&&void 0!==e.obj){var t=le.asn1.ASN1Util.newObject(e.obj);e.hex="00"+t.tohex()}le.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(e){this.hTLV=null,this.isModified=!0,this.hV=e},this.setUnusedBitsAndHexValue=function(e,t){if(e<0||7<e)throw"unused bits shall be from 0 to 7: u = "+e;var n="0"+e;this.hTLV=null,this.isModified=!0,this.hV=n+t},this.setByBinaryString=function(e){var t=8-(e=e.replace(/0+$/,"")).length%8;8==t&&(t=0),e+="0000000".substr(0,t);for(var n="",r=0;r<e.length-1;r+=8){var i=e.substr(r,8),s=parseInt(i,2).toString(16);1==s.length&&(s="0"+s),n+=s}this.hTLV=null,this.isModified=!0,this.hV="0"+t+n},this.setByBooleanArray=function(e){for(var t="",n=0;n<e.length;n++)1==e[n]?t+="1":t+="0";this.setByBinaryString(t)},this.newFalseArray=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=!1;return t},this.getFreshValueHex=function(){return this.hV},void 0!==e&&("string"==typeof e&&e.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(e):void 0!==e.hex?this.setHexValueIncludingUnusedBits(e.hex):void 0!==e.bin?this.setByBinaryString(e.bin):void 0!==e.array&&this.setByBooleanArray(e.array))},rt(le.asn1.DERBitString,le.asn1.ASN1Object),le.asn1.DEROctetString=function(e){if(void 0!==e&&void 0!==e.obj){var t=le.asn1.ASN1Util.newObject(e.obj);e.hex=t.tohex()}le.asn1.DEROctetString.superclass.constructor.call(this,e),this.hT="04"},rt(le.asn1.DEROctetString,le.asn1.DERAbstractString),le.asn1.DERNull=function(){le.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},rt(le.asn1.DERNull,le.asn1.ASN1Object),le.asn1.DERObjectIdentifier=function(e){le.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.setValueOidString=function(e){var t=Ke(e);if(null==t)throw new Error("malformed oid string: "+e);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=t},this.setValueName=function(e){var t=le.asn1.x509.OID.name2oid(e);if(""===t)throw new Error("DERObjectIdentifier oidName undefined: "+e);this.setValueOidString(t)},this.setValueNameOrOid=function(e){e.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(e):this.setValueName(e)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(e){"string"==typeof e?this.setValueNameOrOid(e):void 0!==e.oid?this.setValueNameOrOid(e.oid):void 0!==e.name?this.setValueNameOrOid(e.name):void 0!==e.hex&&this.setValueHex(e.hex)},void 0!==e&&this.setByParam(e)},rt(le.asn1.DERObjectIdentifier,le.asn1.ASN1Object),le.asn1.DEREnumerated=function(e){le.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(e){this.hTLV=null,this.isModified=!0,this.hV=Qe(e)},this.setByInteger=function(e){var t=new S(String(e),10);this.setByBigInteger(t)},this.setValueHex=function(e){this.hV=e},this.getFreshValueHex=function(){return this.hV},void 0!==e&&(void 0!==e.int?this.setByInteger(e.int):"number"==typeof e?this.setByInteger(e):void 0!==e.hex&&this.setValueHex(e.hex))},rt(le.asn1.DEREnumerated,le.asn1.ASN1Object),le.asn1.DERUTF8String=function(e){le.asn1.DERUTF8String.superclass.constructor.call(this,e),this.hT="0c"},rt(le.asn1.DERUTF8String,le.asn1.DERAbstractString),le.asn1.DERNumericString=function(e){le.asn1.DERNumericString.superclass.constructor.call(this,e),this.hT="12"},rt(le.asn1.DERNumericString,le.asn1.DERAbstractString),le.asn1.DERPrintableString=function(e){le.asn1.DERPrintableString.superclass.constructor.call(this,e),this.hT="13"},rt(le.asn1.DERPrintableString,le.asn1.DERAbstractString),le.asn1.DERTeletexString=function(e){le.asn1.DERTeletexString.superclass.constructor.call(this,e),this.hT="14"},rt(le.asn1.DERTeletexString,le.asn1.DERAbstractString),le.asn1.DERIA5String=function(e){le.asn1.DERIA5String.superclass.constructor.call(this,e),this.hT="16"},rt(le.asn1.DERIA5String,le.asn1.DERAbstractString),le.asn1.DERVisibleString=function(e){le.asn1.DERIA5String.superclass.constructor.call(this,e),this.hT="1a"},rt(le.asn1.DERVisibleString,le.asn1.DERAbstractString),le.asn1.DERBMPString=function(e){le.asn1.DERBMPString.superclass.constructor.call(this,e),this.hT="1e"},rt(le.asn1.DERBMPString,le.asn1.DERAbstractString),le.asn1.DERUTCTime=function(e){le.asn1.DERUTCTime.superclass.constructor.call(this,e),this.hT="17",this.params=void 0,this.getFreshValueHex=function(){var e=this.params;if(null==this.params&&(e={date:new Date}),"string"==typeof e){if(!e.match(/^[0-9]{12}Z$/)&&!e.match(/^[0-9]{12}\.[0-9]+Z$/))throw new Error("malformed string for UTCTime: "+e);this.hV=me(e)}else if(null!=e.str)this.hV=me(e.str);else if(null==e.date&&1==e.millis){var t=new Date;this.hV=me(this.formatDate(t,"utc",!0))}else if(null!=e.date&&e.date instanceof Date){var n=!0===e.millis;this.hV=me(this.formatDate(e.date,"utc",n))}else e instanceof Date&&(this.hV=me(this.formatDate(e,"utc")));if(null==this.hV)throw new Error("parameter not specified properly for UTCTime");return this.hV},null!=e&&this.setByParam(e)},rt(le.asn1.DERUTCTime,le.asn1.DERAbstractTime),le.asn1.DERGeneralizedTime=function(e){le.asn1.DERGeneralizedTime.superclass.constructor.call(this,e),this.hT="18",this.params=e,this.getFreshValueHex=function(){var e=this.params;if(null==this.params&&(e={date:new Date}),"string"==typeof e){if(!e.match(/^[0-9]{14}Z$/)&&!e.match(/^[0-9]{14}\.[0-9]+Z$/))throw new Error("malformed string for GeneralizedTime: "+e);this.hV=me(e)}else if(null!=e.str)this.hV=me(e.str);else if(null==e.date&&1==e.millis){var t=new Date;this.hV=me(this.formatDate(t,"gen",!0))}else if(null!=e.date&&e.date instanceof Date){var n=!0===e.millis;this.hV=me(this.formatDate(e.date,"gen",n))}else e instanceof Date&&(this.hV=me(this.formatDate(e,"gen")));if(null==this.hV)throw new Error("parameter not specified properly for GeneralizedTime");return this.hV},null!=e&&this.setByParam(e)},rt(le.asn1.DERGeneralizedTime,le.asn1.DERAbstractTime),le.asn1.DERSequence=function(e){le.asn1.DERSequence.superclass.constructor.call(this,e),this.hT="30",this.getFreshValueHex=function(){for(var e="",t=0;t<this.asn1Array.length;t++)e+=this.asn1Array[t].tohex();return this.hV=e,this.hV}},rt(le.asn1.DERSequence,le.asn1.DERAbstractStructured),le.asn1.DERSet=function(e){le.asn1.DERSet.superclass.constructor.call(this,e),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var e=new Array,t=0;t<this.asn1Array.length;t++){var n=this.asn1Array[t];e.push(n.tohex())}return 1==this.sortFlag&&e.sort(),this.hV=e.join(""),this.hV},void 0!==e&&void 0!==e.sortflag&&0==e.sortflag&&(this.sortFlag=!1)},rt(le.asn1.DERSet,le.asn1.DERAbstractStructured),le.asn1.DERTaggedObject=function(e){le.asn1.DERTaggedObject.superclass.constructor.call(this);var t=le.asn1,n=de,r=n.getV,i=(n.isASN1HEX,t.ASN1Util.newObject);this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.params={tag:"a0",explicit:!0},this.setASN1Object=function(e,t,n){this.params={tag:t,explicit:e,obj:n}},this.getFreshValueHex=function(){var e=this.params;if(null==e.explicit&&(e.explicit=!0),null!=e.tage&&(e.tag=e.tage,e.explicit=!0),null!=e.tagi&&(e.tag=e.tagi,e.explicit=!1),null!=e.str)this.hV=we(e.str);else if(null!=e.hex)this.hV=e.hex;else{if(null==e.obj)throw new Error("str, hex nor obj not specified");var n;e.obj instanceof t.ASN1Object?n=e.obj.tohex():"object"==typeof e.obj&&(n=i(e.obj).tohex()),e.explicit?this.hV=n:this.hV=r(n,0)}return null==e.tag&&(e.tag="a0"),this.hT=e.tag,this.hTLV=null,this.isModified=!0,this.hV},this.setByParam=function(e){this.params=e},void 0!==e&&this.setByParam(e)},rt(le.asn1.DERTaggedObject,le.asn1.ASN1Object);var le,ue,he,de=new function(){};function pe(e){for(var t=new Array,n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}function fe(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}function ge(e){for(var t="",n=0;n<e.length;n++){var r=e[n].toString(16);1==r.length&&(r="0"+r),t+=r}return t}function me(e){return ge(pe(e))}function ye(e){return(e=(e=e.replace(/\=/g,"")).replace(/\+/g,"-")).replace(/\//g,"_")}function ve(e){return e.length%4==2?e+="==":e.length%4==3&&(e+="="),(e=e.replace(/-/g,"+")).replace(/_/g,"/")}function be(e){return e.length%2==1&&(e="0"+e),ye(y(e))}function Se(e){return v(ve(e))}function we(e){return De(Ue(e)).toLowerCase()}function xe(e){try{return decodeURIComponent(Me(e))}catch(e){return null}}function Ce(e){return xe(function(e){for(var t=e.match(/.{1,2}/g),n=[],r=0;r<t.length;r++){var i=parseInt(t[r],16);161<=i&&i<=191?(n.push("c2"),n.push(t[r])):192<=i&&i<=255?(n.push("c3"),n.push((i-64).toString(16))):n.push(t[r])}return n.join("")}(e))}function Ee(e){for(var t="",n=0;n<e.length-1;n+=2)t+=String.fromCharCode(parseInt(e.substr(n,2),16));return t}function Te(e){for(var t="",n=0;n<e.length;n++)t+=("0"+e.charCodeAt(n).toString(16)).slice(-2);return t}function Ae(e){return y(e)}function ke(e,t){return(e=e.replace(new RegExp("(.{"+t+"})","g"),"$1\r\n")).replace(/\s+$/,"")}function Ne(e){return v(e.replace(/[^0-9A-Za-z\/+=]*/g,""))}function Oe(e,t){return"-----BEGIN "+t+"-----\r\n"+ke(Ae(e),64)+"\r\n-----END "+t+"-----\r\n"}function Pe(e,t){if(-1==e.indexOf("-----BEGIN "))throw new Error("can't find PEM header");return Ne(e=void 0!==t?(e=e.replace(new RegExp("^[^]*-----BEGIN "+t+"-----"),"")).replace(new RegExp("-----END "+t+"-----[^]*$"),""):(e=e.replace(/^[^]*-----BEGIN [^-]+-----/,"")).replace(/-----END [^-]+-----[^]*$/,""))}function Re(e){var t,n,r,i,s,o,a,c,l,u;if(u=(e=Fe(e)).match(/^(\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(|\.\d+)Z$/))return t=parseInt(u[1]),n=parseInt(u[2])-1,r=parseInt(u[3]),i=parseInt(u[4]),s=parseInt(u[5]),o=parseInt(u[6]),a=0,""!==(c=u[7])&&(l=(c.substr(1)+"00").substr(0,3),a=parseInt(l)),Date.UTC(t,n,r,i,s,o,a);throw new Error("unsupported zulu format: "+e)}function Ie(e){return Math.round(Re(e)/1e3)}function Fe(e){return e.match(/^[0-9]{12}Z$/)||e.match(/^[0-9]{12}[.][0-9]*Z$/)?e.match(/^[0-4]/)?"20"+e:"19"+e:e}function De(e){return e.replace(/%/g,"")}function Me(e){return e.replace(/(..)/g,"%$1")}function Le(e){var t="malformed IPv6 address";if(!e.match(/^[0-9A-Fa-f:]+$/))throw t;var n=(e=e.toLowerCase()).split(":").length-1;if(n<2)throw t;var r=":".repeat(7-n+2),i=(e=e.replace("::",r)).split(":");if(8!=i.length)throw t;for(var s=0;s<8;s++)i[s]=("0000"+i[s]).slice(-4);return i.join("")}function _e(e){if(!e.match(/^[0-9A-Fa-f]{32}$/))throw new Error("malformed IPv6 address: "+e);var t=(e=e.toLowerCase()).match(/.{1,4}/g);t=t.map((function(e){return e.replace(/^0+/,"")})),t=t.map((function(e){return""==e?"0":e}));var n=(e=":"+t.join(":")+":").match(/:(0:){2,}/g);if(null==n)return e.slice(1,-1);var r=n.sort().slice(-1)[0];return"::"!=(e=e.replace(r.substr(0,r.length-1),":")).substr(0,2)&&(e=e.substr(1)),"::"!=e.substr(-2,2)&&(e=e.substr(0,e.length-1)),e}function qe(e){var t=new Error("malformed hex value");if(!e.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw t;if(8==e.length)try{return parseInt(e.substr(0,2),16)+"."+parseInt(e.substr(2,2),16)+"."+parseInt(e.substr(4,2),16)+"."+parseInt(e.substr(6,2),16)}catch(e){throw t}else{if(16!=e.length){if(32==e.length)return _e(e);if(64==e.length){try{return _e(e.substr(0,32))+"/"+Be(e.substr(32))}catch(e){throw t}return}return e}try{return qe(e.substr(0,8))+"/"+Be(e.substr(8))}catch(e){throw t}}}function Be(e){var t,n=new Error("malformed mask");try{t=new S(e,16).toString(2)}catch(e){throw n}if(!t.match(/^1*0*$/))throw n;return t.replace(/0+$/,"").length}function je(e){var t=new Error("malformed IP address");if(!(e=e.toLowerCase(e)).match(/^[0-9a-f.:/]+$/))throw t;if(!e.match(/^[0-9.]+$/)){var n;if(e.match(/^[0-9.]+\/[0-9]+$/))return je((n=e.split("/"))[0])+ze(parseInt(n[1]),32);if(e.match(/^[0-9a-f:]+$/)&&-1!==e.indexOf(":"))return Le(e);if(e.match(/^[0-9a-f:]+\/[0-9]+$/)&&-1!==e.indexOf(":"))return Le((n=e.split("/"))[0])+ze(parseInt(n[1]),128);throw t}var r=e.split(".");if(4!==r.length)throw t;var i="";try{for(var s=0;s<4;s++)i+=("0"+parseInt(r[s]).toString(16)).slice(-2);return i}catch(e){throw t}}function ze(e,t){return 32==t&&0==e?"00000000":128==t&&0==e?"00000000000000000000000000000000":new S(Array(e+1).join("1")+Array(t-e+1).join("0"),2).toString(16)}function He(e){var t=e.match(/.{4}/g).map((function(e){var t=parseInt(e.substr(0,2),16),n=parseInt(e.substr(2),16);if(0==t&n<128)return String.fromCharCode(n);if(t<8){var r=128|63&n;return xe((192|(7&t)<<3|(192&n)>>6).toString(16)+r.toString(16))}r=128|(15&t)<<2|(192&n)>>6;var i=128|63&n;return xe((224|(240&t)>>4).toString(16)+r.toString(16)+i.toString(16))}));return t.join("")}function Ue(e){for(var t=encodeURIComponent(e),n="",r=0;r<t.length;r++)"%"==t[r]?(n+=t.substr(r,3),r+=2):n=n+"%"+me(t[r]);return n}function Ve(e){return!(e.length%2!=0||!e.match(/^[0-9a-f]+$/)&&!e.match(/^[0-9A-F]+$/))}function Ge(e){return!!e.match(/^[0-9A-Za-z-_.]+$/)}function We(e){return e.length%2==1?"0"+e:e.substr(0,1)>"7"?"00"+e:e}function Ke(e){var t=function(e){var t=e.toString(16);return 1==t.length&&(t="0"+t),t},n=function(e){var n="",r=parseInt(e,10).toString(2),i=7-r.length%7;7==i&&(i=0);for(var s="",o=0;o<i;o++)s+="0";for(r=s+r,o=0;o<r.length-1;o+=7){var a=r.substr(o,7);o!=r.length-7&&(a="1"+a),n+=t(parseInt(a,2))}return n};try{if(!e.match(/^[0-9.]+$/))return null;var r="",i=e.split("."),s=40*parseInt(i[0],10)+parseInt(i[1],10);r+=t(s),i.splice(0,2);for(var o=0;o<i.length;o++)r+=n(i[o]);return r}catch(e){return null}}function $e(e){if(!Ve(e))return null;try{var t=[],n=e.substr(0,2),r=parseInt(n,16);t[0]=new String(Math.floor(r/40)),t[1]=new String(r%40);for(var i=e.substr(2),s=[],o=0;o<i.length/2;o++)s.push(parseInt(i.substr(2*o,2),16));var a=[],c="";for(o=0;o<s.length;o++)128&s[o]?c+=Xe((127&s[o]).toString(2),7):(c+=Xe((127&s[o]).toString(2),7),a.push(new String(parseInt(c,2))),c="");var l=t.join(".");return a.length>0&&(l=l+"."+a.join(".")),l}catch(e){return null}}function Je(e){return Qe(new S(String(e),10))}function Qe(e){var t=e.toString(16);if("-"!=t.substr(0,1))return t.length%2==1?t="0"+t:t.match(/^[0-7]/)||(t="00"+t),t;var n=t.substr(1).length;n%2==1?n+=1:t.match(/^[0-7]/)||(n+=2);for(var r="",i=0;i<n;i++)r+="f";return new S(r,16).xor(e).add(S.ONE).toString(16).replace(/^-/,"")}de.getLblen=function(e,t){if("8"!=e.substr(t+2,1))return 1;var n=parseInt(e.substr(t+3,1));return 0==n?-1:0<n&&n<10?n+1:-2},de.getL=function(e,t){var n=de.getLblen(e,t);return n<1?"":e.substr(t+2,2*n)},de.getVblen=function(e,t){var n;return""==(n=de.getL(e,t))?-1:("8"===n.substr(0,1)?new S(n.substr(2),16):new S(n,16)).intValue()},de.getVidx=function(e,t){var n=de.getLblen(e,t);return n<0?n:t+2*(n+1)},de.getV=function(e,t){var n=de.getVidx(e,t),r=de.getVblen(e,t);return e.substr(n,2*r)},de.getTLV=function(e,t){return e.substr(t,2)+de.getL(e,t)+de.getV(e,t)},de.getTLVblen=function(e,t){return 2+2*de.getLblen(e,t)+2*de.getVblen(e,t)},de.getNextSiblingIdx=function(e,t){return de.getVidx(e,t)+2*de.getVblen(e,t)},de.getChildIdx=function(e,t){var n,r,i,s=de,o=[];n=s.getVidx(e,t),r=2*s.getVblen(e,t),"03"==e.substr(t,2)&&(n+=2,r-=2),i=0;for(var a=n;i<=r;){var c=s.getTLVblen(e,a);if((i+=c)<=r&&o.push(a),a+=c,i>=r)break}return o},de.getNthChildIdx=function(e,t,n){return de.getChildIdx(e,t)[n]},de.getIdxbyList=function(e,t,n,r){var i,s,o=de;return 0==n.length?void 0!==r&&e.substr(t,2)!==r?-1:t:(i=n.shift())>=(s=o.getChildIdx(e,t)).length?-1:o.getIdxbyList(e,s[i],n,r)},de.getIdxbyListEx=function(e,t,n,r){var i,s,o=de;if(0==n.length)return void 0!==r&&e.substr(t,2)!==r?-1:t;i=n.shift(),s=o.getChildIdx(e,t);for(var a=0,c=0;c<s.length;c++){var l=e.substr(s[c],2);if("number"==typeof i&&!o.isContextTag(l)&&a==i||"string"==typeof i&&o.isContextTag(l,i))return o.getIdxbyListEx(e,s[c],n,r);o.isContextTag(l)||a++}return-1},de.getTLVbyList=function(e,t,n,r){var i=de,s=i.getIdxbyList(e,t,n,r);return-1==s||s>=e.length?null:i.getTLV(e,s)},de.getTLVbyListEx=function(e,t,n,r){var i=de,s=i.getIdxbyListEx(e,t,n,r);return-1==s?null:i.getTLV(e,s)},de.getVbyList=function(e,t,n,r,i){var s,o,a=de;return-1==(s=a.getIdxbyList(e,t,n,r))||s>=e.length?null:(o=a.getV(e,s),!0===i&&(o=o.substr(2)),o)},de.getVbyListEx=function(e,t,n,r,i){var s,o,a=de;return-1==(s=a.getIdxbyListEx(e,t,n,r))?null:(o=a.getV(e,s),"03"==e.substr(s,2)&&!1!==i&&(o=o.substr(2)),o)},de.getInt=function(e,t,n){null==n&&(n=-1);try{var r=e.substr(t,2);if("02"!=r&&"03"!=r)return n;var i=de.getV(e,t);return"02"==r?parseInt(i,16):Ze(i)}catch(e){return n}},de.getOID=function(e,t,n){null==n&&(n=null);try{return"06"!=e.substr(t,2)?n:$e(de.getV(e,t))}catch(e){return n}},de.getOIDName=function(e,t,n){null==n&&(n=null);try{var r=de.getOID(e,t,n);if(r==n)return n;var i=le.asn1.x509.OID.oid2name(r);return""==i?r:i}catch(e){return n}},de.getString=function(e,t,n){null==n&&(n=null);try{return Ee(de.getV(e,t))}catch(e){return n}},de.hextooidstr=function(e){var t=function(e,t){return e.length>=t?e:new Array(t-e.length+1).join("0")+e},n=[],r=e.substr(0,2),i=parseInt(r,16);n[0]=new String(Math.floor(i/40)),n[1]=new String(i%40);for(var s=e.substr(2),o=[],a=0;a<s.length/2;a++)o.push(parseInt(s.substr(2*a,2),16));var c=[],l="";for(a=0;a<o.length;a++)128&o[a]?l+=t((127&o[a]).toString(2),7):(l+=t((127&o[a]).toString(2),7),c.push(new String(parseInt(l,2))),l="");var u=n.join(".");return c.length>0&&(u=u+"."+c.join(".")),u},de.dump=function(e,t,n,r){var i=de,s=i.getV,o=i.dump,a=i.getChildIdx,c=e;e instanceof le.asn1.ASN1Object&&(c=e.tohex());var l=function(e,t){return e.length<=2*t?e:e.substr(0,t)+"..(total "+e.length/2+"bytes).."+e.substr(e.length-t,t)};void 0===t&&(t={ommit_long_octet:32}),void 0===n&&(n=0),void 0===r&&(r="");var u,h=t.ommit_long_octet;if("01"==(u=c.substr(n,2)))return"00"==(d=s(c,n))?r+"BOOLEAN FALSE\n":r+"BOOLEAN TRUE\n";if("02"==u)return r+"INTEGER "+l(d=s(c,n),h)+"\n";if("03"==u){var d=s(c,n);return i.isASN1HEX(d.substr(2))?(w=r+"BITSTRING, encapsulates\n")+o(d.substr(2),t,0,r+"  "):r+"BITSTRING "+l(d,h)+"\n"}if("04"==u)return d=s(c,n),i.isASN1HEX(d)?(w=r+"OCTETSTRING, encapsulates\n")+o(d,t,0,r+"  "):r+"OCTETSTRING "+l(d,h)+"\n";if("05"==u)return r+"NULL\n";if("06"==u){var p=s(c,n),f=le.asn1.ASN1Util.oidHexToInt(p),g=le.asn1.x509.OID.oid2name(f),m=f.replace(/\./g," ");return""!=g?r+"ObjectIdentifier "+g+" ("+m+")\n":r+"ObjectIdentifier ("+m+")\n"}if("0a"==u)return r+"ENUMERATED "+parseInt(s(c,n))+"\n";if("0c"==u)return r+"UTF8String '"+xe(s(c,n))+"'\n";if("13"==u)return r+"PrintableString '"+xe(s(c,n))+"'\n";if("14"==u)return r+"TeletexString '"+xe(s(c,n))+"'\n";if("16"==u)return r+"IA5String '"+xe(s(c,n))+"'\n";if("17"==u)return r+"UTCTime "+xe(s(c,n))+"\n";if("18"==u)return r+"GeneralizedTime "+xe(s(c,n))+"\n";if("1a"==u)return r+"VisualString '"+xe(s(c,n))+"'\n";if("1e"==u)return r+"BMPString '"+He(s(c,n))+"'\n";if("30"==u){if("3000"==c.substr(n,4))return r+"SEQUENCE {}\n";w=r+"SEQUENCE\n";var y=t;if((2==(S=a(c,n)).length||3==S.length)&&"06"==c.substr(S[0],2)&&"04"==c.substr(S[S.length-1],2)){g=i.oidname(s(c,S[0]));var v=JSON.parse(JSON.stringify(t));v.x509ExtName=g,y=v}for(var b=0;b<S.length;b++)w+=o(c,y,S[b],r+"  ");return w}if("31"==u){w=r+"SET\n";var S=a(c,n);for(b=0;b<S.length;b++)w+=o(c,t,S[b],r+"  ");return w}if(0!=(128&(u=parseInt(u,16)))){var w,x=31&u;if(0!=(32&u)){for(w=r+"["+x+"]\n",S=a(c,n),b=0;b<S.length;b++)w+=o(c,t,S[b],r+"  ");return w}return d=s(c,n),de.isASN1HEX(d)?(w=r+"["+x+"]\n")+o(d,t,0,r+"  "):(("68747470"==d.substr(0,8)||"subjectAltName"===t.x509ExtName&&2==x)&&(d=xe(d)),r+"["+x+"] "+d+"\n")}return r+"UNKNOWN("+u+") "+s(c,n)+"\n"},de.parse=function(e){var t=de,n=t.parse,r=t.isASN1HEX,i=t.getV,s=t.getTLV,o=t.getChildIdx,a=le.asn1,c=a.ASN1Util.oidHexToInt,l=a.x509.OID.oid2name,u=xe,h=He,d=Ce,p={"0c":"utf8str",12:"numstr",13:"prnstr",14:"telstr",16:"ia5str",17:"utctime",18:"gentime","1a":"visstr","1e":"bmpstr",30:"seq",31:"set"},f=e.substr(0,2),g={},m=i(e,0);if("01"==f)return"0101ff"==e?{bool:!0}:{bool:!1};if("02"==f)return{int:{hex:m}};if("03"==f)try{if("00"!=m.substr(0,2))throw"not encap";var y=m.substr(2);if(!r(y))throw"not encap";return{bitstr:{obj:n(y)}}}catch(e){var v=null;return m.length<=10&&(v=et(m)),null==v?{bitstr:{hex:m}}:{bitstr:{bin:v}}}else if("04"==f)try{if(!r(m))throw"not encap";return{octstr:{obj:n(m)}}}catch(e){return{octstr:{hex:m}}}else{if("05"==f)return{null:""};if("06"==f){var b=c(m),S=l(b);return""==S?{oid:b}:{oid:S}}if("0a"==f)return m.length>4?{enum:{hex:m}}:{enum:parseInt(m,16)};if("30"==f||"31"==f)return g[p[f]]=function(e){for(var t=[],r=o(e,0),i=0;i<r.length;i++){var a=r[i],c=s(e,a),l=n(c);t.push(l)}return t}(e),g;if("14"==f){var w=d(m);return g[p[f]]={str:w},g}if("1e"==f)return w=h(m),g[p[f]]={str:w},g;if(-1!=":0c:12:13:16:17:18:1a:".indexOf(f))return w=u(m),g[p[f]]={str:w},g;if(f.match(/^8[0-9]$/))return null==(w=u(m))|""==w||null!=w.match(/[\x00-\x1F\x7F-\x9F]/)||null!=w.match(/[\u0000-\u001F\u0080\u009F]/)?{tag:{tag:f,explicit:!1,hex:m}}:{tag:{tag:f,explicit:!1,str:w}};if(!f.match(/^a[0-9]$/)){var x=new le.asn1.ASN1Object;return x.hV=m,{asn1:{tlv:f+x.getLengthHexFromValue()+m}}}try{if(!r(m))throw new Error("not encap");return{tag:{tag:f,explicit:!0,obj:n(m)}}}catch(e){return{tag:{tag:f,explicit:!0,hex:m}}}}},de.isContextTag=function(e,t){var n,r;e=e.toLowerCase();try{n=parseInt(e,16)}catch(e){return-1}if(void 0===t)return 128==(192&n);try{return null!=t.match(/^\[[0-9]+\]$/)&&!((r=parseInt(t.substr(1,t.length-1),10))>31)&&128==(192&n)&&(31&n)==r}catch(e){return!1}},de.isASN1HEX=function(e){var t=de;if(e.length%2==1)return!1;var n=t.getVblen(e,0),r=e.substr(0,2),i=t.getL(e,0);return e.length-r.length-i.length==2*n},de.checkStrictDER=function(e,t,n,r,i){var s=de;if(void 0===n){if("string"!=typeof e)throw new Error("not hex string");if(e=e.toLowerCase(),!le.lang.String.isHex(e))throw new Error("not hex string");n=e.length,i=(r=e.length/2)<128?1:Math.ceil(r.toString(16))+1}if(s.getL(e,t).length>2*i)throw new Error("L of TLV too long: idx="+t);var o=s.getVblen(e,t);if(o>r)throw new Error("value of L too long than hex: idx="+t);var a=s.getTLV(e,t),c=a.length-2-s.getL(e,t).length;if(c!==2*o)throw new Error("V string length and L's value not the same:"+c+"/"+2*o);if(0===t&&e.length!=a.length)throw new Error("total length and TLV length unmatch:"+e.length+"!="+a.length);var l=e.substr(t,2);if("02"===l){var u=s.getVidx(e,t);if("00"==e.substr(u,2)&&e.charCodeAt(u+2)<56)throw new Error("not least zeros for DER INTEGER")}if(32&parseInt(l,16)){for(var h=s.getVblen(e,t),d=0,p=s.getChildIdx(e,t),f=0;f<p.length;f++)d+=s.getTLV(e,p[f]).length,s.checkStrictDER(e,p[f],n,r,i);if(2*h!=d)throw new Error("sum of children's TLV length and L unmatch: "+2*h+"!="+d)}},de.oidname=function(e){var t=le.asn1;le.lang.String.isHex(e)&&(e=t.ASN1Util.oidHexToInt(e));var n=t.x509.OID.oid2name(e);return""===n&&(n=e),n},void 0!==le&&le||(le={}),void 0!==le.asn1&&le.asn1||(le.asn1={}),void 0!==le.asn1.x509&&le.asn1.x509||(le.asn1.x509={}),le.asn1.x509.Certificate=function(e){le.asn1.x509.Certificate.superclass.constructor.call(this);var t=le.asn1,n=t.DERBitString,r=t.DERSequence,i=t.x509,s=i.TBSCertificate,o=i.AlgorithmIdentifier;this.params=void 0,this.setByParam=function(e){this.params=e},this.sign=function(){var e=this.params,t=e.sigalg;null!=e.sigalg.name&&(t=e.sigalg.name);var n=e.tbsobj.tohex(),r=new le.crypto.Signature({alg:t});r.init(e.cakey),r.updateHex(n),e.sighex=r.sign()},this.getPEM=function(){return Oe(this.tohex(),"CERTIFICATE")},this.tohex=function(){var e=this.params;if(null!=e.tbsobj&&null!=e.tbsobj||(e.tbsobj=new s(e)),null==e.sighex&&null!=e.cakey&&this.sign(),null==e.sighex)throw new Error("sighex or cakey parameter not defined");var t=[];return t.push(e.tbsobj),t.push(new o({name:e.sigalg})),t.push(new n({hex:"00"+e.sighex})),new r({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&(this.params=e)},rt(le.asn1.x509.Certificate,le.asn1.ASN1Object),le.asn1.x509.TBSCertificate=function(e){le.asn1.x509.TBSCertificate.superclass.constructor.call(this);var t=le.asn1,n=t.x509,r=t.DERTaggedObject,i=t.DERInteger,s=t.DERSequence,o=n.AlgorithmIdentifier,a=n.Time,c=n.X500Name,l=n.Extensions,u=n.SubjectPublicKeyInfo;this.params=null,this.setByParam=function(e){this.params=e},this.tohex=function(){var e=[],t=this.params;if(null!=t.version||1!=t.version){var n=2;null!=t.version&&(n=t.version-1);var h=new r({obj:new i({int:n})});e.push(h)}return e.push(new i(t.serial)),e.push(new o({name:t.sigalg})),e.push(new c(t.issuer)),e.push(new s({array:[new a(t.notbefore),new a(t.notafter)]})),e.push(new c(t.subject)),e.push(new u(it.getKey(t.sbjpubkey))),void 0!==t.ext&&t.ext.length>0&&e.push(new r({tag:"a3",obj:new l(t.ext)})),new le.asn1.DERSequence({array:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},rt(le.asn1.x509.TBSCertificate,le.asn1.ASN1Object),le.asn1.x509.Extensions=function(e){le.asn1.x509.Extensions.superclass.constructor.call(this);var t=le.asn1,n=t.DERSequence,r=t.x509;this.aParam=[],this.setByParam=function(e){this.aParam=e},this.tohex=function(){for(var e=[],t=0;t<this.aParam.length;t++){var i=this.aParam[t],s=i.extname,o=null;if(null!=i.extn)o=new r.PrivateExtension(i);else if("subjectKeyIdentifier"==s)o=new r.SubjectKeyIdentifier(i);else if("keyUsage"==s)o=new r.KeyUsage(i);else if("subjectAltName"==s)o=new r.SubjectAltName(i);else if("issuerAltName"==s)o=new r.IssuerAltName(i);else if("basicConstraints"==s)o=new r.BasicConstraints(i);else if("nameConstraints"==s)o=new r.NameConstraints(i);else if("cRLDistributionPoints"==s)o=new r.CRLDistributionPoints(i);else if("certificatePolicies"==s)o=new r.CertificatePolicies(i);else if("policyMappings"==s)o=new r.PolicyMappings(i);else if("policyConstraints"==s)o=new r.PolicyConstraints(i);else if("inhibitAnyPolicy"==s)o=new r.InhibitAnyPolicy(i);else if("authorityKeyIdentifier"==s)o=new r.AuthorityKeyIdentifier(i);else if("extKeyUsage"==s)o=new r.ExtKeyUsage(i);else if("authorityInfoAccess"==s)o=new r.AuthorityInfoAccess(i);else if("cRLNumber"==s)o=new r.CRLNumber(i);else if("cRLReason"==s)o=new r.CRLReason(i);else if("ocspNonce"==s)o=new r.OCSPNonce(i);else if("ocspNoCheck"==s)o=new r.OCSPNoCheck(i);else if("adobeTimeStamp"==s)o=new r.AdobeTimeStamp(i);else{if("subjectDirectoryAttributes"!=s)throw new Error("extension not supported:"+JSON.stringify(i));o=new r.SubjectDirectoryAttributes(i)}null!=o&&e.push(o)}return new n({array:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},rt(le.asn1.x509.Extensions,le.asn1.ASN1Object),le.asn1.x509.Extension=function(e){le.asn1.x509.Extension.superclass.constructor.call(this);var t=le.asn1,n=t.DERObjectIdentifier,r=t.DEROctetString,i=(t.DERBitString,t.DERBoolean),s=t.DERSequence;this.tohex=function(){var e=new n({oid:this.oid}),t=new r({hex:this.getExtnValueHex()}),o=new Array;return o.push(e),this.critical&&o.push(new i),o.push(t),new s({array:o}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.critical=!1,void 0!==e&&void 0!==e.critical&&(this.critical=e.critical)},rt(le.asn1.x509.Extension,le.asn1.ASN1Object),le.asn1.x509.KeyUsage=function(e){le.asn1.x509.KeyUsage.superclass.constructor.call(this,e);var t=Error,n={digitalSignature:0,nonRepudiation:1,keyEncipherment:2,dataEncipherment:3,keyAgreement:4,keyCertSign:5,cRLSign:6,encipherOnly:7,decipherOnly:8};this.getExtnValueHex=function(){var e=this.getBinValue();return this.asn1ExtnValue=new le.asn1.DERBitString({bin:e}),this.asn1ExtnValue.tohex()},this.getBinValue=function(){var e=this.params;if("object"!=typeof e||"object"!=typeof e.names&&"string"!=typeof e.bin)throw new t("parameter not yet set");if(null!=e.names)return tt(e.names,n);if(null!=e.bin)return e.bin;throw new t("parameter not set properly")},this.oid="2.5.29.15",void 0!==e&&(this.params=e)},rt(le.asn1.x509.KeyUsage,le.asn1.x509.Extension),le.asn1.x509.BasicConstraints=function(e){le.asn1.x509.BasicConstraints.superclass.constructor.call(this,e);var t=le.asn1,n=t.DERBoolean,r=t.DERInteger,i=t.DERSequence;this.getExtnValueHex=function(){var e=new Array;this.cA&&e.push(new n),this.pathLen>-1&&e.push(new r({int:this.pathLen}));var t=new i({array:e});return this.asn1ExtnValue=t,this.asn1ExtnValue.tohex()},this.oid="2.5.29.19",this.cA=!1,this.pathLen=-1,void 0!==e&&(void 0!==e.cA&&(this.cA=e.cA),void 0!==e.pathLen&&(this.pathLen=e.pathLen))},rt(le.asn1.x509.BasicConstraints,le.asn1.x509.Extension),le.asn1.x509.CRLDistributionPoints=function(e){le.asn1.x509.CRLDistributionPoints.superclass.constructor.call(this,e);var t=le.asn1,n=t.x509;this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.setByDPArray=function(e){for(var r=[],i=0;i<e.length;i++)if(e[i]instanceof le.asn1.ASN1Object)r.push(e[i]);else{var s=new n.DistributionPoint(e[i]);r.push(s)}this.asn1ExtnValue=new t.DERSequence({array:r})},this.setByOneURI=function(e){var t=new n.DistributionPoint({fulluri:e});this.setByDPArray([t])},this.oid="2.5.29.31",void 0!==e&&(void 0!==e.array?this.setByDPArray(e.array):void 0!==e.uri&&this.setByOneURI(e.uri))},rt(le.asn1.x509.CRLDistributionPoints,le.asn1.x509.Extension),le.asn1.x509.DistributionPoint=function(e){le.asn1.x509.DistributionPoint.superclass.constructor.call(this);var t=le.asn1,n=t.x509.DistributionPointName;this.tohex=function(){var e=new t.DERSequence;if(null!=this.asn1DP){var n=new t.DERTaggedObject({explicit:!0,tag:"a0",obj:this.asn1DP});e.appendASN1Object(n)}return this.hTLV=e.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(void 0!==e.dpobj?this.asn1DP=e.dpobj:void 0!==e.dpname?this.asn1DP=new n(e.dpname):void 0!==e.fulluri&&(this.asn1DP=new n({full:[{uri:e.fulluri}]})))},rt(le.asn1.x509.DistributionPoint,le.asn1.ASN1Object),le.asn1.x509.DistributionPointName=function(e){le.asn1.x509.DistributionPointName.superclass.constructor.call(this);var t=le.asn1,n=t.DERTaggedObject;if(this.tohex=function(){if("full"!=this.type)throw new Error("currently type shall be 'full': "+this.type);return this.asn1Obj=new n({explicit:!1,tag:this.tag,obj:this.asn1V}),this.hTLV=this.asn1Obj.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e)if(t.x509.GeneralNames.prototype.isPrototypeOf(e))this.type="full",this.tag="a0",this.asn1V=e;else{if(void 0===e.full)throw new Error("This class supports GeneralNames only as argument");this.type="full",this.tag="a0",this.asn1V=new t.x509.GeneralNames(e.full)}},rt(le.asn1.x509.DistributionPointName,le.asn1.ASN1Object),le.asn1.x509.CertificatePolicies=function(e){le.asn1.x509.CertificatePolicies.superclass.constructor.call(this,e);var t=le.asn1,n=t.x509,r=t.DERSequence,i=n.PolicyInformation;this.params=null,this.getExtnValueHex=function(){for(var e=[],t=0;t<this.params.array.length;t++)e.push(new i(this.params.array[t]));var n=new r({array:e});return this.asn1ExtnValue=n,this.asn1ExtnValue.tohex()},this.oid="2.5.29.32",void 0!==e&&(this.params=e)},rt(le.asn1.x509.CertificatePolicies,le.asn1.x509.Extension),le.asn1.x509.PolicyInformation=function(e){le.asn1.x509.PolicyInformation.superclass.constructor.call(this,e);var t=le.asn1,n=t.DERSequence,r=t.DERObjectIdentifier,i=t.x509.PolicyQualifierInfo;this.params=null,this.tohex=function(){if(void 0===this.params.policyoid&&void 0===this.params.array)throw new Error("parameter oid and array missing");var e=[new r(this.params.policyoid)];if(void 0!==this.params.array){for(var t=[],s=0;s<this.params.array.length;s++)t.push(new i(this.params.array[s]));t.length>0&&e.push(new n({array:t}))}return new n({array:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(this.params=e)},rt(le.asn1.x509.PolicyInformation,le.asn1.ASN1Object),le.asn1.x509.PolicyQualifierInfo=function(e){le.asn1.x509.PolicyQualifierInfo.superclass.constructor.call(this,e);var t=le.asn1,n=t.DERSequence,r=t.DERIA5String,i=t.DERObjectIdentifier,s=t.x509.UserNotice;this.params=null,this.tohex=function(){return void 0!==this.params.cps?new n({array:[new i({oid:"1.3.6.1.5.5.7.2.1"}),new r({str:this.params.cps})]}).tohex():null!=this.params.unotice?new n({array:[new i({oid:"1.3.6.1.5.5.7.2.2"}),new s(this.params.unotice)]}).tohex():void 0},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(this.params=e)},rt(le.asn1.x509.PolicyQualifierInfo,le.asn1.ASN1Object),le.asn1.x509.UserNotice=function(e){le.asn1.x509.UserNotice.superclass.constructor.call(this,e);var t=le.asn1.DERSequence,n=(le.asn1.DERInteger,le.asn1.x509.DisplayText),r=le.asn1.x509.NoticeReference;this.params=null,this.tohex=function(){var e=[];return void 0!==this.params.noticeref&&e.push(new r(this.params.noticeref)),void 0!==this.params.exptext&&e.push(new n(this.params.exptext)),new t({array:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(this.params=e)},rt(le.asn1.x509.UserNotice,le.asn1.ASN1Object),le.asn1.x509.NoticeReference=function(e){le.asn1.x509.NoticeReference.superclass.constructor.call(this,e);var t=le.asn1.DERSequence,n=le.asn1.DERInteger,r=le.asn1.x509.DisplayText;this.params=null,this.tohex=function(){var e=[];if(void 0!==this.params.org&&e.push(new r(this.params.org)),void 0!==this.params.noticenum){for(var i=[],s=this.params.noticenum,o=0;o<s.length;o++)i.push(new n(s[o]));e.push(new t({array:i}))}if(0==e.length)throw new Error("parameter is empty");return new t({array:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(this.params=e)},rt(le.asn1.x509.NoticeReference,le.asn1.ASN1Object),le.asn1.x509.DisplayText=function(e){le.asn1.x509.DisplayText.superclass.constructor.call(this,e),this.hT="0c",void 0!==e&&("ia5"===e.type?this.hT="16":"vis"===e.type?this.hT="1a":"bmp"===e.type&&(this.hT="1e"))},rt(le.asn1.x509.DisplayText,le.asn1.DERAbstractString),le.asn1.x509.PolicyMappings=function(e){le.asn1.x509.PolicyMappings.superclass.constructor.call(this,e);var t=le.asn1,n=(t.x509,t.ASN1Util.newObject);this.params=null,this.getExtnValueHex=function(){for(var e=this.params,t=[],r=0;r<e.array.length;r++){var i=e.array[r];t.push({seq:[{oid:i[0]},{oid:i[1]}]})}return this.asn1ExtnValue=n({seq:t}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.33",void 0!==e&&(this.params=e)},rt(le.asn1.x509.PolicyMappings,le.asn1.x509.Extension),le.asn1.x509.PolicyConstraints=function(e){le.asn1.x509.PolicyConstraints.superclass.constructor.call(this,e);var t=le.asn1,n=(t.x509,t.ASN1Util.newObject);this.params=null,this.getExtnValueHex=function(){var e=this.params,t=[];return null!=e.reqexp&&t.push({tag:{tagi:"80",obj:{int:e.reqexp}}}),null!=e.inhibit&&t.push({tag:{tagi:"81",obj:{int:e.inhibit}}}),this.asn1ExtnValue=n({seq:t}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.36",void 0!==e&&(this.params=e)},rt(le.asn1.x509.PolicyConstraints,le.asn1.x509.Extension),le.asn1.x509.InhibitAnyPolicy=function(e){le.asn1.x509.InhibitAnyPolicy.superclass.constructor.call(this,e);var t=le.asn1,n=(t.x509,t.ASN1Util.newObject);this.params=null,this.getExtnValueHex=function(){return this.asn1ExtnValue=n({int:this.params.skip}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.54",void 0!==e&&(this.params=e)},rt(le.asn1.x509.InhibitAnyPolicy,le.asn1.x509.Extension),le.asn1.x509.NameConstraints=function(e){le.asn1.x509.NameConstraints.superclass.constructor.call(this,e);var t=le.asn1,n=t.x509,r=t.ASN1Util.newObject,i=n.GeneralSubtree;this.params=null,this.getExtnValueHex=function(){var e=this.params,t=[];if(null!=e.permit&&null!=e.permit.length){for(var n=[],s=0;s<e.permit.length;s++)n.push(new i(e.permit[s]));t.push({tag:{tagi:"a0",obj:{seq:n}}})}if(null!=e.exclude&&null!=e.exclude.length){var o=[];for(s=0;s<e.exclude.length;s++)o.push(new i(e.exclude[s]));t.push({tag:{tagi:"a1",obj:{seq:o}}})}return this.asn1ExtnValue=r({seq:t}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.30",void 0!==e&&(this.params=e)},rt(le.asn1.x509.NameConstraints,le.asn1.x509.Extension),le.asn1.x509.GeneralSubtree=function(e){le.asn1.x509.GeneralSubtree.superclass.constructor.call(this);var t=le.asn1,n=t.x509.GeneralName,r=t.ASN1Util.newObject;this.params=null,this.setByParam=function(e){this.params=e},this.tohex=function(){var e=this.params,t=[new n(e)];return null!=e.min&&t.push({tag:{tagi:"80",obj:{int:e.min}}}),null!=e.max&&t.push({tag:{tagi:"81",obj:{int:e.max}}}),r({seq:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},rt(le.asn1.x509.GeneralSubtree,le.asn1.ASN1Object),le.asn1.x509.ExtKeyUsage=function(e){le.asn1.x509.ExtKeyUsage.superclass.constructor.call(this,e);var t=le.asn1;this.setPurposeArray=function(e){this.asn1ExtnValue=new t.DERSequence;for(var n=0;n<e.length;n++){var r=new t.DERObjectIdentifier(e[n]);this.asn1ExtnValue.appendASN1Object(r)}},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.37",void 0!==e&&void 0!==e.array&&this.setPurposeArray(e.array)},rt(le.asn1.x509.ExtKeyUsage,le.asn1.x509.Extension),le.asn1.x509.AuthorityKeyIdentifier=function(e){le.asn1.x509.AuthorityKeyIdentifier.superclass.constructor.call(this,e);var t=le,n=t.asn1,r=n.DERTaggedObject,i=n.x509.GeneralNames;t.crypto.Util.isKey,this.asn1KID=null,this.asn1CertIssuer=null,this.asn1CertSN=null,this.getExtnValueHex=function(){var e=new Array;this.asn1KID&&e.push(new r({explicit:!1,tag:"80",obj:this.asn1KID})),this.asn1CertIssuer&&e.push(new r({explicit:!1,tag:"a1",obj:new i([{dn:this.asn1CertIssuer}])})),this.asn1CertSN&&e.push(new r({explicit:!1,tag:"82",obj:this.asn1CertSN}));var t=new n.DERSequence({array:e});return this.asn1ExtnValue=t,this.asn1ExtnValue.tohex()},this.setKIDByParam=function(e){if(void 0!==e.str||void 0!==e.hex)this.asn1KID=new le.asn1.DEROctetString(e);else if("object"==typeof e&&le.crypto.Util.isKey(e)||"string"==typeof e&&-1!=e.indexOf("BEGIN ")){var t=e;"string"==typeof e&&(t=it.getKey(e));var n=it.getKeyID(t);this.asn1KID=new le.asn1.DEROctetString({hex:n})}},this.setCertIssuerByParam=function(e){void 0!==e.str||void 0!==e.ldapstr||void 0!==e.hex||void 0!==e.certsubject||void 0!==e.certissuer?this.asn1CertIssuer=new le.asn1.x509.X500Name(e):"string"==typeof e&&-1!=e.indexOf("BEGIN ")&&-1!=e.indexOf("CERTIFICATE")&&(this.asn1CertIssuer=new le.asn1.x509.X500Name({certissuer:e}))},this.setCertSNByParam=function(e){if(void 0!==e.str||void 0!==e.bigint||void 0!==e.hex)this.asn1CertSN=new le.asn1.DERInteger(e);else if("string"==typeof e&&-1!=e.indexOf("BEGIN ")&&e.indexOf("CERTIFICATE")){var t=new ct;t.readCertPEM(e);var n=t.getSerialNumberHex();this.asn1CertSN=new le.asn1.DERInteger({hex:n})}},this.oid="2.5.29.35",void 0!==e&&(void 0!==e.kid&&this.setKIDByParam(e.kid),void 0!==e.issuer&&this.setCertIssuerByParam(e.issuer),void 0!==e.sn&&this.setCertSNByParam(e.sn),void 0!==e.issuersn&&"string"==typeof e.issuersn&&-1!=e.issuersn.indexOf("BEGIN ")&&e.issuersn.indexOf("CERTIFICATE")&&(this.setCertSNByParam(e.issuersn),this.setCertIssuerByParam(e.issuersn)))},rt(le.asn1.x509.AuthorityKeyIdentifier,le.asn1.x509.Extension),le.asn1.x509.SubjectKeyIdentifier=function(e){le.asn1.x509.SubjectKeyIdentifier.superclass.constructor.call(this,e);var t=le.asn1.DEROctetString;this.asn1KID=null,this.getExtnValueHex=function(){return this.asn1ExtnValue=this.asn1KID,this.asn1ExtnValue.tohex()},this.setKIDByParam=function(e){if(void 0!==e.str||void 0!==e.hex)this.asn1KID=new t(e);else if("object"==typeof e&&le.crypto.Util.isKey(e)||"string"==typeof e&&-1!=e.indexOf("BEGIN")){var n=e;"string"==typeof e&&(n=it.getKey(e));var r=it.getKeyID(n);this.asn1KID=new le.asn1.DEROctetString({hex:r})}},this.oid="2.5.29.14",void 0!==e&&void 0!==e.kid&&this.setKIDByParam(e.kid)},rt(le.asn1.x509.SubjectKeyIdentifier,le.asn1.x509.Extension),le.asn1.x509.AuthorityInfoAccess=function(e){le.asn1.x509.AuthorityInfoAccess.superclass.constructor.call(this,e),this.setAccessDescriptionArray=function(e){for(var t=new Array,n=le.asn1,r=n.DERSequence,i=n.DERObjectIdentifier,s=n.x509.GeneralName,o=0;o<e.length;o++){var a,c=e[o];if(void 0!==c.ocsp)a=new r({array:[new i({oid:"1.3.6.1.5.5.7.48.1"}),new s({uri:c.ocsp})]});else{if(void 0===c.caissuer)throw new Error("unknown AccessMethod parameter: "+JSON.stringify(c));a=new r({array:[new i({oid:"1.3.6.1.5.5.7.48.2"}),new s({uri:c.caissuer})]})}t.push(a)}this.asn1ExtnValue=new r({array:t})},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.1.1",void 0!==e&&void 0!==e.array&&this.setAccessDescriptionArray(e.array)},rt(le.asn1.x509.AuthorityInfoAccess,le.asn1.x509.Extension),le.asn1.x509.SubjectAltName=function(e){le.asn1.x509.SubjectAltName.superclass.constructor.call(this,e),this.setNameArray=function(e){this.asn1ExtnValue=new le.asn1.x509.GeneralNames(e)},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.17",void 0!==e&&void 0!==e.array&&this.setNameArray(e.array)},rt(le.asn1.x509.SubjectAltName,le.asn1.x509.Extension),le.asn1.x509.IssuerAltName=function(e){le.asn1.x509.IssuerAltName.superclass.constructor.call(this,e),this.setNameArray=function(e){this.asn1ExtnValue=new le.asn1.x509.GeneralNames(e)},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.18",void 0!==e&&void 0!==e.array&&this.setNameArray(e.array)},rt(le.asn1.x509.IssuerAltName,le.asn1.x509.Extension),le.asn1.x509.SubjectDirectoryAttributes=function(e){le.asn1.x509.SubjectDirectoryAttributes.superclass.constructor.call(this,e);var t=le.asn1,n=t.DERSequence,r=t.ASN1Util.newObject,i=t.x509.OID.name2oid;this.params=null,this.getExtnValueHex=function(){for(var e=[],t=0;t<this.params.array.length;t++){var s=this.params.array[t];if(null==s.attr||null==s.array){var o={seq:[{oid:"1.2.3.4"},{set:[{utf8str:"DE"}]}]};if("dateOfBirth"==s.attr)o.seq[0].oid=i(s.attr),o.seq[1].set[0]={gentime:s.str};else if("placeOfBirth"==s.attr)o.seq[0].oid=i(s.attr),o.seq[1].set[0]={utf8str:s.str};else if("gender"==s.attr)o.seq[0].oid=i(s.attr),o.seq[1].set[0]={prnstr:s.str};else if("countryOfCitizenship"==s.attr)o.seq[0].oid=i(s.attr),o.seq[1].set[0]={prnstr:s.str};else{if("countryOfResidence"!=s.attr)throw new Error("unsupported attribute: "+s.attr);o.seq[0].oid=i(s.attr),o.seq[1].set[0]={prnstr:s.str}}e.push(new r(o))}else{var a={seq:[{oid:s.attr},{set:s.array}]};e.push(r(a))}}var c=new n({array:e});return this.asn1ExtnValue=c,this.asn1ExtnValue.tohex()},this.oid="2.5.29.9",void 0!==e&&(this.params=e)},rt(le.asn1.x509.SubjectDirectoryAttributes,le.asn1.x509.Extension),le.asn1.x509.PrivateExtension=function(e){le.asn1.x509.PrivateExtension.superclass.constructor.call(this,e);var t=le,n=t.lang.String.isHex,r=t.asn1,i=r.x509.OID.name2oid,s=r.ASN1Util.newObject;this.params=null,this.setByParam=function(e){this.oid=i(e.extname),this.params=e},this.getExtnValueHex=function(){if(null==this.params.extname||null==this.params.extn)throw new Error("extname or extnhex not specified");var e=this.params.extn;if("string"==typeof e&&n(e))return e;if("object"==typeof e)try{return s(e).tohex()}catch(e){}throw new Error("unsupported extn value")},null!=e&&this.setByParam(e)},rt(le.asn1.x509.PrivateExtension,le.asn1.x509.Extension),le.asn1.x509.CRL=function(e){le.asn1.x509.CRL.superclass.constructor.call(this);var t=le.asn1,n=t.DERSequence,r=t.DERBitString,i=t.x509,s=i.AlgorithmIdentifier,o=i.TBSCertList;this.params=void 0,this.setByParam=function(e){this.params=e},this.sign=function(){var e=new o(this.params).tohex(),t=new le.crypto.Signature({alg:this.params.sigalg});t.init(this.params.cakey),t.updateHex(e);var n=t.sign();this.params.sighex=n},this.getPEM=function(){return Oe(this.tohex(),"X509 CRL")},this.tohex=function(){var e=this.params;if(null==e.tbsobj&&(e.tbsobj=new o(e)),null==e.sighex&&null!=e.cakey&&this.sign(),null==e.sighex)throw new Error("sighex or cakey parameter not defined");var t=[];return t.push(e.tbsobj),t.push(new s({name:e.sigalg})),t.push(new r({hex:"00"+e.sighex})),new n({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&(this.params=e)},rt(le.asn1.x509.CRL,le.asn1.ASN1Object),le.asn1.x509.TBSCertList=function(e){le.asn1.x509.TBSCertList.superclass.constructor.call(this);var t=le.asn1,n=t.DERInteger,r=t.DERSequence,i=t.DERTaggedObject,s=(t.DERObjectIdentifier,t.x509),o=s.AlgorithmIdentifier,a=s.Time,c=s.Extensions,l=s.X500Name;this.params=null,this.setByParam=function(e){this.params=e},this.getRevCertSequence=function(){for(var e=[],t=this.params.revcert,i=0;i<t.length;i++){var s=[new n(t[i].sn),new a(t[i].date)];null!=t[i].ext&&s.push(new c(t[i].ext)),e.push(new r({array:s}))}return new r({array:e})},this.tohex=function(){var e=[],t=this.params;if(null!=t.version){var s=t.version-1,u=new n({int:s});e.push(u)}if(e.push(new o({name:t.sigalg})),e.push(new l(t.issuer)),e.push(new a(t.thisupdate)),null!=t.nextupdate&&e.push(new a(t.nextupdate)),null!=t.revcert&&e.push(this.getRevCertSequence()),null!=t.ext){var h=new c(t.ext);e.push(new i({tag:"a0",explicit:!0,obj:h}))}return new r({array:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},rt(le.asn1.x509.TBSCertList,le.asn1.ASN1Object),le.asn1.x509.CRLEntry=function(e){le.asn1.x509.CRLEntry.superclass.constructor.call(this);var t=le.asn1;this.setCertSerial=function(e){this.sn=new t.DERInteger(e)},this.setRevocationDate=function(e){this.time=new t.x509.Time(e)},this.tohex=function(){var e=new t.DERSequence({array:[this.sn,this.time]});return this.TLV=e.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(void 0!==e.time&&this.setRevocationDate(e.time),void 0!==e.sn&&this.setCertSerial(e.sn))},rt(le.asn1.x509.CRLEntry,le.asn1.ASN1Object),le.asn1.x509.CRLNumber=function(e){le.asn1.x509.CRLNumber.superclass.constructor.call(this,e),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new le.asn1.DERInteger(this.params.num),this.asn1ExtnValue.tohex()},this.oid="2.5.29.20",null!=e&&(this.params=e)},rt(le.asn1.x509.CRLNumber,le.asn1.x509.Extension),le.asn1.x509.CRLReason=function(e){le.asn1.x509.CRLReason.superclass.constructor.call(this,e),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new le.asn1.DEREnumerated(this.params.code),this.asn1ExtnValue.tohex()},this.oid="2.5.29.21",null!=e&&(this.params=e)},rt(le.asn1.x509.CRLReason,le.asn1.x509.Extension),le.asn1.x509.OCSPNonce=function(e){le.asn1.x509.OCSPNonce.superclass.constructor.call(this,e),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new le.asn1.DEROctetString(this.params),this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.48.1.2",null!=e&&(this.params=e)},rt(le.asn1.x509.OCSPNonce,le.asn1.x509.Extension),le.asn1.x509.OCSPNoCheck=function(e){le.asn1.x509.OCSPNoCheck.superclass.constructor.call(this,e),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new le.asn1.DERNull,this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.48.1.5",null!=e&&(this.params=e)},rt(le.asn1.x509.OCSPNoCheck,le.asn1.x509.Extension),le.asn1.x509.AdobeTimeStamp=function(e){le.asn1.x509.AdobeTimeStamp.superclass.constructor.call(this,e);var t=le.asn1,n=t.DERInteger,r=t.DERBoolean,i=t.DERSequence,s=t.x509.GeneralName;this.params=null,this.getExtnValueHex=function(){var e=this.params,t=[new n(1)];return t.push(new s({uri:e.uri})),null!=e.reqauth&&t.push(new r(e.reqauth)),this.asn1ExtnValue=new i({array:t}),this.asn1ExtnValue.tohex()},this.oid="1.2.840.113583.1.1.9.1",void 0!==e&&this.setByParam(e)},rt(le.asn1.x509.AdobeTimeStamp,le.asn1.x509.Extension),le.asn1.x509.X500Name=function(e){le.asn1.x509.X500Name.superclass.constructor.call(this),this.asn1Array=[],this.paramArray=[],this.sRule="utf8";var t=le.asn1,n=t.x509,r=n.RDN;this.setByString=function(e,t){void 0!==t&&(this.sRule=t);var n=e.split("/");n.shift();for(var i=[],s=0;s<n.length;s++)if(n[s].match(/^[^=]+=.+$/))i.push(n[s]);else{var o=i.length-1;i[o]=i[o]+"/"+n[s]}for(s=0;s<i.length;s++)this.asn1Array.push(new r({str:i[s],rule:this.sRule}))},this.setByLdapString=function(e,t){void 0!==t&&(this.sRule=t);var r=n.X500Name.ldapToCompat(e);this.setByString(r,t)},this.setByObject=function(e,t){for(var n in void 0!==t&&(this.sRule=t),e)if(e.hasOwnProperty(n)){var i=new r({str:n+"="+e[n],rule:this.sRule});this.asn1Array?this.asn1Array.push(i):this.asn1Array=[i]}},this.setByParam=function(e){var t;void 0!==e.rule&&(this.sRule=e.rule),void 0!==e.array?this.paramArray=e.array:void 0!==e.str?this.setByString(e.str):void 0!==e.ldapstr?this.setByLdapString(e.ldapstr):void 0!==e.hex?this.hTLV=e.hex:void 0!==e.certissuer?((t=new ct).readCertPEM(e.certissuer),this.hTLV=t.getIssuerHex()):void 0!==e.certsubject?((t=new ct).readCertPEM(e.certsubject),this.hTLV=t.getSubjectHex()):"object"==typeof e&&void 0===e.certsubject&&void 0===e.certissuer&&this.setByObject(e)},this.tohex=function(){if("string"==typeof this.hTLV)return this.hTLV;if(0==this.asn1Array.length&&this.paramArray.length>0)for(var e=0;e<this.paramArray.length;e++){var n={array:this.paramArray[e]};"utf8"!=this.sRule&&(n.rule=this.sRule);var i=new r(n);this.asn1Array.push(i)}var s=new t.DERSequence({array:this.asn1Array});return this.hTLV=s.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},rt(le.asn1.x509.X500Name,le.asn1.ASN1Object),le.asn1.x509.X500Name.compatToLDAP=function(e){if("/"!==e.substr(0,1))throw"malformed input";var t=(e=e.substr(1)).split("/");return t.reverse(),t=t.map((function(e){return e.replace(/,/,"\\,")})),t.join(",")},le.asn1.x509.X500Name.onelineToLDAP=function(e){return le.asn1.x509.X500Name.compatToLDAP(e)},le.asn1.x509.X500Name.ldapToCompat=function(e){for(var t=e.split(","),n=!1,r=[],i=0;t.length>0;i++){var s=t.shift();if(!0===n){var o=(r.pop()+","+s).replace(/\\,/g,",");r.push(o),n=!1}else r.push(s);"\\"===s.substr(-1,1)&&(n=!0)}return r=r.map((function(e){return e.replace("/","\\/")})),r.reverse(),"/"+r.join("/")},le.asn1.x509.X500Name.ldapToOneline=function(e){return le.asn1.x509.X500Name.ldapToCompat(e)},le.asn1.x509.RDN=function(e){le.asn1.x509.RDN.superclass.constructor.call(this),this.asn1Array=[],this.paramArray=[],this.sRule="utf8";var t=le.asn1.x509.AttributeTypeAndValue;this.setByParam=function(e){void 0!==e.rule&&(this.sRule=e.rule),void 0!==e.str&&this.addByMultiValuedString(e.str),void 0!==e.array&&(this.paramArray=e.array)},this.addByString=function(e){this.asn1Array.push(new le.asn1.x509.AttributeTypeAndValue({str:e,rule:this.sRule}))},this.addByMultiValuedString=function(e){for(var t=le.asn1.x509.RDN.parseString(e),n=0;n<t.length;n++)this.addByString(t[n])},this.tohex=function(){if(0==this.asn1Array.length&&this.paramArray.length>0)for(var e=0;e<this.paramArray.length;e++){var n=this.paramArray[e];void 0!==n.rule&&"utf8"!=this.sRule&&(n.rule=this.sRule);var r=new t(n);this.asn1Array.push(r)}var i=new le.asn1.DERSet({array:this.asn1Array});return this.TLV=i.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},rt(le.asn1.x509.RDN,le.asn1.ASN1Object),le.asn1.x509.RDN.parseString=function(e){for(var t=e.split(/\+/),n=!1,r=[],i=0;t.length>0;i++){var s=t.shift();if(!0===n){var o=(r.pop()+"+"+s).replace(/\\\+/g,"+");r.push(o),n=!1}else r.push(s);"\\"===s.substr(-1,1)&&(n=!0)}var a=!1,c=[];for(i=0;r.length>0;i++){if(s=r.shift(),!0===a){var l=c.pop();s.match(/"$/)?(o=(l+"+"+s).replace(/^([^=]+)="(.*)"$/,"$1=$2"),c.push(o),a=!1):c.push(l+"+"+s)}else c.push(s);s.match(/^[^=]+="/)&&(a=!0)}return c},le.asn1.x509.AttributeTypeAndValue=function(e){le.asn1.x509.AttributeTypeAndValue.superclass.constructor.call(this),this.sRule="utf8",this.sType=null,this.sValue=null,this.dsType=null;var t=le,n=t.asn1,r=n.DERSequence,i=n.DERUTF8String,s=n.DERPrintableString,o=n.DERTeletexString,a=n.DERIA5String,c=n.DERVisibleString,l=n.DERBMPString,u=t.lang.String.isMail,h=t.lang.String.isPrintable;this.setByParam=function(e){if(void 0!==e.rule&&(this.sRule=e.rule),void 0!==e.ds&&(this.dsType=e.ds),void 0===e.value&&void 0!==e.str){var t=e.str.match(/^([^=]+)=(.+)$/);if(!t)throw new Error("malformed attrTypeAndValueStr: "+attrTypeAndValueStr);this.sType=t[1],this.sValue=t[2]}else this.sType=e.type,this.sValue=e.value},this.setByString=function(e,t){void 0!==t&&(this.sRule=t);var n=e.match(/^([^=]+)=(.+)$/);if(!n)throw new Error("malformed attrTypeAndValueStr: "+attrTypeAndValueStr);this.setByAttrTypeAndValueStr(n[1],n[2])},this._getDsType=function(){var e=this.sType,t=this.sValue,n=this.sRule;return"prn"===n?"CN"==e&&u(t)?"ia5":h(t)?"prn":"utf8":"utf8"===n?"CN"==e&&u(t)?"ia5":"C"==e?"prn":"utf8":"utf8"},this.setByAttrTypeAndValueStr=function(e,t,n){void 0!==n&&(this.sRule=n),this.sType=e,this.sValue=t},this.getValueObj=function(e,t){if("utf8"==e)return new i({str:t});if("prn"==e)return new s({str:t});if("tel"==e)return new o({str:t});if("ia5"==e)return new a({str:t});if("vis"==e)return new c({str:t});if("bmp"==e)return new l({str:t});throw new Error("unsupported directory string type: type="+e+" value="+t)},this.tohex=function(){null==this.dsType&&(this.dsType=this._getDsType());var e=le.asn1.x509.OID.atype2obj(this.sType),t=this.getValueObj(this.dsType,this.sValue),n=new r({array:[e,t]});return this.TLV=n.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},rt(le.asn1.x509.AttributeTypeAndValue,le.asn1.ASN1Object),le.asn1.x509.SubjectPublicKeyInfo=function(e){le.asn1.x509.SubjectPublicKeyInfo.superclass.constructor.call(this);var t=le,n=t.asn1,r=n.DERInteger,i=n.DERBitString,s=n.DERObjectIdentifier,o=n.DERSequence,a=n.ASN1Util.newObject,c=n.x509.AlgorithmIdentifier,l=t.crypto;l.ECDSA,l.DSA,this.getASN1Object=function(){if(null==this.asn1AlgId||null==this.asn1SubjPKey)throw"algId and/or subjPubKey not set";return new o({array:[this.asn1AlgId,this.asn1SubjPKey]})},this.tohex=function(){var e=this.getASN1Object();return this.hTLV=e.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},this.setPubKey=function(e){try{if(e instanceof re){var t=a({seq:[{int:{bigint:e.n}},{int:{int:e.e}}]}).tohex();this.asn1AlgId=new c({name:"rsaEncryption"}),this.asn1SubjPKey=new i({hex:"00"+t})}}catch(e){}try{if(e instanceof le.crypto.ECDSA){var n=new s({name:e.curveName});this.asn1AlgId=new c({name:"ecPublicKey",asn1params:n}),this.asn1SubjPKey=new i({hex:"00"+e.pubKeyHex})}}catch(e){}try{if(e instanceof le.crypto.DSA){n=new a({seq:[{int:{bigint:e.p}},{int:{bigint:e.q}},{int:{bigint:e.g}}]}),this.asn1AlgId=new c({name:"dsa",asn1params:n});var o=new r({bigint:e.y});this.asn1SubjPKey=new i({hex:"00"+o.tohex()})}}catch(e){}},void 0!==e&&this.setPubKey(e)},rt(le.asn1.x509.SubjectPublicKeyInfo,le.asn1.ASN1Object),le.asn1.x509.Time=function(e){le.asn1.x509.Time.superclass.constructor.call(this);var t=le.asn1,n=t.DERUTCTime,r=t.DERGeneralizedTime;this.params=null,this.type=null,this.setTimeParams=function(e){this.timeParams=e},this.setByParam=function(e){this.params=e},this.getType=function(e){return e.match(/^[0-9]{12}Z$/)?"utc":e.match(/^[0-9]{14}Z$/)?"gen":e.match(/^[0-9]{12}\.[0-9]+Z$/)?"utc":e.match(/^[0-9]{14}\.[0-9]+Z$/)?"gen":null},this.tohex=function(){var e=this.params,t=null;if("string"==typeof e&&(e={str:e}),null==e||!e.str||null!=e.type&&null!=e.type||(e.type=this.getType(e.str)),null!=e&&e.str?("utc"==e.type&&(t=new n(e.str)),"gen"==e.type&&(t=new r(e.str))):t="gen"==this.type?new r:new n,null==t)throw new Error("wrong setting for Time");return this.TLV=t.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},le.asn1.x509.Time_bak=function(e){le.asn1.x509.Time_bak.superclass.constructor.call(this);var t=le.asn1,n=t.DERUTCTime,r=t.DERGeneralizedTime;this.setTimeParams=function(e){this.timeParams=e},this.tohex=function(){var e=null;return e=null!=this.timeParams?"utc"==this.type?new n(this.timeParams):new r(this.timeParams):"utc"==this.type?new n:new r,this.TLV=e.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},this.type="utc",void 0!==e&&(void 0!==e.type?this.type=e.type:void 0!==e.str&&(e.str.match(/^[0-9]{12}Z$/)&&(this.type="utc"),e.str.match(/^[0-9]{14}Z$/)&&(this.type="gen")),this.timeParams=e)},rt(le.asn1.x509.Time,le.asn1.ASN1Object),le.asn1.x509.AlgorithmIdentifier=function(e){le.asn1.x509.AlgorithmIdentifier.superclass.constructor.call(this),this.nameAlg=null,this.asn1Alg=null,this.asn1Params=null,this.paramEmpty=!1;var t=le.asn1,n=t.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV;if(this.tohex=function(){if(null===this.nameAlg&&null===this.asn1Alg)throw new Error("algorithm not specified");if(null!==this.nameAlg){var e=null;for(var r in n)r===this.nameAlg&&(e=n[r]);if(null!==e)return this.hTLV=e,this.hTLV}null!==this.nameAlg&&null===this.asn1Alg&&(this.asn1Alg=t.x509.OID.name2obj(this.nameAlg));var i=[this.asn1Alg];null!==this.asn1Params&&i.push(this.asn1Params);var s=new t.DERSequence({array:i});return this.hTLV=s.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(void 0!==e.name&&(this.nameAlg=e.name),void 0!==e.asn1params&&(this.asn1Params=e.asn1params),void 0!==e.paramempty&&(this.paramEmpty=e.paramempty)),null===this.asn1Params&&!1===this.paramEmpty&&null!==this.nameAlg){void 0!==this.nameAlg.name&&(this.nameAlg=this.nameAlg.name);var r=this.nameAlg.toLowerCase();"withdsa"!==r.substr(-7,7)&&"withecdsa"!==r.substr(-9,9)&&(this.asn1Params=new t.DERNull)}},rt(le.asn1.x509.AlgorithmIdentifier,le.asn1.ASN1Object),le.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV={SHAwithRSAandMGF1:"300d06092a864886f70d01010a3000",SHA256withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040201a11a301806092a864886f70d010108300b0609608648016503040201a203020120",SHA384withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040202a11a301806092a864886f70d010108300b0609608648016503040202a203020130",SHA512withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040203a11a301806092a864886f70d010108300b0609608648016503040203a203020140"},le.asn1.x509.GeneralName=function(e){le.asn1.x509.GeneralName.superclass.constructor.call(this);var t=le.asn1,n=t.x509,r=n.X500Name,i=n.OtherName,s=t.DERIA5String,o=(t.DERPrintableString,t.DEROctetString),a=t.DERTaggedObject,c=t.ASN1Object,l=Error;this.params=null,this.setByParam=function(e){this.params=e},this.tohex=function(){var e,t,n=this.params,u=!1;if(void 0!==n.other)e="a0",t=new i(n.other);else if(void 0!==n.rfc822)e="81",t=new s({str:n.rfc822});else if(void 0!==n.dns)e="82",t=new s({str:n.dns});else if(void 0!==n.dn)e="a4",u=!0,t="string"==typeof n.dn?new r({str:n.dn}):n.dn instanceof le.asn1.x509.X500Name?n.dn:new r(n.dn);else if(void 0!==n.ldapdn)e="a4",u=!0,t=new r({ldapstr:n.ldapdn});else if(void 0!==n.certissuer||void 0!==n.certsubj){var h,d;e="a4",u=!0;var p=null;if(void 0!==n.certsubj?(h=!1,d=n.certsubj):(h=!0,d=n.certissuer),d.match(/^[0-9A-Fa-f]+$/),-1!=d.indexOf("-----BEGIN ")&&(p=Pe(d)),null==p)throw new Error("certsubj/certissuer not cert");var f,g=new ct;g.hex=p,f=h?g.getIssuerHex():g.getSubjectHex(),(t=new c).hTLV=f}else if(void 0!==n.uri)e="86",t=new s({str:n.uri});else{if(void 0===n.ip)throw new l("improper params");var m;e="87";var y=n.ip;try{if(y.match(/^[0-9a-f]+$/)){var v=y.length;if(8!=v&&16!=v&&32!=v&&64!=v)throw"err";m=y}else m=je(y)}catch(e){throw new l("malformed IP address: "+n.ip+":"+e.message)}t=new o({hex:m})}return new a({tag:e,explicit:u,obj:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},rt(le.asn1.x509.GeneralName,le.asn1.ASN1Object),le.asn1.x509.GeneralNames=function(e){le.asn1.x509.GeneralNames.superclass.constructor.call(this);var t=le.asn1;this.setByParamArray=function(e){for(var n=0;n<e.length;n++){var r=new t.x509.GeneralName(e[n]);this.asn1Array.push(r)}},this.tohex=function(){return new t.DERSequence({array:this.asn1Array}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.asn1Array=new Array,void 0!==e&&this.setByParamArray(e)},rt(le.asn1.x509.GeneralNames,le.asn1.ASN1Object),le.asn1.x509.OtherName=function(e){le.asn1.x509.OtherName.superclass.constructor.call(this);var t=le.asn1,n=t.DERObjectIdentifier,r=t.DERSequence,i=t.ASN1Util.newObject;this.params=null,this.setByParam=function(e){this.params=e},this.tohex=function(){var e=this.params;if(null==e.oid||null==e.value)throw new Error("oid or value not specified");var t=new n({oid:e.oid}),s=i({tag:{tag:"a0",explicit:!0,obj:e.value}});return new r({array:[t,s]}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},rt(le.asn1.x509.OtherName,le.asn1.ASN1Object),le.asn1.x509.OID=new function(){var e=le.asn1.DERObjectIdentifier;this.name2oidList={"aes128-CBC":"2.16.840.1.101.3.4.1.2","aes256-CBC":"2.16.840.1.101.3.4.1.42",sha1:"1.3.14.3.2.26",sha256:"2.16.840.1.101.3.4.2.1",sha384:"2.16.840.1.101.3.4.2.2",sha512:"2.16.840.1.101.3.4.2.3",sha224:"2.16.840.1.101.3.4.2.4",md5:"1.2.840.113549.2.5",md2:"1.3.14.7.2.2.1",ripemd160:"1.3.36.3.2.1",hmacWithSHA1:"1.2.840.113549.2.7",hmacWithSHA224:"1.2.840.113549.2.8",hmacWithSHA256:"1.2.840.113549.2.9",hmacWithSHA384:"1.2.840.113549.2.10",hmacWithSHA512:"1.2.840.113549.2.11",MD2withRSA:"1.2.840.113549.1.1.2",MD4withRSA:"1.2.840.113549.1.1.3",MD5withRSA:"1.2.840.113549.1.1.4",SHA1withRSA:"1.2.840.113549.1.1.5","pkcs1-MGF":"1.2.840.113549.1.1.8",rsaPSS:"1.2.840.113549.1.1.10",SHA224withRSA:"1.2.840.113549.1.1.14",SHA256withRSA:"1.2.840.113549.1.1.11",SHA384withRSA:"1.2.840.113549.1.1.12",SHA512withRSA:"1.2.840.113549.1.1.13",SHA1withECDSA:"1.2.840.10045.4.1",SHA224withECDSA:"1.2.840.10045.4.3.1",SHA256withECDSA:"1.2.840.10045.4.3.2",SHA384withECDSA:"1.2.840.10045.4.3.3",SHA512withECDSA:"1.2.840.10045.4.3.4",dsa:"1.2.840.10040.4.1",SHA1withDSA:"1.2.840.10040.4.3",SHA224withDSA:"2.16.840.1.101.3.4.3.1",SHA256withDSA:"2.16.840.1.101.3.4.3.2",rsaEncryption:"1.2.840.113549.1.1.1",commonName:"2.5.4.3",countryName:"2.5.4.6",localityName:"2.5.4.7",stateOrProvinceName:"2.5.4.8",streetAddress:"2.5.4.9",organizationName:"2.5.4.10",organizationalUnitName:"2.5.4.11",domainComponent:"0.9.2342.19200300.100.1.25",userId:"0.9.2342.19200300.100.1.1",surname:"2.5.4.4",givenName:"2.5.4.42",title:"2.5.4.12",distinguishedName:"2.5.4.49",emailAddress:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3",subjectDirectoryAttributes:"2.5.29.9",subjectKeyIdentifier:"2.5.29.14",keyUsage:"2.5.29.15",subjectAltName:"2.5.29.17",issuerAltName:"2.5.29.18",basicConstraints:"2.5.29.19",cRLNumber:"2.5.29.20",cRLReason:"2.5.29.21",nameConstraints:"2.5.29.30",cRLDistributionPoints:"2.5.29.31",certificatePolicies:"2.5.29.32",anyPolicy:"2.5.29.32.0",policyMappings:"2.5.29.33",authorityKeyIdentifier:"2.5.29.35",policyConstraints:"2.5.29.36",extKeyUsage:"2.5.29.37",inhibitAnyPolicy:"2.5.29.54",authorityInfoAccess:"1.3.6.1.5.5.7.1.1",ocsp:"1.3.6.1.5.5.7.48.1",ocspBasic:"1.3.6.1.5.5.7.48.1.1",ocspNonce:"1.3.6.1.5.5.7.48.1.2",ocspNoCheck:"1.3.6.1.5.5.7.48.1.5",caIssuers:"1.3.6.1.5.5.7.48.2",anyExtendedKeyUsage:"2.5.29.37.0",serverAuth:"1.3.6.1.5.5.7.3.1",clientAuth:"1.3.6.1.5.5.7.3.2",codeSigning:"1.3.6.1.5.5.7.3.3",emailProtection:"1.3.6.1.5.5.7.3.4",timeStamping:"1.3.6.1.5.5.7.3.8",ocspSigning:"1.3.6.1.5.5.7.3.9",smtpUTF8Mailbox:"1.3.6.1.5.5.7.8.9",dateOfBirth:"1.3.6.1.5.5.7.9.1",placeOfBirth:"1.3.6.1.5.5.7.9.2",gender:"1.3.6.1.5.5.7.9.3",countryOfCitizenship:"1.3.6.1.5.5.7.9.4",countryOfResidence:"1.3.6.1.5.5.7.9.5",ecPublicKey:"1.2.840.10045.2.1","P-256":"1.2.840.10045.3.1.7",secp256r1:"1.2.840.10045.3.1.7",secp256k1:"1.3.132.0.10",secp384r1:"1.3.132.0.34",secp521r1:"1.3.132.0.35",pkcs5PBES2:"1.2.840.113549.1.5.13",pkcs5PBKDF2:"1.2.840.113549.1.5.12","des-EDE3-CBC":"1.2.840.113549.3.7",data:"1.2.840.113549.1.7.1","signed-data":"1.2.840.113549.1.7.2","enveloped-data":"1.2.840.113549.1.7.3","digested-data":"1.2.840.113549.1.7.5","encrypted-data":"1.2.840.113549.1.7.6","authenticated-data":"1.2.840.113549.1.9.16.1.2",tstinfo:"1.2.840.113549.1.9.16.1.4",signingCertificate:"1.2.840.113549.1.9.16.2.12",timeStampToken:"1.2.840.113549.1.9.16.2.14",signaturePolicyIdentifier:"1.2.840.113549.1.9.16.2.15",etsArchiveTimeStamp:"1.2.840.113549.1.9.16.2.27",signingCertificateV2:"1.2.840.113549.1.9.16.2.47",etsArchiveTimeStampV2:"1.2.840.113549.1.9.16.2.48",extensionRequest:"1.2.840.113549.1.9.14",contentType:"1.2.840.113549.1.9.3",messageDigest:"1.2.840.113549.1.9.4",signingTime:"1.2.840.113549.1.9.5",counterSignature:"1.2.840.113549.1.9.6",archiveTimeStampV3:"0.4.0.1733.2.4",pdfRevocationInfoArchival:"1.2.840.113583.1.1.8",adobeTimeStamp:"1.2.840.113583.1.1.9.1",smimeMailboxLegacy:"2.23.140.1.5.1.1",smimeMailboxMulti:"2.23.140.1.5.1.2",smimeMailboxStrict:"2.23.140.1.5.1.3",smimeOrganizationLegacy:"2.23.140.1.5.2.1",smimeOrganizationMulti:"2.23.140.1.5.2.2",smimeOrganizationStrict:"2.23.140.1.5.2.3",smimeSponsorLegacy:"2.23.140.1.5.3.1",smimeSponsorMulti:"2.23.140.1.5.3.2",smimeSponsorStrict:"2.23.140.1.5.3.3",smimeIndividualLegacy:"2.23.140.1.5.4.1",smimeIndividualMulti:"2.23.140.1.5.4.2",smimeIndividualStrict:"2.23.140.1.5.4.3"},this.atype2oidList={CN:"2.5.4.3",L:"2.5.4.7",ST:"2.5.4.8",O:"2.5.4.10",OU:"2.5.4.11",C:"2.5.4.6",STREET:"2.5.4.9",DC:"0.9.2342.19200300.100.1.25",UID:"0.9.2342.19200300.100.1.1",SN:"2.5.4.4",T:"2.5.4.12",GN:"2.5.4.42",DN:"2.5.4.49",E:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",serialNumber:"2.5.4.5",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3"},this.objCache={},this.name2obj=function(t){if(void 0!==this.objCache[t])return this.objCache[t];if(void 0===this.name2oidList[t])throw"Name of ObjectIdentifier not defined: "+t;var n=this.name2oidList[t],r=new e({oid:n});return this.objCache[t]=r,r},this.atype2obj=function(t){if(void 0!==this.objCache[t])return this.objCache[t];var n;if(t.match(/^\d+\.\d+\.[0-9.]+$/))n=t;else if(void 0!==this.atype2oidList[t])n=this.atype2oidList[t];else{if(void 0===this.name2oidList[t])throw new Error("AttributeType name undefined: "+t);n=this.name2oidList[t]}var r=new e({oid:n});return this.objCache[t]=r,r},this.registerOIDs=function(e){if(this.checkOIDs(e))for(var t in e)this.name2oidList[t]=e[t]},this.checkOIDs=function(e){try{var t=Object.keys(e);return 0!=t.length&&(t.map((function(e,t,n){if(!this[e].match(/^[0-2]\.[0-9.]+$/))throw new Error("value is not OID")}),e),!0)}catch(e){return!1}}},le.asn1.x509.OID.oid2name=function(e){var t=le.asn1.x509.OID.name2oidList;for(var n in t)if(t[n]==e)return n;return""},le.asn1.x509.OID.oid2atype=function(e){var t=le.asn1.x509.OID.atype2oidList;for(var n in t)if(t[n]==e)return n;return e},le.asn1.x509.OID.name2oid=function(e){if(e.match(/^[0-9.]+$/))return e;var t=le.asn1.x509.OID.name2oidList;return void 0===t[e]?"":t[e]},le.asn1.x509.X509Util={},le.asn1.x509.X509Util.newCertPEM=function(e){var t=le.asn1.x509;return t.TBSCertificate,new(0,t.Certificate)(e).getPEM()},void 0!==le&&le||(le={}),void 0!==le.asn1&&le.asn1||(le.asn1={}),void 0!==le.asn1.cms&&le.asn1.cms||(le.asn1.cms={}),le.asn1.cms.Attribute=function(e){var t=Error,n=le.asn1,r=n.DERSequence,i=n.DERSet,s=n.DERObjectIdentifier;this.params=null,this.typeOid=null,this.setByParam=function(e){this.params=e},this.getValueArray=function(){throw new t("not yet implemented abstract")},this.tohex=function(){var e=new s({oid:this.typeOid}),t=new i({array:this.getValueArray()});return new r({array:[e,t]}).tohex()},this.getEncodedHex=function(){return this.tohex()}},rt(le.asn1.cms.Attribute,le.asn1.ASN1Object),le.asn1.cms.ContentType=function(e){var t=le.asn1;t.cms.ContentType.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.3",this.getValueArray=function(){return[new t.DERObjectIdentifier(this.params.type)]},null!=e&&this.setByParam(e)},rt(le.asn1.cms.ContentType,le.asn1.cms.Attribute),le.asn1.cms.MessageDigest=function(e){var t=le.asn1,n=t.DEROctetString;t.cms.MessageDigest.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.4",this.getValueArray=function(){return[new n(this.params)]},null!=e&&this.setByParam(e)},rt(le.asn1.cms.MessageDigest,le.asn1.cms.Attribute),le.asn1.cms.SigningTime=function(e){var t=le.asn1;t.cms.SigningTime.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.5",this.getValueArray=function(){return[new t.x509.Time(this.params)]},null!=e&&this.setByParam(e)},rt(le.asn1.cms.SigningTime,le.asn1.cms.Attribute),le.asn1.cms.SigningCertificate=function(e){var t=Error,n=le,r=n.asn1,i=r.DERSequence,s=r.cms,o=s.ESSCertID;n.crypto,s.SigningCertificate.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.12",this.getValueArray=function(){if(null==this.params||null==this.params||null==this.params.array)throw new t("parameter 'array' not specified");for(var n=this.params.array,r=[],s=0;s<n.length;s++){var a=n[s];0!=e.hasis||"string"!=typeof a||-1==a.indexOf("-----BEGIN")&&!de.isASN1HEX(a)||(a={cert:a}),0!=a.hasis&&0==e.hasis&&(a.hasis=!1),r.push(new o(a))}var c=new i({array:r});return[new i({array:[c]})]},null!=e&&this.setByParam(e)},rt(le.asn1.cms.SigningCertificate,le.asn1.cms.Attribute),le.asn1.cms.ESSCertID=function(e){le.asn1.cms.ESSCertID.superclass.constructor.call(this);var t=Error,n=le,r=n.asn1,i=r.DEROctetString,s=r.DERSequence,o=r.cms.IssuerSerial;this.params=null,this.getCertHash=function(e,r){if(null!=e.hash)return e.hash;if("string"==typeof e&&-1==e.indexOf("-----BEGIN")&&!de.isASN1HEX(e))return e;var i,s,o;if("string"==typeof e)i=e;else{if(null==e.cert)throw new t("hash nor cert unspecified");i=e.cert}if(s=-1!=i.indexOf("-----BEGIN")?Pe(i):i,"string"==typeof e&&(-1!=e.indexOf("-----BEGIN")?s=Pe(e):de.isASN1HEX(e)&&(s=e)),null!=e.alg)o=e.alg;else{if(null==r)throw new t("hash alg unspecified");o=r}return n.crypto.Util.hashHex(s,o)},this.tohex=function(){var e=this.params,t=this.getCertHash(e,"sha1"),n=[];return n.push(new i({hex:t})),("string"==typeof e&&-1!=e.indexOf("-----BEGIN")||null!=e.cert&&0!=e.hasis||null!=e.issuer&&null!=e.serial)&&n.push(new o(e)),new s({array:n}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},rt(le.asn1.cms.ESSCertID,le.asn1.ASN1Object),le.asn1.cms.SigningCertificateV2=function(e){var t=Error,n=le,r=n.asn1,i=r.DERSequence,s=(r.x509,r.cms),o=s.ESSCertIDv2;n.crypto,s.SigningCertificateV2.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.47",this.getValueArray=function(){if(null==this.params||null==this.params||null==this.params.array)throw new t("parameter 'array' not specified");for(var n=this.params.array,r=[],s=0;s<n.length;s++){var a=n[s];null==e.alg&&0!=e.hasis||"string"!=typeof a||-1==a.indexOf("-----BEGIN")&&!de.isASN1HEX(a)||(a={cert:a}),null==a.alg&&null!=e.alg&&(a.alg=e.alg),0!=a.hasis&&0==e.hasis&&(a.hasis=!1),r.push(new o(a))}var c=new i({array:r});return[new i({array:[c]})]},null!=e&&this.setByParam(e)},rt(le.asn1.cms.SigningCertificateV2,le.asn1.cms.Attribute),le.asn1.cms.ESSCertIDv2=function(e){le.asn1.cms.ESSCertIDv2.superclass.constructor.call(this),Error;var t=le.asn1,n=t.DEROctetString,r=t.DERSequence,i=t.cms.IssuerSerial,s=t.x509.AlgorithmIdentifier;this.params=null,this.tohex=function(){var e=this.params,t=this.getCertHash(e,"sha256"),o=[];return null!=e.alg&&"sha256"!=e.alg&&o.push(new s({name:e.alg})),o.push(new n({hex:t})),("string"==typeof e&&-1!=e.indexOf("-----BEGIN")||null!=e.cert&&0!=e.hasis||null!=e.issuer&&null!=e.serial)&&o.push(new i(e)),new r({array:o}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},rt(le.asn1.cms.ESSCertIDv2,le.asn1.cms.ESSCertID),le.asn1.cms.IssuerSerial=function(e){var t=Error,n=le.asn1,r=n.DERInteger,i=n.DERSequence,s=n.cms,o=n.x509.GeneralNames,a=ct;s.IssuerSerial.superclass.constructor.call(this),this.setByParam=function(e){this.params=e},this.tohex=function(){var e,n,s=this.params;if("string"==typeof s&&-1!=s.indexOf("-----BEGIN")||null!=s.cert){var c;c=null!=s.cert?s.cert:s;var l=new a;l.readCertPEM(c),e=l.getIssuer(),n={hex:l.getSerialNumberHex()}}else{if(null==s.issuer||!s.serial)throw new t("cert or issuer and serial parameter not specified");e=s.issuer,n=s.serial}var u=new o([{dn:e}]),h=new r(n);return new i({array:[u,h]}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},rt(le.asn1.cms.IssuerSerial,le.asn1.ASN1Object),le.asn1.cms.SignerIdentifier=function(e){var t=le.asn1,n=(t.DERInteger,t.DERSequence,t.cms),r=n.IssuerAndSerialNumber,i=n.SubjectKeyIdentifier;t.x509.X500Name,Error,n.SignerIdentifier.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;if("isssn"==e.type)return new r(e).tohex();if("skid"==e.type)return new i(e).tohex();throw new Error("wrong property for isssn or skid")},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},rt(le.asn1.cms.SignerIdentifier,le.asn1.ASN1Object),le.asn1.cms.IssuerAndSerialNumber=function(e){var t=le.asn1,n=t.DERInteger,r=t.DERSequence,i=t.cms,s=t.x509.X500Name,o=ct,a=Error;i.IssuerAndSerialNumber.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e,t,i=this.params;if("string"==typeof i&&-1!=i.indexOf("-----BEGIN")||null!=i.cert){var c;c=null!=i.cert?i.cert:i;var l=new o;l.readCertPEM(c),e=l.getIssuer(),t={hex:l.getSerialNumberHex()}}else{if(null==i.issuer||!i.serial)throw new a("cert or issuer and serial parameter not specified");e=i.issuer,t=i.serial}var u=new s(e),h=new n(t);return new r({array:[u,h]}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},null!=e&&this.setByParam(e)},rt(le.asn1.cms.IssuerAndSerialNumber,le.asn1.ASN1Object),le.asn1.cms.SubjectKeyIdentifier=function(e){var t=le.asn1,n=(t.DERInteger,t.DERSequence,t.ASN1Util.newObject),r=t.cms,i=(r.IssuerAndSerialName,r.SubjectKeyIdentifier,t.x509.X500Name,ct),s=Error;r.SubjectKeyIdentifier.superclass.constructor.call(this),this.tohex=function(){var e,t=this.params;if(null==t.cert&&null==t.skid)throw new s("property cert nor skid undefined");return null!=t.cert?e=new i(t.cert).getExtSubjectKeyIdentifier().kid.hex:null!=t.skid&&(e=t.skid),n({tag:{tage:"a0",obj:{octstr:{hex:e}}}}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},rt(le.asn1.cms.SubjectKeyIdentifier,le.asn1.ASN1Object),le.asn1.cms.AttributeList=function(e){var t=Error,n=le.asn1,r=n.DERSet,i=n.cms;i.AttributeList.superclass.constructor.call(this),this.params=null,this.hTLV=null,this.setByParam=function(e){this.params=e},this.tohex=function(){var e=this.params;if(null!=this.hTLV)return this.hTLV;var n=!0;null!=e.sortflag&&(n=e.sortflag);for(var s=e.array,o=[],a=0;a<s.length;a++){var c=s[a],l=c.attr;if("contentType"==l)o.push(new i.ContentType(c));else if("messageDigest"==l)o.push(new i.MessageDigest(c));else if("signingTime"==l)o.push(new i.SigningTime(c));else if("signingCertificate"==l)o.push(new i.SigningCertificate(c));else if("signingCertificateV2"==l)o.push(new i.SigningCertificateV2(c));else if("signaturePolicyIdentifier"==l)o.push(new le.asn1.cades.SignaturePolicyIdentifier(c));else{if("signatureTimeStamp"!=l&&"timeStampToken"!=l)throw new t("unknown attr: "+l);o.push(new le.asn1.cades.SignatureTimeStamp(c))}}var u=new r({array:o,sortflag:n});return this.hTLV=u.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},rt(le.asn1.cms.AttributeList,le.asn1.ASN1Object),le.asn1.cms.SignerInfo=function(e){var t=Error,n=le,r=n.asn1,i=r.DERInteger,s=r.DEROctetString,o=r.DERSequence,a=r.DERTaggedObject,c=r.cms,l=c.SignerIdentifier,u=c.AttributeList,h=(c.ContentType,c.EncapsulatedContentInfo,c.MessageDigest,c.SignedData,r.x509.AlgorithmIdentifier),d=n.crypto,p=it;c.SignerInfo.superclass.constructor.call(this),this.params=null,this.sign=function(){var e=this.params,t=e.sigalg,n=new u(e.sattrs).tohex(),r=p.getKey(e.signkey),i=new d.Signature({alg:t});i.init(r),i.updateHex(n);var s=i.sign();e.sighex=s},this.tohex=function(){var e=this.params,n=[];if(n.push(new i({int:e.version})),n.push(new l(e.id)),n.push(new h({name:e.hashalg})),null!=e.sattrs){var r=new u(e.sattrs);try{n.push(new a({tag:"a0",explicit:!1,obj:r}))}catch(e){throw new t("si sattr error: "+e)}}if(null!=e.sigalgfield?n.push(new h({name:e.sigalgfield})):n.push(new h({name:e.sigalg})),null==e.sighex&&null!=e.signkey&&this.sign(),n.push(new s({hex:e.sighex})),null!=e.uattrs){r=new u(e.uattrs);try{n.push(new a({tag:"a1",explicit:!1,obj:r}))}catch(e){throw new t("si uattr error: "+e)}}return new o({array:n}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},rt(le.asn1.cms.SignerInfo,le.asn1.ASN1Object),le.asn1.cms.EncapsulatedContentInfo=function(e){var t=le.asn1,n=t.DERTaggedObject,r=t.DERSequence,i=t.DERObjectIdentifier,s=t.DEROctetString;t.cms.EncapsulatedContentInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,t=[];if(t.push(new i(e.type)),null!=e.content&&(null!=e.content.hex||null!=e.content.str)&&1!=e.isDetached){var o=new s(e.content),a=new n({tag:"a0",explicit:!0,obj:o});t.push(a)}return new r({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},null!=e&&this.setByParam(e)},rt(le.asn1.cms.EncapsulatedContentInfo,le.asn1.ASN1Object),le.asn1.cms.ContentInfo=function(e){var t=le.asn1,n=t.DERTaggedObject,r=t.DERSequence,i=t.DERObjectIdentifier;t.x509.OID.name2obj,le.asn1.cms.ContentInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,t=[];t.push(new i(e.type));var s=new n({tag:"a0",explicit:!0,obj:e.obj});return t.push(s),new r({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},null!=e&&this.setByParam(e)},rt(le.asn1.cms.ContentInfo,le.asn1.ASN1Object),le.asn1.cms.SignedData=function(e){Error;var t=le.asn1,n=(t.ASN1Object,t.DERInteger),r=t.DERSet,i=t.DERSequence,s=(t.DERTaggedObject,t.cms),o=s.EncapsulatedContentInfo,a=s.SignerInfo,c=s.ContentInfo,l=s.CertificateSet,u=s.RevocationInfoChoices,h=t.x509.AlgorithmIdentifier;le.asn1.cms.SignedData.superclass.constructor.call(this),this.params=null,this.checkAndFixParam=function(){var e=this.params;this._setDigestAlgs(e),this._setContentTypeByEContent(e),this._setMessageDigestByEContent(e),this._setSignerInfoVersion(e),this._setSignedDataVersion(e)},this._setDigestAlgs=function(e){for(var t={},n=e.sinfos,r=0;r<n.length;r++)t[n[r].hashalg]=1;e.hashalgs=Object.keys(t).sort()},this._setContentTypeByEContent=function(e){for(var t=e.econtent.type,n=e.sinfos,r=0;r<n.length;r++){var i=n[r];this._getAttrParamByName(i,"contentType").type=t}},this._setMessageDigestByEContent=function(e){var t=e.econtent,n=(e.econtent.type,t.content.hex);null==n&&"data"==t.type&&null!=t.content.str&&(n=Te(t.content.str));for(var r=e.sinfos,i=0;i<r.length;i++){var s=r[i],o=s.hashalg,a=this._getAttrParamByName(s,"messageDigest"),c=le.crypto.Util.hashHex(n,o);a.hex=c}},this._getAttrParamByName=function(e,t){for(var n=e.sattrs.array,r=0;r<n.length;r++)if(n[r].attr==t)return n[r]},this._setSignerInfoVersion=function(e){for(var t=e.sinfos,n=0;n<t.length;n++){var r=t[n],i=1;"skid"==r.id.type&&(i=3),r.version=i}},this._setSignedDataVersion=function(e){var t=this._getSignedDataVersion(e);e.version=t},this._getSignedDataVersion=function(e){if(null!=e.revinfos)for(var t=e.revinfos,n=0;n<t.length;n++)if(null!=t[n].ocsp)return 5;var r=e.sinfos;for(n=0;n<r.length;n++)if(3==e.sinfos[n].version)return 3;return"data"!=e.econtent.type?3:1},this.tohex=function(){var e=this.params;null!=this.getEncodedHexPrepare&&this.getEncodedHexPrepare(),1!=e.fixed&&this.checkAndFixParam();var t=[];t.push(new n({int:e.version}));for(var s=[],c=0;c<e.hashalgs.length;c++){var d=e.hashalgs[c];s.push(new h({name:d}))}t.push(new r({array:s})),t.push(new o(e.econtent)),null!=e.certs&&t.push(new l(e.certs)),null!=e.revinfos&&t.push(new u(e.revinfos));var p=[];for(c=0;c<e.sinfos.length;c++){var f=e.sinfos[c];p.push(new a(f))}return t.push(new r({array:p})),new i({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.getContentInfo=function(){return new c({type:"signed-data",obj:this})},this.getContentInfoEncodedHex=function(){return this.getContentInfo().tohex()},null!=e&&this.setByParam(e)},rt(le.asn1.cms.SignedData,le.asn1.ASN1Object),le.asn1.cms.CertificateSet=function(e){le.asn1.cms.CertificateSet.superclass.constructor.call(this);var t=Error,n=le.asn1,r=n.DERTaggedObject,i=n.DERSet,s=n.ASN1Object;this.params=null,this.tohex=function(){var e,n=this.params,o=[];if(n instanceof Array)e=n;else{if(null==n.array)throw new t("cert array not specified");e=n.array}for(var a=0;a<e.length;a++){var c=Pe(e[a]),l=new s;l.hTLV=c,o.push(l)}var u={array:o};0==n.sortflag&&(u.sortflag=!1);var h=new i(u);return new r({tag:"a0",explicit:!1,obj:h}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},rt(le.asn1.cms.CertificateSet,le.asn1.ASN1Object),le.asn1.cms.RevocationInfoChoices=function(e){le.asn1.cms.RevocationInfoChoices.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;if(!e instanceof Array)throw new Error("params is not array");for(var t=[],n=0;n<e.length;n++)t.push(new le.asn1.cms.RevocationInfoChoice(e[n]));return le.asn1.ASN1Util.newObject({tag:{tagi:"a1",obj:{set:t}}}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},rt(le.asn1.cms.RevocationInfoChoices,le.asn1.ASN1Object),le.asn1.cms.RevocationInfoChoice=function(e){le.asn1.cms.RevocationInfoChoice.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;if(null!=e.crl&&"string"==typeof e.crl){var t=e.crl;return-1!=e.crl.indexOf("-----BEGIN")&&(t=Pe(e.crl)),t}if(null!=e.ocsp)return le.asn1.ASN1Util.newObject({tag:{tagi:"a1",obj:new le.asn1.cms.OtherRevocationFormat(e)}}).tohex();throw new Error("property crl or ocsp undefined")},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},rt(le.asn1.cms.RevocationInfoChoice,le.asn1.ASN1Object),le.asn1.cms.OtherRevocationFormat=function(e){le.asn1.cms.OtherRevocationFormat.superclass.constructor.call(this);var t=Error,n=le,r=n.asn1.ASN1Util.newObject,i=n.lang.String.isHex;this.params=null,this.tohex=function(){var e=this.params;if(null==e.ocsp)throw new t("property ocsp not specified");if(!i(e.ocsp)||!de.isASN1HEX(e.ocsp))throw new t("ocsp value not ASN.1 hex string");return r({seq:[{oid:"1.3.6.1.5.5.7.16.2"},{asn1:{tlv:e.ocsp}}]}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},rt(le.asn1.cms.OtherRevocationFormat,le.asn1.ASN1Object),le.asn1.cms.CMSUtil=new function(){},le.asn1.cms.CMSUtil.newSignedData=function(e){return new le.asn1.cms.SignedData(e)},le.asn1.cms.CMSUtil.verifySignedData=function(e){var t=le,n=t.asn1,r=n.cms,i=(r.SignerInfo,r.SignedData,r.SigningTime,r.SigningCertificate,r.SigningCertificateV2,n.cades.SignaturePolicyIdentifier,t.lang.String.isHex),s=de,o=s.getVbyList,a=s.getTLVbyList,c=s.getIdxbyList,l=s.getChildIdx,u=s.getTLV,h=s.oidname,d=t.crypto.Util.hashHex;void 0===e.cms&&i(e.cms);var p=e.cms,f=function(e,t){var n=t.idx;t.signerid_issuer1=a(e,n,[1,0],"30"),t.signerid_serial1=o(e,n,[1,1],"02"),t.hashalg=h(o(e,n,[2,0],"06"));var r=c(e,n,[3],"a0");t.idxSignedAttrs=r,g(e,t,r);var i=l(e,n).length;if(i<6)throw"malformed SignerInfo";t.sigalg=h(o(e,n,[i-2,0],"06")),t.sigval=o(e,n,[i-1],"04")},g=function(e,t,n){var r=l(e,n);t.signedAttrIdxList=r;for(var i=0;i<r.length;i++){var s,a=r[i],c=o(e,a,[0],"06");"2a864886f70d010905"===c?(s=xe(o(e,a,[1,0])),t.saSigningTime=s):"2a864886f70d010904"===c&&(s=o(e,a,[1,0],"04"),t.saMessageDigest=s)}},m=function(e,t,n,r){n.verifyDetail={};var i=n.verifyDetail,s=t.parse.econtent,o=n.hashalg,a=n.saMessageDigest;i.validMessageDigest=!1,d(s,o)===a&&(i.validMessageDigest=!0),function(e,t,n,r){var i,s=t.parse.certsIdx;if(void 0===t.certs){i=[],t.certkeys=[];for(var o=l(e,s),a=0;a<o.length;a++){var c=u(e,o[a]),h=new ct;h.readCertHex(c),i[a]=h,t.certkeys[a]=h.getPublicKey()}t.certs=i}else i=t.certs;for(t.cccc=i.length,t.cccci=o.length,a=0;a<i.length;a++){var d=h.getIssuerHex(),p=h.getSerialNumberHex();n.signerid_issuer1===d&&n.signerid_serial1===p&&(n.certkey_idx=a)}}(e,t,n),i.validSignatureValue=!1;var c=n.sigalg,h="31"+u(e,n.idxSignedAttrs).substr(2);n.signedattrshex=h;var p=t.certs[n.certkey_idx].getPublicKey(),f=new le.crypto.Signature({alg:c});f.init(p),f.updateHex(h);var g=f.verify(n.sigval);i.validSignatureValue_isValid=g,!0===g&&(i.validSignatureValue=!0),n.isValid=!1,i.validMessageDigest&&i.validSignatureValue&&(n.isValid=!0)},y={isValid:!1,parse:{}};return function(e,t){if("2a864886f70d010702"!==o(e,0,[0],"06"))return t;t.cmsType="signedData",t.econtent=o(e,0,[1,0,2,1,0]),function(e,t){for(var n,r=3;r<6;r++)if(void 0!==(n=c(e,0,[1,0,r]))){var i=e.substr(n,2);"a0"===i&&(t.certsIdx=n),"a1"===i&&(t.revinfosIdx=n),"31"===i&&(t.signerinfosIdx=n)}}(e,t),t.signerInfos=[],function(e,t){var n=t.signerinfosIdx;if(void 0!==n){var r=l(e,n);t.signerInfoIdxList=r;for(var i=0;i<r.length;i++){var s={idx:r[i]};f(e,s),t.signerInfos.push(s)}}}(e,t)}(p,y.parse),function(e,t){for(var n=t.parse.signerInfos,r=n.length,i=!0,s=0;s<r;s++){var o=n[s];m(e,t,o),o.isValid||(i=!1)}t.isValid=i}(p,y),y},le.asn1.cms.CMSParser=function(){var e=Error,t=ct,n=new t,r=de,i=r.getV,s=r.getTLV,o=(r.getIdxbyList,r.getTLVbyList),a=r.getTLVbyListEx,c=r.getVbyList,l=r.getVbyListEx,u=r.getChildIdx;this.getCMSSignedData=function(e){var t=o(e,0,[1,0]);return this.getSignedData(t)},this.getSignedData=function(e){var t=u(e,0),n={},r=i(e,t[0]),o=parseInt(r,16);n.version=o;var c=s(e,t[1]);n.hashalgs=this.getHashAlgArray(c);var l=s(e,t[2]);n.econtent=this.getEContent(l);var h=a(e,0,["[0]"]);null!=h&&(n.certs=this.getCertificateSet(h)),a(e,0,["[1]"]);var d=a(e,0,[3]);return n.sinfos=this.getSignerInfos(d),n},this.getHashAlgArray=function(e){for(var n=u(e,0),r=new t,i=[],o=0;o<n.length;o++){var a=s(e,n[o]),c=r.getAlgorithmIdentifierName(a);i.push(c)}return i},this.getEContent=function(e){var t={},n=c(e,0,[0]),r=c(e,0,[1,0]);return t.type=le.asn1.x509.OID.oid2name(de.hextooidstr(n)),t.content={hex:r},t},this.getSignerInfos=function(e){for(var t=[],n=u(e,0),r=0;r<n.length;r++){var i=s(e,n[r]),o=this.getSignerInfo(i);t.push(o)}return t},this.getSignerInfo=function(e){var t={},i=u(e,0),o=r.getInt(e,i[0],-1);-1!=o&&(t.version=o);var c=s(e,i[1]),h=this.getIssuerAndSerialNumber(c);t.id=h;var d=s(e,i[2]),p=n.getAlgorithmIdentifierName(d);t.hashalg=p;var f=a(e,0,["[0]"]);if(null!=f){var g=this.getAttributeList(f);t.sattrs=g}var m=a(e,0,[3]),y=n.getAlgorithmIdentifierName(m);t.sigalg=y;var v=l(e,0,[4]);t.sighex=v;var b=a(e,0,["[1]"]);if(null!=b){var S=this.getAttributeList(b);t.uattrs=S}return t},this.getSignerIdentifier=function(e){if("30"==e.substr(0,2))return this.getIssuerAndSerialNumber(e);throw new Error("SKID of signerIdentifier not supported")},this.getIssuerAndSerialNumber=function(e){var t={type:"isssn"},r=u(e,0),o=s(e,r[0]);t.issuer=n.getX500Name(o);var a=i(e,r[1]);return t.serial={hex:a},t},this.getAttributeList=function(e){for(var t=[],n=u(e,0),r=0;r<n.length;r++){var i=s(e,n[r]),o=this.getAttribute(i);t.push(o)}return{array:t}},this.getAttribute=function(e){var t={},n=u(e,0),i=r.getOID(e,n[0]),o=le.asn1.x509.OID.oid2name(i);t.attr=o;var a=s(e,n[1]),c=u(a,0);if(1==c.length)t.valhex=s(a,c[0]);else{for(var l=[],h=0;h<c.length;h++)l.push(s(a,c[h]));t.valhex=l}return"contentType"==o?this.setContentType(t):"messageDigest"==o?this.setMessageDigest(t):"signingTime"==o?this.setSigningTime(t):"signingCertificate"==o?this.setSigningCertificate(t):"signingCertificateV2"==o?this.setSigningCertificateV2(t):"signaturePolicyIdentifier"==o&&this.setSignaturePolicyIdentifier(t),t},this.setContentType=function(e){var t=r.getOIDName(e.valhex,0,null);null!=t&&(e.type=t,delete e.valhex)},this.setSigningTime=function(e){var t=xe(i(e.valhex,0));e.str=t,delete e.valhex},this.setMessageDigest=function(e){var t=i(e.valhex,0);e.hex=t,delete e.valhex},this.setSigningCertificate=function(e){var t=u(e.valhex,0);if(t.length>0){for(var n=s(e.valhex,t[0]),r=u(n,0),i=[],o=0;o<r.length;o++){var a=s(n,r[o]),c=this.getESSCertID(a);i.push(c)}e.array=i}if(t.length>1){var l=s(e.valhex,t[1]);e.polhex=l}delete e.valhex},this.setSignaturePolicyIdentifier=function(e){var n=u(e.valhex,0);if(n.length>0){var o=r.getOID(e.valhex,n[0]);e.oid=o}if(n.length>1){var a=new t,c=u(e.valhex,n[1]),l=s(e.valhex,c[0]),h=a.getAlgorithmIdentifierName(l);e.alg=h;var d=i(e.valhex,c[1]);e.hash=d}delete e.valhex},this.setSigningCertificateV2=function(e){var t=u(e.valhex,0);if(t.length>0){for(var n=s(e.valhex,t[0]),r=u(n,0),i=[],o=0;o<r.length;o++){var a=s(n,r[o]),c=this.getESSCertIDv2(a);i.push(c)}e.array=i}if(t.length>1){var l=s(e.valhex,t[1]);e.polhex=l}delete e.valhex},this.getESSCertID=function(e){var t={},n=u(e,0);if(n.length>0){var r=i(e,n[0]);t.hash=r}if(n.length>1){var o=s(e,n[1]),a=this.getIssuerSerial(o);null!=a.serial&&(t.serial=a.serial),null!=a.issuer&&(t.issuer=a.issuer)}return t},this.getESSCertIDv2=function(t){var r={},o=u(t,0);if(o.length<1||3<o.length)throw new e("wrong number of elements");var a=0;if("30"==t.substr(o[0],2)){var c=s(t,o[0]);r.alg=n.getAlgorithmIdentifierName(c),a++}else r.alg="sha256";var l=i(t,o[a]);if(r.hash=l,o.length>a+1){var h=s(t,o[a+1]),d=this.getIssuerSerial(h);r.issuer=d.issuer,r.serial=d.serial}return r},this.getIssuerSerial=function(e){var t={},r=u(e,0),o=s(e,r[0]),a=n.getGeneralNames(o)[0].dn;t.issuer=a;var c=i(e,r[1]);return t.serial={hex:c},t},this.getCertificateSet=function(e){for(var t=u(e,0),n=[],r=0;r<t.length;r++){var i=s(e,t[r]);if("30"==i.substr(0,2)){var o=Oe(i,"CERTIFICATE");n.push(o)}}return{array:n,sortflag:!1}}},void 0!==le&&le||(le={}),void 0!==le.asn1&&le.asn1||(le.asn1={}),void 0!==le.asn1.tsp&&le.asn1.tsp||(le.asn1.tsp={}),le.asn1.tsp.TimeStampToken=function(e){var t=le.asn1.tsp;t.TimeStampToken.superclass.constructor.call(this),this.params=null,this.getEncodedHexPrepare=function(){var e=new t.TSTInfo(this.params.econtent.content);this.params.econtent.content.hex=e.tohex()},null!=e&&this.setByParam(e)},rt(le.asn1.tsp.TimeStampToken,le.asn1.cms.SignedData),le.asn1.tsp.TSTInfo=function(e){Error;var t=le.asn1,n=t.DERSequence,r=t.DERInteger,i=t.DERBoolean,s=t.DERGeneralizedTime,o=t.DERObjectIdentifier,a=t.DERTaggedObject,c=t.tsp,l=c.MessageImprint,u=c.Accuracy,h=(t.x509.X500Name,t.x509.GeneralName);if(c.TSTInfo.superclass.constructor.call(this),this.dVersion=new r({int:1}),this.dPolicy=null,this.dMessageImprint=null,this.dSerial=null,this.dGenTime=null,this.dAccuracy=null,this.dOrdering=null,this.dNonce=null,this.dTsa=null,this.tohex=function(){var e=[this.dVersion];if(null==this.dPolicy)throw new Error("policy shall be specified.");if(e.push(this.dPolicy),null==this.dMessageImprint)throw new Error("messageImprint shall be specified.");if(e.push(this.dMessageImprint),null==this.dSerial)throw new Error("serialNumber shall be specified.");if(e.push(this.dSerial),null==this.dGenTime)throw new Error("genTime shall be specified.");e.push(this.dGenTime),null!=this.dAccuracy&&e.push(this.dAccuracy),null!=this.dOrdering&&e.push(this.dOrdering),null!=this.dNonce&&e.push(this.dNonce),null!=this.dTsa&&e.push(this.dTsa);var t=new n({array:e});return this.hTLV=t.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e){if("string"==typeof e.policy){if(!e.policy.match(/^[0-9.]+$/))throw"policy shall be oid like 0.1.4.134";this.dPolicy=new o({oid:e.policy})}void 0!==e.messageImprint&&(this.dMessageImprint=new l(e.messageImprint)),void 0!==e.serial&&(this.dSerial=new r(e.serial)),void 0!==e.genTime&&(this.dGenTime=new s(e.genTime)),void 0!==e.accuracy&&(this.dAccuracy=new u(e.accuracy)),void 0!==e.ordering&&1==e.ordering&&(this.dOrdering=new i),void 0!==e.nonce&&(this.dNonce=new r(e.nonce)),void 0!==e.tsa&&(this.dTsa=new a({tag:"a0",explicit:!0,obj:new h({dn:e.tsa})}))}},rt(le.asn1.tsp.TSTInfo,le.asn1.ASN1Object),le.asn1.tsp.Accuracy=function(e){var t=le.asn1,n=t.ASN1Util.newObject;t.tsp.Accuracy.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,t=[];return null!=e.seconds&&"number"==typeof e.seconds&&t.push({int:e.seconds}),null!=e.millis&&"number"==typeof e.millis&&t.push({tag:{tagi:"80",obj:{int:e.millis}}}),null!=e.micros&&"number"==typeof e.micros&&t.push({tag:{tagi:"81",obj:{int:e.micros}}}),n({seq:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},rt(le.asn1.tsp.Accuracy,le.asn1.ASN1Object),le.asn1.tsp.MessageImprint=function(e){var t=le.asn1,n=t.DERSequence,r=t.DEROctetString,i=t.x509.AlgorithmIdentifier;t.tsp.MessageImprint.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,t=new i({name:e.alg}),s=new r({hex:e.hash});return new n({array:[t,s]}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},rt(le.asn1.tsp.MessageImprint,le.asn1.ASN1Object),le.asn1.tsp.TimeStampReq=function(e){var t=le.asn1,n=t.DERSequence,r=t.DERInteger,i=t.DERBoolean,s=(t.ASN1Object,t.DERObjectIdentifier),o=t.tsp,a=o.MessageImprint;o.TimeStampReq.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,t=[];return t.push(new r({int:1})),e.messageImprint instanceof le.asn1.ASN1Object?t.push(e.messageImprint):t.push(new a(e.messageImprint)),null!=e.policy&&t.push(new s(e.policy)),null!=e.nonce&&t.push(new r(e.nonce)),1==e.certreq&&t.push(new i),new n({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},rt(le.asn1.tsp.TimeStampReq,le.asn1.ASN1Object),le.asn1.tsp.TimeStampResp=function(e){var t=le.asn1,n=t.DERSequence,r=(t.ASN1Object,t.tsp),i=r.PKIStatusInfo;r.TimeStampResp.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,s=[];if(null!=e.econtent||null!=e.tst)if(null!=e.statusinfo?s.push(new i(e.statusinfo)):s.push(new i("granted")),null!=e.econtent)s.push(new r.TimeStampToken(e).getContentInfo());else{if(!(e.tst instanceof t.ASN1Object))throw new Error("improper member tst value");s.push(e.tst)}else{if(null==e.statusinfo)throw new Error("parameter for token nor statusinfo not specified");s.push(new i(e.statusinfo))}return new n({array:s}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},rt(le.asn1.tsp.TimeStampResp,le.asn1.ASN1Object),le.asn1.tsp.PKIStatusInfo=function(e){var t=Error,n=le.asn1,r=n.DERSequence,i=n.tsp,s=i.PKIStatus,o=i.PKIFreeText,a=i.PKIFailureInfo;i.PKIStatusInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,n=[];if("string"==typeof e)n.push(new s(e));else{if(null==e.status)throw new t("property 'status' unspecified");n.push(new s(e.status)),null!=e.statusstr&&n.push(new o(e.statusstr)),null!=e.failinfo&&n.push(new a(e.failinfo))}return new r({array:n}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},rt(le.asn1.tsp.PKIStatusInfo,le.asn1.ASN1Object),le.asn1.tsp.PKIStatus=function(e){var t=Error,n=le.asn1,r=n.DERInteger;n.tsp.PKIStatus.superclass.constructor.call(this);var i={granted:0,grantedWithMods:1,rejection:2,waiting:3,revocationWarning:4,revocationNotification:5};this.params=null,this.tohex=function(){var e,n=this.params;if("string"==typeof n)try{e=i[n]}catch(e){throw new t("undefined name: "+n)}else{if("number"!=typeof n)throw new t("unsupported params");e=n}return new r({int:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},rt(le.asn1.tsp.PKIStatus,le.asn1.ASN1Object),le.asn1.tsp.PKIFreeText=function(e){var t=Error,n=le.asn1,r=n.DERSequence,i=n.DERUTF8String;n.tsp.PKIFreeText.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;if(!e instanceof Array)throw new t("wrong params: not array");for(var n=[],s=0;s<e.length;s++)n.push(new i({str:e[s]}));return new r({array:n}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},rt(le.asn1.tsp.PKIFreeText,le.asn1.ASN1Object),le.asn1.tsp.PKIFailureInfo=function(e){var t=Error,n=le.asn1,r=n.DERBitString,i=n.tsp.PKIFailureInfo,s={badAlg:0,badRequest:2,badDataFormat:5,timeNotAvailable:14,unacceptedPolicy:15,unacceptedExtension:16,addInfoNotAvailable:17,systemFailure:25};i.superclass.constructor.call(this),this.params=null,this.getBinValue=function(){var e=this.params,n=0;if("number"==typeof e&&0<=e&&e<=25){for(var r=(n|=1<<e).toString(2),i="",o=r.length-1;o>=0;o--)i+=r[o];return i}if("string"==typeof e&&null!=s[e])return tt([e],s);if("object"==typeof e&&null!=e.length)return tt(e,s);throw new t("wrong params")},this.tohex=function(){this.params;var e=this.getBinValue();return new r({bin:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},rt(le.asn1.tsp.PKIFailureInfo,le.asn1.ASN1Object),le.asn1.tsp.AbstractTSAAdapter=function(e){this.getTSTHex=function(e,t){throw"not implemented yet"}},le.asn1.tsp.SimpleTSAAdapter=function(e){var t=le,n=t.asn1.tsp,r=t.crypto.Util.hashHex;n.SimpleTSAAdapter.superclass.constructor.call(this),this.params=null,this.serial=0,this.getTSTHex=function(e,t){var i=r(e,t);this.params.econtent.content.messageImprint={alg:t,hash:i},this.params.econtent.content.serial={int:this.serial++};var s=Math.floor(1e9*Math.random());return this.params.econtent.content.nonce={int:s},new n.TimeStampToken(this.params).getContentInfoEncodedHex()},void 0!==e&&(this.params=e)},rt(le.asn1.tsp.SimpleTSAAdapter,le.asn1.tsp.AbstractTSAAdapter),le.asn1.tsp.FixedTSAAdapter=function(e){var t=le,n=t.asn1.tsp,r=t.crypto.Util.hashHex;n.FixedTSAAdapter.superclass.constructor.call(this),this.params=null,this.getTSTHex=function(e,t){var i=r(e,t);return this.params.econtent.content.messageImprint={alg:t,hash:i},new n.TimeStampToken(this.params).getContentInfoEncodedHex()},void 0!==e&&(this.params=e)},rt(le.asn1.tsp.FixedTSAAdapter,le.asn1.tsp.AbstractTSAAdapter),le.asn1.tsp.TSPUtil=new function(){},le.asn1.tsp.TSPUtil.newTimeStampToken=function(e){return new le.asn1.tsp.TimeStampToken(e)},le.asn1.tsp.TSPUtil.parseTimeStampReq=function(e){return(new le.asn1.tsp.TSPParser).getTimeStampReq(e)},le.asn1.tsp.TSPUtil.parseMessageImprint=function(e){return(new le.asn1.tsp.TSPParser).getMessageImprint(e)},le.asn1.tsp.TSPParser=function(){Error;var e=new ct,t=de,n=t.getV,r=t.getTLV,i=t.getIdxbyList,s=(t.getTLVbyListEx,t.getChildIdx),o=["granted","grantedWithMods","rejection","waiting","revocationWarning","revocationNotification"],a={0:"badAlg",2:"badRequest",5:"badDataFormat",14:"timeNotAvailable",15:"unacceptedPolicy",16:"unacceptedExtension",17:"addInfoNotAvailable",25:"systemFailure"};this.getResponse=function(e){var t=s(e,0);if(1==t.length)return this.getPKIStatusInfo(r(e,t[0]));if(t.length>1){var n=this.getPKIStatusInfo(r(e,t[0])),i=r(e,t[1]),o=this.getToken(i);return o.statusinfo=n,o}},this.getToken=function(e){var t=(new le.asn1.cms.CMSParser).getCMSSignedData(e);return this.setTSTInfo(t),t},this.setTSTInfo=function(e){var t=e.econtent;if("tstinfo"==t.type){var n=t.content.hex,r=this.getTSTInfo(n);t.content=r}},this.getTSTInfo=function(t){var i={},o=s(t,0),a=n(t,o[1]);i.policy=$e(a);var c=r(t,o[2]);i.messageImprint=this.getMessageImprint(c);var l=n(t,o[3]);i.serial={hex:l};var u=n(t,o[4]);i.genTime={str:xe(u)};var h=0;if(o.length>5&&"30"==t.substr(o[5],2)){var d=r(t,o[5]);i.accuracy=this.getAccuracy(d),h++}if(o.length>5+h&&"01"==t.substr(o[5+h],2)&&("ff"==n(t,o[5+h])&&(i.ordering=!0),h++),o.length>5+h&&"02"==t.substr(o[5+h],2)){var p=n(t,o[5+h]);i.nonce={hex:p},h++}if(o.length>5+h&&"a0"==t.substr(o[5+h],2)){var f=r(t,o[5+h]);f="30"+f.substr(2),pGeneralNames=e.getGeneralNames(f);var g=pGeneralNames[0].dn;i.tsa=g,h++}if(o.length>5+h&&"a1"==t.substr(o[5+h],2)){var m=r(t,o[5+h]);m="30"+m.substr(2);var y=e.getExtParamArray(m);i.ext=y,h++}return i},this.getAccuracy=function(e){for(var t={},r=s(e,0),i=0;i<r.length;i++){var o=e.substr(r[i],2),a=n(e,r[i]),c=parseInt(a,16);"02"==o?t.seconds=c:"80"==o?t.millis=c:"81"==o&&(t.micros=c)}return t},this.getMessageImprint=function(e){if("30"!=e.substr(0,2))throw new Error("head of messageImprint hex shall be x30");var r={},o=(s(e,0),i(e,0,[0,0])),a=n(e,o),c=t.hextooidstr(a),l=le.asn1.x509.OID.oid2name(c);if(""==l)throw new Error("hashAlg name undefined: "+c);var u=l,h=i(e,0,[1]);return r.alg=u,r.hash=n(e,h),r},this.getPKIStatusInfo=function(e){var t={},i=s(e,0),a=0;try{var c=n(e,i[0]),l=parseInt(c,16);t.status=o[l]}catch(e){}if(i.length>1&&"30"==e.substr(i[1],2)){var u=r(e,i[1]);t.statusstr=this.getPKIFreeText(u),a++}if(i.length>a&&"03"==e.substr(i[1+a],2)){var h=r(e,i[1+a]);t.failinfo=this.getPKIFailureInfo(h)}return t},this.getPKIFreeText=function(e){for(var n=[],r=s(e,0),i=0;i<r.length;i++)n.push(t.getString(e,r[i]));return n},this.getPKIFailureInfo=function(e){var n=t.getInt(e,0);return null!=a[n]?a[n]:n},this.getTimeStampReq=function(e){var i={certreq:!1},o=s(e,0);if(o.length<2)throw new Error("TimeStampReq must have at least 2 items");var a=r(e,o[1]);i.messageImprint=le.asn1.tsp.TSPUtil.parseMessageImprint(a);for(var c=2;c<o.length;c++){var l=o[c],u=e.substr(l,2);if("06"==u){var h=n(e,l);i.policy=t.hextooidstr(h)}"02"==u&&(i.nonce=n(e,l)),"01"==u&&(i.certreq=!0)}return i}},void 0!==le&&le||(le={}),void 0!==le.asn1&&le.asn1||(le.asn1={}),void 0!==le.asn1.cades&&le.asn1.cades||(le.asn1.cades={}),le.asn1.cades.SignaturePolicyIdentifier=function(e){var t=le.asn1.cades,n=t.SignaturePolicyId;t.SignaturePolicyIdentifier.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.15",this.params=null,this.getValueArray=function(){return[new n(this.params)]},this.setByParam=function(e){this.params=e},null!=e&&this.setByParam(e)},rt(le.asn1.cades.SignaturePolicyIdentifier,le.asn1.cms.Attribute),le.asn1.cades.SignaturePolicyId=function(e){var t=le.asn1,n=t.DERSequence,r=t.DERObjectIdentifier,i=(t.x509.AlgorithmIdentifier,t.cades),s=i.SignaturePolicyId,o=i.OtherHashAlgAndValue;s.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,t=[];return t.push(new r(e.oid)),t.push(new o(e)),new n({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},null!=e&&this.setByParam(e)},rt(le.asn1.cades.SignaturePolicyId,le.asn1.ASN1Object),le.asn1.cades.OtherHashAlgAndValue=function(e){var t=Error,n=le.asn1,r=n.DERSequence,i=n.DEROctetString,s=n.x509.AlgorithmIdentifier;n.cades.OtherHashAlgAndValue.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;if(null==e.alg)throw new t("property 'alg' not specified");if(null==e.hash&&null==e.cert)throw new t("property 'hash' nor 'cert' not specified");var n=null;if(null!=e.hash)n=e.hash;else if(null!=e.cert){if("string"!=typeof e.cert)throw new t("cert not string");var o=e.cert;-1!=e.cert.indexOf("-----BEGIN")&&(o=Pe(e.cert)),n=le.crypto.Util.hashHex(o,e.alg)}var a=[];return a.push(new s({name:e.alg})),a.push(new i({hex:n})),new r({array:a}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},rt(le.asn1.cades.OtherHashAlgAndValue,le.asn1.ASN1Object),le.asn1.cades.OtherHashValue=function(e){le.asn1.cades.OtherHashValue.superclass.constructor.call(this);var t=Error,n=le,r=(n.lang.String.isHex,n.asn1.DEROctetString);n.crypto.Util.hashHex,this.params=null,this.tohex=function(){var e=this.params;if(null==e.hash&&null==e.cert)throw new t("hash or cert not specified");var n=null;if(null!=e.hash)n=e.hash;else if(null!=e.cert){if("string"!=typeof e.cert)throw new t("cert not string");var i=e.cert;-1!=e.cert.indexOf("-----BEGIN")&&(i=Pe(e.cert)),n=le.crypto.Util.hashHex(i,"sha1")}return new r({hex:n}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},rt(le.asn1.cades.OtherHashValue,le.asn1.ASN1Object),le.asn1.cades.SignatureTimeStamp=function(e){var t=Error,n=le,r=n.lang.String.isHex,i=n.asn1,s=i.ASN1Object;i.x509,i.cades.SignatureTimeStamp.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.14",this.params=null,this.getValueArray=function(){var e=this.params;if(null!=e.tst){if(r(e.tst))return(n=new s).hTLV=e.tst,[n];if(e.tst instanceof s)return[e.tst];throw new t("params.tst has wrong value")}if(null!=e.res){var n,i=e.res;if(i instanceof s&&(i=i.tohex()),"string"!=typeof i||!r(i))throw new t("params.res has wrong value");return de.getTLVbyList(i,0,[1]),(n=new s).hTLV=e.tst,[n]}},null!=e&&this.setByParam(e)},rt(le.asn1.cades.SignatureTimeStamp,le.asn1.cms.Attribute),le.asn1.cades.CompleteCertificateRefs=function(e){var t=Error,n=le,r=n.asn1,i=r.DERSequence,s=r.cades,o=s.OtherCertID,a=n.lang.String.isHex;s.CompleteCertificateRefs.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.21",this.params=null,this.getValueArray=function(){for(var e=this.params,n=[],r=0;r<e.array.length;r++){var s=e.array[r];if("string"==typeof s)if(-1!=s.indexOf("-----BEGIN"))s={cert:s};else{if(!a(s))throw new t("unsupported value: "+s);s={hash:s}}null!=e.alg&&null==s.alg&&(s.alg=e.alg),null!=e.hasis&&null==s.hasis&&(s.hasis=e.hasis);var c=new o(s);n.push(c)}return[new i({array:n})]},null!=e&&this.setByParam(e)},rt(le.asn1.cades.CompleteCertificateRefs,le.asn1.cms.Attribute),le.asn1.cades.OtherCertID=function(e){var t=le.asn1,n=t.DERSequence,r=t.cms.IssuerSerial,i=t.cades,s=i.OtherHashValue,o=i.OtherHashAlgAndValue;i.OtherCertID.superclass.constructor.call(this),this.params=e,this.tohex=function(){var e=this.params;"string"==typeof e&&(-1!=e.indexOf("-----BEGIN")?e={cert:e}:_isHex(e)&&(e={hash:e}));var t,i=[];if(t=null!=e.alg?new o(e):new s(e),i.push(t),null!=e.cert&&1==e.hasis||null!=e.issuer&&null!=e.serial){var a=new r(e);i.push(a)}return new n({array:i}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},rt(le.asn1.cades.OtherCertID,le.asn1.ASN1Object),le.asn1.cades.OtherHash=function(e){Error;var t=le,n=t.asn1,r=(n.cms,n.cades),i=r.OtherHashAlgAndValue,s=r.OtherHashValue,o=(t.crypto.Util.hashHex,t.lang.String.isHex);r.OtherHash.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;return"string"==typeof e&&(-1!=e.indexOf("-----BEGIN")?e={cert:e}:o(e)&&(e={hash:e})),(null!=e.alg?new i(e):new s(e)).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},rt(le.asn1.cades.OtherHash,le.asn1.ASN1Object),le.asn1.cades.CAdESUtil=new function(){},le.asn1.cades.CAdESUtil.parseSignedDataForAddingUnsigned=function(e){return(new le.asn1.cms.CMSParser).getCMSSignedData(e)},le.asn1.cades.CAdESUtil.parseSignerInfoForAddingUnsigned=function(e,t,n){var r=de,i=r.getChildIdx,s=r.getTLV,o=r.getV,a=le.asn1,c=a.ASN1Object,l=a.cms,u=l.AttributeList,h=l.SignerInfo,d={},p=i(e,t);if(6!=p.length)throw"not supported items for SignerInfo (!=6)";var f=p.shift();d.version=s(e,f);var g=p.shift();d.si=s(e,g);var m=p.shift();d.digalg=s(e,m);var y=p.shift();d.sattrs=s(e,y);var v=p.shift();d.sigalg=s(e,v);var b=p.shift();d.sig=s(e,b),d.sigval=o(e,b);var S=null;return d.obj=new h,(S=new c).hTLV=d.version,d.obj.dCMSVersion=S,(S=new c).hTLV=d.si,d.obj.dSignerIdentifier=S,(S=new c).hTLV=d.digalg,d.obj.dDigestAlgorithm=S,(S=new c).hTLV=d.sattrs,d.obj.dSignedAttrs=S,(S=new c).hTLV=d.sigalg,d.obj.dSigAlg=S,(S=new c).hTLV=d.sig,d.obj.dSig=S,d.obj.dUnsignedAttrs=new u,d},void 0!==le.asn1.csr&&le.asn1.csr||(le.asn1.csr={}),le.asn1.csr.CertificationRequest=function(e){var t=le.asn1,n=t.DERBitString,r=t.DERSequence,i=t.csr,s=(t.x509,i.CertificationRequestInfo);i.CertificationRequest.superclass.constructor.call(this),this.setByParam=function(e){this.params=e},this.sign=function(){var e=new s(this.params).tohex(),t=new le.crypto.Signature({alg:this.params.sigalg});t.init(this.params.sbjprvkey),t.updateHex(e);var n=t.sign();this.params.sighex=n},this.getPEM=function(){return Oe(this.tohex(),"CERTIFICATE REQUEST")},this.tohex=function(){var e=this.params,t=new le.asn1.csr.CertificationRequestInfo(this.params),i=new le.asn1.x509.AlgorithmIdentifier({name:e.sigalg});if(null==e.sighex&&null!=e.sbjprvkey&&this.sign(),null==e.sighex)throw new Error("sighex or sbjprvkey parameter not defined");var s=new n({hex:"00"+e.sighex});return new r({array:[t,i,s]}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},rt(le.asn1.csr.CertificationRequest,le.asn1.ASN1Object),le.asn1.csr.CertificationRequestInfo=function(e){var t=le.asn1,n=(t.DERBitString,t.DERSequence),r=t.DERInteger,i=t.DERUTF8String,s=t.DERTaggedObject,o=t.ASN1Util.newObject,a=t.csr,c=t.x509,l=c.X500Name,u=c.Extensions,h=c.SubjectPublicKeyInfo;a.AttributeList,a.CertificationRequestInfo.superclass.constructor.call(this),this.params=null,this.setByParam=function(e){null!=e&&(this.params=e)},this.tohex=function(){var e=this.params,t=[];if(t.push(new r({int:0})),t.push(new l(e.subject)),t.push(new h(it.getKey(e.sbjpubkey))),null!=e.attrs){var a=function(e){for(var t=Error,n=le.asn1.x509.Extensions,r=[],i=0;i<e.length;i++){var s=e[i],o=s.attr;if("extensionRequest"==o){var a={seq:[{oid:"1.2.840.113549.1.9.14"},{set:[new n(s.ext)]}]};r.push(a)}else if("unstructuredName"==o)a={seq:[{oid:"1.2.840.113549.1.9.2"},{set:s.names}]},r.push(a);else{if("challengePassword"!=o)throw new t("unknown CSR attribute");a={seq:[{oid:"1.2.840.113549.1.9.7"},{set:[{utf8str:s.password}]}]},r.push(a)}}return{set:r}}(e.attrs),c=o({tag:{tage:"a0",obj:a}});t.push(c)}else if(null!=e.extreq){var d=new u(e.extreq);c=o({tag:{tage:"a0",obj:{seq:[{oid:"1.2.840.113549.1.9.14"},{set:[d]}]}}}),t.push(c)}else t.push(new s({tag:"a0",explicit:!1,obj:new i({str:""})}));return new n({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},rt(le.asn1.csr.CertificationRequestInfo,le.asn1.ASN1Object),le.asn1.csr.AttributeList=function(e){},rt(le.asn1.csr.AttributeList,le.asn1.ASN1Object),le.asn1.csr.CSRUtil=new function(){},le.asn1.csr.CSRUtil.newCSRPEM=function(e){return new le.asn1.csr.CertificationRequest(e).getPEM()},le.asn1.csr.CSRUtil.getParam=function(e,t){var n=de,r=n.getV,i=n.getIdxbyList,s=n.getTLVbyList,o=n.getTLVbyListEx,a=n.getVbyListEx,c={};if(-1==e.indexOf("-----BEGIN CERTIFICATE REQUEST"))throw new Error("argument is not PEM file");var l=Pe(e,"CERTIFICATE REQUEST");t&&(c.tbs=s(l,0,[0]));try{var u=o(l,0,[0,1]);if("3000"==u)c.subject={};else{var h=new ct;c.subject=h.getX500Name(u)}}catch(e){}var d=o(l,0,[0,2]),p=it.getKey(d,null,"pkcs8pub");c.sbjpubkey=it.getPEM(p,"PKCS8PUB");var f=function(e){var t=i(e,0,[0,3,0,0],"06");return"2a864886f70d01090e"!=r(e,t)?null:s(e,0,[0,3,0,1,0],"30")}(l);h=new ct,null!=f&&(c.extreq=h.getExtParamArray(f));try{var g=o(l,0,[1],"30");h=new ct,c.sigalg=h.getAlgorithmIdentifierName(g)}catch(e){}try{var m=a(l,0,[2]);c.sighex=m}catch(e){}return c},le.asn1.csr.CSRUtil.verifySignature=function(e){try{var t=null;if("string"==typeof e&&-1!=e.indexOf("-----BEGIN CERTIFICATE REQUEST")?t=le.asn1.csr.CSRUtil.getParam(e,!0):"object"==typeof e&&null!=e.sbjpubkey&&null!=e.sigalg&&null!=e.sighex&&null!=e.tbs&&(t=e),null==t)return!1;var n=new le.crypto.Signature({alg:t.sigalg});return n.init(t.sbjpubkey),n.updateHex(t.tbs),n.verify(t.sighex)}catch(e){return alert(e),!1}},void 0!==le&&le||(le={}),void 0!==le.asn1&&le.asn1||(le.asn1={}),void 0!==le.asn1.ocsp&&le.asn1.ocsp||(le.asn1.ocsp={}),le.asn1.ocsp.DEFAULT_HASH="sha1",le.asn1.ocsp.OCSPResponse=function(e){le.asn1.ocsp.OCSPResponse.superclass.constructor.call(this),le.asn1.DEREnumerated;var t=le.asn1.ASN1Util.newObject,n=le.asn1.ocsp.ResponseBytes,r=["successful","malformedRequest","internalError","tryLater","_not_used_","sigRequired","unauthorized"];this.params=null,this._getStatusCode=function(){var e=this.params.resstatus;return"number"==typeof e?e:"string"!=typeof e?-1:r.indexOf(e)},this.setByParam=function(e){this.params=e},this.tohex=function(){var e=this.params,r=this._getStatusCode();if(-1==r)throw new Error("responseStatus not supported: "+e.resstatus);if(0!=r)return t({seq:[{enum:{int:r}}]}).tohex();var i=new n(e);return t({seq:[{enum:{int:0}},{tag:{tag:"a0",explicit:!0,obj:i}}]}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},rt(le.asn1.ocsp.OCSPResponse,le.asn1.ASN1Object),le.asn1.ocsp.ResponseBytes=function(e){le.asn1.ocsp.ResponseBytes.superclass.constructor.call(this);var t=le.asn1,n=t.DERSequence,r=t.DERObjectIdentifier,i=t.DEROctetString,s=t.ocsp.BasicOCSPResponse;this.params=null,this.setByParam=function(e){this.params=e},this.tohex=function(){var e=this.params;if("ocspBasic"!=e.restype)throw new Error("not supported responseType: "+e.restype);var t=new s(e),o=[];return o.push(new r({name:"ocspBasic"})),o.push(new i({hex:t.tohex()})),new n({array:o}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},rt(le.asn1.ocsp.ResponseBytes,le.asn1.ASN1Object),le.asn1.ocsp.BasicOCSPResponse=function(e){le.asn1.ocsp.BasicOCSPResponse.superclass.constructor.call(this);var t=Error,n=le.asn1,r=n.ASN1Object,i=n.DERSequence,s=(n.DERGeneralizedTime,n.DERTaggedObject),o=n.DERBitString,a=(n.x509.Extensions,n.x509.AlgorithmIdentifier),c=n.ocsp;c.ResponderID,_SingleResponseList=c.SingleResponseList,_ResponseData=c.ResponseData,this.params=null,this.setByParam=function(e){this.params=e},this.sign=function(){var e=this.params,t=e.tbsresp.tohex(),n=new le.crypto.Signature({alg:e.sigalg});n.init(e.reskey),n.updateHex(t),e.sighex=n.sign()},this.tohex=function(){var e=this.params;null==e.tbsresp&&(e.tbsresp=new _ResponseData(e)),null==e.sighex&&null!=e.reskey&&this.sign();var n=[];if(n.push(e.tbsresp),n.push(new a({name:e.sigalg})),n.push(new o({hex:"00"+e.sighex})),null!=e.certs&&null!=e.certs.length){for(var c=[],l=0;l<e.certs.length;l++){var u=e.certs[l],h=null;if(de.isASN1HEX(u))h=u;else{if(!u.match(/-----BEGIN/))throw new t("certs["+l+"] not hex or PEM");h=Pe(u)}c.push(new r({tlv:h}))}var d=new i({array:c});n.push(new s({tag:"a0",explicit:!0,obj:d}))}return new i({array:n}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},rt(le.asn1.ocsp.BasicOCSPResponse,le.asn1.ASN1Object),le.asn1.ocsp.ResponseData=function(e){le.asn1.ocsp.ResponseData.superclass.constructor.call(this);var t=Error,n=le.asn1,r=n.DERSequence,i=n.DERGeneralizedTime,s=n.DERTaggedObject,o=n.x509.Extensions,a=n.ocsp,c=a.ResponderID;_SingleResponseList=a.SingleResponseList,this.params=null,this.tohex=function(){var e=this.params;null!=e.respid&&new t("respid not specified"),null!=e.prodat&&new t("prodat not specified"),null!=e.array&&new t("array not specified");var n=[];if(n.push(new c(e.respid)),n.push(new i(e.prodat)),n.push(new _SingleResponseList(e.array)),null!=e.ext){var a=new o(e.ext);n.push(new s({tag:"a1",explicit:!0,obj:a}))}return new r({array:n}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},void 0!==e&&this.setByParam(e)},rt(le.asn1.ocsp.ResponseData,le.asn1.ASN1Object),le.asn1.ocsp.ResponderID=function(e){le.asn1.ocsp.ResponderID.superclass.constructor.call(this);var t=le,n=t.asn1,r=n.ASN1Util.newObject,i=n.x509.X500Name,s=t.lang.String.isHex,o=Error;this.params=null,this.tohex=function(){var e=this.params;if(null!=e.key){var t,n=null;if("string"==typeof e.key?(s(e.key)&&(n=e.key),e.key.match(/-----BEGIN CERTIFICATE/)&&null!=(t=new ct(e.key).getExtSubjectKeyIdentifier())&&(n=t.kid.hex)):e.key instanceof ct&&null!=(t=e.key.getExtSubjectKeyIdentifier())&&(n=t.kid.hex),null==n)throw new o("wrong key member value");return r({tag:{tag:"a2",explicit:!0,obj:{octstr:{hex:n}}}}).tohex()}if(null!=e.name){var a=null;if("string"==typeof e.name&&e.name.match(/-----BEGIN CERTIFICATE/)?a=new ct(e.name).getSubject():e.name instanceof ct?a=e.name.getSubject():"object"!=typeof e.name||null==e.name.array&&null==e.name.str||(a=e.name),null==a)throw new o("wrong name member value");return r({tag:{tag:"a1",explicit:!0,obj:new i(a)}}).tohex()}throw new o("key or name not specified")},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},void 0!==e&&this.setByParam(e)},rt(le.asn1.ocsp.ResponderID,le.asn1.ASN1Object),le.asn1.ocsp.SingleResponseList=function(e){le.asn1.ocsp.SingleResponseList.superclass.constructor.call(this);var t=le.asn1,n=t.DERSequence,r=t.ocsp.SingleResponse;this.params=null,this.tohex=function(){var e=this.params;if("object"!=typeof e||null==e.length)throw new Error("params not specified properly");for(var t=[],i=0;i<e.length;i++)t.push(new r(e[i]));return new n({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},void 0!==e&&this.setByParam(e)},rt(le.asn1.ocsp.SingleResponseList,le.asn1.ASN1Object),le.asn1.ocsp.SingleResponse=function(e){var t=Error,n=le.asn1,r=n.DERSequence,i=n.DERGeneralizedTime,s=n.DERTaggedObject,o=n.ocsp,a=o.CertID,c=o.CertStatus,l=n.x509.Extensions;o.SingleResponse.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,n=[];if(null==e.certid)throw new t("certid unspecified");if(null==e.status)throw new t("status unspecified");if(null==e.thisupdate)throw new t("thisupdate unspecified");if(n.push(new a(e.certid)),n.push(new c(e.status)),n.push(new i(e.thisupdate)),null!=e.nextupdate){var o=new i(e.nextupdate);n.push(new s({tag:"a0",explicit:!0,obj:o}))}if(null!=e.ext){var u=new l(e.ext);n.push(new s({tag:"a1",explicit:!0,obj:u}))}return new r({array:n}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},void 0!==e&&this.setByParam(e)},rt(le.asn1.ocsp.SingleResponse,le.asn1.ASN1Object),le.asn1.ocsp.CertID=function(e){var t=le,n=t.asn1,r=n.DEROctetString,i=n.DERInteger,s=n.DERSequence,o=n.x509.AlgorithmIdentifier,a=n.ocsp,c=(a.DEFAULT_HASH,t.crypto.Util.hashHex),l=ct,u=de.getVbyList;a.CertID.superclass.constructor.call(this),this.DEFAULT_HASH="sha1",this.params=null,this.setByValue=function(e,t,n,r){null==r&&(r=this.DEFAULT_HASH),this.params={alg:r,issname:e,isskey:t,sbjsn:n}},this.setByCert=function(e,t,n){null==n&&(n=this.DEFAULT_HASH),this.params={alg:n,issuerCert:e,subjectCert:t}},this.getParamByCerts=function(e,t,n){null==n&&(n=this.DEFAULT_HASH);var r=new l(e),i=new l(t),s=c(r.getSubjectHex(),n),o=r.getPublicKeyHex();return{alg:n,issname:s,isskey:c(u(o,0,[1],"03",!0),n),sbjsn:i.getSerialNumberHex()}},this.tohex=function(){if("object"!=typeof this.params)throw new Error("params not set");var e,t,n,a,c=this.params;if(a=null==c.alg?this.DEFAULT_HASH:c.alg,null!=c.issuerCert&&null!=c.subjectCert){var l=this.getParamByCerts(c.issuerCert,c.subjectCert,a);e=l.issname,t=l.isskey,n=l.sbjsn}else{if(null==c.issname||null==c.isskey||null==c.sbjsn)throw new Error("required param members not defined");e=c.issname,t=c.isskey,n=c.sbjsn}var u=new o({name:a}),h=new r({hex:e}),d=new r({hex:t}),p=new i({hex:n}),f=new s({array:[u,h,d,p]});return this.hTLV=f.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},rt(le.asn1.ocsp.CertID,le.asn1.ASN1Object),le.asn1.ocsp.CertStatus=function(e){le.asn1.ocsp.CertStatus.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;if("good"==e.status)return"8000";if("unknown"==e.status)return"8200";if("revoked"==e.status){var t=[{gentime:{str:e.time}}];null!=e.reason&&t.push({tag:{tag:"a0",explicit:!0,obj:{enum:{int:e.reason}}}});var n={tag:"a1",explicit:!1,obj:{seq:t}};return le.asn1.ASN1Util.newObject({tag:n}).tohex()}throw new Error("bad status")},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},void 0!==e&&this.setByParam(e)},rt(le.asn1.ocsp.CertStatus,le.asn1.ASN1Object),le.asn1.ocsp.Request=function(e){var t=le.asn1,n=t.DERSequence,r=t.ocsp;if(r.Request.superclass.constructor.call(this),this.dReqCert=null,this.dExt=null,this.tohex=function(){var e=[];if(null===this.dReqCert)throw"reqCert not set";e.push(this.dReqCert);var t=new n({array:e});return this.hTLV=t.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e){var i=new r.CertID(e);this.dReqCert=i}},rt(le.asn1.ocsp.Request,le.asn1.ASN1Object),le.asn1.ocsp.TBSRequest=function(e){var t=le.asn1,n=t.DERSequence,r=t.ocsp;r.TBSRequest.superclass.constructor.call(this),this.version=0,this.dRequestorName=null,this.dRequestList=[],this.dRequestExt=null,this.setRequestListByParam=function(e){for(var t=[],n=0;n<e.length;n++){var i=new r.Request(e[0]);t.push(i)}this.dRequestList=t},this.tohex=function(){var e=[];if(0!==this.version)throw"not supported version: "+this.version;if(null!==this.dRequestorName)throw"requestorName not supported";var t=new n({array:this.dRequestList});if(e.push(t),null!==this.dRequestExt)throw"requestExtensions not supported";var r=new n({array:e});return this.hTLV=r.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&void 0!==e.reqList&&this.setRequestListByParam(e.reqList)},rt(le.asn1.ocsp.TBSRequest,le.asn1.ASN1Object),le.asn1.ocsp.OCSPRequest=function(e){var t=le.asn1,n=t.DERSequence,r=t.ocsp;if(r.OCSPRequest.superclass.constructor.call(this),this.dTbsRequest=null,this.dOptionalSignature=null,this.tohex=function(){var e=[];if(null===this.dTbsRequest)throw"tbsRequest not set";if(e.push(this.dTbsRequest),null!==this.dOptionalSignature)throw"optionalSignature not supported";var t=new n({array:e});return this.hTLV=t.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&void 0!==e.reqList){var i=new r.TBSRequest(e);this.dTbsRequest=i}},rt(le.asn1.ocsp.OCSPRequest,le.asn1.ASN1Object),le.asn1.ocsp.OCSPUtil={},le.asn1.ocsp.OCSPUtil.getRequestHex=function(e,t,n){var r=le.asn1.ocsp;void 0===n&&(n=r.DEFAULT_HASH);var i={alg:n,issuerCert:e,subjectCert:t};return new r.OCSPRequest({reqList:[i]}).tohex()},le.asn1.ocsp.OCSPUtil.getOCSPResponseInfo=function(e){var t=de,n=t.getVbyList,r=t.getVbyListEx,i=t.getIdxbyList,s=(t.getIdxbyListEx,t.getV),o={};try{var a=r(e,0,[0],"0a");o.responseStatus=parseInt(a,16)}catch(e){}if(0!==o.responseStatus)return o;try{var c=i(e,0,[1,0,1,0,0,2,0,1]);"80"===e.substr(c,2)?o.certStatus="good":"a1"===e.substr(c,2)?(o.certStatus="revoked",o.revocationTime=xe(n(e,c,[0]))):"82"===e.substr(c,2)&&(o.certStatus="unknown")}catch(e){}try{var l=i(e,0,[1,0,1,0,0,2,0,2]);o.thisUpdate=xe(s(e,l))}catch(e){}try{var u=i(e,0,[1,0,1,0,0,2,0,3]);"a0"===e.substr(u,2)&&(o.nextUpdate=xe(n(e,u,[0])))}catch(e){}return o},le.asn1.ocsp.OCSPParser=function(){var e=Error,t=ct,n=new t,r=de,i=r.getV,s=r.getTLV,o=r.getIdxbyList,a=r.getVbyList,c=r.getTLVbyList,l=r.getVbyListEx,u=r.getTLVbyListEx,h=r.getChildIdx;this.getOCSPRequest=function(t){var n=h(t,0);if(1!=n.length&&2!=n.length)throw new e("wrong number elements: "+n.length);return this.getTBSRequest(s(t,n[0]))},this.getTBSRequest=function(e){var t={},r=u(e,0,[0],"30");t.array=this.getRequestList(r);var i=u(e,0,["[2]",0],"30");return null!=i&&(t.ext=n.getExtParamArray(i)),t},this.getRequestList=function(e){for(var t=[],n=h(e,0),r=0;r<n.length;r++)e=s(e,n[r]),t.push(this.getRequest(e));return t},this.getRequest=function(t){var r=h(t,0);if(1!=r.length&&2!=r.length)throw new e("wrong number elements: "+r.length);var i=this.getCertID(s(t,r[0]));if(2==r.length){var a=o(t,0,[1,0]);i.ext=n.getExtParamArray(s(t,a))}return i},this.getCertID=function(n){var r=h(n,0);if(4!=r.length)throw new e("wrong number elements: "+r.length);var o=new t,a={};return a.alg=o.getAlgorithmIdentifierName(s(n,r[0])),a.issname=i(n,r[1]),a.isskey=i(n,r[2]),a.sbjsn=i(n,r[3]),a},this.getOCSPResponse=function(e){var t,n=h(e,0),r=i(e,n[0]),s=parseInt(r);if(1==n.length)return{resstatus:s};var o=c(e,0,[1,0]);return(t=this.getResponseBytes(o)).resstatus=s,t},this.getResponseBytes=function(e){var t,n=h(e,0),r=c(e,0,[1,0]);t=this.getBasicOCSPResponse(r);var s=i(e,n[0]);return t.restype=le.asn1.x509.OID.oid2name($e(s)),t},this.getBasicOCSPResponse=function(e){var t,n=h(e,0);t=this.getResponseData(s(e,n[0]));var r=new ct;t.alg=r.getAlgorithmIdentifierName(s(e,n[1]));var o=i(e,n[2]);t.sighex=o.substr(2);var a=l(e,0,["[0]"]);if(null!=a){for(var c=h(a,0),u=[],d=0;d<c.length;d++){var p=s(a,c[d]);u.push(p)}t.certs=u}return t},this.getResponseData=function(e){var t=h(e,0),n=t.length,r={},o=0;"a0"==e.substr(t[0],2)&&o++,r.respid=this.getResponderID(s(e,t[o++]));var a=i(e,t[o++]);if(r.prodat=xe(a),r.array=this.getSingleResponseList(s(e,t[o++])),"a1"==e.substr(t[n-1],2)){var l=c(e,t[n-1],[0]),u=new ct;r.ext=u.getExtParamArray(l)}return r},this.getResponderID=function(e){var t={};if("a2"==e.substr(0,2)){var n=a(e,0,[0]);t.key=n}if("a1"==e.substr(0,2)){var r=c(e,0,[0]),i=new ct;t.name=i.getX500Name(r)}return t},this.getSingleResponseList=function(e){for(var t=h(e,0),n=[],r=0;r<t.length;r++){var i=this.getSingleResponse(s(e,t[r]));n.push(i)}return n},this.getSingleResponse=function(e){var t=h(e,0),n={},r=this.getCertID(s(e,t[0]));n.certid=r;var o=this.getCertStatus(s(e,t[1]));if(n.status=o,"18"==e.substr(t[2],2)){var l=i(e,t[2]);n.thisupdate=xe(l)}for(var u=3;u<t.length;u++){if("a0"==e.substr(t[u],2)){var d=a(e,t[u],[0],"18");n.nextupdate=xe(d)}if("a1"==e.substr(t[u],2)){var p=new ct,f=c(e,0,[u,0]);n.ext=p.getExtParamArray(f)}}return n},this.getCertStatus=function(e){var t={};if("8000"==e)return{status:"good"};if("8200"==e)return{status:"unknown"};if("a1"==e.substr(0,2)){t.status="revoked";var n=xe(a(e,0,[0]));t.time=n}return t}},void 0!==le&&le||(le={}),void 0!==le.lang&&le.lang||(le.lang={}),le.lang.String=function(){},"function"==typeof Buffer?(ue=function(e){return ye(Buffer.from(e,"utf8").toString("base64"))},he=function(e){return Buffer.from(ve(e),"base64").toString("utf8")}):(ue=function(e){return be(De(Ue(e)))},he=function(e){return decodeURIComponent(Me(Se(e)))}),le.lang.String.isInteger=function(e){return!!e.match(/^[0-9]+$/)||!!e.match(/^-[0-9]+$/)},le.lang.String.isHex=function(e){return Ve(e)},le.lang.String.isBase64=function(e){return!(!(e=e.replace(/\s+/g,"")).match(/^[0-9A-Za-z+\/]+={0,3}$/)||e.length%4!=0)},le.lang.String.isBase64URL=function(e){return!e.match(/[+/=]/)&&(e=ve(e),le.lang.String.isBase64(e))},le.lang.String.isIntegerArray=function(e){return!!(e=e.replace(/\s+/g,"")).match(/^\[[0-9,]+\]$/)},le.lang.String.isPrintable=function(e){return null!==e.match(/^[0-9A-Za-z '()+,-./:=?]*$/)},le.lang.String.isIA5=function(e){return null!==e.match(/^[\x20-\x21\x23-\x7f]*$/)},le.lang.String.isMail=function(e){return null!==e.match(/^[A-Za-z0-9]{1}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-]{1,}\.[A-Za-z0-9]{1,}$/)};var Xe=function(e,t,n){return null==n&&(n="0"),e.length>=t?e:new Array(t-e.length+1).join(n)+e};function Ze(e){if(e.length%2!=0)return-1;if(null==(e=e.toLowerCase()).match(/^[0-9a-f]+$/))return-1;try{var t=e.substr(0,2);if("00"==t)return parseInt(e.substr(2),16);var n=parseInt(t,16);if(n>7)return-1;var r=e.substr(2),i=parseInt(r,16).toString(2);"0"==i&&(i="00000000"),i=i.slice(0,0-n);var s=parseInt(i,2);return NaN==s?-1:s}catch(e){return-1}}function Ye(e){if("number"!=typeof e)return null;if(e<0)return null;var t=Number(e).toString(2),n=8-t.length%8;8==n&&(n=0),t+=Xe("",n,"0");var r=parseInt(t,2).toString(16);return r.length%2==1&&(r="0"+r),"0"+n+r}function et(e){if("string"!=typeof e)return null;if(e.length%2!=0)return null;if(!e.match(/^[0-9a-f]+$/))return null;try{var t=parseInt(e.substr(0,2),16);if(t<0||7<t)return null;for(var n=e.substr(2),r="",i=0;i<n.length;i+=2){var s=n.substr(i,2),o=parseInt(s,16).toString(2);r+=o=("0000000"+o).slice(-8)}return r.substr(0,r.length-t)}catch(e){return null}}function tt(e,t){for(var n=0,r=0;r<e.length;r++)n|=1<<t[e[r]];var i=n.toString(2),s="";for(r=i.length-1;r>=0;r--)s+=i[r];return s}function nt(e,t,n){if("object"==typeof e){t=String(t).split(".");for(var r=0;r<t.length&&e;r++){var i=t[r];i.match(/^[0-9]+$/)&&(i=parseInt(i)),e=e[i]}return e||!1===e?e:n}}function rt(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.superclass=t.prototype,t.prototype.constructor==Object.prototype.constructor&&(t.prototype.constructor=t)}void 0!==le&&le||(le={}),void 0!==le.crypto&&le.crypto||(le.crypto={}),le.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHAwithRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:p.algo.MD5,sha1:p.algo.SHA1,sha224:p.algo.SHA224,sha256:p.algo.SHA256,sha384:p.algo.SHA384,sha512:p.algo.SHA512,ripemd160:p.algo.RIPEMD160},this.getDigestInfoHex=function(e,t){if(void 0===this.DIGESTINFOHEAD[t])throw"alg not supported in Util.DIGESTINFOHEAD: "+t;return this.DIGESTINFOHEAD[t]+e},this.getPaddedDigestInfoHex=function(e,t,n){var r=this.getDigestInfoHex(e,t),i=n/4;if(r.length+22>i)throw"key is too short for SigAlg: keylen="+n+","+t;for(var s="00"+r,o="",a=i-4-s.length,c=0;c<a;c+=2)o+="ff";return"0001"+o+s},this.hashString=function(e,t){return new le.crypto.MessageDigest({alg:t}).digestString(e)},this.hashHex=function(e,t){return new le.crypto.MessageDigest({alg:t}).digestHex(e)},this.sha1=function(e){return this.hashString(e,"sha1")},this.sha256=function(e){return this.hashString(e,"sha256")},this.sha256Hex=function(e){return this.hashHex(e,"sha256")},this.sha512=function(e){return this.hashString(e,"sha512")},this.sha512Hex=function(e){return this.hashHex(e,"sha512")},this.isKey=function(e){return e instanceof re||e instanceof le.crypto.DSA||e instanceof le.crypto.ECDSA}},le.crypto.Util.md5=function(e){return new le.crypto.MessageDigest({alg:"md5",prov:"cryptojs"}).digestString(e)},le.crypto.Util.ripemd160=function(e){return new le.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"}).digestString(e)},le.crypto.Util.SECURERANDOMGEN=new ee,le.crypto.Util.getRandomHexOfNbytes=function(e){var t=new Array(e);return le.crypto.Util.SECURERANDOMGEN.nextBytes(t),ge(t)},le.crypto.Util.getRandomBigIntegerOfNbytes=function(e){return new S(le.crypto.Util.getRandomHexOfNbytes(e),16)},le.crypto.Util.getRandomHexOfNbits=function(e){var t=e%8,n=new Array((e-t)/8+1);return le.crypto.Util.SECURERANDOMGEN.nextBytes(n),n[0]=(255<<t&255^255)&n[0],ge(n)},le.crypto.Util.getRandomBigIntegerOfNbits=function(e){return new S(le.crypto.Util.getRandomHexOfNbits(e),16)},le.crypto.Util.getRandomBigIntegerZeroToMax=function(e){for(var t=e.bitLength();;){var n=le.crypto.Util.getRandomBigIntegerOfNbits(t);if(-1!=e.compareTo(n))return n}},le.crypto.Util.getRandomBigIntegerMinToMax=function(e,t){var n=e.compareTo(t);if(1==n)throw"biMin is greater than biMax";if(0==n)return e;var r=t.subtract(e);return le.crypto.Util.getRandomBigIntegerZeroToMax(r).add(e)},le.crypto.MessageDigest=function(e){this.setAlgAndProvider=function(e,t){if(null!==(e=le.crypto.MessageDigest.getCanonicalAlgName(e))&&void 0===t&&(t=le.crypto.Util.DEFAULTPROVIDER[e]),-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(e)&&"cryptojs"==t){try{this.md=le.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[e].create()}catch(t){throw"setAlgAndProvider hash alg set fail alg="+e+"/"+t}this.updateString=function(e){this.md.update(e)},this.updateHex=function(e){var t=p.enc.Hex.parse(e);this.md.update(t)},this.digest=function(){return this.md.finalize().toString(p.enc.Hex)},this.digestString=function(e){return this.updateString(e),this.digest()},this.digestHex=function(e){return this.updateHex(e),this.digest()}}if(-1!=":sha256:".indexOf(e)&&"sjcl"==t){try{this.md=new sjcl.hash.sha256}catch(t){throw"setAlgAndProvider hash alg set fail alg="+e+"/"+t}this.updateString=function(e){this.md.update(e)},this.updateHex=function(e){var t=sjcl.codec.hex.toBits(e);this.md.update(t)},this.digest=function(){var e=this.md.finalize();return sjcl.codec.hex.fromBits(e)},this.digestString=function(e){return this.updateString(e),this.digest()},this.digestHex=function(e){return this.updateHex(e),this.digest()}}},this.updateString=function(e){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(e){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(e){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(e){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},void 0!==e&&void 0!==e.alg&&(this.algName=e.alg,void 0===e.prov&&(this.provName=le.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},le.crypto.MessageDigest.getCanonicalAlgName=function(e){return"string"==typeof e&&(e=(e=e.toLowerCase()).replace(/-/,"")),e},le.crypto.MessageDigest.getHashLength=function(e){var t=le.crypto.MessageDigest,n=t.getCanonicalAlgName(e);if(void 0===t.HASHLENGTH[n])throw"not supported algorithm: "+e;return t.HASHLENGTH[n]},le.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20},le.crypto.Mac=function(e){this.setAlgAndProvider=function(e,t){if(null==(e=e.toLowerCase())&&(e="hmacsha1"),"hmac"!=(e=e.toLowerCase()).substr(0,4))throw"setAlgAndProvider unsupported HMAC alg: "+e;void 0===t&&(t=le.crypto.Util.DEFAULTPROVIDER[e]),this.algProv=e+"/"+t;var n=e.substr(4);if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(n)&&"cryptojs"==t){try{var r=le.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[n];this.mac=p.algo.HMAC.create(r,this.pass)}catch(e){throw"setAlgAndProvider hash alg set fail hashAlg="+n+"/"+e}this.updateString=function(e){this.mac.update(e)},this.updateHex=function(e){var t=p.enc.Hex.parse(e);this.mac.update(t)},this.doFinal=function(){return this.mac.finalize().toString(p.enc.Hex)},this.doFinalString=function(e){return this.updateString(e),this.doFinal()},this.doFinalHex=function(e){return this.updateHex(e),this.doFinal()}}},this.updateString=function(e){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(e){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(e){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(e){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(e){if("string"==typeof e){var t=e;return e.length%2!=1&&e.match(/^[0-9A-Fa-f]+$/)||(t=Te(e)),void(this.pass=p.enc.Hex.parse(t))}if("object"!=typeof e)throw"KJUR.crypto.Mac unsupported password type: "+e;if(t=null,void 0!==e.hex){if(e.hex.length%2!=0||!e.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+e.hex;t=e.hex}if(void 0!==e.utf8&&(t=we(e.utf8)),void 0!==e.rstr&&(t=Te(e.rstr)),void 0!==e.b64&&(t=v(e.b64)),void 0!==e.b64u&&(t=Se(e.b64u)),null==t)throw"KJUR.crypto.Mac unsupported password type: "+e;this.pass=p.enc.Hex.parse(t)},void 0!==e&&(void 0!==e.pass&&this.setPassword(e.pass),void 0!==e.alg&&(this.algName=e.alg,void 0===e.prov&&(this.provName=le.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},le.crypto.Signature=function(e){var t=null;if(this._setAlgNames=function(){var e=this.algName.match(/^(.+)with(.+)$/);e&&(this.mdAlgName=e[1].toLowerCase(),this.pubkeyAlgName=e[2].toLowerCase(),"rsaandmgf1"==this.pubkeyAlgName&&"sha"==this.mdAlgName&&(this.mdAlgName="sha1"))},this._zeroPaddingOfSignature=function(e,t){for(var n="",r=t/4-e.length,i=0;i<r;i++)n+="0";return n+e},this.setAlgAndProvider=function(e,t){if(this._setAlgNames(),"cryptojs/jsrsa"!=t)throw new Error("provider not supported: "+t);if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)){try{this.md=new le.crypto.MessageDigest({alg:this.mdAlgName})}catch(e){throw new Error("setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+e)}this.init=function(e,t){var n=null;try{n=void 0===t?it.getKey(e):it.getKey(e,t)}catch(e){throw"init failed:"+e}if(!0===n.isPrivate)this.prvKey=n,this.state="SIGN";else{if(!0!==n.isPublic)throw"init failed.:"+n;this.pubKey=n,this.state="VERIFY"}},this.updateString=function(e){this.md.updateString(e)},this.updateHex=function(e){this.md.updateHex(e)},this.sign=function(){if(this.sHashHex=this.md.digest(),void 0===this.prvKey&&void 0!==this.ecprvhex&&void 0!==this.eccurvename&&void 0!==le.crypto.ECDSA&&(this.prvKey=new le.crypto.ECDSA({curve:this.eccurvename,prv:this.ecprvhex})),this.prvKey instanceof re&&"rsaandmgf1"===this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof re&&"rsa"===this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof le.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else{if(!(this.prvKey instanceof le.crypto.DSA))throw"Signature: unsupported private key alg: "+this.pubkeyAlgName;this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}return this.hSign},this.signString=function(e){return this.updateString(e),this.sign()},this.signHex=function(e){return this.updateHex(e),this.sign()},this.verify=function(e){if(this.sHashHex=this.md.digest(),void 0===this.pubKey&&void 0!==this.ecpubhex&&void 0!==this.eccurvename&&void 0!==le.crypto.ECDSA&&(this.pubKey=new le.crypto.ECDSA({curve:this.eccurvename,pub:this.ecpubhex})),this.pubKey instanceof re&&"rsaandmgf1"===this.pubkeyAlgName)return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,e,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof re&&"rsa"===this.pubkeyAlgName)return this.pubKey.verifyWithMessageHash(this.sHashHex,e);if(void 0!==le.crypto.ECDSA&&this.pubKey instanceof le.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,e);if(void 0!==le.crypto.DSA&&this.pubKey instanceof le.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,e);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(e,t){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.updateString=function(e){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(e){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(e){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(e){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(e){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=e,void 0!==e&&(void 0!==e.alg&&(this.algName=e.alg,void 0===e.prov?this.provName=le.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=e.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),void 0!==e.psssaltlen&&(this.pssSaltLen=e.psssaltlen),void 0!==e.prvkeypem)){if(void 0!==e.prvkeypas)throw"both prvkeypem and prvkeypas parameters not supported";try{t=it.getKey(e.prvkeypem),this.init(t)}catch(e){throw"fatal error to load pem private key: "+e}}},le.crypto.Cipher=function(e){},le.crypto.Cipher.encrypt=function(e,t,n,r){if(null!=nt(r,"enclag")&&(n=r.encalg),"string"==typeof n&&"-CBC"==n.substr(-4)){var i=t,s=e;null!=nt(r,"key")&&(i=r.key),null!=nt(r,"enc")&&(hEnc=r.enc);var o,a=p.enc.Hex.parse(i),c=p.enc.Hex.parse(s),l=p.enc.Hex.parse(r.iv);if("des-EDE3-CBC"==n)o=p.TripleDES.encrypt(c,a,{iv:l});else{if("aes128-CBC"!=n&&"aes256-CBC"!=n)throw new Error("unsupported algorithm: "+n);o=p.AES.encrypt(c,a,{iv:l})}return o+""}if(t instanceof re&&t.isPublic){var u=le.crypto.Cipher.getAlgByKeyAndName(t,n);if("RSA"===u)return t.encrypt(e);if("RSAOAEP"===u)return t.encryptOAEP(e,"sha1");var h=u.match(/^RSAOAEP(\d+)$/);if(null!==h)return t.encryptOAEP(e,"sha"+h[1]);throw"Cipher.encrypt: unsupported algorithm for RSAKey: "+n}throw"Cipher.encrypt: unsupported key or algorithm"},le.crypto.Cipher.decrypt=function(e,t,n,r){if(null!=nt(r,"enclag")&&(n=r.encalg),"string"==typeof n&&"-CBC"==n.substr(-4)){var i=t,s=e;null!=nt(r,"key")&&(i=r.key),null!=nt(r,"enc")&&(s=r.enc);var o,a=p.enc.Hex.parse(i),c=p.enc.Hex.parse(s),l=p.enc.Hex.parse(r.iv);if("des-EDE3-CBC"==n)o=p.TripleDES.decrypt({ciphertext:c},a,{iv:l});else{if("aes128-CBC"!=n&&"aes256-CBC"!=n)throw new Error("unsupported algorithm: "+n);o=p.AES.decrypt({ciphertext:c},a,{iv:l})}return p.enc.Hex.stringify(o)}if(t instanceof re&&t.isPrivate){var u=le.crypto.Cipher.getAlgByKeyAndName(t,n);if("RSA"===u)return t.decrypt(e);if("RSAOAEP"===u)return t.decryptOAEP(e,"sha1");var h=u.match(/^RSAOAEP(\d+)$/);if(null!==h)return t.decryptOAEP(e,"sha"+h[1]);throw"Cipher.decrypt: unsupported algorithm for RSAKey: "+n}throw"Cipher.decrypt: unsupported key or algorithm"},le.crypto.Cipher.getAlgByKeyAndName=function(e,t){if(e instanceof re){if(-1!=":RSA:RSAOAEP:RSAOAEP224:RSAOAEP256:RSAOAEP384:RSAOAEP512:".indexOf(t))return t;if(null==t)return"RSA";throw"getAlgByKeyAndName: not supported algorithm name for RSAKey: "+t}throw"getAlgByKeyAndName: not supported algorithm name: "+t},le.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040022":"secp384r1","2b81040023":"secp521r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}},void 0!==le&&le||(le={}),void 0!==le.crypto&&le.crypto||(le.crypto={}),le.crypto.ECDSA=function(e){var t=Error,n=S,r=oe,i=le.crypto.ECDSA,s=le.crypto.ECParameterDB,o=i.getName,a=de,c=a.getVbyListEx,l=a.isASN1HEX,u=new ee;this.type="EC",this.isPrivate=!1,this.isPublic=!1,this.getBigRandom=function(e){return new n(e.bitLength(),u).mod(e.subtract(n.ONE)).add(n.ONE)},this.setNamedCurve=function(e){this.ecparams=s.getByName(e),this.prvKeyHex=null,this.pubKeyHex=null,this.curveName=e},this.setPrivateKeyHex=function(e){this.isPrivate=!0,this.prvKeyHex=e},this.setPublicKeyHex=function(e){this.isPublic=!0,this.pubKeyHex=e},this.getPublicKeyXYHex=function(){var e=this.pubKeyHex;if("04"!==e.substr(0,2))throw"this method supports uncompressed format(04) only";var t=this.ecparams.keycharlen;if(e.length!==2+2*t)throw"malformed public key hex length";var n={};return n.x=e.substr(2,t),n.y=e.substr(2+t),n},this.getShortNISTPCurveName=function(){var e=this.curveName;return"secp256r1"===e||"NIST P-256"===e||"P-256"===e||"prime256v1"===e?"P-256":"secp384r1"===e||"NIST P-384"===e||"P-384"===e?"P-384":"secp521r1"===e||"NIST P-521"===e||"P-521"===e?"P-521":null},this.generateKeyPairHex=function(){var e=this.ecparams.n,t=this.getBigRandom(e),n=this.ecparams.keycharlen,r=("0000000000"+t.toString(16)).slice(-n);return this.setPrivateKeyHex(r),{ecprvhex:r,ecpubhex:this.generatePublicKeyHex()}},this.generatePublicKeyHex=function(){var e=new n(this.prvKeyHex,16),t=this.ecparams.G.multiply(e),r=t.getX().toBigInteger(),i=t.getY().toBigInteger(),s=this.ecparams.keycharlen,o="04"+("0000000000"+r.toString(16)).slice(-s)+("0000000000"+i.toString(16)).slice(-s);return this.setPublicKeyHex(o),o},this.signWithMessageHash=function(e){return this.signHex(e,this.prvKeyHex)},this.signHex=function(e,t){var r=new n(t,16),s=this.ecparams.n,o=new n(e.substring(0,this.ecparams.keycharlen),16);do{var a=this.getBigRandom(s),c=this.ecparams.G.multiply(a).getX().toBigInteger().mod(s)}while(c.compareTo(n.ZERO)<=0);var l=a.modInverse(s).multiply(o.add(r.multiply(c))).mod(s);return i.biRSSigToASN1Sig(c,l)},this.sign=function(e,t){var r=t,i=this.ecparams.n,s=n.fromByteArrayUnsigned(e);do{var o=this.getBigRandom(i),a=this.ecparams.G.multiply(o).getX().toBigInteger().mod(i)}while(a.compareTo(S.ZERO)<=0);var c=o.modInverse(i).multiply(s.add(r.multiply(a))).mod(i);return this.serializeSig(a,c)},this.verifyWithMessageHash=function(e,t){return this.verifyHex(e,t,this.pubKeyHex)},this.verifyHex=function(e,t,s){try{var o,a,c=i.parseSigHex(t);o=c.r,a=c.s;var l=r.decodeFromHex(this.ecparams.curve,s),u=new n(e.substring(0,this.ecparams.keycharlen),16);return this.verifyRaw(u,o,a,l)}catch(e){return!1}},this.verify=function(e,t,i){var s,o,a;if(Bitcoin.Util.isArray(t)){var c=this.parseSig(t);s=c.r,o=c.s}else{if("object"!=typeof t||!t.r||!t.s)throw"Invalid value for signature";s=t.r,o=t.s}if(i instanceof oe)a=i;else{if(!Bitcoin.Util.isArray(i))throw"Invalid format for pubkey value, must be byte array or ECPointFp";a=r.decodeFrom(this.ecparams.curve,i)}var l=n.fromByteArrayUnsigned(e);return this.verifyRaw(l,s,o,a)},this.verifyRaw=function(e,t,r,i){var s=this.ecparams.n,o=this.ecparams.G;if(t.compareTo(n.ONE)<0||t.compareTo(s)>=0)return!1;if(r.compareTo(n.ONE)<0||r.compareTo(s)>=0)return!1;var a=r.modInverse(s),c=e.multiply(a).mod(s),l=t.multiply(a).mod(s);return o.multiply(c).add(i.multiply(l)).getX().toBigInteger().mod(s).equals(t)},this.serializeSig=function(e,t){var n=e.toByteArraySigned(),r=t.toByteArraySigned(),i=[];return i.push(2),i.push(n.length),(i=i.concat(n)).push(2),i.push(r.length),(i=i.concat(r)).unshift(i.length),i.unshift(48),i},this.parseSig=function(e){var t;if(48!=e[0])throw new Error("Signature not a valid DERSequence");if(2!=e[t=2])throw new Error("First element in signature must be a DERInteger");var r=e.slice(t+2,t+2+e[t+1]);if(2!=e[t+=2+e[t+1]])throw new Error("Second element in signature must be a DERInteger");var i=e.slice(t+2,t+2+e[t+1]);return t+=2+e[t+1],{r:n.fromByteArrayUnsigned(r),s:n.fromByteArrayUnsigned(i)}},this.parseSigCompact=function(e){if(65!==e.length)throw"Signature has the wrong length";var t=e[0]-27;if(t<0||t>7)throw"Invalid signature type";var r=this.ecparams.n;return{r:n.fromByteArrayUnsigned(e.slice(1,33)).mod(r),s:n.fromByteArrayUnsigned(e.slice(33,65)).mod(r),i:t}},this.readPKCS5PrvKeyHex=function(e){if(!1===l(e))throw new Error("not ASN.1 hex string");var t,n,r;try{t=c(e,0,["[0]",0],"06"),n=c(e,0,[1],"04");try{r=c(e,0,["[1]",0],"03")}catch(e){}}catch(e){throw new Error("malformed PKCS#1/5 plain ECC private key")}if(this.curveName=o(t),void 0===this.curveName)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(r),this.setPrivateKeyHex(n),this.isPublic=!1},this.readPKCS8PrvKeyHex=function(e){if(!1===l(e))throw new t("not ASN.1 hex string");var n,r,i;try{c(e,0,[1,0],"06"),n=c(e,0,[1,1],"06"),r=c(e,0,[2,0,1],"04");try{i=c(e,0,[2,0,"[1]",0],"03")}catch(e){}}catch(e){throw new t("malformed PKCS#8 plain ECC private key")}if(this.curveName=o(n),void 0===this.curveName)throw new t("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(i),this.setPrivateKeyHex(r),this.isPublic=!1},this.readPKCS8PubKeyHex=function(e){if(!1===l(e))throw new t("not ASN.1 hex string");var n,r;try{c(e,0,[0,0],"06"),n=c(e,0,[0,1],"06"),r=c(e,0,[1],"03")}catch(e){throw new t("malformed PKCS#8 ECC public key")}if(this.curveName=o(n),null===this.curveName)throw new t("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(r)},this.readCertPubKeyHex=function(e,n){if(!1===l(e))throw new t("not ASN.1 hex string");var r,i;try{r=c(e,0,[0,5,0,1],"06"),i=c(e,0,[0,5,1],"03")}catch(e){throw new t("malformed X.509 certificate ECC public key")}if(this.curveName=o(r),null===this.curveName)throw new t("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(i)},void 0!==e&&void 0!==e.curve&&(this.curveName=e.curve),void 0===this.curveName&&(this.curveName="secp256r1"),this.setNamedCurve(this.curveName),void 0!==e&&(void 0!==e.prv&&this.setPrivateKeyHex(e.prv),void 0!==e.pub&&this.setPublicKeyHex(e.pub))},le.crypto.ECDSA.parseSigHex=function(e){var t=le.crypto.ECDSA.parseSigHexInHexRS(e);return{r:new S(t.r,16),s:new S(t.s,16)}},le.crypto.ECDSA.parseSigHexInHexRS=function(e){var t=de,n=t.getChildIdx,r=t.getV;if(t.checkStrictDER(e,0),"30"!=e.substr(0,2))throw new Error("signature is not a ASN.1 sequence");var i=n(e,0);if(2!=i.length)throw new Error("signature shall have two elements");var s=i[0],o=i[1];if("02"!=e.substr(s,2))throw new Error("1st item not ASN.1 integer");if("02"!=e.substr(o,2))throw new Error("2nd item not ASN.1 integer");return{r:r(e,s),s:r(e,o)}},le.crypto.ECDSA.asn1SigToConcatSig=function(e){var t=le.crypto.ECDSA.parseSigHexInHexRS(e),n=t.r,r=t.s;if(n.length>=130&&n.length<=134){if(n.length%2!=0)throw Error("unknown ECDSA sig r length error");if(r.length%2!=0)throw Error("unknown ECDSA sig s length error");"00"==n.substr(0,2)&&(n=n.substr(2)),"00"==r.substr(0,2)&&(r=r.substr(2));var i=Math.max(n.length,r.length);return(n=("000000"+n).slice(-i))+("000000"+r).slice(-i)}if("00"==n.substr(0,2)&&n.length%32==2&&(n=n.substr(2)),"00"==r.substr(0,2)&&r.length%32==2&&(r=r.substr(2)),n.length%32==30&&(n="00"+n),r.length%32==30&&(r="00"+r),n.length%32!=0)throw Error("unknown ECDSA sig r length error");if(r.length%32!=0)throw Error("unknown ECDSA sig s length error");return n+r},le.crypto.ECDSA.concatSigToASN1Sig=function(e){if(e.length%4!=0)throw Error("unknown ECDSA concatinated r-s sig length error");var t=e.substr(0,e.length/2),n=e.substr(e.length/2);return le.crypto.ECDSA.hexRSSigToASN1Sig(t,n)},le.crypto.ECDSA.hexRSSigToASN1Sig=function(e,t){var n=new S(e,16),r=new S(t,16);return le.crypto.ECDSA.biRSSigToASN1Sig(n,r)},le.crypto.ECDSA.biRSSigToASN1Sig=function(e,t){var n=le.asn1,r=new n.DERInteger({bigint:e}),i=new n.DERInteger({bigint:t});return new n.DERSequence({array:[r,i]}).tohex()},le.crypto.ECDSA.getName=function(e){return"2b8104001f"===e?"secp192k1":"2a8648ce3d030107"===e?"secp256r1":"2b8104000a"===e?"secp256k1":"2b81040021"===e?"secp224r1":"2b81040022"===e?"secp384r1":"2b81040023"===e?"secp521r1":-1!=="|secp256r1|NIST P-256|P-256|prime256v1|".indexOf(e)?"secp256r1":-1!=="|secp256k1|".indexOf(e)?"secp256k1":-1!=="|secp224r1|NIST P-224|P-224|".indexOf(e)?"secp224r1":-1!=="|secp384r1|NIST P-384|P-384|".indexOf(e)?"secp384r1":-1!=="|secp521r1|NIST P-521|P-521|".indexOf(e)?"secp521r1":null},void 0!==le&&le||(le={}),void 0!==le.crypto&&le.crypto||(le.crypto={}),le.crypto.ECParameterDB=new function(){var e={},t={};function n(e){return new S(e,16)}this.getByName=function(n){var r=n;if(void 0!==t[r]&&(r=t[n]),void 0!==e[r])return e[r];throw"unregistered EC curve name: "+r},this.regist=function(r,i,s,o,a,c,l,u,h,d,p,f){e[r]={};var g=n(s),m=n(o),y=n(a),v=n(c),b=n(l),S=new ae(g,m,y),w=S.decodePointHex("04"+u+h);e[r].name=r,e[r].keylen=i,e[r].keycharlen=2*Math.ceil(i/8),e[r].curve=S,e[r].G=w,e[r].n=v,e[r].h=b,e[r].oid=p,e[r].info=f;for(var x=0;x<d.length;x++)t[d[x]]=r}},le.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field"),le.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field"),le.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field"),le.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]),le.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]),le.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]),le.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]),le.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]),le.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7","3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]),le.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409","1","00C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]),void 0!==le&&le||(le={}),void 0!==le.crypto&&le.crypto||(le.crypto={}),le.crypto.DSA=function(){var e=de,t=(e.getVbyList,e.getVbyListEx),n=e.isASN1HEX,r=S;this.p=null,this.q=null,this.g=null,this.y=null,this.x=null,this.type="DSA",this.isPrivate=!1,this.isPublic=!1,this.setPrivate=function(e,t,n,r,i){this.isPrivate=!0,this.p=e,this.q=t,this.g=n,this.y=r,this.x=i},this.setPrivateHex=function(e,t,n,r,i){var s,o,a,c,l;s=new S(e,16),o=new S(t,16),a=new S(n,16),c="string"==typeof r&&r.length>1?new S(r,16):null,l=new S(i,16),this.setPrivate(s,o,a,c,l)},this.setPublic=function(e,t,n,r){this.isPublic=!0,this.p=e,this.q=t,this.g=n,this.y=r,this.x=null},this.setPublicHex=function(e,t,n,r){var i,s,o,a;i=new S(e,16),s=new S(t,16),o=new S(n,16),a=new S(r,16),this.setPublic(i,s,o,a)},this.signWithMessageHash=function(e){var t=this.p,n=this.q,r=this.g,i=(this.y,this.x),s=le.crypto.Util.getRandomBigIntegerMinToMax(S.ONE.add(S.ONE),n.subtract(S.ONE)),o=new S(e.substr(0,n.bitLength()/4),16),a=r.modPow(s,t).mod(n),c=s.modInverse(n).multiply(o.add(i.multiply(a))).mod(n);return le.asn1.ASN1Util.jsonToASN1HEX({seq:[{int:{bigint:a}},{int:{bigint:c}}]})},this.verifyWithMessageHash=function(e,t){var n=this.p,r=this.q,i=this.g,s=this.y,o=this.parseASN1Signature(t),a=o[0],c=o[1],l=new S(e.substr(0,r.bitLength()/4),16);if(S.ZERO.compareTo(a)>0||a.compareTo(r)>0)throw"invalid DSA signature";if(S.ZERO.compareTo(c)>=0||c.compareTo(r)>0)throw"invalid DSA signature";var u=c.modInverse(r),h=l.multiply(u).mod(r),d=a.multiply(u).mod(r);return 0==i.modPow(h,n).multiply(s.modPow(d,n)).mod(n).mod(r).compareTo(a)},this.parseASN1Signature=function(e){try{return[new r(t(e,0,[0],"02"),16),new r(t(e,0,[1],"02"),16)]}catch(e){throw new Error("malformed ASN.1 DSA signature")}},this.readPKCS5PrvKeyHex=function(e){var r,i,s,o,a;if(!1===n(e))throw new Error("not ASN.1 hex string");try{r=t(e,0,[1],"02"),i=t(e,0,[2],"02"),s=t(e,0,[3],"02"),o=t(e,0,[4],"02"),a=t(e,0,[5],"02")}catch(e){throw new Error("malformed PKCS#1/5 plain DSA private key")}this.setPrivateHex(r,i,s,o,a)},this.readPKCS8PrvKeyHex=function(e){var r,i,s,o;if(!1===n(e))throw new Error("not ASN.1 hex string");try{r=t(e,0,[1,1,0],"02"),i=t(e,0,[1,1,1],"02"),s=t(e,0,[1,1,2],"02"),o=t(e,0,[2,0],"02")}catch(e){throw new Error("malformed PKCS#8 plain DSA private key")}this.setPrivateHex(r,i,s,null,o)},this.readPKCS8PubKeyHex=function(e){var r,i,s,o;if(!1===n(e))throw new Error("not ASN.1 hex string");try{r=t(e,0,[0,1,0],"02"),i=t(e,0,[0,1,1],"02"),s=t(e,0,[0,1,2],"02"),o=t(e,0,[1,0],"02")}catch(e){throw new Error("malformed PKCS#8 DSA public key")}this.setPublicHex(r,i,s,o)},this.readCertPubKeyHex=function(e,r){var i,s,o,a;if(!1===n(e))throw new Error("not ASN.1 hex string");try{i=t(e,0,[0,5,0,1,0],"02"),s=t(e,0,[0,5,0,1,1],"02"),o=t(e,0,[0,5,0,1,2],"02"),a=t(e,0,[0,5,1,0],"02")}catch(e){throw new Error("malformed X.509 certificate DSA public key")}this.setPublicHex(i,s,o,a)}};var it=function(){var e=function(e,n,r){return t(p.AES,e,n,r)},t=function(e,t,n,r){var i=p.enc.Hex.parse(t),s=p.enc.Hex.parse(n),o=p.enc.Hex.parse(r),a={};a.key=s,a.iv=o,a.ciphertext=i;var c=e.decrypt(a,s,{iv:o});return p.enc.Hex.stringify(c)},n=function(e,t,n){return r(p.AES,e,t,n)},r=function(e,t,n,r){var i=p.enc.Hex.parse(t),s=p.enc.Hex.parse(n),o=p.enc.Hex.parse(r),a=e.encrypt(i,s,{iv:o}),c=p.enc.Hex.parse(a.toString());return p.enc.Base64.stringify(c)},i={"AES-256-CBC":{proc:e,eproc:n,keylen:32,ivlen:16},"AES-192-CBC":{proc:e,eproc:n,keylen:24,ivlen:16},"AES-128-CBC":{proc:e,eproc:n,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:function(e,n,r){return t(p.TripleDES,e,n,r)},eproc:function(e,t,n){return r(p.TripleDES,e,t,n)},keylen:24,ivlen:8},"DES-CBC":{proc:function(e,n,r){return t(p.DES,e,n,r)},eproc:function(e,t,n){return r(p.DES,e,t,n)},keylen:8,ivlen:8}},s=function(e){var t={},n=e.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));n&&(t.cipher=n[1],t.ivsalt=n[2]);var r=e.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));r&&(t.type=r[1]);var i=-1,s=0;-1!=e.indexOf("\r\n\r\n")&&(i=e.indexOf("\r\n\r\n"),s=2),-1!=e.indexOf("\n\n")&&(i=e.indexOf("\n\n"),s=1);var o=e.indexOf("-----END");if(-1!=i&&-1!=o){var a=e.substring(i+2*s,o-s);a=a.replace(/\s+/g,""),t.data=a}return t},o=function(e,t,n){for(var r=n.substring(0,16),s=p.enc.Hex.parse(r),o=p.enc.Utf8.parse(t),a=i[e].keylen+i[e].ivlen,c="",l=null;;){var u=p.algo.MD5.create();if(null!=l&&u.update(l),u.update(o),u.update(s),l=u.finalize(),(c+=p.enc.Hex.stringify(l)).length>=2*a)break}var h={};return h.keyhex=c.substr(0,2*i[e].keylen),h.ivhex=c.substr(2*i[e].keylen,2*i[e].ivlen),h},a=function(e,t,n,r){var s=p.enc.Base64.parse(e),o=p.enc.Hex.stringify(s);return(0,i[t].proc)(o,n,r)};return{version:"1.0.0",parsePKCS5PEM:function(e){return s(e)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(e,t,n){return o(e,t,n)},decryptKeyB64:function(e,t,n,r){return a(e,t,n,r)},getDecryptedKeyHex:function(e,t){var n=s(e),r=(n.type,n.cipher),i=n.ivsalt,c=n.data,l=o(r,t,i).keyhex;return a(c,r,l,i)},getEncryptedPKCS5PEMFromPrvKeyHex:function(e,t,n,r,s){var a="";if(void 0!==r&&null!=r||(r="AES-256-CBC"),void 0===i[r])throw new Error("KEYUTIL unsupported algorithm: "+r);if(void 0===s||null==s){var c=function(e){var t=p.lib.WordArray.random(e);return p.enc.Hex.stringify(t)}(i[r].ivlen);s=c.toUpperCase()}var l=function(e,t,n,r){return(0,i[t].eproc)(e,n,r)}(t,r,o(r,n,s).keyhex,s);return a="-----BEGIN "+e+" PRIVATE KEY-----\r\n",a+="Proc-Type: 4,ENCRYPTED\r\n",a+="DEK-Info: "+r+","+s+"\r\n",a+="\r\n",(a+=l.replace(/(.{64})/g,"$1\r\n"))+"\r\n-----END "+e+" PRIVATE KEY-----\r\n"},getEncryptedPKCS8PEM:function(e,t,n){return Oe(this.getEncryptedPKCS8Hex(e,t,n),"ENCRYPTED PRIVATE KEY")},getEncryptedPKCS8Hex:function(e,t,n){var r;(r=null==n||null==n?{}:JSON.parse(JSON.stringify(n))).plain=e,this.initPBES2Param(r),this.encryptPBES2Param(r,t);var i=this.generatePBES2ASN1Param(r);return le.asn1.ASN1Util.newObject(i).tohex()},initPBES2Param:function(e){var t;null==nt(e,"encalg")&&(e.encalg="aes256-CBC"),null==nt(e,"iter")&&(e.iter=2048),null==nt(e,"prf")&&(e.prf="hmacWithSHA256"),null==nt(e,"salt")&&(e.salt=p.enc.Hex.stringify(p.lib.WordArray.random(8))),null==nt(e,"enciv")&&("des-EDE3-CBC"==e.encalg&&(t=8),"aes128-CBC"==e.encalg&&(t=16),"aes256-CBC"==e.encalg&&(t=16),e.enciv=p.enc.Hex.stringify(p.lib.WordArray.random(t)))},encryptPBES2Param:function(e,t){var n=it.getDKFromPBES2Param(e,t);try{var r=le.crypto.Cipher.encrypt(e.plain,n,e.encalg,{iv:e.enciv})}catch(t){throw new Error("encrypt error: "+e.plain+" "+n+" "+e.encalg+" "+e.enciv)}e.enc=r},generatePBES2ASN1Param:function(e){var t={seq:[{seq:[{oid:"pkcs5PBES2"},{seq:[{seq:[{oid:"pkcs5PBKDF2"},{seq:[{octstr:{hex:e.salt}},{int:{hex:Je(e.iter)}}]}]},{seq:[{oid:e.encalg},{octstr:{hex:e.enciv}}]}]}]},{octstr:{hex:e.enc}}]};return"hmacWithSHA1"!=e.prf&&t.seq[0].seq[1].seq[0].seq[1].seq.push({seq:[{oid:e.prf},{null:""}]}),t},parseHexOfEncryptedPKCS8:function(e){var t=de,n=t.getChildIdx,r=t.getV,i={},s=n(e,0);if(2!=s.length)throw new Error("malformed format: SEQUENCE(0).items != 2: "+s.length);i.ciphertext=r(e,s[1]);var o=n(e,s[0]);if(2!=o.length)throw new Error("malformed format: SEQUENCE(0.0).items != 2: "+o.length);if("2a864886f70d01050d"!=r(e,o[0]))throw new Error("this only supports pkcs5PBES2");var a=n(e,o[1]);if(2!=o.length)throw new Error("malformed format: SEQUENCE(0.0.1).items != 2: "+a.length);var c=n(e,a[1]);if(2!=c.length)throw new Error("malformed format: SEQUENCE(0.0.1.1).items != 2: "+c.length);if("2a864886f70d0307"!=r(e,c[0]))throw"this only supports TripleDES";i.encryptionSchemeAlg="TripleDES",i.encryptionSchemeIV=r(e,c[1]);var l=n(e,a[0]);if(2!=l.length)throw new Error("malformed format: SEQUENCE(0.0.1.0).items != 2: "+l.length);if("2a864886f70d01050c"!=r(e,l[0]))throw new Error("this only supports pkcs5PBKDF2");var u=n(e,l[1]);if(u.length<2)throw new Error("malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+u.length);i.pbkdf2Salt=r(e,u[0]);var h=r(e,u[1]);try{i.pbkdf2Iter=parseInt(h,16)}catch(e){throw new Error("malformed format pbkdf2Iter: "+h)}return i},getPBKDF2KeyHexFromParam:function(e,t){var n=p.enc.Hex.parse(e.pbkdf2Salt),r=e.pbkdf2Iter,i=p.PBKDF2(t,n,{keySize:6,iterations:r});return p.enc.Hex.stringify(i)},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(e,t){var n=Pe(e,"ENCRYPTED PRIVATE KEY"),r=this.parseHexOfEncryptedPKCS8(n),i=it.getPBKDF2KeyHexFromParam(r,t),s={};s.ciphertext=p.enc.Hex.parse(r.ciphertext);var o=p.enc.Hex.parse(i),a=p.enc.Hex.parse(r.encryptionSchemeIV),c=p.TripleDES.decrypt(s,o,{iv:a});return p.enc.Hex.stringify(c)},parsePBES2:function(e){var t=de.parse(e);if("pkcs5PBES2"!=nt(t,"seq.0.seq.0.oid")||"pkcs5PBKDF2"!=nt(t,"seq.0.seq.1.seq.0.seq.0.oid"))throw new Error("not pkcs5PBES2 and pkcs5PBKDF2 used");var n=nt(t,"seq.0.seq.1.seq.0.seq.1.seq");if(null==n)throw new Error("PBKDF2 parameter not found");var r=nt(n,"0.octstr.hex"),i=nt(n,"1.int.hex"),s=nt(n,"2.seq.0.oid","hmacWithSHA1"),o=-1;try{o=parseInt(i,16)}catch(e){throw new Error("iter not proper value")}var a=nt(t,"seq.0.seq.1.seq.1.seq.0.oid"),c=nt(t,"seq.0.seq.1.seq.1.seq.1.octstr.hex"),l=nt(t,"seq.1.octstr.hex");if(null==a||null==c||null==l)throw new Error("encalg, enciv or enc is undefined");return{salt:r,iter:o,prf:s,encalg:a,enciv:c,enc:l}},getDKFromPBES2Param:function(e,t){var n={hmacWithSHA1:p.algo.SHA1,hmacWithSHA224:p.algo.SHA224,hmacWithSHA256:p.algo.SHA256,hmacWithSHA384:p.algo.SHA384,hmacWithSHA512:p.algo.SHA512}[e.prf];if(null==n)throw new Error("unsupported prf");var r={"des-EDE3-CBC":6,"aes128-CBC":4,"aes256-CBC":8}[e.encalg];if(null==r)throw new Error("unsupported encalg");var i=p.enc.Hex.parse(e.salt),s=e.iter;try{var o=p.PBKDF2(t,i,{keySize:r,iterations:s,hasher:n});return p.enc.Hex.stringify(o)}catch(n){throw new Error("PBKDF2 error: "+n+" "+JSON.stringify(e)+" "+t)}},getPlainHexFromEncryptedPKCS8PEM:function(e,t){if(-1==e.indexOf("BEGIN ENCRYPTED PRIVATE KEY"))throw new Error("not Encrypted PKCS#8 PEM string");var n,r=Pe(e);try{n=it.parsePBES2(r)}catch(e){throw new Error("malformed PBES2 format: "+e.message)}var i=it.getDKFromPBES2Param(n,t);return le.crypto.Cipher.decrypt(n.enc,i,n.encalg,{iv:n.enciv})},getKeyFromEncryptedPKCS8PEM:function(e,t){var n=this.getPlainHexFromEncryptedPKCS8PEM(e,t);return this.getKeyFromPlainPrivatePKCS8Hex(n)},parsePlainPrivatePKCS8Hex:function(e){var t=de,n=t.getChildIdx,r=t.getV,i={algparam:null};if("30"!=e.substr(0,2))throw new Error("malformed plain PKCS8 private key(code:001)");var s=n(e,0);if(s.length<3)throw new Error("malformed plain PKCS8 private key(code:002)");if("30"!=e.substr(s[1],2))throw new Error("malformed PKCS8 private key(code:003)");var o=n(e,s[1]);if(2!=o.length)throw new Error("malformed PKCS8 private key(code:004)");if("06"!=e.substr(o[0],2))throw new Error("malformed PKCS8 private key(code:005)");if(i.algoid=r(e,o[0]),"06"==e.substr(o[1],2)&&(i.algparam=r(e,o[1])),"04"!=e.substr(s[2],2))throw new Error("malformed PKCS8 private key(code:006)");return i.keyidx=t.getVidx(e,s[2]),i},getKeyFromPlainPrivatePKCS8PEM:function(e){var t=Pe(e,"PRIVATE KEY");return this.getKeyFromPlainPrivatePKCS8Hex(t)},getKeyFromPlainPrivatePKCS8Hex:function(e){var t,n=this.parsePlainPrivatePKCS8Hex(e);if("2a864886f70d010101"==n.algoid)t=new re;else if("2a8648ce380401"==n.algoid)t=new le.crypto.DSA;else{if("2a8648ce3d0201"!=n.algoid)throw new Error("unsupported private key algorithm");t=new le.crypto.ECDSA}return t.readPKCS8PrvKeyHex(e),t},_getKeyFromPublicPKCS8Hex:function(e){var t,n=de.getVbyList(e,0,[0,0],"06");if("2a864886f70d010101"===n)t=new re;else if("2a8648ce380401"===n)t=new le.crypto.DSA;else{if("2a8648ce3d0201"!==n)throw new Error("unsupported PKCS#8 public key hex");t=new le.crypto.ECDSA}return t.readPKCS8PubKeyHex(e),t},parsePublicRawRSAKeyHex:function(e){var t=de,n=t.getChildIdx,r=t.getV,i={};if("30"!=e.substr(0,2))throw new Error("malformed RSA key(code:001)");var s=n(e,0);if(2!=s.length)throw new Error("malformed RSA key(code:002)");if("02"!=e.substr(s[0],2))throw new Error("malformed RSA key(code:003)");if(i.n=r(e,s[0]),"02"!=e.substr(s[1],2))throw new Error("malformed RSA key(code:004)");return i.e=r(e,s[1]),i},parsePublicPKCS8Hex:function(e){var t=de,n=t.getChildIdx,r=t.getV,i={algparam:null},s=n(e,0);if(2!=s.length)throw new Error("outer DERSequence shall have 2 elements: "+s.length);var o=s[0];if("30"!=e.substr(o,2))throw new Error("malformed PKCS8 public key(code:001)");var a=n(e,o);if(2!=a.length)throw new Error("malformed PKCS8 public key(code:002)");if("06"!=e.substr(a[0],2))throw new Error("malformed PKCS8 public key(code:003)");if(i.algoid=r(e,a[0]),"06"==e.substr(a[1],2)?i.algparam=r(e,a[1]):"30"==e.substr(a[1],2)&&(i.algparam={},i.algparam.p=t.getVbyList(e,a[1],[0],"02"),i.algparam.q=t.getVbyList(e,a[1],[1],"02"),i.algparam.g=t.getVbyList(e,a[1],[2],"02")),"03"!=e.substr(s[1],2))throw new Error("malformed PKCS8 public key(code:004)");return i.key=r(e,s[1]).substr(2),i}}}();function st(e,t){for(var n="",r=t/4-e.length,i=0;i<r;i++)n+="0";return n+e}function ot(e,t,n){for(var r="",i=0;r.length<t;)r+=Ee(n(Te(e+String.fromCharCode.apply(String,[(4278190080&i)>>24,(16711680&i)>>16,(65280&i)>>8,255&i])))),i+=1;return r}function at(e){for(var t in le.crypto.Util.DIGESTINFOHEAD){var n=le.crypto.Util.DIGESTINFOHEAD[t],r=n.length;if(e.substring(0,r)==n)return[t,e.substring(r)]}return[]}function ct(e){var t,n=de,r=n.getChildIdx,i=n.getV,s=(n.dump,n.parse),o=n.getTLV,a=n.getVbyList,c=n.getVbyListEx,l=n.getTLVbyList,u=n.getTLVbyListEx,h=n.getIdxbyList,d=n.getIdxbyListEx,p=n.getVidx,f=n.getInt,g=n.oidname,m=n.hextooidstr,y=Pe,v=Error;try{t=le.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch(e){}this.HEX2STAG={"0c":"utf8",13:"prn",16:"ia5","1a":"vis","1e":"bmp"},this.hex=null,this.version=0,this.foffset=0,this.aExtInfo=null,this.getVersion=function(){if(null===this.hex||0!==this.version)return this.version;var e=l(this.hex,0,[0,0]);if("a0"==e.substr(0,2)){var t=l(e,0,[0]),n=f(t,0);if(n<0||2<n)throw new Error("malformed version field");return this.version=n+1,this.version}return this.version=1,this.foffset=-1,1},this.getSerialNumberHex=function(){return c(this.hex,0,[0,0],"02")},this.getSignatureAlgorithmField=function(){var e=u(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(e)},this.getAlgorithmIdentifierName=function(e){for(var n in t)if(e===t[n])return n;return g(c(e,0,[0],"06"))},this.getIssuer=function(e,t){return this.getX500Name(this.getIssuerHex(),e,t)},this.getIssuerHex=function(){return l(this.hex,0,[0,3+this.foffset],"30")},this.getIssuerString=function(){return this.getIssuer().str},this.getSubject=function(e,t){return this.getX500Name(this.getSubjectHex(),e,t)},this.getSubjectHex=function(){return l(this.hex,0,[0,5+this.foffset],"30")},this.getSubjectString=function(){return this.getSubject().str},this.getNotBefore=function(){var e=a(this.hex,0,[0,4+this.foffset,0]);return e=e.replace(/(..)/g,"%$1"),decodeURIComponent(e)},this.getNotAfter=function(){var e=a(this.hex,0,[0,4+this.foffset,1]);return e=e.replace(/(..)/g,"%$1"),decodeURIComponent(e)},this.getPublicKeyHex=function(){return this.getSPKI()},this.getSPKI=function(){return l(this.hex,0,[0,6+this.foffset],"30")},this.getSPKIValue=function(){var e=this.getSPKI();return null==e?null:a(e,0,[1],"03",!0)},this.getPublicKeyIdx=function(){return h(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyContentIdx=function(){var e=this.getPublicKeyIdx();return h(this.hex,e,[1,0],"30")},this.getPublicKey=function(){return it.getKey(this.getPublicKeyHex(),null,"pkcs8pub")},this.getSignatureAlgorithmName=function(){var e=l(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(e)},this.getSignatureValueHex=function(){return a(this.hex,0,[2],"03",!0)},this.verifySignature=function(e){var t=this.getSignatureAlgorithmField(),n=this.getSignatureValueHex(),r=l(this.hex,0,[0],"30"),i=new le.crypto.Signature({alg:t});return i.init(e),i.updateHex(r),i.verify(n)},this.parseExt=function(e){var t,s,o;if(void 0===e){if(o=this.hex,3!==this.version)return-1;t=h(o,0,[0,7,0],"30"),s=r(o,t)}else{o=Pe(e);var c=h(o,0,[0,3,0,0],"06");if("2a864886f70d01090e"!=i(o,c))return void(this.aExtInfo=new Array);t=h(o,0,[0,3,0,1,0],"30"),s=r(o,t),this.hex=o}this.aExtInfo=new Array;for(var l=0;l<s.length;l++){var u={critical:!1},d=0;3===r(o,s[l]).length&&(u.critical=!0,d=1),u.oid=n.hextooidstr(a(o,s[l],[0],"06"));var f=h(o,s[l],[1+d]);u.vidx=p(o,f),this.aExtInfo.push(u)}},this.getExtInfo=function(e){var t=this.aExtInfo,n=e;if(e.match(/^[0-9.]+$/)||(n=le.asn1.x509.OID.name2oid(e)),""!==n)for(var r=0;r<t.length;r++)if(t[r].oid===n)return t[r]},this.getCriticalExtV=function(e,t,n){if(null!=t)return[t,n];var r=this.getExtInfo(e);return null==r?[null,null]:[o(this.hex,r.vidx),r.critical]},this.getExtBasicConstraints=function(e,t){if(void 0===e&&void 0===t){var n=this.getExtInfo("basicConstraints");if(void 0===n)return;e=o(this.hex,n.vidx),t=n.critical}var r={extname:"basicConstraints"};if(t&&(r.critical=!0),"3000"===e)return r;if("30030101ff"===e)return r.cA=!0,r;if("30060101ff02"===e.substr(0,12)){var s=i(e,10),a=parseInt(s,16);return r.cA=!0,r.pathLen=a,r}throw new Error("hExtV parse error: "+e)},this.getExtNameConstraints=function(e,t){var n=this.getCriticalExtV("nameConstraints",e,t);if(e=n[0],t=n[1],null!=e){var i={extname:"nameConstraints"};t&&(i.critical=!0);for(var s=r(e,0),a=0;a<s.length;a++){for(var c=[],l=r(e,s[a]),u=0;u<l.length;u++){var h=o(e,l[u]),d=this.getGeneralSubtree(h);c.push(d)}var p=e.substr(s[a],2);"a0"==p?i.permit=c:"a1"==p&&(i.exclude=c)}return i}},this.getGeneralSubtree=function(e){var t=r(e,0),n=t.length;if(n<1||2<n)throw new Error("wrong num elements");for(var s=this.getGeneralName(o(e,t[0])),a=1;a<n;a++){var c=e.substr(t[a],2),l=i(e,t[a]),u=parseInt(l,16);"80"==c&&(s.min=u),"81"==c&&(s.max=u)}return s},this.getExtKeyUsage=function(e,t){var n=this.getCriticalExtV("keyUsage",e,t);if(e=n[0],t=n[1],null!=e){var r={extname:"keyUsage"};return t&&(r.critical=!0),r.names=this.getExtKeyUsageString(e).split(","),r}},this.getExtKeyUsageBin=function(e){if(void 0===e){var t=this.getExtInfo("keyUsage");if(void 0===t)return"";e=o(this.hex,t.vidx)}if(8!=e.length&&10!=e.length)throw new Error("malformed key usage value: "+e);var n="000000000000000"+parseInt(e.substr(6),16).toString(2);return 8==e.length&&(n=n.slice(-8)),10==e.length&&(n=n.slice(-16)),""==(n=n.replace(/0+$/,""))&&(n="0"),n},this.getExtKeyUsageString=function(e){for(var t=this.getExtKeyUsageBin(e),n=new Array,r=0;r<t.length;r++)"1"==t.substr(r,1)&&n.push(ct.KEYUSAGE_NAME[r]);return n.join(",")},this.getExtSubjectKeyIdentifier=function(e,t){if(void 0===e&&void 0===t){var n=this.getExtInfo("subjectKeyIdentifier");if(void 0===n)return;e=o(this.hex,n.vidx),t=n.critical}var r={extname:"subjectKeyIdentifier"};t&&(r.critical=!0);var s=i(e,0);return r.kid={hex:s},r},this.getExtAuthorityKeyIdentifier=function(e,t){if(void 0===e&&void 0===t){var n=this.getExtInfo("authorityKeyIdentifier");if(void 0===n)return;e=o(this.hex,n.vidx),t=n.critical}var s={extname:"authorityKeyIdentifier"};t&&(s.critical=!0);for(var a=r(e,0),c=0;c<a.length;c++){var l=e.substr(a[c],2);if("80"===l&&(s.kid={hex:i(e,a[c])}),"a1"===l){var u=o(e,a[c]),h=this.getGeneralNames(u);s.issuer=h[0].dn}"82"===l&&(s.sn={hex:i(e,a[c])})}return s},this.getExtExtKeyUsage=function(e,t){if(void 0===e&&void 0===t){var n=this.getExtInfo("extKeyUsage");if(void 0===n)return;e=o(this.hex,n.vidx),t=n.critical}var s={extname:"extKeyUsage",array:[]};t&&(s.critical=!0);for(var a=r(e,0),c=0;c<a.length;c++)s.array.push(g(i(e,a[c])));return s},this.getExtExtKeyUsageName=function(){var e=this.getExtInfo("extKeyUsage");if(void 0===e)return e;var t=new Array,n=o(this.hex,e.vidx);if(""===n)return t;for(var s=r(n,0),a=0;a<s.length;a++)t.push(g(i(n,s[a])));return t},this.getExtSubjectAltName=function(e,t){if(void 0===e&&void 0===t){var n=this.getExtInfo("subjectAltName");if(void 0===n)return;e=o(this.hex,n.vidx),t=n.critical}var r={extname:"subjectAltName",array:[]};return t&&(r.critical=!0),r.array=this.getGeneralNames(e),r},this.getExtIssuerAltName=function(e,t){if(void 0===e&&void 0===t){var n=this.getExtInfo("issuerAltName");if(void 0===n)return;e=o(this.hex,n.vidx),t=n.critical}var r={extname:"issuerAltName",array:[]};return t&&(r.critical=!0),r.array=this.getGeneralNames(e),r},this.getGeneralNames=function(e){for(var t=r(e,0),n=[],i=0;i<t.length;i++){var s=this.getGeneralName(o(e,t[i]));void 0!==s&&n.push(s)}return n},this.getGeneralName=function(e){var t=e.substr(0,2),n=i(e,0),r=Ee(n);return"81"==t?{rfc822:r}:"82"==t?{dns:r}:"86"==t?{uri:r}:"87"==t?{ip:qe(n)}:"a4"==t?{dn:this.getX500Name(n)}:"a0"==t?{other:this.getOtherName(e)}:void 0},this.getExtSubjectAltName2=function(){var e,t,n,s=this.getExtInfo("subjectAltName");if(void 0===s)return s;for(var a=new Array,c=o(this.hex,s.vidx),l=r(c,0),u=0;u<l.length;u++)n=c.substr(l[u],2),e=i(c,l[u]),"81"===n&&(t=xe(e),a.push(["MAIL",t])),"82"===n&&(t=xe(e),a.push(["DNS",t])),"84"===n&&(t=ct.hex2dn(e,0),a.push(["DN",t])),"86"===n&&(t=xe(e),a.push(["URI",t])),"87"===n&&(t=qe(e),a.push(["IP",t]));return a},this.getExtCRLDistributionPoints=function(e,t){if(void 0===e&&void 0===t){var n=this.getExtInfo("cRLDistributionPoints");if(void 0===n)return;e=o(this.hex,n.vidx),t=n.critical}var i={extname:"cRLDistributionPoints",array:[]};t&&(i.critical=!0);for(var s=r(e,0),a=0;a<s.length;a++){var c=o(e,s[a]);i.array.push(this.getDistributionPoint(c))}return i},this.getDistributionPoint=function(e){for(var t={},n=r(e,0),i=0;i<n.length;i++){var s=e.substr(n[i],2),a=o(e,n[i]);"a0"==s&&(t.dpname=this.getDistributionPointName(a))}return t},this.getDistributionPointName=function(e){for(var t={},n=r(e,0),i=0;i<n.length;i++){var s=e.substr(n[i],2),a=o(e,n[i]);"a0"==s&&(t.full=this.getGeneralNames(a))}return t},this.getExtCRLDistributionPointsURI=function(){var e=this.getExtCRLDistributionPoints();if(null==e)return e;for(var t=e.array,n=[],r=0;r<t.length;r++)try{null!=t[r].dpname.full[0].uri&&n.push(t[r].dpname.full[0].uri)}catch(e){}return n},this.getExtAIAInfo=function(){var e=this.getExtInfo("authorityInfoAccess");if(void 0===e)return e;for(var t={ocsp:[],caissuer:[]},n=r(this.hex,e.vidx),i=0;i<n.length;i++){var s=a(this.hex,n[i],[0],"06"),o=a(this.hex,n[i],[1],"86");"2b06010505073001"===s&&t.ocsp.push(xe(o)),"2b06010505073002"===s&&t.caissuer.push(xe(o))}return t},this.getExtAuthorityInfoAccess=function(e,t){if(void 0===e&&void 0===t){var n=this.getExtInfo("authorityInfoAccess");if(void 0===n)return;e=o(this.hex,n.vidx),t=n.critical}var i={extname:"authorityInfoAccess",array:[]};t&&(i.critical=!0);for(var s=r(e,0),l=0;l<s.length;l++){var u=c(e,s[l],[0],"06"),h=xe(a(e,s[l],[1],"86"));if("2b06010505073001"==u)i.array.push({ocsp:h});else{if("2b06010505073002"!=u)throw new Error("unknown method: "+u);i.array.push({caissuer:h})}}return i},this.getExtCertificatePolicies=function(e,t){if(void 0===e&&void 0===t){var n=this.getExtInfo("certificatePolicies");if(void 0===n)return;e=o(this.hex,n.vidx),t=n.critical}var i={extname:"certificatePolicies",array:[]};t&&(i.critical=!0);for(var s=r(e,0),a=0;a<s.length;a++){var c=o(e,s[a]),l=this.getPolicyInformation(c);i.array.push(l)}return i},this.getPolicyInformation=function(e){var t={},n=a(e,0,[0],"06");t.policyoid=g(n);var i=d(e,0,[1],"30");if(-1!=i){t.array=[];for(var s=r(e,i),c=0;c<s.length;c++){var l=o(e,s[c]),u=this.getPolicyQualifierInfo(l);t.array.push(u)}}return t},this.getOtherName=function(e){var t={},n=r(e,0),i=a(e,n[0],[],"06"),o=a(e,n[1],[]);return t.oid=g(i),t.value=s(o),t},this.getPolicyQualifierInfo=function(e){var t={},n=a(e,0,[0],"06");if("2b06010505070201"===n){var r=c(e,0,[1],"16");t.cps=Ee(r)}else if("2b06010505070202"===n){var i=l(e,0,[1],"30");t.unotice=this.getUserNotice(i)}return t},this.getUserNotice=function(e){var t=null;try{return t=n.parse(e),this._asn1ToUnotice(t)}catch(e){return}},this._asn1ToUnotice=function(e){try{for(var t={},n=nt(e,"seq"),r=0;r<n.length;r++){var i=this._asn1ToNoticeRef(n[r]);null!=i&&(t.noticeref=i);var s=this.asn1ToDisplayText(n[r]);null!=s&&(t.exptext=s)}return Object.keys(t).length>0?t:void 0}catch(e){return}},this._asn1ToNoticeRef=function(e){try{for(var t={},n=nt(e,"seq"),r=0;r<n.length;r++){var i=this._asn1ToNoticeNum(n[r]);null!=i&&(t.noticenum=i);var s=this.asn1ToDisplayText(n[r]);null!=s&&(t.org=s)}return Object.keys(t).length>0?t:void 0}catch(e){return}},this._asn1ToNoticeNum=function(e){try{for(var t=nt(e,"seq"),n=[],r=0;r<t.length;r++){var i=t[r];n.push(parseInt(nt(i,"int.hex"),16))}return n}catch(e){return}},this.getDisplayText=function(e){var t={};return t.type={"0c":"utf8",16:"ia5","1a":"vis","1e":"bmp"}[e.substr(0,2)],t.str=Ee(i(e,0)),t},this.asn1ToDisplayText=function(e){return null!=e.utf8str?{type:"utf8",str:e.utf8str.str}:null!=e.ia5str?{type:"ia5",str:e.ia5str.str}:null!=e.visstr?{type:"vis",str:e.visstr.str}:null!=e.bmpstr?{type:"bmp",str:e.bmpstr.str}:null!=e.prnstr?{type:"prn",str:e.prnstr.str}:void 0},this.getExtPolicyMappings=function(e,t){var n=this.getCriticalExtV("policyMappings",e,t);if(e=n[0],t=n[1],null!=e){var r={extname:"policyMappings"};t&&(r.critical=!0);try{for(var i=s(e).seq,o=[],a=0;a<i.length;a++){var c=i[a].seq;o.push([c[0].oid,c[1].oid])}r.array=o}catch(e){throw new v("malformed policyMappings")}return r}},this.getExtPolicyConstraints=function(e,t){var n=this.getCriticalExtV("policyConstraints",e,t);if(e=n[0],t=n[1],null!=e){var r={extname:"policyConstraints"};t&&(r.critical=!0);var i=s(e);try{for(var o=i.seq,a=0;a<o.length;a++){var c=o[a].tag;0==c.explicit&&("80"==c.tag&&(r.reqexp=parseInt(c.hex,16)),"81"==c.tag&&(r.inhibit=parseInt(c.hex,16)))}}catch(e){return new v("malformed policyConstraints value")}return r}},this.getExtInhibitAnyPolicy=function(e,t){var n=this.getCriticalExtV("inhibitAnyPolicy",e,t);if(e=n[0],t=n[1],null!=e){var r={extname:"inhibitAnyPolicy"};t&&(r.critical=!0);var i=f(e,0);return-1==i?new v("wrong value"):(r.skip=i,r)}},this.getExtCRLNumber=function(e,t){var n={extname:"cRLNumber"};if(t&&(n.critical=!0),"02"==e.substr(0,2))return n.num={hex:i(e,0)},n;throw new v("hExtV parse error: "+e)},this.getExtCRLReason=function(e,t){var n={extname:"cRLReason"};if(t&&(n.critical=!0),"0a"==e.substr(0,2))return n.code=parseInt(i(e,0),16),n;throw new Error("hExtV parse error: "+e)},this.getExtOcspNonce=function(e,t){var n={extname:"ocspNonce"};t&&(n.critical=!0);var r=i(e,0);return n.hex=r,n},this.getExtOcspNoCheck=function(e,t){var n={extname:"ocspNoCheck"};return t&&(n.critical=!0),n},this.getExtAdobeTimeStamp=function(e,t){if(void 0===e&&void 0===t){var n=this.getExtInfo("adobeTimeStamp");if(void 0===n)return;e=o(this.hex,n.vidx),t=n.critical}var i={extname:"adobeTimeStamp"};t&&(i.critical=!0);var s=r(e,0);if(s.length>1){var a=o(e,s[1]),c=this.getGeneralName(a);null!=c.uri&&(i.uri=c.uri)}if(s.length>2){var l=o(e,s[2]);"0101ff"==l&&(i.reqauth=!0),"010100"==l&&(i.reqauth=!1)}return i},this.getExtSubjectDirectoryAttributes=function(e,t){if(void 0===e&&void 0===t){var n=this.getExtInfo("subjectDirectoryAttributes");if(void 0===n)return;e=o(this.hex,n.vidx),t=n.critical}var r={extname:"subjectDirectoryAttributes"};t&&(r.critical=!0);try{for(var i=s(e),a=[],c=0;c<i.seq.length;c++){var l=i.seq[c],u=nt(l,"seq.0.oid"),h=nt(l,"seq.1.set");if(null==u||null==h)throw"error";a.push({attr:u,array:h})}return r.array=a,r}catch(e){throw new Error("malformed subjectDirectoryAttributes extension value")}};var b=function(e){var t={};try{var n=e.seq[0].oid,r=le.asn1.x509.OID.name2oid(n);t.type=le.asn1.x509.OID.oid2atype(r);var i=e.seq[1];if(null!=i.utf8str)t.ds="utf8",t.value=i.utf8str.str;else if(null!=i.numstr)t.ds="num",t.value=i.numstr.str;else if(null!=i.telstr)t.ds="tel",t.value=i.telstr.str;else if(null!=i.prnstr)t.ds="prn",t.value=i.prnstr.str;else if(null!=i.ia5str)t.ds="ia5",t.value=i.ia5str.str;else if(null!=i.visstr)t.ds="vis",t.value=i.visstr.str;else{if(null==i.bmpstr)throw"error";t.ds="bmp",t.value=i.bmpstr.str}return t}catch(e){throw new Erorr("improper ASN.1 parsed AttrTypeAndValue")}},S=function(e){try{return e.set.map((function(e){return b(e)}))}catch(e){throw new Error("improper ASN.1 parsed RDN: "+e)}};this.getX500NameRule=function(e){for(var t=null,n=[],r=0;r<e.length;r++)for(var i=e[r],s=0;s<i.length;s++)n.push(i[s]);for(r=0;r<n.length;r++){var o=n[r],a=o.ds,c=o.value,l=o.type;if("prn"!=a&&"utf8"!=a&&"ia5"!=a)return"mixed";if("ia5"==a){if("CN"!=l)return"mixed";if(le.lang.String.isMail(c))continue;return"mixed"}if("C"==l){if("prn"==a)continue;return"mixed"}if(null==t)t=a;else if(t!==a)return"mixed"}return null==t?"prn":t},this.getAttrTypeAndValue=function(e){var t=s(e);return b(t)},this.getRDN=function(e){var t=s(e);return S(t)},this.getX500NameArray=function(e){return function(e){try{return e.seq.map((function(e){return S(e)}))}catch(e){throw new Error("improper ASN.1 parsed X500Name: "+e)}}(s(e))},this.getX500Name=function(e,t,n){var r=this.getX500NameArray(e),i={str:this.dnarraytostr(r)};return i.array=r,1==n&&(i.hex=e),1==t&&(i.canon=this.c14nRDNArray(r)),i},this.readCertPEM=function(e){this.readCertHex(y(e))},this.readCertHex=function(e){this.hex=e,this.getVersion();try{h(this.hex,0,[0,7],"a3"),this.parseExt()}catch(e){}},this.getParam=function(e){var t={};return null==e&&(e={}),t.version=this.getVersion(),t.serial={hex:this.getSerialNumberHex()},t.sigalg=this.getSignatureAlgorithmField(),t.issuer=this.getIssuer(e.dncanon,e.dnhex),t.notbefore=this.getNotBefore(),t.notafter=this.getNotAfter(),t.subject=this.getSubject(e.dncanon,e.dnhex),t.sbjpubkey=Oe(this.getPublicKeyHex(),"PUBLIC KEY"),null!=this.aExtInfo&&this.aExtInfo.length>0&&(t.ext=this.getExtParamArray()),t.sighex=this.getSignatureValueHex(),1==e.tbshex&&(t.tbshex=l(this.hex,0,[0])),1==e.nodnarray&&(delete t.issuer.array,delete t.subject.array),t},this.getExtParamArray=function(e){null==e&&-1!=d(this.hex,0,[0,"[3]"])&&(e=u(this.hex,0,[0,"[3]",0],"30"));for(var t=[],n=r(e,0),i=0;i<n.length;i++){var s=o(e,n[i]),a=this.getExtParam(s);null!=a&&t.push(a)}return t},this.getExtParam=function(e){var t=r(e,0).length;if(2!=t&&3!=t)throw new Error("wrong number elements in Extension: "+t+" "+e);var n=m(a(e,0,[0],"06")),i=!1;3==t&&"0101ff"==l(e,0,[1])&&(i=!0);var o=l(e,0,[t-1,0]),c=void 0;if("2.5.29.14"==n?c=this.getExtSubjectKeyIdentifier(o,i):"2.5.29.15"==n?c=this.getExtKeyUsage(o,i):"2.5.29.17"==n?c=this.getExtSubjectAltName(o,i):"2.5.29.18"==n?c=this.getExtIssuerAltName(o,i):"2.5.29.19"==n?c=this.getExtBasicConstraints(o,i):"2.5.29.30"==n?c=this.getExtNameConstraints(o,i):"2.5.29.31"==n?c=this.getExtCRLDistributionPoints(o,i):"2.5.29.32"==n?c=this.getExtCertificatePolicies(o,i):"2.5.29.33"==n?c=this.getExtPolicyMappings(o,i):"2.5.29.35"==n?c=this.getExtAuthorityKeyIdentifier(o,i):"2.5.29.36"==n?c=this.getExtPolicyConstraints(o,i):"2.5.29.37"==n?c=this.getExtExtKeyUsage(o,i):"2.5.29.54"==n?c=this.getExtInhibitAnyPolicy(o,i):"1.3.6.1.5.5.7.1.1"==n?c=this.getExtAuthorityInfoAccess(o,i):"2.5.29.20"==n?c=this.getExtCRLNumber(o,i):"2.5.29.21"==n?c=this.getExtCRLReason(o,i):"2.5.29.9"==n?c=this.getExtSubjectDirectoryAttributes(o,i):"1.3.6.1.5.5.7.48.1.2"==n?c=this.getExtOcspNonce(o,i):"1.3.6.1.5.5.7.48.1.5"==n?c=this.getExtOcspNoCheck(o,i):"1.2.840.113583.1.1.9.1"==n?c=this.getExtAdobeTimeStamp(o,i):null!=ct.EXT_PARSER[n]&&(c=ct.EXT_PARSER[n](n,i,o)),null!=c)return c;var u={extname:n,extn:o};try{u.extn=s(o)}catch(e){}return i&&(u.critical=!0),u},this.findExt=function(e,t){for(var n=0;n<e.length;n++)if(e[n].extname==t)return e[n];return null},this.updateExtCDPFullURI=function(e,t){var n=this.findExt(e,"cRLDistributionPoints");if(null!=n&&null!=n.array)for(var r=n.array,i=0;i<r.length;i++)if(null!=r[i].dpname&&null!=r[i].dpname.full)for(var s=r[i].dpname.full,o=0;o<s.length;o++){var a=s[i];null!=a.uri&&(a.uri=t)}},this.updateExtAIAOCSP=function(e,t){var n=this.findExt(e,"authorityInfoAccess");if(null!=n&&null!=n.array)for(var r=n.array,i=0;i<r.length;i++)null!=r[i].ocsp&&(r[i].ocsp=t)},this.updateExtAIACAIssuer=function(e,t){var n=this.findExt(e,"authorityInfoAccess");if(null!=n&&null!=n.array)for(var r=n.array,i=0;i<r.length;i++)null!=r[i].caissuer&&(r[i].caissuer=t)},this.dnarraytostr=function(e){return"/"+e.map((function(e){return function(e){return e.map((function(e){return function(e){return e.type+"="+e.value}(e).replace(/\+/,"\\+")})).join("+")}(e).replace(/\//,"\\/")})).join("/")},this.setCanonicalizedDN=function(e){var t;if(null!=e.str&&null==e.array){var n=new le.asn1.x509.X500Name({str:e.str}).tohex();t=this.getX500NameArray(n)}else t=e.array;null==e.canon&&(e.canon=this.c14nRDNArray(t))},this.c14nRDNArray=function(e){for(var t=[],n=0;n<e.length;n++){for(var r=e[n],i=[],s=0;s<r.length;s++){var o=r[s],a=o.value;a=(a=(a=(a=a.replace(/^\s*/,"")).replace(/\s*$/,"")).replace(/\s+/g," ")).toLowerCase(),i.push(o.type.toLowerCase()+"="+a)}t.push(i.join("+"))}return"/"+t.join("/")},this.getInfo=function(){var e,t,n,r=function(e){for(var t="",n="    ",r="\n",i=e.array,s=0;s<i.length;s++){var o=i[s];null!=o.dn&&(t+=n+"dn: "+o.dn.str+r),null!=o.ip&&(t+=n+"ip: "+o.ip+r),null!=o.rfc822&&(t+=n+"rfc822: "+o.rfc822+r),null!=o.dns&&(t+=n+"dns: "+o.dns+r),null!=o.uri&&(t+=n+"uri: "+o.uri+r),null!=o.other&&(t+=n+"other: "+o.other.oid+"="+JSON.stringify(o.other.value).replace(/\"/g,"")+r)}return t.replace(/\n$/,"")},i=function(e){for(var t="",n=e.array,r=0;r<n.length;r++){var i=n[r];if(t+="    policy oid: "+i.policyoid+"\n",void 0!==i.array)for(var s=0;s<i.array.length;s++){var o=i.array[s];void 0!==o.cps&&(t+="    cps: "+o.cps+"\n")}}return t},s=function(e){for(var t="",n=e.array,r=0;r<n.length;r++){var i=n[r];try{void 0!==i.dpname.full[0].uri&&(t+="    "+i.dpname.full[0].uri+"\n")}catch(e){}try{void 0!==i.dname.full[0].dn.hex&&(t+="    "+ct.hex2dn(i.dpname.full[0].dn.hex)+"\n")}catch(e){}}return t},o=function(e){for(var t="",n=e.array,r=0;r<n.length;r++){var i=n[r];void 0!==i.caissuer&&(t+="    caissuer: "+i.caissuer+"\n"),void 0!==i.ocsp&&(t+="    ocsp: "+i.ocsp+"\n")}return t};if(e="Basic Fields\n",e+="  serial number: "+this.getSerialNumberHex()+"\n",e+="  signature algorithm: "+this.getSignatureAlgorithmField()+"\n",e+="  issuer: "+this.getIssuerString()+"\n",e+="  notBefore: "+this.getNotBefore()+"\n",e+="  notAfter: "+this.getNotAfter()+"\n",e+="  subject: "+this.getSubjectString()+"\n",e+="  subject public key info: \n",e+="    key algorithm: "+(t=this.getPublicKey()).type+"\n","RSA"===t.type&&(e+="    n="+We(t.n.toString(16)).substr(0,16)+"...\n",e+="    e="+We(t.e.toString(16))+"\n"),null!=(n=this.aExtInfo)){e+="X509v3 Extensions:\n";for(var a=0;a<n.length;a++){var c=n[a],l=le.asn1.x509.OID.oid2name(c.oid);""===l&&(l=c.oid);var u="";if(!0===c.critical&&(u="CRITICAL"),e+="  "+l+" "+u+":\n","basicConstraints"===l){var h=this.getExtBasicConstraints();void 0===h.cA?e+="    {}\n":(e+="    cA=true",void 0!==h.pathLen&&(e+=", pathLen="+h.pathLen),e+="\n")}else{var d;if("policyMappings"==l)e+="    "+this.getExtPolicyMappings().array.map((function(e){var t=e;return t[0]+":"+t[1]})).join(", ")+"\n";else if("policyConstraints"==l)e+="    ",null!=(d=this.getExtPolicyConstraints()).reqexp&&(e+=" reqexp="+d.reqexp),null!=d.inhibit&&(e+=" inhibit="+d.inhibit),e+="\n";else if("inhibitAnyPolicy"==l)e+="    skip="+(d=this.getExtInhibitAnyPolicy()).skip+"\n";else if("keyUsage"==l)e+="    "+this.getExtKeyUsageString()+"\n";else if("subjectKeyIdentifier"==l)e+="    "+this.getExtSubjectKeyIdentifier().kid.hex+"\n";else if("authorityKeyIdentifier"==l){var p=this.getExtAuthorityKeyIdentifier();void 0!==p.kid&&(e+="    kid="+p.kid.hex+"\n")}else"extKeyUsage"==l?e+="    "+this.getExtExtKeyUsage().array.join(", ")+"\n":"subjectAltName"==l?e+=r(this.getExtSubjectAltName())+"\n":"cRLDistributionPoints"==l?e+=s(this.getExtCRLDistributionPoints()):"authorityInfoAccess"==l?e+=o(this.getExtAuthorityInfoAccess()):"certificatePolicies"==l&&(e+=i(this.getExtCertificatePolicies()))}}}return(e+="signature algorithm: "+this.getSignatureAlgorithmName()+"\n")+"signature: "+this.getSignatureValueHex().substr(0,16)+"...\n"},"string"==typeof e&&(-1!=e.indexOf("-----BEGIN")?this.readCertPEM(e):le.lang.String.isHex(e)&&this.readCertHex(e))}it.getKey=function(e,t,n){var r,i=(y=de).getChildIdx,s=(y.getV,y.getVbyList),o=le.crypto,a=o.ECDSA,c=o.DSA,l=re,u=Pe,h=it;if(void 0!==l&&e instanceof l)return e;if(void 0!==a&&e instanceof a)return e;if(void 0!==c&&e instanceof c)return e;if(void 0!==e.curve&&void 0!==e.xy&&void 0===e.d)return new a({pub:e.xy,curve:e.curve});if(void 0!==e.curve&&void 0!==e.d)return new a({prv:e.d,curve:e.curve});if(void 0===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0===e.d)return(O=new l).setPublic(e.n,e.e),O;if(void 0===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0!==e.d&&void 0!==e.p&&void 0!==e.q&&void 0!==e.dp&&void 0!==e.dq&&void 0!==e.co&&void 0===e.qi)return(O=new l).setPrivateEx(e.n,e.e,e.d,e.p,e.q,e.dp,e.dq,e.co),O;if(void 0===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0!==e.d&&void 0===e.p)return(O=new l).setPrivate(e.n,e.e,e.d),O;if(void 0!==e.p&&void 0!==e.q&&void 0!==e.g&&void 0!==e.y&&void 0===e.x)return(O=new c).setPublic(e.p,e.q,e.g,e.y),O;if(void 0!==e.p&&void 0!==e.q&&void 0!==e.g&&void 0!==e.y&&void 0!==e.x)return(O=new c).setPrivate(e.p,e.q,e.g,e.y,e.x),O;if("RSA"===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0===e.d)return(O=new l).setPublic(Se(e.n),Se(e.e)),O;if("RSA"===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0!==e.d&&void 0!==e.p&&void 0!==e.q&&void 0!==e.dp&&void 0!==e.dq&&void 0!==e.qi)return(O=new l).setPrivateEx(Se(e.n),Se(e.e),Se(e.d),Se(e.p),Se(e.q),Se(e.dp),Se(e.dq),Se(e.qi)),O;if("RSA"===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0!==e.d)return(O=new l).setPrivate(Se(e.n),Se(e.e),Se(e.d)),O;if("EC"===e.kty&&void 0!==e.crv&&void 0!==e.x&&void 0!==e.y&&void 0===e.d){var d=(N=new a({curve:e.crv})).ecparams.keycharlen,p="04"+("0000000000"+Se(e.x)).slice(-d)+("0000000000"+Se(e.y)).slice(-d);return N.setPublicKeyHex(p),N}if("EC"===e.kty&&void 0!==e.crv&&void 0!==e.x&&void 0!==e.y&&void 0!==e.d){d=(N=new a({curve:e.crv})).ecparams.keycharlen,p="04"+("0000000000"+Se(e.x)).slice(-d)+("0000000000"+Se(e.y)).slice(-d);var f=("0000000000"+Se(e.d)).slice(-d);return N.setPublicKeyHex(p),N.setPrivateKeyHex(f),N}if("pkcs5prv"===n){var g,m=e,y=de;if(9===(g=i(m,0)).length)(O=new l).readPKCS5PrvKeyHex(m);else if(6===g.length)(O=new c).readPKCS5PrvKeyHex(m);else{if(!(g.length>2&&"04"===m.substr(g[1],2)))throw new Error("unsupported PKCS#1/5 hexadecimal key");(O=new a).readPKCS5PrvKeyHex(m)}return O}if("pkcs8prv"===n)return h.getKeyFromPlainPrivatePKCS8Hex(e);if("pkcs8pub"===n)return h._getKeyFromPublicPKCS8Hex(e);if("x509pub"===n)return ct.getPublicKeyFromCertHex(e);if(-1!=e.indexOf("-END CERTIFICATE-",0)||-1!=e.indexOf("-END X509 CERTIFICATE-",0)||-1!=e.indexOf("-END TRUSTED CERTIFICATE-",0))return ct.getPublicKeyFromCertPEM(e);if(-1!=e.indexOf("-END PUBLIC KEY-")){var v=Pe(e,"PUBLIC KEY");return h._getKeyFromPublicPKCS8Hex(v)}if(-1!=e.indexOf("-END RSA PRIVATE KEY-")&&-1==e.indexOf("4,ENCRYPTED")){var b=u(e,"RSA PRIVATE KEY");return h.getKey(b,null,"pkcs5prv")}if(-1!=e.indexOf("-END DSA PRIVATE KEY-")&&-1==e.indexOf("4,ENCRYPTED")){var w=s(r=u(e,"DSA PRIVATE KEY"),0,[1],"02"),x=s(r,0,[2],"02"),C=s(r,0,[3],"02"),E=s(r,0,[4],"02"),T=s(r,0,[5],"02");return(O=new c).setPrivate(new S(w,16),new S(x,16),new S(C,16),new S(E,16),new S(T,16)),O}if(-1!=e.indexOf("-END EC PRIVATE KEY-")&&-1==e.indexOf("4,ENCRYPTED"))return b=u(e,"EC PRIVATE KEY"),h.getKey(b,null,"pkcs5prv");if(-1!=e.indexOf("-END PRIVATE KEY-"))return h.getKeyFromPlainPrivatePKCS8PEM(e);if(-1!=e.indexOf("-END RSA PRIVATE KEY-")&&-1!=e.indexOf("4,ENCRYPTED")){var A=h.getDecryptedKeyHex(e,t),k=new re;return k.readPKCS5PrvKeyHex(A),k}if(-1!=e.indexOf("-END EC PRIVATE KEY-")&&-1!=e.indexOf("4,ENCRYPTED")){var N,O=s(r=h.getDecryptedKeyHex(e,t),0,[1],"04"),P=s(r,0,[2,0],"06"),R=s(r,0,[3,0],"03").substr(2);if(void 0===le.crypto.OID.oidhex2name[P])throw new Error("undefined OID(hex) in KJUR.crypto.OID: "+P);return(N=new a({curve:le.crypto.OID.oidhex2name[P]})).setPublicKeyHex(R),N.setPrivateKeyHex(O),N.isPublic=!1,N}if(-1!=e.indexOf("-END DSA PRIVATE KEY-")&&-1!=e.indexOf("4,ENCRYPTED"))return w=s(r=h.getDecryptedKeyHex(e,t),0,[1],"02"),x=s(r,0,[2],"02"),C=s(r,0,[3],"02"),E=s(r,0,[4],"02"),T=s(r,0,[5],"02"),(O=new c).setPrivate(new S(w,16),new S(x,16),new S(C,16),new S(E,16),new S(T,16)),O;if(-1!=e.indexOf("-END ENCRYPTED PRIVATE KEY-"))return h.getKeyFromEncryptedPKCS8PEM(e,t);throw new Error("not supported argument")},it.generateKeypair=function(e,t){if("RSA"==e){var n=t;(o=new re).generate(n,"10001"),o.isPrivate=!0,o.isPublic=!0;var r=new re,i=o.n.toString(16),s=o.e.toString(16);return r.setPublic(i,s),r.isPrivate=!1,r.isPublic=!0,(a={}).prvKeyObj=o,a.pubKeyObj=r,a}if("EC"==e){var o,a,c=t,l=new le.crypto.ECDSA({curve:c}).generateKeyPairHex();return(o=new le.crypto.ECDSA({curve:c})).setPublicKeyHex(l.ecpubhex),o.setPrivateKeyHex(l.ecprvhex),o.isPrivate=!0,o.isPublic=!1,(r=new le.crypto.ECDSA({curve:c})).setPublicKeyHex(l.ecpubhex),r.isPrivate=!1,r.isPublic=!0,(a={}).prvKeyObj=o,a.pubKeyObj=r,a}throw new Error("unknown algorithm: "+e)},it.getPEM=function(e,t,n,r,i,s){var o=le,a=o.asn1,c=a.DERObjectIdentifier,l=a.DERInteger,u=a.ASN1Util.newObject,h=a.x509.SubjectPublicKeyInfo,d=o.crypto,p=d.DSA,f=d.ECDSA,g=re;function m(e){return u({seq:[{int:0},{int:{bigint:e.n}},{int:e.e},{int:{bigint:e.d}},{int:{bigint:e.p}},{int:{bigint:e.q}},{int:{bigint:e.dmp1}},{int:{bigint:e.dmq1}},{int:{bigint:e.coeff}}]})}function y(e){return u({seq:[{int:1},{octstr:{hex:e.prvKeyHex}},{tag:["a0",!0,{oid:{name:e.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+e.pubKeyHex}}]}]})}function v(e){return u({seq:[{int:0},{int:{bigint:e.p}},{int:{bigint:e.q}},{int:{bigint:e.g}},{int:{bigint:e.y}},{int:{bigint:e.x}}]})}if((void 0!==g&&e instanceof g||void 0!==p&&e instanceof p||void 0!==f&&e instanceof f)&&1==e.isPublic&&(void 0===t||"PKCS8PUB"==t))return Oe(x=new h(e).tohex(),"PUBLIC KEY");if("PKCS1PRV"==t&&void 0!==g&&e instanceof g&&(void 0===n||null==n)&&1==e.isPrivate)return Oe(x=m(e).tohex(),"RSA PRIVATE KEY");if("PKCS1PRV"==t&&void 0!==f&&e instanceof f&&(void 0===n||null==n)&&1==e.isPrivate){var b=new c({name:e.curveName}).tohex(),S=y(e).tohex(),w="";return(w+=Oe(b,"EC PARAMETERS"))+Oe(S,"EC PRIVATE KEY")}if("PKCS1PRV"==t&&void 0!==p&&e instanceof p&&(void 0===n||null==n)&&1==e.isPrivate)return Oe(x=v(e).tohex(),"DSA PRIVATE KEY");if("PKCS5PRV"==t&&void 0!==g&&e instanceof g&&void 0!==n&&null!=n&&1==e.isPrivate){var x=m(e).tohex();return void 0===r&&(r="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",x,n,r,s)}if("PKCS5PRV"==t&&void 0!==f&&e instanceof f&&void 0!==n&&null!=n&&1==e.isPrivate)return x=y(e).tohex(),void 0===r&&(r="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",x,n,r,s);if("PKCS5PRV"==t&&void 0!==p&&e instanceof p&&void 0!==n&&null!=n&&1==e.isPrivate)return x=v(e).tohex(),void 0===r&&(r="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",x,n,r,s);var C=function(e,t){if("string"==typeof t)return it.getEncryptedPKCS8PEM(e,t);if("object"==typeof t&&null!=nt(t,"passcode")){var n=JSON.parse(JSON.stringify(t)),r=n.passcode;return delete n.passcode,it.getEncryptedPKCS8PEM(e,r,n)}};if("PKCS8PRV"==t&&null!=g&&e instanceof g&&1==e.isPrivate){var E=m(e).tohex();return x=u({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:E}}]}).tohex(),void 0===n||null==n?Oe(x,"PRIVATE KEY"):C(x,n)}if("PKCS8PRV"==t&&void 0!==f&&e instanceof f&&1==e.isPrivate){var T={seq:[{int:1},{octstr:{hex:e.prvKeyHex}}]};return"string"==typeof e.pubKeyHex&&T.seq.push({tag:["a1",!0,{bitstr:{hex:"00"+e.pubKeyHex}}]}),E=new u(T).tohex(),x=u({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:e.curveName}}]},{octstr:{hex:E}}]}).tohex(),void 0===n||null==n?Oe(x,"PRIVATE KEY"):C(x,n)}if("PKCS8PRV"==t&&void 0!==p&&e instanceof p&&1==e.isPrivate)return E=new l({bigint:e.x}).tohex(),x=u({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:e.p}},{int:{bigint:e.q}},{int:{bigint:e.g}}]}]},{octstr:{hex:E}}]}).tohex(),void 0===n||null==n?Oe(x,"PRIVATE KEY"):C(x,n);throw new Error("unsupported object nor format")},it.getKeyFromCSRPEM=function(e){var t=Pe(e,"CERTIFICATE REQUEST");return it.getKeyFromCSRHex(t)},it.getKeyFromCSRHex=function(e){var t=it.parseCSRHex(e);return it.getKey(t.p8pubkeyhex,null,"pkcs8pub")},it.parseCSRHex=function(e){var t=de,n=t.getChildIdx,r=t.getTLV,i={},s=e;if("30"!=s.substr(0,2))throw new Error("malformed CSR(code:001)");var o=n(s,0);if(o.length<1)throw new Error("malformed CSR(code:002)");if("30"!=s.substr(o[0],2))throw new Error("malformed CSR(code:003)");var a=n(s,o[0]);if(a.length<3)throw new Error("malformed CSR(code:004)");return i.p8pubkeyhex=r(s,a[2]),i},it.getKeyID=function(e){var t=it,n=de;"string"==typeof e&&-1!=e.indexOf("BEGIN ")&&(e=t.getKey(e));var r=Pe(t.getPEM(e)),i=n.getIdxbyList(r,0,[1]),s=n.getV(r,i).substring(2);return le.crypto.Util.hashHex(s,"sha1")},it.getJWK=function(e,t,n,r,i){var s,o,a={},c=le.crypto.Util.hashHex;if("string"==typeof e)s=it.getKey(e),-1!=e.indexOf("CERTIFICATE")&&(o=Pe(e));else{if("object"!=typeof e)throw new Error("unsupported keyinfo type");e instanceof ct?(s=e.getPublicKey(),o=e.hex):s=e}if(s instanceof re&&s.isPrivate)a.kty="RSA",a.n=be(s.n.toString(16)),a.e=be(s.e.toString(16)),a.d=be(s.d.toString(16)),a.p=be(s.p.toString(16)),a.q=be(s.q.toString(16)),a.dp=be(s.dmp1.toString(16)),a.dq=be(s.dmq1.toString(16)),a.qi=be(s.coeff.toString(16));else if(s instanceof re&&s.isPublic)a.kty="RSA",a.n=be(s.n.toString(16)),a.e=be(s.e.toString(16));else if(s instanceof le.crypto.ECDSA&&s.isPrivate){if("P-256"!==(u=s.getShortNISTPCurveName())&&"P-384"!==u&&"P-521"!==u)throw new Error("unsupported curve name for JWT: "+u);var l=s.getPublicKeyXYHex();a.kty="EC",a.crv=u,a.x=be(l.x),a.y=be(l.y),a.d=be(s.prvKeyHex)}else if(s instanceof le.crypto.ECDSA&&s.isPublic){var u;if("P-256"!==(u=s.getShortNISTPCurveName())&&"P-384"!==u&&"P-521"!==u)throw new Error("unsupported curve name for JWT: "+u);l=s.getPublicKeyXYHex(),a.kty="EC",a.crv=u,a.x=be(l.x),a.y=be(l.y)}if(null==a.kty)throw new Error("unsupported keyinfo");return s.isPrivate||1==t||(a.kid=le.jws.JWS.getJWKthumbprint(a)),null!=o&&1!=n&&(a.x5c=[y(o)]),null!=o&&1!=r&&(a.x5t=ye(y(c(o,"sha1")))),null!=o&&1!=i&&(a["x5t#S256"]=ye(y(c(o,"sha256")))),a},it.getJWKFromKey=function(e){return it.getJWK(e,!0,!0,!0,!0)},re.getPosArrayOfChildrenFromHex=function(e){return de.getChildIdx(e,0)},re.getHexValueArrayOfChildrenFromHex=function(e){var t,n=de.getV,r=n(e,(t=re.getPosArrayOfChildrenFromHex(e))[0]),i=n(e,t[1]),s=n(e,t[2]),o=n(e,t[3]),a=n(e,t[4]),c=n(e,t[5]),l=n(e,t[6]),u=n(e,t[7]),h=n(e,t[8]);return(t=new Array).push(r,i,s,o,a,c,l,u,h),t},re.prototype.readPrivateKeyFromPEMString=function(e){var t=Pe(e),n=re.getHexValueArrayOfChildrenFromHex(t);this.setPrivateEx(n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8])},re.prototype.readPKCS5PrvKeyHex=function(e){var t=re.getHexValueArrayOfChildrenFromHex(e);this.setPrivateEx(t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},re.prototype.readPKCS8PrvKeyHex=function(e){var t,n,r,i,s,o,a,c,l=de,u=l.getVbyListEx;if(!1===l.isASN1HEX(e))throw new Error("not ASN.1 hex string");try{t=u(e,0,[2,0,1],"02"),n=u(e,0,[2,0,2],"02"),r=u(e,0,[2,0,3],"02"),i=u(e,0,[2,0,4],"02"),s=u(e,0,[2,0,5],"02"),o=u(e,0,[2,0,6],"02"),a=u(e,0,[2,0,7],"02"),c=u(e,0,[2,0,8],"02")}catch(e){throw new Error("malformed PKCS#8 plain RSA private key")}this.setPrivateEx(t,n,r,i,s,o,a,c)},re.prototype.readPKCS5PubKeyHex=function(e){var t=de,n=t.getV;if(!1===t.isASN1HEX(e))throw new Error("keyHex is not ASN.1 hex string");var r=t.getChildIdx(e,0);if(2!==r.length||"02"!==e.substr(r[0],2)||"02"!==e.substr(r[1],2))throw new Error("wrong hex for PKCS#5 public key");var i=n(e,r[0]),s=n(e,r[1]);this.setPublic(i,s)},re.prototype.readPKCS8PubKeyHex=function(e){var t=de;if(!1===t.isASN1HEX(e))throw new Error("not ASN.1 hex string");if("06092a864886f70d010101"!==t.getTLVbyListEx(e,0,[0,0]))throw new Error("not PKCS8 RSA public key");var n=t.getTLVbyListEx(e,0,[1,0]);this.readPKCS5PubKeyHex(n)},re.prototype.readCertPubKeyHex=function(e,t){var n,r;(n=new ct).readCertHex(e),r=n.getPublicKeyHex(),this.readPKCS8PubKeyHex(r)},re.prototype.sign=function(e,t){var n=function(e){return le.crypto.Util.hashString(e,t)}(e);return this.signWithMessageHash(n,t)},re.prototype.signWithMessageHash=function(e,t){var n=te(le.crypto.Util.getPaddedDigestInfoHex(e,t,this.n.bitLength()),16);return st(this.doPrivate(n).toString(16),this.n.bitLength())},re.prototype.signPSS=function(e,t,n){var r=function(e){return le.crypto.Util.hashHex(e,t)}(Te(e));return void 0===n&&(n=-1),this.signWithMessageHashPSS(r,t,n)},re.prototype.signWithMessageHashPSS=function(e,t,n){var r,i=Ee(e),s=i.length,o=this.n.bitLength()-1,a=Math.ceil(o/8),c=function(e){return le.crypto.Util.hashHex(e,t)};if(-1===n||void 0===n)n=s;else if(-2===n)n=a-s-2;else if(n<-2)throw new Error("invalid salt length");if(a<s+n+2)throw new Error("data too long");var l="";n>0&&(l=new Array(n),(new ee).nextBytes(l),l=String.fromCharCode.apply(String,l));var u=Ee(c(Te("\0\0\0\0\0\0\0\0"+i+l))),h=[];for(r=0;r<a-n-s-2;r+=1)h[r]=0;var d=String.fromCharCode.apply(String,h)+""+l,p=ot(u,d.length,c),f=[];for(r=0;r<d.length;r+=1)f[r]=d.charCodeAt(r)^p.charCodeAt(r);var g=65280>>8*a-o&255;for(f[0]&=~g,r=0;r<s;r++)f.push(u.charCodeAt(r));return f.push(188),st(this.doPrivate(new S(f)).toString(16),this.n.bitLength())},re.prototype.verify=function(e,t){if(null==(t=t.toLowerCase()).match(/^[0-9a-f]+$/))return!1;var n=te(t,16),r=this.n.bitLength();if(n.bitLength()>r)return!1;var i=this.doPublic(n).toString(16);if(i.length+3!=r/4)return!1;var s=at(i.replace(/^1f+00/,""));if(0==s.length)return!1;var o=s[0],a=s[1],c=function(e){return le.crypto.Util.hashString(e,o)}(e);return a==c},re.prototype.verifyWithMessageHash=function(e,t){if(t.length!=Math.ceil(this.n.bitLength()/4))return!1;var n=te(t,16);if(n.bitLength()>this.n.bitLength())return 0;var r=at(this.doPublic(n).toString(16).replace(/^1f+00/,""));return 0!=r.length&&(r[0],r[1]==e)},re.prototype.verifyPSS=function(e,t,n,r){var i,s=(i=Te(e),le.crypto.Util.hashHex(i,n));return void 0===r&&(r=-1),this.verifyWithMessageHashPSS(s,t,n,r)},re.prototype.verifyWithMessageHashPSS=function(e,t,n,r){if(t.length!=Math.ceil(this.n.bitLength()/4))return!1;var i,s=new S(t,16),o=function(e){return le.crypto.Util.hashHex(e,n)},a=Ee(e),c=a.length,l=this.n.bitLength()-1,u=Math.ceil(l/8);if(-1===r||void 0===r)r=c;else if(-2===r)r=u-c-2;else if(r<-2)throw new Error("invalid salt length");if(u<c+r+2)throw new Error("data too long");var h=this.doPublic(s).toByteArray();for(i=0;i<h.length;i+=1)h[i]&=255;for(;h.length<u;)h.unshift(0);if(188!==h[u-1])throw new Error("encoded message does not end in 0xbc");var d=(h=String.fromCharCode.apply(String,h)).substr(0,u-c-1),p=h.substr(d.length,c),f=65280>>8*u-l&255;if(0!=(d.charCodeAt(0)&f))throw new Error("bits beyond keysize not zero");var g=ot(p,d.length,o),m=[];for(i=0;i<d.length;i+=1)m[i]=d.charCodeAt(i)^g.charCodeAt(i);m[0]&=~f;var y=u-c-r-2;for(i=0;i<y;i+=1)if(0!==m[i])throw new Error("leftmost octets not zero");if(1!==m[y])throw new Error("0x01 marker not found");return p===Ee(o(Te("\0\0\0\0\0\0\0\0"+a+String.fromCharCode.apply(String,m.slice(-r)))))},re.SALT_LEN_HLEN=-1,re.SALT_LEN_MAX=-2,re.SALT_LEN_RECOVER=-2,ct.EXT_PARSER={},ct.registExtParser=function(e,t){ct.EXT_PARSER[e]=t},ct.hex2dn=function(e,t){void 0===t&&(t=0);var n=new ct;return de.getTLV(e,t),n.getX500Name(e).str},ct.hex2rdn=function(e,t){if(void 0===t&&(t=0),"31"!==e.substr(t,2))throw new Error("malformed RDN");for(var n=new Array,r=de.getChildIdx(e,t),i=0;i<r.length;i++)n.push(ct.hex2attrTypeValue(e,r[i]));return n=n.map((function(e){return e.replace("+","\\+")})),n.join("+")},ct.hex2attrTypeValue=function(e,t){var n=de,r=n.getV;if(void 0===t&&(t=0),"30"!==e.substr(t,2))throw new Error("malformed attribute type and value");var i=n.getChildIdx(e,t);2!==i.length||e.substr(i[0],2);var s=r(e,i[0]),o=le.asn1.ASN1Util.oidHexToInt(s);return le.asn1.x509.OID.oid2atype(o)+"="+Ee(r(e,i[1]))},ct.getPublicKeyFromCertHex=function(e){var t=new ct;return t.readCertHex(e),t.getPublicKey()},ct.getPublicKeyFromCertPEM=function(e){var t=new ct;return t.readCertPEM(e),t.getPublicKey()},ct.getPublicKeyInfoPropOfCertPEM=function(e){var t,n,r=de.getVbyList,i={algparam:null};return(t=new ct).readCertPEM(e),n=t.getPublicKeyHex(),i.keyhex=r(n,0,[1],"03").substr(2),i.algoid=r(n,0,[0,0],"06"),"2a8648ce3d0201"===i.algoid&&(i.algparam=r(n,0,[0,1],"06")),i},ct.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"],void 0!==le&&le||(le={}),void 0!==le.jws&&le.jws||(le.jws={}),le.jws.JWS=function(){var e=le.jws.JWS.isSafeJSONString;this.parseJWS=function(t,n){if(void 0===this.parsedJWS||!n&&void 0===this.parsedJWS.sigvalH){var r=t.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(null==r)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var i=r[1],s=r[2],o=r[3],a=i+"."+s;if(this.parsedJWS={},this.parsedJWS.headB64U=i,this.parsedJWS.payloadB64U=s,this.parsedJWS.sigvalB64U=o,this.parsedJWS.si=a,!n){var c=Se(o),l=te(c,16);this.parsedJWS.sigvalH=c,this.parsedJWS.sigvalBI=l}var u=he(i),h=he(s);if(this.parsedJWS.headS=u,this.parsedJWS.payloadS=h,!e(u,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+u}}},le.jws.JWS.sign=function(e,t,n,r,i){var s,o,a,c=le,l=c.jws.JWS,u=l.readSafeJSONString,h=l.isSafeJSONString,d=c.crypto,p=(d.ECDSA,d.Mac),f=d.Signature,g=JSON;if("string"!=typeof t&&"object"!=typeof t)throw"spHeader must be JSON string or object: "+t;if("object"==typeof t&&(o=t,s=g.stringify(o)),"string"==typeof t){if(!h(s=t))throw"JWS Head is not safe JSON string: "+s;o=u(s)}if(a=n,"object"==typeof n&&(a=g.stringify(n)),""!=e&&null!=e||void 0===o.alg||(e=o.alg),""!=e&&null!=e&&void 0===o.alg&&(o.alg=e,s=g.stringify(o)),e!==o.alg)throw"alg and sHeader.alg doesn't match: "+e+"!="+o.alg;var m=null;if(void 0===l.jwsalg2sigalg[e])throw"unsupported alg name: "+e;m=l.jwsalg2sigalg[e];var y=ue(s)+"."+ue(a),v="";if("Hmac"==m.substr(0,4)){if(void 0===r)throw"mac key shall be specified for HS* alg";var b=new p({alg:m,prov:"cryptojs",pass:r});b.updateString(y),v=b.doFinal()}else if(-1!=m.indexOf("withECDSA")){(w=new f({alg:m})).init(r,i),w.updateString(y);var S=w.sign();v=le.crypto.ECDSA.asn1SigToConcatSig(S)}else{var w;"none"!=m&&((w=new f({alg:m})).init(r,i),w.updateString(y),v=w.sign())}return y+"."+be(v)},le.jws.JWS.verify=function(e,t,n){var r,i=le,s=i.jws.JWS,o=s.readSafeJSONString,a=i.crypto,c=a.ECDSA,l=a.Mac,u=a.Signature;if(r=re,!Ge(e))return!1;var h=e.split(".");if(3!==h.length)return!1;var d,p=h[0]+"."+h[1],f=Se(h[2]),g=o(he(h[0])),m=null;if(void 0===g.alg)throw"algorithm not specified in header";if(d=(m=g.alg).substr(0,2),null!=n&&"[object Array]"===Object.prototype.toString.call(n)&&n.length>0&&-1==(":"+n.join(":")+":").indexOf(":"+m+":"))throw"algorithm '"+m+"' not accepted in the list";if("none"!=m&&null===t)throw"key shall be specified to verify.";if("string"==typeof t&&-1!=t.indexOf("-----BEGIN ")&&(t=it.getKey(t)),!("RS"!=d&&"PS"!=d||t instanceof r))throw"key shall be a RSAKey obj for RS* and PS* algs";if("ES"==d&&!(t instanceof c))throw"key shall be a ECDSA obj for ES* algs";var y=null;if(void 0===s.jwsalg2sigalg[g.alg])throw"unsupported alg name: "+m;if("none"==(y=s.jwsalg2sigalg[m]))throw"not supported";if("Hmac"==y.substr(0,4)){if(void 0===t)throw"hexadecimal key shall be specified for HMAC";var v=new l({alg:y,pass:t});return v.updateString(p),f==v.doFinal()}if(-1!=y.indexOf("withECDSA")){var b,S=null;try{S=c.concatSigToASN1Sig(f)}catch(e){return!1}return(b=new u({alg:y})).init(t),b.updateString(p),b.verify(S)}return(b=new u({alg:y})).init(t),b.updateString(p),b.verify(f)},le.jws.JWS.parse=function(e){var t,n,r,i=e.split("."),s={};if(2!=i.length&&3!=i.length)throw"malformed sJWS: wrong number of '.' splitted elements";return t=i[0],n=i[1],3==i.length&&(r=i[2]),s.headerObj=le.jws.JWS.readSafeJSONString(he(t)),s.payloadObj=le.jws.JWS.readSafeJSONString(he(n)),s.headerPP=JSON.stringify(s.headerObj,null,"  "),null==s.payloadObj?s.payloadPP=he(n):s.payloadPP=JSON.stringify(s.payloadObj,null,"  "),void 0!==r&&(s.sigHex=Se(r)),s},le.jws.JWS.verifyJWT=function(e,t,n){var r=le.jws,i=r.JWS,s=i.readSafeJSONString,o=i.inArray,a=i.includedArray;if(!Ge(e))return!1;var c=e.split(".");if(3!=c.length)return!1;var l=c[0],u=c[1],h=(Se(c[2]),s(he(l))),d=s(he(u));if(void 0===h.alg)return!1;if(void 0===n.alg)throw"acceptField.alg shall be specified";if(!o(h.alg,n.alg))return!1;if(void 0!==d.iss&&"object"==typeof n.iss&&!o(d.iss,n.iss))return!1;if(void 0!==d.sub&&"object"==typeof n.sub&&!o(d.sub,n.sub))return!1;if(void 0!==d.aud&&"object"==typeof n.aud)if("string"==typeof d.aud){if(!o(d.aud,n.aud))return!1}else if("object"==typeof d.aud&&!a(d.aud,n.aud))return!1;var p=r.IntDate.getNow();return void 0!==n.verifyAt&&"number"==typeof n.verifyAt&&(p=n.verifyAt),void 0!==n.gracePeriod&&"number"==typeof n.gracePeriod||(n.gracePeriod=0),!(void 0!==d.exp&&"number"==typeof d.exp&&d.exp+n.gracePeriod<p||void 0!==d.nbf&&"number"==typeof d.nbf&&p<d.nbf-n.gracePeriod||void 0!==d.iat&&"number"==typeof d.iat&&p<d.iat-n.gracePeriod||void 0!==d.jti&&void 0!==n.jti&&d.jti!==n.jti||!i.verify(e,t,n.alg))},le.jws.JWS.includedArray=function(e,t){var n=le.jws.JWS.inArray;if(null===e)return!1;if("object"!=typeof e)return!1;if("number"!=typeof e.length)return!1;for(var r=0;r<e.length;r++)if(!n(e[r],t))return!1;return!0},le.jws.JWS.inArray=function(e,t){if(null===t)return!1;if("object"!=typeof t)return!1;if("number"!=typeof t.length)return!1;for(var n=0;n<t.length;n++)if(t[n]==e)return!0;return!1},le.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",ES512:"SHA512withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},le.jws.JWS.isSafeJSONString=function(e,t,n){var r=null;try{return"object"!=typeof(r=ce(e))||r.constructor===Array?0:(t&&(t[n]=r),1)}catch(e){return 0}},le.jws.JWS.readSafeJSONString=function(e){var t=null;try{return"object"!=typeof(t=ce(e))||t.constructor===Array?null:t}catch(e){return null}},le.jws.JWS.getEncodedSignatureValueFromJWS=function(e){var t=e.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(null==t)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return t[1]},le.jws.JWS.getJWKthumbprint=function(e){if("RSA"!==e.kty&&"EC"!==e.kty&&"oct"!==e.kty)throw"unsupported algorithm for JWK Thumprint";var t="{";if("RSA"===e.kty){if("string"!=typeof e.n||"string"!=typeof e.e)throw"wrong n and e value for RSA key";t+='"e":"'+e.e+'",',t+='"kty":"'+e.kty+'",',t+='"n":"'+e.n+'"}'}else if("EC"===e.kty){if("string"!=typeof e.crv||"string"!=typeof e.x||"string"!=typeof e.y)throw"wrong crv, x and y value for EC key";t+='"crv":"'+e.crv+'",',t+='"kty":"'+e.kty+'",',t+='"x":"'+e.x+'",',t+='"y":"'+e.y+'"}'}else if("oct"===e.kty){if("string"!=typeof e.k)throw"wrong k value for oct(symmetric) key";t+='"kty":"'+e.kty+'",',t+='"k":"'+e.k+'"}'}var n=Te(t);return be(le.crypto.Util.hashHex(n,"sha256"))},le.jws.IntDate={},le.jws.IntDate.get=function(e){var t=le.jws.IntDate,n=t.getNow,r=t.getZulu;if("now"==e)return n();if("now + 1hour"==e)return n()+3600;if("now + 1day"==e)return n()+86400;if("now + 1month"==e)return n()+2592e3;if("now + 1year"==e)return n()+31536e3;if(e.match(/Z$/))return r(e);if(e.match(/^[0-9]+$/))return parseInt(e);throw"unsupported format: "+e},le.jws.IntDate.getZulu=function(e){return Ie(e)},le.jws.IntDate.getNow=function(){return~~(new Date/1e3)},le.jws.IntDate.intDate2UTCString=function(e){return new Date(1e3*e).toUTCString()},le.jws.IntDate.intDate2Zulu=function(e){var t=new Date(1e3*e);return("0000"+t.getUTCFullYear()).slice(-4)+("00"+(t.getUTCMonth()+1)).slice(-2)+("00"+t.getUTCDate()).slice(-2)+("00"+t.getUTCHours()).slice(-2)+("00"+t.getUTCMinutes()).slice(-2)+("00"+t.getUTCSeconds()).slice(-2)+"Z"},void 0!==le&&le||(le={}),void 0!==le.jws&&le.jws||(le.jws={}),le.jws.JWSJS=function(){var e=le.jws.JWS,t=e.readSafeJSONString;this.aHeader=[],this.sPayload="",this.aSignature=[],this.init=function(){this.aHeader=[],this.sPayload=void 0,this.aSignature=[]},this.initWithJWS=function(e){this.init();var t=e.split(".");if(3!=t.length)throw"malformed input JWS";this.aHeader.push(t[0]),this.sPayload=t[1],this.aSignature.push(t[2])},this.addSignature=function(e,t,n,r){if(void 0===this.sPayload||null===this.sPayload)throw"there's no JSON-JS signature to add.";var i=this.aHeader.length;if(this.aHeader.length!=this.aSignature.length)throw"aHeader.length != aSignature.length";try{var s=le.jws.JWS.sign(e,t,this.sPayload,n,r).split(".");s[0],s[2],this.aHeader.push(s[0]),this.aSignature.push(s[2])}catch(e){throw this.aHeader.length>i&&this.aHeader.pop(),this.aSignature.length>i&&this.aSignature.pop(),"addSignature failed: "+e}},this.verifyAll=function(e){if(this.aHeader.length!==e.length||this.aSignature.length!==e.length)return!1;for(var t=0;t<e.length;t++){var n=e[t];if(2!==n.length)return!1;if(!1===this.verifyNth(t,n[0],n[1]))return!1}return!0},this.verifyNth=function(t,n,r){if(this.aHeader.length<=t||this.aSignature.length<=t)return!1;var i=this.aHeader[t],s=this.aSignature[t],o=i+"."+this.sPayload+"."+s,a=!1;try{a=e.verify(o,n,r)}catch(e){return!1}return a},this.readJWSJS=function(e){if("string"==typeof e){var n=t(e);if(null==n)throw"argument is not safe JSON object string";this.aHeader=n.headers,this.sPayload=n.payload,this.aSignature=n.signatures}else try{if(!(e.headers.length>0))throw"malformed header";if(this.aHeader=e.headers,"string"!=typeof e.payload)throw"malformed signatures";if(this.sPayload=e.payload,!(e.signatures.length>0))throw"malformed signatures";this.aSignature=e.signatures}catch(e){throw"malformed JWS-JS JSON object: "+e}},this.getJSON=function(){return{headers:this.aHeader,payload:this.sPayload,signatures:this.aSignature}},this.isEmpty=function(){return 0==this.aHeader.length?1:0}},t.SecureRandom=ee,t.rng_seed_time=$,t.BigInteger=S,t.RSAKey=re,t.ECDSA=le.crypto.ECDSA,t.DSA=le.crypto.DSA,t.Signature=le.crypto.Signature,t.MessageDigest=le.crypto.MessageDigest,t.Mac=le.crypto.Mac,t.Cipher=le.crypto.Cipher,t.KEYUTIL=it,t.ASN1HEX=de,t.X509=ct,t.X509CRL=function(e){var t=le.lang.String.isHex,n=de,r=n.getV,i=n.getTLV,s=n.getVbyList,o=n.getTLVbyList,a=n.getTLVbyListEx,c=n.getIdxbyList,l=n.getIdxbyListEx,u=n.getChildIdx,h=new ct;this.hex=null,this.posSigAlg=null,this.posRevCert=null,this.parsed=null,this._setPos=function(){var e=c(this.hex,0,[0,0]),t=this.hex.substr(e,2);if("02"==t)this.posSigAlg=1;else{if("30"!=t)throw new Error("malformed 1st item of TBSCertList: "+t);this.posSigAlg=0}var n,r=c(this.hex,0,[0,this.posSigAlg+3]),i=this.hex.substr(r,2);if("17"==i||"18"==i)n=c(this.hex,0,[0,this.posSigAlg+4]),this.posRevCert=null,-1!=n&&"30"==this.hex.substr(n,2)&&(this.posRevCert=this.posSigAlg+4);else if("30"==i)this.posRevCert=this.posSigAlg+3;else{if("a0"!=i)throw new Error("malformed nextUpdate or revCert tag: "+i);this.posRevCert=null}},this.getVersion=function(){return 0==this.posSigAlg?null:parseInt(s(this.hex,0,[0,0],"02"),16)+1},this.getSignatureAlgorithmField=function(){var e=o(this.hex,0,[0,this.posSigAlg],"30");return h.getAlgorithmIdentifierName(e)},this.getIssuer=function(){return h.getX500Name(this.getIssuerHex())},this.getIssuerHex=function(){return o(this.hex,0,[0,this.posSigAlg+1],"30")},this.getThisUpdate=function(){var e=s(this.hex,0,[0,this.posSigAlg+2]);return result=Ee(e)},this.getNextUpdate=function(){var e=c(this.hex,0,[0,this.posSigAlg+3]),t=this.hex.substr(e,2);return"17"!=t&&"18"!=t?null:Ee(r(this.hex,e))},this.getRevCertArray=function(){if(null==this.posRevCert)return null;for(var e=[],t=c(this.hex,0,[0,this.posRevCert]),n=u(this.hex,t),r=0;r<n.length;r++){var s=i(this.hex,n[r]);e.push(this.getRevCert(s))}return e},this.getRevCert=function(e){var t={},n=u(e,0);return t.sn={hex:s(e,0,[0],"02")},t.date=Ee(s(e,0,[1])),3==n.length&&(t.ext=h.getExtParamArray(o(e,0,[2]))),t},this.findRevCert=function(e){var t=new ct(e).getSerialNumberHex();return this.findRevCertBySN(t)},this.findRevCertBySN=function(e){if(null==this.parsed&&this.getParam(),null==this.parsed.revcert)return null;for(var t=this.parsed.revcert,n=0;n<t.length;n++)if(e==t[n].sn.hex)return t[n];return null},this.getSignatureValueHex=function(){return s(this.hex,0,[2],"03",!0)},this.verifySignature=function(e){var t=this.getSignatureAlgorithmField(),n=this.getSignatureValueHex(),r=o(this.hex,0,[0],"30"),i=new le.crypto.Signature({alg:t});return i.init(e),i.updateHex(r),i.verify(n)},this.getParam=function(e){var t={},n=this.getVersion();null!=n&&(t.version=n),t.sigalg=this.getSignatureAlgorithmField(),t.issuer=this.getIssuer(),t.thisupdate=this.getThisUpdate();var r=this.getNextUpdate();null!=r&&(t.nextupdate=r);var i=this.getRevCertArray();if(null!=i&&(t.revcert=i),-1!=l(this.hex,0,[0,"[0]"])){var s=a(this.hex,0,[0,"[0]",0]);t.ext=h.getExtParamArray(s)}return t.sighex=this.getSignatureValueHex(),this.parsed=t,"object"==typeof e&&(1==e.tbshex&&(t.tbshex=o(this.hex,0,[0])),1==e.nodnarray&&delete t.issuer.array),t},"string"==typeof e&&(t(e)?this.hex=e:e.match(/-----BEGIN X509 CRL/)&&(this.hex=Pe(e)),this._setPos())},t.CryptoJS=p,t.b64tohex=v,t.b64toBA=b,t.ECFieldElementFp=se,t.ECPointFp=oe,t.ECCurveFp=ae,t.stoBA=pe,t.BAtos=fe,t.BAtohex=ge,t.stohex=me,t.stob64=function(e){return y(me(e))},t.stob64u=function(e){return ye(y(me(e)))},t.b64utos=function(e){return fe(b(ve(e)))},t.b64tob64u=ye,t.b64utob64=ve,t.hex2b64=y,t.hextob64u=be,t.b64utohex=Se,t.utf8tob64u=ue,t.b64utoutf8=he,t.utf8tob64=function(e){return y(De(Ue(e)))},t.b64toutf8=function(e){return decodeURIComponent(Me(v(e)))},t.utf8tohex=we,t.hextoutf8=xe,t.hextorstr=Ee,t.rstrtohex=Te,t.hextob64=Ae,t.hextob64nl=function(e){return ke(Ae(e),64)},t.b64nltohex=Ne,t.hextopem=Oe,t.pemtohex=Pe,t.hextoArrayBuffer=function(e){if(e.length%2!=0)throw"input is not even length";if(null==e.match(/^[0-9A-Fa-f]+$/))throw"input is not hexadecimal";for(var t=new ArrayBuffer(e.length/2),n=new DataView(t),r=0;r<e.length/2;r++)n.setUint8(r,parseInt(e.substr(2*r,2),16));return t},t.ArrayBuffertohex=function(e){for(var t="",n=new DataView(e),r=0;r<e.byteLength;r++)t+=("00"+n.getUint8(r).toString(16)).slice(-2);return t},t.zulutomsec=Re,t.msectozulu=function(e){var t=new Date(e),n=("0000"+t.getUTCFullYear()).slice(-4),r=("00"+(t.getUTCMonth()+1)).slice(-2),i=("00"+t.getUTCDate()).slice(-2),s=("00"+t.getUTCHours()).slice(-2),o=("00"+t.getUTCMinutes()).slice(-2),a=("00"+t.getUTCSeconds()).slice(-2),c=("000"+t.getUTCMilliseconds()).slice(-3);return n+r+i+s+o+a+(c=""!=(c=c.replace(/0+$/,""))?"."+c:c)+"Z"},t.zulutosec=Ie,t.zulutodate=function(e){return new Date(Re(e))},t.datetozulu=function(e,t,n){var r,i=e.getUTCFullYear();if(t){if(i<1950||2049<i)throw"not proper year for UTCTime: "+i;r=(""+i).slice(-2)}else r=("000"+i).slice(-4);if(r+=("0"+(e.getUTCMonth()+1)).slice(-2),r+=("0"+e.getUTCDate()).slice(-2),r+=("0"+e.getUTCHours()).slice(-2),r+=("0"+e.getUTCMinutes()).slice(-2),r+=("0"+e.getUTCSeconds()).slice(-2),n){var s=e.getUTCMilliseconds();0!==s&&(r+="."+(s=(s=("00"+s).slice(-3)).replace(/0+$/g,"")))}return r+"Z"},t.uricmptohex=De,t.hextouricmp=Me,t.ipv6tohex=Le,t.hextoipv6=_e,t.hextoip=qe,t.iptohex=je,t.ucs2hextoutf8=He,t.encodeURIComponentAll=Ue,t.newline_toUnix=function(e){return e.replace(/\r\n/gm,"\n")},t.newline_toDos=function(e){return(e=e.replace(/\r\n/gm,"\n")).replace(/\n/gm,"\r\n")},t.hextoposhex=We,t.intarystrtohex=function(e){e=(e=(e=e.replace(/^\s*\[\s*/,"")).replace(/\s*\]\s*$/,"")).replace(/\s*/g,"");try{var t=e.split(/,/).map((function(e,t,n){var r=parseInt(e);if(r<0||255<r)throw"integer not in range 0-255";return("00"+r.toString(16)).slice(-2)})).join("");return t}catch(e){throw"malformed integer array string: "+e}},t.strdiffidx=function(e,t){var n=e.length;e.length>t.length&&(n=t.length);for(var r=0;r<n;r++)if(e.charCodeAt(r)!=t.charCodeAt(r))return r;return e.length!=t.length?n:-1},t.oidtohex=Ke,t.hextooid=$e,t.strpad=Xe,t.bitstrtoint=Ze,t.inttobitstr=Ye,t.bitstrtobinstr=et,t.binstrtobitstr=function(e){if("string"!=typeof e)return null;if(null==e.match(/^[01]+$/))return null;try{return Ye(parseInt(e,2))}catch(e){return null}},t.isBase64URLDot=Ge,t.namearraytobinstr=tt,t.extendClass=rt,t.foldnl=ke,t.b64topem=function(e,t){return"-----BEGIN "+t+"-----\r\n"+ke(e,64)+"\r\n-----END "+t+"-----\r\n"},t.pemtob64=function(e){return-1==e.indexOf("-----BEGIN ")||-1==e.indexOf("-----END ")?null:(e=(e=(e=e.replace(/^[\s\S]*?-----BEGIN [^-]+-----/m,"")).replace(/-----END [\s\S]+$/m,"")).replace(/\s+/g,"")).match(/^[0-9a-zA-Z+/=]+$/)?e:null},t.timeogen=Fe,t.aryval=nt,t.inttohex=Je,t.twoscompl=Qe,t.KJUR=le,t.crypto=le.crypto,t.asn1=le.asn1,t.jws=le.jws,t.lang=le.lang,t.VERSION="10.9.0",t.VERSION_FULL="jsrsasign(all) 10.9.0 (2023-11-27) (c) 2010-2023 Kenji Urushima | kjur.github.io/jsrsasign/license"},8552:(e,t,n)=>{var r=n(852)(n(5639),"DataView");e.exports=r},1989:(e,t,n)=>{var r=n(1789),i=n(401),s=n(7667),o=n(1327),a=n(1866);function c(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}c.prototype.clear=r,c.prototype.delete=i,c.prototype.get=s,c.prototype.has=o,c.prototype.set=a,e.exports=c},8407:(e,t,n)=>{var r=n(7040),i=n(4125),s=n(2117),o=n(7518),a=n(4705);function c(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}c.prototype.clear=r,c.prototype.delete=i,c.prototype.get=s,c.prototype.has=o,c.prototype.set=a,e.exports=c},7071:(e,t,n)=>{var r=n(852)(n(5639),"Map");e.exports=r},3369:(e,t,n)=>{var r=n(4785),i=n(1285),s=n(6e3),o=n(9916),a=n(5265);function c(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}c.prototype.clear=r,c.prototype.delete=i,c.prototype.get=s,c.prototype.has=o,c.prototype.set=a,e.exports=c},3818:(e,t,n)=>{var r=n(852)(n(5639),"Promise");e.exports=r},8525:(e,t,n)=>{var r=n(852)(n(5639),"Set");e.exports=r},6384:(e,t,n)=>{var r=n(8407),i=n(7465),s=n(3779),o=n(7599),a=n(4758),c=n(4309);function l(e){var t=this.__data__=new r(e);this.size=t.size}l.prototype.clear=i,l.prototype.delete=s,l.prototype.get=o,l.prototype.has=a,l.prototype.set=c,e.exports=l},2705:(e,t,n)=>{var r=n(5639).Symbol;e.exports=r},1149:(e,t,n)=>{var r=n(5639).Uint8Array;e.exports=r},577:(e,t,n)=>{var r=n(852)(n(5639),"WeakMap");e.exports=r},6874:e=>{e.exports=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}},7412:e=>{e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}},4963:e=>{e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s}},4636:(e,t,n)=>{var r=n(2545),i=n(5694),s=n(1469),o=n(4144),a=n(5776),c=n(6719),l=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=s(e),u=!n&&i(e),h=!n&&!u&&o(e),d=!n&&!u&&!h&&c(e),p=n||u||h||d,f=p?r(e.length,String):[],g=f.length;for(var m in e)!t&&!l.call(e,m)||p&&("length"==m||h&&("offset"==m||"parent"==m)||d&&("buffer"==m||"byteLength"==m||"byteOffset"==m)||a(m,g))||f.push(m);return f}},2488:e=>{e.exports=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}},6556:(e,t,n)=>{var r=n(9465),i=n(7813);e.exports=function(e,t,n){(void 0!==n&&!i(e[t],n)||void 0===n&&!(t in e))&&r(e,t,n)}},4865:(e,t,n)=>{var r=n(9465),i=n(7813),s=Object.prototype.hasOwnProperty;e.exports=function(e,t,n){var o=e[t];s.call(e,t)&&i(o,n)&&(void 0!==n||t in e)||r(e,t,n)}},8470:(e,t,n)=>{var r=n(7813);e.exports=function(e,t){for(var n=e.length;n--;)if(r(e[n][0],t))return n;return-1}},4037:(e,t,n)=>{var r=n(8363),i=n(3674);e.exports=function(e,t){return e&&r(t,i(t),e)}},3886:(e,t,n)=>{var r=n(8363),i=n(1704);e.exports=function(e,t){return e&&r(t,i(t),e)}},9465:(e,t,n)=>{var r=n(8777);e.exports=function(e,t,n){"__proto__"==t&&r?r(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}},5990:(e,t,n)=>{var r=n(6384),i=n(7412),s=n(4865),o=n(4037),a=n(3886),c=n(4626),l=n(278),u=n(8805),h=n(1911),d=n(8234),p=n(6904),f=n(4160),g=n(3824),m=n(9148),y=n(8517),v=n(1469),b=n(4144),S=n(6688),w=n(3218),x=n(2928),C=n(3674),E=n(1704),T="[object Arguments]",A="[object Function]",k="[object Object]",N={};N[T]=N["[object Array]"]=N["[object ArrayBuffer]"]=N["[object DataView]"]=N["[object Boolean]"]=N["[object Date]"]=N["[object Float32Array]"]=N["[object Float64Array]"]=N["[object Int8Array]"]=N["[object Int16Array]"]=N["[object Int32Array]"]=N["[object Map]"]=N["[object Number]"]=N[k]=N["[object RegExp]"]=N["[object Set]"]=N["[object String]"]=N["[object Symbol]"]=N["[object Uint8Array]"]=N["[object Uint8ClampedArray]"]=N["[object Uint16Array]"]=N["[object Uint32Array]"]=!0,N["[object Error]"]=N[A]=N["[object WeakMap]"]=!1,e.exports=function e(t,n,O,P,R,I){var F,D=1&n,M=2&n,L=4&n;if(O&&(F=R?O(t,P,R,I):O(t)),void 0!==F)return F;if(!w(t))return t;var _=v(t);if(_){if(F=g(t),!D)return l(t,F)}else{var q=f(t),B=q==A||"[object GeneratorFunction]"==q;if(b(t))return c(t,D);if(q==k||q==T||B&&!R){if(F=M||B?{}:y(t),!D)return M?h(t,a(F,t)):u(t,o(F,t))}else{if(!N[q])return R?t:{};F=m(t,q,D)}}I||(I=new r);var j=I.get(t);if(j)return j;I.set(t,F),x(t)?t.forEach((function(r){F.add(e(r,n,O,r,t,I))})):S(t)&&t.forEach((function(r,i){F.set(i,e(r,n,O,i,t,I))}));var z=_?void 0:(L?M?p:d:M?E:C)(t);return i(z||t,(function(r,i){z&&(r=t[i=r]),s(F,i,e(r,n,O,i,t,I))})),F}},3118:(e,t,n)=>{var r=n(3218),i=Object.create,s=function(){function e(){}return function(t){if(!r(t))return{};if(i)return i(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();e.exports=s},8483:(e,t,n)=>{var r=n(5063)();e.exports=r},8866:(e,t,n)=>{var r=n(2488),i=n(1469);e.exports=function(e,t,n){var s=t(e);return i(e)?s:r(s,n(e))}},4239:(e,t,n)=>{var r=n(2705),i=n(9607),s=n(2333),o=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":o&&o in Object(e)?i(e):s(e)}},9454:(e,t,n)=>{var r=n(4239),i=n(7005);e.exports=function(e){return i(e)&&"[object Arguments]"==r(e)}},5588:(e,t,n)=>{var r=n(4160),i=n(7005);e.exports=function(e){return i(e)&&"[object Map]"==r(e)}},8458:(e,t,n)=>{var r=n(3560),i=n(5346),s=n(3218),o=n(346),a=/^\[object .+?Constructor\]$/,c=Function.prototype,l=Object.prototype,u=c.toString,h=l.hasOwnProperty,d=RegExp("^"+u.call(h).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!s(e)||i(e))&&(r(e)?d:a).test(o(e))}},9221:(e,t,n)=>{var r=n(4160),i=n(7005);e.exports=function(e){return i(e)&&"[object Set]"==r(e)}},8749:(e,t,n)=>{var r=n(4239),i=n(1780),s=n(7005),o={};o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o["[object Arguments]"]=o["[object Array]"]=o["[object ArrayBuffer]"]=o["[object Boolean]"]=o["[object DataView]"]=o["[object Date]"]=o["[object Error]"]=o["[object Function]"]=o["[object Map]"]=o["[object Number]"]=o["[object Object]"]=o["[object RegExp]"]=o["[object Set]"]=o["[object String]"]=o["[object WeakMap]"]=!1,e.exports=function(e){return s(e)&&i(e.length)&&!!o[r(e)]}},280:(e,t,n)=>{var r=n(5726),i=n(6916),s=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return i(e);var t=[];for(var n in Object(e))s.call(e,n)&&"constructor"!=n&&t.push(n);return t}},313:(e,t,n)=>{var r=n(3218),i=n(5726),s=n(3498),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return s(e);var t=i(e),n=[];for(var a in e)("constructor"!=a||!t&&o.call(e,a))&&n.push(a);return n}},2980:(e,t,n)=>{var r=n(6384),i=n(6556),s=n(8483),o=n(9783),a=n(3218),c=n(1704),l=n(6390);e.exports=function e(t,n,u,h,d){t!==n&&s(n,(function(s,c){if(d||(d=new r),a(s))o(t,n,c,u,e,h,d);else{var p=h?h(l(t,c),s,c+"",t,n,d):void 0;void 0===p&&(p=s),i(t,c,p)}}),c)}},9783:(e,t,n)=>{var r=n(6556),i=n(4626),s=n(7133),o=n(278),a=n(8517),c=n(5694),l=n(1469),u=n(9246),h=n(4144),d=n(3560),p=n(3218),f=n(8630),g=n(6719),m=n(6390),y=n(9881);e.exports=function(e,t,n,v,b,S,w){var x=m(e,n),C=m(t,n),E=w.get(C);if(E)r(e,n,E);else{var T=S?S(x,C,n+"",e,t,w):void 0,A=void 0===T;if(A){var k=l(C),N=!k&&h(C),O=!k&&!N&&g(C);T=C,k||N||O?l(x)?T=x:u(x)?T=o(x):N?(A=!1,T=i(C,!0)):O?(A=!1,T=s(C,!0)):T=[]:f(C)||c(C)?(T=x,c(x)?T=y(x):p(x)&&!d(x)||(T=a(C))):A=!1}A&&(w.set(C,T),b(T,C,v,S,w),w.delete(C)),r(e,n,T)}}},5976:(e,t,n)=>{var r=n(6557),i=n(5357),s=n(61);e.exports=function(e,t){return s(i(e,t,r),e+"")}},6560:(e,t,n)=>{var r=n(5703),i=n(8777),s=n(6557),o=i?function(e,t){return i(e,"toString",{configurable:!0,enumerable:!1,value:r(t),writable:!0})}:s;e.exports=o},2545:e=>{e.exports=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}},1717:e=>{e.exports=function(e){return function(t){return e(t)}}},4318:(e,t,n)=>{var r=n(1149);e.exports=function(e){var t=new e.constructor(e.byteLength);return new r(t).set(new r(e)),t}},4626:(e,t,n)=>{e=n.nmd(e);var r=n(5639),i=t&&!t.nodeType&&t,s=i&&e&&!e.nodeType&&e,o=s&&s.exports===i?r.Buffer:void 0,a=o?o.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,r=a?a(n):new e.constructor(n);return e.copy(r),r}},7157:(e,t,n)=>{var r=n(4318);e.exports=function(e,t){var n=t?r(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}},3147:e=>{var t=/\w*$/;e.exports=function(e){var n=new e.constructor(e.source,t.exec(e));return n.lastIndex=e.lastIndex,n}},419:(e,t,n)=>{var r=n(2705),i=r?r.prototype:void 0,s=i?i.valueOf:void 0;e.exports=function(e){return s?Object(s.call(e)):{}}},7133:(e,t,n)=>{var r=n(4318);e.exports=function(e,t){var n=t?r(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}},278:e=>{e.exports=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}},8363:(e,t,n)=>{var r=n(4865),i=n(9465);e.exports=function(e,t,n,s){var o=!n;n||(n={});for(var a=-1,c=t.length;++a<c;){var l=t[a],u=s?s(n[l],e[l],l,n,e):void 0;void 0===u&&(u=e[l]),o?i(n,l,u):r(n,l,u)}return n}},8805:(e,t,n)=>{var r=n(8363),i=n(9551);e.exports=function(e,t){return r(e,i(e),t)}},1911:(e,t,n)=>{var r=n(8363),i=n(1442);e.exports=function(e,t){return r(e,i(e),t)}},4429:(e,t,n)=>{var r=n(5639)["__core-js_shared__"];e.exports=r},1463:(e,t,n)=>{var r=n(5976),i=n(6612);e.exports=function(e){return r((function(t,n){var r=-1,s=n.length,o=s>1?n[s-1]:void 0,a=s>2?n[2]:void 0;for(o=e.length>3&&"function"==typeof o?(s--,o):void 0,a&&i(n[0],n[1],a)&&(o=s<3?void 0:o,s=1),t=Object(t);++r<s;){var c=n[r];c&&e(t,c,r,o)}return t}))}},5063:e=>{e.exports=function(e){return function(t,n,r){for(var i=-1,s=Object(t),o=r(t),a=o.length;a--;){var c=o[e?a:++i];if(!1===n(s[c],c,s))break}return t}}},8777:(e,t,n)=>{var r=n(852),i=function(){try{var e=r(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=i},1957:(e,t,n)=>{var r="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g;e.exports=r},8234:(e,t,n)=>{var r=n(8866),i=n(9551),s=n(3674);e.exports=function(e){return r(e,s,i)}},6904:(e,t,n)=>{var r=n(8866),i=n(1442),s=n(1704);e.exports=function(e){return r(e,s,i)}},5050:(e,t,n)=>{var r=n(7019);e.exports=function(e,t){var n=e.__data__;return r(t)?n["string"==typeof t?"string":"hash"]:n.map}},852:(e,t,n)=>{var r=n(8458),i=n(7801);e.exports=function(e,t){var n=i(e,t);return r(n)?n:void 0}},5924:(e,t,n)=>{var r=n(5569)(Object.getPrototypeOf,Object);e.exports=r},9607:(e,t,n)=>{var r=n(2705),i=Object.prototype,s=i.hasOwnProperty,o=i.toString,a=r?r.toStringTag:void 0;e.exports=function(e){var t=s.call(e,a),n=e[a];try{e[a]=void 0;var r=!0}catch(e){}var i=o.call(e);return r&&(t?e[a]=n:delete e[a]),i}},9551:(e,t,n)=>{var r=n(4963),i=n(479),s=Object.prototype.propertyIsEnumerable,o=Object.getOwnPropertySymbols,a=o?function(e){return null==e?[]:(e=Object(e),r(o(e),(function(t){return s.call(e,t)})))}:i;e.exports=a},1442:(e,t,n)=>{var r=n(2488),i=n(5924),s=n(9551),o=n(479),a=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)r(t,s(e)),e=i(e);return t}:o;e.exports=a},4160:(e,t,n)=>{var r=n(8552),i=n(7071),s=n(3818),o=n(8525),a=n(577),c=n(4239),l=n(346),u="[object Map]",h="[object Promise]",d="[object Set]",p="[object WeakMap]",f="[object DataView]",g=l(r),m=l(i),y=l(s),v=l(o),b=l(a),S=c;(r&&S(new r(new ArrayBuffer(1)))!=f||i&&S(new i)!=u||s&&S(s.resolve())!=h||o&&S(new o)!=d||a&&S(new a)!=p)&&(S=function(e){var t=c(e),n="[object Object]"==t?e.constructor:void 0,r=n?l(n):"";if(r)switch(r){case g:return f;case m:return u;case y:return h;case v:return d;case b:return p}return t}),e.exports=S},7801:e=>{e.exports=function(e,t){return null==e?void 0:e[t]}},1789:(e,t,n)=>{var r=n(4536);e.exports=function(){this.__data__=r?r(null):{},this.size=0}},401:e=>{e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},7667:(e,t,n)=>{var r=n(4536),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(r){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return i.call(t,e)?t[e]:void 0}},1327:(e,t,n)=>{var r=n(4536),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return r?void 0!==t[e]:i.call(t,e)}},1866:(e,t,n)=>{var r=n(4536);e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=r&&void 0===t?"__lodash_hash_undefined__":t,this}},3824:e=>{var t=Object.prototype.hasOwnProperty;e.exports=function(e){var n=e.length,r=new e.constructor(n);return n&&"string"==typeof e[0]&&t.call(e,"index")&&(r.index=e.index,r.input=e.input),r}},9148:(e,t,n)=>{var r=n(4318),i=n(7157),s=n(3147),o=n(419),a=n(7133);e.exports=function(e,t,n){var c=e.constructor;switch(t){case"[object ArrayBuffer]":return r(e);case"[object Boolean]":case"[object Date]":return new c(+e);case"[object DataView]":return i(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return a(e,n);case"[object Map]":case"[object Set]":return new c;case"[object Number]":case"[object String]":return new c(e);case"[object RegExp]":return s(e);case"[object Symbol]":return o(e)}}},8517:(e,t,n)=>{var r=n(3118),i=n(5924),s=n(5726);e.exports=function(e){return"function"!=typeof e.constructor||s(e)?{}:r(i(e))}},5776:e=>{var t=/^(?:0|[1-9]\d*)$/;e.exports=function(e,n){var r=typeof e;return!!(n=null==n?9007199254740991:n)&&("number"==r||"symbol"!=r&&t.test(e))&&e>-1&&e%1==0&&e<n}},6612:(e,t,n)=>{var r=n(7813),i=n(8612),s=n(5776),o=n(3218);e.exports=function(e,t,n){if(!o(n))return!1;var a=typeof t;return!!("number"==a?i(n)&&s(t,n.length):"string"==a&&t in n)&&r(n[t],e)}},7019:e=>{e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},5346:(e,t,n)=>{var r,i=n(4429),s=(r=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";e.exports=function(e){return!!s&&s in e}},5726:e=>{var t=Object.prototype;e.exports=function(e){var n=e&&e.constructor;return e===("function"==typeof n&&n.prototype||t)}},7040:e=>{e.exports=function(){this.__data__=[],this.size=0}},4125:(e,t,n)=>{var r=n(8470),i=Array.prototype.splice;e.exports=function(e){var t=this.__data__,n=r(t,e);return!(n<0||(n==t.length-1?t.pop():i.call(t,n,1),--this.size,0))}},2117:(e,t,n)=>{var r=n(8470);e.exports=function(e){var t=this.__data__,n=r(t,e);return n<0?void 0:t[n][1]}},7518:(e,t,n)=>{var r=n(8470);e.exports=function(e){return r(this.__data__,e)>-1}},4705:(e,t,n)=>{var r=n(8470);e.exports=function(e,t){var n=this.__data__,i=r(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this}},4785:(e,t,n)=>{var r=n(1989),i=n(8407),s=n(7071);e.exports=function(){this.size=0,this.__data__={hash:new r,map:new(s||i),string:new r}}},1285:(e,t,n)=>{var r=n(5050);e.exports=function(e){var t=r(this,e).delete(e);return this.size-=t?1:0,t}},6e3:(e,t,n)=>{var r=n(5050);e.exports=function(e){return r(this,e).get(e)}},9916:(e,t,n)=>{var r=n(5050);e.exports=function(e){return r(this,e).has(e)}},5265:(e,t,n)=>{var r=n(5050);e.exports=function(e,t){var n=r(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this}},4536:(e,t,n)=>{var r=n(852)(Object,"create");e.exports=r},6916:(e,t,n)=>{var r=n(5569)(Object.keys,Object);e.exports=r},3498:e=>{e.exports=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}},1167:(e,t,n)=>{e=n.nmd(e);var r=n(1957),i=t&&!t.nodeType&&t,s=i&&e&&!e.nodeType&&e,o=s&&s.exports===i&&r.process,a=function(){try{return s&&s.require&&s.require("util").types||o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=a},2333:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},5569:e=>{e.exports=function(e,t){return function(n){return e(t(n))}}},5357:(e,t,n)=>{var r=n(6874),i=Math.max;e.exports=function(e,t,n){return t=i(void 0===t?e.length-1:t,0),function(){for(var s=arguments,o=-1,a=i(s.length-t,0),c=Array(a);++o<a;)c[o]=s[t+o];o=-1;for(var l=Array(t+1);++o<t;)l[o]=s[o];return l[t]=n(c),r(e,this,l)}}},5639:(e,t,n)=>{var r=n(1957),i="object"==typeof self&&self&&self.Object===Object&&self,s=r||i||Function("return this")();e.exports=s},6390:e=>{e.exports=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}},61:(e,t,n)=>{var r=n(6560),i=n(1275)(r);e.exports=i},1275:e=>{var t=Date.now;e.exports=function(e){var n=0,r=0;return function(){var i=t(),s=16-(i-r);if(r=i,s>0){if(++n>=800)return arguments[0]}else n=0;return e.apply(void 0,arguments)}}},7465:(e,t,n)=>{var r=n(8407);e.exports=function(){this.__data__=new r,this.size=0}},3779:e=>{e.exports=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}},7599:e=>{e.exports=function(e){return this.__data__.get(e)}},4758:e=>{e.exports=function(e){return this.__data__.has(e)}},4309:(e,t,n)=>{var r=n(8407),i=n(7071),s=n(3369);e.exports=function(e,t){var n=this.__data__;if(n instanceof r){var o=n.__data__;if(!i||o.length<199)return o.push([e,t]),this.size=++n.size,this;n=this.__data__=new s(o)}return n.set(e,t),this.size=n.size,this}},346:e=>{var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},361:(e,t,n)=>{var r=n(5990);e.exports=function(e){return r(e,5)}},5703:e=>{e.exports=function(e){return function(){return e}}},7813:e=>{e.exports=function(e,t){return e===t||e!=e&&t!=t}},6557:e=>{e.exports=function(e){return e}},5694:(e,t,n)=>{var r=n(9454),i=n(7005),s=Object.prototype,o=s.hasOwnProperty,a=s.propertyIsEnumerable,c=r(function(){return arguments}())?r:function(e){return i(e)&&o.call(e,"callee")&&!a.call(e,"callee")};e.exports=c},1469:e=>{var t=Array.isArray;e.exports=t},8612:(e,t,n)=>{var r=n(3560),i=n(1780);e.exports=function(e){return null!=e&&i(e.length)&&!r(e)}},9246:(e,t,n)=>{var r=n(8612),i=n(7005);e.exports=function(e){return i(e)&&r(e)}},4144:(e,t,n)=>{e=n.nmd(e);var r=n(5639),i=n(5062),s=t&&!t.nodeType&&t,o=s&&e&&!e.nodeType&&e,a=o&&o.exports===s?r.Buffer:void 0,c=(a?a.isBuffer:void 0)||i;e.exports=c},3560:(e,t,n)=>{var r=n(4239),i=n(3218);e.exports=function(e){if(!i(e))return!1;var t=r(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},1780:e=>{e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},6688:(e,t,n)=>{var r=n(5588),i=n(1717),s=n(1167),o=s&&s.isMap,a=o?i(o):r;e.exports=a},3218:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},7005:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},8630:(e,t,n)=>{var r=n(4239),i=n(5924),s=n(7005),o=Function.prototype,a=Object.prototype,c=o.toString,l=a.hasOwnProperty,u=c.call(Object);e.exports=function(e){if(!s(e)||"[object Object]"!=r(e))return!1;var t=i(e);if(null===t)return!0;var n=l.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&c.call(n)==u}},2928:(e,t,n)=>{var r=n(9221),i=n(1717),s=n(1167),o=s&&s.isSet,a=o?i(o):r;e.exports=a},6719:(e,t,n)=>{var r=n(8749),i=n(1717),s=n(1167),o=s&&s.isTypedArray,a=o?i(o):r;e.exports=a},3674:(e,t,n)=>{var r=n(4636),i=n(280),s=n(8612);e.exports=function(e){return s(e)?r(e):i(e)}},1704:(e,t,n)=>{var r=n(4636),i=n(313),s=n(8612);e.exports=function(e){return s(e)?r(e,!0):i(e)}},2492:(e,t,n)=>{var r=n(2980),i=n(1463)((function(e,t,n){r(e,t,n)}));e.exports=i},479:e=>{e.exports=function(){return[]}},5062:e=>{e.exports=function(){return!1}},9881:(e,t,n)=>{var r=n(8363),i=n(1704);e.exports=function(e){return r(e,i(e))}},8908:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tag=t.log=t.LogLevel=t.Log=void 0;let n=function(e){return e.DEBUG="DEBUG",e.TRACE="TRACE",e.INFO="INFO",e.WARN="WARN",e.ERROR="ERROR",e.OFF="OFF",e}({});t.LogLevel=n;var r=function(e){return e[e.DEBUG=1]="DEBUG",e[e.TRACE=2]="TRACE",e[e.INFO=3]="INFO",e[e.WARN=4]="WARN",e[e.ERROR=5]="ERROR",e[e.OFF=6]="OFF",e}(r||{});const i={};t.tag=i;class s{_tagToLevel={};init(e,t){for(const t in e)this._tagToLevel[t]=r[e[t]]||1;void 0!==t&&(this._callback=t);for(const e in this._tagToLevel)i[e]=e;return this}error(e,t,...n){this.log(r.ERROR,e,t,n)}warn(e,t,...n){this.log(r.WARN,e,t,n)}info(e,t,...n){this.log(r.INFO,e,t,n)}trace(e,t,...n){this.log(r.TRACE,e,t,n)}debug(e,t,...n){this.log(r.DEBUG,e,t,n)}log(e,t,n,i){this._callback&&e>=(this._tagToLevel[t]??r.DEBUG)&&this._callback(r[e],t,n,i)}}t.Log=s;const o=new s;t.log=o},631:(e,t,n)=>{var r="function"==typeof Map&&Map.prototype,i=Object.getOwnPropertyDescriptor&&r?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,s=r&&i&&"function"==typeof i.get?i.get:null,o=r&&Map.prototype.forEach,a="function"==typeof Set&&Set.prototype,c=Object.getOwnPropertyDescriptor&&a?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,l=a&&c&&"function"==typeof c.get?c.get:null,u=a&&Set.prototype.forEach,h="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,d="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,p="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,f=Boolean.prototype.valueOf,g=Object.prototype.toString,m=Function.prototype.toString,y=String.prototype.match,v=String.prototype.slice,b=String.prototype.replace,S=String.prototype.toUpperCase,w=String.prototype.toLowerCase,x=RegExp.prototype.test,C=Array.prototype.concat,E=Array.prototype.join,T=Array.prototype.slice,A=Math.floor,k="function"==typeof BigInt?BigInt.prototype.valueOf:null,N=Object.getOwnPropertySymbols,O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,P="function"==typeof Symbol&&"object"==typeof Symbol.iterator,R="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol.toStringTag,1)?Symbol.toStringTag:null,I=Object.prototype.propertyIsEnumerable,F=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function D(e,t){if(e===1/0||e===-1/0||e!=e||e&&e>-1e3&&e<1e3||x.call(/e/,t))return t;var n=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof e){var r=e<0?-A(-e):A(e);if(r!==e){var i=String(r),s=v.call(t,i.length+1);return b.call(i,n,"$&_")+"."+b.call(b.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return b.call(t,n,"$&_")}var M=n(4654),L=M.custom,_=H(L)?L:null;function q(e,t,n){var r="double"===(n.quoteStyle||t)?'"':"'";return r+e+r}function B(e){return b.call(String(e),/"/g,"&quot;")}function j(e){return!("[object Array]"!==G(e)||R&&"object"==typeof e&&R in e)}function z(e){return!("[object RegExp]"!==G(e)||R&&"object"==typeof e&&R in e)}function H(e){if(P)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||!O)return!1;try{return O.call(e),!0}catch(e){}return!1}e.exports=function e(t,r,i,a){var c=r||{};if(V(c,"quoteStyle")&&"single"!==c.quoteStyle&&"double"!==c.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(V(c,"maxStringLength")&&("number"==typeof c.maxStringLength?c.maxStringLength<0&&c.maxStringLength!==1/0:null!==c.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var g=!V(c,"customInspect")||c.customInspect;if("boolean"!=typeof g&&"symbol"!==g)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(V(c,"indent")&&null!==c.indent&&"\t"!==c.indent&&!(parseInt(c.indent,10)===c.indent&&c.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(V(c,"numericSeparator")&&"boolean"!=typeof c.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var S=c.numericSeparator;if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return K(t,c);if("number"==typeof t){if(0===t)return 1/0/t>0?"0":"-0";var x=String(t);return S?D(t,x):x}if("bigint"==typeof t){var A=String(t)+"n";return S?D(t,A):A}var N=void 0===c.depth?5:c.depth;if(void 0===i&&(i=0),i>=N&&N>0&&"object"==typeof t)return j(t)?"[Array]":"[Object]";var L,U=function(e,t){var n;if("\t"===e.indent)n="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;n=E.call(Array(e.indent+1)," ")}return{base:n,prev:E.call(Array(t+1),n)}}(c,i);if(void 0===a)a=[];else if(W(a,t)>=0)return"[Circular]";function $(t,n,r){if(n&&(a=T.call(a)).push(n),r){var s={depth:c.depth};return V(c,"quoteStyle")&&(s.quoteStyle=c.quoteStyle),e(t,s,i+1,a)}return e(t,c,i+1,a)}if("function"==typeof t&&!z(t)){var ee=function(e){if(e.name)return e.name;var t=y.call(m.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}(t),te=Y(t,$);return"[Function"+(ee?": "+ee:" (anonymous)")+"]"+(te.length>0?" { "+E.call(te,", ")+" }":"")}if(H(t)){var ne=P?b.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):O.call(t);return"object"!=typeof t||P?ne:J(ne)}if((L=t)&&"object"==typeof L&&("undefined"!=typeof HTMLElement&&L instanceof HTMLElement||"string"==typeof L.nodeName&&"function"==typeof L.getAttribute)){for(var re="<"+w.call(String(t.nodeName)),ie=t.attributes||[],se=0;se<ie.length;se++)re+=" "+ie[se].name+"="+q(B(ie[se].value),"double",c);return re+=">",t.childNodes&&t.childNodes.length&&(re+="..."),re+"</"+w.call(String(t.nodeName))+">"}if(j(t)){if(0===t.length)return"[]";var oe=Y(t,$);return U&&!function(e){for(var t=0;t<e.length;t++)if(W(e[t],"\n")>=0)return!1;return!0}(oe)?"["+Z(oe,U)+"]":"[ "+E.call(oe,", ")+" ]"}if(function(e){return!("[object Error]"!==G(e)||R&&"object"==typeof e&&R in e)}(t)){var ae=Y(t,$);return"cause"in Error.prototype||!("cause"in t)||I.call(t,"cause")?0===ae.length?"["+String(t)+"]":"{ ["+String(t)+"] "+E.call(ae,", ")+" }":"{ ["+String(t)+"] "+E.call(C.call("[cause]: "+$(t.cause),ae),", ")+" }"}if("object"==typeof t&&g){if(_&&"function"==typeof t[_]&&M)return M(t,{depth:N-i});if("symbol"!==g&&"function"==typeof t.inspect)return t.inspect()}if(function(e){if(!s||!e||"object"!=typeof e)return!1;try{s.call(e);try{l.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(t)){var ce=[];return o&&o.call(t,(function(e,n){ce.push($(n,t,!0)+" => "+$(e,t))})),X("Map",s.call(t),ce,U)}if(function(e){if(!l||!e||"object"!=typeof e)return!1;try{l.call(e);try{s.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(t)){var le=[];return u&&u.call(t,(function(e){le.push($(e,t))})),X("Set",l.call(t),le,U)}if(function(e){if(!h||!e||"object"!=typeof e)return!1;try{h.call(e,h);try{d.call(e,d)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}(t))return Q("WeakMap");if(function(e){if(!d||!e||"object"!=typeof e)return!1;try{d.call(e,d);try{h.call(e,h)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}(t))return Q("WeakSet");if(function(e){if(!p||!e||"object"!=typeof e)return!1;try{return p.call(e),!0}catch(e){}return!1}(t))return Q("WeakRef");if(function(e){return!("[object Number]"!==G(e)||R&&"object"==typeof e&&R in e)}(t))return J($(Number(t)));if(function(e){if(!e||"object"!=typeof e||!k)return!1;try{return k.call(e),!0}catch(e){}return!1}(t))return J($(k.call(t)));if(function(e){return!("[object Boolean]"!==G(e)||R&&"object"==typeof e&&R in e)}(t))return J(f.call(t));if(function(e){return!("[object String]"!==G(e)||R&&"object"==typeof e&&R in e)}(t))return J($(String(t)));if("undefined"!=typeof window&&t===window)return"{ [object Window] }";if(t===n.g)return"{ [object globalThis] }";if(!function(e){return!("[object Date]"!==G(e)||R&&"object"==typeof e&&R in e)}(t)&&!z(t)){var ue=Y(t,$),he=F?F(t)===Object.prototype:t instanceof Object||t.constructor===Object,de=t instanceof Object?"":"null prototype",pe=!he&&R&&Object(t)===t&&R in t?v.call(G(t),8,-1):de?"Object":"",fe=(he||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(pe||de?"["+E.call(C.call([],pe||[],de||[]),": ")+"] ":"");return 0===ue.length?fe+"{}":U?fe+"{"+Z(ue,U)+"}":fe+"{ "+E.call(ue,", ")+" }"}return String(t)};var U=Object.prototype.hasOwnProperty||function(e){return e in this};function V(e,t){return U.call(e,t)}function G(e){return g.call(e)}function W(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function K(e,t){if(e.length>t.maxStringLength){var n=e.length-t.maxStringLength,r="... "+n+" more character"+(n>1?"s":"");return K(v.call(e,0,t.maxStringLength),t)+r}return q(b.call(b.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,$),"single",t)}function $(e){var t=e.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return n?"\\"+n:"\\x"+(t<16?"0":"")+S.call(t.toString(16))}function J(e){return"Object("+e+")"}function Q(e){return e+" { ? }"}function X(e,t,n,r){return e+" ("+t+") {"+(r?Z(n,r):E.call(n,", "))+"}"}function Z(e,t){if(0===e.length)return"";var n="\n"+t.prev+t.base;return n+E.call(e,","+n)+"\n"+t.prev}function Y(e,t){var n=j(e),r=[];if(n){r.length=e.length;for(var i=0;i<e.length;i++)r[i]=V(e,i)?t(e[i],e):""}var s,o="function"==typeof N?N(e):[];if(P){s={};for(var a=0;a<o.length;a++)s["$"+o[a]]=o[a]}for(var c in e)V(e,c)&&(n&&String(Number(c))===c&&c<e.length||P&&s["$"+c]instanceof Symbol||(x.call(/[^\w$]/,c)?r.push(t(c,e)+": "+t(e[c],e)):r.push(c+": "+t(e[c],e))));if("function"==typeof N)for(var l=0;l<o.length;l++)I.call(e,o[l])&&r.push("["+t(o[l])+"]: "+t(e[o[l]],e));return r}},6470:e=>{"use strict";function t(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function n(e,t){for(var n,r="",i=0,s=-1,o=0,a=0;a<=e.length;++a){if(a<e.length)n=e.charCodeAt(a);else{if(47===n)break;n=47}if(47===n){if(s===a-1||1===o);else if(s!==a-1&&2===o){if(r.length<2||2!==i||46!==r.charCodeAt(r.length-1)||46!==r.charCodeAt(r.length-2))if(r.length>2){var c=r.lastIndexOf("/");if(c!==r.length-1){-1===c?(r="",i=0):i=(r=r.slice(0,c)).length-1-r.lastIndexOf("/"),s=a,o=0;continue}}else if(2===r.length||1===r.length){r="",i=0,s=a,o=0;continue}t&&(r.length>0?r+="/..":r="..",i=2)}else r.length>0?r+="/"+e.slice(s+1,a):r=e.slice(s+1,a),i=a-s-1;s=a,o=0}else 46===n&&-1!==o?++o:o=-1}return r}var r={resolve:function(){for(var e,r="",i=!1,s=arguments.length-1;s>=-1&&!i;s--){var o;s>=0?o=arguments[s]:(void 0===e&&(e=process.cwd()),o=e),t(o),0!==o.length&&(r=o+"/"+r,i=47===o.charCodeAt(0))}return r=n(r,!i),i?r.length>0?"/"+r:"/":r.length>0?r:"."},normalize:function(e){if(t(e),0===e.length)return".";var r=47===e.charCodeAt(0),i=47===e.charCodeAt(e.length-1);return 0!==(e=n(e,!r)).length||r||(e="."),e.length>0&&i&&(e+="/"),r?"/"+e:e},isAbsolute:function(e){return t(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,n=0;n<arguments.length;++n){var i=arguments[n];t(i),i.length>0&&(void 0===e?e=i:e+="/"+i)}return void 0===e?".":r.normalize(e)},relative:function(e,n){if(t(e),t(n),e===n)return"";if((e=r.resolve(e))===(n=r.resolve(n)))return"";for(var i=1;i<e.length&&47===e.charCodeAt(i);++i);for(var s=e.length,o=s-i,a=1;a<n.length&&47===n.charCodeAt(a);++a);for(var c=n.length-a,l=o<c?o:c,u=-1,h=0;h<=l;++h){if(h===l){if(c>l){if(47===n.charCodeAt(a+h))return n.slice(a+h+1);if(0===h)return n.slice(a+h)}else o>l&&(47===e.charCodeAt(i+h)?u=h:0===h&&(u=0));break}var d=e.charCodeAt(i+h);if(d!==n.charCodeAt(a+h))break;47===d&&(u=h)}var p="";for(h=i+u+1;h<=s;++h)h!==s&&47!==e.charCodeAt(h)||(0===p.length?p+="..":p+="/..");return p.length>0?p+n.slice(a+u):(a+=u,47===n.charCodeAt(a)&&++a,n.slice(a))},_makeLong:function(e){return e},dirname:function(e){if(t(e),0===e.length)return".";for(var n=e.charCodeAt(0),r=47===n,i=-1,s=!0,o=e.length-1;o>=1;--o)if(47===(n=e.charCodeAt(o))){if(!s){i=o;break}}else s=!1;return-1===i?r?"/":".":r&&1===i?"//":e.slice(0,i)},basename:function(e,n){if(void 0!==n&&"string"!=typeof n)throw new TypeError('"ext" argument must be a string');t(e);var r,i=0,s=-1,o=!0;if(void 0!==n&&n.length>0&&n.length<=e.length){if(n.length===e.length&&n===e)return"";var a=n.length-1,c=-1;for(r=e.length-1;r>=0;--r){var l=e.charCodeAt(r);if(47===l){if(!o){i=r+1;break}}else-1===c&&(o=!1,c=r+1),a>=0&&(l===n.charCodeAt(a)?-1==--a&&(s=r):(a=-1,s=c))}return i===s?s=c:-1===s&&(s=e.length),e.slice(i,s)}for(r=e.length-1;r>=0;--r)if(47===e.charCodeAt(r)){if(!o){i=r+1;break}}else-1===s&&(o=!1,s=r+1);return-1===s?"":e.slice(i,s)},extname:function(e){t(e);for(var n=-1,r=0,i=-1,s=!0,o=0,a=e.length-1;a>=0;--a){var c=e.charCodeAt(a);if(47!==c)-1===i&&(s=!1,i=a+1),46===c?-1===n?n=a:1!==o&&(o=1):-1!==n&&(o=-1);else if(!s){r=a+1;break}}return-1===n||-1===i||0===o||1===o&&n===i-1&&n===r+1?"":e.slice(n,i)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var n=t.dir||t.root,r=t.base||(t.name||"")+(t.ext||"");return n?n===t.root?n+r:n+"/"+r:r}(0,e)},parse:function(e){t(e);var n={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return n;var r,i=e.charCodeAt(0),s=47===i;s?(n.root="/",r=1):r=0;for(var o=-1,a=0,c=-1,l=!0,u=e.length-1,h=0;u>=r;--u)if(47!==(i=e.charCodeAt(u)))-1===c&&(l=!1,c=u+1),46===i?-1===o?o=u:1!==h&&(h=1):-1!==o&&(h=-1);else if(!l){a=u+1;break}return-1===o||-1===c||0===h||1===h&&o===c-1&&o===a+1?-1!==c&&(n.base=n.name=0===a&&s?e.slice(1,c):e.slice(a,c)):(0===a&&s?(n.name=e.slice(1,o),n.base=e.slice(1,c)):(n.name=e.slice(a,o),n.base=e.slice(a,c)),n.ext=e.slice(o,c)),a>0?n.dir=e.slice(0,a-1):s&&(n.dir="/"),n},sep:"/",delimiter:":",win32:null,posix:null};r.posix=r,e.exports=r},5798:e=>{"use strict";var t=String.prototype.replace,n=/%20/g,r="RFC3986";e.exports={default:r,formatters:{RFC1738:function(e){return t.call(e,n,"+")},RFC3986:function(e){return String(e)}},RFC1738:"RFC1738",RFC3986:r}},129:(e,t,n)=>{"use strict";var r=n(8261),i=n(5235),s=n(5798);e.exports={formats:s,parse:i,stringify:r}},5235:(e,t,n)=>{"use strict";var r=n(2769),i=Object.prototype.hasOwnProperty,s=Array.isArray,o={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:r.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},c=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},l=function(e,t,n,r){if(e){var s=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/g,a=n.depth>0&&/(\[[^[\]]*])/.exec(s),l=a?s.slice(0,a.index):s,u=[];if(l){if(!n.plainObjects&&i.call(Object.prototype,l)&&!n.allowPrototypes)return;u.push(l)}for(var h=0;n.depth>0&&null!==(a=o.exec(s))&&h<n.depth;){if(h+=1,!n.plainObjects&&i.call(Object.prototype,a[1].slice(1,-1))&&!n.allowPrototypes)return;u.push(a[1])}return a&&u.push("["+s.slice(a.index)+"]"),function(e,t,n,r){for(var i=r?t:c(t,n),s=e.length-1;s>=0;--s){var o,a=e[s];if("[]"===a&&n.parseArrays)o=[].concat(i);else{o=n.plainObjects?Object.create(null):{};var l="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,u=parseInt(l,10);n.parseArrays||""!==l?!isNaN(u)&&a!==l&&String(u)===l&&u>=0&&n.parseArrays&&u<=n.arrayLimit?(o=[])[u]=i:"__proto__"!==l&&(o[l]=i):o={0:i}}i=o}return i}(u,t,n,r)}};e.exports=function(e,t){var n=function(e){if(!e)return o;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?o.charset:e.charset;return{allowDots:void 0===e.allowDots?o.allowDots:!!e.allowDots,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:o.allowPrototypes,allowSparse:"boolean"==typeof e.allowSparse?e.allowSparse:o.allowSparse,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:o.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:o.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:o.comma,decoder:"function"==typeof e.decoder?e.decoder:o.decoder,delimiter:"string"==typeof e.delimiter||r.isRegExp(e.delimiter)?e.delimiter:o.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:o.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:o.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:o.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:o.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:o.strictNullHandling}}(t);if(""===e||null==e)return n.plainObjects?Object.create(null):{};for(var u="string"==typeof e?function(e,t){var n,l={__proto__:null},u=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,h=t.parameterLimit===1/0?void 0:t.parameterLimit,d=u.split(t.delimiter,h),p=-1,f=t.charset;if(t.charsetSentinel)for(n=0;n<d.length;++n)0===d[n].indexOf("utf8=")&&("utf8=%E2%9C%93"===d[n]?f="utf-8":"utf8=%26%2310003%3B"===d[n]&&(f="iso-8859-1"),p=n,n=d.length);for(n=0;n<d.length;++n)if(n!==p){var g,m,y=d[n],v=y.indexOf("]="),b=-1===v?y.indexOf("="):v+1;-1===b?(g=t.decoder(y,o.decoder,f,"key"),m=t.strictNullHandling?null:""):(g=t.decoder(y.slice(0,b),o.decoder,f,"key"),m=r.maybeMap(c(y.slice(b+1),t),(function(e){return t.decoder(e,o.decoder,f,"value")}))),m&&t.interpretNumericEntities&&"iso-8859-1"===f&&(m=a(m)),y.indexOf("[]=")>-1&&(m=s(m)?[m]:m),i.call(l,g)?l[g]=r.combine(l[g],m):l[g]=m}return l}(e,n):e,h=n.plainObjects?Object.create(null):{},d=Object.keys(u),p=0;p<d.length;++p){var f=d[p],g=l(f,u[f],n,"string"==typeof e);h=r.merge(h,g,n)}return!0===n.allowSparse?h:r.compact(h)}},8261:(e,t,n)=>{"use strict";var r=n(7478),i=n(2769),s=n(5798),o=Object.prototype.hasOwnProperty,a={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},c=Array.isArray,l=Array.prototype.push,u=function(e,t){l.apply(e,c(t)?t:[t])},h=Date.prototype.toISOString,d=s.default,p={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:i.encode,encodeValuesOnly:!1,format:d,formatter:s.formatters[d],indices:!1,serializeDate:function(e){return h.call(e)},skipNulls:!1,strictNullHandling:!1},f={},g=function e(t,n,s,o,a,l,h,d,g,m,y,v,b,S,w,x){for(var C,E=t,T=x,A=0,k=!1;void 0!==(T=T.get(f))&&!k;){var N=T.get(t);if(A+=1,void 0!==N){if(N===A)throw new RangeError("Cyclic object value");k=!0}void 0===T.get(f)&&(A=0)}if("function"==typeof d?E=d(n,E):E instanceof Date?E=y(E):"comma"===s&&c(E)&&(E=i.maybeMap(E,(function(e){return e instanceof Date?y(e):e}))),null===E){if(a)return h&&!S?h(n,p.encoder,w,"key",v):n;E=""}if("string"==typeof(C=E)||"number"==typeof C||"boolean"==typeof C||"symbol"==typeof C||"bigint"==typeof C||i.isBuffer(E))return h?[b(S?n:h(n,p.encoder,w,"key",v))+"="+b(h(E,p.encoder,w,"value",v))]:[b(n)+"="+b(String(E))];var O,P=[];if(void 0===E)return P;if("comma"===s&&c(E))S&&h&&(E=i.maybeMap(E,h)),O=[{value:E.length>0?E.join(",")||null:void 0}];else if(c(d))O=d;else{var R=Object.keys(E);O=g?R.sort(g):R}for(var I=o&&c(E)&&1===E.length?n+"[]":n,F=0;F<O.length;++F){var D=O[F],M="object"==typeof D&&void 0!==D.value?D.value:E[D];if(!l||null!==M){var L=c(E)?"function"==typeof s?s(I,D):I:I+(m?"."+D:"["+D+"]");x.set(t,A);var _=r();_.set(f,x),u(P,e(M,L,s,o,a,l,"comma"===s&&S&&c(E)?null:h,d,g,m,y,v,b,S,w,_))}}return P};e.exports=function(e,t){var n,i=e,l=function(e){if(!e)return p;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||p.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=s.default;if(void 0!==e.format){if(!o.call(s.formatters,e.format))throw new TypeError("Unknown format option provided.");n=e.format}var r=s.formatters[n],i=p.filter;return("function"==typeof e.filter||c(e.filter))&&(i=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:p.addQueryPrefix,allowDots:void 0===e.allowDots?p.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:p.charsetSentinel,delimiter:void 0===e.delimiter?p.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:p.encode,encoder:"function"==typeof e.encoder?e.encoder:p.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:p.encodeValuesOnly,filter:i,format:n,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:p.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:p.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:p.strictNullHandling}}(t);"function"==typeof l.filter?i=(0,l.filter)("",i):c(l.filter)&&(n=l.filter);var h,d=[];if("object"!=typeof i||null===i)return"";h=t&&t.arrayFormat in a?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var f=a[h];if(t&&"commaRoundTrip"in t&&"boolean"!=typeof t.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var m="comma"===f&&t&&t.commaRoundTrip;n||(n=Object.keys(i)),l.sort&&n.sort(l.sort);for(var y=r(),v=0;v<n.length;++v){var b=n[v];l.skipNulls&&null===i[b]||u(d,g(i[b],b,f,m,l.strictNullHandling,l.skipNulls,l.encode?l.encoder:null,l.filter,l.sort,l.allowDots,l.serializeDate,l.format,l.formatter,l.encodeValuesOnly,l.charset,y))}var S=d.join(l.delimiter),w=!0===l.addQueryPrefix?"?":"";return l.charsetSentinel&&("iso-8859-1"===l.charset?w+="utf8=%26%2310003%3B&":w+="utf8=%E2%9C%93&"),S.length>0?w+S:""}},2769:(e,t,n)=>{"use strict";var r=n(5798),i=Object.prototype.hasOwnProperty,s=Array.isArray,o=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),a=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},r=0;r<e.length;++r)void 0!==e[r]&&(n[r]=e[r]);return n};e.exports={arrayToObject:a,assign:function(e,t){return Object.keys(t).reduce((function(e,n){return e[n]=t[n],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],r=0;r<t.length;++r)for(var i=t[r],o=i.obj[i.prop],a=Object.keys(o),c=0;c<a.length;++c){var l=a[c],u=o[l];"object"==typeof u&&null!==u&&-1===n.indexOf(u)&&(t.push({obj:o,prop:l}),n.push(u))}return function(e){for(;e.length>1;){var t=e.pop(),n=t.obj[t.prop];if(s(n)){for(var r=[],i=0;i<n.length;++i)void 0!==n[i]&&r.push(n[i]);t.obj[t.prop]=r}}}(t),e},decode:function(e,t,n){var r=e.replace(/\+/g," ");if("iso-8859-1"===n)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(e){return r}},encode:function(e,t,n,i,s){if(0===e.length)return e;var a=e;if("symbol"==typeof e?a=Symbol.prototype.toString.call(e):"string"!=typeof e&&(a=String(e)),"iso-8859-1"===n)return escape(a).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var c="",l=0;l<a.length;++l){var u=a.charCodeAt(l);45===u||46===u||95===u||126===u||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||s===r.RFC1738&&(40===u||41===u)?c+=a.charAt(l):u<128?c+=o[u]:u<2048?c+=o[192|u>>6]+o[128|63&u]:u<55296||u>=57344?c+=o[224|u>>12]+o[128|u>>6&63]+o[128|63&u]:(l+=1,u=65536+((1023&u)<<10|1023&a.charCodeAt(l)),c+=o[240|u>>18]+o[128|u>>12&63]+o[128|u>>6&63]+o[128|63&u])}return c},isBuffer:function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(s(e)){for(var n=[],r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)},merge:function e(t,n,r){if(!n)return t;if("object"!=typeof n){if(s(t))t.push(n);else{if(!t||"object"!=typeof t)return[t,n];(r&&(r.plainObjects||r.allowPrototypes)||!i.call(Object.prototype,n))&&(t[n]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(n);var o=t;return s(t)&&!s(n)&&(o=a(t,r)),s(t)&&s(n)?(n.forEach((function(n,s){if(i.call(t,s)){var o=t[s];o&&"object"==typeof o&&n&&"object"==typeof n?t[s]=e(o,n,r):t.push(n)}else t[s]=n})),t):Object.keys(n).reduce((function(t,s){var o=n[s];return i.call(t,s)?t[s]=e(t[s],o,r):t[s]=o,t}),o)}}},2587:e=>{"use strict";function t(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,n,r,i){n=n||"&",r=r||"=";var s={};if("string"!=typeof e||0===e.length)return s;var o=/\+/g;e=e.split(n);var a=1e3;i&&"number"==typeof i.maxKeys&&(a=i.maxKeys);var c=e.length;a>0&&c>a&&(c=a);for(var l=0;l<c;++l){var u,h,d,p,f=e[l].replace(o,"%20"),g=f.indexOf(r);g>=0?(u=f.substr(0,g),h=f.substr(g+1)):(u=f,h=""),d=decodeURIComponent(u),p=decodeURIComponent(h),t(s,d)?Array.isArray(s[d])?s[d].push(p):s[d]=[s[d],p]:s[d]=p}return s}},2361:e=>{"use strict";var t=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,n,r,i){return n=n||"&",r=r||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map((function(i){var s=encodeURIComponent(t(i))+r;return Array.isArray(e[i])?e[i].map((function(e){return s+encodeURIComponent(t(e))})).join(n):s+encodeURIComponent(t(e[i]))})).filter(Boolean).join(n):i?encodeURIComponent(t(i))+r+encodeURIComponent(t(e)):""}},7673:(e,t,n)=>{"use strict";n(2587),t.stringify=n(2361)},7129:(e,t)=>{"use strict";var n=Object.prototype.hasOwnProperty;function r(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function i(e){try{return encodeURIComponent(e)}catch(e){return null}}t.stringify=function(e,t){t=t||"";var r,s,o=[];for(s in"string"!=typeof t&&(t="?"),e)if(n.call(e,s)){if((r=e[s])||null!=r&&!isNaN(r)||(r=""),s=i(s),r=i(r),null===s||null===r)continue;o.push(s+"="+r)}return o.length?t+o.join("&"):""},t.parse=function(e){for(var t,n=/([^=?#&]+)=?([^&]*)/g,i={};t=n.exec(e);){var s=r(t[1]),o=r(t[2]);null===s||null===o||s in i||(i[s]=o)}return i}},4448:(e,t,n)=>{"use strict";var r=n(7294),i=n(4142);function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,a={};function c(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(a[e]=t,e=0;e<t.length;e++)o.add(t[e])}var u=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function g(e,t,n,r,i,s,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=o}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){m[e]=new g(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];m[t]=new g(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){m[e]=new g(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){m[e]=new g(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){m[e]=new g(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){m[e]=new g(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){m[e]=new g(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){m[e]=new g(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){m[e]=new g(e,5,!1,e.toLowerCase(),null,!1,!1)}));var y=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}function b(e,t,n,r){var i=m.hasOwnProperty(t)?m[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null==t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!h.call(f,e)||!h.call(p,e)&&(d.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(y,v);m[t]=new g(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(y,v);m[t]=new g(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(y,v);m[t]=new g(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){m[e]=new g(e,1,!1,e.toLowerCase(),null,!1,!1)})),m.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){m[e]=new g(e,1,!1,e.toLowerCase(),null,!0,!0)}));var S=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),x=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),k=Symbol.for("react.context"),N=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),I=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var F=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var D=Symbol.iterator;function M(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=D&&e[D]||e["@@iterator"])?e:null}var L,_=Object.assign;function q(e){if(void 0===L)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);L=t&&t[1]||""}return"\n"+L+e}var B=!1;function j(e,t){if(!e||B)return"";B=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var r=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){r=e}e.call(t.prototype)}else{try{throw Error()}catch(e){r=e}e()}}catch(t){if(t&&r&&"string"==typeof t.stack){for(var i=t.stack.split("\n"),s=r.stack.split("\n"),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(1!==o||1!==a)do{if(o--,0>--a||i[o]!==s[a]){var c="\n"+i[o].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}}while(1<=o&&0<=a);break}}}finally{B=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?q(e):""}function z(e){switch(e.tag){case 5:return q(e.type);case 16:return q("Lazy");case 13:return q("Suspense");case 19:return q("SuspenseList");case 0:case 2:case 15:return j(e.type,!1);case 11:return j(e.type.render,!1);case 1:return j(e.type,!0);default:return""}}function H(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case C:return"Fragment";case x:return"Portal";case T:return"Profiler";case E:return"StrictMode";case O:return"Suspense";case P:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case k:return(e.displayName||"Context")+".Consumer";case A:return(e._context.displayName||"Context")+".Provider";case N:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case R:return null!==(t=e.displayName||null)?t:H(e.type)||"Memo";case I:t=e._payload,e=e._init;try{return H(e(t))}catch(e){}}return null}function U(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return H(t);case 8:return t===E?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}function V(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function G(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function W(e){e._valueTracker||(e._valueTracker=function(e){var t=G(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var i=n.get,s=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function K(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=G(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function $(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function J(e,t){var n=t.checked;return _({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Q(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=V(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function X(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function Z(e,t){X(e,t);var n=V(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,V(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Y(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&$(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+V(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(s(91));return _({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(s(92));if(te(n)){if(1<n.length)throw Error(s(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:V(n)}}function se(e,t){var n=V(t.value),r=V(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ae(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ce(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ae(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var le,ue,he=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((le=le||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=le.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return ue(e,t)}))}:ue);function de(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function ge(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function me(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=ge(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(pe).forEach((function(e){fe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]}))}));var ye=_({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ve(e,t){if(t){if(ye[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(s(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(s(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(s(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Se=null;function we(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var xe=null,Ce=null,Ee=null;function Te(e){if(e=bi(e)){if("function"!=typeof xe)throw Error(s(280));var t=e.stateNode;t&&(t=wi(t),xe(e.stateNode,e.type,t))}}function Ae(e){Ce?Ee?Ee.push(e):Ee=[e]:Ce=e}function ke(){if(Ce){var e=Ce,t=Ee;if(Ee=Ce=null,Te(e),t)for(e=0;e<t.length;e++)Te(t[e])}}function Ne(e,t){return e(t)}function Oe(){}var Pe=!1;function Re(e,t,n){if(Pe)return e(t,n);Pe=!0;try{return Ne(e,t,n)}finally{Pe=!1,(null!==Ce||null!==Ee)&&(Oe(),ke())}}function Ie(e,t){var n=e.stateNode;if(null===n)return null;var r=wi(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(s(231,t,typeof n));return n}var Fe=!1;if(u)try{var De={};Object.defineProperty(De,"passive",{get:function(){Fe=!0}}),window.addEventListener("test",De,De),window.removeEventListener("test",De,De)}catch(ue){Fe=!1}function Me(e,t,n,r,i,s,o,a,c){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(e){this.onError(e)}}var Le=!1,_e=null,qe=!1,Be=null,je={onError:function(e){Le=!0,_e=e}};function ze(e,t,n,r,i,s,o,a,c){Le=!1,_e=null,Me.apply(je,arguments)}function He(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!=(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ue(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function Ve(e){if(He(e)!==e)throw Error(s(188))}function Ge(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=He(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(r=i.return)){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return Ve(i),e;if(o===r)return Ve(i),t;o=o.sibling}throw Error(s(188))}if(n.return!==r.return)n=i,r=o;else{for(var a=!1,c=i.child;c;){if(c===n){a=!0,n=i,r=o;break}if(c===r){a=!0,r=i,n=o;break}c=c.sibling}if(!a){for(c=o.child;c;){if(c===n){a=!0,n=o,r=i;break}if(c===r){a=!0,r=o,n=i;break}c=c.sibling}if(!a)throw Error(s(189))}}if(n.alternate!==r)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}(e))?We(e):null}function We(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=We(e);if(null!==t)return t;e=e.sibling}return null}var Ke=i.unstable_scheduleCallback,$e=i.unstable_cancelCallback,Je=i.unstable_shouldYield,Qe=i.unstable_requestPaint,Xe=i.unstable_now,Ze=i.unstable_getCurrentPriorityLevel,Ye=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,nt=i.unstable_LowPriority,rt=i.unstable_IdlePriority,it=null,st=null,ot=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(at(e)/ct|0)|0},at=Math.log,ct=Math.LN2,lt=64,ut=4194304;function ht(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,s=e.pingedLanes,o=268435455&n;if(0!==o){var a=o&~i;0!==a?r=ht(a):0!=(s&=o)&&(r=ht(s))}else 0!=(o=n&~i)?r=ht(o):0!==s&&(r=ht(s));if(0===r)return 0;if(0!==t&&t!==r&&0==(t&i)&&((i=r&-r)>=(s=t&-t)||16===i&&0!=(4194240&s)))return t;if(0!=(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-ot(t)),r|=e[n],t&=~i;return r}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!=(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function gt(){var e=lt;return 0==(4194240&(lt<<=1))&&(lt=64),e}function mt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function yt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=n}function vt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-ot(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var bt=0;function St(e){return 1<(e&=-e)?4<e?0!=(268435455&e)?16:536870912:4:1}var wt,xt,Ct,Et,Tt,At=!1,kt=[],Nt=null,Ot=null,Pt=null,Rt=new Map,It=new Map,Ft=[],Dt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Mt(e,t){switch(e){case"focusin":case"focusout":Nt=null;break;case"dragenter":case"dragleave":Ot=null;break;case"mouseover":case"mouseout":Pt=null;break;case"pointerover":case"pointerout":Rt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":It.delete(t.pointerId)}}function Lt(e,t,n,r,i,s){return null===e||e.nativeEvent!==s?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},null!==t&&null!==(t=bi(t))&&xt(t),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function _t(e){var t=vi(e.target);if(null!==t){var n=He(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ue(n)))return e.blockedOn=t,void Tt(e.priority,(function(){Ct(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function qt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Jt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=bi(n))&&xt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);Se=r,n.target.dispatchEvent(r),Se=null,t.shift()}return!0}function Bt(e,t,n){qt(e)&&n.delete(t)}function jt(){At=!1,null!==Nt&&qt(Nt)&&(Nt=null),null!==Ot&&qt(Ot)&&(Ot=null),null!==Pt&&qt(Pt)&&(Pt=null),Rt.forEach(Bt),It.forEach(Bt)}function zt(e,t){e.blockedOn===t&&(e.blockedOn=null,At||(At=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,jt)))}function Ht(e){function t(t){return zt(t,e)}if(0<kt.length){zt(kt[0],e);for(var n=1;n<kt.length;n++){var r=kt[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Nt&&zt(Nt,e),null!==Ot&&zt(Ot,e),null!==Pt&&zt(Pt,e),Rt.forEach(t),It.forEach(t),n=0;n<Ft.length;n++)(r=Ft[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Ft.length&&null===(n=Ft[0]).blockedOn;)_t(n),null===n.blockedOn&&Ft.shift()}var Ut=S.ReactCurrentBatchConfig,Vt=!0;function Gt(e,t,n,r){var i=bt,s=Ut.transition;Ut.transition=null;try{bt=1,Kt(e,t,n,r)}finally{bt=i,Ut.transition=s}}function Wt(e,t,n,r){var i=bt,s=Ut.transition;Ut.transition=null;try{bt=4,Kt(e,t,n,r)}finally{bt=i,Ut.transition=s}}function Kt(e,t,n,r){if(Vt){var i=Jt(e,t,n,r);if(null===i)Vr(e,t,r,$t,n),Mt(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return Nt=Lt(Nt,e,t,n,r,i),!0;case"dragenter":return Ot=Lt(Ot,e,t,n,r,i),!0;case"mouseover":return Pt=Lt(Pt,e,t,n,r,i),!0;case"pointerover":var s=i.pointerId;return Rt.set(s,Lt(Rt.get(s)||null,e,t,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,It.set(s,Lt(It.get(s)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(Mt(e,r),4&t&&-1<Dt.indexOf(e)){for(;null!==i;){var s=bi(i);if(null!==s&&wt(s),null===(s=Jt(e,t,n,r))&&Vr(e,t,r,$t,n),s===i)break;i=s}null!==i&&r.stopPropagation()}else Vr(e,t,r,null,n)}}var $t=null;function Jt(e,t,n,r){if($t=null,null!==(e=vi(e=we(r))))if(null===(t=He(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ue(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return $t=e,null}function Qt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ze()){case Ye:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Xt=null,Zt=null,Yt=null;function en(){if(Yt)return Yt;var e,t,n=Zt,r=n.length,i="value"in Xt?Xt.value:Xt.textContent,s=i.length;for(e=0;e<r&&n[e]===i[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===i[s-t];t++);return Yt=i.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function sn(e){function t(t,n,r,i,s){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=s,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return _(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var on,an,cn,ln={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=sn(ln),hn=_({},ln,{view:0,detail:0}),dn=sn(hn),pn=_({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==cn&&(cn&&"mousemove"===e.type?(on=e.screenX-cn.screenX,an=e.screenY-cn.screenY):an=on=0,cn=e),on)},movementY:function(e){return"movementY"in e?e.movementY:an}}),fn=sn(pn),gn=sn(_({},pn,{dataTransfer:0})),mn=sn(_({},hn,{relatedTarget:0})),yn=sn(_({},ln,{animationName:0,elapsedTime:0,pseudoElement:0})),vn=_({},ln,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=sn(vn),Sn=sn(_({},ln,{data:0})),wn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Cn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function En(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Cn[e])&&!!t[e]}function Tn(){return En}var An=_({},hn,{key:function(e){if(e.key){var t=wn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?xn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),kn=sn(An),Nn=sn(_({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),On=sn(_({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tn})),Pn=sn(_({},ln,{propertyName:0,elapsedTime:0,pseudoElement:0})),Rn=_({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),In=sn(Rn),Fn=[9,13,27,32],Dn=u&&"CompositionEvent"in window,Mn=null;u&&"documentMode"in document&&(Mn=document.documentMode);var Ln=u&&"TextEvent"in window&&!Mn,_n=u&&(!Dn||Mn&&8<Mn&&11>=Mn),qn=String.fromCharCode(32),Bn=!1;function jn(e,t){switch(e){case"keyup":return-1!==Fn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zn(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Hn=!1,Un={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Un[e.type]:"textarea"===t}function Gn(e,t,n,r){Ae(r),0<(t=Wr(t,"onChange")).length&&(n=new un("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Wn=null,Kn=null;function $n(e){qr(e,0)}function Jn(e){if(K(Si(e)))return e}function Qn(e,t){if("change"===e)return t}var Xn=!1;if(u){var Zn;if(u){var Yn="oninput"in document;if(!Yn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Yn="function"==typeof er.oninput}Zn=Yn}else Zn=!1;Xn=Zn&&(!document.documentMode||9<document.documentMode)}function tr(){Wn&&(Wn.detachEvent("onpropertychange",nr),Kn=Wn=null)}function nr(e){if("value"===e.propertyName&&Jn(Kn)){var t=[];Gn(t,Kn,e,we(e)),Re($n,t)}}function rr(e,t,n){"focusin"===e?(tr(),Kn=n,(Wn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Jn(Kn)}function sr(e,t){if("click"===e)return Jn(t)}function or(e,t){if("input"===e||"change"===e)return Jn(t)}var ar="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function cr(e,t){if(ar(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!h.call(t,i)||!ar(e[i],t[i]))return!1}return!0}function lr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ur(e,t){var n,r=lr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=lr(r)}}function hr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function dr(){for(var e=window,t=$();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(!n)break;t=$((e=t.contentWindow).document)}return t}function pr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fr(e){var t=dr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&hr(n.ownerDocument.documentElement,n)){if(null!==r&&pr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=void 0===r.end?s:Math.min(r.end,i),!e.extend&&s>r&&(i=r,r=s,s=i),i=ur(n,s);var o=ur(n,r);i&&o&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),s>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var gr=u&&"documentMode"in document&&11>=document.documentMode,mr=null,yr=null,vr=null,br=!1;function Sr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;br||null==mr||mr!==$(r)||(r="selectionStart"in(r=mr)&&pr(r)?{start:r.selectionStart,end:r.selectionEnd}:{anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},vr&&cr(vr,r)||(vr=r,0<(r=Wr(yr,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=mr)))}function wr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var xr={animationend:wr("Animation","AnimationEnd"),animationiteration:wr("Animation","AnimationIteration"),animationstart:wr("Animation","AnimationStart"),transitionend:wr("Transition","TransitionEnd")},Cr={},Er={};function Tr(e){if(Cr[e])return Cr[e];if(!xr[e])return e;var t,n=xr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Er)return Cr[e]=n[t];return e}u&&(Er=document.createElement("div").style,"AnimationEvent"in window||(delete xr.animationend.animation,delete xr.animationiteration.animation,delete xr.animationstart.animation),"TransitionEvent"in window||delete xr.transitionend.transition);var Ar=Tr("animationend"),kr=Tr("animationiteration"),Nr=Tr("animationstart"),Or=Tr("transitionend"),Pr=new Map,Rr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ir(e,t){Pr.set(e,t),c(t,[e])}for(var Fr=0;Fr<Rr.length;Fr++){var Dr=Rr[Fr];Ir(Dr.toLowerCase(),"on"+(Dr[0].toUpperCase()+Dr.slice(1)))}Ir(Ar,"onAnimationEnd"),Ir(kr,"onAnimationIteration"),Ir(Nr,"onAnimationStart"),Ir("dblclick","onDoubleClick"),Ir("focusin","onFocus"),Ir("focusout","onBlur"),Ir(Or,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Mr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Lr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Mr));function _r(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,o,a,c,l){if(ze.apply(this,arguments),Le){if(!Le)throw Error(s(198));var u=_e;Le=!1,_e=null,qe||(qe=!0,Be=u)}}(r,t,void 0,e),e.currentTarget=null}function qr(e,t){t=0!=(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var s=void 0;if(t)for(var o=r.length-1;0<=o;o--){var a=r[o],c=a.instance,l=a.currentTarget;if(a=a.listener,c!==s&&i.isPropagationStopped())break e;_r(i,a,l),s=c}else for(o=0;o<r.length;o++){if(c=(a=r[o]).instance,l=a.currentTarget,a=a.listener,c!==s&&i.isPropagationStopped())break e;_r(i,a,l),s=c}}}if(qe)throw e=Be,qe=!1,Be=null,e}function Br(e,t){var n=t[gi];void 0===n&&(n=t[gi]=new Set);var r=e+"__bubble";n.has(r)||(Ur(t,e,2,!1),n.add(r))}function jr(e,t,n){var r=0;t&&(r|=4),Ur(n,e,r,t)}var zr="_reactListening"+Math.random().toString(36).slice(2);function Hr(e){if(!e[zr]){e[zr]=!0,o.forEach((function(t){"selectionchange"!==t&&(Lr.has(t)||jr(t,!1,e),jr(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[zr]||(t[zr]=!0,jr("selectionchange",!1,t))}}function Ur(e,t,n,r){switch(Qt(t)){case 1:var i=Gt;break;case 4:i=Wt;break;default:i=Kt}n=i.bind(null,t,n,e),i=void 0,!Fe||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Vr(e,t,n,r,i){var s=r;if(0==(1&t)&&0==(2&t)&&null!==r)e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var a=r.stateNode.containerInfo;if(a===i||8===a.nodeType&&a.parentNode===i)break;if(4===o)for(o=r.return;null!==o;){var c=o.tag;if((3===c||4===c)&&((c=o.stateNode.containerInfo)===i||8===c.nodeType&&c.parentNode===i))return;o=o.return}for(;null!==a;){if(null===(o=vi(a)))return;if(5===(c=o.tag)||6===c){r=s=o;continue e}a=a.parentNode}}r=r.return}Re((function(){var r=s,i=we(n),o=[];e:{var a=Pr.get(e);if(void 0!==a){var c=un,l=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":c=kn;break;case"focusin":l="focus",c=mn;break;case"focusout":l="blur",c=mn;break;case"beforeblur":case"afterblur":c=mn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=gn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=On;break;case Ar:case kr:case Nr:c=yn;break;case Or:c=Pn;break;case"scroll":c=dn;break;case"wheel":c=In;break;case"copy":case"cut":case"paste":c=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=Nn}var u=0!=(4&t),h=!u&&"scroll"===e,d=u?null!==a?a+"Capture":null:a;u=[];for(var p,f=r;null!==f;){var g=(p=f).stateNode;if(5===p.tag&&null!==g&&(p=g,null!==d&&null!=(g=Ie(f,d))&&u.push(Gr(f,g,p))),h)break;f=f.return}0<u.length&&(a=new c(a,l,null,n,i),o.push({event:a,listeners:u}))}}if(0==(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||n===Se||!(l=n.relatedTarget||n.fromElement)||!vi(l)&&!l[fi])&&(c||a)&&(a=i.window===i?i:(a=i.ownerDocument)?a.defaultView||a.parentWindow:window,c?(c=r,null!==(l=(l=n.relatedTarget||n.toElement)?vi(l):null)&&(l!==(h=He(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(c=null,l=r),c!==l)){if(u=fn,g="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=Nn,g="onPointerLeave",d="onPointerEnter",f="pointer"),h=null==c?a:Si(c),p=null==l?a:Si(l),(a=new u(g,f+"leave",c,n,i)).target=h,a.relatedTarget=p,g=null,vi(i)===r&&((u=new u(d,f+"enter",l,n,i)).target=p,u.relatedTarget=h,g=u),h=g,c&&l)e:{for(d=l,f=0,p=u=c;p;p=Kr(p))f++;for(p=0,g=d;g;g=Kr(g))p++;for(;0<f-p;)u=Kr(u),f--;for(;0<p-f;)d=Kr(d),p--;for(;f--;){if(u===d||null!==d&&u===d.alternate)break e;u=Kr(u),d=Kr(d)}u=null}else u=null;null!==c&&$r(o,a,c,u,!1),null!==l&&null!==h&&$r(o,h,l,u,!0)}if("select"===(c=(a=r?Si(r):window).nodeName&&a.nodeName.toLowerCase())||"input"===c&&"file"===a.type)var m=Qn;else if(Vn(a))if(Xn)m=or;else{m=ir;var y=rr}else(c=a.nodeName)&&"input"===c.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(m=sr);switch(m&&(m=m(e,r))?Gn(o,m,n,i):(y&&y(e,a,r),"focusout"===e&&(y=a._wrapperState)&&y.controlled&&"number"===a.type&&ee(a,"number",a.value)),y=r?Si(r):window,e){case"focusin":(Vn(y)||"true"===y.contentEditable)&&(mr=y,yr=r,vr=null);break;case"focusout":vr=yr=mr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,Sr(o,n,i);break;case"selectionchange":if(gr)break;case"keydown":case"keyup":Sr(o,n,i)}var v;if(Dn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Hn?jn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(_n&&"ko"!==n.locale&&(Hn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Hn&&(v=en()):(Zt="value"in(Xt=i)?Xt.value:Xt.textContent,Hn=!0)),0<(y=Wr(r,b)).length&&(b=new Sn(b,e,null,n,i),o.push({event:b,listeners:y}),(v||null!==(v=zn(n)))&&(b.data=v))),(v=Ln?function(e,t){switch(e){case"compositionend":return zn(t);case"keypress":return 32!==t.which?null:(Bn=!0,qn);case"textInput":return(e=t.data)===qn&&Bn?null:e;default:return null}}(e,n):function(e,t){if(Hn)return"compositionend"===e||!Dn&&jn(e,t)?(e=en(),Yt=Zt=Xt=null,Hn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return _n&&"ko"!==t.locale?null:t.data}}(e,n))&&0<(r=Wr(r,"onBeforeInput")).length&&(i=new Sn("onBeforeInput","beforeinput",null,n,i),o.push({event:i,listeners:r}),i.data=v)}qr(o,t)}))}function Gr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Wr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,s=i.stateNode;5===i.tag&&null!==s&&(i=s,null!=(s=Ie(e,n))&&r.unshift(Gr(e,s,i)),null!=(s=Ie(e,t))&&r.push(Gr(e,s,i))),e=e.return}return r}function Kr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function $r(e,t,n,r,i){for(var s=t._reactName,o=[];null!==n&&n!==r;){var a=n,c=a.alternate,l=a.stateNode;if(null!==c&&c===r)break;5===a.tag&&null!==l&&(a=l,i?null!=(c=Ie(n,s))&&o.unshift(Gr(n,c,a)):i||null!=(c=Ie(n,s))&&o.push(Gr(n,c,a))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Jr=/\r\n?/g,Qr=/\u0000|\uFFFD/g;function Xr(e){return("string"==typeof e?e:""+e).replace(Jr,"\n").replace(Qr,"")}function Zr(e,t,n){if(t=Xr(t),Xr(e)!==t&&n)throw Error(s(425))}function Yr(){}var ei=null,ti=null;function ni(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ri="function"==typeof setTimeout?setTimeout:void 0,ii="function"==typeof clearTimeout?clearTimeout:void 0,si="function"==typeof Promise?Promise:void 0,oi="function"==typeof queueMicrotask?queueMicrotask:void 0!==si?function(e){return si.resolve(null).then(e).catch(ai)}:ri;function ai(e){setTimeout((function(){throw e}))}function ci(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void Ht(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);Ht(t)}function li(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ui(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var hi=Math.random().toString(36).slice(2),di="__reactFiber$"+hi,pi="__reactProps$"+hi,fi="__reactContainer$"+hi,gi="__reactEvents$"+hi,mi="__reactListeners$"+hi,yi="__reactHandles$"+hi;function vi(e){var t=e[di];if(t)return t;for(var n=e.parentNode;n;){if(t=n[fi]||n[di]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ui(e);null!==e;){if(n=e[di])return n;e=ui(e)}return t}n=(e=n).parentNode}return null}function bi(e){return!(e=e[di]||e[fi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Si(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(s(33))}function wi(e){return e[pi]||null}var xi=[],Ci=-1;function Ei(e){return{current:e}}function Ti(e){0>Ci||(e.current=xi[Ci],xi[Ci]=null,Ci--)}function Ai(e,t){Ci++,xi[Ci]=e.current,e.current=t}var ki={},Ni=Ei(ki),Oi=Ei(!1),Pi=ki;function Ri(e,t){var n=e.type.contextTypes;if(!n)return ki;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,s={};for(i in n)s[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function Ii(e){return null!=e.childContextTypes}function Fi(){Ti(Oi),Ti(Ni)}function Di(e,t,n){if(Ni.current!==ki)throw Error(s(168));Ai(Ni,t),Ai(Oi,n)}function Mi(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!=typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(s(108,U(e)||"Unknown",i));return _({},n,r)}function Li(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ki,Pi=Ni.current,Ai(Ni,e),Ai(Oi,Oi.current),!0}function _i(e,t,n){var r=e.stateNode;if(!r)throw Error(s(169));n?(e=Mi(e,t,Pi),r.__reactInternalMemoizedMergedChildContext=e,Ti(Oi),Ti(Ni),Ai(Ni,e)):Ti(Oi),Ai(Oi,n)}var qi=null,Bi=!1,ji=!1;function zi(e){null===qi?qi=[e]:qi.push(e)}function Hi(){if(!ji&&null!==qi){ji=!0;var e=0,t=bt;try{var n=qi;for(bt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}qi=null,Bi=!1}catch(t){throw null!==qi&&(qi=qi.slice(e+1)),Ke(Ye,Hi),t}finally{bt=t,ji=!1}}return null}var Ui=[],Vi=0,Gi=null,Wi=0,Ki=[],$i=0,Ji=null,Qi=1,Xi="";function Zi(e,t){Ui[Vi++]=Wi,Ui[Vi++]=Gi,Gi=e,Wi=t}function Yi(e,t,n){Ki[$i++]=Qi,Ki[$i++]=Xi,Ki[$i++]=Ji,Ji=e;var r=Qi;e=Xi;var i=32-ot(r)-1;r&=~(1<<i),n+=1;var s=32-ot(t)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Qi=1<<32-ot(t)+i|n<<i|r,Xi=s+e}else Qi=1<<s|n<<i|r,Xi=e}function es(e){null!==e.return&&(Zi(e,1),Yi(e,1,0))}function ts(e){for(;e===Gi;)Gi=Ui[--Vi],Ui[Vi]=null,Wi=Ui[--Vi],Ui[Vi]=null;for(;e===Ji;)Ji=Ki[--$i],Ki[$i]=null,Xi=Ki[--$i],Ki[$i]=null,Qi=Ki[--$i],Ki[$i]=null}var ns=null,rs=null,is=!1,ss=null;function os(e,t){var n=Il(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function as(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ns=e,rs=li(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ns=e,rs=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Ji?{id:Qi,overflow:Xi}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Il(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ns=e,rs=null,!0);default:return!1}}function cs(e){return 0!=(1&e.mode)&&0==(128&e.flags)}function ls(e){if(is){var t=rs;if(t){var n=t;if(!as(e,t)){if(cs(e))throw Error(s(418));t=li(n.nextSibling);var r=ns;t&&as(e,t)?os(r,n):(e.flags=-4097&e.flags|2,is=!1,ns=e)}}else{if(cs(e))throw Error(s(418));e.flags=-4097&e.flags|2,is=!1,ns=e}}}function us(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ns=e}function hs(e){if(e!==ns)return!1;if(!is)return us(e),is=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ni(e.type,e.memoizedProps)),t&&(t=rs)){if(cs(e))throw ds(),Error(s(418));for(;t;)os(e,t),t=li(t.nextSibling)}if(us(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){rs=li(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}rs=null}}else rs=ns?li(e.stateNode.nextSibling):null;return!0}function ds(){for(var e=rs;e;)e=li(e.nextSibling)}function ps(){rs=ns=null,is=!1}function fs(e){null===ss?ss=[e]:ss.push(e)}var gs=S.ReactCurrentBatchConfig;function ms(e,t){if(e&&e.defaultProps){for(var n in t=_({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var ys=Ei(null),vs=null,bs=null,Ss=null;function ws(){Ss=bs=vs=null}function xs(e){var t=ys.current;Ti(ys),e._currentValue=t}function Cs(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Es(e,t){vs=e,Ss=bs=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!=(e.lanes&t)&&(Sa=!0),e.firstContext=null)}function Ts(e){var t=e._currentValue;if(Ss!==e)if(e={context:e,memoizedValue:t,next:null},null===bs){if(null===vs)throw Error(s(308));bs=e,vs.dependencies={lanes:0,firstContext:e}}else bs=bs.next=e;return t}var As=null;function ks(e){null===As?As=[e]:As.push(e)}function Ns(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,ks(t)):(n.next=i.next,i.next=n),t.interleaved=n,Os(e,r)}function Os(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Ps=!1;function Rs(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Is(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Fs(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ds(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!=(2&Oc)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,Os(e,n)}return null===(i=r.interleaved)?(t.next=t,ks(r)):(t.next=i.next,i.next=t),r.interleaved=t,Os(e,n)}function Ms(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!=(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,vt(e,n)}}function Ls(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,s=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===s?i=s=o:s=s.next=o,n=n.next}while(null!==n);null===s?i=s=t:s=s.next=t}else i=s=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function _s(e,t,n,r){var i=e.updateQueue;Ps=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(null!==a){i.shared.pending=null;var c=a,l=c.next;c.next=null,null===o?s=l:o.next=l,o=c;var u=e.alternate;null!==u&&(a=(u=u.updateQueue).lastBaseUpdate)!==o&&(null===a?u.firstBaseUpdate=l:a.next=l,u.lastBaseUpdate=c)}if(null!==s){var h=i.baseState;for(o=0,u=l=c=null,a=s;;){var d=a.lane,p=a.eventTime;if((r&d)===d){null!==u&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=e,g=a;switch(d=t,p=n,g.tag){case 1:if("function"==typeof(f=g.payload)){h=f.call(p,h,d);break e}h=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null==(d="function"==typeof(f=g.payload)?f.call(p,h,d):f))break e;h=_({},h,d);break e;case 2:Ps=!0}}null!==a.callback&&0!==a.lane&&(e.flags|=64,null===(d=i.effects)?i.effects=[a]:d.push(a))}else p={eventTime:p,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===u?(l=u=p,c=h):u=u.next=p,o|=d;if(null===(a=a.next)){if(null===(a=i.shared.pending))break;a=(d=a).next,d.next=null,i.lastBaseUpdate=d,i.shared.pending=null}}if(null===u&&(c=h),i.baseState=c,i.firstBaseUpdate=l,i.lastBaseUpdate=u,null!==(t=i.shared.interleaved)){i=t;do{o|=i.lane,i=i.next}while(i!==t)}else null===s&&(i.shared.lanes=0);_c|=o,e.lanes=o,e.memoizedState=h}}function qs(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!=typeof i)throw Error(s(191,i));i.call(r)}}}var Bs=(new r.Component).refs;function js(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:_({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var zs={isMounted:function(e){return!!(e=e._reactInternals)&&He(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=tl(),i=nl(e),s=Fs(r,i);s.payload=t,null!=n&&(s.callback=n),null!==(t=Ds(e,s,i))&&(rl(t,e,i,r),Ms(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=tl(),i=nl(e),s=Fs(r,i);s.tag=1,s.payload=t,null!=n&&(s.callback=n),null!==(t=Ds(e,s,i))&&(rl(t,e,i,r),Ms(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tl(),r=nl(e),i=Fs(n,r);i.tag=2,null!=t&&(i.callback=t),null!==(t=Ds(e,i,r))&&(rl(t,e,r,n),Ms(t,e,r))}};function Hs(e,t,n,r,i,s,o){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,s,o):!(t.prototype&&t.prototype.isPureReactComponent&&cr(n,r)&&cr(i,s))}function Us(e,t,n){var r=!1,i=ki,s=t.contextType;return"object"==typeof s&&null!==s?s=Ts(s):(i=Ii(t)?Pi:Ni.current,s=(r=null!=(r=t.contextTypes))?Ri(e,i):ki),t=new t(n,s),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=zs,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=s),t}function Vs(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&zs.enqueueReplaceState(t,t.state,null)}function Gs(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=Bs,Rs(e);var s=t.contextType;"object"==typeof s&&null!==s?i.context=Ts(s):(s=Ii(t)?Pi:Ni.current,i.context=Ri(e,s)),i.state=e.memoizedState,"function"==typeof(s=t.getDerivedStateFromProps)&&(js(e,t,s,n),i.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof i.getSnapshotBeforeUpdate||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||(t=i.state,"function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&zs.enqueueReplaceState(i,i.state,null),_s(e,n,i,r),i.state=e.memoizedState),"function"==typeof i.componentDidMount&&(e.flags|=4194308)}function Ws(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var r=n.stateNode}if(!r)throw Error(s(147,e));var i=r,o=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=i.refs;t===Bs&&(t=i.refs={}),null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!=typeof e)throw Error(s(284));if(!n._owner)throw Error(s(290,e))}return e}function Ks(e,t){throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function $s(e){return(0,e._init)(e._payload)}function Js(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Dl(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function c(e,t,n,r){return null===t||6!==t.tag?((t=ql(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function l(e,t,n,r){var s=n.type;return s===C?h(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===s||"object"==typeof s&&null!==s&&s.$$typeof===I&&$s(s)===t.type)?((r=i(t,n.props)).ref=Ws(e,t,n),r.return=e,r):((r=Ml(n.type,n.key,n.props,null,e.mode,r)).ref=Ws(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Bl(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function h(e,t,n,r,s){return null===t||7!==t.tag?((t=Ll(n,e.mode,r,s)).return=e,t):((t=i(t,n)).return=e,t)}function d(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=ql(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case w:return(n=Ml(t.type,t.key,t.props,null,e.mode,n)).ref=Ws(e,null,t),n.return=e,n;case x:return(t=Bl(t,e.mode,n)).return=e,t;case I:return d(e,(0,t._init)(t._payload),n)}if(te(t)||M(t))return(t=Ll(t,e.mode,n,null)).return=e,t;Ks(e,t)}return null}function p(e,t,n,r){var i=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==i?null:c(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===i?l(e,t,n,r):null;case x:return n.key===i?u(e,t,n,r):null;case I:return p(e,t,(i=n._init)(n._payload),r)}if(te(n)||M(n))return null!==i?null:h(e,t,n,r,null);Ks(e,n)}return null}function f(e,t,n,r,i){if("string"==typeof r&&""!==r||"number"==typeof r)return c(t,e=e.get(n)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case w:return l(t,e=e.get(null===r.key?n:r.key)||null,r,i);case x:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i);case I:return f(e,t,n,(0,r._init)(r._payload),i)}if(te(r)||M(r))return h(t,e=e.get(n)||null,r,i,null);Ks(t,r)}return null}function g(i,s,a,c){for(var l=null,u=null,h=s,g=s=0,m=null;null!==h&&g<a.length;g++){h.index>g?(m=h,h=null):m=h.sibling;var y=p(i,h,a[g],c);if(null===y){null===h&&(h=m);break}e&&h&&null===y.alternate&&t(i,h),s=o(y,s,g),null===u?l=y:u.sibling=y,u=y,h=m}if(g===a.length)return n(i,h),is&&Zi(i,g),l;if(null===h){for(;g<a.length;g++)null!==(h=d(i,a[g],c))&&(s=o(h,s,g),null===u?l=h:u.sibling=h,u=h);return is&&Zi(i,g),l}for(h=r(i,h);g<a.length;g++)null!==(m=f(h,i,g,a[g],c))&&(e&&null!==m.alternate&&h.delete(null===m.key?g:m.key),s=o(m,s,g),null===u?l=m:u.sibling=m,u=m);return e&&h.forEach((function(e){return t(i,e)})),is&&Zi(i,g),l}function m(i,a,c,l){var u=M(c);if("function"!=typeof u)throw Error(s(150));if(null==(c=u.call(c)))throw Error(s(151));for(var h=u=null,g=a,m=a=0,y=null,v=c.next();null!==g&&!v.done;m++,v=c.next()){g.index>m?(y=g,g=null):y=g.sibling;var b=p(i,g,v.value,l);if(null===b){null===g&&(g=y);break}e&&g&&null===b.alternate&&t(i,g),a=o(b,a,m),null===h?u=b:h.sibling=b,h=b,g=y}if(v.done)return n(i,g),is&&Zi(i,m),u;if(null===g){for(;!v.done;m++,v=c.next())null!==(v=d(i,v.value,l))&&(a=o(v,a,m),null===h?u=v:h.sibling=v,h=v);return is&&Zi(i,m),u}for(g=r(i,g);!v.done;m++,v=c.next())null!==(v=f(g,i,m,v.value,l))&&(e&&null!==v.alternate&&g.delete(null===v.key?m:v.key),a=o(v,a,m),null===h?u=v:h.sibling=v,h=v);return e&&g.forEach((function(e){return t(i,e)})),is&&Zi(i,m),u}return function e(r,s,o,c){if("object"==typeof o&&null!==o&&o.type===C&&null===o.key&&(o=o.props.children),"object"==typeof o&&null!==o){switch(o.$$typeof){case w:e:{for(var l=o.key,u=s;null!==u;){if(u.key===l){if((l=o.type)===C){if(7===u.tag){n(r,u.sibling),(s=i(u,o.props.children)).return=r,r=s;break e}}else if(u.elementType===l||"object"==typeof l&&null!==l&&l.$$typeof===I&&$s(l)===u.type){n(r,u.sibling),(s=i(u,o.props)).ref=Ws(r,u,o),s.return=r,r=s;break e}n(r,u);break}t(r,u),u=u.sibling}o.type===C?((s=Ll(o.props.children,r.mode,c,o.key)).return=r,r=s):((c=Ml(o.type,o.key,o.props,null,r.mode,c)).ref=Ws(r,s,o),c.return=r,r=c)}return a(r);case x:e:{for(u=o.key;null!==s;){if(s.key===u){if(4===s.tag&&s.stateNode.containerInfo===o.containerInfo&&s.stateNode.implementation===o.implementation){n(r,s.sibling),(s=i(s,o.children||[])).return=r,r=s;break e}n(r,s);break}t(r,s),s=s.sibling}(s=Bl(o,r.mode,c)).return=r,r=s}return a(r);case I:return e(r,s,(u=o._init)(o._payload),c)}if(te(o))return g(r,s,o,c);if(M(o))return m(r,s,o,c);Ks(r,o)}return"string"==typeof o&&""!==o||"number"==typeof o?(o=""+o,null!==s&&6===s.tag?(n(r,s.sibling),(s=i(s,o)).return=r,r=s):(n(r,s),(s=ql(o,r.mode,c)).return=r,r=s),a(r)):n(r,s)}}var Qs=Js(!0),Xs=Js(!1),Zs={},Ys=Ei(Zs),eo=Ei(Zs),to=Ei(Zs);function no(e){if(e===Zs)throw Error(s(174));return e}function ro(e,t){switch(Ai(to,t),Ai(eo,e),Ai(Ys,Zs),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ce(null,"");break;default:t=ce(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ti(Ys),Ai(Ys,t)}function io(){Ti(Ys),Ti(eo),Ti(to)}function so(e){no(to.current);var t=no(Ys.current),n=ce(t,e.type);t!==n&&(Ai(eo,e),Ai(Ys,n))}function oo(e){eo.current===e&&(Ti(Ys),Ti(eo))}var ao=Ei(0);function co(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var lo=[];function uo(){for(var e=0;e<lo.length;e++)lo[e]._workInProgressVersionPrimary=null;lo.length=0}var ho=S.ReactCurrentDispatcher,po=S.ReactCurrentBatchConfig,fo=0,go=null,mo=null,yo=null,vo=!1,bo=!1,So=0,wo=0;function xo(){throw Error(s(321))}function Co(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ar(e[n],t[n]))return!1;return!0}function Eo(e,t,n,r,i,o){if(fo=o,go=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ho.current=null===e||null===e.memoizedState?aa:ca,e=n(r,i),bo){o=0;do{if(bo=!1,So=0,25<=o)throw Error(s(301));o+=1,yo=mo=null,t.updateQueue=null,ho.current=la,e=n(r,i)}while(bo)}if(ho.current=oa,t=null!==mo&&null!==mo.next,fo=0,yo=mo=go=null,vo=!1,t)throw Error(s(300));return e}function To(){var e=0!==So;return So=0,e}function Ao(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===yo?go.memoizedState=yo=e:yo=yo.next=e,yo}function ko(){if(null===mo){var e=go.alternate;e=null!==e?e.memoizedState:null}else e=mo.next;var t=null===yo?go.memoizedState:yo.next;if(null!==t)yo=t,mo=e;else{if(null===e)throw Error(s(310));e={memoizedState:(mo=e).memoizedState,baseState:mo.baseState,baseQueue:mo.baseQueue,queue:mo.queue,next:null},null===yo?go.memoizedState=yo=e:yo=yo.next=e}return yo}function No(e,t){return"function"==typeof t?t(e):t}function Oo(e){var t=ko(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=mo,i=r.baseQueue,o=n.pending;if(null!==o){if(null!==i){var a=i.next;i.next=o.next,o.next=a}r.baseQueue=i=o,n.pending=null}if(null!==i){o=i.next,r=r.baseState;var c=a=null,l=null,u=o;do{var h=u.lane;if((fo&h)===h)null!==l&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===l?(c=l=d,a=r):l=l.next=d,go.lanes|=h,_c|=h}u=u.next}while(null!==u&&u!==o);null===l?a=r:l.next=c,ar(r,t.memoizedState)||(Sa=!0),t.memoizedState=r,t.baseState=a,t.baseQueue=l,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{o=i.lane,go.lanes|=o,_c|=o,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Po(e){var t=ko(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,o=t.memoizedState;if(null!==i){n.pending=null;var a=i=i.next;do{o=e(o,a.action),a=a.next}while(a!==i);ar(o,t.memoizedState)||(Sa=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function Ro(){}function Io(e,t){var n=go,r=ko(),i=t(),o=!ar(r.memoizedState,i);if(o&&(r.memoizedState=i,Sa=!0),r=r.queue,Vo(Mo.bind(null,n,r,e),[e]),r.getSnapshot!==t||o||null!==yo&&1&yo.memoizedState.tag){if(n.flags|=2048,Bo(9,Do.bind(null,n,r,i,t),void 0,null),null===Pc)throw Error(s(349));0!=(30&fo)||Fo(n,t,i)}return i}function Fo(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=go.updateQueue)?(t={lastEffect:null,stores:null},go.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Do(e,t,n,r){t.value=n,t.getSnapshot=r,Lo(t)&&_o(e)}function Mo(e,t,n){return n((function(){Lo(t)&&_o(e)}))}function Lo(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!ar(e,n)}catch(e){return!0}}function _o(e){var t=Os(e,1);null!==t&&rl(t,e,1,-1)}function qo(e){var t=Ao();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:No,lastRenderedState:e},t.queue=e,e=e.dispatch=na.bind(null,go,e),[t.memoizedState,e]}function Bo(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=go.updateQueue)?(t={lastEffect:null,stores:null},go.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function jo(){return ko().memoizedState}function zo(e,t,n,r){var i=Ao();go.flags|=e,i.memoizedState=Bo(1|t,n,void 0,void 0===r?null:r)}function Ho(e,t,n,r){var i=ko();r=void 0===r?null:r;var s=void 0;if(null!==mo){var o=mo.memoizedState;if(s=o.destroy,null!==r&&Co(r,o.deps))return void(i.memoizedState=Bo(t,n,s,r))}go.flags|=e,i.memoizedState=Bo(1|t,n,s,r)}function Uo(e,t){return zo(8390656,8,e,t)}function Vo(e,t){return Ho(2048,8,e,t)}function Go(e,t){return Ho(4,2,e,t)}function Wo(e,t){return Ho(4,4,e,t)}function Ko(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function $o(e,t,n){return n=null!=n?n.concat([e]):null,Ho(4,4,Ko.bind(null,t,e),n)}function Jo(){}function Qo(e,t){var n=ko();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Co(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Xo(e,t){var n=ko();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Co(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Zo(e,t,n){return 0==(21&fo)?(e.baseState&&(e.baseState=!1,Sa=!0),e.memoizedState=n):(ar(n,t)||(n=gt(),go.lanes|=n,_c|=n,e.baseState=!0),t)}function Yo(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var r=po.transition;po.transition={};try{e(!1),t()}finally{bt=n,po.transition=r}}function ea(){return ko().memoizedState}function ta(e,t,n){var r=nl(e);n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},ra(e)?ia(t,n):null!==(n=Ns(e,t,n,r))&&(rl(n,e,r,tl()),sa(n,t,r))}function na(e,t,n){var r=nl(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(ra(e))ia(t,i);else{var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var o=t.lastRenderedState,a=s(o,n);if(i.hasEagerState=!0,i.eagerState=a,ar(a,o)){var c=t.interleaved;return null===c?(i.next=i,ks(t)):(i.next=c.next,c.next=i),void(t.interleaved=i)}}catch(e){}null!==(n=Ns(e,t,i,r))&&(rl(n,e,r,i=tl()),sa(n,t,r))}}function ra(e){var t=e.alternate;return e===go||null!==t&&t===go}function ia(e,t){bo=vo=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function sa(e,t,n){if(0!=(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,vt(e,n)}}var oa={readContext:Ts,useCallback:xo,useContext:xo,useEffect:xo,useImperativeHandle:xo,useInsertionEffect:xo,useLayoutEffect:xo,useMemo:xo,useReducer:xo,useRef:xo,useState:xo,useDebugValue:xo,useDeferredValue:xo,useTransition:xo,useMutableSource:xo,useSyncExternalStore:xo,useId:xo,unstable_isNewReconciler:!1},aa={readContext:Ts,useCallback:function(e,t){return Ao().memoizedState=[e,void 0===t?null:t],e},useContext:Ts,useEffect:Uo,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,zo(4194308,4,Ko.bind(null,t,e),n)},useLayoutEffect:function(e,t){return zo(4194308,4,e,t)},useInsertionEffect:function(e,t){return zo(4,2,e,t)},useMemo:function(e,t){var n=Ao();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Ao();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=ta.bind(null,go,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Ao().memoizedState=e},useState:qo,useDebugValue:Jo,useDeferredValue:function(e){return Ao().memoizedState=e},useTransition:function(){var e=qo(!1),t=e[0];return e=Yo.bind(null,e[1]),Ao().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=go,i=Ao();if(is){if(void 0===n)throw Error(s(407));n=n()}else{if(n=t(),null===Pc)throw Error(s(349));0!=(30&fo)||Fo(r,t,n)}i.memoizedState=n;var o={value:n,getSnapshot:t};return i.queue=o,Uo(Mo.bind(null,r,o,e),[e]),r.flags|=2048,Bo(9,Do.bind(null,r,o,n,t),void 0,null),n},useId:function(){var e=Ao(),t=Pc.identifierPrefix;if(is){var n=Xi;t=":"+t+"R"+(n=(Qi&~(1<<32-ot(Qi)-1)).toString(32)+n),0<(n=So++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=wo++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ca={readContext:Ts,useCallback:Qo,useContext:Ts,useEffect:Vo,useImperativeHandle:$o,useInsertionEffect:Go,useLayoutEffect:Wo,useMemo:Xo,useReducer:Oo,useRef:jo,useState:function(){return Oo(No)},useDebugValue:Jo,useDeferredValue:function(e){return Zo(ko(),mo.memoizedState,e)},useTransition:function(){return[Oo(No)[0],ko().memoizedState]},useMutableSource:Ro,useSyncExternalStore:Io,useId:ea,unstable_isNewReconciler:!1},la={readContext:Ts,useCallback:Qo,useContext:Ts,useEffect:Vo,useImperativeHandle:$o,useInsertionEffect:Go,useLayoutEffect:Wo,useMemo:Xo,useReducer:Po,useRef:jo,useState:function(){return Po(No)},useDebugValue:Jo,useDeferredValue:function(e){var t=ko();return null===mo?t.memoizedState=e:Zo(t,mo.memoizedState,e)},useTransition:function(){return[Po(No)[0],ko().memoizedState]},useMutableSource:Ro,useSyncExternalStore:Io,useId:ea,unstable_isNewReconciler:!1};function ua(e,t){try{var n="",r=t;do{n+=z(r),r=r.return}while(r);var i=n}catch(e){i="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:i,digest:null}}function ha(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function da(e,t){try{console.error(t.value)}catch(e){setTimeout((function(){throw e}))}}var pa="function"==typeof WeakMap?WeakMap:Map;function fa(e,t,n){(n=Fs(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Gc||(Gc=!0,Wc=r),da(0,t)},n}function ga(e,t,n){(n=Fs(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"==typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){da(0,t)}}var s=e.stateNode;return null!==s&&"function"==typeof s.componentDidCatch&&(n.callback=function(){da(0,t),"function"!=typeof r&&(null===Kc?Kc=new Set([this]):Kc.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ma(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new pa;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=Al.bind(null,e,t,n),t.then(e,e))}function ya(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function va(e,t,n,r,i){return 0==(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Fs(-1,1)).tag=2,Ds(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=i,e)}var ba=S.ReactCurrentOwner,Sa=!1;function wa(e,t,n,r){t.child=null===e?Xs(t,null,n,r):Qs(t,e.child,n,r)}function xa(e,t,n,r,i){n=n.render;var s=t.ref;return Es(t,i),r=Eo(e,t,n,r,s,i),n=To(),null===e||Sa?(is&&n&&es(t),t.flags|=1,wa(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Ga(e,t,i))}function Ca(e,t,n,r,i){if(null===e){var s=n.type;return"function"!=typeof s||Fl(s)||void 0!==s.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Ml(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,Ea(e,t,s,r,i))}if(s=e.child,0==(e.lanes&i)){var o=s.memoizedProps;if((n=null!==(n=n.compare)?n:cr)(o,r)&&e.ref===t.ref)return Ga(e,t,i)}return t.flags|=1,(e=Dl(s,r)).ref=t.ref,e.return=t,t.child=e}function Ea(e,t,n,r,i){if(null!==e){var s=e.memoizedProps;if(cr(s,r)&&e.ref===t.ref){if(Sa=!1,t.pendingProps=r=s,0==(e.lanes&i))return t.lanes=e.lanes,Ga(e,t,i);0!=(131072&e.flags)&&(Sa=!0)}}return ka(e,t,n,r,i)}function Ta(e,t,n){var r=t.pendingProps,i=r.children,s=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0==(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ai(Dc,Fc),Fc|=n;else{if(0==(1073741824&n))return e=null!==s?s.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ai(Dc,Fc),Fc|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==s?s.baseLanes:n,Ai(Dc,Fc),Fc|=r}else null!==s?(r=s.baseLanes|n,t.memoizedState=null):r=n,Ai(Dc,Fc),Fc|=r;return wa(e,t,i,n),t.child}function Aa(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function ka(e,t,n,r,i){var s=Ii(n)?Pi:Ni.current;return s=Ri(t,s),Es(t,i),n=Eo(e,t,n,r,s,i),r=To(),null===e||Sa?(is&&r&&es(t),t.flags|=1,wa(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Ga(e,t,i))}function Na(e,t,n,r,i){if(Ii(n)){var s=!0;Li(t)}else s=!1;if(Es(t,i),null===t.stateNode)Va(e,t),Us(t,n,r),Gs(t,n,r,i),r=!0;else if(null===e){var o=t.stateNode,a=t.memoizedProps;o.props=a;var c=o.context,l=n.contextType;l="object"==typeof l&&null!==l?Ts(l):Ri(t,l=Ii(n)?Pi:Ni.current);var u=n.getDerivedStateFromProps,h="function"==typeof u||"function"==typeof o.getSnapshotBeforeUpdate;h||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(a!==r||c!==l)&&Vs(t,o,r,l),Ps=!1;var d=t.memoizedState;o.state=d,_s(t,r,o,i),c=t.memoizedState,a!==r||d!==c||Oi.current||Ps?("function"==typeof u&&(js(t,n,u,r),c=t.memoizedState),(a=Ps||Hs(t,n,a,r,d,c,l))?(h||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||("function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"==typeof o.componentDidMount&&(t.flags|=4194308)):("function"==typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),o.props=r,o.state=c,o.context=l,r=a):("function"==typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,Is(e,t),a=t.memoizedProps,l=t.type===t.elementType?a:ms(t.type,a),o.props=l,h=t.pendingProps,d=o.context,c="object"==typeof(c=n.contextType)&&null!==c?Ts(c):Ri(t,c=Ii(n)?Pi:Ni.current);var p=n.getDerivedStateFromProps;(u="function"==typeof p||"function"==typeof o.getSnapshotBeforeUpdate)||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(a!==h||d!==c)&&Vs(t,o,r,c),Ps=!1,d=t.memoizedState,o.state=d,_s(t,r,o,i);var f=t.memoizedState;a!==h||d!==f||Oi.current||Ps?("function"==typeof p&&(js(t,n,p,r),f=t.memoizedState),(l=Ps||Hs(t,n,l,r,d,f,c)||!1)?(u||"function"!=typeof o.UNSAFE_componentWillUpdate&&"function"!=typeof o.componentWillUpdate||("function"==typeof o.componentWillUpdate&&o.componentWillUpdate(r,f,c),"function"==typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,f,c)),"function"==typeof o.componentDidUpdate&&(t.flags|=4),"function"==typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof o.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),o.props=r,o.state=f,o.context=c,r=l):("function"!=typeof o.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return Oa(e,t,n,r,s,i)}function Oa(e,t,n,r,i,s){Aa(e,t);var o=0!=(128&t.flags);if(!r&&!o)return i&&_i(t,n,!1),Ga(e,t,s);r=t.stateNode,ba.current=t;var a=o&&"function"!=typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=Qs(t,e.child,null,s),t.child=Qs(t,null,a,s)):wa(e,t,a,s),t.memoizedState=r.state,i&&_i(t,n,!0),t.child}function Pa(e){var t=e.stateNode;t.pendingContext?Di(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Di(0,t.context,!1),ro(e,t.containerInfo)}function Ra(e,t,n,r,i){return ps(),fs(i),t.flags|=256,wa(e,t,n,r),t.child}var Ia,Fa,Da,Ma,La={dehydrated:null,treeContext:null,retryLane:0};function _a(e){return{baseLanes:e,cachePool:null,transitions:null}}function qa(e,t,n){var r,i=t.pendingProps,o=ao.current,a=!1,c=0!=(128&t.flags);if((r=c)||(r=(null===e||null!==e.memoizedState)&&0!=(2&o)),r?(a=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Ai(ao,1&o),null===e)return ls(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0==(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(c=i.children,e=i.fallback,a?(i=t.mode,a=t.child,c={mode:"hidden",children:c},0==(1&i)&&null!==a?(a.childLanes=0,a.pendingProps=c):a=_l(c,i,0,null),e=Ll(e,i,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=_a(n),t.memoizedState=La,e):Ba(t,c));if(null!==(o=e.memoizedState)&&null!==(r=o.dehydrated))return function(e,t,n,r,i,o,a){if(n)return 256&t.flags?(t.flags&=-257,ja(e,t,a,r=ha(Error(s(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=r.fallback,i=t.mode,r=_l({mode:"visible",children:r.children},i,0,null),(o=Ll(o,i,a,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,0!=(1&t.mode)&&Qs(t,e.child,null,a),t.child.memoizedState=_a(a),t.memoizedState=La,o);if(0==(1&t.mode))return ja(e,t,a,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var c=r.dgst;return r=c,ja(e,t,a,r=ha(o=Error(s(419)),r,void 0))}if(c=0!=(a&e.childLanes),Sa||c){if(null!==(r=Pc)){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!=(i&(r.suspendedLanes|a))?0:i)&&i!==o.retryLane&&(o.retryLane=i,Os(e,i),rl(r,e,i,-1))}return ml(),ja(e,t,a,r=ha(Error(s(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=Nl.bind(null,e),i._reactRetry=t,null):(e=o.treeContext,rs=li(i.nextSibling),ns=t,is=!0,ss=null,null!==e&&(Ki[$i++]=Qi,Ki[$i++]=Xi,Ki[$i++]=Ji,Qi=e.id,Xi=e.overflow,Ji=t),(t=Ba(t,r.children)).flags|=4096,t)}(e,t,c,i,r,o,n);if(a){a=i.fallback,c=t.mode,r=(o=e.child).sibling;var l={mode:"hidden",children:i.children};return 0==(1&c)&&t.child!==o?((i=t.child).childLanes=0,i.pendingProps=l,t.deletions=null):(i=Dl(o,l)).subtreeFlags=14680064&o.subtreeFlags,null!==r?a=Dl(r,a):(a=Ll(a,c,n,null)).flags|=2,a.return=t,i.return=t,i.sibling=a,t.child=i,i=a,a=t.child,c=null===(c=e.child.memoizedState)?_a(n):{baseLanes:c.baseLanes|n,cachePool:null,transitions:c.transitions},a.memoizedState=c,a.childLanes=e.childLanes&~n,t.memoizedState=La,i}return e=(a=e.child).sibling,i=Dl(a,{mode:"visible",children:i.children}),0==(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function Ba(e,t){return(t=_l({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function ja(e,t,n,r){return null!==r&&fs(r),Qs(t,e.child,null,n),(e=Ba(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function za(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Cs(e.return,t,n)}function Ha(e,t,n,r,i){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function Ua(e,t,n){var r=t.pendingProps,i=r.revealOrder,s=r.tail;if(wa(e,t,r.children,n),0!=(2&(r=ao.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!=(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&za(e,n,t);else if(19===e.tag)za(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ai(ao,r),0==(1&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===co(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Ha(t,!1,i,n,s);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===co(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Ha(t,!0,n,null,s);break;case"together":Ha(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Va(e,t){0==(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ga(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),_c|=t.lanes,0==(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=Dl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Dl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Wa(e,t){if(!is)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Ka(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function $a(e,t,n){var r=t.pendingProps;switch(ts(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ka(t),null;case 1:case 17:return Ii(t.type)&&Fi(),Ka(t),null;case 3:return r=t.stateNode,io(),Ti(Oi),Ti(Ni),uo(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(hs(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0==(256&t.flags)||(t.flags|=1024,null!==ss&&(al(ss),ss=null))),Fa(e,t),Ka(t),null;case 5:oo(t);var i=no(to.current);if(n=t.type,null!==e&&null!=t.stateNode)Da(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(s(166));return Ka(t),null}if(e=no(Ys.current),hs(t)){r=t.stateNode,n=t.type;var o=t.memoizedProps;switch(r[di]=t,r[pi]=o,e=0!=(1&t.mode),n){case"dialog":Br("cancel",r),Br("close",r);break;case"iframe":case"object":case"embed":Br("load",r);break;case"video":case"audio":for(i=0;i<Mr.length;i++)Br(Mr[i],r);break;case"source":Br("error",r);break;case"img":case"image":case"link":Br("error",r),Br("load",r);break;case"details":Br("toggle",r);break;case"input":Q(r,o),Br("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Br("invalid",r);break;case"textarea":ie(r,o),Br("invalid",r)}for(var c in ve(n,o),i=null,o)if(o.hasOwnProperty(c)){var l=o[c];"children"===c?"string"==typeof l?r.textContent!==l&&(!0!==o.suppressHydrationWarning&&Zr(r.textContent,l,e),i=["children",l]):"number"==typeof l&&r.textContent!==""+l&&(!0!==o.suppressHydrationWarning&&Zr(r.textContent,l,e),i=["children",""+l]):a.hasOwnProperty(c)&&null!=l&&"onScroll"===c&&Br("scroll",r)}switch(n){case"input":W(r),Y(r,o,!0);break;case"textarea":W(r),oe(r);break;case"select":case"option":break;default:"function"==typeof o.onClick&&(r.onclick=Yr)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{c=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ae(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof r.is?e=c.createElement(n,{is:r.is}):(e=c.createElement(n),"select"===n&&(c=e,r.multiple?c.multiple=!0:r.size&&(c.size=r.size))):e=c.createElementNS(e,n),e[di]=t,e[pi]=r,Ia(e,t,!1,!1),t.stateNode=e;e:{switch(c=be(n,r),n){case"dialog":Br("cancel",e),Br("close",e),i=r;break;case"iframe":case"object":case"embed":Br("load",e),i=r;break;case"video":case"audio":for(i=0;i<Mr.length;i++)Br(Mr[i],e);i=r;break;case"source":Br("error",e),i=r;break;case"img":case"image":case"link":Br("error",e),Br("load",e),i=r;break;case"details":Br("toggle",e),i=r;break;case"input":Q(e,r),i=J(e,r),Br("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=_({},r,{value:void 0}),Br("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),Br("invalid",e)}for(o in ve(n,i),l=i)if(l.hasOwnProperty(o)){var u=l[o];"style"===o?me(e,u):"dangerouslySetInnerHTML"===o?null!=(u=u?u.__html:void 0)&&he(e,u):"children"===o?"string"==typeof u?("textarea"!==n||""!==u)&&de(e,u):"number"==typeof u&&de(e,""+u):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(a.hasOwnProperty(o)?null!=u&&"onScroll"===o&&Br("scroll",e):null!=u&&b(e,o,u,c))}switch(n){case"input":W(e),Y(e,r,!1);break;case"textarea":W(e),oe(e);break;case"option":null!=r.value&&e.setAttribute("value",""+V(r.value));break;case"select":e.multiple=!!r.multiple,null!=(o=r.value)?ne(e,!!r.multiple,o,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"==typeof i.onClick&&(e.onclick=Yr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ka(t),null;case 6:if(e&&null!=t.stateNode)Ma(e,t,e.memoizedProps,r);else{if("string"!=typeof r&&null===t.stateNode)throw Error(s(166));if(n=no(to.current),no(Ys.current),hs(t)){if(r=t.stateNode,n=t.memoizedProps,r[di]=t,(o=r.nodeValue!==n)&&null!==(e=ns))switch(e.tag){case 3:Zr(r.nodeValue,n,0!=(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Zr(r.nodeValue,n,0!=(1&e.mode))}o&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[di]=t,t.stateNode=r}return Ka(t),null;case 13:if(Ti(ao),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(is&&null!==rs&&0!=(1&t.mode)&&0==(128&t.flags))ds(),ps(),t.flags|=98560,o=!1;else if(o=hs(t),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(s(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(s(317));o[di]=t}else ps(),0==(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Ka(t),o=!1}else null!==ss&&(al(ss),ss=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!=(128&t.flags)?(t.lanes=n,t):((r=null!==r)!=(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!=(1&t.mode)&&(null===e||0!=(1&ao.current)?0===Mc&&(Mc=3):ml())),null!==t.updateQueue&&(t.flags|=4),Ka(t),null);case 4:return io(),Fa(e,t),null===e&&Hr(t.stateNode.containerInfo),Ka(t),null;case 10:return xs(t.type._context),Ka(t),null;case 19:if(Ti(ao),null===(o=t.memoizedState))return Ka(t),null;if(r=0!=(128&t.flags),null===(c=o.rendering))if(r)Wa(o,!1);else{if(0!==Mc||null!==e&&0!=(128&e.flags))for(e=t.child;null!==e;){if(null!==(c=co(e))){for(t.flags|=128,Wa(o,!1),null!==(r=c.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(o=n).flags&=14680066,null===(c=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=c.childLanes,o.lanes=c.lanes,o.child=c.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=c.memoizedProps,o.memoizedState=c.memoizedState,o.updateQueue=c.updateQueue,o.type=c.type,e=c.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ai(ao,1&ao.current|2),t.child}e=e.sibling}null!==o.tail&&Xe()>Uc&&(t.flags|=128,r=!0,Wa(o,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=co(c))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Wa(o,!0),null===o.tail&&"hidden"===o.tailMode&&!c.alternate&&!is)return Ka(t),null}else 2*Xe()-o.renderingStartTime>Uc&&1073741824!==n&&(t.flags|=128,r=!0,Wa(o,!1),t.lanes=4194304);o.isBackwards?(c.sibling=t.child,t.child=c):(null!==(n=o.last)?n.sibling=c:t.child=c,o.last=c)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Xe(),t.sibling=null,n=ao.current,Ai(ao,r?1&n|2:1&n),t):(Ka(t),null);case 22:case 23:return dl(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!=(1&t.mode)?0!=(1073741824&Fc)&&(Ka(t),6&t.subtreeFlags&&(t.flags|=8192)):Ka(t),null;case 24:case 25:return null}throw Error(s(156,t.tag))}function Ja(e,t){switch(ts(t),t.tag){case 1:return Ii(t.type)&&Fi(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return io(),Ti(Oi),Ti(Ni),uo(),0!=(65536&(e=t.flags))&&0==(128&e)?(t.flags=-65537&e|128,t):null;case 5:return oo(t),null;case 13:if(Ti(ao),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));ps()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ti(ao),null;case 4:return io(),null;case 10:return xs(t.type._context),null;case 22:case 23:return dl(),null;default:return null}}Ia=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Fa=function(){},Da=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,no(Ys.current);var s,o=null;switch(n){case"input":i=J(e,i),r=J(e,r),o=[];break;case"select":i=_({},i,{value:void 0}),r=_({},r,{value:void 0}),o=[];break;case"textarea":i=re(e,i),r=re(e,r),o=[];break;default:"function"!=typeof i.onClick&&"function"==typeof r.onClick&&(e.onclick=Yr)}for(u in ve(n,r),n=null,i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&null!=i[u])if("style"===u){var c=i[u];for(s in c)c.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(a.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in r){var l=r[u];if(c=null!=i?i[u]:void 0,r.hasOwnProperty(u)&&l!==c&&(null!=l||null!=c))if("style"===u)if(c){for(s in c)!c.hasOwnProperty(s)||l&&l.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in l)l.hasOwnProperty(s)&&c[s]!==l[s]&&(n||(n={}),n[s]=l[s])}else n||(o||(o=[]),o.push(u,n)),n=l;else"dangerouslySetInnerHTML"===u?(l=l?l.__html:void 0,c=c?c.__html:void 0,null!=l&&c!==l&&(o=o||[]).push(u,l)):"children"===u?"string"!=typeof l&&"number"!=typeof l||(o=o||[]).push(u,""+l):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(a.hasOwnProperty(u)?(null!=l&&"onScroll"===u&&Br("scroll",e),o||c===l||(o=[])):(o=o||[]).push(u,l))}n&&(o=o||[]).push("style",n);var u=o;(t.updateQueue=u)&&(t.flags|=4)}},Ma=function(e,t,n,r){n!==r&&(t.flags|=4)};var Qa=!1,Xa=!1,Za="function"==typeof WeakSet?WeakSet:Set,Ya=null;function ec(e,t){var n=e.ref;if(null!==n)if("function"==typeof n)try{n(null)}catch(n){Tl(e,t,n)}else n.current=null}function tc(e,t,n){try{n()}catch(n){Tl(e,t,n)}}var nc=!1;function rc(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var s=i.destroy;i.destroy=void 0,void 0!==s&&tc(t,n,s)}i=i.next}while(i!==r)}}function ic(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function sc(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"==typeof t?t(e):t.current=e}}function oc(e){var t=e.alternate;null!==t&&(e.alternate=null,oc(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&null!==(t=e.stateNode)&&(delete t[di],delete t[pi],delete t[gi],delete t[mi],delete t[yi]),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ac(e){return 5===e.tag||3===e.tag||4===e.tag}function cc(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||ac(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function lc(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=Yr));else if(4!==r&&null!==(e=e.child))for(lc(e,t,n),e=e.sibling;null!==e;)lc(e,t,n),e=e.sibling}function uc(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(uc(e,t,n),e=e.sibling;null!==e;)uc(e,t,n),e=e.sibling}var hc=null,dc=!1;function pc(e,t,n){for(n=n.child;null!==n;)fc(e,t,n),n=n.sibling}function fc(e,t,n){if(st&&"function"==typeof st.onCommitFiberUnmount)try{st.onCommitFiberUnmount(it,n)}catch(e){}switch(n.tag){case 5:Xa||ec(n,t);case 6:var r=hc,i=dc;hc=null,pc(e,t,n),dc=i,null!==(hc=r)&&(dc?(e=hc,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):hc.removeChild(n.stateNode));break;case 18:null!==hc&&(dc?(e=hc,n=n.stateNode,8===e.nodeType?ci(e.parentNode,n):1===e.nodeType&&ci(e,n),Ht(e)):ci(hc,n.stateNode));break;case 4:r=hc,i=dc,hc=n.stateNode.containerInfo,dc=!0,pc(e,t,n),hc=r,dc=i;break;case 0:case 11:case 14:case 15:if(!Xa&&null!==(r=n.updateQueue)&&null!==(r=r.lastEffect)){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,void 0!==o&&(0!=(2&s)||0!=(4&s))&&tc(n,t,o),i=i.next}while(i!==r)}pc(e,t,n);break;case 1:if(!Xa&&(ec(n,t),"function"==typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(e){Tl(n,t,e)}pc(e,t,n);break;case 21:pc(e,t,n);break;case 22:1&n.mode?(Xa=(r=Xa)||null!==n.memoizedState,pc(e,t,n),Xa=r):pc(e,t,n);break;default:pc(e,t,n)}}function gc(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Za),t.forEach((function(t){var r=Ol.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function mc(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var o=e,a=t,c=a;e:for(;null!==c;){switch(c.tag){case 5:hc=c.stateNode,dc=!1;break e;case 3:case 4:hc=c.stateNode.containerInfo,dc=!0;break e}c=c.return}if(null===hc)throw Error(s(160));fc(o,a,i),hc=null,dc=!1;var l=i.alternate;null!==l&&(l.return=null),i.return=null}catch(e){Tl(i,t,e)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)yc(t,e),t=t.sibling}function yc(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(mc(t,e),vc(e),4&r){try{rc(3,e,e.return),ic(3,e)}catch(t){Tl(e,e.return,t)}try{rc(5,e,e.return)}catch(t){Tl(e,e.return,t)}}break;case 1:mc(t,e),vc(e),512&r&&null!==n&&ec(n,n.return);break;case 5:if(mc(t,e),vc(e),512&r&&null!==n&&ec(n,n.return),32&e.flags){var i=e.stateNode;try{de(i,"")}catch(t){Tl(e,e.return,t)}}if(4&r&&null!=(i=e.stateNode)){var o=e.memoizedProps,a=null!==n?n.memoizedProps:o,c=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===c&&"radio"===o.type&&null!=o.name&&X(i,o),be(c,a);var u=be(c,o);for(a=0;a<l.length;a+=2){var h=l[a],d=l[a+1];"style"===h?me(i,d):"dangerouslySetInnerHTML"===h?he(i,d):"children"===h?de(i,d):b(i,h,d,u)}switch(c){case"input":Z(i,o);break;case"textarea":se(i,o);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var f=o.value;null!=f?ne(i,!!o.multiple,f,!1):p!==!!o.multiple&&(null!=o.defaultValue?ne(i,!!o.multiple,o.defaultValue,!0):ne(i,!!o.multiple,o.multiple?[]:"",!1))}i[pi]=o}catch(t){Tl(e,e.return,t)}}break;case 6:if(mc(t,e),vc(e),4&r){if(null===e.stateNode)throw Error(s(162));i=e.stateNode,o=e.memoizedProps;try{i.nodeValue=o}catch(t){Tl(e,e.return,t)}}break;case 3:if(mc(t,e),vc(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Ht(t.containerInfo)}catch(t){Tl(e,e.return,t)}break;case 4:default:mc(t,e),vc(e);break;case 13:mc(t,e),vc(e),8192&(i=e.child).flags&&(o=null!==i.memoizedState,i.stateNode.isHidden=o,!o||null!==i.alternate&&null!==i.alternate.memoizedState||(Hc=Xe())),4&r&&gc(e);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&e.mode?(Xa=(u=Xa)||h,mc(t,e),Xa=u):mc(t,e),vc(e),8192&r){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!h&&0!=(1&e.mode))for(Ya=e,h=e.child;null!==h;){for(d=Ya=h;null!==Ya;){switch(f=(p=Ya).child,p.tag){case 0:case 11:case 14:case 15:rc(4,p,p.return);break;case 1:ec(p,p.return);var g=p.stateNode;if("function"==typeof g.componentWillUnmount){r=p,n=p.return;try{t=r,g.props=t.memoizedProps,g.state=t.memoizedState,g.componentWillUnmount()}catch(e){Tl(r,n,e)}}break;case 5:ec(p,p.return);break;case 22:if(null!==p.memoizedState){xc(d);continue}}null!==f?(f.return=p,Ya=f):xc(d)}h=h.sibling}e:for(h=null,d=e;;){if(5===d.tag){if(null===h){h=d;try{i=d.stateNode,u?"function"==typeof(o=i.style).setProperty?o.setProperty("display","none","important"):o.display="none":(c=d.stateNode,a=null!=(l=d.memoizedProps.style)&&l.hasOwnProperty("display")?l.display:null,c.style.display=ge("display",a))}catch(t){Tl(e,e.return,t)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(t){Tl(e,e.return,t)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:mc(t,e),vc(e),4&r&&gc(e);case 21:}}function vc(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(ac(n)){var r=n;break e}n=n.return}throw Error(s(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(de(i,""),r.flags&=-33),uc(e,cc(e),i);break;case 3:case 4:var o=r.stateNode.containerInfo;lc(e,cc(e),o);break;default:throw Error(s(161))}}catch(t){Tl(e,e.return,t)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function bc(e,t,n){Ya=e,Sc(e,t,n)}function Sc(e,t,n){for(var r=0!=(1&e.mode);null!==Ya;){var i=Ya,s=i.child;if(22===i.tag&&r){var o=null!==i.memoizedState||Qa;if(!o){var a=i.alternate,c=null!==a&&null!==a.memoizedState||Xa;a=Qa;var l=Xa;if(Qa=o,(Xa=c)&&!l)for(Ya=i;null!==Ya;)c=(o=Ya).child,22===o.tag&&null!==o.memoizedState?Cc(i):null!==c?(c.return=o,Ya=c):Cc(i);for(;null!==s;)Ya=s,Sc(s,t,n),s=s.sibling;Ya=i,Qa=a,Xa=l}wc(e)}else 0!=(8772&i.subtreeFlags)&&null!==s?(s.return=i,Ya=s):wc(e)}}function wc(e){for(;null!==Ya;){var t=Ya;if(0!=(8772&t.flags)){var n=t.alternate;try{if(0!=(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Xa||ic(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Xa)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:ms(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&qs(t,o,r);break;case 3:var a=t.updateQueue;if(null!==a){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}qs(t,a,n)}break;case 5:var c=t.stateNode;if(null===n&&4&t.flags){n=c;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var h=u.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&Ht(d)}}}break;default:throw Error(s(163))}Xa||512&t.flags&&sc(t)}catch(e){Tl(t,t.return,e)}}if(t===e){Ya=null;break}if(null!==(n=t.sibling)){n.return=t.return,Ya=n;break}Ya=t.return}}function xc(e){for(;null!==Ya;){var t=Ya;if(t===e){Ya=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Ya=n;break}Ya=t.return}}function Cc(e){for(;null!==Ya;){var t=Ya;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{ic(4,t)}catch(e){Tl(t,n,e)}break;case 1:var r=t.stateNode;if("function"==typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(e){Tl(t,i,e)}}var s=t.return;try{sc(t)}catch(e){Tl(t,s,e)}break;case 5:var o=t.return;try{sc(t)}catch(e){Tl(t,o,e)}}}catch(e){Tl(t,t.return,e)}if(t===e){Ya=null;break}var a=t.sibling;if(null!==a){a.return=t.return,Ya=a;break}Ya=t.return}}var Ec,Tc=Math.ceil,Ac=S.ReactCurrentDispatcher,kc=S.ReactCurrentOwner,Nc=S.ReactCurrentBatchConfig,Oc=0,Pc=null,Rc=null,Ic=0,Fc=0,Dc=Ei(0),Mc=0,Lc=null,_c=0,qc=0,Bc=0,jc=null,zc=null,Hc=0,Uc=1/0,Vc=null,Gc=!1,Wc=null,Kc=null,$c=!1,Jc=null,Qc=0,Xc=0,Zc=null,Yc=-1,el=0;function tl(){return 0!=(6&Oc)?Xe():-1!==Yc?Yc:Yc=Xe()}function nl(e){return 0==(1&e.mode)?1:0!=(2&Oc)&&0!==Ic?Ic&-Ic:null!==gs.transition?(0===el&&(el=gt()),el):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Qt(e.type)}function rl(e,t,n,r){if(50<Xc)throw Xc=0,Zc=null,Error(s(185));yt(e,n,r),0!=(2&Oc)&&e===Pc||(e===Pc&&(0==(2&Oc)&&(qc|=n),4===Mc&&cl(e,Ic)),il(e,r),1===n&&0===Oc&&0==(1&t.mode)&&(Uc=Xe()+500,Bi&&Hi()))}function il(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,s=e.pendingLanes;0<s;){var o=31-ot(s),a=1<<o,c=i[o];-1===c?0!=(a&n)&&0==(a&r)||(i[o]=pt(a,t)):c<=t&&(e.expiredLanes|=a),s&=~a}}(e,t);var r=dt(e,e===Pc?Ic:0);if(0===r)null!==n&&$e(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&$e(n),1===t)0===e.tag?function(e){Bi=!0,zi(e)}(ll.bind(null,e)):zi(ll.bind(null,e)),oi((function(){0==(6&Oc)&&Hi()})),n=null;else{switch(St(r)){case 1:n=Ye;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Pl(n,sl.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function sl(e,t){if(Yc=-1,el=0,0!=(6&Oc))throw Error(s(327));var n=e.callbackNode;if(Cl()&&e.callbackNode!==n)return null;var r=dt(e,e===Pc?Ic:0);if(0===r)return null;if(0!=(30&r)||0!=(r&e.expiredLanes)||t)t=yl(e,r);else{t=r;var i=Oc;Oc|=2;var o=gl();for(Pc===e&&Ic===t||(Vc=null,Uc=Xe()+500,pl(e,t));;)try{bl();break}catch(t){fl(e,t)}ws(),Ac.current=o,Oc=i,null!==Rc?t=0:(Pc=null,Ic=0,t=Mc)}if(0!==t){if(2===t&&0!==(i=ft(e))&&(r=i,t=ol(e,i)),1===t)throw n=Lc,pl(e,0),cl(e,r),il(e,Xe()),n;if(6===t)cl(e,r);else{if(i=e.current.alternate,0==(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!ar(s(),i))return!1}catch(e){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)&&(2===(t=yl(e,r))&&0!==(o=ft(e))&&(r=o,t=ol(e,o)),1===t))throw n=Lc,pl(e,0),cl(e,r),il(e,Xe()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(s(345));case 2:case 5:xl(e,zc,Vc);break;case 3:if(cl(e,r),(130023424&r)===r&&10<(t=Hc+500-Xe())){if(0!==dt(e,0))break;if(((i=e.suspendedLanes)&r)!==r){tl(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ri(xl.bind(null,e,zc,Vc),t);break}xl(e,zc,Vc);break;case 4:if(cl(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var a=31-ot(r);o=1<<a,(a=t[a])>i&&(i=a),r&=~o}if(r=i,10<(r=(120>(r=Xe()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Tc(r/1960))-r)){e.timeoutHandle=ri(xl.bind(null,e,zc,Vc),r);break}xl(e,zc,Vc);break;default:throw Error(s(329))}}}return il(e,Xe()),e.callbackNode===n?sl.bind(null,e):null}function ol(e,t){var n=jc;return e.current.memoizedState.isDehydrated&&(pl(e,t).flags|=256),2!==(e=yl(e,t))&&(t=zc,zc=n,null!==t&&al(t)),e}function al(e){null===zc?zc=e:zc.push.apply(zc,e)}function cl(e,t){for(t&=~Bc,t&=~qc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ot(t),r=1<<n;e[n]=-1,t&=~r}}function ll(e){if(0!=(6&Oc))throw Error(s(327));Cl();var t=dt(e,0);if(0==(1&t))return il(e,Xe()),null;var n=yl(e,t);if(0!==e.tag&&2===n){var r=ft(e);0!==r&&(t=r,n=ol(e,r))}if(1===n)throw n=Lc,pl(e,0),cl(e,t),il(e,Xe()),n;if(6===n)throw Error(s(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,xl(e,zc,Vc),il(e,Xe()),null}function ul(e,t){var n=Oc;Oc|=1;try{return e(t)}finally{0===(Oc=n)&&(Uc=Xe()+500,Bi&&Hi())}}function hl(e){null!==Jc&&0===Jc.tag&&0==(6&Oc)&&Cl();var t=Oc;Oc|=1;var n=Nc.transition,r=bt;try{if(Nc.transition=null,bt=1,e)return e()}finally{bt=r,Nc.transition=n,0==(6&(Oc=t))&&Hi()}}function dl(){Fc=Dc.current,Ti(Dc)}function pl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ii(n)),null!==Rc)for(n=Rc.return;null!==n;){var r=n;switch(ts(r),r.tag){case 1:null!=(r=r.type.childContextTypes)&&Fi();break;case 3:io(),Ti(Oi),Ti(Ni),uo();break;case 5:oo(r);break;case 4:io();break;case 13:case 19:Ti(ao);break;case 10:xs(r.type._context);break;case 22:case 23:dl()}n=n.return}if(Pc=e,Rc=e=Dl(e.current,null),Ic=Fc=t,Mc=0,Lc=null,Bc=qc=_c=0,zc=jc=null,null!==As){for(t=0;t<As.length;t++)if(null!==(r=(n=As[t]).interleaved)){n.interleaved=null;var i=r.next,s=n.pending;if(null!==s){var o=s.next;s.next=i,r.next=o}n.pending=r}As=null}return e}function fl(e,t){for(;;){var n=Rc;try{if(ws(),ho.current=oa,vo){for(var r=go.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}vo=!1}if(fo=0,yo=mo=go=null,bo=!1,So=0,kc.current=null,null===n||null===n.return){Mc=1,Lc=t,Rc=null;break}e:{var o=e,a=n.return,c=n,l=t;if(t=Ic,c.flags|=32768,null!==l&&"object"==typeof l&&"function"==typeof l.then){var u=l,h=c,d=h.tag;if(0==(1&h.mode)&&(0===d||11===d||15===d)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var f=ya(a);if(null!==f){f.flags&=-257,va(f,a,c,0,t),1&f.mode&&ma(o,u,t),l=u;var g=(t=f).updateQueue;if(null===g){var m=new Set;m.add(l),t.updateQueue=m}else g.add(l);break e}if(0==(1&t)){ma(o,u,t),ml();break e}l=Error(s(426))}else if(is&&1&c.mode){var y=ya(a);if(null!==y){0==(65536&y.flags)&&(y.flags|=256),va(y,a,c,0,t),fs(ua(l,c));break e}}o=l=ua(l,c),4!==Mc&&(Mc=2),null===jc?jc=[o]:jc.push(o),o=a;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Ls(o,fa(0,l,t));break e;case 1:c=l;var v=o.type,b=o.stateNode;if(0==(128&o.flags)&&("function"==typeof v.getDerivedStateFromError||null!==b&&"function"==typeof b.componentDidCatch&&(null===Kc||!Kc.has(b)))){o.flags|=65536,t&=-t,o.lanes|=t,Ls(o,ga(o,c,t));break e}}o=o.return}while(null!==o)}wl(n)}catch(e){t=e,Rc===n&&null!==n&&(Rc=n=n.return);continue}break}}function gl(){var e=Ac.current;return Ac.current=oa,null===e?oa:e}function ml(){0!==Mc&&3!==Mc&&2!==Mc||(Mc=4),null===Pc||0==(268435455&_c)&&0==(268435455&qc)||cl(Pc,Ic)}function yl(e,t){var n=Oc;Oc|=2;var r=gl();for(Pc===e&&Ic===t||(Vc=null,pl(e,t));;)try{vl();break}catch(t){fl(e,t)}if(ws(),Oc=n,Ac.current=r,null!==Rc)throw Error(s(261));return Pc=null,Ic=0,Mc}function vl(){for(;null!==Rc;)Sl(Rc)}function bl(){for(;null!==Rc&&!Je();)Sl(Rc)}function Sl(e){var t=Ec(e.alternate,e,Fc);e.memoizedProps=e.pendingProps,null===t?wl(e):Rc=t,kc.current=null}function wl(e){var t=e;do{var n=t.alternate;if(e=t.return,0==(32768&t.flags)){if(null!==(n=$a(n,t,Fc)))return void(Rc=n)}else{if(null!==(n=Ja(n,t)))return n.flags&=32767,void(Rc=n);if(null===e)return Mc=6,void(Rc=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Rc=t);Rc=t=e}while(null!==t);0===Mc&&(Mc=5)}function xl(e,t,n){var r=bt,i=Nc.transition;try{Nc.transition=null,bt=1,function(e,t,n,r){do{Cl()}while(null!==Jc);if(0!=(6&Oc))throw Error(s(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(s(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-ot(n),s=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~s}}(e,o),e===Pc&&(Rc=Pc=null,Ic=0),0==(2064&n.subtreeFlags)&&0==(2064&n.flags)||$c||($c=!0,Pl(tt,(function(){return Cl(),null}))),o=0!=(15990&n.flags),0!=(15990&n.subtreeFlags)||o){o=Nc.transition,Nc.transition=null;var a=bt;bt=1;var c=Oc;Oc|=4,kc.current=null,function(e,t){if(ei=Vt,pr(e=dr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch(e){n=null;break e}var a=0,c=-1,l=-1,u=0,h=0,d=e,p=null;t:for(;;){for(var f;d!==n||0!==i&&3!==d.nodeType||(c=a+i),d!==o||0!==r&&3!==d.nodeType||(l=a+r),3===d.nodeType&&(a+=d.nodeValue.length),null!==(f=d.firstChild);)p=d,d=f;for(;;){if(d===e)break t;if(p===n&&++u===i&&(c=a),p===o&&++h===r&&(l=a),null!==(f=d.nextSibling))break;p=(d=p).parentNode}d=f}n=-1===c||-1===l?null:{start:c,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(ti={focusedElem:e,selectionRange:n},Vt=!1,Ya=t;null!==Ya;)if(e=(t=Ya).child,0!=(1028&t.subtreeFlags)&&null!==e)e.return=t,Ya=e;else for(;null!==Ya;){t=Ya;try{var g=t.alternate;if(0!=(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==g){var m=g.memoizedProps,y=g.memoizedState,v=t.stateNode,b=v.getSnapshotBeforeUpdate(t.elementType===t.type?m:ms(t.type,m),y);v.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var S=t.stateNode.containerInfo;1===S.nodeType?S.textContent="":9===S.nodeType&&S.documentElement&&S.removeChild(S.documentElement);break;default:throw Error(s(163))}}catch(e){Tl(t,t.return,e)}if(null!==(e=t.sibling)){e.return=t.return,Ya=e;break}Ya=t.return}g=nc,nc=!1}(e,n),yc(n,e),fr(ti),Vt=!!ei,ti=ei=null,e.current=n,bc(n,e,i),Qe(),Oc=c,bt=a,Nc.transition=o}else e.current=n;if($c&&($c=!1,Jc=e,Qc=i),0===(o=e.pendingLanes)&&(Kc=null),function(e){if(st&&"function"==typeof st.onCommitFiberRoot)try{st.onCommitFiberRoot(it,e,void 0,128==(128&e.current.flags))}catch(e){}}(n.stateNode),il(e,Xe()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)r((i=t[n]).value,{componentStack:i.stack,digest:i.digest});if(Gc)throw Gc=!1,e=Wc,Wc=null,e;0!=(1&Qc)&&0!==e.tag&&Cl(),0!=(1&(o=e.pendingLanes))?e===Zc?Xc++:(Xc=0,Zc=e):Xc=0,Hi()}(e,t,n,r)}finally{Nc.transition=i,bt=r}return null}function Cl(){if(null!==Jc){var e=St(Qc),t=Nc.transition,n=bt;try{if(Nc.transition=null,bt=16>e?16:e,null===Jc)var r=!1;else{if(e=Jc,Jc=null,Qc=0,0!=(6&Oc))throw Error(s(331));var i=Oc;for(Oc|=4,Ya=e.current;null!==Ya;){var o=Ya,a=o.child;if(0!=(16&Ya.flags)){var c=o.deletions;if(null!==c){for(var l=0;l<c.length;l++){var u=c[l];for(Ya=u;null!==Ya;){var h=Ya;switch(h.tag){case 0:case 11:case 15:rc(8,h,o)}var d=h.child;if(null!==d)d.return=h,Ya=d;else for(;null!==Ya;){var p=(h=Ya).sibling,f=h.return;if(oc(h),h===u){Ya=null;break}if(null!==p){p.return=f,Ya=p;break}Ya=f}}}var g=o.alternate;if(null!==g){var m=g.child;if(null!==m){g.child=null;do{var y=m.sibling;m.sibling=null,m=y}while(null!==m)}}Ya=o}}if(0!=(2064&o.subtreeFlags)&&null!==a)a.return=o,Ya=a;else e:for(;null!==Ya;){if(0!=(2048&(o=Ya).flags))switch(o.tag){case 0:case 11:case 15:rc(9,o,o.return)}var v=o.sibling;if(null!==v){v.return=o.return,Ya=v;break e}Ya=o.return}}var b=e.current;for(Ya=b;null!==Ya;){var S=(a=Ya).child;if(0!=(2064&a.subtreeFlags)&&null!==S)S.return=a,Ya=S;else e:for(a=b;null!==Ya;){if(0!=(2048&(c=Ya).flags))try{switch(c.tag){case 0:case 11:case 15:ic(9,c)}}catch(e){Tl(c,c.return,e)}if(c===a){Ya=null;break e}var w=c.sibling;if(null!==w){w.return=c.return,Ya=w;break e}Ya=c.return}}if(Oc=i,Hi(),st&&"function"==typeof st.onPostCommitFiberRoot)try{st.onPostCommitFiberRoot(it,e)}catch(e){}r=!0}return r}finally{bt=n,Nc.transition=t}}return!1}function El(e,t,n){e=Ds(e,t=fa(0,t=ua(n,t),1),1),t=tl(),null!==e&&(yt(e,1,t),il(e,t))}function Tl(e,t,n){if(3===e.tag)El(e,e,n);else for(;null!==t;){if(3===t.tag){El(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===Kc||!Kc.has(r))){t=Ds(t,e=ga(t,e=ua(n,e),1),1),e=tl(),null!==t&&(yt(t,1,e),il(t,e));break}}t=t.return}}function Al(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=tl(),e.pingedLanes|=e.suspendedLanes&n,Pc===e&&(Ic&n)===n&&(4===Mc||3===Mc&&(130023424&Ic)===Ic&&500>Xe()-Hc?pl(e,0):Bc|=n),il(e,t)}function kl(e,t){0===t&&(0==(1&e.mode)?t=1:(t=ut,0==(130023424&(ut<<=1))&&(ut=4194304)));var n=tl();null!==(e=Os(e,t))&&(yt(e,t,n),il(e,n))}function Nl(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),kl(e,n)}function Ol(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(s(314))}null!==r&&r.delete(t),kl(e,n)}function Pl(e,t){return Ke(e,t)}function Rl(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Il(e,t,n,r){return new Rl(e,t,n,r)}function Fl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Dl(e,t){var n=e.alternate;return null===n?((n=Il(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Ml(e,t,n,r,i,o){var a=2;if(r=e,"function"==typeof e)Fl(e)&&(a=1);else if("string"==typeof e)a=5;else e:switch(e){case C:return Ll(n.children,i,o,t);case E:a=8,i|=8;break;case T:return(e=Il(12,n,t,2|i)).elementType=T,e.lanes=o,e;case O:return(e=Il(13,n,t,i)).elementType=O,e.lanes=o,e;case P:return(e=Il(19,n,t,i)).elementType=P,e.lanes=o,e;case F:return _l(n,i,o,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case A:a=10;break e;case k:a=9;break e;case N:a=11;break e;case R:a=14;break e;case I:a=16,r=null;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=Il(a,n,t,i)).elementType=e,t.type=r,t.lanes=o,t}function Ll(e,t,n,r){return(e=Il(7,e,r,t)).lanes=n,e}function _l(e,t,n,r){return(e=Il(22,e,r,t)).elementType=F,e.lanes=n,e.stateNode={isHidden:!1},e}function ql(e,t,n){return(e=Il(6,e,null,t)).lanes=n,e}function Bl(e,t,n){return(t=Il(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function jl(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mt(0),this.expirationTimes=mt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mt(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function zl(e,t,n,r,i,s,o,a,c){return e=new jl(e,t,n,a,c),1===t?(t=1,!0===s&&(t|=8)):t=0,s=Il(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Rs(s),e}function Hl(e){if(!e)return ki;e:{if(He(e=e._reactInternals)!==e||1!==e.tag)throw Error(s(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ii(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(s(171))}if(1===e.tag){var n=e.type;if(Ii(n))return Mi(e,n,t)}return t}function Ul(e,t,n,r,i,s,o,a,c){return(e=zl(n,r,!0,e,0,s,0,a,c)).context=Hl(null),n=e.current,(s=Fs(r=tl(),i=nl(n))).callback=null!=t?t:null,Ds(n,s,i),e.current.lanes=i,yt(e,i,r),il(e,r),e}function Vl(e,t,n,r){var i=t.current,s=tl(),o=nl(i);return n=Hl(n),null===t.context?t.context=n:t.pendingContext=n,(t=Fs(s,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Ds(i,t,o))&&(rl(e,i,o,s),Ms(e,i,o)),o}function Gl(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Wl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Kl(e,t){Wl(e,t),(e=e.alternate)&&Wl(e,t)}Ec=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Oi.current)Sa=!0;else{if(0==(e.lanes&n)&&0==(128&t.flags))return Sa=!1,function(e,t,n){switch(t.tag){case 3:Pa(t),ps();break;case 5:so(t);break;case 1:Ii(t.type)&&Li(t);break;case 4:ro(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;Ai(ys,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ai(ao,1&ao.current),t.flags|=128,null):0!=(n&t.child.childLanes)?qa(e,t,n):(Ai(ao,1&ao.current),null!==(e=Ga(e,t,n))?e.sibling:null);Ai(ao,1&ao.current);break;case 19:if(r=0!=(n&t.childLanes),0!=(128&e.flags)){if(r)return Ua(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ai(ao,ao.current),r)break;return null;case 22:case 23:return t.lanes=0,Ta(e,t,n)}return Ga(e,t,n)}(e,t,n);Sa=0!=(131072&e.flags)}else Sa=!1,is&&0!=(1048576&t.flags)&&Yi(t,Wi,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Va(e,t),e=t.pendingProps;var i=Ri(t,Ni.current);Es(t,n),i=Eo(null,t,r,e,i,n);var o=To();return t.flags|=1,"object"==typeof i&&null!==i&&"function"==typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ii(r)?(o=!0,Li(t)):o=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,Rs(t),i.updater=zs,t.stateNode=i,i._reactInternals=t,Gs(t,r,e,n),t=Oa(null,t,r,!0,o,n)):(t.tag=0,is&&o&&es(t),wa(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Va(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"==typeof e)return Fl(e)?1:0;if(null!=e){if((e=e.$$typeof)===N)return 11;if(e===R)return 14}return 2}(r),e=ms(r,e),i){case 0:t=ka(null,t,r,e,n);break e;case 1:t=Na(null,t,r,e,n);break e;case 11:t=xa(null,t,r,e,n);break e;case 14:t=Ca(null,t,r,ms(r.type,e),n);break e}throw Error(s(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,ka(e,t,r,i=t.elementType===r?i:ms(r,i),n);case 1:return r=t.type,i=t.pendingProps,Na(e,t,r,i=t.elementType===r?i:ms(r,i),n);case 3:e:{if(Pa(t),null===e)throw Error(s(387));r=t.pendingProps,i=(o=t.memoizedState).element,Is(e,t),_s(t,r,null,n);var a=t.memoizedState;if(r=a.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Ra(e,t,r,n,i=ua(Error(s(423)),t));break e}if(r!==i){t=Ra(e,t,r,n,i=ua(Error(s(424)),t));break e}for(rs=li(t.stateNode.containerInfo.firstChild),ns=t,is=!0,ss=null,n=Xs(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ps(),r===i){t=Ga(e,t,n);break e}wa(e,t,r,n)}t=t.child}return t;case 5:return so(t),null===e&&ls(t),r=t.type,i=t.pendingProps,o=null!==e?e.memoizedProps:null,a=i.children,ni(r,i)?a=null:null!==o&&ni(r,o)&&(t.flags|=32),Aa(e,t),wa(e,t,a,n),t.child;case 6:return null===e&&ls(t),null;case 13:return qa(e,t,n);case 4:return ro(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Qs(t,null,r,n):wa(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,xa(e,t,r,i=t.elementType===r?i:ms(r,i),n);case 7:return wa(e,t,t.pendingProps,n),t.child;case 8:case 12:return wa(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,o=t.memoizedProps,a=i.value,Ai(ys,r._currentValue),r._currentValue=a,null!==o)if(ar(o.value,a)){if(o.children===i.children&&!Oi.current){t=Ga(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var c=o.dependencies;if(null!==c){a=o.child;for(var l=c.firstContext;null!==l;){if(l.context===r){if(1===o.tag){(l=Fs(-1,n&-n)).tag=2;var u=o.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?l.next=l:(l.next=h.next,h.next=l),u.pending=l}}o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Cs(o.return,n,t),c.lanes|=n;break}l=l.next}}else if(10===o.tag)a=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(a=o.return))throw Error(s(341));a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),Cs(a,n,t),a=o.sibling}else a=o.child;if(null!==a)a.return=o;else for(a=o;null!==a;){if(a===t){a=null;break}if(null!==(o=a.sibling)){o.return=a.return,a=o;break}a=a.return}o=a}wa(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,Es(t,n),r=r(i=Ts(i)),t.flags|=1,wa(e,t,r,n),t.child;case 14:return i=ms(r=t.type,t.pendingProps),Ca(e,t,r,i=ms(r.type,i),n);case 15:return Ea(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:ms(r,i),Va(e,t),t.tag=1,Ii(r)?(e=!0,Li(t)):e=!1,Es(t,n),Us(t,r,i),Gs(t,r,i,n),Oa(null,t,r,!0,e,n);case 19:return Ua(e,t,n);case 22:return Ta(e,t,n)}throw Error(s(156,t.tag))};var $l="function"==typeof reportError?reportError:function(e){console.error(e)};function Jl(e){this._internalRoot=e}function Ql(e){this._internalRoot=e}function Xl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Zl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Yl(){}function eu(e,t,n,r,i){var s=n._reactRootContainer;if(s){var o=s;if("function"==typeof i){var a=i;i=function(){var e=Gl(o);a.call(e)}}Vl(t,o,e,i)}else o=function(e,t,n,r,i){if(i){if("function"==typeof r){var s=r;r=function(){var e=Gl(o);s.call(e)}}var o=Ul(t,r,e,0,null,!1,0,"",Yl);return e._reactRootContainer=o,e[fi]=o.current,Hr(8===e.nodeType?e.parentNode:e),hl(),o}for(;i=e.lastChild;)e.removeChild(i);if("function"==typeof r){var a=r;r=function(){var e=Gl(c);a.call(e)}}var c=zl(e,0,!1,null,0,!1,0,"",Yl);return e._reactRootContainer=c,e[fi]=c.current,Hr(8===e.nodeType?e.parentNode:e),hl((function(){Vl(t,c,n,r)})),c}(n,t,e,i,r);return Gl(o)}Ql.prototype.render=Jl.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(s(409));Vl(e,t,null,null)},Ql.prototype.unmount=Jl.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;hl((function(){Vl(null,e,null,null)})),t[fi]=null}},Ql.prototype.unstable_scheduleHydration=function(e){if(e){var t=Et();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Ft.length&&0!==t&&t<Ft[n].priority;n++);Ft.splice(n,0,e),0===n&&_t(e)}},wt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ht(t.pendingLanes);0!==n&&(vt(t,1|n),il(t,Xe()),0==(6&Oc)&&(Uc=Xe()+500,Hi()))}break;case 13:hl((function(){var t=Os(e,1);if(null!==t){var n=tl();rl(t,e,1,n)}})),Kl(e,1)}},xt=function(e){if(13===e.tag){var t=Os(e,134217728);null!==t&&rl(t,e,134217728,tl()),Kl(e,134217728)}},Ct=function(e){if(13===e.tag){var t=nl(e),n=Os(e,t);null!==n&&rl(n,e,t,tl()),Kl(e,t)}},Et=function(){return bt},Tt=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},xe=function(e,t,n){switch(t){case"input":if(Z(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=wi(r);if(!i)throw Error(s(90));K(r),Z(r,i)}}}break;case"textarea":se(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ne=ul,Oe=hl;var tu={usingClientEntryPoint:!1,Events:[bi,Si,wi,Ae,ke,ul]},nu={findFiberByHostInstance:vi,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},ru={bundleType:nu.bundleType,version:nu.version,rendererPackageName:nu.rendererPackageName,rendererConfig:nu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:S.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ge(e))?null:e.stateNode},findFiberByHostInstance:nu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var iu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!iu.isDisabled&&iu.supportsFiber)try{it=iu.inject(ru),st=iu}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Xl(t))throw Error(s(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:x,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Xl(e))throw Error(s(299));var n=!1,r="",i=$l;return null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=zl(e,1,!1,null,0,n,0,r,i),e[fi]=t.current,Hr(8===e.nodeType?e.parentNode:e),new Jl(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return null===(e=Ge(t))?null:e.stateNode},t.flushSync=function(e){return hl(e)},t.hydrate=function(e,t,n){if(!Zl(t))throw Error(s(200));return eu(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Xl(e))throw Error(s(405));var r=null!=n&&n.hydratedSources||null,i=!1,o="",a=$l;if(null!=n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(a=n.onRecoverableError)),t=Ul(t,null,e,1,null!=n?n:null,i,0,o,a),e[fi]=t.current,Hr(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Ql(t)},t.render=function(e,t,n){if(!Zl(t))throw Error(s(200));return eu(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Zl(e))throw Error(s(40));return!!e._reactRootContainer&&(hl((function(){eu(null,null,e,!1,(function(){e._reactRootContainer=null,e[fi]=null}))})),!0)},t.unstable_batchedUpdates=ul,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Zl(n))throw Error(s(200));if(null==e||void 0===e._reactInternals)throw Error(s(38));return eu(e,t,n,!1,r)},t.version="18.2.0-next-9e3b772b8-20220608"},745:(e,t,n)=>{"use strict";var r=n(3935);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},3935:(e,t,n)=>{"use strict";!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=n(4448)},4203:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<s(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,o=i>>>1;r<o;){var a=2*(r+1)-1,c=e[a],l=a+1,u=e[l];if(0>s(c,n))l<i&&0>s(u,c)?(e[r]=u,e[l]=n,r=l):(e[r]=c,e[a]=n,r=a);else{if(!(l<i&&0>s(u,n)))break e;e[r]=u,e[l]=n,r=l}}}return t}function s(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var a=Date,c=a.now();t.unstable_now=function(){return a.now()-c}}var l=[],u=[],h=1,d=null,p=3,f=!1,g=!1,m=!1,y="function"==typeof setTimeout?setTimeout:null,v="function"==typeof clearTimeout?clearTimeout:null,b="undefined"!=typeof setImmediate?setImmediate:null;function S(e){for(var t=r(u);null!==t;){if(null===t.callback)i(u);else{if(!(t.startTime<=e))break;i(u),t.sortIndex=t.expirationTime,n(l,t)}t=r(u)}}function w(e){if(m=!1,S(e),!g)if(null!==r(l))g=!0,F(x);else{var t=r(u);null!==t&&D(w,t.startTime-e)}}function x(e,n){g=!1,m&&(m=!1,v(A),A=-1),f=!0;var s=p;try{for(S(n),d=r(l);null!==d&&(!(d.expirationTime>n)||e&&!O());){var o=d.callback;if("function"==typeof o){d.callback=null,p=d.priorityLevel;var a=o(d.expirationTime<=n);n=t.unstable_now(),"function"==typeof a?d.callback=a:d===r(l)&&i(l),S(n)}else i(l);d=r(l)}if(null!==d)var c=!0;else{var h=r(u);null!==h&&D(w,h.startTime-n),c=!1}return c}finally{d=null,p=s,f=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var C,E=!1,T=null,A=-1,k=5,N=-1;function O(){return!(t.unstable_now()-N<k)}function P(){if(null!==T){var e=t.unstable_now();N=e;var n=!0;try{n=T(!0,e)}finally{n?C():(E=!1,T=null)}}else E=!1}if("function"==typeof b)C=function(){b(P)};else if("undefined"!=typeof MessageChannel){var R=new MessageChannel,I=R.port2;R.port1.onmessage=P,C=function(){I.postMessage(null)}}else C=function(){y(P,0)};function F(e){T=e,E||(E=!0,C())}function D(e,n){A=y((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){g||f||(g=!0,F(x))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,i,s){var o=t.unstable_now();switch(s="object"==typeof s&&null!==s&&"number"==typeof(s=s.delay)&&0<s?o+s:o,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return e={id:h++,callback:i,priorityLevel:e,startTime:s,expirationTime:a=s+a,sortIndex:-1},s>o?(e.sortIndex=s,n(u,e),null===r(l)&&e===r(u)&&(m?(v(A),A=-1):m=!0,D(w,s-o))):(e.sortIndex=a,n(l,e),g||f||(g=!0,F(x))),e},t.unstable_shouldYield=O,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},4142:(e,t,n)=>{"use strict";e.exports=n(4203)},2408:(e,t)=>{"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator,f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,m={};function y(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||f}function v(){}function b(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||f}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=y.prototype;var S=b.prototype=new v;S.constructor=b,g(S,y.prototype),S.isPureReactComponent=!0;var w=Array.isArray,x=Object.prototype.hasOwnProperty,C={current:null},E={key:!0,ref:!0,__self:!0,__source:!0};function T(e,t,r){var i,s={},o=null,a=null;if(null!=t)for(i in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(o=""+t.key),t)x.call(t,i)&&!E.hasOwnProperty(i)&&(s[i]=t[i]);var c=arguments.length-2;if(1===c)s.children=r;else if(1<c){for(var l=Array(c),u=0;u<c;u++)l[u]=arguments[u+2];s.children=l}if(e&&e.defaultProps)for(i in c=e.defaultProps)void 0===s[i]&&(s[i]=c[i]);return{$$typeof:n,type:e,key:o,ref:a,props:s,_owner:C.current}}function A(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var k=/\/+/g;function N(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function O(e,t,i,s,o){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var c=!1;if(null===e)c=!0;else switch(a){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case r:c=!0}}if(c)return o=o(c=e),e=""===s?"."+N(c,0):s,w(o)?(i="",null!=e&&(i=e.replace(k,"$&/")+"/"),O(o,t,i,"",(function(e){return e}))):null!=o&&(A(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,i+(!o.key||c&&c.key===o.key?"":(""+o.key).replace(k,"$&/")+"/")+e)),t.push(o)),1;if(c=0,s=""===s?".":s+":",w(e))for(var l=0;l<e.length;l++){var u=s+N(a=e[l],l);c+=O(a,t,i,u,o)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"==typeof u)for(e=u.call(e),l=0;!(a=e.next()).done;)c+=O(a=a.value,t,i,u=s+N(a,l++),o);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function P(e,t,n){if(null==e)return e;var r=[],i=0;return O(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function R(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var I={current:null},F={transition:null},D={ReactCurrentDispatcher:I,ReactCurrentBatchConfig:F,ReactCurrentOwner:C};t.Children={map:P,forEach:function(e,t,n){P(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return P(e,(function(){t++})),t},toArray:function(e){return P(e,(function(e){return e}))||[]},only:function(e){if(!A(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=i,t.Profiler=o,t.PureComponent=b,t.StrictMode=s,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D,t.cloneElement=function(e,t,r){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=g({},e.props),s=e.key,o=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,a=C.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in t)x.call(t,l)&&!E.hasOwnProperty(l)&&(i[l]=void 0===t[l]&&void 0!==c?c[l]:t[l])}var l=arguments.length-2;if(1===l)i.children=r;else if(1<l){c=Array(l);for(var u=0;u<l;u++)c[u]=arguments[u+2];i.children=c}return{$$typeof:n,type:e.type,key:s,ref:o,props:i,_owner:a}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=T,t.createFactory=function(e){var t=T.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=A,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:R}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=F.transition;F.transition={};try{e()}finally{F.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return I.current.useCallback(e,t)},t.useContext=function(e){return I.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return I.current.useDeferredValue(e)},t.useEffect=function(e,t){return I.current.useEffect(e,t)},t.useId=function(){return I.current.useId()},t.useImperativeHandle=function(e,t,n){return I.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return I.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return I.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return I.current.useMemo(e,t)},t.useReducer=function(e,t,n){return I.current.useReducer(e,t,n)},t.useRef=function(e){return I.current.useRef(e)},t.useState=function(e){return I.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return I.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return I.current.useTransition()},t.version="18.2.0"},7294:(e,t,n)=>{"use strict";e.exports=n(2408)},7418:e=>{"use strict";e.exports=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}},7771:(e,t,n)=>{"use strict";var r=n(210),i=n(2296),s=n(3596)(),o=n(7296),a=r("%TypeError%"),c=r("%Math.floor%");e.exports=function(e,t){if("function"!=typeof e)throw new a("`fn` is not a function");if("number"!=typeof t||t<0||t>4294967295||c(t)!==t)throw new a("`length` must be a positive 32-bit integer");var n=arguments.length>2&&!!arguments[2],r=!0,l=!0;if("length"in e&&o){var u=o(e,"length");u&&!u.configurable&&(r=!1),u&&!u.writable&&(l=!1)}return(r||l||!n)&&(s?i(e,"length",t,!0,!0):i(e,"length",t)),e}},7478:(e,t,n)=>{"use strict";var r=n(210),i=n(1924),s=n(631),o=r("%TypeError%"),a=r("%WeakMap%",!0),c=r("%Map%",!0),l=i("WeakMap.prototype.get",!0),u=i("WeakMap.prototype.set",!0),h=i("WeakMap.prototype.has",!0),d=i("Map.prototype.get",!0),p=i("Map.prototype.set",!0),f=i("Map.prototype.has",!0),g=function(e,t){for(var n,r=e;null!==(n=r.next);r=n)if(n.key===t)return r.next=n.next,n.next=e.next,e.next=n,n};e.exports=function(){var e,t,n,r={assert:function(e){if(!r.has(e))throw new o("Side channel does not contain "+s(e))},get:function(r){if(a&&r&&("object"==typeof r||"function"==typeof r)){if(e)return l(e,r)}else if(c){if(t)return d(t,r)}else if(n)return function(e,t){var n=g(e,t);return n&&n.value}(n,r)},has:function(r){if(a&&r&&("object"==typeof r||"function"==typeof r)){if(e)return h(e,r)}else if(c){if(t)return f(t,r)}else if(n)return function(e,t){return!!g(e,t)}(n,r);return!1},set:function(r,i){a&&r&&("object"==typeof r||"function"==typeof r)?(e||(e=new a),u(e,r,i)):c?(t||(t=new c),p(t,r,i)):(n||(n={key:{},next:null}),function(e,t,n){var r=g(e,t);r?r.value=n:e.next={key:t,next:e.next,value:n}}(n,r,i))}};return r}},8280:e=>{var t=["Black","White","Gray","Brown","Red","Pink","Crimson","Carnelian","Orange","Yellow","Ivory","Cream","Green","Viridian","Aquamarine","Cyan","Blue","Cerulean","Azure","Indigo","Navy","Violet","Purple","Lavender","Magenta","Rainbow","Iridescent","Spectrum","Prism","Bold","Vivid","Pale","Clear","Glass","Translucent","Misty","Dark","Light","Gold","Silver","Copper","Bronze","Steel","Iron","Brass","Mercury","Zinc","Chrome","Platinum","Titanium","Nickel","Lead","Pewter","Rust","Metal","Stone","Quartz","Granite","Marble","Alabaster","Agate","Jasper","Pebble","Pyrite","Crystal","Geode","Obsidian","Mica","Flint","Sand","Gravel","Boulder","Basalt","Ruby","Beryl","Scarlet","Citrine","Sulpher","Topaz","Amber","Emerald","Malachite","Jade","Abalone","Lapis","Sapphire","Diamond","Peridot","Gem","Jewel","Bevel","Coral","Jet","Ebony","Wood","Tree","Cherry","Maple","Cedar","Branch","Bramble","Rowan","Ash","Fir","Pine","Cactus","Alder","Grove","Forest","Jungle","Palm","Bush","Mulberry","Juniper","Vine","Ivy","Rose","Lily","Tulip","Daffodil","Honeysuckle","Fuschia","Hazel","Walnut","Almond","Lime","Lemon","Apple","Blossom","Bloom","Crocus","Rose","Buttercup","Dandelion","Iris","Carnation","Fern","Root","Branch","Leaf","Seed","Flower","Petal","Pollen","Orchid","Mangrove","Cypress","Sequoia","Sage","Heather","Snapdragon","Daisy","Mountain","Hill","Alpine","Chestnut","Valley","Glacier","Forest","Grove","Glen","Tree","Thorn","Stump","Desert","Canyon","Dune","Oasis","Mirage","Well","Spring","Meadow","Field","Prairie","Grass","Tundra","Island","Shore","Sand","Shell","Surf","Wave","Foam","Tide","Lake","River","Brook","Stream","Pool","Pond","Sun","Sprinkle","Shade","Shadow","Rain","Cloud","Storm","Hail","Snow","Sleet","Thunder","Lightning","Wind","Hurricane","Typhoon","Dawn","Sunrise","Morning","Noon","Twilight","Evening","Sunset","Midnight","Night","Sky","Star","Stellar","Comet","Nebula","Quasar","Solar","Lunar","Planet","Meteor","Sprout","Pear","Plum","Kiwi","Berry","Apricot","Peach","Mango","Pineapple","Coconut","Olive","Ginger","Root","Plain","Fancy","Stripe","Spot","Speckle","Spangle","Ring","Band","Blaze","Paint","Pinto","Shade","Tabby","Brindle","Patch","Calico","Checker","Dot","Pattern","Glitter","Glimmer","Shimmer","Dull","Dust","Dirt","Glaze","Scratch","Quick","Swift","Fast","Slow","Clever","Fire","Flicker","Flash","Spark","Ember","Coal","Flame","Chocolate","Vanilla","Sugar","Spice","Cake","Pie","Cookie","Candy","Caramel","Spiral","Round","Jelly","Square","Narrow","Long","Short","Small","Tiny","Big","Giant","Great","Atom","Peppermint","Mint","Butter","Fringe","Rag","Quilt","Truth","Lie","Holy","Curse","Noble","Sly","Brave","Shy","Lava","Foul","Leather","Fantasy","Keen","Luminous","Feather","Sticky","Gossamer","Cotton","Rattle","Silk","Satin","Cord","Denim","Flannel","Plaid","Wool","Linen","Silent","Flax","Weak","Valiant","Fierce","Gentle","Rhinestone","Splash","North","South","East","West","Summer","Winter","Autumn","Spring","Season","Equinox","Solstice","Paper","Motley","Torch","Ballistic","Rampant","Shag","Freckle","Wild","Free","Chain","Sheer","Crazy","Mad","Candle","Ribbon","Lace","Notch","Wax","Shine","Shallow","Deep","Bubble","Harvest","Fluff","Venom","Boom","Slash","Rune","Cold","Quill","Love","Hate","Garnet","Zircon","Power","Bone","Void","Horn","Glory","Cyber","Nova","Hot","Helix","Cosmic","Quark","Quiver","Holly","Clover","Polar","Regal","Ripple","Ebony","Wheat","Phantom","Dew","Chisel","Crack","Chatter","Laser","Foil","Tin","Clever","Treasure","Maze","Twisty","Curly","Fortune","Fate","Destiny","Cute","Slime","Ink","Disco","Plume","Time","Psychadelic","Relic","Fossil","Water","Savage","Ancient","Rapid","Road","Trail","Stitch","Button","Bow","Nimble","Zest","Sour","Bitter","Phase","Fan","Frill","Plump","Pickle","Mud","Puddle","Pond","River","Spring","Stream","Battle","Arrow","Plume","Roan","Pitch","Tar","Cat","Dog","Horse","Lizard","Bird","Fish","Saber","Scythe","Sharp","Soft","Razor","Neon","Dandy","Weed","Swamp","Marsh","Bog","Peat","Moor","Muck","Mire","Grave","Fair","Just","Brick","Puzzle","Skitter","Prong","Fork","Dent","Dour","Warp","Luck","Coffee","Split","Chip","Hollow","Heavy","Legend","Hickory","Mesquite","Nettle","Rogue","Charm","Prickle","Bead","Sponge","Whip","Bald","Frost","Fog","Oil","Veil","Cliff","Volcano","Rift","Maze","Proud","Dew","Mirror","Shard","Salt","Pepper","Honey","Thread","Bristle","Ripple","Glow","Zenith"],n=["head","crest","crown","tooth","fang","horn","frill","skull","bone","tongue","throat","voice","nose","snout","chin","eye","sight","seer","speaker","singer","song","chanter","howler","chatter","shrieker","shriek","jaw","bite","biter","neck","shoulder","fin","wing","arm","lifter","grasp","grabber","hand","paw","foot","finger","toe","thumb","talon","palm","touch","racer","runner","hoof","fly","flier","swoop","roar","hiss","hisser","snarl","dive","diver","rib","chest","back","ridge","leg","legs","tail","beak","walker","lasher","swisher","carver","kicker","roarer","crusher","spike","shaker","charger","hunter","weaver","crafter","binder","scribe","muse","snap","snapper","slayer","stalker","track","tracker","scar","scarer","fright","killer","death","doom","healer","saver","friend","foe","guardian","thunder","lightning","cloud","storm","forger","scale","hair","braid","nape","belly","thief","stealer","reaper","giver","taker","dancer","player","gambler","twister","turner","painter","dart","drifter","sting","stinger","venom","spur","ripper","swallow","devourer","knight","lady","lord","queen","king","master","mistress","prince","princess","duke","dutchess","samurai","ninja","knave","slave","servant","sage","wizard","witch","warlock","warrior","jester","paladin","bard","trader","sword","shield","knife","dagger","arrow","bow","fighter","bane","follower","leader","scourge","watcher","cat","panther","tiger","cougar","puma","jaguar","ocelot","lynx","lion","leopard","ferret","weasel","wolverine","bear","raccoon","dog","wolf","kitten","puppy","cub","fox","hound","terrier","coyote","hyena","jackal","pig","horse","donkey","stallion","mare","zebra","antelope","gazelle","deer","buffalo","bison","boar","elk","whale","dolphin","shark","fish","minnow","salmon","ray","fisher","otter","gull","duck","goose","crow","raven","bird","eagle","raptor","hawk","falcon","moose","heron","owl","stork","crane","sparrow","robin","parrot","cockatoo","carp","lizard","gecko","iguana","snake","python","viper","boa","condor","vulture","spider","fly","scorpion","heron","oriole","toucan","bee","wasp","hornet","rabbit","bunny","hare","brow","mustang","ox","piper","soarer","flasher","moth","mask","hide","hero","antler","chill","chiller","gem","ogre","myth","elf","fairy","pixie","dragon","griffin","unicorn","pegasus","sprite","fancier","chopper","slicer","skinner","butterfly","legend","wanderer","rover","raver","loon","lancer","glass","glazer","flame","crystal","lantern","lighter","cloak","bell","ringer","keeper","centaur","bolt","catcher","whimsey","quester","rat","mouse","serpent","wyrm","gargoyle","thorn","whip","rider","spirit","sentry","bat","beetle","burn","cowl","stone","gem","collar","mark","grin","scowl","spear","razor","edge","seeker","jay","ape","monkey","gorilla","koala","kangaroo","yak","sloth","ant","roach","weed","seed","eater","razor","shirt","face","goat","mind","shift","rider","face","mole","vole","pirate","llama","stag","bug","cap","boot","drop","hugger","sargent","snagglefoot","carpet","curtain"];function r(e){return e=e||Math.random,n[Math.floor(e()*n.length)]}function i(e){return e=e||Math.random,t[Math.floor(e()*t.length)]}e.exports=function(e){var t=r(e),n=r(e);return n=n.substr(0,1).toUpperCase()+n.substr(1),i(e)+t+" "+n},e.exports.randomNoun=r,e.exports.randomAdjective=i},1478:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.App=void 0;const i=r(n(7294)),s=n(745),o=n(8908),a=n(7812),c=n(3072),l=n(4433),u={[o.LogLevel.ERROR]:(e,t,n)=>console.error(t,...n),[o.LogLevel.WARN]:(e,t,n)=>console.warn(t,...n),[o.LogLevel.INFO]:(e,t,n)=>console.log(t,...n),[o.LogLevel.TRACE]:(e,t,n)=>console.log(t,...n),[o.LogLevel.DEBUG]:(e,t,n)=>console.log(t,...n)};class h extends i.default.Component{_initialUser;_router;_connectedInterest;constructor(e){super(e),o.log.init({application:"DEBUG",notification:"DEBUG"},((e,t,n,r)=>{u[e](t,n,r)})),this._initialUser=null;var t=new l.FluidConnection({});this._router=new c.NotificationRouterFor(this.onConnection.bind(this)),this._connectedInterest=new c.ObserverInterest(this._router,l.FluidConnection.connectedInterest),t.addObserver(this._connectedInterest);var n="";window.location.hash&&(n=window.location.hash.substring(1));var r=(0,a.looksLikeUuid)(n);this.state={localUser:this._initialUser,fluidConnection:t,participantCaucus:null,containerId:r?n:null}}onConnection(e,t){this.setState({localUser:this.state.localUser,containerId:t.eventData,fluidConnection:this.state.fluidConnection,participantCaucus:this.state.fluidConnection.participantCaucus()})}render(){return i.default.createElement("p",null,"Hello")}}t.App=h,void 0!==document&&void 0!==document.getElementById&&(0,s.createRoot)(document.getElementById("reactRoot")).render(i.default.createElement(h,null))},7627:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CaucusOf=void 0;const r=n(9978),i=n(3111),s=n(3072);class o extends s.Notifier{static caucusMemberAddedNotificationId="caucusMemberAdded";static caucusMemberAddedInterest=new s.Interest(o.caucusMemberAddedNotificationId);static caucusMemberChangedNotificationId="caucusMemberChanged";static caucusMemberChangedInterest=new s.Interest(o.caucusMemberChangedNotificationId);static caucusMemberRemovedNotificationId="caucusMemberRemoved";static caucusMemberRemovedInterest=new s.Interest(o.caucusMemberRemovedNotificationId);_localCopy;_shared;constructor(e){super(),this._shared=e,this._localCopy=new Map,this._shared.on("valueChanged",((e,t,n)=>{t||this.doNotification(null!==e.previousValue,n.has(e.key),e.key)})),(0,r.debounce)(function(){this.doNotification(!1,!1,null)}.bind(this),250)()}doNotification(e,t,n){e?t?this.notifyObservers(o.caucusMemberChangedInterest,new s.NotificationFor(o.caucusMemberChangedInterest,n)):this.notifyObservers(o.caucusMemberRemovedInterest,new s.NotificationFor(o.caucusMemberRemovedInterest,n)):this.notifyObservers(o.caucusMemberAddedInterest,new s.NotificationFor(o.caucusMemberAddedInterest,n))}has(e){return this._shared.has(e)}add(e,t){let n=t.flatten();this._shared.set(e,n)}remove(e){return this._shared.delete(e)}amend(e,t){let n=t.flatten();this._shared.set(e,n)}get(e){let t=this._shared.get(e);return t?i.MDynamicStreamable.resurrect(t):null}current(){return this._localCopy.clear(),this._shared.forEach(((e,t,n)=>{let r=i.MDynamicStreamable.resurrect(e);this._localCopy.set(t,r)})),this._localCopy}synchFrom(e){var t=new Array;this._shared.forEach(((n,r)=>{e.get(r)||t.push(r)})),t.forEach(((e,t)=>{this._shared.delete(e)})),e.forEach(((e,t)=>{let n=this._shared.get(t),r=e.flatten();n?n!==r&&this.amend(t,e):this.add(t,e)}))}}t.CaucusOf=o},9978:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.debounce=void 0,t.debounce=function(e,t){var n=null;return()=>{n&&clearTimeout(n),n=setTimeout((()=>{n=null,e.apply(this,arguments)}),t)}}},1640:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnvironmentError=t.ConnectionError=t.InvalidOperationError=t.InvalidParameterError=void 0;class n extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype),this.name=n.name}}t.InvalidParameterError=n;class r extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype),this.name=r.name}}t.InvalidOperationError=r;class i extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype),this.name=r.name}}t.ConnectionError=i;class s extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype),this.name=s.name}}t.EnvironmentError=s},4433:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FluidConnection=void 0;const r=n(2580),i=n(5969),s=n(3072),o=n(1640),a=n(6006),c=n(7627),l={initialObjects:{participantMap:r.SharedMap,shapeMap:r.SharedMap}};class u extends s.Notifier{static connectedNotificationId="connected";static connectedInterest=new s.Interest(u.connectedNotificationId);_props;_localUser;_client;_container;_participantCaucus;constructor(e){super(),this._client=null,this._props=e,this._container=null,this._localUser=null,this._participantCaucus=null}async createNew(e){try{var t=new a.ClientProps;await t.connection.makeTokenProvider(),this._client=new i.AzureClient(t),this._localUser=e;const{container:n,services:r}=await this._client.createContainer(l);this._container=n;let s=this;return new Promise(((e,t)=>{n.attach().then((t=>{s.setupAfterConnection(t,!0),e(t)})).catch((()=>{t()}))}))}catch(e){throw new o.ConnectionError(e.message)}}async attachToExisting(e,t){try{var n=new a.ClientProps;await n.connection.makeTokenProvider(),this._client=new i.AzureClient(n),this._localUser=t;const{container:r,services:s}=await this._client.getContainer(e,l);return this._container=r,this.setupAfterConnection(e,!1),e}catch(e){throw new o.ConnectionError(e.message)}}setupAfterConnection(e,t){this._participantCaucus=new c.CaucusOf(this._container.initialObjects.participantMap),this.notifyObservers(u.connectedInterest,new s.NotificationFor(u.connectedInterest,e));var n=this._localUser.flatten();this._container.initialObjects.participantMap.set(this._localUser.id,n)}canDisconnect(){return!!this._container&&this._container.connectionState===r.ConnectionState.Connected}async disconnect(){if(this.canDisconnect())return await this._container.disconnect(),this._participantCaucus=null,!0;throw new o.InvalidOperationError("The remote data service is not connected - please try again in a short while.")}participantCaucus(){return this._participantCaucus}}t.FluidConnection=u},6006:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ClientProps=t.ConnectionConfig=void 0;const i=n(7719),s=r(n(7218)),o=n(1640);var a="b03724b3-4be0-4491-b0fa-43b01ab80d50";class c{tokenProvider;endpoint;type;tenantId;documentId;async getToken(e,t,n,r){var i=location.protocol+"//"+location.host+"/api/key";const a=await s.default.get(i,{params:{tenantId_:e,documentId_:t,userId:r,userName:n}});if(!a.data)throw new o.ConnectionError("Error connecting to remote data services for API token.");return a.data}constructor(){this.documentId=a}async makeTokenProvider(){var e={id:a,name:"Whiteboard Application"};return this.tenantId="06fcf322-99f7-412d-9889-f2e94b066b7e",this.endpoint="http://localhost:7070",this.type="local",this.tokenProvider=new i.InsecureTokenProvider("testKey",e),this.tokenProvider}}t.ConnectionConfig=c,t.ClientProps=class{connection;constructor(){this.connection=new c}}},3072:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Notifier=t.NotificationRouterFor=t.NotificationRouter=t.ObserverInterest=t.NotificationFor=t.Notification=t.Interest=void 0,t.Interest=class{_notificationId;constructor(...e){0!==e.length?this.isMyType(e[0])?this._notificationId=e[0]._notificationId:this._notificationId=e[0]:this._notificationId=null}isMyType(e){return e.hasOwnProperty("_notificationId")}get notificationId(){return this._notificationId}equals(e){return this._notificationId===e._notificationId}assign(e){return this._notificationId=e._notificationId,this}};class n{_interest;constructor(...e){0!==e.length?this.isMyType(e[0])?this._interest=e[0]._interest:this._interest=e[0]:this._interest=null}isMyType(e){return e.hasOwnProperty("_interest")}get interest(){return this._interest}equals(e){return this.interest===e.interest||null!==this._interest&&null!==e.interest&&this._interest.equals(e._interest)}assign(e){return this._interest=e._interest,this}}t.Notification=n,t.NotificationFor=class extends n{_eventData;constructor(...e){if(0===e.length)return super(),void(this._eventData=null);1===e.length?(super(e[0]),this._eventData=e[0]._eventData):(super(e[0]),this._eventData=e[1])}get eventData(){return this._eventData}equals(e){return super.equals(e)&&this._eventData===e._eventData}assign(e){return super.assign(e),this._eventData=e._eventData,this}},t.ObserverInterest=class{_observer;_interest;constructor(...e){if(0===e.length)return this._observer=null,void(this._interest=null);1===e.length?(this._observer=e[0]._observer,this._interest=e[0]._interest):(this._observer=e[0],this._interest=e[1])}get observer(){return this._observer}get interest(){return this._interest}equals(e){return this._observer===e._observer&&(this.interest===e.interest||null!==this._interest&&null!==e.interest&&this._interest.equals(e._interest))}assign(e){return this._observer=e._observer,this._interest=e._interest,this}},t.NotificationRouter=class{_function;constructor(...e){0!==e.length?this.isMyType(e[0])?this._function=e[0]._function:this._function=e[0]:this._function=null}isMyType(e){return e.hasOwnProperty("_function")}get function(){return this._function}equals(e){return this._function===e._function}assign(e){return this._function=e._function,this}notify(e,t){this._function(e,t)}},t.NotificationRouterFor=class{_function;constructor(...e){0!==e.length?this.isMyType(e[0])?this._function=e[0]._function:this._function=e[0]:this._function=null}isMyType(e){return e.hasOwnProperty("_function")}get function(){return this._function}equals(e){return this._function===e._function}assign(e){return this._function=e._function,this}notify(e,t){this._function(e,t)}},t.Notifier=class{_observerInterests;constructor(){this._observerInterests=new Array}notifyObservers(e,t){for(var n=0;n<this._observerInterests.length;n++)this._observerInterests[n].interest.equals(e)&&this._observerInterests[n].observer.notify(this._observerInterests[n].interest,t)}addObserver(e){-1===this._observerInterests.indexOf(e)&&this._observerInterests.push(e)}removeObserver(e){const t=this._observerInterests.indexOf(e);return t>-1&&(this._observerInterests.splice(t,1),!0)}removeAllObservers(){this._observerInterests.length=0}}},3111:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DynamicStreamableFactory=t.MDynamicStreamable=t.MStreamable=void 0;class n{constructor(){}}t.MStreamable=n,t.MDynamicStreamable=class extends n{constructor(){super()}flatten(){return JSON.stringify({className:this.className(),data:this.streamOut()})}static resurrect(e){const t=JSON.parse(e);let n=i.create(t.className);return n.streamIn(t.data),n}};var r=null;class i{_className;_factoryMethod;_nextFactory;constructor(e,t){if(this._className=e,this._factoryMethod=t,this._nextFactory=null,null===r)r=this;else{for(var n=r;n._nextFactory;)n=n._nextFactory;n._nextFactory=this}}static create(e){for(var t=r;t;){if(t._className===e)return t._factoryMethod();t=t._nextFactory}return null}}t.DynamicStreamableFactory=i},7812:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.looksLikeUuid=t.uuid=void 0;const r=n(1640);t.uuid=function(){var e,t,n=null;if("undefined"!=typeof Blob){let e=URL.createObjectURL(new Blob);URL.revokeObjectURL(e),n="undefined"==typeof window?e.split(":")[2]:"file:"===window.location.protocol?e.split("/")[1]:e.split("/")[3]}else e=(new Date).getTime(),t="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0,n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(n){var r=16*Math.random();return e>0?(r=(e+r)%16|0,e=Math.floor(e/16)):(r=(t+r)%16|0,t=Math.floor(t/16)),("x"===n?r:3&r|8).toString(16)}));if(!n)throw new r.EnvironmentError("Error creating UUID.");return n},t.looksLikeUuid=function(e){return 36===e.length&&5===e.split("-").length}},4564:(e,t,n)=>{"use strict";var r=n(7418),i=n(7129),s=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,o=/[\n\r\t]/g,a=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,c=/:\d+$/,l=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,u=/^[a-zA-Z]:/;function h(e){return(e||"").toString().replace(s,"")}var d=[["#","hash"],["?","query"],function(e,t){return g(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],p={hash:1,query:1};function f(e){var t,r=("undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{}).location||{},i={},s=typeof(e=e||r);if("blob:"===e.protocol)i=new y(unescape(e.pathname),{});else if("string"===s)for(t in i=new y(e,{}),p)delete i[t];else if("object"===s){for(t in e)t in p||(i[t]=e[t]);void 0===i.slashes&&(i.slashes=a.test(e.href))}return i}function g(e){return"file:"===e||"ftp:"===e||"http:"===e||"https:"===e||"ws:"===e||"wss:"===e}function m(e,t){e=(e=h(e)).replace(o,""),t=t||{};var n,r=l.exec(e),i=r[1]?r[1].toLowerCase():"",s=!!r[2],a=!!r[3],c=0;return s?a?(n=r[2]+r[3]+r[4],c=r[2].length+r[3].length):(n=r[2]+r[4],c=r[2].length):a?(n=r[3]+r[4],c=r[3].length):n=r[4],"file:"===i?c>=2&&(n=n.slice(2)):g(i)?n=r[4]:i?s&&(n=n.slice(2)):c>=2&&g(t.protocol)&&(n=r[4]),{protocol:i,slashes:s||g(i),slashesCount:c,rest:n}}function y(e,t,n){if(e=(e=h(e)).replace(o,""),!(this instanceof y))return new y(e,t,n);var s,a,c,l,p,v,b=d.slice(),S=typeof t,w=this,x=0;for("object"!==S&&"string"!==S&&(n=t,t=null),n&&"function"!=typeof n&&(n=i.parse),s=!(a=m(e||"",t=f(t))).protocol&&!a.slashes,w.slashes=a.slashes||s&&t.slashes,w.protocol=a.protocol||t.protocol||"",e=a.rest,("file:"===a.protocol&&(2!==a.slashesCount||u.test(e))||!a.slashes&&(a.protocol||a.slashesCount<2||!g(w.protocol)))&&(b[3]=[/(.*)/,"pathname"]);x<b.length;x++)"function"!=typeof(l=b[x])?(c=l[0],v=l[1],c!=c?w[v]=e:"string"==typeof c?~(p="@"===c?e.lastIndexOf(c):e.indexOf(c))&&("number"==typeof l[2]?(w[v]=e.slice(0,p),e=e.slice(p+l[2])):(w[v]=e.slice(p),e=e.slice(0,p))):(p=c.exec(e))&&(w[v]=p[1],e=e.slice(0,p.index)),w[v]=w[v]||s&&l[3]&&t[v]||"",l[4]&&(w[v]=w[v].toLowerCase())):e=l(e,w);n&&(w.query=n(w.query)),s&&t.slashes&&"/"!==w.pathname.charAt(0)&&(""!==w.pathname||""!==t.pathname)&&(w.pathname=function(e,t){if(""===e)return t;for(var n=(t||"/").split("/").slice(0,-1).concat(e.split("/")),r=n.length,i=n[r-1],s=!1,o=0;r--;)"."===n[r]?n.splice(r,1):".."===n[r]?(n.splice(r,1),o++):o&&(0===r&&(s=!0),n.splice(r,1),o--);return s&&n.unshift(""),"."!==i&&".."!==i||n.push(""),n.join("/")}(w.pathname,t.pathname)),"/"!==w.pathname.charAt(0)&&g(w.protocol)&&(w.pathname="/"+w.pathname),r(w.port,w.protocol)||(w.host=w.hostname,w.port=""),w.username=w.password="",w.auth&&(~(p=w.auth.indexOf(":"))?(w.username=w.auth.slice(0,p),w.username=encodeURIComponent(decodeURIComponent(w.username)),w.password=w.auth.slice(p+1),w.password=encodeURIComponent(decodeURIComponent(w.password))):w.username=encodeURIComponent(decodeURIComponent(w.auth)),w.auth=w.password?w.username+":"+w.password:w.username),w.origin="file:"!==w.protocol&&g(w.protocol)&&w.host?w.protocol+"//"+w.host:"null",w.href=w.toString()}y.prototype={set:function(e,t,n){var s=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(n||i.parse)(t)),s[e]=t;break;case"port":s[e]=t,r(t,s.protocol)?t&&(s.host=s.hostname+":"+t):(s.host=s.hostname,s[e]="");break;case"hostname":s[e]=t,s.port&&(t+=":"+s.port),s.host=t;break;case"host":s[e]=t,c.test(t)?(t=t.split(":"),s.port=t.pop(),s.hostname=t.join(":")):(s.hostname=t,s.port="");break;case"protocol":s.protocol=t.toLowerCase(),s.slashes=!n;break;case"pathname":case"hash":if(t){var o="pathname"===e?"/":"#";s[e]=t.charAt(0)!==o?o+t:t}else s[e]=t;break;case"username":case"password":s[e]=encodeURIComponent(t);break;case"auth":var a=t.indexOf(":");~a?(s.username=t.slice(0,a),s.username=encodeURIComponent(decodeURIComponent(s.username)),s.password=t.slice(a+1),s.password=encodeURIComponent(decodeURIComponent(s.password))):s.username=encodeURIComponent(decodeURIComponent(t))}for(var l=0;l<d.length;l++){var u=d[l];u[4]&&(s[u[1]]=s[u[1]].toLowerCase())}return s.auth=s.password?s.username+":"+s.password:s.username,s.origin="file:"!==s.protocol&&g(s.protocol)&&s.host?s.protocol+"//"+s.host:"null",s.href=s.toString(),s},toString:function(e){e&&"function"==typeof e||(e=i.stringify);var t,n=this,r=n.host,s=n.protocol;s&&":"!==s.charAt(s.length-1)&&(s+=":");var o=s+(n.protocol&&n.slashes||g(n.protocol)?"//":"");return n.username?(o+=n.username,n.password&&(o+=":"+n.password),o+="@"):n.password?(o+=":"+n.password,o+="@"):"file:"!==n.protocol&&g(n.protocol)&&!r&&"/"!==n.pathname&&(o+="@"),(":"===r[r.length-1]||c.test(n.hostname)&&!n.port)&&(r+=":"),o+=r+n.pathname,(t="object"==typeof n.query?e(n.query):n.query)&&(o+="?"!==t.charAt(0)?"?"+t:t),n.hash&&(o+=n.hash),o}},y.extractProtocol=m,y.location=f,y.trimLeft=h,y.qs=i,e.exports=y},2511:function(e,t,n){var r;e=n.nmd(e),function(i){t&&t.nodeType,e&&e.nodeType;var s="object"==typeof n.g&&n.g;s.global!==s&&s.window!==s&&s.self;var o,a=2147483647,c=36,l=26,u=38,h=700,d=/^xn--/,p=/[^\x20-\x7E]/,f=/[\x2E\u3002\uFF0E\uFF61]/g,g={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},m=c-1,y=Math.floor,v=String.fromCharCode;function b(e){throw new RangeError(g[e])}function S(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function w(e,t){var n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),r+S((e=e.replace(f,".")).split("."),t).join(".")}function x(e){for(var t,n,r=[],i=0,s=e.length;i<s;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<s?56320==(64512&(n=e.charCodeAt(i++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--):r.push(t);return r}function C(e){return S(e,(function(e){var t="";return e>65535&&(t+=v((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+v(e)})).join("")}function E(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function T(e,t,n){var r=0;for(e=n?y(e/h):e>>1,e+=y(e/t);e>m*l>>1;r+=c)e=y(e/m);return y(r+(m+1)*e/(e+u))}function A(e){var t,n,r,i,s,o,u,h,d,p,f,g=[],m=e.length,v=0,S=128,w=72;for((n=e.lastIndexOf("-"))<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&b("not-basic"),g.push(e.charCodeAt(r));for(i=n>0?n+1:0;i<m;){for(s=v,o=1,u=c;i>=m&&b("invalid-input"),((h=(f=e.charCodeAt(i++))-48<10?f-22:f-65<26?f-65:f-97<26?f-97:c)>=c||h>y((a-v)/o))&&b("overflow"),v+=h*o,!(h<(d=u<=w?1:u>=w+l?l:u-w));u+=c)o>y(a/(p=c-d))&&b("overflow"),o*=p;w=T(v-s,t=g.length+1,0==s),y(v/t)>a-S&&b("overflow"),S+=y(v/t),v%=t,g.splice(v++,0,S)}return C(g)}function k(e){var t,n,r,i,s,o,u,h,d,p,f,g,m,S,w,C=[];for(g=(e=x(e)).length,t=128,n=0,s=72,o=0;o<g;++o)(f=e[o])<128&&C.push(v(f));for(r=i=C.length,i&&C.push("-");r<g;){for(u=a,o=0;o<g;++o)(f=e[o])>=t&&f<u&&(u=f);for(u-t>y((a-n)/(m=r+1))&&b("overflow"),n+=(u-t)*m,t=u,o=0;o<g;++o)if((f=e[o])<t&&++n>a&&b("overflow"),f==t){for(h=n,d=c;!(h<(p=d<=s?1:d>=s+l?l:d-s));d+=c)w=h-p,S=c-p,C.push(v(E(p+w%S,0))),h=y(w/S);C.push(v(E(h,0))),s=T(n,m,r==i),n=0,++r}++n,++t}return C.join("")}o={version:"1.4.1",ucs2:{decode:x,encode:C},decode:A,encode:k,toASCII:function(e){return w(e,(function(e){return p.test(e)?"xn--"+k(e):e}))},toUnicode:function(e){return w(e,(function(e){return d.test(e)?A(e.slice(4).toLowerCase()):e}))}},void 0===(r=function(){return o}.call(t,n,t,e))||(e.exports=r)}()},8575:(e,t,n)=>{"use strict";var r=n(2511);function i(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var s=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,a=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),l=["'"].concat(c),u=["%","/","?",";","#"].concat(l),h=["/","?","#"],d=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,f={javascript:!0,"javascript:":!0},g={javascript:!0,"javascript:":!0},m={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=n(129);function v(e,t,n){if(e&&"object"==typeof e&&e instanceof i)return e;var r=new i;return r.parse(e,t,n),r}i.prototype.parse=function(e,t,n){if("string"!=typeof e)throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var i=e.indexOf("?"),o=-1!==i&&i<e.indexOf("#")?"?":"#",c=e.split(o);c[0]=c[0].replace(/\\/g,"/");var v=e=c.join(o);if(v=v.trim(),!n&&1===e.split("#").length){var b=a.exec(v);if(b)return this.path=v,this.href=v,this.pathname=b[1],b[2]?(this.search=b[2],this.query=t?y.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var S=s.exec(v);if(S){var w=(S=S[0]).toLowerCase();this.protocol=w,v=v.substr(S.length)}if(n||S||v.match(/^\/\/[^@/]+@[^@/]+/)){var x="//"===v.substr(0,2);!x||S&&g[S]||(v=v.substr(2),this.slashes=!0)}if(!g[S]&&(x||S&&!m[S])){for(var C,E,T=-1,A=0;A<h.length;A++)-1!==(k=v.indexOf(h[A]))&&(-1===T||k<T)&&(T=k);for(-1!==(E=-1===T?v.lastIndexOf("@"):v.lastIndexOf("@",T))&&(C=v.slice(0,E),v=v.slice(E+1),this.auth=decodeURIComponent(C)),T=-1,A=0;A<u.length;A++){var k;-1!==(k=v.indexOf(u[A]))&&(-1===T||k<T)&&(T=k)}-1===T&&(T=v.length),this.host=v.slice(0,T),v=v.slice(T),this.parseHost(),this.hostname=this.hostname||"";var N="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!N)for(var O=this.hostname.split(/\./),P=(A=0,O.length);A<P;A++){var R=O[A];if(R&&!R.match(d)){for(var I="",F=0,D=R.length;F<D;F++)R.charCodeAt(F)>127?I+="x":I+=R[F];if(!I.match(d)){var M=O.slice(0,A),L=O.slice(A+1),_=R.match(p);_&&(M.push(_[1]),L.unshift(_[2])),L.length&&(v="/"+L.join(".")+v),this.hostname=M.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),N||(this.hostname=r.toASCII(this.hostname));var q=this.port?":"+this.port:"",B=this.hostname||"";this.host=B+q,this.href+=this.host,N&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==v[0]&&(v="/"+v))}if(!f[w])for(A=0,P=l.length;A<P;A++){var j=l[A];if(-1!==v.indexOf(j)){var z=encodeURIComponent(j);z===j&&(z=escape(j)),v=v.split(j).join(z)}}var H=v.indexOf("#");-1!==H&&(this.hash=v.substr(H),v=v.slice(0,H));var U=v.indexOf("?");if(-1!==U?(this.search=v.substr(U),this.query=v.substr(U+1),t&&(this.query=y.parse(this.query)),v=v.slice(0,U)):t&&(this.search="",this.query={}),v&&(this.pathname=v),m[w]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){q=this.pathname||"";var V=this.search||"";this.path=q+V}return this.href=this.format(),this},i.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",i=!1,s="";this.host?i=e+this.host:this.hostname&&(i=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&"object"==typeof this.query&&Object.keys(this.query).length&&(s=y.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var o=this.search||s&&"?"+s||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||m[t])&&!1!==i?(i="//"+(i||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):i||(i=""),r&&"#"!==r.charAt(0)&&(r="#"+r),o&&"?"!==o.charAt(0)&&(o="?"+o),t+i+(n=n.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(o=o.replace("#","%23"))+r},i.prototype.resolve=function(e){return this.resolveObject(v(e,!1,!0)).format()},i.prototype.resolveObject=function(e){if("string"==typeof e){var t=new i;t.parse(e,!1,!0),e=t}for(var n=new i,r=Object.keys(this),s=0;s<r.length;s++){var o=r[s];n[o]=this[o]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var a=Object.keys(e),c=0;c<a.length;c++){var l=a[c];"protocol"!==l&&(n[l]=e[l])}return m[n.protocol]&&n.hostname&&!n.pathname&&(n.pathname="/",n.path=n.pathname),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!m[e.protocol]){for(var u=Object.keys(e),h=0;h<u.length;h++){var d=u[h];n[d]=e[d]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||g[e.protocol])n.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),n.pathname=p.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var f=n.pathname||"",y=n.search||"";n.path=f+y}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var v=n.pathname&&"/"===n.pathname.charAt(0),b=e.host||e.pathname&&"/"===e.pathname.charAt(0),S=b||v||n.host&&e.pathname,w=S,x=n.pathname&&n.pathname.split("/")||[],C=(p=e.pathname&&e.pathname.split("/")||[],n.protocol&&!m[n.protocol]);if(C&&(n.hostname="",n.port=null,n.host&&(""===x[0]?x[0]=n.host:x.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),S=S&&(""===p[0]||""===x[0])),b)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,x=p;else if(p.length)x||(x=[]),x.pop(),x=x.concat(p),n.search=e.search,n.query=e.query;else if(null!=e.search)return C&&(n.host=x.shift(),n.hostname=n.host,(N=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=N.shift(),n.hostname=N.shift(),n.host=n.hostname)),n.search=e.search,n.query=e.query,null===n.pathname&&null===n.search||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n;if(!x.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var E=x.slice(-1)[0],T=(n.host||e.host||x.length>1)&&("."===E||".."===E)||""===E,A=0,k=x.length;k>=0;k--)"."===(E=x[k])?x.splice(k,1):".."===E?(x.splice(k,1),A++):A&&(x.splice(k,1),A--);if(!S&&!w)for(;A--;A)x.unshift("..");!S||""===x[0]||x[0]&&"/"===x[0].charAt(0)||x.unshift(""),T&&"/"!==x.join("/").substr(-1)&&x.push("");var N,O=""===x[0]||x[0]&&"/"===x[0].charAt(0);return C&&(n.hostname=O?"":x.length?x.shift():"",n.host=n.hostname,(N=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=N.shift(),n.hostname=N.shift(),n.host=n.hostname)),(S=S||n.host&&x.length)&&!O&&x.unshift(""),x.length>0?n.pathname=x.join("/"):(n.pathname=null,n.path=null),null===n.pathname&&null===n.search||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},i.prototype.parseHost=function(){var e=this.host,t=o.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)},t.Qc=v},8410:(e,t,n)=>{"use strict";n.r(t),n.d(t,{NIL:()=>T,parse:()=>h,stringify:()=>o.Z,v1:()=>l,v3:()=>S,v4:()=>w.Z,v5:()=>E,validate:()=>u.Z,version:()=>A});var r,i,s=n(3653),o=n(3958),a=0,c=0;const l=function(e,t,n){var l=t&&n||0,u=t||new Array(16),h=(e=e||{}).node||r,d=void 0!==e.clockseq?e.clockseq:i;if(null==h||null==d){var p=e.random||(e.rng||s.Z)();null==h&&(h=r=[1|p[0],p[1],p[2],p[3],p[4],p[5]]),null==d&&(d=i=16383&(p[6]<<8|p[7]))}var f=void 0!==e.msecs?e.msecs:Date.now(),g=void 0!==e.nsecs?e.nsecs:c+1,m=f-a+(g-c)/1e4;if(m<0&&void 0===e.clockseq&&(d=d+1&16383),(m<0||f>a)&&void 0===e.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=f,c=g,i=d;var y=(1e4*(268435455&(f+=122192928e5))+g)%4294967296;u[l++]=y>>>24&255,u[l++]=y>>>16&255,u[l++]=y>>>8&255,u[l++]=255&y;var v=f/4294967296*1e4&268435455;u[l++]=v>>>8&255,u[l++]=255&v,u[l++]=v>>>24&15|16,u[l++]=v>>>16&255,u[l++]=d>>>8|128,u[l++]=255&d;for(var b=0;b<6;++b)u[l+b]=h[b];return t||(0,o.Z)(u)};var u=n(7738);const h=function(e){if(!(0,u.Z)(e))throw TypeError("Invalid UUID");var t,n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n};function d(e,t,n){function r(e,r,i,s){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof r&&(r=h(r)),16!==r.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var a=new Uint8Array(16+e.length);if(a.set(r),a.set(e,r.length),(a=n(a))[6]=15&a[6]|t,a[8]=63&a[8]|128,i){s=s||0;for(var c=0;c<16;++c)i[s+c]=a[c];return i}return(0,o.Z)(a)}try{r.name=e}catch(e){}return r.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",r}function p(e){return 14+(e+64>>>9<<4)+1}function f(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function g(e,t,n,r,i,s){return f((o=f(f(t,e),f(r,s)))<<(a=i)|o>>>32-a,n);var o,a}function m(e,t,n,r,i,s,o){return g(t&n|~t&r,e,t,i,s,o)}function y(e,t,n,r,i,s,o){return g(t&r|n&~r,e,t,i,s,o)}function v(e,t,n,r,i,s,o){return g(t^n^r,e,t,i,s,o)}function b(e,t,n,r,i,s,o){return g(n^(t|~r),e,t,i,s,o)}const S=d("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return function(e){for(var t=[],n=32*e.length,r="0123456789abcdef",i=0;i<n;i+=8){var s=e[i>>5]>>>i%32&255,o=parseInt(r.charAt(s>>>4&15)+r.charAt(15&s),16);t.push(o)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[p(t)-1]=t;for(var n=1732584193,r=-271733879,i=-1732584194,s=271733878,o=0;o<e.length;o+=16){var a=n,c=r,l=i,u=s;n=m(n,r,i,s,e[o],7,-680876936),s=m(s,n,r,i,e[o+1],12,-389564586),i=m(i,s,n,r,e[o+2],17,606105819),r=m(r,i,s,n,e[o+3],22,-1044525330),n=m(n,r,i,s,e[o+4],7,-176418897),s=m(s,n,r,i,e[o+5],12,1200080426),i=m(i,s,n,r,e[o+6],17,-1473231341),r=m(r,i,s,n,e[o+7],22,-45705983),n=m(n,r,i,s,e[o+8],7,1770035416),s=m(s,n,r,i,e[o+9],12,-1958414417),i=m(i,s,n,r,e[o+10],17,-42063),r=m(r,i,s,n,e[o+11],22,-1990404162),n=m(n,r,i,s,e[o+12],7,1804603682),s=m(s,n,r,i,e[o+13],12,-40341101),i=m(i,s,n,r,e[o+14],17,-1502002290),n=y(n,r=m(r,i,s,n,e[o+15],22,1236535329),i,s,e[o+1],5,-165796510),s=y(s,n,r,i,e[o+6],9,-1069501632),i=y(i,s,n,r,e[o+11],14,643717713),r=y(r,i,s,n,e[o],20,-373897302),n=y(n,r,i,s,e[o+5],5,-701558691),s=y(s,n,r,i,e[o+10],9,38016083),i=y(i,s,n,r,e[o+15],14,-660478335),r=y(r,i,s,n,e[o+4],20,-405537848),n=y(n,r,i,s,e[o+9],5,568446438),s=y(s,n,r,i,e[o+14],9,-1019803690),i=y(i,s,n,r,e[o+3],14,-187363961),r=y(r,i,s,n,e[o+8],20,1163531501),n=y(n,r,i,s,e[o+13],5,-1444681467),s=y(s,n,r,i,e[o+2],9,-51403784),i=y(i,s,n,r,e[o+7],14,1735328473),n=v(n,r=y(r,i,s,n,e[o+12],20,-1926607734),i,s,e[o+5],4,-378558),s=v(s,n,r,i,e[o+8],11,-2022574463),i=v(i,s,n,r,e[o+11],16,1839030562),r=v(r,i,s,n,e[o+14],23,-35309556),n=v(n,r,i,s,e[o+1],4,-1530992060),s=v(s,n,r,i,e[o+4],11,1272893353),i=v(i,s,n,r,e[o+7],16,-155497632),r=v(r,i,s,n,e[o+10],23,-1094730640),n=v(n,r,i,s,e[o+13],4,681279174),s=v(s,n,r,i,e[o],11,-358537222),i=v(i,s,n,r,e[o+3],16,-722521979),r=v(r,i,s,n,e[o+6],23,76029189),n=v(n,r,i,s,e[o+9],4,-640364487),s=v(s,n,r,i,e[o+12],11,-421815835),i=v(i,s,n,r,e[o+15],16,530742520),n=b(n,r=v(r,i,s,n,e[o+2],23,-995338651),i,s,e[o],6,-198630844),s=b(s,n,r,i,e[o+7],10,1126891415),i=b(i,s,n,r,e[o+14],15,-1416354905),r=b(r,i,s,n,e[o+5],21,-57434055),n=b(n,r,i,s,e[o+12],6,1700485571),s=b(s,n,r,i,e[o+3],10,-1894986606),i=b(i,s,n,r,e[o+10],15,-1051523),r=b(r,i,s,n,e[o+1],21,-2054922799),n=b(n,r,i,s,e[o+8],6,1873313359),s=b(s,n,r,i,e[o+15],10,-30611744),i=b(i,s,n,r,e[o+6],15,-1560198380),r=b(r,i,s,n,e[o+13],21,1309151649),n=b(n,r,i,s,e[o+4],6,-145523070),s=b(s,n,r,i,e[o+11],10,-1120210379),i=b(i,s,n,r,e[o+2],15,718787259),r=b(r,i,s,n,e[o+9],21,-343485551),n=f(n,a),r=f(r,c),i=f(i,l),s=f(s,u)}return[n,r,i,s]}(function(e){if(0===e.length)return[];for(var t=8*e.length,n=new Uint32Array(p(t)),r=0;r<t;r+=8)n[r>>5]|=(255&e[r/8])<<r%32;return n}(e),8*e.length))}));var w=n(2045);function x(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:case 3:return t^n^r;case 2:return t&n^t&r^n&r}}function C(e,t){return e<<t|e>>>32-t}const E=d("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var r=unescape(encodeURIComponent(e));e=[];for(var i=0;i<r.length;++i)e.push(r.charCodeAt(i))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var s=e.length/4+2,o=Math.ceil(s/16),a=new Array(o),c=0;c<o;++c){for(var l=new Uint32Array(16),u=0;u<16;++u)l[u]=e[64*c+4*u]<<24|e[64*c+4*u+1]<<16|e[64*c+4*u+2]<<8|e[64*c+4*u+3];a[c]=l}a[o-1][14]=8*(e.length-1)/Math.pow(2,32),a[o-1][14]=Math.floor(a[o-1][14]),a[o-1][15]=8*(e.length-1)&4294967295;for(var h=0;h<o;++h){for(var d=new Uint32Array(80),p=0;p<16;++p)d[p]=a[h][p];for(var f=16;f<80;++f)d[f]=C(d[f-3]^d[f-8]^d[f-14]^d[f-16],1);for(var g=n[0],m=n[1],y=n[2],v=n[3],b=n[4],S=0;S<80;++S){var w=Math.floor(S/20),E=C(g,5)+x(w,m,y,v)+b+t[w]+d[S]>>>0;b=v,v=y,y=C(m,30)>>>0,m=g,g=E}n[0]=n[0]+g>>>0,n[1]=n[1]+m>>>0,n[2]=n[2]+y>>>0,n[3]=n[3]+v>>>0,n[4]=n[4]+b>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]})),T="00000000-0000-0000-0000-000000000000",A=function(e){if(!(0,u.Z)(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}},3653:(e,t,n)=>{"use strict";var r;n.d(t,{Z:()=>s});var i=new Uint8Array(16);function s(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(i)}},3958:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});for(var r=n(7738),i=[],s=0;s<256;++s)i.push((s+256).toString(16).substr(1));const o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase();if(!(0,r.Z)(n))throw TypeError("Stringified UUID is invalid");return n}},2045:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(3653),i=n(3958);const s=function(e,t,n){var s=(e=e||{}).random||(e.rng||r.Z)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=s[o];return t}return(0,i.Z)(s)}},7738:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const r=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,i=function(e){return"string"==typeof e&&r.test(e)}},4654:()=>{},7218:(e,t,n)=>{"use strict";function r(e,t){return function(){return e.apply(t,arguments)}}const{toString:i}=Object.prototype,{getPrototypeOf:s}=Object,o=(a=Object.create(null),e=>{const t=i.call(e);return a[t]||(a[t]=t.slice(8,-1).toLowerCase())});var a;const c=e=>(e=e.toLowerCase(),t=>o(t)===e),l=e=>t=>typeof t===e,{isArray:u}=Array,h=l("undefined"),d=c("ArrayBuffer"),p=l("string"),f=l("function"),g=l("number"),m=e=>null!==e&&"object"==typeof e,y=e=>{if("object"!==o(e))return!1;const t=s(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},v=c("Date"),b=c("File"),S=c("Blob"),w=c("FileList"),x=c("URLSearchParams");function C(e,t,{allOwnKeys:n=!1}={}){if(null==e)return;let r,i;if("object"!=typeof e&&(e=[e]),u(e))for(r=0,i=e.length;r<i;r++)t.call(null,e[r],r,e);else{const i=n?Object.getOwnPropertyNames(e):Object.keys(e),s=i.length;let o;for(r=0;r<s;r++)o=i[r],t.call(null,e[o],o,e)}}function E(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,i=n.length;for(;i-- >0;)if(r=n[i],t===r.toLowerCase())return r;return null}const T="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:n.g,A=e=>!h(e)&&e!==T,k=(N="undefined"!=typeof Uint8Array&&s(Uint8Array),e=>N&&e instanceof N);var N;const O=c("HTMLFormElement"),P=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),R=c("RegExp"),I=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};C(n,((n,i)=>{let s;!1!==(s=t(n,i,e))&&(r[i]=s||n)})),Object.defineProperties(e,r)},F="abcdefghijklmnopqrstuvwxyz",D="0123456789",M={DIGIT:D,ALPHA:F,ALPHA_DIGIT:F+F.toUpperCase()+D},L=c("AsyncFunction");var _={isArray:u,isArrayBuffer:d,isBuffer:function(e){return null!==e&&!h(e)&&null!==e.constructor&&!h(e.constructor)&&f(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||f(e.append)&&("formdata"===(t=o(e))||"object"===t&&f(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&d(e.buffer),t},isString:p,isNumber:g,isBoolean:e=>!0===e||!1===e,isObject:m,isPlainObject:y,isUndefined:h,isDate:v,isFile:b,isBlob:S,isRegExp:R,isFunction:f,isStream:e=>m(e)&&f(e.pipe),isURLSearchParams:x,isTypedArray:k,isFileList:w,forEach:C,merge:function e(){const{caseless:t}=A(this)&&this||{},n={},r=(r,i)=>{const s=t&&E(n,i)||i;y(n[s])&&y(r)?n[s]=e(n[s],r):y(r)?n[s]=e({},r):u(r)?n[s]=r.slice():n[s]=r};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&C(arguments[e],r);return n},extend:(e,t,n,{allOwnKeys:i}={})=>(C(t,((t,i)=>{n&&f(t)?e[i]=r(t,n):e[i]=t}),{allOwnKeys:i}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,o,a;const c={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),o=i.length;o-- >0;)a=i[o],r&&!r(a,e,t)||c[a]||(t[a]=e[a],c[a]=!0);e=!1!==n&&s(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:o,kindOfTest:c,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(u(e))return e;let t=e.length;if(!g(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:O,hasOwnProperty:P,hasOwnProp:P,reduceDescriptors:I,freezeMethods:e=>{I(e,((t,n)=>{if(f(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];f(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(e,t)=>{const n={},r=e=>{e.forEach((e=>{n[e]=!0}))};return u(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t),findKey:E,global:T,isContextDefined:A,ALPHABET:M,generateString:(e=16,t=M.ALPHA_DIGIT)=>{let n="";const{length:r}=t;for(;e--;)n+=t[Math.random()*r|0];return n},isSpecCompliantForm:function(e){return!!(e&&f(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),n=(e,r)=>{if(m(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[r]=e;const i=u(e)?[]:{};return C(e,((e,t)=>{const s=n(e,r+1);!h(s)&&(i[t]=s)})),t[r]=void 0,i}}return e};return n(e,0)},isAsyncFn:L,isThenable:e=>e&&(m(e)||f(e))&&f(e.then)&&f(e.catch)};function q(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i)}_.inherits(q,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:_.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const B=q.prototype,j={};function z(e){return _.isPlainObject(e)||_.isArray(e)}function H(e){return _.endsWith(e,"[]")?e.slice(0,-2):e}function U(e,t,n){return e?e.concat(t).map((function(e,t){return e=H(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{j[e]={value:e}})),Object.defineProperties(q,j),Object.defineProperty(B,"isAxiosError",{value:!0}),q.from=(e,t,n,r,i,s)=>{const o=Object.create(B);return _.toFlatObject(e,o,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),q.call(o,e.message,t,n,r,i),o.cause=e,o.name=e.name,s&&Object.assign(o,s),o};const V=_.toFlatObject(_,{},null,(function(e){return/^is[A-Z]/.test(e)}));function G(e,t,n){if(!_.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=_.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!_.isUndefined(t[e])}))).metaTokens,i=n.visitor||l,s=n.dots,o=n.indexes,a=(n.Blob||"undefined"!=typeof Blob&&Blob)&&_.isSpecCompliantForm(t);if(!_.isFunction(i))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(_.isDate(e))return e.toISOString();if(!a&&_.isBlob(e))throw new q("Blob is not supported. Use a Buffer instead.");return _.isArrayBuffer(e)||_.isTypedArray(e)?a&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function l(e,n,i){let a=e;if(e&&!i&&"object"==typeof e)if(_.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(_.isArray(e)&&function(e){return _.isArray(e)&&!e.some(z)}(e)||(_.isFileList(e)||_.endsWith(n,"[]"))&&(a=_.toArray(e)))return n=H(n),a.forEach((function(e,r){!_.isUndefined(e)&&null!==e&&t.append(!0===o?U([n],r,s):null===o?n:n+"[]",c(e))})),!1;return!!z(e)||(t.append(U(i,n,s),c(e)),!1)}const u=[],h=Object.assign(V,{defaultVisitor:l,convertValue:c,isVisitable:z});if(!_.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!_.isUndefined(n)){if(-1!==u.indexOf(n))throw Error("Circular reference detected in "+r.join("."));u.push(n),_.forEach(n,(function(n,s){!0===(!(_.isUndefined(n)||null===n)&&i.call(t,n,_.isString(s)?s.trim():s,r,h))&&e(n,r?r.concat(s):[s])})),u.pop()}}(e),t}function W(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function K(e,t){this._pairs=[],e&&G(e,this,t)}const $=K.prototype;function J(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Q(e,t,n){if(!t)return e;const r=n&&n.encode||J,i=n&&n.serialize;let s;if(s=i?i(t,n):_.isURLSearchParams(t)?t.toString():new K(t,n).toString(r),s){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}$.append=function(e,t){this._pairs.push([e,t])},$.toString=function(e){const t=e?function(t){return e.call(this,t,W)}:W;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};var X=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){_.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},Z={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Y={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:K,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]};const ee="undefined"!=typeof window&&"undefined"!=typeof document,te=(ne="undefined"!=typeof navigator&&navigator.product,ee&&["ReactNative","NativeScript","NS"].indexOf(ne)<0);var ne;const re="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts;var ie={...Object.freeze({__proto__:null,hasBrowserEnv:ee,hasStandardBrowserWebWorkerEnv:re,hasStandardBrowserEnv:te}),...Y};function se(e){function t(e,n,r,i){let s=e[i++];if("__proto__"===s)return!0;const o=Number.isFinite(+s),a=i>=e.length;return s=!s&&_.isArray(r)?r.length:s,a?(_.hasOwnProp(r,s)?r[s]=[r[s],n]:r[s]=n,!o):(r[s]&&_.isObject(r[s])||(r[s]=[]),t(e,n,r[s],i)&&_.isArray(r[s])&&(r[s]=function(e){const t={},n=Object.keys(e);let r;const i=n.length;let s;for(r=0;r<i;r++)s=n[r],t[s]=e[s];return t}(r[s])),!o)}if(_.isFormData(e)&&_.isFunction(e.entries)){const n={};return _.forEachEntry(e,((e,r)=>{t(function(e){return _.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),r,n,0)})),n}return null}const oe={transitional:Z,adapter:["xhr","http"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=_.isObject(e);if(i&&_.isHTMLForm(e)&&(e=new FormData(e)),_.isFormData(e))return r&&r?JSON.stringify(se(e)):e;if(_.isArrayBuffer(e)||_.isBuffer(e)||_.isStream(e)||_.isFile(e)||_.isBlob(e))return e;if(_.isArrayBufferView(e))return e.buffer;if(_.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return G(e,new ie.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,r){return ie.isNode&&_.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((s=_.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return G(s?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),function(e,t,n){if(_.isString(e))try{return(0,JSON.parse)(e),_.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||oe.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(e&&_.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(e){if(n){if("SyntaxError"===e.name)throw q.from(e,q.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ie.classes.FormData,Blob:ie.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};_.forEach(["delete","get","head","post","put","patch"],(e=>{oe.headers[e]={}}));var ae=oe;const ce=_.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),le=Symbol("internals");function ue(e){return e&&String(e).trim().toLowerCase()}function he(e){return!1===e||null==e?e:_.isArray(e)?e.map(he):String(e)}function de(e,t,n,r,i){return _.isFunction(r)?r.call(this,t,n):(i&&(t=n),_.isString(t)?_.isString(r)?-1!==t.indexOf(r):_.isRegExp(r)?r.test(t):void 0:void 0)}class pe{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function i(e,t,n){const i=ue(t);if(!i)throw new Error("header name must be a non-empty string");const s=_.findKey(r,i);(!s||void 0===r[s]||!0===n||void 0===n&&!1!==r[s])&&(r[s||t]=he(e))}const s=(e,t)=>_.forEach(e,((e,n)=>i(e,n,t)));return _.isPlainObject(e)||e instanceof this.constructor?s(e,t):_.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim())?s((e=>{const t={};let n,r,i;return e&&e.split("\n").forEach((function(e){i=e.indexOf(":"),n=e.substring(0,i).trim().toLowerCase(),r=e.substring(i+1).trim(),!n||t[n]&&ce[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)})),t})(e),t):null!=e&&i(t,e,n),this}get(e,t){if(e=ue(e)){const n=_.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}(e);if(_.isFunction(t))return t.call(this,e,n);if(_.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=ue(e)){const n=_.findKey(this,e);return!(!n||void 0===this[n]||t&&!de(0,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function i(e){if(e=ue(e)){const i=_.findKey(n,e);!i||t&&!de(0,n[i],i,t)||(delete n[i],r=!0)}}return _.isArray(e)?e.forEach(i):i(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const i=t[n];e&&!de(0,this[i],i,e,!0)||(delete this[i],r=!0)}return r}normalize(e){const t=this,n={};return _.forEach(this,((r,i)=>{const s=_.findKey(n,i);if(s)return t[s]=he(r),void delete t[i];const o=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,n)=>t.toUpperCase()+n))}(i):String(i).trim();o!==i&&delete t[i],t[o]=he(r),n[o]=!0})),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return _.forEach(this,((n,r)=>{null!=n&&!1!==n&&(t[r]=e&&_.isArray(n)?n.join(", "):n)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([e,t])=>e+": "+t)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach((e=>n.set(e))),n}static accessor(e){const t=(this[le]=this[le]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=ue(e);t[r]||(function(e,t){const n=_.toCamelCase(" "+t);["get","set","has"].forEach((r=>{Object.defineProperty(e,r+n,{value:function(e,n,i){return this[r].call(this,t,e,n,i)},configurable:!0})}))}(n,e),t[r]=!0)}return _.isArray(e)?e.forEach(r):r(e),this}}pe.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),_.reduceDescriptors(pe.prototype,(({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[n]=e}}})),_.freezeMethods(pe);var fe=pe;function ge(e,t){const n=this||ae,r=t||n,i=fe.from(r.headers);let s=r.data;return _.forEach(e,(function(e){s=e.call(n,s,i.normalize(),t?t.status:void 0)})),i.normalize(),s}function me(e){return!(!e||!e.__CANCEL__)}function ye(e,t,n){q.call(this,null==e?"canceled":e,q.ERR_CANCELED,t,n),this.name="CanceledError"}_.inherits(ye,q,{__CANCEL__:!0});var ve=ie.hasStandardBrowserEnv?{write(e,t,n,r,i,s){const o=[e+"="+encodeURIComponent(t)];_.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),_.isString(r)&&o.push("path="+r),_.isString(i)&&o.push("domain="+i),!0===s&&o.push("secure"),document.cookie=o.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function be(e,t){return e&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}var Se=ie.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let n;function r(n){let r=n;return e&&(t.setAttribute("href",r),r=t.href),t.setAttribute("href",r),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return n=r(window.location.href),function(e){const t=_.isString(e)?r(e):e;return t.protocol===n.protocol&&t.host===n.host}}():function(){return!0};function we(e,t){let n=0;const r=function(e,t){e=e||10;const n=new Array(e),r=new Array(e);let i,s=0,o=0;return t=void 0!==t?t:1e3,function(a){const c=Date.now(),l=r[o];i||(i=c),n[s]=a,r[s]=c;let u=o,h=0;for(;u!==s;)h+=n[u++],u%=e;if(s=(s+1)%e,s===o&&(o=(o+1)%e),c-i<t)return;const d=l&&c-l;return d?Math.round(1e3*h/d):void 0}}(50,250);return i=>{const s=i.loaded,o=i.lengthComputable?i.total:void 0,a=s-n,c=r(a);n=s;const l={loaded:s,total:o,progress:o?s/o:void 0,bytes:a,rate:c||void 0,estimated:c&&o&&s<=o?(o-s)/c:void 0,event:i};l[t?"download":"upload"]=!0,e(l)}}const xe={http:null,xhr:"undefined"!=typeof XMLHttpRequest&&function(e){return new Promise((function(t,n){let r=e.data;const i=fe.from(e.headers).normalize();let s,o,{responseType:a,withXSRFToken:c}=e;function l(){e.cancelToken&&e.cancelToken.unsubscribe(s),e.signal&&e.signal.removeEventListener("abort",s)}if(_.isFormData(r))if(ie.hasStandardBrowserEnv||ie.hasStandardBrowserWebWorkerEnv)i.setContentType(!1);else if(!1!==(o=i.getContentType())){const[e,...t]=o?o.split(";").map((e=>e.trim())).filter(Boolean):[];i.setContentType([e||"multipart/form-data",...t].join("; "))}let u=new XMLHttpRequest;if(e.auth){const t=e.auth.username||"",n=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";i.set("Authorization","Basic "+btoa(t+":"+n))}const h=be(e.baseURL,e.url);function d(){if(!u)return;const r=fe.from("getAllResponseHeaders"in u&&u.getAllResponseHeaders());!function(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new q("Request failed with status code "+n.status,[q.ERR_BAD_REQUEST,q.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}((function(e){t(e),l()}),(function(e){n(e),l()}),{data:a&&"text"!==a&&"json"!==a?u.response:u.responseText,status:u.status,statusText:u.statusText,headers:r,config:e,request:u}),u=null}if(u.open(e.method.toUpperCase(),Q(h,e.params,e.paramsSerializer),!0),u.timeout=e.timeout,"onloadend"in u?u.onloadend=d:u.onreadystatechange=function(){u&&4===u.readyState&&(0!==u.status||u.responseURL&&0===u.responseURL.indexOf("file:"))&&setTimeout(d)},u.onabort=function(){u&&(n(new q("Request aborted",q.ECONNABORTED,e,u)),u=null)},u.onerror=function(){n(new q("Network Error",q.ERR_NETWORK,e,u)),u=null},u.ontimeout=function(){let t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const r=e.transitional||Z;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(new q(t,r.clarifyTimeoutError?q.ETIMEDOUT:q.ECONNABORTED,e,u)),u=null},ie.hasStandardBrowserEnv&&(c&&_.isFunction(c)&&(c=c(e)),c||!1!==c&&Se(h))){const t=e.xsrfHeaderName&&e.xsrfCookieName&&ve.read(e.xsrfCookieName);t&&i.set(e.xsrfHeaderName,t)}void 0===r&&i.setContentType(null),"setRequestHeader"in u&&_.forEach(i.toJSON(),(function(e,t){u.setRequestHeader(t,e)})),_.isUndefined(e.withCredentials)||(u.withCredentials=!!e.withCredentials),a&&"json"!==a&&(u.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&u.addEventListener("progress",we(e.onDownloadProgress,!0)),"function"==typeof e.onUploadProgress&&u.upload&&u.upload.addEventListener("progress",we(e.onUploadProgress)),(e.cancelToken||e.signal)&&(s=t=>{u&&(n(!t||t.type?new ye(null,e,u):t),u.abort(),u=null)},e.cancelToken&&e.cancelToken.subscribe(s),e.signal&&(e.signal.aborted?s():e.signal.addEventListener("abort",s)));const p=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(h);p&&-1===ie.protocols.indexOf(p)?n(new q("Unsupported protocol "+p+":",q.ERR_BAD_REQUEST,e)):u.send(r||null)}))}};_.forEach(xe,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}}));const Ce=e=>`- ${e}`,Ee=e=>_.isFunction(e)||null===e||!1===e;var Te=e=>{e=_.isArray(e)?e:[e];const{length:t}=e;let n,r;const i={};for(let s=0;s<t;s++){let t;if(n=e[s],r=n,!Ee(n)&&(r=xe[(t=String(n)).toLowerCase()],void 0===r))throw new q(`Unknown adapter '${t}'`);if(r)break;i[t||"#"+s]=r}if(!r){const e=Object.entries(i).map((([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build")));throw new q("There is no suitable adapter to dispatch the request "+(t?e.length>1?"since :\n"+e.map(Ce).join("\n"):" "+Ce(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r};function Ae(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new ye(null,e)}function ke(e){return Ae(e),e.headers=fe.from(e.headers),e.data=ge.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),Te(e.adapter||ae.adapter)(e).then((function(t){return Ae(e),t.data=ge.call(e,e.transformResponse,t),t.headers=fe.from(t.headers),t}),(function(t){return me(t)||(Ae(e),t&&t.response&&(t.response.data=ge.call(e,e.transformResponse,t.response),t.response.headers=fe.from(t.response.headers))),Promise.reject(t)}))}const Ne=e=>e instanceof fe?e.toJSON():e;function Oe(e,t){t=t||{};const n={};function r(e,t,n){return _.isPlainObject(e)&&_.isPlainObject(t)?_.merge.call({caseless:n},e,t):_.isPlainObject(t)?_.merge({},t):_.isArray(t)?t.slice():t}function i(e,t,n){return _.isUndefined(t)?_.isUndefined(e)?void 0:r(void 0,e,n):r(e,t,n)}function s(e,t){if(!_.isUndefined(t))return r(void 0,t)}function o(e,t){return _.isUndefined(t)?_.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function a(n,i,s){return s in t?r(n,i):s in e?r(void 0,n):void 0}const c={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(e,t)=>i(Ne(e),Ne(t),!0)};return _.forEach(Object.keys(Object.assign({},e,t)),(function(r){const s=c[r]||i,o=s(e[r],t[r],r);_.isUndefined(o)&&s!==a||(n[r]=o)})),n}const Pe={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{Pe[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const Re={};Pe.transitional=function(e,t,n){function r(e,t){return"[Axios v1.6.4] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,i,s)=>{if(!1===e)throw new q(r(i," has been removed"+(t?" in "+t:"")),q.ERR_DEPRECATED);return t&&!Re[i]&&(Re[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,s)}};var Ie={assertOptions:function(e,t,n){if("object"!=typeof e)throw new q("options must be an object",q.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const s=r[i],o=t[s];if(o){const t=e[s],n=void 0===t||o(t,s,e);if(!0!==n)throw new q("option "+s+" must be "+n,q.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new q("Unknown option "+s,q.ERR_BAD_OPTION)}},validators:Pe};const Fe=Ie.validators;class De{constructor(e){this.defaults=e,this.interceptors={request:new X,response:new X}}request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=Oe(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;void 0!==n&&Ie.assertOptions(n,{silentJSONParsing:Fe.transitional(Fe.boolean),forcedJSONParsing:Fe.transitional(Fe.boolean),clarifyTimeoutError:Fe.transitional(Fe.boolean)},!1),null!=r&&(_.isFunction(r)?t.paramsSerializer={serialize:r}:Ie.assertOptions(r,{encode:Fe.function,serialize:Fe.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=i&&_.merge(i.common,i[t.method]);i&&_.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete i[e]})),t.headers=fe.concat(s,i);const o=[];let a=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(a=a&&e.synchronous,o.unshift(e.fulfilled,e.rejected))}));const c=[];let l;this.interceptors.response.forEach((function(e){c.push(e.fulfilled,e.rejected)}));let u,h=0;if(!a){const e=[ke.bind(this),void 0];for(e.unshift.apply(e,o),e.push.apply(e,c),u=e.length,l=Promise.resolve(t);h<u;)l=l.then(e[h++],e[h++]);return l}u=o.length;let d=t;for(h=0;h<u;){const e=o[h++],t=o[h++];try{d=e(d)}catch(e){t.call(this,e);break}}try{l=ke.call(this,d)}catch(e){return Promise.reject(e)}for(h=0,u=c.length;h<u;)l=l.then(c[h++],c[h++]);return l}getUri(e){return Q(be((e=Oe(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}_.forEach(["delete","get","head","options"],(function(e){De.prototype[e]=function(t,n){return this.request(Oe(n||{},{method:e,url:t,data:(n||{}).data}))}})),_.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,i){return this.request(Oe(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}De.prototype[e]=t(),De.prototype[e+"Form"]=t(!0)}));var Me=De;class Le{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const n=this;this.promise.then((e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null})),this.promise.then=e=>{let t;const r=new Promise((e=>{n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e,r,i){n.reason||(n.reason=new ye(e,r,i),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}static source(){let e;return{token:new Le((function(t){e=t})),cancel:e}}}var _e=Le;const qe={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(qe).forEach((([e,t])=>{qe[t]=e}));var Be=qe;const je=function e(t){const n=new Me(t),i=r(Me.prototype.request,n);return _.extend(i,Me.prototype,n,{allOwnKeys:!0}),_.extend(i,n,null,{allOwnKeys:!0}),i.create=function(n){return e(Oe(t,n))},i}(ae);je.Axios=Me,je.CanceledError=ye,je.CancelToken=_e,je.isCancel=me,je.VERSION="1.6.4",je.toFormData=G,je.AxiosError=q,je.Cancel=je.CanceledError,je.all=function(e){return Promise.all(e)},je.spread=function(e){return function(t){return e.apply(null,t)}},je.isAxiosError=function(e){return _.isObject(e)&&!0===e.isAxiosError},je.mergeConfig=Oe,je.AxiosHeaders=fe,je.formToJSON=e=>se(_.isHTMLForm(e)?new FormData(e):e),je.getAdapter=Te,je.HttpStatusCode=Be,je.default=je,e.exports=je},2638:e=>{"use strict";e.exports=JSON.parse('{"name":"axios","version":"0.21.4","description":"Promise based HTTP client for the browser and node.js","main":"index.js","scripts":{"test":"grunt test","start":"node ./sandbox/server.js","build":"NODE_ENV=production grunt build","preversion":"npm test","version":"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json","postversion":"git push && git push --tags","examples":"node ./examples/server.js","coveralls":"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js","fix":"eslint --fix lib/**/*.js"},"repository":{"type":"git","url":"https://github.com/axios/axios.git"},"keywords":["xhr","http","ajax","promise","node"],"author":"Matt Zabriskie","license":"MIT","bugs":{"url":"https://github.com/axios/axios/issues"},"homepage":"https://axios-http.com","devDependencies":{"coveralls":"^3.0.0","es6-promise":"^4.2.4","grunt":"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1","karma":"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2","minimist":"^1.2.0","mocha":"^8.2.1","sinon":"^4.5.0","terser-webpack-plugin":"^4.2.3","typescript":"^4.0.5","url-search-params":"^0.10.0","webpack":"^4.44.2","webpack-dev-server":"^3.11.0"},"browser":{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},"jsdelivr":"dist/axios.min.js","unpkg":"dist/axios.min.js","typings":"./index.d.ts","dependencies":{"follow-redirects":"^1.14.0"},"bundlesize":[{"path":"./dist/axios.min.js","threshold":"5kB"}]}')}},r={};function i(e){var t=r[e];if(void 0!==t)return t.exports;var s=r[e]={id:e,loaded:!1,exports:{}};return n[e].call(s.exports,s,s.exports,i),s.loaded=!0,s.exports}i.m=n,i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,n)=>(i.f[n](e,t),t)),[])),i.u=e=>e+".fsbot.min.js",i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="fsbot:",i.l=(n,r,s,o)=>{if(e[n])e[n].push(r);else{var a,c;if(void 0!==s)for(var l=document.getElementsByTagName("script"),u=0;u<l.length;u++){var h=l[u];if(h.getAttribute("src")==n||h.getAttribute("data-webpack")==t+s){a=h;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,i.nc&&a.setAttribute("nonce",i.nc),a.setAttribute("data-webpack",t+s),a.src=n),e[n]=[r];var d=(t,r)=>{a.onerror=a.onload=null,clearTimeout(p);var i=e[n];if(delete e[n],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((e=>e(r))),t)return t(r)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),c&&document.head.appendChild(a)}},i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&!e;)e=n[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e})(),(()=>{var e={179:0};i.f.j=(t,n)=>{var r=i.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var s=new Promise(((n,i)=>r=e[t]=[n,i]));n.push(r[2]=s);var o=i.p+i.u(t),a=new Error;i.l(o,(n=>{if(i.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var s=n&&("load"===n.type?"missing":n.type),o=n&&n.target&&n.target.src;a.message="Loading chunk "+t+" failed.\n("+s+": "+o+")",a.name="ChunkLoadError",a.type=s,a.request=o,r[1](a)}}),"chunk-"+t,t)}};var t=(t,n)=>{var r,s,[o,a,c]=n,l=0;if(o.some((t=>0!==e[t]))){for(r in a)i.o(a,r)&&(i.m[r]=a[r]);c&&c(i)}for(t&&t(n);l<o.length;l++)s=o[l],i.o(e,s)&&e[s]&&e[s][0](),e[s]=0},n=self.webpackChunkfsbot=self.webpackChunkfsbot||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var s=i(1478),o=window;for(var a in s)o[a]=s[a];s.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})})();
//# sourceMappingURL=fsbot.min.js.map