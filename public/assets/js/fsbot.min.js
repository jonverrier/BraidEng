/*! For license information please see fsbot.min.js.LICENSE.txt */
(()=>{var e,t,r={5969:(e,t,r)=>{"use strict";r.r(t),r.d(t,{AzureAudience:()=>i,AzureClient:()=>ss,AzureFunctionTokenProvider:()=>cs,ScopeType:()=>is});var n={};r.r(n),r.d(n,{Decoder:()=>Lr,Encoder:()=>Mr,PacketType:()=>Dr,protocol:()=>kr});var s=r(9074);class i extends s.c{createServiceMember(e){const t=e.user;return function(e,t){if(!e)throw new Error(t)}(void 0!==(null==t?void 0:t.name),'Provided user was not an "AzureUser".'),{userId:e.user.id,userName:t.name,connections:[],additionalDetails:t.additionalDetails}}}var o=r(3738),a=r(2045),c=r(1783),h=r(4839),l=r(2186),u=r(2738);const d=e=>"fluid"===(null==e?void 0:e.type);function p(e){if(!d(e))throw new Error(`resolved is not a Fluid url. Type: ${null==e?void 0:e.type}`)}class g{constructor(e){this.urlResolvers=e}static create(e){return Array.isArray(e)?1===e.length?e[0]:new g(e):e}async resolve(e){return async function(e,t){let r;for(const n of e)if(r=await n.resolve(Object.assign({},t)),void 0!==r)return r}(this.urlResolvers,e)}async getAbsoluteUrl(e,t){throw new Error("Not implmented")}}var m=r(8575);class f{constructor(e){this.protocolName="none:",this.protocolToDocumentFactoryMap=new Map,e.forEach((e=>{this.protocolToDocumentFactoryMap.set(e.protocolName,e)}))}static create(e){if(Array.isArray(e)){const t=[];return e.forEach((e=>{const r=e;void 0!==r.protocolToDocumentFactoryMap?t.push(...r.protocolToDocumentFactoryMap.values()):t.push(e)})),1===t.length?t[0]:new f(t)}return e}async createDocumentService(e,t,r){p(e);const n=(0,m.Qc)(e.url);if(void 0===n.protocol||null===n.protocol)throw new Error("No protocol provided");const s=this.protocolToDocumentFactoryMap.get(n.protocol);if(void 0===s)throw new Error("Unknown Fluid protocol");return s.createDocumentService(e,t,r)}async createContainer(e,t,r,n){p(t);const s=(0,m.Qc)(t.url);if(void 0===s.protocol||null===s.protocol)throw new Error("No protocol provided");const i=this.protocolToDocumentFactoryMap.get(s.protocol);if(void 0===i)throw new Error("Unknown Fluid protocol");return i.createContainer(e,t,r,n)}}var y=r(2492),v=r.n(y);const b=window.performance;function S(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}function w(e,t="Unreachable Case"){throw new Error(t)}var x,C=r(7846),E=r(9268);function A(e,t){return{type:x.Tree,tree:{".protocol":t,".app":e}}}!function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(x||(x={}));const T=window.performance,O=async e=>new Promise((t=>setTimeout((()=>t()),e)));var N=r(2505),P=r(9077);const R="1.3.7";async function I(e,t,r,n){var s,i;let o,a=!1,c=1e3,h=0;const l=T.now();let u;do{try{o=await e(n.cancel),a=!0}catch(e){if(!(0,P.ms)(e))throw r.sendTelemetryEvent({eventName:`${t}_cancel`,retry:h,duration:T.now()-l,fetchCallName:t},e),e;if(!0===(null===(s=n.cancel)||void 0===s?void 0:s.aborted))throw r.sendTelemetryEvent({eventName:`${t}_runWithRetryAborted`,retry:h,duration:T.now()-l,fetchCallName:t},e),new P.V2("runWithRetry was Aborted",N.C.genericError,{driverVersion:R,fetchCallName:t});h++,u=e,c=null!==(i=(0,P.ZZ)(e))&&void 0!==i?i:Math.min(2*c,8e3),n.onRetry&&n.onRetry(c,e),await O(c)}}while(!a);return h>0&&r.sendTelemetryEvent({eventName:`${t}_lastError`,retry:h,duration:T.now()-l,fetchCallName:t},u),o}var F,k,D,M=r(9252),q=r(4025);(D=F||(F={})).NoOp="noop",D.ClientJoin="join",D.ClientLeave="leave",D.Propose="propose",D.Reject="reject",D.Summarize="summarize",D.SummaryAck="summaryAck",D.SummaryNack="summaryNack",D.Operation="op",D.RemoteHelp="remoteHelp",D.NoClient="noClient",D.RoundTrip="tripComplete",D.Control="control",function(e){e.ThrottlingError="ThrottlingError",e.InvalidScopeError="InvalidScopeError",e.BadRequestError="BadRequestError",e.LimitExceededError="LimitExceededError"}(k||(k={}));var L,B,j,_=r(7187),H=r(361),U=r.n(H);class z extends _.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}function V(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}class G{constructor(e,t,r,n){this.sequenceNumber=e,this.key=t,this.value=r,this.local=n}}class K extends z{constructor(e){super(),this.isDisposed=!1,this.members=new Map(e),this.snapshotCache=e}get disposed(){return this.isDisposed}snapshot(){var e;return null!==(e=this.snapshotCache)&&void 0!==e||(this.snapshotCache=U()(Array.from(this.members))),this.snapshotCache}addMember(e,t){V(!this.members.has(e),462),this.members.set(e,t),this.emit("addMember",e,t),this.snapshotCache=void 0}removeMember(e){V(this.members.has(e),463),this.members.delete(e),this.emit("removeMember",e),this.snapshotCache=void 0}getMembers(){return new Map(this.members)}getMember(e){return this.members.get(e)}dispose(){this.isDisposed=!0}}class W extends z{constructor(e,t){super(),this.sendProposal=t,this.isDisposed=!1,this.stateEvents=new _.EventEmitter,this.proposals=new Map(e.proposals.map((([,e])=>[e.sequenceNumber,new G(e.sequenceNumber,e.key,e.value,!1)]))),this.values=new Map(e.values),this.proposalsSnapshotCache=e.proposals,this.valuesSnapshotCache=e.values}get disposed(){return this.isDisposed}snapshot(){var e,t;return null!==(e=this.proposalsSnapshotCache)&&void 0!==e||(this.proposalsSnapshotCache=Array.from(this.proposals).map((([e,t])=>[e,{sequenceNumber:e,key:t.key,value:t.value},[]]))),null!==(t=this.valuesSnapshotCache)&&void 0!==t||(this.valuesSnapshotCache=U()(Array.from(this.values))),{proposals:this.proposalsSnapshotCache,values:this.valuesSnapshotCache}}has(e){return this.values.has(e)}get(e){var t;return null===(t=this.values.get(e))||void 0===t?void 0:t.value}getApprovalData(e){const t=this.values.get(e);return t?U()(t):void 0}async propose(e,t){const r=this.sendProposal(e,t);if(r<0)throw this.emit("error",{eventName:"ProposalInDisconnectedState",key:e}),new Error("Can't propose in disconnected state");return new Promise(((e,t)=>{let n;const s=(e,t)=>{e===r&&(n=t,this.stateEvents.off("localProposalSequenced",s),this.stateEvents.off("disconnected",o),this.stateEvents.on("localProposalApproved",i))},i=t=>{t===n&&(e(),c())},o=()=>{void 0===n&&this.stateEvents.once("connected",(()=>{void 0===n&&(t(new Error("Client disconnected without successfully sending proposal")),c())}))},a=()=>{t(new Error("QuorumProposals was disposed")),c()},c=()=>{this.stateEvents.off("localProposalSequenced",s),this.stateEvents.off("localProposalApproved",i),this.stateEvents.off("disconnected",o),this.stateEvents.off("disposed",a)};this.stateEvents.on("localProposalSequenced",s),this.stateEvents.on("disconnected",o),this.stateEvents.on("disposed",a)}))}addProposal(e,t,r,n,s){V(!this.proposals.has(r),464);const i=new G(r,e,t,n);this.proposals.set(r,i),this.emit("addProposal",i),n&&this.stateEvents.emit("localProposalSequenced",s,r),this.proposalsSnapshotCache=void 0}updateMinimumSequenceNumber(e){const t=e.minimumSequenceNumber,r=[];for(const[e,n]of this.proposals)e<=t&&r.push(n);r.sort(((e,t)=>e.sequenceNumber-t.sequenceNumber));for(const t of r){const r={approvalSequenceNumber:e.sequenceNumber,commitSequenceNumber:-1,key:t.key,sequenceNumber:t.sequenceNumber,value:t.value};this.values.set(r.key,r),this.valuesSnapshotCache=void 0,this.emit("approveProposal",r.sequenceNumber,r.key,r.value,r.approvalSequenceNumber),this.proposals.delete(t.sequenceNumber),this.proposalsSnapshotCache=void 0,t.local&&this.stateEvents.emit("localProposalApproved",t.sequenceNumber)}}setConnectionState(e){e?this.stateEvents.emit("connected"):this.stateEvents.emit("disconnected")}dispose(){this.isDisposed=!0,this.stateEvents.emit("disposed")}}class $ extends z{constructor(e,t,r,n){super(),this.isDisposed=!1,this.quorumClients=new K(e),this.quorumClients.on("addMember",((e,t)=>{this.emit("addMember",e,t)})),this.quorumClients.on("removeMember",(e=>{this.emit("removeMember",e)})),this.quorumProposals=new W({proposals:t,values:r},n),this.quorumProposals.on("addProposal",(e=>{this.emit("addProposal",e)})),this.quorumProposals.on("approveProposal",((e,t,r,n)=>{this.emit("approveProposal",e,t,r,n)}))}get disposed(){return this.isDisposed}close(){this.removeAllListeners()}snapshot(){const e=this.quorumClients.snapshot(),{proposals:t,values:r}=this.quorumProposals.snapshot();return{members:e,proposals:t,values:r}}has(e){return this.quorumProposals.has(e)}get(e){return this.quorumProposals.get(e)}getApprovalData(e){return this.quorumProposals.getApprovalData(e)}addMember(e,t){this.quorumClients.addMember(e,t)}removeMember(e){this.quorumClients.removeMember(e)}getMembers(){return this.quorumClients.getMembers()}getMember(e){return this.quorumClients.getMember(e)}async propose(e,t){return this.quorumProposals.propose(e,t)}addProposal(e,t,r,n,s){return this.quorumProposals.addProposal(e,t,r,n,s)}updateMinimumSequenceNumber(e){this.quorumProposals.updateMinimumSequenceNumber(e)}setConnectionState(e,t){this.quorumProposals.setConnectionState(e)}dispose(){throw new Error("Not implemented.")}}class J{constructor(e,t,r,n,s,i,o){this.minimumSequenceNumber=e,this.sequenceNumber=t,this.term=null!=r?r:1,this._quorum=new $(n,s,i,o)}get quorum(){return this._quorum}get attributes(){return{minimumSequenceNumber:this.minimumSequenceNumber,sequenceNumber:this.sequenceNumber,term:this.term}}setConnectionState(e,t){this._quorum.setConnectionState(e,t)}snapshot(){return this._quorum.snapshot()}close(){this._quorum.close()}processMessage(e,t){if(e.sequenceNumber!==this.sequenceNumber+1)throw new Error(`Protocol state is not moving sequentially. Current is ${this.sequenceNumber}. Next is ${e.sequenceNumber}`);this.sequenceNumber=e.sequenceNumber,this.minimumSequenceNumber=e.minimumSequenceNumber;let r=!1;switch(e.type){case F.ClientJoin:const n=e,s=JSON.parse(n.data),i={client:s.detail,sequenceNumber:n.sequenceNumber};this._quorum.addMember(s.clientId,i);break;case F.ClientLeave:const o=e,a=JSON.parse(o.data);this._quorum.removeMember(a);break;case F.Propose:const c=e.contents;this._quorum.addProposal(c.key,c.value,e.sequenceNumber,t,e.clientSequenceNumber),r=!0;break;case F.Reject:throw new Error("Quorum rejection is removed.")}return this._quorum.updateMinimumSequenceNumber(e),{immediateNoOp:r}}getProtocolState(){return Object.assign({sequenceNumber:this.sequenceNumber,minimumSequenceNumber:this.minimumSequenceNumber},this._quorum.snapshot())}}class X extends J{processMessage(e,t){const r=this._quorum.getMember(e.clientId);if(null!=e.clientId){if(void 0===r&&e.type!==F.ClientJoin)throw new Error("Remote message's clientId is missing from the quorum");if(!0===(null==r?void 0:r.shouldHaveLeft)&&e.type!==F.NoOp)throw new Error("Remote message's clientId already should have left")}return super.processMessage(e,t)}}!function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(L||(L={})),function(e){e.NoOp="noop",e.ClientJoin="join",e.ClientLeave="leave",e.Propose="propose",e.Reject="reject",e.Summarize="summarize",e.SummaryAck="summaryAck",e.SummaryNack="summaryNack",e.Operation="op",e.RemoteHelp="remoteHelp",e.NoClient="noClient",e.RoundTrip="tripComplete",e.Control="control"}(B||(B={})),function(e){e.ThrottlingError="ThrottlingError",e.InvalidScopeError="InvalidScopeError",e.BadRequestError="BadRequestError",e.LimitExceededError="LimitExceededError"}(j||(j={}));var Q,Z=r(120),Y=r(8595),ee=r(2718);class te extends _.EventEmitter{constructor(){super(...arguments),this.members=new Map}on(e,t){return super.on(e,t)}addMember(e,t){this.members.set(e,t),this.emit("addMember",e,t)}removeMember(e){const t=this.members.get(e);return void 0!==t&&(this.members.delete(e),this.emit("removeMember",e,t),!0)}getMembers(){return new Map(this.members)}getMember(e){return this.members.get(e)}clear(){const e=this.members.keys();for(const t of e)this.removeMember(t)}}class re{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return void 0===this.result&&(this.result=this.execute()),this.result}}class ne{constructor(e,t,r,n,s,i,o,a,c,h,l,u,d,p,g){this.container=e,this.scope=t,this.codeLoader=r,this._codeDetails=n,this._baseSnapshot=s,this.deltaManager=i,this.loader=a,this.submitFn=c,this.submitSignalFn=h,this.closeFn=l,this.version=u,this.updateDirtyContainerState=d,this.existing=p,this.pendingLocalState=g,this._disposed=!1,this._quorum=o,this.taggedLogger=e.subLogger,this._fluidModuleP=new re((async()=>this.loadCodeModule(n))),this.attachListener()}static async createOrLoad(e,t,r,n,s,i,o,a,c,h,l,u,d,p,g){const m=new ne(e,t,r,n,s,i,o,a,c,h,l,u,d,p,g);return await m.instantiateRuntime(p),m}get clientId(){return this.container.clientId}get id(){const e=this.container.resolvedUrl;return d(e)?e.id:""}get clientDetails(){return this.container.clientDetails}get connected(){return this.container.connected}get canSummarize(){return"summarize"in this.runtime}get serviceConfiguration(){return this.container.serviceConfiguration}get audience(){return this.container.audience}get options(){return this.container.options}get baseSnapshot(){return this._baseSnapshot}get storage(){return this.container.storage}get runtime(){if(void 0===this._runtime)throw new Error("Attempted to access runtime before it was defined");return this._runtime}get disposed(){return this._disposed}get codeDetails(){return this._codeDetails}get quorum(){return this._quorum}getSpecifiedCodeDetails(){var e;return null!==(e=this._quorum.get("code"))&&void 0!==e?e:this._quorum.get("code2")}dispose(e){this._disposed||(this._disposed=!0,this.runtime.dispose(e),this._quorum.dispose(),this.deltaManager.dispose())}getLoadedFromVersion(){return this.container.loadedFromVersion}get attachState(){return this.container.attachState}createSummary(e){return this.runtime.createSummary(e)}setConnectionState(e,t){const r=this.runtime;S(e===this.connected,222),r.setConnectionState(e,t)}process(e,t,r){this.runtime.process(e,t,r)}processSignal(e,t){this.runtime.processSignal(e,t)}async request(e){return this.runtime.request(e)}async getAbsoluteUrl(e){return this.container.getAbsoluteUrl(e)}getPendingLocalState(){return this.runtime.getPendingLocalState()}async satisfies(e){var t;const r=[],n=this.codeLoader;void 0!==n.IFluidCodeDetailsComparer&&r.push(n.IFluidCodeDetailsComparer);const s=await this._fluidModuleP,i=null===(t=s.module)||void 0===t?void 0:t.fluidExport;if(void 0!==(null==i?void 0:i.IFluidCodeDetailsComparer)&&r.push(i.IFluidCodeDetailsComparer),0===r.length)return!1;for(const t of r)if(!1===await t.satisfies(s.details,e))return!1;return!0}notifyAttaching(e){var t,r;this._baseSnapshot=e,null===(r=(t=this.runtime).notifyAttaching)||void 0===r||r.call(t,e),this.runtime.setAttachState(o.mB.Attaching)}async getRuntimeFactory(){var e;const t=null===(e=(await this._fluidModuleP).module)||void 0===e?void 0:e.fluidExport,r=null==t?void 0:t.IRuntimeFactory;if(void 0===r)throw new Error("Code package does not implement IRuntimeFactory");return r}async instantiateRuntime(e){const t=await this.getRuntimeFactory();this._runtime=await t.instantiateRuntime(this,e)}attachListener(){this.container.once("attached",(()=>{this.runtime.setAttachState(o.mB.Attached)}))}async loadCodeModule(e){const t=await u.Xr.timedExecAsync(this.taggedLogger,{eventName:"CodeLoad"},(async()=>this.codeLoader.load(e)));if("module"in t){const{module:r,details:n}=t;return{module:r,details:null!=n?n:e}}return this.taggedLogger.sendTelemetryEvent({eventName:"LegacyCodeLoader"}),t}}!function(e){e.Never="Never",e.Disabled="Disabled",e.Enabled="Enabled"}(Q||(Q={}));var se=r(8599),ie=r.n(se);class oe extends _.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}var ae=r(5708),ce=r(7237),he=r.n(ce);class le extends oe{constructor(e){super(),this.worker=e,this.isDisposed=!1,this.q=new(he()),this.pauseCount=1}get disposed(){return this.isDisposed}get paused(){return 0!==this.pauseCount}get length(){return this.q.length}get idle(){return void 0===this.processingPromise&&0===this.q.length}async waitTillProcessingDone(){var e;return null!==(e=this.processingPromise)&&void 0!==e?e:{count:0,duration:0}}dispose(){throw new Error("Not implemented.")}clear(){this.q.clear()}peek(){return this.q.peekFront()}toArray(){return this.q.toArray()}push(e){try{this.q.push(e),this.emit("push",e),this.ensureProcessing()}catch(e){this.emit("error",e)}}async pause(){this.pauseCount++,await this.waitTillProcessingDone()}resume(){S(this.pauseCount>0,244),this.pauseCount--,this.ensureProcessing()}ensureProcessing(){this.anythingToProcess()&&void 0===this.processingPromise&&(this.processingPromise=Promise.resolve().then((()=>{S(void 0!==this.processingPromise,"reentrancy?");const e=this.processDeltas();return S(void 0!==this.processingPromise,"reentrancy?"),this.processingPromise=void 0,e})).catch((e=>(this.error=e,this.processingPromise=void 0,this.emit("error",e),{count:0,duration:0}))),S(void 0!==this.processingPromise,"processDeltas() should run async"))}anythingToProcess(){return 0!==this.q.length&&!this.paused&&void 0===this.error}processDeltas(){const e=b.now();let t=0;for(;this.anythingToProcess();){const e=this.q.shift();t++,this.worker(e),this.emit("op",e)}const r=b.now()-e;return 0===this.q.length&&this.emit("idle",t,r),{count:t,duration:r}}}class ue extends oe{constructor(e,t,r,n){super(),this.serviceProvider=e,this.logger=t,this._active=r,this.pending=[],this.minSequenceNumber=0,this.lastQueuedSequenceNumber=0,this.lastObservedSeqNumber=0,this.lastProcessedSequenceNumber=0,this.baseTerm=0,this.opsSize=0,this.initSequenceNumber=0,this.closed=!1,this.throttlingIdSet=new Set,this.timeTillThrottling=0,this.closeAbortController=new(ie()),this.deltaStorageDelayId=(0,a.Z)(),this.deltaStreamDelayId=(0,a.Z)(),this.messageBuffer=[];const s={incomingOpHandler:(e,t)=>{try{this.enqueueMessages(e,t)}catch(e){this.logger.sendErrorEvent({eventName:"EnqueueMessages_Exception"},e),this.close((0,ee.SC)(e))}},signalHandler:e=>this._inboundSignal.push(e),reconnectionDelayHandler:(e,t)=>this.emitDelayInfo(this.deltaStreamDelayId,e,t),closeHandler:e=>this.close(e),disconnectHandler:e=>this.disconnectHandler(e),connectHandler:e=>this.connectHandler(e),pongHandler:e=>this.emit("pong",e),readonlyChangeHandler:e=>(0,Y.Eb)(this,this.logger,"readonly",e)};this.connectionManager=n(s),this._inbound=new le((e=>{this.processInboundMessage(e)})),this._inbound.on("error",(e=>{this.close(E.Hi.wrapIfUnrecognized(e,"deltaManagerInboundErrorHandler",this.lastMessage))})),this._inboundSignal=new le((e=>{if(void 0===this.handler)throw new Error("Attempted to process an inbound signal without a handler attached");this.handler.processSignal({clientId:e.clientId,content:JSON.parse(e.content)})})),this._inboundSignal.on("error",(e=>{this.close((0,ee.SC)(e))}))}get active(){return this._active()}get disposed(){return this.closed}get IDeltaSender(){return this}get inbound(){return this._inbound}get inboundSignal(){return this._inboundSignal}get initialSequenceNumber(){return this.initSequenceNumber}get lastSequenceNumber(){return this.lastProcessedSequenceNumber}get lastMessage(){return this.lastProcessedMessage}get lastKnownSeqNumber(){return this.lastObservedSeqNumber}get referenceTerm(){return this.baseTerm}get minimumSequenceNumber(){return this.minSequenceNumber}get hasCheckpointSequenceNumber(){return S(this.connectionManager.connected,223),void 0!==this._checkpointSequenceNumber}get maxMessageSize(){return this.connectionManager.maxMessageSize}get version(){return this.connectionManager.version}get serviceConfiguration(){return this.connectionManager.serviceConfiguration}get outbound(){return this.connectionManager.outbound}get readOnlyInfo(){return this.connectionManager.readOnlyInfo}get clientDetails(){return this.connectionManager.clientDetails}submit(e,t,r=!1,n){const s={contents:JSON.stringify(t),metadata:n,referenceSequenceNumber:this.lastProcessedSequenceNumber,type:e};r||this.flush();const i=this.connectionManager.prepareMessageToSend(s);return void 0===i?-1:(this.opsSize+=i.contents.length,this.messageBuffer.push(i),this.emit("submitOp",i),r||this.flush(),i.clientSequenceNumber)}submitSignal(e){return this.connectionManager.submitSignal(e)}flush(){0!==this.messageBuffer.length&&(this.emit("prepareSend",this.messageBuffer),this.connectionManager.sendMessages(this.messageBuffer),this.messageBuffer=[])}get connectionProps(){return Object.assign({sequenceNumber:this.lastSequenceNumber,opsSize:this.opsSize>0?this.opsSize:void 0},this.connectionManager.connectionProps)}logConnectionIssue(e){var t;S(this.connectionManager.connected,568);const r=this.pending.sort(((e,t)=>e.sequenceNumber-t.sequenceNumber));this.logger.sendErrorEvent(Object.assign(Object.assign(Object.assign(Object.assign({},e),{fetchReason:this.fetchReason,lastQueuedSequenceNumber:this.lastQueuedSequenceNumber,lastProcessedSequenceNumber:this.lastProcessedSequenceNumber,lastObserved:this.lastObservedSeqNumber}),this.connectionManager.connectionVerboseProps),{pendingOps:this.pending.length,pendingFirst:null===(t=r[0])||void 0===t?void 0:t.sequenceNumber,haveHandler:void 0!==this.handler,inboundLength:this.inbound.length,inboundPaused:this.inbound.paused}))}connectHandler(e){this.refreshDelayInfo(this.deltaStreamDelayId);const t=this.connectionManager.connectionVerboseProps;t.connectionLastQueuedSequenceNumber=this.lastQueuedSequenceNumber,t.connectionLastObservedSeqNumber=this.lastObservedSeqNumber;const r=e.checkpointSequenceNumber;this._checkpointSequenceNumber=r,void 0!==r&&this.updateLatestKnownOpSeqNumber(r),S(0===this.messageBuffer.length,233),this.opsSize=0,this.emit("connect",e,void 0!==r?this.lastObservedSeqNumber-this.lastSequenceNumber:void 0),void 0!==r?r>this.lastQueuedSequenceNumber&&this.fetchMissingDeltas("AfterConnection"):"read"===e.mode&&this.fetchMissingDeltas("AfterReadConnection")}dispose(){throw new Error("Not implemented.")}async attachOpHandler(e,t,r,n,s="none"){if(this.initSequenceNumber=t,this.lastProcessedSequenceNumber=t,this.baseTerm=r,this.minSequenceNumber=e,this.lastQueuedSequenceNumber=t,this.lastObservedSeqNumber=t,S(void 0===this.handler,226),this.handler=n,S(!!this.handler,227),S(void 0===this.fetchReason,616),!this.closed){if(this._inbound.resume(),this._inboundSignal.resume(),"none"!==s){const e="cached"===s;await this.fetchMissingDeltasCore(`DocumentOpen_${s}`,e),e&&this.fetchMissingDeltas("PostDocumentOpen")}S(void 0!==this.fetchReason||0===this.pending.length,617)}}connect(e){var t;const r=null===(t=e.fetchOpsFromStorage)||void 0===t||t;(0,ae.M)(void 0!==this.handler||!r,this.logger,"CantFetchWithoutBaseline"),r&&this.fetchMissingDeltas(e.reason),this.connectionManager.connect(e.mode)}async getDeltas(e,t,r,n,s){const i=this.serviceProvider();if(void 0===i)throw new Error("Delta manager is not attached");let o;if(void 0===this.deltaStorage&&(this.deltaStorage=await i.connectToDeltaStorage()),void 0!==t){const n=t-1;if(this.lastQueuedSequenceNumber>=n)return void this.logger.sendPerformanceEvent(Object.assign({reason:r,eventName:"ExtraStorageCall",early:!0,from:e,to:t},this.connectionManager.connectionVerboseProps));o=e=>e.sequenceNumber>=n}else o=e=>e.sequenceNumber>=this.lastObservedSeqNumber;const a=new(ie());let c=!1;const h=e=>{S(e.sequenceNumber===this.lastQueuedSequenceNumber,570),!c&&o(e)&&(a.abort(),this._inbound.off("push",h))};try{this._inbound.on("push",h),S(null===this.closeAbortController.signal.onabort,488),this.closeAbortController.signal.onabort=()=>a.abort();const i=this.deltaStorage.fetchMessages(e,t,a.signal,s,r);for(;;){const e=await i.read();if(e.done)break;try{c=!0,n(e.value)}finally{c=!1}}}finally{this.closeAbortController.signal.onabort=null,this._inbound.off("push",h),S(!c,649)}}close(e){this.closed||(this.closed=!0,this.connectionManager.dispose(e),this.closeAbortController.abort(),this._inbound.clear(),this._inboundSignal.clear(),this._inbound.pause(),this._inboundSignal.pause(),this.pending=[],this.emit("closed",e),this.removeAllListeners())}refreshDelayInfo(e){this.throttlingIdSet.delete(e),0===this.throttlingIdSet.size&&(this.timeTillThrottling=0)}disconnectHandler(e){this.messageBuffer.length=0,this.emit("disconnect",e)}emitDelayInfo(e,t,r){const n=Date.now();if(this.throttlingIdSet.add(e),t>0&&n+t>this.timeTillThrottling){this.timeTillThrottling=n+t;const e=E.FQ.wrap(r,t/1e3,this.logger);this.emit("throttled",e)}}comparableMessagePayload(e){return`${e.clientId}-${e.type}-${e.minimumSequenceNumber}-${e.referenceSequenceNumber}-${e.timestamp}`}enqueueMessages(e,t,r=!1){var n,s;if(void 0===this.handler)return void(this.pending=this.pending.concat(e));if(S(0===this.pending.length||void 0!==this.fetchReason,489),0===e.length)return;const i=e[0].sequenceNumber,o=e[e.length-1].sequenceNumber;if(o>this.lastQueuedSequenceNumber){let n=i-1;const s=n-this.lastQueuedSequenceNumber;let a,c,h=0,l=0;for(const t of e)t.sequenceNumber===n?h++:t.sequenceNumber!==n+1&&(l++,void 0===a&&(a=n+1)),n=t.sequenceNumber;0!==h||0!==l&&!r||s>0&&void 0===this.fetchReason?c="enqueueMessages":void 0!==this.fetchReason&&this.fetchReason!==t&&i<=this.lastQueuedSequenceNumber+1&&o>this.lastQueuedSequenceNumber&&(c="enqueueMessagesExtraFetch"),void 0!==c&&this.logger.sendPerformanceEvent(Object.assign({eventName:c,reason:t,previousReason:this.prevEnqueueMessagesReason,from:i,to:o+1,length:e.length,fetchReason:this.fetchReason,duplicate:h>0?h:void 0,initialGap:0!==s?s:void 0,gap:l>0?l:void 0,firstMissing:a,dmInitialSeqNumber:this.initialSequenceNumber},this.connectionManager.connectionVerboseProps))}this.updateLatestKnownOpSeqNumber(e[e.length-1].sequenceNumber);const a=null===(n=this.previouslyProcessedMessage)||void 0===n?void 0:n.sequenceNumber;S(void 0===a||a===this.lastQueuedSequenceNumber,236);for(const r of e)if(r.sequenceNumber<=this.lastQueuedSequenceNumber){if((null===(s=this.previouslyProcessedMessage)||void 0===s?void 0:s.sequenceNumber)===r.sequenceNumber){const e=this.comparableMessagePayload(this.previouslyProcessedMessage),t=this.comparableMessagePayload(r);if(e!==t){const n=new P.V2("Found two messages with the same sequenceNumber but different payloads. Likely to be a service issue",N.C.fileOverwrittenInStorage,{clientId:this.connectionManager.clientId,sequenceNumber:r.sequenceNumber,message1:e,message2:t,driverVersion:void 0});this.close(n)}}}else r.sequenceNumber!==this.lastQueuedSequenceNumber+1?(this.pending.push(r),this.fetchMissingDeltas(t,r.sequenceNumber)):(this.lastQueuedSequenceNumber=r.sequenceNumber,this.previouslyProcessedMessage=r,this._inbound.push(r));this.prevEnqueueMessagesReason=this.pending.length>0?"unknown":t}processInboundMessage(e){const t=Date.now();if(this.lastProcessedMessage=e,S(void 0!==e.clientId||!(0,q.ag)(e),237),"string"==typeof e.contents&&""!==e.contents&&e.type!==B.ClientLeave&&(e.contents=JSON.parse(e.contents)),this.connectionManager.beforeProcessingIncomingOp(e),this.minSequenceNumber>e.minimumSequenceNumber)throw new E.Jd("Found a lower minimumSequenceNumber (msn) than previously recorded",Object.assign(Object.assign({},(0,E.HN)(e)),{clientId:this.connectionManager.clientId}));if(this.minSequenceNumber=e.minimumSequenceNumber,e.sequenceNumber!==this.lastProcessedSequenceNumber+1)throw new E.Jd("Found a non-Sequential sequenceNumber",Object.assign(Object.assign({},(0,E.HN)(e)),{clientId:this.connectionManager.clientId}));if(this.lastProcessedSequenceNumber=e.sequenceNumber,S(this.lastProcessedSequenceNumber<=this.lastObservedSeqNumber,615),void 0===e.term&&(e.term=1),this.baseTerm=e.term,void 0===this.handler)throw new Error("Attempted to process an inbound message without a handler attached");this.handler.process(e);const r=Date.now();this.emit("op",e,r-t)}fetchMissingDeltas(e,t){this.fetchMissingDeltasCore(e,!1,t).catch((e=>{this.logger.sendErrorEvent({eventName:"fetchMissingDeltasException"},e)}))}async fetchMissingDeltasCore(e,t,r){var n;if(void 0===this.fetchReason)if(this.closed)this.logger.sendTelemetryEvent({eventName:"fetchMissingDeltasClosedConnection",reason:e});else if(void 0!==this.handler)try{let s=this.lastQueuedSequenceNumber+1;const i=null===(n=this.previouslyProcessedMessage)||void 0===n?void 0:n.sequenceNumber;void 0!==i&&(S(i===this.lastQueuedSequenceNumber,242),S(s>1,243),s--);const o=`${e}_fetch`;this.fetchReason=o,await this.getDeltas(s,r,o,(e=>{this.refreshDelayInfo(this.deltaStorageDelayId),this.enqueueMessages(e,o)}),t)}catch(e){this.logger.sendErrorEvent({eventName:"GetDeltas_Exception"},e),this.close((0,ee.SC)(e))}finally{this.refreshDelayInfo(this.deltaStorageDelayId),this.fetchReason=void 0,this.processPendingOps(e)}else S(0===this.lastQueuedSequenceNumber,619)}processPendingOps(e){if(this.closed)return;S(void 0!==this.handler,620);const t=this.pending.sort(((e,t)=>e.sequenceNumber-t.sequenceNumber));this.pending=[],this.enqueueMessages(t,`${e}_pending`,!0),void 0===this.fetchReason&&this.lastQueuedSequenceNumber<this.lastObservedSeqNumber&&this.fetchMissingDeltas("OpsBehind")}updateLatestKnownOpSeqNumber(e){this.lastObservedSeqNumber<e&&(this.lastObservedSeqNumber=e)}}class de extends oe{constructor(e){if(super(),this.isDisposed=!1,this.forwardingEvents=new Map,void 0!==e){const t=t=>this.unforwardEvent(e,t),r=t=>this.forwardEvent(e,t);this.on(de.removeListenerEvent,t),this.on(de.newListenerEvent,r)}}static isEmitterEvent(e){return e===de.newListenerEvent||e===de.removeListenerEvent}get disposed(){return this.isDisposed}dispose(){this.isDisposed=!0;for(const e of this.forwardingEvents.values())for(const t of e.values())try{t()}catch(e){}this.removeAllListeners(),this.forwardingEvents.clear()}forwardEvent(e,...t){for(const r of t)if(void 0!==e&&void 0!==r&&!de.isEmitterEvent(r)){let t=this.forwardingEvents.get(r);if(void 0===t&&(t=new Map,this.forwardingEvents.set(r,t)),!t.has(e)){const n=(...e)=>this.emit(r,...e);t.set(e,(()=>e.off(r,n))),e.on(r,n)}}}unforwardEvent(e,...t){for(const r of t)if(void 0!==r&&!de.isEmitterEvent(r)){const t=this.forwardingEvents.get(r);if((null==t?void 0:t.has(e))&&0===this.listenerCount(r)){const n=t.get(e);void 0!==n&&n(),t.delete(e),0===t.size&&this.forwardingEvents.delete(r)}}}}de.newListenerEvent="newListener",de.removeListenerEvent="removeListener";class pe extends de{constructor(e){super(e),this.queue=e}get paused(){return this.queue.paused}get length(){return this.queue.length}get idle(){return this.queue.idle}peek(){return this.queue.peek()}toArray(){return this.queue.toArray()}async systemPause(){return this.pause()}async pause(){return this.queue.pause()}async systemResume(){return this.resume()}async resume(){this.queue.resume()}async waitTillProcessingDone(){return this.queue.waitTillProcessingDone()}}class ge extends de{constructor(e){super(e),this.deltaManager=e,this.inbound=new pe(e.inbound),this.outbound=new pe(e.outbound),this.inboundSignal=new pe(e.inboundSignal)}get IDeltaSender(){return this}get minimumSequenceNumber(){return this.deltaManager.minimumSequenceNumber}get lastSequenceNumber(){return this.deltaManager.lastSequenceNumber}get lastMessage(){return this.deltaManager.lastMessage}get lastKnownSeqNumber(){return this.deltaManager.lastKnownSeqNumber}get initialSequenceNumber(){return this.deltaManager.initialSequenceNumber}get hasCheckpointSequenceNumber(){return this.deltaManager.hasCheckpointSequenceNumber}get clientDetails(){return this.deltaManager.clientDetails}get version(){return this.deltaManager.version}get maxMessageSize(){return this.deltaManager.maxMessageSize}get serviceConfiguration(){return this.deltaManager.serviceConfiguration}get active(){return this.deltaManager.active}get readOnlyInfo(){return this.deltaManager.readOnlyInfo}dispose(){this.inbound.dispose(),this.outbound.dispose(),this.inboundSignal.dispose(),super.dispose()}submitSignal(e){return this.deltaManager.submitSignal(e)}flush(){return this.deltaManager.flush()}}const me="1.3.7";class fe{constructor(e,t,r=(()=>Date.now())){this.defaultTimeout=e,this.defaultHandler=t,this.getCurrentTick=r}get hasTimer(){return!!this.runningState}start(e=this.defaultTimeout,t=this.defaultHandler){this.startCore(e,t,e)}clear(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}restart(e,t){var r,n;if(this.runningState){const s=null!=e?e:this.runningState.intendedDuration,i=null!==(n=null!=t?t:null===(r=this.runningState.restart)||void 0===r?void 0:r.handler)&&void 0!==n?n:this.runningState.handler,o=this.calculateRemainingTime(this.runningState);s<o?this.start(s,i):s===o?(this.runningState.handler=i,this.runningState.restart=void 0,this.runningState.intendedDuration=s):this.runningState.restart={startTick:this.getCurrentTick(),duration:s,handler:i}}else this.start(e,t)}startCore(e,t,r){this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:e,intendedDuration:r,handler:t,timeout:setTimeout((()=>this.handler()),e)}}handler(){S(!!this.runningState,10);const e=this.runningState.restart;if(void 0!==e){const t=this.calculateRemainingTime(e);this.startCore(t,(()=>e.handler()),e.duration)}else{const e=this.runningState.handler;this.clear(),e()}}calculateRemainingTime(e){const t=this.getCurrentTick()-e.startTick;return e.duration-t}}var ye=r(1434);class ve{constructor(e,t,r){var n;this.handler=e,this.logger=t,this._clientId=r,this._connectionState=ye.e.Disconnected,this.prevClientLeftTimer=new fe(null!==(n=this.handler.maxClientLeaveWaitTime)&&void 0!==n?n:3e5,(()=>{S(!this.connected,684),this.applyForConnectedState("timeout")})),this.joinOpTimer=new fe(45e3,(()=>{var e;if(this.connectionState!==ye.e.CatchingUp)return;const t=this.handler.quorumClients(),r={quorumInitialized:void 0!==t,hasPendingClientId:void 0!==this.pendingClientId,inQuorum:void 0!==(null==t?void 0:t.getMember(null!==(e=this.pendingClientId)&&void 0!==e?e:"")),waitingForLeaveOp:this.waitingForLeaveOp};this.handler.logConnectionIssue("NoJoinOp",r)}))}get connectionState(){return this._connectionState}get connected(){return this.connectionState===ye.e.Connected}get clientId(){return this._clientId}get pendingClientId(){return this._pendingClientId}startJoinOpTimer(){S(!this.joinOpTimer.hasTimer,564),this.joinOpTimer.start()}stopJoinOpTimer(){S(this.joinOpTimer.hasTimer,565),this.joinOpTimer.clear()}get waitingForLeaveOp(){return this.prevClientLeftTimer.hasTimer}dispose(){S(!this.joinOpTimer.hasTimer,677),this.prevClientLeftTimer.clear()}containerSaved(){this.waitingForLeaveOp&&(this.prevClientLeftTimer.clear(),this.applyForConnectedState("containerSaved"))}receivedAddMemberEvent(e){e===this.pendingClientId&&(this.joinOpTimer.hasTimer?this.stopJoinOpTimer():this.handler.logConnectionIssue("ReceivedJoinOp"),this.waitingForLeaveOp&&(this.waitEvent=u.Xr.start(this.logger,{eventName:"WaitBeforeClientLeave",details:JSON.stringify({waitOnClientId:this._clientId,hadOutstandingOps:this.handler.shouldClientJoinWrite()})})),this.applyForConnectedState("addMemberEvent"))}applyForConnectedState(e){var t,r;const n=this.handler.quorumClients();S(void 0!==n,566),S(!1===this.waitingForLeaveOp||void 0!==this.clientId&&void 0!==n.getMember(this.clientId),738),this.pendingClientId===this.clientId||void 0===this.pendingClientId||void 0===n.getMember(this.pendingClientId)||this.waitingForLeaveOp?this.logger.sendTelemetryEvent({eventName:"connectedStateRejected",category:"timeout"===e?"error":"generic",details:JSON.stringify({source:e,pendingClientId:this.pendingClientId,clientId:this.clientId,waitingForLeaveOp:this.waitingForLeaveOp,inQuorum:void 0!==(null==n?void 0:n.getMember(null!==(r=this.pendingClientId)&&void 0!==r?r:""))})}):(null===(t=this.waitEvent)||void 0===t||t.end({source:e}),this.setConnectionState(ye.e.Connected))}receivedRemoveMemberEvent(e){this.clientId===e&&(this.prevClientLeftTimer.clear(),this.applyForConnectedState("removeMemberEvent"))}receivedDisconnectEvent(e){this.joinOpTimer.hasTimer&&this.stopJoinOpTimer(),this.setConnectionState(ye.e.Disconnected,e)}receivedConnectEvent(e,t){const r=this._connectionState;this._connectionState=ye.e.CatchingUp;const n="write"===e;S(n||!this.handler.shouldClientJoinWrite(),778),S(n||!this.waitingForLeaveOp,678);const s=this.handler.quorumClients();this._pendingClientId=t.clientId,this.handler.logConnectionStateChangeTelemetry(ye.e.CatchingUp,r),n&&void 0===(null==s?void 0:s.getMember(this._pendingClientId))?this.startJoinOpTimer():this.waitingForLeaveOp||this.setConnectionState(ye.e.Connected)}setConnectionState(e,t){if(this.connectionState===e)return void this.logger.sendErrorEvent({eventName:"setConnectionStateSame",value:e});const r=this._connectionState;this._connectionState=e;const n=this.handler.quorumClients();let s;void 0!==this._clientId&&(s=null==n?void 0:n.getMember(this._clientId)),e===ye.e.Connected?(S(r===ye.e.CatchingUp,472),void 0!==s&&(s.shouldHaveLeft=!0),this._clientId=this.pendingClientId):e===ye.e.Disconnected&&(this._pendingClientId=void 0,void 0!==s&&this.handler.shouldClientJoinWrite()&&!1===this.prevClientLeftTimer.hasTimer?this.prevClientLeftTimer.restart():this.logger.sendTelemetryEvent({eventName:"noWaitOnDisconnected",details:JSON.stringify({inQuorum:void 0!==s,waitingForLeaveOp:this.waitingForLeaveOp,hadOutstandingOps:this.handler.shouldClientJoinWrite()})})),this.handler.logConnectionStateChangeTelemetry(this._connectionState,r,t),this.handler.connectionStateChanged()}initProtocol(e){e.quorum.on("addMember",((e,t)=>{this.receivedAddMemberEvent(e)})),e.quorum.on("removeMember",(e=>{this.receivedRemoveMemberEvent(e)})),void 0!==this.clientId&&void 0!==e.quorum.getMember(this.clientId)&&this.prevClientLeftTimer.restart()}}class be{constructor(e,t){this.internalStorageService=e,this.logger=t,this._disposed=!1}get policies(){return this.internalStorageService.policies}get disposed(){return this._disposed}dispose(){this._disposed=!0}get repositoryUrl(){return this.internalStorageService.repositoryUrl}async getSnapshotTree(e,t){return this.runWithRetry((async()=>this.internalStorageService.getSnapshotTree(e,t)),"storage_getSnapshotTree")}async readBlob(e){return this.runWithRetry((async()=>this.internalStorageService.readBlob(e)),"storage_readBlob")}async getVersions(e,t,r){return this.runWithRetry((async()=>this.internalStorageService.getVersions(e,t,r)),"storage_getVersions")}async uploadSummaryWithContext(e,t){return S(0===t.referenceSequenceNumber==(void 0===t.ackHandle),593),0!==t.referenceSequenceNumber?this.internalStorageService.uploadSummaryWithContext(e,t):this.runWithRetry((async()=>this.internalStorageService.uploadSummaryWithContext(e,t)),"storage_uploadSummaryWithContext")}async downloadSummary(e){return this.runWithRetry((async()=>this.internalStorageService.downloadSummary(e)),"storage_downloadSummary")}async createBlob(e){return this.runWithRetry((async()=>this.internalStorageService.createBlob(e)),"storage_createBlob")}checkStorageDisposed(){if(this._disposed)throw new E.pY("Storage Service is disposed. Cannot retry",{canRetry:!1})}async runWithRetry(e,t){return I(e,t,this.logger,{onRetry:()=>this.checkStorageDisposed()})}}class Se{constructor(e,t){this.internalStorageService=e,this.generateProtocolTree=t,this.getSnapshotTree=this.internalStorageService.getSnapshotTree.bind(this.internalStorageService),this.getVersions=this.internalStorageService.getVersions.bind(this.internalStorageService),this.createBlob=this.internalStorageService.createBlob.bind(this.internalStorageService),this.readBlob=this.internalStorageService.readBlob.bind(this.internalStorageService),this.downloadSummary=this.internalStorageService.downloadSummary.bind(this.internalStorageService),this.dispose=this.internalStorageService.dispose.bind(this.internalStorageService)}get policies(){return this.internalStorageService.policies}get repositoryUrl(){return this.internalStorageService.repositoryUrl}get disposed(){return this.internalStorageService.disposed}async uploadSummaryWithContext(e,t){return this.internalStorageService.uploadSummaryWithContext(A(e,this.generateProtocolTree()),t)}}class we{constructor(e){this.storageGetter=e,this.blobContents={}}loadSnapshotForRehydratingContainer(e){this.getBlobContents(e)}getBlobContents(e){for(const[t,r]of Object.entries(e.blobsContents))this.blobContents[t]=r;for(const[t,r]of Object.entries(e.trees))this.getBlobContents(r)}get policies(){try{return this.storageGetter().policies}catch(e){}}get repositoryUrl(){return this.storageGetter().repositoryUrl}async getSnapshotTree(e,t){return this.storageGetter().getSnapshotTree(e,t)}async readBlob(e){const t=this.blobContents[e];return void 0!==t?t:this.storageGetter().readBlob(e)}async getVersions(e,t,r){return this.storageGetter().getVersions(e,t,r)}async uploadSummaryWithContext(e,t){return this.storageGetter().uploadSummaryWithContext(e,t)}async downloadSummary(e){return this.storageGetter().downloadSummary(e)}async createBlob(e){return this.storageGetter().createBlob(e)}}class xe{constructor(e,t){this.blobStorage=e,this.logger=t,this.getSnapshotTree=this.notCalled,this.getVersions=this.notCalled,this.write=this.notCalled,this.uploadSummaryWithContext=this.notCalled,this.downloadSummary=this.notCalled}async createBlob(e){return this.blobStorage.createBlob(e)}async readBlob(e){return this.blobStorage.readBlob(e)}get policies(){return this.notCalled()}get repositoryUrl(){return this.notCalled()}notCalled(){try{throw new Error("BlobOnlyStorage not implemented method used")}catch(e){throw this.logger.sendErrorEvent({eventName:"BlobOnlyStorageWrongCall"},e),e}}}var Ce=r(9742);const Ee=(e,t)=>Te.from(e,t).buffer;function Ae(e){const t=e;return e instanceof ArrayBuffer||"object"==typeof t&&null!==t&&"number"==typeof t.byteLength&&"function"==typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}class Te extends Uint8Array{toString(e){return function(e,t){switch(t){case"base64":return Ce.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}(this,e)}static from(e,t,r){if("string"==typeof e)return Te.fromString(e,t);if(null!==e&&"object"==typeof e&&Ae(e.buffer))return S(0===e.byteOffset,0),S(e.byteLength===e.buffer.byteLength,1),Te.fromArrayBuffer(e.buffer,t,r);if(Ae(e))return Te.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const n=null!=t?t:0,s=null!=r?r:e.byteLength-n;if(n<0||n>e.byteLength||s<0||s+n>e.byteLength)throw new RangeError;return new Te(e,n,s)}static fromString(e,t){switch(t){case"base64":{const t=this.sanitizeBase64(e),r=Ce.toByteArray(t);return new Te(r.buffer)}case"utf8":case"utf-8":case void 0:{const t=(new TextEncoder).encode(e);return new Te(t.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!=0&&(t+=["","===","==","="][t.length%4]),t}}function Oe(e){var t;const r=(0,m.Qc)(e,!0);if("string"!=typeof r.pathname)throw new ee.j4("Failed to parse pathname");const n=null!==(t=r.search)&&void 0!==t?t:"",s=/^\/([^/]*\/[^/]*)(\/?.*)$/.exec(r.pathname);return 3===(null==s?void 0:s.length)?{id:s[1],path:s[2],query:n,version:r.query.version}:void 0}function Ne(e){const t={blobs:{},blobsContents:{},trees:{},id:(0,a.Z)(),unreferenced:e.unreferenced},r=Object.keys(e.tree);for(const s of r){const r=e.tree[s];switch(r.type){case L.Tree:t.trees[s]=Ne(r);break;case L.Attachment:t.blobs[s]=r.id;break;case L.Blob:{const e=(0,a.Z)();t.blobs[s]=e;const i="string"==typeof r.content?Ee(r.content,"utf8"):0===(n=r.content).byteOffset&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);t.blobsContents[e]=i;break}case L.Handle:throw new ee.j4("No handles should be there in summary in detached container!!");default:w(0,`Unknown tree type ${r.type}`)}}var n;return t}function Pe(e,t){const r={type:L.Tree,tree:Object.assign({},t.tree)};return r.tree[".protocol"]=e,Ne(r)}const Re=e=>{const t=e.tree[".protocol"],r=e.tree[".app"];return S(void 0!==t&&void 0!==r,480),Pe(t,r)};function Ie(e){return".protocol"in e.trees?e.trees[".protocol"]:e}function Fe(e,t){return(...r)=>{if(e.disposed)throw new Error("Already disposed");return t(...r)}}class ke extends de{constructor(e){super(e),super.setMaxListeners(50),this.propose=Fe(this,e.propose.bind(e)),this.has=Fe(this,e.has.bind(e)),this.get=Fe(this,e.get.bind(e)),this.getMembers=Fe(this,e.getMembers.bind(e)),this.getMember=Fe(this,e.getMember.bind(e))}}function De(e){return[["code",{key:"code",value:e,approvalSequenceNumber:0,commitSequenceNumber:0,sequenceNumber:0}]]}class Me{constructor(e,t=2e3,r=50){this.submit=e,this.NoopCountFrequency=r,this.opsCountSinceNoop=0,t!==1/0&&(this.timer=new fe(t,(()=>{0!==this.opsCountSinceNoop&&this.submitNoop(!1)})))}scheduleSequenceNumberUpdate(e,t){t?this.submitNoop(!0):(0,q.LW)(e)&&(this.opsCountSinceNoop++,this.opsCountSinceNoop>=this.NoopCountFrequency?this.submitNoop(!1):void 0!==this.timer&&(1===this.opsCountSinceNoop&&this.timer.restart(),S(this.timer.hasTimer,578)))}submitNoop(e){this.submit(B.NoOp,e?"":null),S(0===this.opsCountSinceNoop,579)}stopSequenceNumberUpdate(){this.opsCountSinceNoop=0}}function qe(e,t,r){var n,s;const i=Object.assign({},t),o=r.online;if(i.online="string"==typeof o?o:P.Yz[(0,P.Gg)()],"object"==typeof navigator&&null!==navigator){const e=navigator,t=null!==(s=null!==(n=e.connection)&&void 0!==n?n:e.mozConnection)&&void 0!==s?s:e.webkitConnection;null!==t&&"object"==typeof t&&(i.connectionType=t.type)}i.category=(0,P.ms)(r)?"generic":"error",e.sendTelemetryEvent(i,r)}function Le(e){return new Promise((t=>{let r=t,n=e;(0,P.Gg)()===P.Yz.Offline&&void 0!==(null===window||void 0===window?void 0:window.addEventListener)&&(r=()=>{t(),window.removeEventListener("online",r)},window.addEventListener("online",r,!1),n=Math.max(e,3e4)),setTimeout(r,n)}))}var Be;!function(e){e.DocRead="doc:read",e.DocWrite="doc:write",e.SummaryWrite="summary:write"}(Be||(Be={}));const je={fatalConnectError:!0};class _e extends oe{constructor(){super(...arguments),this.clientId="storage-only client",this.claims={scopes:[Be.DocRead]},this.mode="read",this.existing=!0,this.maxMessageSize=0,this.version="",this.initialMessages=[],this.initialSignals=[],this.initialClients=[],this.serviceConfiguration={maxMessageSize:0,blockSize:0,summary:void 0},this.checkpointSequenceNumber=void 0,this._disposed=!1}submit(e){this.emit("nack",this.clientId,e.map((e=>({operation:e,content:{message:"Cannot submit with storage-only connection",code:403}}))))}submitSignal(e){this.emit("nack",this.clientId,{operation:e,content:{message:"Cannot submit signal with storage-only connection",code:403}})}get disposed(){return this._disposed}dispose(){this._disposed=!0}}class He{constructor(e,t,r,n,s){this.serviceProvider=e,this.client=t,this.logger=n,this.props=s,this._forceReadonly=!1,this.pendingReconnect=!1,this.clientSequenceNumber=0,this.clientSequenceNumberObserved=0,this.trailingNoopCount=0,this.connectFirstConnection=!0,this._connectionVerboseProps={},this._connectionProps={},this.closed=!1,this.opHandler=(e,t)=>{const r=Array.isArray(t)?t:[t];this.props.incomingOpHandler(r,"opHandler")},this.nackHandler=(e,t)=>{const r=t[0];if(!0===this._readonlyPermissions)return void this.props.closeHandler((0,P.j)("writeOnReadOnlyDocument",{driverVersion:void 0}));const n=function(e){const t=`Nack (${e.type}): ${e.message}`,r=403!==e.code,n=void 0!==e.retryAfter?1e3*e.retryAfter:void 0;return(0,P.jx)(t,{canRetry:r,retryAfterMs:n},{statusCode:e.code,driverVersion:void 0})}(r.content);n.canRetry?this.reconnectOnError("write",n):this.props.closeHandler(n)},this.disconnectHandlerInternal=e=>{this.reconnectOnError(this.defaultReconnectionMode,e)},this.errorHandler=e=>{this.reconnectOnError(this.defaultReconnectionMode,e)},this.clientDetails=this.client.details,this.defaultReconnectionMode=this.client.mode,this._reconnectMode=r?Q.Enabled:Q.Never,this._outbound=new le((e=>{if(void 0===this.connection)throw new Error("Attempted to submit an outbound message without connection");this.connection.submit(e)})),this._outbound.on("error",(e=>{this.props.closeHandler((0,ee.SC)(e))}))}get connectionVerboseProps(){return this._connectionVerboseProps}get connectionMode(){var e,t;return null!==(t=null===(e=this.connection)||void 0===e?void 0:e.mode)&&void 0!==t?t:"read"}get connected(){return void 0!==this.connection}get clientId(){var e;return null===(e=this.connection)||void 0===e?void 0:e.clientId}get reconnectMode(){return this._reconnectMode}get maxMessageSize(){var e,t,r;return null!==(r=null===(t=null===(e=this.connection)||void 0===e?void 0:e.serviceConfiguration)||void 0===t?void 0:t.maxMessageSize)&&void 0!==r?r:16384}get version(){if(void 0===this.connection)throw new Error("Cannot check version without a connection");return this.connection.version}get serviceConfiguration(){var e;return null===(e=this.connection)||void 0===e?void 0:e.serviceConfiguration}get scopes(){var e;return null===(e=this.connection)||void 0===e?void 0:e.claims.scopes}get outbound(){return this._outbound}get connectionProps(){return void 0!==this.connection?this._connectionProps:Object.assign(Object.assign({},this._connectionProps),{sentOps:this.clientSequenceNumber})}shouldJoinWrite(){return this.clientSequenceNumberObserved<this.clientSequenceNumber-this.trailingNoopCount}get readonly(){return!!this._forceReadonly||this._readonlyPermissions}get readOnlyInfo(){const e=void 0!==this.connection&&this.connection instanceof _e;return e||this._forceReadonly||!0===this._readonlyPermissions?{readonly:!0,forced:this._forceReadonly,permissions:this._readonlyPermissions,storageOnly:e}:{readonly:this._readonlyPermissions}}static detailsFromConnection(e){return{claims:e.claims,clientId:e.clientId,existing:e.existing,checkpointSequenceNumber:e.checkpointSequenceNumber,get initialClients(){return e.initialClients},mode:e.mode,serviceConfiguration:e.serviceConfiguration,version:e.version}}dispose(e){if(this.closed)return;this.closed=!0,this.pendingConnection=void 0,this._reconnectMode=Q.Never,this._outbound.clear();const t=void 0!==e?`Closing DeltaManager (${e.message})`:"Closing DeltaManager";this.disconnectFromDeltaStream(t),this.set_readonlyPermissions(!0)}setAutoReconnect(e){S(e!==Q.Never&&this._reconnectMode!==Q.Never,632),this._reconnectMode=e,e!==Q.Enabled&&this.disconnectFromDeltaStream("setAutoReconnect")}forceReadonly(e){e!==this._forceReadonly&&this.logger.sendTelemetryEvent({eventName:"ForceReadOnly",value:e});const t=this.readonly;if(this._forceReadonly=e,t!==this.readonly){if(this._reconnectMode===Q.Never)throw new E.Oi("API is not supported for non-connecting or closed container");let e=!1;!0===this.readonly&&(this.shouldJoinWrite()&&this.logger.sendErrorEvent({eventName:"ForceReadonlyPendingChanged"}),e=this.disconnectFromDeltaStream("Force readonly")),this.props.readonlyChangeHandler(this.readonly),e&&this.triggerConnect("read")}}set_readonlyPermissions(e){const t=this.readonly;this._readonlyPermissions=e,t!==this.readonly&&this.props.readonlyChangeHandler(this.readonly)}connect(e){this.connectCore(e).catch((e=>{const t=(0,ee.SC)(e,{props:je});this.props.closeHandler(t)}))}async connectCore(e){var t,r;if(S(!this.closed,618),void 0!==this.connection)return;let n;void 0!==this.pendingConnection&&(n=this.pendingConnection.connectionMode,this.cancelConnection(),S(void 0===this.pendingConnection,836));let s=null!==(t=null!=e?e:n)&&void 0!==t?t:this.defaultReconnectionMode;this.shouldJoinWrite()&&(s="write");const i=this.serviceProvider();let o;if(S(void 0!==i,679),!0===(null===(r=i.policies)||void 0===r?void 0:r.storageOnly))return o=new _e,this.setupNewSuccessfulConnection(o,"read"),void S(void 0===this.pendingConnection,691);let a=1e3,c=0;const h=b.now();let l;const d=new(ie()),p=d.signal;for(this.pendingConnection={abort:()=>{d.abort()},connectionMode:s};void 0===o;){if(this.closed)throw new Error("Attempting to connect a closed DeltaManager");if(!0===p.aborted)return void this.logger.sendTelemetryEvent({eventName:"ConnectionAttemptCancelled",attempts:c,duration:u.hy.formatTick(b.now()-h),connectionEstablished:!1});c++;try{this.client.mode=s,o=await i.connectToDeltaStream(Object.assign(Object.assign({},this.client),{mode:s})),o.disposed&&(this.logger.sendTelemetryEvent({eventName:"ReceivedClosedConnection"}),o=void 0)}catch(e){if("object"==typeof e&&null!==e&&(null==e?void 0:e.errorType)===P.y7.errorType){o=new _e,s="read";break}if(!(0,P.ms)(e)){const t=(0,ee.SC)(e,{props:je});throw this.props.closeHandler(t),t}qe(this.logger,{attempts:c,delay:a,eventName:"DeltaConnectionFailureToConnect",duration:u.hy.formatTick(b.now()-h)},e),l=e;const t=(0,P.ZZ)(e);a=null!=t?t:Math.min(2*a,8e3),void 0!==t&&this.props.reconnectionDelayHandler(t,e),await Le(a)}}if(c>1&&qe(this.logger,{eventName:"MultipleDeltaConnectionFailures",attempts:c,duration:u.hy.formatTick(b.now()-h)},l),!0===p.aborted)return o.dispose(),void this.logger.sendTelemetryEvent({eventName:"ConnectionAttemptCancelled",attempts:c,duration:u.hy.formatTick(b.now()-h),connectionEstablished:!0});this.setupNewSuccessfulConnection(o,s)}triggerConnect(e){S(void 0===this.connection,569),this.reconnectMode===Q.Enabled&&this.connect(e)}disconnectFromDeltaStream(e){if(this.pendingReconnect=!1,void 0===this.connection)return void 0!==this.pendingConnection&&(this.cancelConnection(),!0);S(void 0===this.pendingConnection,635);const t=this.connection;return this.connection=void 0,t.off("op",this.opHandler),t.off("signal",this.props.signalHandler),t.off("nack",this.nackHandler),t.off("disconnect",this.disconnectHandlerInternal),t.off("error",this.errorHandler),t.off("pong",this.props.pongHandler),this._outbound.pause(),this._outbound.clear(),this.props.disconnectHandler(e),t.dispose(),this._connectionVerboseProps={},!0}cancelConnection(){S(void 0!==this.pendingConnection,837),this.pendingConnection.abort(),this.pendingConnection=void 0,this.logger.sendTelemetryEvent({eventName:"ConnectionCancelReceived"})}setupNewSuccessfulConnection(e,t){S(void 0===this.connection,230),S(!e.disposed,650),this.pendingConnection=void 0,this.connection=e;const r=!e.claims.scopes.includes(Be.DocWrite);if(S("read"===t||r===("read"===this.connectionMode),231),S(!r||"read"===this.connectionMode,232),this.set_readonlyPermissions(r),this.closed)return void this.disconnectFromDeltaStream("ConnectionManager already closed");this._outbound.resume(),e.on("op",this.opHandler),e.on("signal",this.props.signalHandler),e.on("nack",this.nackHandler),e.on("disconnect",this.disconnectHandlerInternal),e.on("error",this.errorHandler),e.on("pong",this.props.pongHandler);const n=e.initialMessages.sort(((e,t)=>e.sequenceNumber-t.sequenceNumber));let s=e.checkpointSequenceNumber;this._connectionVerboseProps={clientId:e.clientId,mode:e.mode},this._connectionProps={},void 0!==e.relayServiceAgent&&(this._connectionVerboseProps.relayServiceAgent=e.relayServiceAgent,this._connectionProps.relayServiceAgent=e.relayServiceAgent),this._connectionProps.socketDocumentId=e.claims.documentId,this._connectionProps.connectionMode=e.mode;let i=-1;if(0!==n.length&&(this._connectionVerboseProps.connectionInitialOpsFrom=n[0].sequenceNumber,i=n[n.length-1].sequenceNumber,this._connectionVerboseProps.connectionInitialOpsTo=i+1,(void 0===s||s<i)&&(s=i)),this.props.incomingOpHandler(n,this.connectFirstConnection?"InitialOps":"ReconnectOps"),void 0!==e.initialSignals)for(const t of e.initialSignals)this.props.signalHandler(t);const o=He.detailsFromConnection(e);o.checkpointSequenceNumber=s,this.props.connectHandler(o),this.connectFirstConnection=!1}reconnectOnError(e,t){this.reconnect(e,t.message,t).catch(this.props.closeHandler)}async reconnect(e,t,r){if(S(void 0!==this.connection,235),this.disconnectFromDeltaStream(t),void 0===r||r.canRetry||this.logger.sendTelemetryEvent({eventName:"reconnectingDespiteFatalError",reconnectMode:this.reconnectMode},r),this.reconnectMode===Q.Never&&this.props.closeHandler(),this.closed||this.reconnectMode!==Q.Enabled)return;const n=(0,P.ZZ)(r);void 0!==r&&void 0!==n&&(this.props.reconnectionDelayHandler(n,r),await Le(n)),this.triggerConnect(e)}prepareMessageToSend(e){var t,r;if(!0!==this.readonly)return S(!!this.connection,228),this.lastSubmittedClientId!==(null===(t=this.connection)||void 0===t?void 0:t.clientId)&&(this.lastSubmittedClientId=null===(r=this.connection)||void 0===r?void 0:r.clientId,this.clientSequenceNumber=0,this.clientSequenceNumberObserved=0),e.type===B.NoOp?this.trailingNoopCount++:this.trailingNoopCount=0,Object.assign(Object.assign({},e),{clientSequenceNumber:++this.clientSequenceNumber});{S(!0===this.readOnlyInfo.readonly,496);const e=new E.pY("deltaManagerReadonlySubmit",void 0,{readonly:this.readOnlyInfo.readonly,forcedReadonly:this.readOnlyInfo.forced,readonlyPermissions:this.readOnlyInfo.permissions,storageOnly:this.readOnlyInfo.storageOnly});this.props.closeHandler(e)}}submitSignal(e){void 0!==this.connection?this.connection.submitSignal(e):this.logger.sendErrorEvent({eventName:"submitSignalDisconnected"})}sendMessages(e){S(this.connected,692),"read"!==this.connectionMode?(S(!this.pendingReconnect,693),this._outbound.push(e)):this.pendingReconnect||(this.pendingReconnect=!0,Promise.resolve().then((async()=>{this.pendingReconnect&&await this.reconnect("write","Switch to write")})).catch((()=>{})))}beforeProcessingIncomingOp(e){if(S(this.clientId!==e.clientId||this.lastSubmittedClientId===e.clientId,238),void 0!==this.lastSubmittedClientId&&this.lastSubmittedClientId===e.clientId){const t=e.clientSequenceNumber;S(this.clientSequenceNumberObserved<t,239),S(t<=this.clientSequenceNumber,240),this.clientSequenceNumberObserved=t}if(e.type===B.ClientLeave){const t=e;JSON.parse(t.data)===this.clientId&&(this.logger.sendPerformanceEvent({eventName:"ReadConnectionTransition"}),this.reconnect("read","Switch to read").catch((e=>{this.logger.sendErrorEvent({eventName:"SwitchToReadConnection"},e)})))}}}const Ue="dirty",ze="saved";async function Ve(e,t,r){const n=u.Xr.start(e,{eventName:t}),s=await r();n.duration>1e3&&n.end(s)}const Ge="summarizer";class Ke extends Z.M{constructor(e,t){var r,n;super(((e,t)=>{this.mc.logger.sendErrorEvent({eventName:"ContainerEventHandlerException",name:"string"==typeof e?e:void 0},t)})),this.loader=e,this._canReconnect=!0,this._lifecycleState="loading",this._attachState=o.mB.Detached,this.inboundQueuePausedFromInit=!0,this.firstConnection=!0,this.connectionTransitionTimes=[],this.messageCountAfterDisconnection=0,this.attachStarted=!1,this._dirtyContainer=!1,this.setAutoReconnectTime=b.now(),this._audience=new te,this.clientDetailsOverride=t.clientDetailsOverride,this._resolvedUrl=t.resolvedUrl,void 0!==t.canReconnect&&(this._canReconnect=t.canReconnect);const s=this.client.details.type,i=`${this.client.details.capabilities.interactive?"interactive":"noninteractive"}${void 0!==s&&""!==s?`/${s}`:""}`;this.subLogger=u.G2.create(e.services.subLogger,void 0,{all:{clientType:i,containerId:(0,a.Z)(),docId:()=>{var e,t;return null!==(t=null===(e=this._resolvedUrl)||void 0===e?void 0:e.id)&&void 0!==t?t:void 0},containerAttachState:()=>this._attachState,containerLifecycleState:()=>this._lifecycleState,containerConnectionState:()=>ye.e[this.connectionState],serializedContainer:void 0!==t.serializedContainerState},error:{dmInitialSeqNumber:()=>{var e;return null===(e=this._deltaManager)||void 0===e?void 0:e.initialSequenceNumber},dmLastProcessedSeqNumber:()=>{var e;return null===(e=this._deltaManager)||void 0===e?void 0:e.lastSequenceNumber},dmLastKnownSeqNumber:()=>{var e;return null===(e=this._deltaManager)||void 0===e?void 0:e.lastKnownSeqNumber},containerLoadedFromVersionId:()=>{var e;return null===(e=this.loadedFromVersion)||void 0===e?void 0:e.id},containerLoadedFromVersionDate:()=>{var e;return null===(e=this.loadedFromVersion)||void 0===e?void 0:e.date},dmLastMsqSeqNumber:()=>{var e,t;return null===(t=null===(e=this.deltaManager)||void 0===e?void 0:e.lastMessage)||void 0===t?void 0:t.sequenceNumber},dmLastMsqSeqTimestamp:()=>{var e,t;return null===(t=null===(e=this.deltaManager)||void 0===e?void 0:e.lastMessage)||void 0===t?void 0:t.timestamp},dmLastMsqSeqClientId:()=>{var e,t;return null===(t=null===(e=this.deltaManager)||void 0===e?void 0:e.lastMessage)||void 0===t?void 0:t.clientId},connectionStateDuration:()=>b.now()-this.connectionTransitionTimes[this.connectionState]}}),this.mc=(0,h.rZ)(u.G2.create(this.subLogger,"Container"));const c=null!==(r=this.mc.config.getBoolean("Fluid.Container.summarizeProtocolTree"))&&void 0!==r?r:this.loader.services.options.summarizeProtocolTree;this.options=Object.assign(Object.assign({},this.loader.services.options),{summarizeProtocolTree:c}),this.connectionStateHandler=new ve({quorumClients:()=>{var e;return null===(e=this._protocolHandler)||void 0===e?void 0:e.quorum},logConnectionStateChangeTelemetry:(e,t,r)=>this.logConnectionStateChangeTelemetry(e,t,r),shouldClientJoinWrite:()=>this._deltaManager.connectionManager.shouldJoinWrite(),maxClientLeaveWaitTime:this.loader.services.options.maxClientLeaveWaitTime,logConnectionIssue:(e,t)=>{this._deltaManager.logConnectionIssue(Object.assign({eventName:e,duration:b.now()-this.connectionTransitionTimes[ye.e.CatchingUp]},void 0===t?{}:{details:JSON.stringify(t)}))},connectionStateChanged:()=>{"loaded"===this._lifecycleState&&this.propagateConnectionState()}},this.mc.logger,null===(n=t.serializedContainerState)||void 0===n?void 0:n.clientId),this.on(ze,(()=>{this.connectionStateHandler.containerSaved()})),this._deltaManager=this.createDeltaManager(),this._storage=new we((()=>{if(this.attachState!==o.mB.Attached){if(void 0!==this.loader.services.detachedBlobStorage)return new xe(this.loader.services.detachedBlobStorage,this.mc.logger);throw this.mc.logger.sendErrorEvent({eventName:"NoRealStorageInDetachedContainer"}),new Error("Real storage calls not allowed in Unattached container")}return this.storageService})),"object"==typeof document&&null!==document&&"function"==typeof document.addEventListener&&null!==document.addEventListener&&(this.lastVisible=document.hidden?b.now():void 0,this.visibilityEventHandler=()=>{document.hidden?this.lastVisible=b.now():setTimeout((()=>{this.lastVisible=void 0}),0)},document.addEventListener("visibilitychange",this.visibilityEventHandler)),this.on("newListener",((e,t)=>{Promise.resolve().then((()=>{switch(e){case Ue:this._dirtyContainer&&t();break;case ze:this._dirtyContainer||t();break;case Y.tZ:this.connected&&t(this.clientId);break;case Y.h$:this.connected||t()}})).catch((e=>{this.mc.logger.sendErrorEvent({eventName:"RaiseConnectedEventError"},e)}))}))}static async load(e,t,r){const n=new Ke(e,{clientDetailsOverride:t.clientDetailsOverride,resolvedUrl:t.resolvedUrl,canReconnect:t.canReconnect,serializedContainerState:r});return u.Xr.timedExecAsync(n.mc.logger,{eventName:"Load"},(async e=>new Promise(((s,i)=>{var o,a;const c=t.version,h={opsBeforeReturn:"cached"},l=r?Object.assign(Object.assign({},null!==(o=t.loadMode)&&void 0!==o?o:h),{opsBeforeReturn:void 0}):null!==(a=t.loadMode)&&void 0!==a?a:h,u=e=>{i(null!=e?e:new E.pY("Container closed without error during load"))};n.on("closed",u),n.load(c,l,r).finally((()=>{n.removeListener("closed",u)})).then((r=>{e.end(Object.assign(Object.assign({},r),t.loadMode)),s(n)}),(e=>{const t=(0,ee.SC)(e);n.close(t),u(t)}))}))),{start:!0,end:!0,cancel:"generic"})}static async createDetached(e,t){const r=new Ke(e,{});return u.Xr.timedExecAsync(r.mc.logger,{eventName:"CreateDetached"},(async e=>(await r.createDetached(t),r)),{start:!0,end:!0,cancel:"generic"})}static async rehydrateDetachedFromSnapshot(e,t){const r=new Ke(e,{});return u.Xr.timedExecAsync(r.mc.logger,{eventName:"RehydrateDetachedFromSnapshot"},(async e=>{const n=JSON.parse(t);return await r.rehydrateDetachedFromSnapshot(n),r}),{start:!0,end:!0,cancel:"generic"})}setLoaded(){"loading"===this._lifecycleState&&(this.propagateConnectionState(),this._lifecycleState="loaded")}get closed(){return"closing"===this._lifecycleState||"closed"===this._lifecycleState}get storage(){return this._storage}get storageService(){if(void 0===this._storageService)throw new Error("Attempted to access storageService before it was defined");return this._storageService}get context(){if(void 0===this._context)throw new E.pY("Attempted to access context before it was defined");return this._context}get protocolHandler(){if(void 0===this._protocolHandler)throw new Error("Attempted to access protocolHandler before it was defined");return this._protocolHandler}get connectionMode(){return this._deltaManager.connectionManager.connectionMode}get IFluidRouter(){return this}get resolvedUrl(){return this._resolvedUrl}get loadedFromVersion(){return this._loadedFromVersion}get readOnlyInfo(){return this._deltaManager.readOnlyInfo}get closeSignal(){return this._deltaManager.closeAbortController.signal}forceReadonly(e){this._deltaManager.connectionManager.forceReadonly(e)}get deltaManager(){return this._deltaManager}get connectionState(){return this.connectionStateHandler.connectionState}get connected(){return this.connectionStateHandler.connected}get serviceConfiguration(){return this._deltaManager.serviceConfiguration}get clientId(){return this.connectionStateHandler.clientId}get scopes(){return this._deltaManager.connectionManager.scopes}get clientDetails(){return this._deltaManager.clientDetails}getSpecifiedCodeDetails(){return this.getCodeDetailsFromQuorum()}getLoadedCodeDetails(){var e;return null===(e=this._context)||void 0===e?void 0:e.codeDetails}get audience(){return this._audience}get isDirty(){return this._dirtyContainer}get serviceFactory(){return this.loader.services.documentServiceFactory}get urlResolver(){return this.loader.services.urlResolver}get scope(){return this.loader.services.scope}get codeLoader(){return this.loader.services.codeLoader}getQuorum(){return this.protocolHandler.quorum}close(e){this._deltaManager.close(e),S(this.connectionState===ye.e.Disconnected,207),S("closed"===this._lifecycleState,788)}closeCore(e){var t,r,n,s;S(!this.closed,789);try{try{this.mc.logger.sendTelemetryEvent({eventName:"ContainerClose",category:void 0===e?"generic":"error"},e),this._lifecycleState="closing",null===(t=this._protocolHandler)||void 0===t||t.close(),this.connectionStateHandler.dispose(),null===(r=this._context)||void 0===r||r.dispose(void 0!==e?new Error(e.message):void 0),null===(n=this._storageService)||void 0===n||n.dispose(),null===(s=this.service)||void 0===s||s.dispose(e)}catch(e){this.mc.logger.sendErrorEvent({eventName:"ContainerCloseException"},e)}this.emit("closed",e),this.removeAllListeners(),void 0!==this.visibilityEventHandler&&document.removeEventListener("visibilitychange",this.visibilityEventHandler)}finally{this._lifecycleState="closed"}}closeAndGetPendingLocalState(){S(this.attachState===o.mB.Attached,209),S(void 0!==this.resolvedUrl&&"fluid"===this.resolvedUrl.type,210),S(!!this._protocolHandler,739),S(void 0!==this._protocolHandler.attributes.term,779);const e={pendingRuntimeState:this.context.getPendingLocalState(),url:this.resolvedUrl.url,protocol:this.protocolHandler.getProtocolState(),term:this._protocolHandler.attributes.term,clientId:this.clientId};return this.close(),JSON.stringify(e)}get attachState(){return this._attachState}serialize(){S(this.attachState===o.mB.Detached,211);const e=A(this.context.createSummary(),this.captureProtocolSummary());return this.loader.services.detachedBlobStorage&&this.loader.services.detachedBlobStorage.size>0&&(e.tree[".hasAttachmentBlobs"]={type:L.Blob,content:"true"}),JSON.stringify(e)}async attach(e){await u.Xr.timedExecAsync(this.mc.logger,{eventName:"Attach"},(async()=>{if("loaded"!==this._lifecycleState)throw new E.Oi(`The Container is not in a valid state for attach [${this._lifecycleState}]`);S(this._attachState===o.mB.Detached&&!this.attachStarted,517),this.attachStarted=!0;const t=void 0!==this.loader.services.detachedBlobStorage&&this.loader.services.detachedBlobStorage.size>0;try{let r;if(S(0===this.deltaManager.inbound.length,214),!t){const e=this.context.createSummary(),t=this.captureProtocolSummary();r=A(e,t),this._attachState=o.mB.Attaching,this.context.notifyAttaching(Re(r))}const n=await this.urlResolver.resolve(e);p(n),void 0===this.service&&(S(this.client.details.type!==Ge,708),this.service=await I((async()=>this.serviceFactory.createContainer(r,n,this.subLogger,!1)),"containerAttach",this.mc.logger,{cancel:this.closeSignal}));const s=this.service.resolvedUrl;if(p(s),this._resolvedUrl=s,await this.connectStorageService(),t){S(!!this.loader.services.detachedBlobStorage,590);const e=new Map;for(;e.size<this.loader.services.detachedBlobStorage.size;){const t=this.loader.services.detachedBlobStorage.getBlobIds().filter((t=>!e.has(t)));for(const r of t){const t=await this.loader.services.detachedBlobStorage.readBlob(r),n=await this.storageService.createBlob(t);e.set(r,n.id)}}const t=this.context.createSummary(e),n=this.captureProtocolSummary();r=A(t,n),this._attachState=o.mB.Attaching,this.context.notifyAttaching(Re(r)),await this.storageService.uploadSummaryWithContext(r,{referenceSequenceNumber:0,ackHandle:void 0,proposalHandle:void 0})}this._attachState=o.mB.Attached,this.emit("attached"),this.propagateConnectionState(),this.closed||this.resumeInternal({fetchOpsFromStorage:!1,reason:"createDetached"})}catch(e){const t=(0,ee.SC)(e),r=this.resolvedUrl;throw d(r)&&t.addTelemetryProperties({resolvedUrl:r.url}),this.close(t),t}}),{start:!0,end:!0,cancel:"generic"})}async request(e){return u.Xr.timedExecAsync(this.mc.logger,{eventName:"Request"},(async()=>this.context.request(e)),{end:!0,cancel:"error"})}setAutoReconnectInternal(e){if(this._deltaManager.connectionManager.reconnectMode===e)return;const t=b.now(),r=t-this.setAutoReconnectTime;this.setAutoReconnectTime=t,this.mc.logger.sendTelemetryEvent({eventName:e===Q.Enabled?"AutoReconnectEnabled":"AutoReconnectDisabled",connectionMode:this.connectionMode,connectionState:ye.e[this.connectionState],duration:r}),this._deltaManager.connectionManager.setAutoReconnect(e)}connect(){if(this.closed)throw new E.Oi("The Container is closed and cannot be connected");if(this._attachState!==o.mB.Attached)throw new E.Oi("The Container is not attached and cannot be connected");this.connected||this.connectInternal({reason:"DocumentConnect",fetchOpsFromStorage:!1})}connectInternal(e){S(!this.closed,709),S(this._attachState===o.mB.Attached,710),this.resumeInternal(e);const t=Q.Enabled;this.setAutoReconnectInternal(t)}disconnect(){if(this.closed)throw new E.Oi("The Container is closed and cannot be disconnected");this.disconnectInternal()}disconnectInternal(){S(!this.closed,711);const e=Q.Disabled;this.setAutoReconnectInternal(e)}resumeInternal(e){S(!this.closed,217),this.inboundQueuePausedFromInit&&(this.inboundQueuePausedFromInit=!1,this._deltaManager.inbound.resume(),this._deltaManager.inboundSignal.resume()),this.connectToDeltaStream(e)}async getAbsoluteUrl(e){var t;if(void 0!==this.resolvedUrl)return this.urlResolver.getAbsoluteUrl(this.resolvedUrl,e,(e=>{let t;return t=e&&"name"in e?e:(0,C.s2)(null==e?void 0:e.package)?null==e?void 0:e.package.name:null==e?void 0:e.package,{name:t}})(null===(t=this._context)||void 0===t?void 0:t.codeDetails))}async proposeCodeDetails(e){if(!(0,C.Tr)(e))throw new Error("Provided codeDetails are not IFluidCodeDetails");if(this.codeLoader.IFluidCodeDetailsComparer){const t=await this.codeLoader.IFluidCodeDetailsComparer.compare(e,this.getCodeDetailsFromQuorum());if(void 0!==t&&t<=0)throw new Error("Proposed code details should be greater than the current")}return this.protocolHandler.quorum.propose("code",e).then((()=>!0)).catch((()=>!1))}async processCodeProposal(){const e=this.getCodeDetailsFromQuorum();if(await Promise.all([this.deltaManager.inbound.pause(),this.deltaManager.inboundSignal.pause()]),!0===await this.context.satisfies(e))return this.deltaManager.inbound.resume(),void this.deltaManager.inboundSignal.resume();this.close(new E.pY("Existing context does not satisfy incoming proposal"))}async getVersion(e){return(await this.storageService.getVersions(e,1))[0]}recordConnectStartTime(){void 0===this.connectionTransitionTimes[ye.e.Disconnected]&&(this.connectionTransitionTimes[ye.e.Disconnected]=b.now())}connectToDeltaStream(e){this.recordConnectStartTime(),this._canReconnect&&this.client.details.capabilities.interactive||(e.mode="write"),this._deltaManager.connect(e)}async load(e,t,r){if(void 0===this._resolvedUrl)throw new Error("Attempting to load without a resolved url");this.service=await this.serviceFactory.createDocumentService(this._resolvedUrl,this.subLogger,this.client.details.type===Ge);void 0===t.deltaConnection&&this.connectToDeltaStream({reason:"DocumentOpen",mode:"write",fetchOpsFromStorage:!1}),r?this.connectStorageService().catch((e=>this.close(e))):await this.connectStorageService(),this._attachState=o.mB.Attached;const{snapshot:n,versionId:s}=void 0===r?await this.fetchSnapshotTree(e):{snapshot:void 0,versionId:void 0};S(void 0!==n||void 0!==r,567);const i=void 0===r?await this.getDocumentAttributes(this.storageService,n):{sequenceNumber:r.protocol.sequenceNumber,minimumSequenceNumber:r.protocol.minimumSequenceNumber,term:r.term};let a;switch(t.opsBeforeReturn){case void 0:this.attachDeltaManagerOpHandler(i,"none"!==t.deltaConnection?"all":"none");break;case"cached":a=this.attachDeltaManagerOpHandler(i,"cached");break;case"all":a=this.attachDeltaManagerOpHandler(i,"all");break;default:w(t.opsBeforeReturn)}this._protocolHandler=void 0===r?await this.initializeProtocolStateFromSnapshot(i,this.storageService,n):await this.initializeProtocolState(i,r.protocol.members,r.protocol.proposals,r.protocol.values);const c=this.getCodeDetailsFromQuorum();if(await this.instantiateContext(!0,c,n,null==r?void 0:r.pendingRuntimeState),!this.closed)switch(void 0!==a&&(this._deltaManager.inbound.resume(),await Ve(this.mc.logger,"WaitOps",(async()=>(await a,{}))),await Ve(this.mc.logger,"WaitOpProcessing",(async()=>this._deltaManager.inbound.waitTillProcessingDone())),this._deltaManager.inbound.pause()),t.deltaConnection){case void 0:case"delayed":S(this.inboundQueuePausedFromInit,838),this.inboundQueuePausedFromInit=!1,this._deltaManager.inbound.resume(),this._deltaManager.inboundSignal.resume();break;case"none":break;default:w(t.deltaConnection)}if(this.closed)throw new Error("Container was closed while load()");return this.setLoaded(),{sequenceNumber:i.sequenceNumber,version:s,dmLastProcessedSeqNumber:this._deltaManager.lastSequenceNumber,dmLastKnownSeqNumber:this._deltaManager.lastKnownSeqNumber}}async createDetached(e){const t={sequenceNumber:0,term:1,minimumSequenceNumber:0};await this.attachDeltaManagerOpHandler(t);const r=De(e);this._protocolHandler=await this.initializeProtocolState(t,[],[],r),await this.instantiateContextDetached(!1),this.setLoaded()}async rehydrateDetachedFromSnapshot(e){void 0!==e.tree[".hasAttachmentBlobs"]&&(S(!!this.loader.services.detachedBlobStorage&&this.loader.services.detachedBlobStorage.size>0,592),delete e.tree[".hasAttachmentBlobs"]);const t=Re(e);this._storage.loadSnapshotForRehydratingContainer(t);const r=await this.getDocumentAttributes(this._storage,t);await this.attachDeltaManagerOpHandler(r);const n=Ie(t),s=function(e){const t=new Map(e).get("code");return S(void 0!==t,732),null==t?void 0:t.value}(await(0,M.g)(this._storage,n.blobs.quorumValues));this._protocolHandler=await this.initializeProtocolState(r,[],[],void 0!==s?De(s):[]),await this.instantiateContextDetached(!0,t),this.setLoaded()}async connectStorageService(){var e,t;if(void 0!==this._storageService)return;S(void 0!==this.service,495);const r=await this.service.connectToStorage();this._storageService=new be(r,this.mc.logger),!0===this.options.summarizeProtocolTree&&(this.mc.logger.sendTelemetryEvent({eventName:"summarizeProtocolTreeEnabled"}),this._storageService=new Se(this._storageService,(()=>this.captureProtocolSummary()))),S((null===(e=r.policies)||void 0===e?void 0:e.minBlobSize)===(null===(t=this.storageService.policies)||void 0===t?void 0:t.minBlobSize),224)}async getDocumentAttributes(e,t){if(void 0===t)return{minimumSequenceNumber:0,sequenceNumber:0,term:1};const r=".protocol"in t.trees?t.trees[".protocol"].blobs.attributes:t.blobs[".attributes"],n=await(0,M.g)(e,r);return void 0===n.term&&(n.term=1),n}async initializeProtocolStateFromSnapshot(e,t,r){let n=[],s=[],i=[];if(void 0!==r){const e=Ie(r);[n,s,i]=await Promise.all([(0,M.g)(t,e.blobs.quorumMembers),(0,M.g)(t,e.blobs.quorumProposals),(0,M.g)(t,e.blobs.quorumValues)])}return await this.initializeProtocolState(e,n,s,i)}async initializeProtocolState(e,t,r,n){const s=new X(e.minimumSequenceNumber,e.sequenceNumber,e.term,t,r,n,((e,t)=>this.submitMessage(B.Propose,{key:e,value:t}))),i=u.G2.create(this.subLogger,"ProtocolHandler");return s.quorum.on("error",(e=>{i.sendErrorEvent(e)})),this.connectionStateHandler.initProtocol(s),s.quorum.on("addProposal",(e=>{"code"!==e.key&&"code2"!==e.key||this.emit("codeDetailsProposed",e.value,e)})),s.quorum.on("approveProposal",((e,t,r)=>{"code"!==t&&"code2"!==t||((0,C.Tr)(r)||this.mc.logger.sendErrorEvent({eventName:"CodeProposalNotIFluidCodeDetails"}),this.processCodeProposal().catch((e=>{throw this.close((0,ee.SC)(e)),e})))})),s}captureProtocolSummary(){const e=this.protocolHandler.snapshot();return{tree:{attributes:{content:JSON.stringify(this.protocolHandler.attributes),type:L.Blob},quorumMembers:{content:JSON.stringify(e.members),type:L.Blob},quorumProposals:{content:JSON.stringify(e.proposals),type:L.Blob},quorumValues:{content:JSON.stringify(e.values),type:L.Blob}},type:L.Tree}}getCodeDetailsFromQuorum(){var e,t;return e=this.protocolHandler.quorum,null!==(t=e.get("code"))&&void 0!==t?t:e.get("code2")}get client(){var e;const t=void 0!==(null===(e=this.options)||void 0===e?void 0:e.client)?this.options.client:{details:{capabilities:{interactive:!0}},mode:"read",permission:[],scopes:[],user:{id:""}};return void 0!==this.clientDetailsOverride&&v()(t.details,this.clientDetailsOverride),t.details.environment=[t.details.environment,` loaderVersion:${me}`].join(";"),t}activeConnection(){return this.connectionState===ye.e.Connected&&"write"===this.connectionMode}createDeltaManager(){const e=()=>this.service,t=new ue(e,u.G2.create(this.subLogger,"DeltaManager"),(()=>this.activeConnection()),(t=>new He(e,this.client,this._canReconnect,u.G2.create(this.subLogger,"ConnectionManager"),t)));return t.inbound.pause(),t.inboundSignal.pause(),t.on("connect",((e,t)=>{var r;this._audience.clear();for(const t of null!==(r=e.initialClients)&&void 0!==r?r:[])this._audience.addMember(t.clientId,t.client);this.connectionStateHandler.receivedConnectEvent(this.connectionMode,e)})),t.on("disconnect",(e=>{var t;null===(t=this.collabWindowTracker)||void 0===t||t.stopSequenceNumberUpdate(),this.connectionStateHandler.receivedDisconnectEvent(e)})),t.on("throttled",(e=>{const t=e;!0!==t.logged&&this.logContainerError(t),this.emit("warning",t)})),t.on("readonly",(e=>{this.emit("readonly",e)})),t.on("closed",(e=>{this.closeCore(e)})),t}async attachDeltaManagerOpHandler(e,t){var r;return this._deltaManager.attachOpHandler(e.minimumSequenceNumber,e.sequenceNumber,null!==(r=e.term)&&void 0!==r?r:1,{process:e=>this.processRemoteMessage(e),processSignal:e=>{this.processSignal(e)}},t)}logConnectionStateChangeTelemetry(e,t,r){var n;const s=b.now();this.connectionTransitionTimes[e]=s;const i=s-this.connectionTransitionTimes[t];let o,a,c,h,l;e===ye.e.Disconnected?c=this._deltaManager.connectionManager.reconnectMode:(e===ye.e.Connected?(o=s-this.connectionTransitionTimes[ye.e.Disconnected],o=u.hy.formatTick(o)):(h=this.deltaManager.lastKnownSeqNumber,this.deltaManager.hasCheckpointSequenceNumber&&(l=h-this.deltaManager.lastSequenceNumber)),a=this.firstConnection?"InitialConnect":"AutoReconnect"),this.mc.logger.sendPerformanceEvent(Object.assign({eventName:`ConnectionStateChange_${ye.e[e]}`,from:ye.e[t],duration:i,durationFromDisconnected:o,reason:r,connectionInitiationReason:a,pendingClientId:this.connectionStateHandler.pendingClientId,clientId:this.clientId,autoReconnect:c,opsBehind:l,online:P.Yz[(0,P.Gg)()],lastVisible:void 0!==this.lastVisible?b.now()-this.lastVisible:void 0,checkpointSequenceNumber:h,quorumSize:null===(n=this._protocolHandler)||void 0===n?void 0:n.quorum.getMembers().size},this._deltaManager.connectionProps)),e===ye.e.Connected&&(this.firstConnection=!1)}propagateConnectionState(){var e;const t=this.connectionState===ye.e.Connected&&!this.firstConnection&&"write"===this.connectionMode;t&&(this.messageCountAfterDisconnection=0);const r=this.connectionState===ye.e.Connected;!1===(null===(e=this._context)||void 0===e?void 0:e.disposed)&&this.context.setConnectionState(r,this.clientId),this.protocolHandler.setConnectionState(r,this.clientId),(0,Y.Qq)(this.mc.logger,this,r,this.clientId),t&&this.mc.logger.sendTelemetryEvent({eventName:"OpsSentOnReconnect",count:this.messageCountAfterDisconnection})}submitContainerMessage(e,t,r,n){switch(e){case B.Operation:case B.RemoteHelp:break;case B.Summarize:{const e=t;void 0===e.details&&(e.details={}),e.details.includesProtocolTree=!0===this.options.summarizeProtocolTree;break}default:return this.close(new E.pY("invalidContainerSubmitOpType",void 0,{messageType:e})),-1}return this.submitMessage(e,t,r,n)}submitMessage(e,t,r,n){var s;return this.connectionState!==ye.e.Connected?(this.mc.logger.sendErrorEvent({eventName:"SubmitMessageWithNoConnection",type:e}),-1):(this.messageCountAfterDisconnection+=1,null===(s=this.collabWindowTracker)||void 0===s||s.stopSequenceNumberUpdate(),this._deltaManager.submit(e,t,r,n))}processRemoteMessage(e){const t=this.clientId===e.clientId;let r={immediateNoOp:!1};try{r=this.protocolHandler.processMessage(e,t)}catch(t){this.close((0,ee.Jn)(t,(t=>new E.Jd(t,(0,E.HN)(e)))))}return(0,q._V)(e)&&!(0,q.LW)(e)&&this.mc.logger.sendTelemetryEvent({eventName:"UnpackedRuntimeMessage",type:e.type}),((0,q.LW)(e)||(0,q._V)(e))&&this.context.process(e,t,void 0),this.activeConnection()&&(void 0===this.collabWindowTracker&&(S(void 0!==this.serviceConfiguration,740),this.collabWindowTracker=new Me(((e,t)=>{S(this.activeConnection(),577),this.submitMessage(e,t)}),this.serviceConfiguration.noopTimeFrequency,this.serviceConfiguration.noopCountFrequency)),this.collabWindowTracker.scheduleSequenceNumberUpdate(e,!0===r.immediateNoOp)),this.emit("op",e),r}submitSignal(e){this._deltaManager.submitSignal(JSON.stringify(e))}processSignal(e){if(null===e.clientId){const t=e.content;if(t.type===B.ClientJoin){const e=t.content;this._audience.addMember(e.clientId,e.client)}else if(t.type===B.ClientLeave){const e=t.content;this._audience.removeMember(e)}}else{const t=this.clientId===e.clientId;this.context.processSignal(e,t)}}async fetchSnapshotTree(e){var t;const r=await this.getVersion(null!=e?e:null);void 0===r&&void 0!==e&&this.mc.logger.sendErrorEvent({eventName:"NoVersionFoundWhenSpecified",id:e}),this._loadedFromVersion=r;const n=null!==(t=await this.storageService.getSnapshotTree(r))&&void 0!==t?t:void 0;return void 0===n&&void 0!==r&&this.mc.logger.sendErrorEvent({eventName:"getSnapshotTreeFailed",id:r.id}),{snapshot:n,versionId:null==r?void 0:r.id}}async instantiateContextDetached(e,t){const r=this.getCodeDetailsFromQuorum();if(void 0===r)throw new Error("pkg should be provided in create flow!!");await this.instantiateContext(e,r,t)}async instantiateContext(e,t,r,n){var s;S(!1!==(null===(s=this._context)||void 0===s?void 0:s.disposed),221);const i=new $e(this,this.loader);this._context=await ne.createOrLoad(this,this.scope,this.codeLoader,t,r,new ge(this._deltaManager),new ke(this.protocolHandler.quorum),i,((e,t,r,n)=>this.submitContainerMessage(e,t,r,n)),(e=>this.submitSignal(e)),(e=>this.close(e)),Ke.version,(e=>this.updateDirtyContainerState(e)),e,n),this.emit("contextChanged",t)}updateDirtyContainerState(e){this._dirtyContainer!==e&&(this._dirtyContainer=e,this.emit(e?Ue:ze))}logContainerError(e){this.mc.logger.sendErrorEvent({eventName:"ContainerWarning"},e)}}function We(e){return void 0===e.headers||!1!==e.headers[c.A.cache]}Ke.version="^0.1.0";class $e{constructor(e,t){this.container=e,this.loader=t}get IFluidRouter(){return this}async resolve(e){var t,r,n,s,i;if(e.url.startsWith("/")){if(We(e))return this.container;{const o=this.container.resolvedUrl;return p(o),await Ke.load(this.loader,{canReconnect:null===(t=e.headers)||void 0===t?void 0:t[c.A.reconnect],clientDetailsOverride:null===(r=e.headers)||void 0===r?void 0:r[c.A.clientDetails],resolvedUrl:Object.assign({},o),version:null!==(s=null===(n=e.headers)||void 0===n?void 0:n[c.A.version])&&void 0!==s?s:void 0,loadMode:null===(i=e.headers)||void 0===i?void 0:i[c.A.loadMode]})}}if(void 0===this.loader)throw new Error("Cannot resolve external containers");return this.loader.resolve(e)}async request(e){return e.url.startsWith("/")?(await this.resolve(e)).request(e):void 0===this.loader?{status:404,value:"Cannot request external containers",mimeType:"plain/text"}:this.loader.request(e)}}function Je(e){const t=Object.create(e),r=new Map;return t.resolve=async t=>We(t)?(r.has(t.url)||r.set(t.url,e.resolve(t)),r.get(t.url)):e.resolve(t),t}class Xe{constructor(e){var t,r;this.containers=new Map;const n=Object.assign({},e.scope);!1!==(null===(t=e.options)||void 0===t?void 0:t.provideScopeLoader)&&(n.ILoader=this);const s={loaderId:(0,a.Z)(),loaderVersion:me},i=(0,h.UK)(l.b.mixinDebugLogger("fluid:telemetry",e.logger,{all:s}),h.of.value,e.configProvider);this.services={urlResolver:Je(g.create(e.urlResolver)),documentServiceFactory:f.create(e.documentServiceFactory),codeLoader:e.codeLoader,options:null!==(r=e.options)&&void 0!==r?r:{},scope:n,subLogger:i.logger,detachedBlobStorage:e.detachedBlobStorage},this.mc=(0,h.rZ)(u.G2.create(this.services.subLogger,"Loader"))}get IFluidRouter(){return this}async createDetachedContainer(e){const t=await Ke.createDetached(this,e);return this.cachingEnabled&&t.once("attached",(()=>{p(t.resolvedUrl);const e=Oe(t.resolvedUrl.url);void 0!==e&&this.addToContainerCache(e.id,Promise.resolve(t))})),t}async rehydrateDetachedContainerFromSnapshot(e){return Ke.rehydrateDetachedFromSnapshot(this,e)}async resolve(e,t){const r=void 0===t?"Resolve":"ResolveWithPendingState";return u.Xr.timedExecAsync(this.mc.logger,{eventName:r},(async()=>(await this.resolveCore(e,void 0!==t?JSON.parse(t):void 0)).container))}async request(e){return u.Xr.timedExecAsync(this.mc.logger,{eventName:"Request"},(async()=>{const t=await this.resolveCore(e);return t.container.request(Object.assign(Object.assign({},e),{url:`${t.parsed.path}${t.parsed.query}`}))}))}getKeyForContainerCache(e,t){var r;return void 0!==(null===(r=e.headers)||void 0===r?void 0:r[c.A.version])?`${t.id}@${e.headers[c.A.version]}`:t.id}addToContainerCache(e,t){this.containers.set(e,t),t.then((t=>{t.closed?this.containers.delete(e):t.once("closed",(()=>{this.containers.delete(e)}))})).catch((e=>{}))}async resolveCore(e,t){const r=await this.services.urlResolver.resolve(e);p(r);const n=Oe(r.url);if(void 0===n)throw new Error(`Invalid URL ${r.url}`);if(void 0!==t){const e=Oe(t.url);if((null==e?void 0:e.id)!==n.id||(null==e?void 0:e.path.replace(/\/$/,""))!==n.path.replace(/\/$/,"")){const e=`URL ${r.url} does not match pending state URL ${t.url}`;throw new Error(e)}}const{canCache:s,fromSequenceNumber:i}=this.parseHeader(n,e);let o;if(void 0===t&&s){const t=this.getKeyForContainerCache(e,n),s=await this.containers.get(t);if(void 0!==s)o=s;else{const n=this.loadContainer(e,r);this.addToContainerCache(t,n),o=await n}}else o=await this.loadContainer(e,r,t);return o.deltaManager.lastSequenceNumber<=i&&await new Promise(((e,t)=>{o.on("op",(function t(r){r.sequenceNumber>i&&(e(),o.removeListener("op",t))}))})),{container:o,parsed:n}}get cachingEnabled(){return!1!==this.services.options.cache}canCacheForRequest(e){return this.cachingEnabled&&!1!==e[c.A.cache]}parseHeader(e,t){var r,n;let s=-1;t.headers=null!==(r=t.headers)&&void 0!==r?r:{};const i=t.headers[c.A.sequenceNumber];return void 0!==i&&(s=i),t.headers[c.A.version]=null!==(n=e.version)&&void 0!==n?n:t.headers[c.A.version],{canCache:this.canCacheForRequest(t.headers),fromSequenceNumber:s}}async loadContainer(e,t,r){var n,s,i,o,a;return Ke.load(this,{canReconnect:null===(n=e.headers)||void 0===n?void 0:n[c.A.reconnect],clientDetailsOverride:null===(s=e.headers)||void 0===s?void 0:s[c.A.clientDetails],resolvedUrl:t,version:null!==(o=null===(i=e.headers)||void 0===i?void 0:i[c.A.version])&&void 0!==o?o:void 0,loadMode:null===(a=e.headers)||void 0===a?void 0:a[c.A.loadMode]},r)}}var Qe,Ze=r(1),Ye=r(2434);function et(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}!function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(Qe||(Qe={}));var tt,rt=r(686);class nt{constructor(e){this.maxRequests=e,this.tasks=[],this.release=()=>{const e=this.tasks.shift();if(void 0!==e)return e();this.maxRequests++},(0,rt.h)(e>0,174)}get waitQueueLength(){return this.tasks.length}async acquire(){if(!(this.maxRequests>0))return new Promise((e=>{this.tasks.push(e)}));this.maxRequests--}async schedule(e){return await this.acquire(),e().finally(this.release)}}function st(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}function it(e,t){switch(t){case"base64":return Ce.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}function ot(e){const t=e;return e instanceof ArrayBuffer||"object"==typeof t&&null!==t&&"number"==typeof t.byteLength&&"function"==typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}!function(e){e[e.NoCaching=0]="NoCaching",e[e.Prefetch=1]="Prefetch"}(tt||(tt={}));class at extends Uint8Array{toString(e){return it(this,e)}static from(e,t,r){if("string"==typeof e)return at.fromString(e,t);if(null!==e&&"object"==typeof e&&ot(e.buffer))return st(0===e.byteOffset,0),st(e.byteLength===e.buffer.byteLength,1),at.fromArrayBuffer(e.buffer,t,r);if(ot(e))return at.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const n=null!=t?t:0,s=null!=r?r:e.byteLength-n;if(n<0||n>e.byteLength||s<0||s+n>e.byteLength)throw new RangeError;return new at(e,n,s)}static fromString(e,t){switch(t){case"base64":{const t=this.sanitizeBase64(e),r=Ce.toByteArray(t);return new at(r.buffer)}case"utf8":case"utf-8":case void 0:{const t=(new TextEncoder).encode(e);return new at(t.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!=0&&(t+=["","===","==","="][t.length%4]),t}}var ct=r(7673),ht=r(4530),lt=r.n(ht),ut=r(4200),dt=r.n(ut);const pt=(0,r(921).debug)("fluid:services-client");pt("Package: @fluidframework/server-services-client - Version: 0.1036.5001");class gt extends Error{constructor(e,t,r,n,s){super(t),this.code=e,this.canRetry=r,this.isFatal=n,this.retryAfterMs=s,this.name="NetworkError",this.retryAfter=void 0!==s?s/1e3:void 0}get details(){return void 0===this.canRetry&&void 0===this.isFatal&&void 0===this.retryAfterMs?this.message:{message:this.message,canRetry:this.canRetry,isFatal:this.isFatal,retryAfter:this.retryAfter,retryAfterMs:this.retryAfterMs}}toJSON(){return{code:this.code,message:this.message,canRetry:this.canRetry,isFatal:this.isFatal,retryAfterMs:this.retryAfterMs,retryAfter:this.retryAfter}}}function mt(e,t){var r;let n,s,i,o;switch(t&&"object"==typeof t?(n=null!==(r=t.message)&&void 0!==r?r:"Unknown Error",s=t.canRetry,i=t.isFatal,o=t.retryAfter):n=t&&"string"==typeof t?t:"Unknown Error",e){case 401:case 403:case 404:return new gt(e,n,!1,!1);case 413:case 422:return new gt(e,n,null!=s&&s,null!=i&&i,s?o:void 0);case 429:case 502:case 503:case 504:return new gt(e,n,!0,!1,o);case 500:return new gt(e,n,null==s||s,null!=i&&i,s?o:void 0);default:return new gt(e,n,!1,!0)}}const ft="x-correlation-id";class yt{constructor(e,t={},r=1048576e3,n=1048576e3){this.baseurl=e,this.defaultQueryString=t,this.maxBodyLength=r,this.maxContentLength=n}async get(e,t,r){const n={baseURL:this.baseurl,headers:r,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"GET",url:`${e}${this.generateQueryString(t)}`};return this.request(n,200)}async post(e,t,r,n){const s={baseURL:this.baseurl,data:t,headers:n,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"POST",url:`${e}${this.generateQueryString(r)}`};return this.request(s,201)}async delete(e,t,r){const n={baseURL:this.baseurl,headers:r,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"DELETE",url:`${e}${this.generateQueryString(t)}`};return this.request(n,204)}async patch(e,t,r,n){const s={baseURL:this.baseurl,data:t,headers:n,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"PATCH",url:`${e}${this.generateQueryString(r)}`};return this.request(s,200)}generateQueryString(e){if(this.defaultQueryString||e){const t=Object.assign(Object.assign({},this.defaultQueryString),e),r=ct.stringify(t);if(""!==r)return`?${r}`}return""}}class vt extends yt{constructor(e,t={},r=1048576e3,n=1048576e3,s={},i=dt(),o,a,c){super(e,t,r,n),this.defaultHeaders=s,this.axios=i,this.refreshDefaultQueryString=o,this.refreshDefaultHeaders=a,this.getCorrelationId=c}async request(e,t,r=!0){var n,s;const i=Object.assign({},e);return i.headers=this.generateHeaders(i.headers,null!==(s=null===(n=this.getCorrelationId)||void 0===n?void 0:n.call(this))&&void 0!==s?s:(0,a.Z)()),new Promise(((n,s)=>{this.axios.request(i).then((e=>{n(e.data)})).catch((o=>{var a,c,h,l,u,d,p,g,m,f,y,v,b,S;if((null===(a=null==o?void 0:o.response)||void 0===a?void 0:a.status)===t&&n(null===(c=null==o?void 0:o.response)||void 0===c?void 0:c.data),(null==o?void 0:o.config)?pt(`[${o.config.method}] request to [${null!==(h=o.config.baseURL)&&void 0!==h?h:""}${null!==(l=o.config.url)&&void 0!==l?l:""}] failed with [${null===(u=o.response)||void 0===u?void 0:u.status}] [${lt()(null===(d=o.response)||void 0===d?void 0:d.data,void 0,2)}]`):pt(`request to ${i.url} failed ${o?o.message:""}`),429===(null===(p=null==o?void 0:o.response)||void 0===p?void 0:p.status)&&(null===(m=null===(g=null==o?void 0:o.response)||void 0===g?void 0:g.data)||void 0===m?void 0:m.retryAfter)>0&&r)setTimeout((()=>{this.request(i,t).then(n).catch(s)}),1e3*o.response.data.retryAfter);else if(401===(null===(f=null==o?void 0:o.response)||void 0===f?void 0:f.status)&&r&&this.refreshOnAuthError()){const r=Object.assign({},e);r.headers=this.generateHeaders(r.headers,i.headers[ft]),this.request(r,t,!1).then(n).catch(s)}else if(null==o?void 0:o.response)s(mt(null===(y=null==o?void 0:o.response)||void 0===y?void 0:y.status,null===(v=null==o?void 0:o.response)||void 0===v?void 0:v.data));else if(null==o?void 0:o.request)s(mt(502,`Network Error: ${null!==(b=null==o?void 0:o.message)&&void 0!==b?b:"undefined"}`));else{const e={canRetry:!1,isFatal:!1,message:null!==(S=null==o?void 0:o.message)&&void 0!==S?S:"Unknown Error"};s(mt(500,e))}}))}))}generateHeaders(e,t){let r=null!=e?e:{};return this.defaultHeaders&&(r=Object.assign(Object.assign({},this.defaultHeaders),e)),r[ft]?r:Object.assign({[ft]:t},r)}refreshOnAuthError(){return(void 0!==this.refreshDefaultQueryString||void 0!==this.refreshDefaultHeaders)&&(void 0!==this.refreshDefaultHeaders&&(this.defaultHeaders=this.refreshDefaultHeaders()),void 0!==this.refreshDefaultQueryString&&(this.defaultQueryString=this.refreshDefaultQueryString()),!0)}}function bt(e,t){for(const r of t)if(e.endsWith(r))return!0;return!1}class St{constructor(e,t,r,n){this.endpoint=e,this.historianApi=t,this.restWrapper=n,this.defaultQueryString={},r&&this.historianApi?(this.defaultQueryString.disableCache=r,this.cacheBust=!1):this.cacheBust=r,void 0===this.restWrapper&&(this.restWrapper=new vt(this.endpoint))}async getHeader(e){return this.historianApi?this.restWrapper.get(`/headers/${encodeURIComponent(e)}`,this.getQueryString()):this.getHeaderDirect(e)}async getFullTree(e){return this.restWrapper.get(`/tree/${encodeURIComponent(e)}`,this.getQueryString())}async getBlob(e){return this.restWrapper.get(`/git/blobs/${encodeURIComponent(e)}`,this.getQueryString())}async createBlob(e){return this.restWrapper.post("/git/blobs",e,this.getQueryString())}async getContent(e,t){return this.restWrapper.get(`/contents/${e}`,this.getQueryString({ref:t}))}async getCommits(e,t){return this.restWrapper.get("/commits",this.getQueryString({count:t,sha:e})).catch((e=>400===e||404===e?[]:Promise.reject(e)))}async getCommit(e){return this.restWrapper.get(`/git/commits/${encodeURIComponent(e)}`,this.getQueryString())}async createCommit(e){return this.restWrapper.post("/git/commits",e,this.getQueryString())}async getRefs(){return this.restWrapper.get("/git/refs",this.getQueryString())}async getRef(e){return this.restWrapper.get(`/git/refs/${e}`,this.getQueryString())}async createRef(e){return this.restWrapper.post("/git/refs",e,this.getQueryString())}async updateRef(e,t){return this.restWrapper.patch(`/git/refs/${e}`,t,this.getQueryString())}async deleteRef(e){await this.restWrapper.delete(`/git/refs/${e}`,this.getQueryString())}async createTag(e){return this.restWrapper.post("/git/tags",e,this.getQueryString())}async getTag(e){return this.restWrapper.get(`/git/tags/${e}`,this.getQueryString())}async createTree(e){return this.restWrapper.post("/git/trees",e,this.getQueryString())}async getTree(e,t){return this.restWrapper.get(`/git/trees/${encodeURIComponent(e)}`,this.getQueryString({recursive:t?1:0}))}async createSummary(e){return this.restWrapper.post("/git/summaries",e,this.getQueryString())}async deleteSummary(e){const t={"Soft-Delete":e};return this.restWrapper.delete("/git/summaries",this.getQueryString(),t)}async getSummary(e){return this.restWrapper.get(`/git/summaries/${e}`,this.getQueryString())}async getHeaderDirect(e){const t=await this.getTree(e,!0),r=[".attributes",".blobs",".messages","header"],n=[];for(const e of t.tree)if("blob"===e.type&&bt(e.path,r)){const t=this.getBlob(e.sha);n.push(t)}return{blobs:await Promise.all(n),tree:t}}getQueryString(e){return this.cacheBust?Object.assign(Object.assign({cacheBust:Date.now()},this.defaultQueryString),e):Object.assign(Object.assign({},this.defaultQueryString),e)}}var wt,xt,Ct=r(1044);!function(e){e.File="100644",e.Executable="100755",e.Directory="040000",e.Symlink="120000"}(wt||(wt={})),function(e){e.Blob="Blob",e.Tree="Tree",e.Attachment="Attachment"}(xt||(xt={}));class Et{constructor(e){this.historian=e,this.blobCache=new Map,this.commitCache=new Map,this.treeCache=new Map,this.refCache=new Map}async getHeader(e,t){const r=await this.historian.getHeader(t);for(const e of r.blobs)this.blobCache.set(e.sha,e);return(0,Ct.eB)(r.tree)}async getFullTree(e){return this.historian.getFullTree(e)}async getCommit(e){return this.commitCache.has(e)?(pt(`Cache hit on ${e}`),this.commitCache.get(e)):this.historian.getCommit(e)}async getCommits(e,t){let r=e;if(this.refCache.has(e)&&(pt(`Commit cache hit on ${e}`),r=this.refCache.get(e),this.refCache.delete(e),!r))return[];if(this.commitCache.has(r)){const e=this.commitCache.get(r);return[{commit:{author:e.author,committer:e.committer,message:e.message,tree:e.tree,url:e.url},parents:e.parents,sha:e.sha,url:e.url}]}return this.historian.getCommits(r,t)}async getTree(e,t=!0){return this.treeCache.has(e)?(pt(`Tree cache hit on ${e}`),this.treeCache.get(e)):this.historian.getTree(e,t)}async getBlob(e){return this.blobCache.has(e)?(pt(`Blob cache hit on ${e}`),this.blobCache.get(e)):this.historian.getBlob(e)}getRawUrl(e){return`${this.historian.endpoint}/git/blobs/raw/${e}`}async getContent(e,t){return this.historian.getContent(t,e)}async createBlob(e,t){const r={content:e,encoding:t};return this.historian.createBlob(r)}async createGitTree(e){return this.historian.createTree(e)}async createTree(e){return this.createTreeCore(e,0)}async createCommit(e){return this.historian.createCommit(e)}async createSummary(e){return this.historian.createSummary(e)}async deleteSummary(e){return this.historian.deleteSummary(e)}async getSummary(e){return this.historian.getSummary(e)}async getRef(e){return this.historian.getRef(`heads/${e}`).catch((e=>{if(400===e||404===e)return null;throw e}))}async createRef(e,t){const r={ref:`refs/heads/${e}`,sha:t,config:{enabled:!0}};return this.historian.createRef(r)}async upsertRef(e,t){const r={force:!0,sha:t,config:{enabled:!0}};return this.historian.updateRef(`heads/${e}`,r)}addRef(e,t){this.refCache.set(e,t)}addCommit(e){this.commitCache.set(e.sha,e)}addTree(e){this.treeCache.set(e.sha,e)}addBlob(e){this.blobCache.set(e.sha,e)}async write(e,t,r,n){const s=await this.createTree(t),i={author:{date:(new Date).toISOString(),email:"kurtb@microsoft.com",name:"Kurt Berglund"},message:n,parents:r,tree:s.sha},o=await this.historian.createCommit(i);return await this.getRef(e)?await this.upsertRef(e,o.sha):await this.createRef(e,o.sha),o}async createTreeCore(e,t){if(e.id)return this.getTree(e.id);const r=[];for(const n of e.entries)switch(xt[n.type]){case xt.Blob:{const e=n.value;n.mode===wt.Symlink&&(e.contents=this.translateSymlink(e.contents,t));const s=this.createBlob(e.contents,e.encoding);r.push(s);break}case xt.Tree:{const e=n.value,s=this.createTreeCore(e,t+1);r.push(s);break}default:throw new Error("Unknown entry type")}const n=await Promise.all(r),s=[];st(n.length===e.entries.length,"File entries length is not correct");for(let t=0;t<e.entries.length;t++){const r=e.entries[t].type===xt.Tree?"tree":e.entries[t].type===xt.Blob?"blob":"commit";s.push({mode:e.entries[t].mode,path:e.entries[t].path,sha:n[t].sha,type:r})}const i={tree:s};return this.historian.createTree(i)}translateSymlink(e,t){let r="";for(let e=0;e<=t;e++)r+="../";return`${r}${e}`}}const At=Object.create(null);At.open="0",At.close="1",At.ping="2",At.pong="3",At.message="4",At.upgrade="5",At.noop="6";const Tt=Object.create(null);Object.keys(At).forEach((e=>{Tt[At[e]]=e}));const Ot={type:"error",data:"parser error"},Nt="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),Pt="function"==typeof ArrayBuffer,Rt=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,It=({type:e,data:t},r,n)=>Nt&&t instanceof Blob?r?n(t):Ft(t,n):Pt&&(t instanceof ArrayBuffer||Rt(t))?r?n(t):Ft(new Blob([t]),n):n(At[e]+(t||"")),Ft=(e,t)=>{const r=new FileReader;return r.onload=function(){const e=r.result.split(",")[1];t("b"+(e||""))},r.readAsDataURL(e)};function kt(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let Dt;const Mt="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let e=0;e<64;e++)Mt["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(e)]=e;const qt="function"==typeof ArrayBuffer,Lt=(e,t)=>{if("string"!=typeof e)return{type:"message",data:jt(e,t)};const r=e.charAt(0);return"b"===r?{type:"message",data:Bt(e.substring(1),t)}:Tt[r]?e.length>1?{type:Tt[r],data:e.substring(1)}:{type:Tt[r]}:Ot},Bt=(e,t)=>{if(qt){const r=(e=>{let t,r,n,s,i,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);const h=new ArrayBuffer(o),l=new Uint8Array(h);for(t=0;t<a;t+=4)r=Mt[e.charCodeAt(t)],n=Mt[e.charCodeAt(t+1)],s=Mt[e.charCodeAt(t+2)],i=Mt[e.charCodeAt(t+3)],l[c++]=r<<2|n>>4,l[c++]=(15&n)<<4|s>>2,l[c++]=(3&s)<<6|63&i;return h})(e);return jt(r,t)}return{base64:!0,data:e}},jt=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,_t=String.fromCharCode(30);let Ht;function Ut(e){return e.reduce(((e,t)=>e+t.length),0)}function zt(e,t){if(e[0].length===t)return e.shift();const r=new Uint8Array(t);let n=0;for(let s=0;s<t;s++)r[s]=e[0][n++],n===e[0].length&&(e.shift(),n=0);return e.length&&n<e[0].length&&(e[0]=e[0].slice(n)),r}function Vt(e){if(e)return function(e){for(var t in Vt.prototype)e[t]=Vt.prototype[t];return e}(e)}Vt.prototype.on=Vt.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},Vt.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},Vt.prototype.off=Vt.prototype.removeListener=Vt.prototype.removeAllListeners=Vt.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var s=0;s<n.length;s++)if((r=n[s])===t||r.fn===t){n.splice(s,1);break}return 0===n.length&&delete this._callbacks["$"+e],this},Vt.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),r=this._callbacks["$"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(r){n=0;for(var s=(r=r.slice(0)).length;n<s;++n)r[n].apply(this,t)}return this},Vt.prototype.emitReserved=Vt.prototype.emit,Vt.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},Vt.prototype.hasListeners=function(e){return!!this.listeners(e).length};const Gt="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function Kt(e,...t){return t.reduce(((t,r)=>(e.hasOwnProperty(r)&&(t[r]=e[r]),t)),{})}const Wt=Gt.setTimeout,$t=Gt.clearTimeout;function Jt(e,t){t.useNativeTimers?(e.setTimeoutFn=Wt.bind(Gt),e.clearTimeoutFn=$t.bind(Gt)):(e.setTimeoutFn=Gt.setTimeout.bind(Gt),e.clearTimeoutFn=Gt.clearTimeout.bind(Gt))}class Xt extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class Qt extends Vt{constructor(e){super(),this.writable=!1,Jt(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,r){return super.emitReserved("error",new Xt(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=Lt(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){const t=function(e){let t="";for(let r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t}(e);return t.length?"?"+t:""}}const Zt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Yt=64,er={};let tr,rr=0,nr=0;function sr(e){let t="";do{t=Zt[e%Yt]+t,e=Math.floor(e/Yt)}while(e>0);return t}function ir(){const e=sr(+new Date);return e!==tr?(rr=0,tr=e):e+"."+sr(rr++)}for(;nr<Yt;nr++)er[Zt[nr]]=nr;let or=!1;try{or="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}const ar=or;function cr(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||ar))return new XMLHttpRequest}catch(e){}if(!t)try{return new(Gt[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}function hr(){}const lr=null!=new cr({xdomain:!1}).responseType;class ur extends Vt{constructor(e,t){super(),Jt(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.data=void 0!==t.data?t.data:null,this.create()}create(){var e;const t=Kt(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd;const r=this.xhr=new cr(t);try{r.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&r.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(e){}if("POST"===this.method)try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{r.setRequestHeader("Accept","*/*")}catch(e){}null===(e=this.opts.cookieJar)||void 0===e||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(r.timeout=this.opts.requestTimeout),r.onreadystatechange=()=>{var e;3===r.readyState&&(null===(e=this.opts.cookieJar)||void 0===e||e.parseCookies(r)),4===r.readyState&&(200===r.status||1223===r.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof r.status?r.status:0)}),0))},r.send(this.data)}catch(e){return void this.setTimeoutFn((()=>{this.onError(e)}),0)}"undefined"!=typeof document&&(this.index=ur.requestsCount++,ur.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=hr,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete ur.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}function dr(){for(let e in ur.requests)ur.requests.hasOwnProperty(e)&&ur.requests[e].abort()}ur.requestsCount=0,ur.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",dr):"function"==typeof addEventListener&&addEventListener("onpagehide"in Gt?"pagehide":"unload",dr,!1));const pr="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),gr=Gt.WebSocket||Gt.MozWebSocket,mr="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),fr={websocket:class extends Qt{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,r=mr?{}:Kt(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=mr?new gr(e,t,r):t?new gr(e,t):new gr(e)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],n=t===e.length-1;It(r,this.supportsBinary,(e=>{try{this.ws.send(e)}catch(e){}n&&pr((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=ir()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}check(){return!!gr}},webtransport:class extends Qt{get name(){return"webtransport"}doOpen(){"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then((()=>{this.onClose()})).catch((e=>{this.onError("webtransport error",e)})),this.transport.ready.then((()=>{this.transport.createBidirectionalStream().then((e=>{const t=function(e,t){Ht||(Ht=new TextDecoder);const r=[];let n=0,s=-1,i=!1;return new TransformStream({transform(o,a){for(r.push(o);;){if(0===n){if(Ut(r)<1)break;const e=zt(r,1);i=128==(128&e[0]),s=127&e[0],n=s<126?3:126===s?1:2}else if(1===n){if(Ut(r)<2)break;const e=zt(r,2);s=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),n=3}else if(2===n){if(Ut(r)<8)break;const e=zt(r,8),t=new DataView(e.buffer,e.byteOffset,e.length),i=t.getUint32(0);if(i>Math.pow(2,21)-1){a.enqueue(Ot);break}s=i*Math.pow(2,32)+t.getUint32(4),n=3}else{if(Ut(r)<s)break;const e=zt(r,s);a.enqueue(Lt(i?e:Ht.decode(e),t)),n=0}if(0===s||s>e){a.enqueue(Ot);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(t).getReader(),n=new TransformStream({transform(e,t){!function(e,t){Nt&&e.data instanceof Blob?e.data.arrayBuffer().then(kt).then(t):Pt&&(e.data instanceof ArrayBuffer||Rt(e.data))?t(kt(e.data)):It(e,!1,(e=>{Dt||(Dt=new TextEncoder),t(Dt.encode(e))}))}(e,(r=>{const n=r.length;let s;if(n<126)s=new Uint8Array(1),new DataView(s.buffer).setUint8(0,n);else if(n<65536){s=new Uint8Array(3);const e=new DataView(s.buffer);e.setUint8(0,126),e.setUint16(1,n)}else{s=new Uint8Array(9);const e=new DataView(s.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(n))}e.data&&"string"!=typeof e.data&&(s[0]|=128),t.enqueue(s),t.enqueue(r)}))}});n.readable.pipeTo(e.writable),this.writer=n.writable.getWriter();const s=()=>{r.read().then((({done:e,value:t})=>{e||(this.onPacket(t),s())})).catch((e=>{}))};s();const i={type:"open"};this.query.sid&&(i.data=`{"sid":"${this.query.sid}"}`),this.writer.write(i).then((()=>this.onOpen()))}))})))}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],n=t===e.length-1;this.writer.write(r).then((()=>{n&&pr((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){var e;null===(e=this.transport)||void 0===e||e.close()}},polling:class extends Qt{constructor(e){if(super(e),this.polling=!1,"undefined"!=typeof location){const t="https:"===location.protocol;let r=location.port;r||(r=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||r!==e.port}const t=e&&e.forceBase64;this.supportsBinary=lr&&!t,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(e++,this.once("pollComplete",(function(){--e||t()}))),this.writable||(e++,this.once("drain",(function(){--e||t()})))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const r=e.split(_t),n=[];for(let e=0;e<r.length;e++){const s=Lt(r[e],t);if(n.push(s),"error"===s.type)break}return n})(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const r=e.length,n=new Array(r);let s=0;e.forEach(((e,i)=>{It(e,!1,(e=>{n[i]=e,++s===r&&t(n.join(_t))}))}))})(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=ir()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new ur(this.uri(),e)}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}},yr=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,vr=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function br(e){if(e.length>2e3)throw"URI too long";const t=e,r=e.indexOf("["),n=e.indexOf("]");-1!=r&&-1!=n&&(e=e.substring(0,r)+e.substring(r,n).replace(/:/g,";")+e.substring(n,e.length));let s=yr.exec(e||""),i={},o=14;for(;o--;)i[vr[o]]=s[o]||"";return-1!=r&&-1!=n&&(i.source=t,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=function(e,t){const r=t.replace(/\/{2,9}/g,"/").split("/");return"/"!=t.slice(0,1)&&0!==t.length||r.splice(0,1),"/"==t.slice(-1)&&r.splice(r.length-1,1),r}(0,i.path),i.queryKey=function(e,t){const r={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,n){t&&(r[t]=n)})),r}(0,i.query),i}class Sr extends Vt{constructor(e,t={}){super(),this.binaryType="arraybuffer",this.writeBuffer=[],e&&"object"==typeof e&&(t=e,e=null),e?(e=br(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=br(t.host).host),Jt(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},r=e.split("&");for(let e=0,n=r.length;e<n;e++){let n=r[e].split("=");t[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return t}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new fr[e](r)}open(){let e;if(this.opts.rememberUpgrade&&Sr.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(e=>this.onClose("transport close",e)))}probe(e){let t=this.createTransport(e),r=!1;Sr.priorWebsocketSuccess=!1;const n=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",(e=>{if(!r)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Sr.priorWebsocketSuccess="websocket"===t.name,this.transport.pause((()=>{r||"closed"!==this.readyState&&(h(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}))}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}})))};function s(){r||(r=!0,h(),t.close(),t=null)}const i=e=>{const r=new Error("probe error: "+e);r.transport=t.name,s(),this.emitReserved("upgradeError",r)};function o(){i("transport closed")}function a(){i("socket closed")}function c(e){t&&e.name!==t.name&&s()}const h=()=>{t.removeListener("open",n),t.removeListener("error",i),t.removeListener("close",o),this.off("close",a),this.off("upgrading",c)};t.once("open",n),t.once("error",i),t.once("close",o),this.once("close",a),this.once("upgrading",c),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn((()=>{r||t.open()}),200):t.open()}onOpen(){if(this.readyState="open",Sr.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let r=0;r<this.writeBuffer.length;r++){const n=this.writeBuffer[r].data;if(n&&(e+="string"==typeof(t=n)?function(e){let t=0,r=0;for(let n=0,s=e.length;n<s;n++)t=e.charCodeAt(n),t<128?r+=1:t<2048?r+=2:t<55296||t>=57344?r+=3:(n++,r+=4);return r}(t):Math.ceil(1.33*(t.byteLength||t.size))),r>0&&e>this.maxPayload)return this.writeBuffer.slice(0,r);e+=2}var t;return this.writeBuffer}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof r&&(n=r,r=null),"closing"===this.readyState||"closed"===this.readyState)return;(r=r||{}).compress=!1!==r.compress;const s={type:e,data:t,options:r};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?r():e()})):this.upgrading?r():e()),this}onError(e){Sr.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let r=0;const n=e.length;for(;r<n;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}Sr.protocol=4,Sr.protocol;const wr="function"==typeof ArrayBuffer,xr=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,Cr=Object.prototype.toString,Er="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Cr.call(Blob),Ar="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===Cr.call(File);function Tr(e){return wr&&(e instanceof ArrayBuffer||xr(e))||Er&&e instanceof Blob||Ar&&e instanceof File}function Or(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,r=e.length;t<r;t++)if(Or(e[t]))return!0;return!1}if(Tr(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return Or(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&Or(e[t]))return!0;return!1}function Nr(e){const t=[],r=e.data,n=e;return n.data=Pr(r,t),n.attachments=t.length,{packet:n,buffers:t}}function Pr(e,t){if(!e)return e;if(Tr(e)){const r={_placeholder:!0,num:t.length};return t.push(e),r}if(Array.isArray(e)){const r=new Array(e.length);for(let n=0;n<e.length;n++)r[n]=Pr(e[n],t);return r}if("object"==typeof e&&!(e instanceof Date)){const r={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=Pr(e[n],t));return r}return e}function Rr(e,t){return e.data=Ir(e.data,t),delete e.attachments,e}function Ir(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let r=0;r<e.length;r++)e[r]=Ir(e[r],t);else if("object"==typeof e)for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(e[r]=Ir(e[r],t));return e}const Fr=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],kr=5;var Dr;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(Dr||(Dr={}));class Mr{constructor(e){this.replacer=e}encode(e){return e.type!==Dr.EVENT&&e.type!==Dr.ACK||!Or(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===Dr.EVENT?Dr.BINARY_EVENT:Dr.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==Dr.BINARY_EVENT&&e.type!==Dr.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=Nr(e),r=this.encodeAsString(t.packet),n=t.buffers;return n.unshift(r),n}}function qr(e){return"[object Object]"===Object.prototype.toString.call(e)}class Lr extends Vt{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===Dr.BINARY_EVENT;r||t.type===Dr.BINARY_ACK?(t.type=r?Dr.EVENT:Dr.ACK,this.reconstructor=new Br(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!Tr(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(void 0===Dr[r.type])throw new Error("unknown packet type "+r.type);if(r.type===Dr.BINARY_EVENT||r.type===Dr.BINARY_ACK){const n=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const s=e.substring(n,t);if(s!=Number(s)||"-"!==e.charAt(t))throw new Error("Illegal attachments");r.attachments=Number(s)}if("/"===e.charAt(t+1)){const n=t+1;for(;++t&&","!==e.charAt(t)&&t!==e.length;);r.nsp=e.substring(n,t)}else r.nsp="/";const n=e.charAt(t+1);if(""!==n&&Number(n)==n){const n=t+1;for(;++t;){const r=e.charAt(t);if(null==r||Number(r)!=r){--t;break}if(t===e.length)break}r.id=Number(e.substring(n,t+1))}if(e.charAt(++t)){const n=this.tryParse(e.substr(t));if(!Lr.isPayloadValid(r.type,n))throw new Error("invalid payload");r.data=n}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}static isPayloadValid(e,t){switch(e){case Dr.CONNECT:return qr(t);case Dr.DISCONNECT:return void 0===t;case Dr.CONNECT_ERROR:return"string"==typeof t||qr(t);case Dr.EVENT:case Dr.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===Fr.indexOf(t[0]));case Dr.ACK:case Dr.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Br{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=Rr(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function jr(e,t,r){return e.on(t,r),function(){e.off(t,r)}}const _r=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Hr extends Vt{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[jr(e,"open",this.onopen.bind(this)),jr(e,"packet",this.onpacket.bind(this)),jr(e,"error",this.onerror.bind(this)),jr(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(_r.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const r={type:Dr.EVENT,data:t,options:{}};if(r.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const e=this.ids++,n=t.pop();this._registerAckCallback(e,n),r.id=e}const n=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!n||!this.connected)||(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,t){var r;const n=null!==(r=this.flags.timeout)&&void 0!==r?r:this._opts.ackTimeout;if(void 0===n)return void(this.acks[e]=t);const s=this.io.setTimeoutFn((()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))}),n);this.acks[e]=(...e)=>{this.io.clearTimeoutFn(s),t.apply(this,[null,...e])}}emitWithAck(e,...t){const r=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise(((n,s)=>{t.push(((e,t)=>r?e?s(e):n(t):n(e))),this.emit(e,...t)}))}_addToQueue(e){let t;"function"==typeof e[e.length-1]&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push(((e,...n)=>{if(r===this._queue[0])return null!==e?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(e)):(this._queue.shift(),t&&t(null,...n)),r.pending=!1,this._drainQueue()})),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth((e=>{this._sendConnectPacket(e)})):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:Dr.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Dr.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Dr.EVENT:case Dr.BINARY_EVENT:this.onevent(e);break;case Dr.ACK:case Dr.BINARY_ACK:this.onack(e);break;case Dr.DISCONNECT:this.ondisconnect();break;case Dr.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...n){r||(r=!0,t.packet({type:Dr.ACK,id:e,data:n}))}}onack(e){const t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((e=>this.emitEvent(e))),this.receiveBuffer=[],this.sendBuffer.forEach((e=>{this.notifyOutgoingListeners(e),this.packet(e)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((e=>e())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Dr.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function Ur(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Ur.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},Ur.prototype.reset=function(){this.attempts=0},Ur.prototype.setMin=function(e){this.ms=e},Ur.prototype.setMax=function(e){this.max=e},Ur.prototype.setJitter=function(e){this.jitter=e};class zr extends Vt{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,Jt(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(r=t.randomizationFactor)&&void 0!==r?r:.5),this.backoff=new Ur({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const s=t.parser||n;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Sr(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const n=jr(t,"open",(function(){r.onopen(),e&&e()})),s=t=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},i=jr(t,"error",s);if(!1!==this._timeout){const e=this._timeout,r=this.setTimeoutFn((()=>{n(),s(new Error("timeout")),t.close()}),e);this.opts.autoUnref&&r.unref(),this.subs.push((()=>{this.clearTimeoutFn(r)}))}return this.subs.push(n),this.subs.push(i),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(jr(e,"ping",this.onping.bind(this)),jr(e,"data",this.ondata.bind(this)),jr(e,"error",this.onerror.bind(this)),jr(e,"close",this.onclose.bind(this)),jr(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(e){this.onclose("parse error",e)}}ondecoded(e){pr((()=>{this.emitReserved("packet",e)}),this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new Hr(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const e of t)if(this.nsps[e].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach((e=>e())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn((()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()})))}),t);this.opts.autoUnref&&r.unref(),this.subs.push((()=>{this.clearTimeoutFn(r)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Vr={};function Gr(e,t){"object"==typeof e&&(t=e,e=void 0);const r=function(e,t="",r){let n=e;r=r||"undefined"!=typeof location&&location,null==e&&(e=r.protocol+"//"+r.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?r.protocol+e:r.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==r?r.protocol+"//"+e:"https://"+e),n=br(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const s=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+s+":"+n.port+t,n.href=n.protocol+"://"+s+(r&&r.port===n.port?"":":"+n.port),n}(e,(t=t||{}).path||"/socket.io"),n=r.source,s=r.id,i=r.path,o=Vr[s]&&i in Vr[s].nsps;let a;return t.forceNew||t["force new connection"]||!1===t.multiplex||o?a=new zr(n,t):(Vr[s]||(Vr[s]=new zr(n,t)),a=Vr[s]),r.query&&!t.query&&(t.query=r.queryKey),a.socket(r.path,t)}Object.assign(Gr,{Manager:zr,Socket:Hr,io:Gr,connect:Gr});class Kr{constructor(){this.completed=!1,this.p=new Promise(((e,t)=>{this.res=e,this.rej=t}))}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){void 0!==this.res&&(this.completed=!0,this.res(e))}reject(e){void 0!==this.rej&&(this.completed=!0,this.rej(e))}}Symbol.toStringTag;class Wr{constructor(e,t,r,n,s,i){this.to=t,this.payloadSize=r,this.logger=n,this.requestCallback=s,this.responseCallback=i,this.results=new Map,this.workingState="working",this.requestsInFlight=0,this.endEvent=new Kr,this.requests=0,this.latestRequested=e,this.nextToDeliver=e,this.knewTo=void 0!==t}get working(){return"working"===this.workingState}get canceled(){return"canceled"===this.workingState}cancel(){this.working&&(this.workingState="canceled",this.endEvent.resolve())}async run(e){(0,rt.h)(e>0,258),(0,rt.h)(this.working,259);let t=e;for(;t>0;)t--,this.addRequest();return this.dispatch(),this.endEvent.promise}done(){(0,rt.h)(void 0!==this.to,260),(0,rt.h)(this.nextToDeliver>=this.to,261),this.working&&(this.workingState="done",this.endEvent.resolve())}fail(e){this.working&&(this.workingState="done",this.endEvent.reject(e))}dispatch(){for(;this.working;){const e=this.results.get(this.nextToDeliver);if(void 0===e)break;this.results.delete(this.nextToDeliver),(0,rt.h)(e.length<=this.payloadSize,473),this.nextToDeliver+=e.length,this.responseCallback(e)}this.working&&(0===this.requestsInFlight?((0,rt.h)(0===this.results.size,263),this.done()):void 0!==this.to&&this.nextToDeliver>=this.to&&((0,rt.h)(!this.knewTo,264),this.done()))}getNextChunk(){if(!this.working)return;const e=this.latestRequested;return void 0!==this.to&&this.to<=e?void 0:(this.latestRequested+=this.payloadSize,void 0!==this.to&&(this.latestRequested=Math.min(this.to,this.latestRequested)),(0,rt.h)(e<this.latestRequested,265),{from:e,to:this.latestRequested})}addRequest(){const e=this.getNextChunk();void 0!==e&&this.addRequestCore(e.from,e.to).catch(this.fail.bind(this))}async addRequestCore(e,t){(0,rt.h)(this.working,266);let r=e,n=t;for(this.requestsInFlight++;this.working;){const e=n-r;(0,rt.h)(e>0,267),void 0!==this.to&&((0,rt.h)(r<this.to,268),(0,rt.h)(n<=this.to,269)),this.requests++;const t=this.requestCallback(this.requests,r,n,void 0!==this.to,{});this.dispatch();const{payload:s,cancel:i,partial:o}=await t;if(i&&this.cancel(),void 0!==this.to&&r>=this.to){(0,rt.h)(!this.knewTo,270),0!==s.length&&this.logger.sendErrorEvent({eventName:"ParallelRequests_GotExtra",from:r,to:n,end:this.to,length:s.length});break}if(this.working){const t=r,i=s.length;let a=e<=i;if(0!==i){e<i&&this.logger.sendTelemetryEvent({eventName:"ParallelRequests_Over",from:r,to:n,length:i});const t=s.splice(0,e);this.results.set(r,t),r+=t.length}else(0,rt.h)(!o,271),(0,rt.h)(!this.knewTo,272);if(!o&&!a){if(!this.knewTo){(void 0===this.to||this.to>r)&&(this.to=r);break}this.logger.sendPerformanceEvent({eventName:"ParallelRequests_Partial",from:t,to:n,length:i})}if(n===this.latestRequested&&(0!==s.length&&(this.results.set(r,s),r+=s.length),this.latestRequested=r,a=!0),a){const e=this.getNextChunk();if(void 0===e)break;r=e.from,n=e.to}}}this.requestsInFlight--,this.dispatch()}}class $r{constructor(){this.queue=[],this.done=!1}pushValue(e){this.pushCore(Promise.resolve({done:!1,value:e}))}pushError(e){this.pushCore(Promise.reject(e)),this.done=!0}pushDone(){this.pushCore(Promise.resolve({done:!0})),this.done=!0}pushCore(e){(0,rt.h)(!this.done,274),this.deferred?((0,rt.h)(0===this.queue.length,275),this.deferred.resolve(e),this.deferred=void 0):this.queue.push(e)}async read(){(0,rt.h)(void 0===this.deferred,276);const e=this.queue.shift();return void 0!==e?e:((0,rt.h)(!this.done,277),this.deferred=new Kr,this.deferred.promise)}}const Jr={read:async()=>({done:!0})};class Xr{send(e){}sendTelemetryEvent(e,t){}sendErrorEvent(e,t){}sendPerformanceEvent(e,t){}}class Qr{constructor(e,t,r,n){this.tenantId=e,this.id=t,this.deltaStorageService=r,this.documentStorageService=n,this.logtailSha=this.documentStorageService.logTailSha}fetchMessages(e,t,r,n,s){return n?Jr:function(e,t,r,n,s,i,o,a){let c,h=0,l=0;const d=new $r,p={fromTotal:r,toTotal:n},g=u.Xr.start(i,Object.assign(Object.assign({eventName:"GetDeltas"},p),{reason:a})),m=new Wr(r,n,s,i,(async(t,r,n,s,c)=>(h++,async function(e,t,r,n,s,i){let o,a=0;const c=[];for(;!0!==(null==s?void 0:s.aborted);){a++;let s=Math.min(1e4,100*Math.pow(2,a));const h=T.now();try{const n=e(Object.assign(Object.assign({},t),{retry:a})),{messages:s,partialResult:i}=await n;if(c.push(...s),0!==s.length||!r)return{payload:c,cancel:!1,partial:i};if(void 0===o)o=T.now();else if(T.now()-o>3e4)throw(0,P.jx)("Failed to retrieve ops from storage (Too Many Retries)",{canRetry:!1},Object.assign({retry:a,driverVersion:R},t))}catch(e){const r=(0,P.ms)(e);o=void 0;const c=(0,P.ZZ)(e);if(qe(n,Object.assign(Object.assign({eventName:"GetDeltas_Error"},t),{retry:a,duration:T.now()-h,retryAfter:c,reason:i}),e),!r)throw e;void 0!==c&&c>=0&&(s=c)}await Le(s)}return{partial:!1,cancel:!0,payload:[]}}((async t=>e(r,n,t)),Object.assign(Object.assign({request:t,from:r,to:n},p),c),s,i,o,a))),(e=>{void 0===c?(0,rt.h)(e[0].sequenceNumber===r,621):(0,rt.h)(e[0].sequenceNumber===c+1,622),c=e[e.length-1].sequenceNumber,(0,rt.h)(c-e[0].sequenceNumber+1===e.length,623),l+=e.length,d.pushValue(e)})),f=e=>{m.cancel()};return void 0!==o&&o.addEventListener("abort",f),m.run(t).finally((()=>{void 0!==o&&o.removeEventListener("abort",f)})).then((()=>{const e={lastFetch:c,length:l,requests:h};m.canceled?g.cancel(Object.assign(Object.assign({},e),{error:"ops request cancelled by client"})):((0,rt.h)(void 0===n||void 0!==c&&c>=n-1,624),g.end(e)),d.pushDone()})).catch((e=>{g.cancel({lastFetch:c,length:l,requests:h},e),d.pushError(e)})),d}(this.getCore.bind(this),1,e,t,2e3,new Xr,r,s)}async getCore(e,t){const r=this.logtailSha?await(0,M.g)(this.documentStorageService,this.logtailSha):[];if(this.logtailSha=void 0,r.length>0){const t=r.filter((t=>t.sequenceNumber>=e));if(t.length>0)return{messages:t,partialResult:!0}}return this.deltaStorageService.get(this.tenantId,this.id,e,t)}}class Zr{constructor(e,t,r,n=(async()=>this.restWrapper),s=(()=>this.url)){this.url=e,this.restWrapper=t,this.logger=r,this.getRestWrapper=n,this.getDeltaStorageUrl=s}async get(e,t,r,n){return{messages:await u.Xr.timedExecAsync(this.logger,{eventName:"getDeltas",from:r,to:n},(async e=>{const t=await this.getRestWrapper(),s=this.getDeltaStorageUrl(),i=await t.get(s,{from:r-1,to:n});return e.end({count:i.length}),i})),partialResult:!1}}}var Yr=r(6144);class en extends Yr.P{constructor(){super(...arguments),this.prefetchCache=new Map,this.prefetchEnabled=!0}get policies(){const e=this.internalStorageService.policies;if(e)return Object.assign(Object.assign({},e),{caching:tt.NoCaching})}async getSnapshotTree(e){const t=this.internalStorageService.getSnapshotTree(e);return this.prefetchEnabled&&t.then((e=>{null!=e&&this.prefetchTree(e)})),t}async readBlob(e){return this.cachedRead(e)}stopPrefetch(){this.prefetchEnabled=!1,this.prefetchCache.clear()}async cachedRead(e){if(this.prefetchEnabled){const t=this.prefetchCache.get(e);if(void 0!==t)return t;const r=this.internalStorageService.readBlob(e);return this.prefetchCache.set(e,r.catch((t=>{throw(0,P.ms)(t)&&this.prefetchCache.delete(e),t}))),r}return this.internalStorageService.readBlob(e)}prefetchTree(e){const t=[];this.prefetchTreeCore(e,t);for(const e of t)this.cachedRead(e)}prefetchTreeCore(e,t){for(const r of Object.keys(e.blobs)){const n=e.blobs[r];r.startsWith(".")||"header"===r||r.startsWith("quorum")?null!==n&&this.cachedRead(n):r.startsWith("deltas")||null!==n&&t.push(n)}for(const r of Object.keys(e.trees))this.prefetchTreeCore(e.trees[r],t)}}function tn(e,t){switch(t){case"base64":return Ce.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}const rn=(e,t)=>sn.from(e,t).buffer;function nn(e){const t=e;return e instanceof ArrayBuffer||"object"==typeof t&&null!==t&&"number"==typeof t.byteLength&&"function"==typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}class sn extends Uint8Array{toString(e){return tn(this,e)}static from(e,t,r){if("string"==typeof e)return sn.fromString(e,t);if(null!==e&&"object"==typeof e&&nn(e.buffer))return et(0===e.byteOffset,0),et(e.byteLength===e.buffer.byteLength,1),sn.fromArrayBuffer(e.buffer,t,r);if(nn(e))return sn.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const n=null!=t?t:0,s=null!=r?r:e.byteLength-n;if(n<0||n>e.byteLength||s<0||s+n>e.byteLength)throw new RangeError;return new sn(e,n,s)}static fromString(e,t){switch(t){case"base64":{const t=this.sanitizeBase64(e),r=Ce.toByteArray(t);return new sn(r.buffer)}case"utf8":case"utf-8":case void 0:{const t=(new TextEncoder).encode(e);return new sn(t.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!=0&&(t+=["","===","==","="][t.length%4]),t}}var on,an=r(7384);class cn{constructor(e){this.props=e,this.attachmentCounter=0,this.summaryTree={}}get summary(){var e;return{type:x.Tree,tree:Object.assign({},this.summaryTree),unreferenced:null===(e=this.props)||void 0===e?void 0:e.unreferenced}}addBlob(e,t){this.summaryTree[e]={type:x.Blob,content:t}}addHandle(e,t,r){this.summaryTree[e]={type:x.Handle,handleType:t,handle:r}}addTree(e,t){this.summaryTree[e]=t}addAttachment(e){this.summaryTree[this.attachmentCounter++]={id:e,type:x.Attachment}}}function hn(e,t){const r=new cn({unreferenced:e.unreferenced});for(const[n,s]of Object.entries(e.blobs)){const e=t.get(s);(0,rt.h)(void 0!==e,733),r.addBlob(n,an.pv.from(e).toString("utf-8"))}for(const[n,s]of Object.entries(e.trees)){const e=hn(s,t);r.addTree(n,e)}return r.summary}function ln(e,t="Unreachable Case"){throw new Error(t)}!function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(on||(on={}));const un=(...e)=>e.map((e=>e.replace(/^\//,"").replace(/\/$/,""))).filter((e=>!!e)).join("/");function dn(e,t,r="",n=""){const s={type:"tree",entries:[]},i=Object.keys(t.tree);for(const o of i){const i=t.tree[o];let a,c,h;const l=un(""===r?n:r,o);switch(i.type){case on.Tree:c=dn(e,i,l,n),h=i.unreferenced||void 0;break;case on.Blob:c="string"==typeof i.content?{type:"blob",content:i.content,encoding:"utf-8"}:{type:"blob",content:it(i.content,"base64"),encoding:"base64"};break;case on.Handle:if(i.embedded)a=i.handle;else{if(!e)throw Error("Parent summary does not exist to reference by handle.");a=un(e,n,i.handle)}break;case on.Attachment:a=i.id;break;default:ln(0,`Unknown type: ${i.type}`)}const u={path:encodeURIComponent(o),type:(0,Ct.FE)(i)};let d;if(c)st(void 0===a,173),d=Object.assign({value:c,unreferenced:h},u);else{if(!a)throw new Error(`Invalid tree entry for ${i.type}`);d=Object.assign(Object.assign({},u),{id:a})}s.entries.push(d)}return s}function pn(e,t=".app"){var r;const n=new Map;e.blobs&&e.blobs.forEach((e=>{var t,r,s;n.set(e.id,(r=e.content,s=null!==(t=e.encoding)&&void 0!==t?t:"utf-8",at.from(r,s).buffer))}));const s=null===(r=e.trees)||void 0===r?void 0:r[0],i=null==s?void 0:s.sequenceNumber,o=function(e,t){const r={},n={id:e.id,blobs:{},trees:{}};r[""]=n;for(const n of e.entries){const e=n.path.replace(new RegExp(`^${t}/`),""),s=e.lastIndexOf("/"),i=e.slice(0,Math.max(0,s)),o=e.slice(s+1),a=r[i];if("tree"===n.type){const t={blobs:{},trees:{},unreferenced:n.unreferenced};a.trees[decodeURIComponent(o)]=t,r[e]=t}else{if("blob"!==n.type)throw new Error("Unknown entry type!!");a.blobs[decodeURIComponent(o)]=n.id}}return n}(s,t);return{blobs:n,snapshotTree:o,sequenceNumber:i}}class gn{constructor(e){this.manager=e}async writeSummaryTree(e,t,r,n){const s=await this.writeSummaryTreeCore(t,e,r,null!=n?n:0);if(!s)throw new Error("Failed to write summary tree");return s}async writeSummaryTreeCore(e,t,r,n){const s={entries:dn(e,t,"","channel"===r?".app":"").entries,message:void 0,sequenceNumber:n,type:r};return this.manager.createSummary(s).then((e=>e.id))}}class mn{constructor(){this.cache=new Map}async get(e){return this.cache.get(e)}async put(e,t){this.cache.set(e,t)}}const fn="latest";class yn{constructor(e,t,r,n={},s,i=new mn,o=new mn,a,c=(async e=>e&&void 0!==this.noCacheGitManager?this.noCacheGitManager:this.manager)){this.id=e,this.manager=t,this.logger=r,this.policies=n,this.driverPolicies=s,this.blobCache=i,this.snapshotTreeCache=o,this.noCacheGitManager=a,this.getStorageManager=c,this.firstVersionsCall=!0}get repositoryUrl(){return""}async getSummaryUploadManager(){const e=await this.getStorageManager();return new gn(e)}async getVersions(e,t){var r;if(e!==this.id&&null!==e)return[{id:e,treeId:void 0}];if(this.firstVersionsCall&&1===t){this.firstVersionsCall=!1;const{id:e,snapshotTree:t}=(null===(r=this.driverPolicies)||void 0===r?void 0:r.enableDiscovery)?await this.fetchAndCacheSnapshotTree(fn,!0):await this.fetchAndCacheSnapshotTree(fn,!1);return[{id:e,treeId:t.id}]}const n=e||this.id;return(await u.Xr.timedExecAsync(this.logger,{eventName:"getVersions",versionId:n,count:t},(async()=>(await this.getStorageManager()).getCommits(n,t)))).map((e=>({date:e.commit.author.date,id:e.sha,treeId:e.commit.tree.sha})))}async getSnapshotTree(e){let t=e;if(!t){const e=await this.getVersions(this.id,1);if(0===e.length)return null;t=e[0]}return(await this.fetchAndCacheSnapshotTree(t.id)).snapshotTree}async readBlob(e){const t=await this.blobCache.get(this.getCacheKey(e));if(void 0!==t)return t;const r=await u.Xr.timedExecAsync(this.logger,{eventName:"readBlob",blobId:e},(async t=>{const r=await this.getStorageManager(),n=await r.getBlob(e);return t.end({size:n.size}),n})),n=rn(r.content,r.encoding);return await this.blobCache.put(this.getCacheKey(r.sha),n),n}async uploadSummaryWithContext(e,t){return await u.Xr.timedExecAsync(this.logger,{eventName:"uploadSummaryWithContext"},(async()=>{var r;return(await this.getSummaryUploadManager()).writeSummaryTree(e,null!==(r=t.ackHandle)&&void 0!==r?r:"","channel")}))}async downloadSummary(e){const t=await u.Xr.timedExecAsync(this.logger,{eventName:"getWholeFlatSummary",treeId:e.handle},(async t=>{var r;const n=await this.getStorageManager(),s=await n.getSummary(e.handle);return t.end({size:null===(r=s.trees[0])||void 0===r?void 0:r.entries.length}),s})),{blobs:r,snapshotTree:n}=pn(t,"");return hn(n,r)}async createBlob(e){const t=new Uint8Array(e);return u.Xr.timedExecAsync(this.logger,{eventName:"createBlob",size:t.length},(async e=>{const r=await this.getStorageManager(),n=await r.createBlob(tn(t,"base64"),"base64").then((e=>({id:e.sha,url:e.url})));return e.end({blobId:n.id}),n}))}async fetchAndCacheSnapshotTree(e,t){const r=await this.snapshotTreeCache.get(this.getCacheKey(e));if(void 0!==r)return{id:r.id,snapshotTree:r.snapshotTree};const n=await u.Xr.timedExecAsync(this.logger,{eventName:"getWholeFlatSummary",treeId:e},(async r=>{var n;const s=await this.getStorageManager(t),i=await s.getSummary(e);return r.end({size:null===(n=i.trees[0])||void 0===n?void 0:n.entries.length}),i})),s=pn(n),i=n.id,o=s.snapshotTree.id;et(void 0!==o,629);const a={id:i,snapshotTree:s.snapshotTree},c=[this.snapshotTreeCache.put(this.getCacheKey(o),a),this.initBlobCache(s.blobs)];return o!==e&&c.push(this.snapshotTreeCache.put(this.getCacheKey(e),a)),await Promise.all(c),a}async initBlobCache(e){const t=[];e.forEach(((e,r)=>{const n=this.getCacheKey(r);t.push(this.blobCache.put(n,e))})),await Promise.all(t)}getCacheKey(e){return`${this.id}:${e}`}}class vn{constructor(e,t,r){this.manager=e,this.blobsShaCache=t,this.getPreviousFullSnapshot=r}async writeSummaryTree(e,t,r,n){const s=await this.getPreviousFullSnapshot(t);return this.writeSummaryTreeCore(e,null!=s?s:void 0)}async writeSummaryTreeCore(e,t){const r=await Promise.all(Object.keys(e.tree).map((async r=>{const n=e.tree[r],s=await this.writeSummaryTreeObject(n,t);return{mode:(0,Ct.ZO)(n),path:encodeURIComponent(r),sha:s,type:(0,Ct.FE)(n)}})));return(await this.manager.createGitTree({tree:r})).sha}async writeSummaryTreeObject(e,t){switch(e.type){case on.Blob:return this.writeSummaryBlob(e.content);case on.Handle:if(void 0===t)throw Error("Parent summary does not exist to reference by handle.");return this.getIdFromPath(e.handleType,e.handle,t);case on.Tree:return this.writeSummaryTreeCore(e,t);case on.Attachment:return e.id;default:ln(0,`Unknown type: ${e.type}`)}}async writeSummaryBlob(e){const{parsedContent:t,encoding:n}="string"==typeof e?{parsedContent:e,encoding:"utf-8"}:{parsedContent:it(e,"base64"),encoding:"base64"},s=await async function(e){const t=`blob ${e.byteLength.toString()}${String.fromCharCode(0)}`;return async function(e,t="SHA-1",n="hex"){if(void 0===crypto.subtle)return r.e(564).then(r.bind(r,6715)).then((async r=>r.hashFile(e,t,n)));const s=await async function(e,t){const r=await crypto.subtle.digest(t,e);return new Uint8Array(r)}(e,t);return function(e,t){switch(t){case"hex":return Array.prototype.map.call(e,(e=>e.toString(16).padStart(2,"0"))).join("");case"base64":return Ce.fromByteArray(e)}}(s,n)}(at.from(t+e.toString()))}(at.from(t,n));return this.blobsShaCache.has(s)||(this.blobsShaCache.set(s,""),st(s===(await this.manager.createBlob(t,n)).sha,182)),s}getIdFromPath(e,t,r){const n=t.split("/").map((e=>decodeURIComponent(e)));return""===n[0]&&n.shift(),0===n.length?r.id:this.getIdFromPathCore(e,n,r)}getIdFromPathCore(e,t,r){var n;st(t.length>0,179);const s=t[0];if(1===t.length)switch(e){case on.Blob:{const e=r.blobs[s];return st(!!e,180),e}case on.Tree:{const e=null===(n=r.trees[s])||void 0===n?void 0:n.id;return st(!!e,181),e}default:throw Error(`Unexpected handle summary object type: "${e}".`)}return this.getIdFromPathCore(e,t.slice(1),r.trees[s])}}class bn{constructor(e,t){this.internalGitManager=e,this.logger=t}async getHeader(e,t){return this.runWithRetry((async()=>this.internalGitManager.getHeader(e,t)),"gitManager_getHeader")}async getFullTree(e){return this.runWithRetry((async()=>this.internalGitManager.getFullTree(e)),"gitManager_getFullTree")}async getCommit(e){return this.runWithRetry((async()=>this.internalGitManager.getCommit(e)),"gitManager_getCommit")}async getCommits(e,t){return this.runWithRetry((async()=>this.internalGitManager.getCommits(e,t)),"gitManager_getCommits")}async getTree(e,t){return this.runWithRetry((async()=>this.internalGitManager.getTree(e,t)),"gitManager_getTree")}async getBlob(e){return this.runWithRetry((async()=>this.internalGitManager.getBlob(e)),"gitManager_getBlob")}getRawUrl(e){return this.internalGitManager.getRawUrl(e)}async getContent(e,t){return this.runWithRetry((async()=>this.internalGitManager.getContent(e,t)),"gitManager_getContent")}async createBlob(e,t){return this.runWithRetry((async()=>this.internalGitManager.createBlob(e,t)),"gitManager_createBlob")}async createGitTree(e){return this.runWithRetry((async()=>this.internalGitManager.createGitTree(e)),"gitManager_createGitTree")}async createTree(e){return this.runWithRetry((async()=>this.internalGitManager.createTree(e)),"gitManager_createTree")}async createCommit(e){return this.runWithRetry((async()=>this.internalGitManager.createCommit(e)),"gitManager_createCommit")}async getRef(e){return this.runWithRetry((async()=>this.internalGitManager.getRef(e)),"gitManager_getRef")}async createRef(e,t){return this.runWithRetry((async()=>this.internalGitManager.createRef(e,t)),"gitManager_createRef")}async upsertRef(e,t){return this.runWithRetry((async()=>this.internalGitManager.upsertRef(e,t)),"gitManager_upsertRef")}async write(e,t,r,n){return this.runWithRetry((async()=>this.internalGitManager.write(e,t,r,n)),"gitManager_write")}async createSummary(e){return this.runWithRetry((async()=>this.internalGitManager.createSummary(e)),"gitManager_createSummary")}async deleteSummary(e){return this.runWithRetry((async()=>this.internalGitManager.deleteSummary(e)),"gitManager_deleteSummary")}async getSummary(e){return this.runWithRetry((async()=>this.internalGitManager.getSummary(e)),"gitManager_getSummary")}async runWithRetry(e,t){return I(e,t,this.logger,{})}}const Sn="undefined"==typeof window;class wn{constructor(e,t,r,n={},s,i,o,a=(async()=>this.manager)){this.id=e,this.manager=t,this.logger=r,this.policies=n,this.getStorageManager=a,this.blobsShaCache=new Map,(!0===(null==s?void 0:s.enableRestLess)||Sn)&&(this.blobCache=null!=i?i:new mn,this.snapshotTreeCache=null!=o?o:new mn)}get repositoryUrl(){return""}async getSummaryUploadManager(){const e=await this.getStorageManager();return new vn(new bn(e,this.logger),this.blobsShaCache,this.getPreviousFullSnapshot.bind(this))}async getVersions(e,t){const r=e||this.id;return(await u.Xr.timedExecAsync(this.logger,{eventName:"getVersions",versionId:r,count:t},(async()=>(await this.getStorageManager()).getCommits(r,t)))).map((e=>({date:e.commit.author.date,id:e.sha,treeId:e.commit.tree.sha})))}async getSnapshotTree(e){var t,r;let n=e;if(!n){const e=await this.getVersions(this.id,1);if(0===e.length)return null;n=e[0]}const s=await(null===(t=this.snapshotTreeCache)||void 0===t?void 0:t.get(this.getCacheKey(n.treeId)));if(s)return s.snapshotTree;const i=await u.Xr.timedExecAsync(this.logger,{eventName:"getSnapshotTree",treeId:n.treeId},(async e=>{const t=await this.getStorageManager(),r=await t.getTree(n.treeId);return e.end({size:r.tree.length}),r})),o=(0,Ct.eB)(i,this.blobsShaCache,!0);return await(null===(r=this.snapshotTreeCache)||void 0===r?void 0:r.put(this.getCacheKey(o.id),{id:n.id,snapshotTree:o})),o}async readBlob(e){var t,r;const n=await(null===(t=this.blobCache)||void 0===t?void 0:t.get(this.getCacheKey(e)));if(n)return n;const s=await u.Xr.timedExecAsync(this.logger,{eventName:"readBlob",blobId:e},(async t=>{const r=await this.getStorageManager(),n=await r.getBlob(e);return t.end({size:n.size}),n}));this.blobsShaCache.set(s.sha,"");const i=rn(s.content,s.encoding);return await(null===(r=this.blobCache)||void 0===r?void 0:r.put(this.getCacheKey(s.sha),i)),i}async uploadSummaryWithContext(e,t){return await u.Xr.timedExecAsync(this.logger,{eventName:"uploadSummaryWithContext"},(async()=>{var r;return(await this.getSummaryUploadManager()).writeSummaryTree(e,null!==(r=t.ackHandle)&&void 0!==r?r:"","channel")}))}async downloadSummary(e){throw new Error("NOT IMPLEMENTED!")}async createBlob(e){const t=new Uint8Array(e);return u.Xr.timedExecAsync(this.logger,{eventName:"createBlob",size:t.length},(async e=>{const r=await this.getStorageManager(),n=await r.createBlob(tn(t,"base64"),"base64").then((e=>({id:e.sha,url:e.url})));return e.end({blobId:n.id}),n}))}async getPreviousFullSnapshot(e){return e?this.getVersions(e,1).then((async e=>(this.blobsShaCache.clear(),this.getSnapshotTree(e[0])))):void 0}getCacheKey(e){return`${this.id}:${e}`}}class xn extends Yr.P{constructor(e,t,r,n={},s,i,o,a,c){super(xn.loadInternalDocumentStorageService(e,t,r,n,s,i,o,a,c)),this.id=e,this.manager=t,this.noCacheGitManager=a,this._logTailSha=void 0}get logTailSha(){return this._logTailSha}static loadInternalDocumentStorageService(e,t,r,n,s,i,o,a,c){const h=(null==s?void 0:s.enableWholeSummaryUpload)?new yn(e,t,r,n,s,i,o,a,c):new wn(e,t,r,n,s,i,o,c);return(null==s?void 0:s.enableWholeSummaryUpload)||n.caching!==tt.Prefetch?h:new en(h)}async getSnapshotTree(e){const t=await this.internalStorageService.getSnapshotTree(e);return null!==t&&(this._logTailSha=".logTail"in t.trees?t.trees[".logTail"].blobs.logTail:void 0),t}}function Cn(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}var En;!function(e){e.DocRead="doc:read",e.DocWrite="doc:write",e.SummaryWrite="summary:write"}(En||(En={}));const An="1.3.7";class Tn extends Z.M{constructor(e,t,r,n=!1){super(((e,t)=>{r.sendErrorEvent({eventName:"DeltaConnection:EventException",name:e},t)})),this.socket=e,this.documentId=t,this.enableLongPollingDowngrades=n,this.queuedMessages=[],this.queuedSignals=[],this.earlyOpHandlerAttached=!1,this.connectionListeners=new Map,this.trackedListeners=new Map,this._disposed=!1,this.earlyOpHandler=(e,t)=>{this.queuedMessages.push(...t)},this.earlySignalHandler=e=>{this.queuedSignals.push(e)},this.mc=(0,h.rZ)(u.G2.create(r,"DeltaConnection")),this.on("newListener",((e,t)=>{if(Cn(!this.disposed,522),Tn.eventsAlwaysForwarded.includes(e))Cn(this.trackedListeners.has(e),581);else{if(!Tn.eventsToForward.includes(e))throw new Error(`DocumentDeltaConnection: Registering for unknown event: ${e}`);Cn(0!==this.listeners(e).length===this.trackedListeners.has(e),523),this.trackedListeners.has(e)||this.addTrackedListener(e,((...t)=>{this.emit(e,...t)}))}}))}get hasDetails(){return!!this._details}get disposed(){return Cn(this._disposed||this.socket.connected,580),this._disposed}get logger(){return this.mc.logger}get details(){if(!this._details)throw new Error("Internal error: calling method before _details is initialized!");return this._details}get clientId(){return this.details.clientId}get mode(){return this.details.mode}get claims(){return this.details.claims}get existing(){return this.details.existing}get maxMessageSize(){return this.details.serviceConfiguration.maxMessageSize}get version(){return this.details.version}get serviceConfiguration(){return this.details.serviceConfiguration}checkNotClosed(){Cn(!this.disposed,524)}get initialMessages(){return this.checkNotClosed(),Cn(this.earlyOpHandlerAttached,142),Cn(0!==this.listeners("op").length,143),this.removeEarlyOpHandler(),this.queuedMessages.length>0&&(this.details.initialMessages.push(...this.queuedMessages),this.details.initialMessages.sort(((e,t)=>e.sequenceNumber-t.sequenceNumber)),this.queuedMessages.length=0),this.details.initialMessages}get initialSignals(){return this.checkNotClosed(),Cn(0!==this.listeners("signal").length,144),this.removeEarlySignalHandler(),this.queuedSignals.length>0&&(this.details.initialSignals.push(...this.queuedSignals),this.queuedSignals.length=0),this.details.initialSignals}get initialClients(){return this.checkNotClosed(),this.details.initialClients}emitMessages(e,t){this.disposed||this.socket.emit(e,this.clientId,t)}submitCore(e,t){this.emitMessages(e,[t])}submit(e){this.checkNotClosed(),this.submitCore("submitOp",e)}submitSignal(e){this.checkNotClosed(),this.submitCore("submitSignal",[e])}dispose(){this.disposeCore(!1,(0,P.jx)("Client closing delta connection",{canRetry:!0},{driverVersion:An}))}disposeCore(e,t){this._disposed||(this._disposed=!0,this.removeTrackedListeners(),this.disconnect(e,t))}disconnect(e,t){this.socket.disconnect()}async initialize(e,t){this.socket.on("op",this.earlyOpHandler),this.socket.on("signal",this.earlySignalHandler),this.earlyOpHandlerAttached=!0;let r=0;const n=()=>this.socket.io.reconnection(),s=()=>n()?this.socket.io.reconnectionAttempts():0;this._details=await new Promise(((i,o)=>{const a=(e,t)=>{this.disposeCore(e,t),o(t)};this.addConnectionListener("connect_error",(e=>{var t;r++;let i=!1;try{const t=null==e?void 0:e.description;t&&"object"==typeof t&&("TransportError"===e.type&&(i=!0),t.target=void 0)}catch(e){}i&&this.enableLongPollingDowngrades&&"polling"!==(null===(t=this.socket.io.opts.transports)||void 0===t?void 0:t[0])&&(this.socket.io.opts.transports=["polling","websocket"],n()||(this.socket.io.reconnection(!0),this.socket.io.reconnectionAttempts(1))),n()&&r<s()+1||a(!0,this.createErrorObject("connect_error",e))})),this.addConnectionListener("connect_timeout",(()=>{a(!0,this.createErrorObject("connect_timeout"))})),this.addConnectionListener("connect_document_success",(t=>{if(void 0!==e.nonce&&void 0!==t.nonce&&t.nonce!==e.nonce)return;const r=e.mode,n=t.mode;if(t.claims.scopes.includes(En.DocWrite)){if(n!==r)return void a(!1,this.createErrorObject("connect_document_success","Connected in a different mode than was requested",!1))}else if("write"===n)return void a(!1,this.createErrorObject("connect_document_success","Connected in write mode without write permissions",!1));this.checkpointSequenceNumber=t.checkpointSequenceNumber,this.removeConnectionListeners(),i(t)})),this.addTrackedListener("disconnect",(e=>{const t=this.createErrorObject("disconnect",e);this.emit("disconnect",t),a(!0,t)})),this.addTrackedListener("error",(e=>{const t=this.createErrorObject("error",e,"Invalid namespace"!==e);this.emit("error",t),a(!0,t)})),this.addConnectionListener("connect_document_error",(t=>{void 0!==e.nonce&&void 0!==t.nonce&&t.nonce!==e.nonce||a(!1,this.createErrorObject("connect_document_error",t))})),this.socket.emit("connect_document",e),this.socketConnectionTimeout=setTimeout((()=>{a(!1,this.createErrorObject("orderingServiceHandshakeTimeout"))}),t+2e3)})),Cn(!this.disposed,582)}removeEarlyOpHandler(){this.socket.removeListener("op",this.earlyOpHandler),this.earlyOpHandlerAttached=!1}removeEarlySignalHandler(){this.socket.removeListener("signal",this.earlySignalHandler)}addConnectionListener(e,t){Cn(!Tn.eventsAlwaysForwarded.includes(e),583),Cn(!Tn.eventsToForward.includes(e),584),this.socket.on(e,t),Cn(!this.connectionListeners.has(e),525),this.connectionListeners.set(e,t)}addTrackedListener(e,t){this.socket.on(e,t),Cn(!this.trackedListeners.has(e),526),this.trackedListeners.set(e,t)}removeTrackedListeners(){for(const[e,t]of this.trackedListeners.entries())this.socket.off(e,t);this.removeConnectionListeners(),this.removeEarlyOpHandler(),this.removeEarlySignalHandler(),this.trackedListeners.clear()}removeConnectionListeners(){void 0!==this.socketConnectionTimeout&&clearTimeout(this.socketConnectionTimeout);for(const[e,t]of this.connectionListeners.entries())this.socket.off(e,t);this.connectionListeners.clear()}createErrorObject(e,t,r=!0){let n;return n="TransportError"===(null==t?void 0:t.type)?`${void 0!==(null==t?void 0:t.message)?`${t.message}: `:""}${JSON.stringify(t,(0,ee.fd)())}`:function(e){const t={message:"string"==typeof(null==e?void 0:e.message)?e.message:String(e)};if((e=>null!==e&&!Array.isArray(e)&&"object"==typeof e)(e)){const{errorType:r,stack:n,name:s}=e;if("string"==typeof r&&(t.errorType=r),"string"==typeof n){const e="string"==typeof s?s:void 0;t.stack=((e,t)=>{const r=e.split("\n");return r.shift(),void 0!==t&&r.unshift(t),r.join("\n")})(n,e)}}return t}(t).message,(0,P.jx)(`socket.io (${e}): ${n}`,{canRetry:r},{driverVersion:An})}}Tn.eventsToForward=["nack","op","signal","pong"],Tn.eventsAlwaysForwarded=["disconnect","error"];const On="1.3.7";var Nn;function Pn(e,t,r){const n={statusCode:t,driverVersion:On};switch(t){case void 0:return new P.Xp(e,e.startsWith("NetworkError"),n);case 401:case 403:return new P.M_(e,void 0,void 0,n);case 404:const t=Nn.fileNotFoundOrAccessDeniedError;return new P.V2(e,t,n);case 429:return(0,P.jx)(e,{canRetry:!0,retryAfterMs:r},n);case 500:case 502:return new P.Xp(e,!0,n);default:const s={canRetry:void 0!==r,retryAfterMs:r};return(0,P.jx)(e,s,n)}}function Rn(e,t,r){throw Pn(e,t,r)}!function(e){e.fileNotFoundOrAccessDeniedError="fileNotFoundOrAccessDeniedError"}(Nn||(Nn={}));const In=["^0.4.0","^0.3.0","^0.2.0","^0.1.0"];class Fn extends Tn{static async create(e,t,r,n,s,i,o,a=2e4){const c=n(i,{query:{documentId:t,tenantId:e},reconnection:!1,transports:["websocket"],timeout:a}),h={client:s,id:t,mode:s.mode,tenantId:e,token:r,versions:In,relayUserAgent:[s.details.environment,` driverVersion:${On}`].join(";")},l=new Fn(c,t,o,!0);return await l.initialize(h,a),l}createErrorObject(e,t,r=!0){return r&&Number.isInteger(null==t?void 0:t.code)&&"string"==typeof(null==t?void 0:t.message)?function(e,t){return Pn(`R11s socket error (${t}): ${e.message}`,e.code,e.retryAfterMs)}(t,e):super.createErrorObject(e,t,r)}}class kn{get repositoryUrl(){throw new Error("Invalid operation")}async getSnapshotTree(e){return e?Promise.reject(new Error("Invalid operation")):null}async getVersions(e,t){return[]}async uploadSummaryWithContext(e,t){return Promise.reject(new Error("Invalid operation"))}async downloadSummary(e){return Promise.reject(new Error("Invalid operation"))}async createBlob(e){return Promise.reject(new Error("Null blob storage can not create blob"))}async readBlob(e){return Promise.reject(new Error("Null blob storage can not read blob"))}}var Dn;!function(e){e.Method="method",e.Header="header",e.Body="body"}(Dn||(Dn={}));const Mn=(e,t)=>`${e}: ${t}`;class qn{translate(e){var t,r;const n=Object.assign({},e),s=new URLSearchParams;if(s.append(Dn.Method,null!==(t=n.method)&&void 0!==t?t:"GET"),n.headers)for(const[e,t]of Object.entries(n.headers)){const r=Mn(e,t);s.append(Dn.Header,r)}if(n.data&&["post","put","patch"].includes(null===(r=n.method)||void 0===r?void 0:r.toLowerCase())){const e=JSON.stringify(n.data);s.append(Dn.Body,e)}return n.data=s.toString(),n.method="POST",n.headers={"Content-Type":"application/x-www-form-urlencoded;restless"},n}}var Ln,Bn=r(4098),jn=r.n(Bn);class _n extends yt{constructor(e,t,r,n,s,i={}){super(s,i),this.rateLimiter=t,this.getAuthorizationHeader=r,this.useRestLess=n,this.restLess=new qn}async load(){this.authorizationHeader=await this.getAuthorizationHeader()}async request(e,t,r=!0){var n;const s=Object.assign(Object.assign({},e),{headers:this.generateHeaders(e.headers)}),i=(e=>{var t,r;return[void 0!==e.baseURL?`${e.baseURL}${null!==(t=e.url)&&void 0!==t?t:""}`:null!==(r=e.url)&&void 0!==r?r:"",{method:e.method,headers:e.headers,body:e.data}]})(this.useRestLess?this.restLess.translate(s):s),o=await this.rateLimiter.schedule((async()=>jn()(...i).catch((async e=>{Rn(["TypeError","FetchError"].includes(null==e?void 0:e.name)?`NetworkError: ${e.message}`:lt()(e))})))),a=(null===(n=o.headers.get("content-type"))||void 0===n?void 0:n.includes("application/json"))?await o.json():await o.text();return o.ok||o.status===t?a:401===o.status&&r?(this.authorizationHeader=await this.getAuthorizationHeader(!0),this.request(s,t,!1)):429===o.status&&(null==a?void 0:a.retryAfter)>0?new Promise(((e,r)=>setTimeout((()=>{this.request(s,t).then(e).catch(r)}),1e3*a.retryAfter))):void Rn(`R11s fetch error: ${void 0!==a?"string"==typeof a?a:lt()(a):o.statusText}`,o.status,null==a?void 0:a.retryAfter)}generateHeaders(e){const t=(null==e?void 0:e["x-correlation-id"])||(0,a.Z)();return Object.assign(Object.assign({},e),{"x-correlation-id":t,"x-driver-version":On,Authorization:this.authorizationHeader})}}class Hn extends _n{constructor(e,t,r,n,s,i={}){super(e,t,r,n,s,i)}static async load(e,t,r,n,s,i,o){const a={token:`${c=e,sn.from(c,"utf8").toString("base64")}`};var c;const h=new Hn(n,s,(async n=>(e=>{return`Basic ${t=`${e.user}:${e.password}`,at.from(t,"utf8").toString("base64")}`;var t})({password:(await r.fetchStorageToken(e,t,n)).jwt,user:e})),i,o,a);try{await h.load()}catch(e){n.sendErrorEvent({eventName:"R11sRestWrapperLoadFailure"},e),await h.load()}return h}}class Un extends _n{constructor(e,t,r,n,s,i={}){super(e,t,r,n,s,i)}static async load(e,t,r,n,s,i,o){const a=new Un(n,s,(async n=>`Basic ${(await r.fetchOrdererToken(e,t,n)).jwt}`),i,o);try{await a.load()}catch(e){n.sendErrorEvent({eventName:"R11sRestWrapperLoadFailure"},e),await a.load()}return a}}class zn{constructor(e,t,r,n,s,i,o,a,c,h,l,u){this._resolvedUrl=e,this.ordererUrl=t,this.deltaStorageUrl=r,this.storageUrl=n,this.logger=s,this.tokenProvider=i,this.tenantId=o,this.documentId=a,this.driverPolicies=c,this.blobCache=h,this.snapshotTreeCache=l,this.discoverFluidResolvedUrl=u,this.lastDiscoveredAt=Date.now()}get resolvedUrl(){return this._resolvedUrl}dispose(){}async connectToStorage(){if(void 0!==this.documentStorageService)return this.documentStorageService;if(void 0===this.storageUrl)return new kn;const e=async e=>{const t=this.shouldUpdateDiscoveredSessionInfo();if(t&&await this.refreshDiscovery(),!this.storageManager||!this.noCacheStorageManager||t){const e=new nt(this.driverPolicies.maxConcurrentStorageRequests),t=await Hn.load(this.tenantId,this.documentId,this.tokenProvider,this.logger,e,this.driverPolicies.enableRestLess,this.storageUrl),r=new St(this.storageUrl,!0,!1,t);this.storageManager=new Et(r);const n=new St(this.storageUrl,!0,!0,t);this.noCacheStorageManager=new Et(n)}return e?this.noCacheStorageManager:this.storageManager},t=await e(),r=await e(!0),n={caching:this.driverPolicies.enablePrefetch?tt.Prefetch:tt.NoCaching,minBlobSize:this.driverPolicies.aggregateBlobsSmallerThanBytes};return this.documentStorageService=new xn(this.documentId,t,this.logger,n,this.driverPolicies,this.blobCache,this.snapshotTreeCache,r,e),this.documentStorageService}async connectToDeltaStorage(){await this.connectToStorage(),et(!!this.documentStorageService,177);const e=async()=>{const e=this.shouldUpdateDiscoveredSessionInfo();if(e&&await this.refreshDiscovery(),!this.ordererRestWrapper||e){const e=new nt(this.driverPolicies.maxConcurrentOrdererRequests);this.ordererRestWrapper=await Un.load(this.tenantId,this.documentId,this.tokenProvider,this.logger,e,this.driverPolicies.enableRestLess)}return this.ordererRestWrapper},t=await e(),r=new Zr(this.deltaStorageUrl,t,this.logger,e,(()=>this.deltaStorageUrl));return new Qr(this.tenantId,this.documentId,r,this.documentStorageService)}async connectToDeltaStream(e){const t=async t=>{this.shouldUpdateDiscoveredSessionInfo()&&await this.refreshDiscovery();const r=await this.tokenProvider.fetchOrdererToken(this.tenantId,this.documentId,t);return Fn.create(this.tenantId,this.documentId,r.jwt,Gr,e,this.ordererUrl,this.logger)};try{return await t()}catch(e){if(401===(null==e?void 0:e.statusCode))return t(!0);throw e}}async refreshDiscovery(){return this.discoverP||(this.discoverP=u.Xr.timedExecAsync(this.logger,{eventName:"refreshSessionDiscovery"},(async()=>this.refreshDiscoveryCore()))),this.discoverP}async refreshDiscoveryCore(){const e=await this.discoverFluidResolvedUrl();this._resolvedUrl=e,this.storageUrl=e.endpoints.storageUrl,this.ordererUrl=e.endpoints.ordererUrl,this.deltaStorageUrl=e.endpoints.deltaStorageUrl}shouldUpdateDiscoveredSessionInfo(){if(!this.driverPolicies.enableDiscovery)return!1;const e=Date.now()-this.lastDiscoveredAt>3e5;return e&&(this.lastDiscoveredAt=Date.now(),this.discoverP=void 0,this.refreshDiscovery().catch((()=>{this.lastDiscoveredAt=0}))),e}}function Vn(e){const t=Object.keys(e.tree);for(const r of t){const t=e.tree[r];switch(t.type){case Ln.Tree:e.tree[r]=Vn(t);break;case Ln.Blob:t.content="string"==typeof t.content?t.content:tn(t.content,"utf8");break;case Ln.Handle:throw new Error("No handle should be present for first summary!!");default:throw new Error(`Unknown tree type ${t.type}`)}}return e}!function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(Ln||(Ln={}));var Gn=r(4564),Kn=r.n(Gn);const Wn=e=>new(Kn())(e,!0),$n=(e,t)=>e.split("/").slice(0,-1).concat([t]).join("/"),Jn=(e,t)=>{if(t){const r=new(Kn())(t.ordererUrl),n=new(Kn())(e.endpoints.deltaStorageUrl);n.set("host",r.host);const s=new(Kn())(t.historianUrl),i=new(Kn())(e.endpoints.storageUrl);i.set("host",s.host);const o=Wn(e.url);return{endpoints:{deltaStorageUrl:n.toString(),ordererUrl:t.ordererUrl,storageUrl:i.toString()},id:e.id,tokens:e.tokens,type:e.type,url:new(Kn())(`fluid://${r.host}${o.pathname}`).toString()}}return e},Xn={enablePrefetch:!0,maxConcurrentStorageRequests:100,maxConcurrentOrdererRequests:100,aggregateBlobsSmallerThanBytes:void 0,enableDiscovery:!1,enableWholeSummaryUpload:!1,enableRestLess:!0};class Qn{constructor(e,t={}){this.tokenProvider=e,this.protocolName="fluid:",this.blobCache=new mn,this.snapshotTreeCache=new mn,this.driverPolicies=Object.assign(Object.assign({},Xn),t)}async createContainer(e,t,r,n){if(p(t),void 0===e)throw new Error("Empty file summary creation isn't supported in this driver.");et(!!t.endpoints.ordererUrl,178);let s=Wn(t.url);if(!s.pathname)throw new Error("Parsed url should contain tenant and doc Id!!");const[,i]=s.pathname.split("/"),o=e.tree[".protocol"],a=e.tree[".app"];if(!o||!a)throw new Error("Protocol and App Summary required in the full summary");const c=function(e){var t;const r=e.tree.attributes,n=JSON.parse(r.content);return n.term=null!==(t=n.term)&&void 0!==t?t:1,n}(o),h=function(e){const t=e.tree.quorumValues;return JSON.parse(t.content)}(o),l=u.G2.create(r,"RouterliciousDriver"),d=new nt(this.driverPolicies.maxConcurrentOrdererRequests),g=await Un.load(i,void 0,this.tokenProvider,l,d,this.driverPolicies.enableRestLess,t.endpoints.ordererUrl),m=await g.post(`/documents/${i}`,{summary:Vn(a),sequenceNumber:c.sequenceNumber,values:h,enableDiscovery:this.driverPolicies.enableDiscovery,generateToken:void 0!==this.tokenProvider.documentPostCreateCallback});let f,y,v;if("string"==typeof m?f=m:(f=m.id,y=m.token,v=this.driverPolicies.enableDiscovery?m.session:void 0),s=Wn(t.url),y&&void 0!==this.tokenProvider.documentPostCreateCallback)try{await this.tokenProvider.documentPostCreateCallback(f,y)}catch(e){throw new Zn(e)}s.set("pathname",$n(s.pathname,f));const b=t.endpoints.deltaStorageUrl;if(!b)throw new Error(`All endpoints urls must be provided. [deltaStorageUrl:${b}]`);const S=new URL(b);return S.pathname=$n(S.pathname,f),this.createDocumentService(Object.assign(Object.assign({},t),{url:s.toString(),id:f,endpoints:Object.assign(Object.assign({},t.endpoints),{deltaStorageUrl:S.toString()})}),r,n,v)}async createDocumentService(e,t,r,n){p(e);const s=Wn(e.url),[,i,o]=s.pathname.split("/");if(!o||!i)throw new Error(`Couldn't parse documentId and/or tenantId. [documentId:${o}][tenantId:${i}]`);const a=u.G2.create(t,"RouterliciousDriver",{all:{driverVersion:On}}),c=async()=>{if(!this.driverPolicies.enableDiscovery)return e;const t=new nt(this.driverPolicies.maxConcurrentOrdererRequests),r=await Un.load(i,o,this.tokenProvider,a,t,this.driverPolicies.enableRestLess,e.endpoints.ordererUrl),n=await r.get(`/documents/${i}/session/${o}`);return Jn(e,n)},h=void 0!==n?Jn(e,n):await c(),l=h.endpoints.storageUrl,d=h.endpoints.ordererUrl,g=h.endpoints.deltaStorageUrl;if(!d||!g)throw new Error(`All endpoints urls must be provided. [ordererUrl:${d}][deltaStorageUrl:${g}]`);return new zn(h,d,g,l,a,this.tokenProvider,i,o,this.driverPolicies,this.blobCache,this.snapshotTreeCache,c)}}class Zn extends Error{constructor(e){super(e.message),this.innerError=e,this.name="DocumentPostCreateError"}get stack(){return this.innerError.stack}}var Yn=r(9703),es=r(5761);class ts{constructor(){}async resolve(e){const{ordererUrl:t,storageUrl:r,tenantId:n,containerId:s}=function(e){const t=new URL(e),r=t.origin,n=t.searchParams,s=n.get("storage");if(null===s)throw new Error("Azure URL did not contain a storage URL");const i=n.get("tenantId");if(null===i)throw new Error("Azure URL did not contain a tenant ID");const o=decodeURIComponent(s),a=decodeURIComponent(i),c=n.get("containerId");return{ordererUrl:r,storageUrl:o,tenantId:a,containerId:null!==c?decodeURIComponent(c):void 0}}(e.url);if(e.headers&&!0===e.headers[es.i.createNew])return{endpoints:{deltaStorageUrl:`${t}/deltas/${n}/new`,ordererUrl:t,storageUrl:`${r}/repos/${n}`},id:"",tokens:{},type:"fluid",url:`${t}/${n}/new`};if(void 0===s)throw new Error("Azure URL did not contain containerId");return{endpoints:{deltaStorageUrl:`${t}/deltas/${n}/${s}`,ordererUrl:t,storageUrl:`${r}/repos/${n}`},id:s,tokens:{},type:"fluid",url:`${t}/${n}/${s}`}}async getAbsoluteUrl(e,t){if("fluid"!==e.type)throw new Error("Invalid Resolved Url");return`${e.url}/${t}`}}function rs(e){return"remote"===e.type}const ns=e=>rs(e)?e.tenantId:"local";class ss{constructor(e){this.props=e,e.connection.endpoint=e.connection.endpoint.replace(/\/$/,""),this.urlResolver=new ts;const t=rs(this.props.connection);this.documentServiceFactory=new Qn(this.props.connection.tokenProvider,{enableWholeSummaryUpload:t,enableDiscovery:t})}async createContainer(e){const t=this.createLoader(e),r=await t.createDetachedContainer({package:"no-dynamic-package",config:{}});return{container:await this.createFluidContainer(r,this.props.connection),services:this.getContainerServices(r)}}async copyContainer(e,t,r){var n;const s=this.createLoader(t),i=new URL(this.props.connection.endpoint);i.searchParams.append("storage",encodeURIComponent(this.props.connection.endpoint)),i.searchParams.append("tenantId",encodeURIComponent(ns(this.props.connection))),i.searchParams.append("containerId",encodeURIComponent(e));const o=await s.resolve({url:i.href});if(void 0===o.resolvedUrl)throw new Error("Source container cannot resolve URL.");const a=await this.documentServiceFactory.createDocumentService(o.resolvedUrl),c=await a.connectToStorage(),h={type:Qe.Handle,handleType:Qe.Tree,handle:null!==(n=null==r?void 0:r.id)&&void 0!==n?n:"latest"},l=await c.downloadSummary(h),u=await s.rehydrateDetachedContainerFromSnapshot(JSON.stringify(l));return{container:await this.createFluidContainer(u,this.props.connection),services:this.getContainerServices(u)}}async getContainer(e,t){const r=this.createLoader(t),n=new URL(this.props.connection.endpoint);n.searchParams.append("storage",encodeURIComponent(this.props.connection.endpoint)),n.searchParams.append("tenantId",encodeURIComponent(ns(this.props.connection))),n.searchParams.append("containerId",encodeURIComponent(e));const s=await r.resolve({url:n.href}),i=await(0,Yn.bb)(s,"/");return{container:new Ze.G(s,i),services:this.getContainerServices(s)}}async getContainerVersions(e,t){var r;const n=new URL(this.props.connection.endpoint);n.searchParams.append("storage",encodeURIComponent(this.props.connection.endpoint)),n.searchParams.append("tenantId",encodeURIComponent(ns(this.props.connection))),n.searchParams.append("containerId",encodeURIComponent(e));const s=await this.urlResolver.resolve({url:n.href});if(!s)throw new Error("Unable to resolved URL");const i=await this.documentServiceFactory.createDocumentService(s),o=await i.connectToStorage();return(await o.getVersions(null,null!==(r=null==t?void 0:t.maxCount)&&void 0!==r?r:5)).map((e=>({id:e.id,date:e.date})))}getContainerServices(e){return{audience:new i(e)}}createLoader(e){const t=new Ye.Y(e),r={load:async()=>({module:{fluidExport:t},details:{package:"no-dynamic-package",config:{}}})};return new Xe({urlResolver:this.urlResolver,documentServiceFactory:this.documentServiceFactory,codeLoader:r,logger:this.props.logger})}async createFluidContainer(e,t){const r=((e,t)=>{const r=new URL(e);return r.searchParams.append("storage",encodeURIComponent(e)),r.searchParams.append("tenantId",encodeURIComponent(t)),{url:r.href,headers:{[es.i.createNew]:!0}}})(t.endpoint,ns(t)),n=await(0,Yn.bb)(e,"/"),s=new Ze.G(e,n);return s.attach=async()=>{if(e.attachState!==o.mB.Detached)throw new Error("Cannot attach container. Container is not in detached state");await e.attach(r);const t=e.resolvedUrl;return p(t),t.id},s}}var is,os=r(4458),as=r.n(os);class cs{constructor(e,t){this.azFunctionUrl=e,this.user=t}async fetchOrdererToken(e,t){return{jwt:await this.getToken(e,t)}}async fetchStorageToken(e,t){return{jwt:await this.getToken(e,t)}}async getToken(e,t){var r,n,s;return(await as().get(this.azFunctionUrl,{params:{tenantId:e,documentId:t,userId:null===(r=this.user)||void 0===r?void 0:r.userId,userName:null===(n=this.user)||void 0===n?void 0:n.userName,additionalDetails:null===(s=this.user)||void 0===s?void 0:s.additionalDetails}})).data}}!function(e){e.DocRead="doc:read",e.DocWrite="doc:write",e.SummaryWrite="summary:write"}(is||(is={}))},4458:(e,t,r)=>{e.exports=r(9224)},3429:(e,t,r)=>{"use strict";var n=r(3739),s=r(8044),i=r(4017),o=r(4081),a=r(6022),c=r(1885),h=r(8734),l=r(2726);e.exports=function(e){return new Promise((function(t,r){var u=e.data,d=e.headers,p=e.responseType;n.isFormData(u)&&delete d["Content-Type"];var g=new XMLHttpRequest;if(e.auth){var m=e.auth.username||"",f=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";d.Authorization="Basic "+btoa(m+":"+f)}var y=a(e.baseURL,e.url);function v(){if(g){var n="getAllResponseHeaders"in g?c(g.getAllResponseHeaders()):null,i={data:p&&"text"!==p&&"json"!==p?g.response:g.responseText,status:g.status,statusText:g.statusText,headers:n,config:e,request:g};s(t,r,i),g=null}}if(g.open(e.method.toUpperCase(),o(y,e.params,e.paramsSerializer),!0),g.timeout=e.timeout,"onloadend"in g?g.onloadend=v:g.onreadystatechange=function(){g&&4===g.readyState&&(0!==g.status||g.responseURL&&0===g.responseURL.indexOf("file:"))&&setTimeout(v)},g.onabort=function(){g&&(r(l("Request aborted",e,"ECONNABORTED",g)),g=null)},g.onerror=function(){r(l("Network Error",e,null,g)),g=null},g.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),r(l(t,e,e.transitional&&e.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",g)),g=null},n.isStandardBrowserEnv()){var b=(e.withCredentials||h(y))&&e.xsrfCookieName?i.read(e.xsrfCookieName):void 0;b&&(d[e.xsrfHeaderName]=b)}"setRequestHeader"in g&&n.forEach(d,(function(e,t){void 0===u&&"content-type"===t.toLowerCase()?delete d[t]:g.setRequestHeader(t,e)})),n.isUndefined(e.withCredentials)||(g.withCredentials=!!e.withCredentials),p&&"json"!==p&&(g.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&g.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&g.upload&&g.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){g&&(g.abort(),r(e),g=null)})),u||(u=null),g.send(u)}))}},9224:(e,t,r)=>{"use strict";var n=r(3739),s=r(6956),i=r(2647),o=r(4652);function a(e){var t=new i(e),r=s(i.prototype.request,t);return n.extend(r,i.prototype,t),n.extend(r,t),r}var c=a(r(6397));c.Axios=i,c.create=function(e){return a(o(c.defaults,e))},c.Cancel=r(4770),c.CancelToken=r(9340),c.isCancel=r(2427),c.all=function(e){return Promise.all(e)},c.spread=r(4766),c.isAxiosError=r(837),e.exports=c,e.exports.default=c},4770:e=>{"use strict";function t(e){this.message=e}t.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},t.prototype.__CANCEL__=!0,e.exports=t},9340:(e,t,r)=>{"use strict";var n=r(4770);function s(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var r=this;e((function(e){r.reason||(r.reason=new n(e),t(r.reason))}))}s.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},s.source=function(){var e;return{token:new s((function(t){e=t})),cancel:e}},e.exports=s},2427:e=>{"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},2647:(e,t,r)=>{"use strict";var n=r(3739),s=r(4081),i=r(3767),o=r(2896),a=r(4652),c=r(4584),h=c.validators;function l(e){this.defaults=e,this.interceptors={request:new i,response:new i}}l.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=a(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=e.transitional;void 0!==t&&c.assertOptions(t,{silentJSONParsing:h.transitional(h.boolean,"1.0.0"),forcedJSONParsing:h.transitional(h.boolean,"1.0.0"),clarifyTimeoutError:h.transitional(h.boolean,"1.0.0")},!1);var r=[],n=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(n=n&&t.synchronous,r.unshift(t.fulfilled,t.rejected))}));var s,i=[];if(this.interceptors.response.forEach((function(e){i.push(e.fulfilled,e.rejected)})),!n){var l=[o,void 0];for(Array.prototype.unshift.apply(l,r),l=l.concat(i),s=Promise.resolve(e);l.length;)s=s.then(l.shift(),l.shift());return s}for(var u=e;r.length;){var d=r.shift(),p=r.shift();try{u=d(u)}catch(e){p(e);break}}try{s=o(u)}catch(e){return Promise.reject(e)}for(;i.length;)s=s.then(i.shift(),i.shift());return s},l.prototype.getUri=function(e){return e=a(this.defaults,e),s(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},n.forEach(["delete","get","head","options"],(function(e){l.prototype[e]=function(t,r){return this.request(a(r||{},{method:e,url:t,data:(r||{}).data}))}})),n.forEach(["post","put","patch"],(function(e){l.prototype[e]=function(t,r,n){return this.request(a(n||{},{method:e,url:t,data:r}))}})),e.exports=l},3767:(e,t,r)=>{"use strict";var n=r(3739);function s(){this.handlers=[]}s.prototype.use=function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},s.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},s.prototype.forEach=function(e){n.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=s},6022:(e,t,r)=>{"use strict";var n=r(289),s=r(3163);e.exports=function(e,t){return e&&!n(t)?s(e,t):t}},2726:(e,t,r)=>{"use strict";var n=r(8160);e.exports=function(e,t,r,s,i){var o=new Error(e);return n(o,t,r,s,i)}},2896:(e,t,r)=>{"use strict";var n=r(3739),s=r(8513),i=r(2427),o=r(6397);function a(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return a(e),e.headers=e.headers||{},e.data=s.call(e,e.data,e.headers,e.transformRequest),e.headers=n.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),n.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||o.adapter)(e).then((function(t){return a(e),t.data=s.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return i(t)||(a(e),t&&t.response&&(t.response.data=s.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},8160:e=>{"use strict";e.exports=function(e,t,r,n,s){return e.config=t,r&&(e.code=r),e.request=n,e.response=s,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}},4652:(e,t,r)=>{"use strict";var n=r(3739);e.exports=function(e,t){t=t||{};var r={},s=["url","method","data"],i=["headers","auth","proxy","params"],o=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],a=["validateStatus"];function c(e,t){return n.isPlainObject(e)&&n.isPlainObject(t)?n.merge(e,t):n.isPlainObject(t)?n.merge({},t):n.isArray(t)?t.slice():t}function h(s){n.isUndefined(t[s])?n.isUndefined(e[s])||(r[s]=c(void 0,e[s])):r[s]=c(e[s],t[s])}n.forEach(s,(function(e){n.isUndefined(t[e])||(r[e]=c(void 0,t[e]))})),n.forEach(i,h),n.forEach(o,(function(s){n.isUndefined(t[s])?n.isUndefined(e[s])||(r[s]=c(void 0,e[s])):r[s]=c(void 0,t[s])})),n.forEach(a,(function(n){n in t?r[n]=c(e[n],t[n]):n in e&&(r[n]=c(void 0,e[n]))}));var l=s.concat(i).concat(o).concat(a),u=Object.keys(e).concat(Object.keys(t)).filter((function(e){return-1===l.indexOf(e)}));return n.forEach(u,h),r}},8044:(e,t,r)=>{"use strict";var n=r(2726);e.exports=function(e,t,r){var s=r.config.validateStatus;r.status&&s&&!s(r.status)?t(n("Request failed with status code "+r.status,r.config,null,r.request,r)):e(r)}},8513:(e,t,r)=>{"use strict";var n=r(3739),s=r(6397);e.exports=function(e,t,r){var i=this||s;return n.forEach(r,(function(r){e=r.call(i,e,t)})),e}},6397:(e,t,r)=>{"use strict";var n=r(3739),s=r(2366),i=r(8160),o={"Content-Type":"application/x-www-form-urlencoded"};function a(e,t){!n.isUndefined(e)&&n.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var c,h={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(c=r(3429)),c),transformRequest:[function(e,t){return s(t,"Accept"),s(t,"Content-Type"),n.isFormData(e)||n.isArrayBuffer(e)||n.isBuffer(e)||n.isStream(e)||n.isFile(e)||n.isBlob(e)?e:n.isArrayBufferView(e)?e.buffer:n.isURLSearchParams(e)?(a(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):n.isObject(e)||t&&"application/json"===t["Content-Type"]?(a(t,"application/json"),function(e,t,r){if(n.isString(e))try{return(0,JSON.parse)(e),n.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional,r=t&&t.silentJSONParsing,s=t&&t.forcedJSONParsing,o=!r&&"json"===this.responseType;if(o||s&&n.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(o){if("SyntaxError"===e.name)throw i(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};n.forEach(["delete","get","head"],(function(e){h.headers[e]={}})),n.forEach(["post","put","patch"],(function(e){h.headers[e]=n.merge(o)})),e.exports=h},6956:e=>{"use strict";e.exports=function(e,t){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.apply(t,r)}}},4081:(e,t,r)=>{"use strict";var n=r(3739);function s(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,r){if(!t)return e;var i;if(r)i=r(t);else if(n.isURLSearchParams(t))i=t.toString();else{var o=[];n.forEach(t,(function(e,t){null!=e&&(n.isArray(e)?t+="[]":e=[e],n.forEach(e,(function(e){n.isDate(e)?e=e.toISOString():n.isObject(e)&&(e=JSON.stringify(e)),o.push(s(t)+"="+s(e))})))})),i=o.join("&")}if(i){var a=e.indexOf("#");-1!==a&&(e=e.slice(0,a)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}},3163:e=>{"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},4017:(e,t,r)=>{"use strict";var n=r(3739);e.exports=n.isStandardBrowserEnv()?{write:function(e,t,r,s,i,o){var a=[];a.push(e+"="+encodeURIComponent(t)),n.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),n.isString(s)&&a.push("path="+s),n.isString(i)&&a.push("domain="+i),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},289:e=>{"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},837:e=>{"use strict";e.exports=function(e){return"object"==typeof e&&!0===e.isAxiosError}},8734:(e,t,r)=>{"use strict";var n=r(3739);e.exports=n.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function s(e){var n=e;return t&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return e=s(window.location.href),function(t){var r=n.isString(t)?s(t):t;return r.protocol===e.protocol&&r.host===e.host}}():function(){return!0}},2366:(e,t,r)=>{"use strict";var n=r(3739);e.exports=function(e,t){n.forEach(e,(function(r,n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[n])}))}},1885:(e,t,r)=>{"use strict";var n=r(3739),s=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,r,i,o={};return e?(n.forEach(e.split("\n"),(function(e){if(i=e.indexOf(":"),t=n.trim(e.substr(0,i)).toLowerCase(),r=n.trim(e.substr(i+1)),t){if(o[t]&&s.indexOf(t)>=0)return;o[t]="set-cookie"===t?(o[t]?o[t]:[]).concat([r]):o[t]?o[t]+", "+r:r}})),o):o}},4766:e=>{"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},4584:(e,t,r)=>{"use strict";var n=r(2638),s={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){s[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}}));var i={},o=n.version.split(".");function a(e,t){for(var r=t?t.split("."):o,n=e.split("."),s=0;s<3;s++){if(r[s]>n[s])return!0;if(r[s]<n[s])return!1}return!1}s.transitional=function(e,t,r){var s=t&&a(t);function o(e,t){return"[Axios v"+n.version+"] Transitional option '"+e+"'"+t+(r?". "+r:"")}return function(r,n,a){if(!1===e)throw new Error(o(n," has been removed in "+t));return s&&!i[n]&&(i[n]=!0,console.warn(o(n," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,n,a)}},e.exports={isOlderVersion:a,assertOptions:function(e,t,r){if("object"!=typeof e)throw new TypeError("options must be an object");for(var n=Object.keys(e),s=n.length;s-- >0;){var i=n[s],o=t[i];if(o){var a=e[i],c=void 0===a||o(a,i,e);if(!0!==c)throw new TypeError("option "+i+" must be "+c)}else if(!0!==r)throw Error("Unknown option "+i)}},validators:s}},3739:(e,t,r)=>{"use strict";var n=r(6956),s=Object.prototype.toString;function i(e){return"[object Array]"===s.call(e)}function o(e){return void 0===e}function a(e){return null!==e&&"object"==typeof e}function c(e){if("[object Object]"!==s.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function h(e){return"[object Function]"===s.call(e)}function l(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),i(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.call(null,e[s],s,e)}e.exports={isArray:i,isArrayBuffer:function(e){return"[object ArrayBuffer]"===s.call(e)},isBuffer:function(e){return null!==e&&!o(e)&&null!==e.constructor&&!o(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:a,isPlainObject:c,isUndefined:o,isDate:function(e){return"[object Date]"===s.call(e)},isFile:function(e){return"[object File]"===s.call(e)},isBlob:function(e){return"[object Blob]"===s.call(e)},isFunction:h,isStream:function(e){return a(e)&&h(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:l,merge:function e(){var t={};function r(r,n){c(t[n])&&c(r)?t[n]=e(t[n],r):c(r)?t[n]=e({},r):i(r)?t[n]=r.slice():t[n]=r}for(var n=0,s=arguments.length;n<s;n++)l(arguments[n],r);return t},extend:function(e,t,r){return l(t,(function(t,s){e[s]=r&&"function"==typeof t?n(t,r):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}},7819:(e,t,r)=>{"use strict";var n;r.d(t,{u:()=>n}),function(e){e.genericError="genericError",e.throttlingError="throttlingError",e.dataCorruptionError="dataCorruptionError",e.dataProcessingError="dataProcessingError",e.usageError="usageError",e.clientSessionExpiredError="clientSessionExpiredError"}(n||(n={}))},7846:(e,t,r)=>{"use strict";r.d(t,{Ai:()=>i,Tr:()=>s,s2:()=>n});const n=e=>"object"==typeof e&&"string"==typeof(null==e?void 0:e.name)&&"object"==typeof(null==e?void 0:e.fluid),s=e=>{const t=e;return"object"==typeof t&&("string"==typeof(null==t?void 0:t.package)||n(null==t?void 0:t.package))&&(void 0===(null==t?void 0:t.config)||"object"==typeof(null==t?void 0:t.config))},i="IFluidCodeDetailsComparer"},2994:(e,t,r)=>{"use strict";r.r(t),r.d(t,{AttachState:()=>a.mB,BindState:()=>a.xU,ContainerErrorType:()=>i.u,IFluidCodeDetailsComparer:()=>n.Ai,IFluidTokenProvider:()=>c,IRuntimeFactory:()=>a.Wy,LoaderHeader:()=>o.A,isFluidBrowserPackage:()=>s,isFluidCodeDetails:()=>n.Tr,isFluidPackage:()=>n.s2});var n=r(7846);const s=e=>{var t,r,s,i,o,a;return(0,n.s2)(e)&&"string"==typeof(null===(s=null===(r=null===(t=null==e?void 0:e.fluid)||void 0===t?void 0:t.browser)||void 0===r?void 0:r.umd)||void 0===s?void 0:s.library)&&Array.isArray(null===(a=null===(o=null===(i=null==e?void 0:e.fluid)||void 0===i?void 0:i.browser)||void 0===o?void 0:o.umd)||void 0===a?void 0:a.files)};var i=r(7819),o=r(1783),a=r(3738);const c="IFluidTokenProvider"},1783:(e,t,r)=>{"use strict";var n;r.d(t,{A:()=>n}),function(e){e.cache="fluid-cache",e.clientDetails="fluid-client-details",e.loadMode="loadMode",e.reconnect="fluid-reconnect",e.sequenceNumber="fluid-sequence-number",e.version="version"}(n||(n={}))},3738:(e,t,r)=>{"use strict";var n,s;r.d(t,{Wy:()=>i,mB:()=>n,xU:()=>s}),function(e){e.Detached="Detached",e.Attaching="Attaching",e.Attached="Attached"}(n||(n={})),function(e){e.NotBound="NotBound",e.Binding="Binding",e.Bound="Bound"}(s||(s={}));const i="IRuntimeFactory"},1434:(e,t,r)=>{"use strict";var n;r.d(t,{e:()=>n}),function(e){e[e.Disconnected=0]="Disconnected",e[e.EstablishingConnection=3]="EstablishingConnection",e[e.Connecting=1]="Connecting",e[e.CatchingUp=1]="CatchingUp",e[e.Connected=2]="Connected"}(n||(n={}))},9752:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IContainerRuntime=void 0,t.IContainerRuntime="IContainerRuntime"},6734:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(9752),t)},1527:(e,t,r)=>{"use strict";r.d(t,{kE:()=>Tt,lf:()=>St});var n=r(3738),s=r(1783);function i(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}const o=window.performance;var a=r(7187);class c extends a.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}function h(e,t="Unreachable Case"){throw new Error(t)}class l{constructor(e){this.startTick=e,this.lastTick=e}static start(){const e=o.now();return new l(e)}trace(){const e=o.now(),t={totalTimeElapsed:e-this.startTick,duration:e-this.lastTick,tick:e};return this.lastTick=e,t}}var u,d,p,g=r(2738),m=r(4839),f=r(8595),y=r(5761),v=r(4025),b=r(9252),S=r(9268);!function(e){e.NoOp="noop",e.ClientJoin="join",e.ClientLeave="leave",e.Propose="propose",e.Reject="reject",e.Summarize="summarize",e.SummaryAck="summaryAck",e.SummaryNack="summaryNack",e.Operation="op",e.RemoteHelp="remoteHelp",e.NoClient="noClient",e.RoundTrip="tripComplete",e.Control="control"}(u||(u={})),function(e){e.ThrottlingError="ThrottlingError",e.InvalidScopeError="InvalidScopeError",e.BadRequestError="BadRequestError",e.LimitExceededError="LimitExceededError"}(d||(d={})),function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(p||(p={}));var w=r(7983),x=r(3953),C=r(262),E=r(9703),A=r(8991),T=r(1890),O=r(6705),N=r(2045),P=r(1096);class R{constructor(e,t,r){this.path=e,this.runtime=t,this.routeContext=r,this.absolutePath=(0,P.H)(e,this.routeContext)}get IFluidHandleContext(){return this}attachGraph(){throw new Error("can't attach container runtime form within container!")}get isAttached(){return this.runtime.attachState!==n.mB.Detached}async resolveHandle(e){return this.runtime.resolveHandle(e)}}var I=r(9680);class F{constructor(){this.completed=!1,this.p=new Promise(((e,t)=>{this.res=e,this.rej=t}))}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){void 0!==this.res&&(this.completed=!0,this.res(e))}reject(e){void 0!==this.rej&&(this.completed=!0,this.rej(e))}}class k{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return void 0===this.result&&(this.result=this.execute()),this.result}}var D=r(2505),M=r(2718),q=r(9203);const L="summarizer";class B extends c{constructor(e,t,r,n,s){super(),this.logger=e,this.summaryCollection=t,this.clientElection=r,this.maxOpsSinceLastSummary=n,this.electionEnabled=s,this.lastReportedSeq=0,this.summaryCollection.on("default",(({sequenceNumber:e})=>{var t,r,s;const i=this.electedClientId;if(void 0===i)return void(this.clientElection.eligibleCount>0&&this.clientElection.resetElectedClient(e));let o=this.clientElection.electionSequenceNumber;if(e-(null!==(t=this.lastSummaryAckSeqForClient)&&void 0!==t?t:o)>this.maxOpsSinceLastSummary){const t=e-this.lastReportedSeq;if(t>this.maxOpsSinceLastSummary&&(this.logger.sendErrorEvent({eventName:"ElectedClientNotSummarizing",electedClientId:i,lastSummaryAckSeqForClient:this.lastSummaryAckSeqForClient,electionSequenceNumber:o,nextElectedClientId:null===(r=this.clientElection.peekNextElectedClient())||void 0===r?void 0:r.clientId,electionEnabled:this.electionEnabled}),this.lastReportedSeq=e),this.electionEnabled){const r=this.electedParentId;this.clientElection.incrementElectedClient(e),o=this.clientElection.electionSequenceNumber,e>(null!==(s=this.lastSummaryAckSeqForClient)&&void 0!==s?s:o)&&t>this.maxOpsSinceLastSummary&&this.logger.sendErrorEvent({eventName:"UnexpectedElectionSequenceNumber",lastSummaryAckSeqForClient:this.lastSummaryAckSeqForClient,electionSequenceNumber:o,sequenceNumber:e,previousClientId:i,previousParentId:r,electedParentId:this.electedParentId,electedClientId:this.electedClientId,opsSinceLastReport:t,maxOpsSinceLastSummary:n})}}})),this.summaryCollection.on(u.SummaryAck,(e=>{this.lastSummaryAckSeqForClient=e.sequenceNumber})),this.clientElection.on("election",((e,t)=>{this.lastSummaryAckSeqForClient=void 0,void 0===e&&this.clientElection.eligibleCount>0&&this.clientElection.resetElectedClient(t),this.emit("electedSummarizerChanged")}))}get electedClientId(){var e;return null===(e=this.clientElection.electedClient)||void 0===e?void 0:e.clientId}get electedParentId(){var e;return null===(e=this.clientElection.electedParent)||void 0===e?void 0:e.clientId}serialize(){var e;const{electedClientId:t,electedParentId:r,electionSequenceNumber:n}=this.clientElection.serialize();return{electedClientId:t,electedParentId:r,electionSequenceNumber:null!==(e=this.lastSummaryAckSeqForClient)&&void 0!==e?e:n}}static isClientEligible(e){const t=e.client.details;return void 0===t||B.clientDetailsPermitElection(t)}}B.clientDetailsPermitElection=e=>e.capabilities.interactive||e.type===L;var j=r(8888);class _ extends j.B{async get(){throw Error("Do not try to get a summarizer object from the handle. Reference it directly.")}attach(){}bind(e){}}class H{constructor(e,t,r=(()=>Date.now())){this.defaultTimeout=e,this.defaultHandler=t,this.getCurrentTick=r}get hasTimer(){return!!this.runningState}start(e=this.defaultTimeout,t=this.defaultHandler){this.startCore(e,t,e)}clear(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}restart(e,t){var r,n;if(this.runningState){const s=null!=e?e:this.runningState.intendedDuration,i=null!==(n=null!=t?t:null===(r=this.runningState.restart)||void 0===r?void 0:r.handler)&&void 0!==n?n:this.runningState.handler,o=this.calculateRemainingTime(this.runningState);s<o?this.start(s,i):s===o?(this.runningState.handler=i,this.runningState.restart=void 0,this.runningState.intendedDuration=s):this.runningState.restart={startTick:this.getCurrentTick(),duration:s,handler:i}}else this.start(e,t)}startCore(e,t,r){this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:e,intendedDuration:r,handler:t,timeout:setTimeout((()=>this.handler()),e)}}handler(){i(!!this.runningState,10);const e=this.runningState.restart;if(void 0!==e){const t=this.calculateRemainingTime(e);this.startCore(t,(()=>e.handler()),e.duration)}else{const e=this.runningState.handler;this.clear(),e()}}calculateRemainingTime(e){const t=this.getCurrentTick()-e.startTick;return e.duration-t}}class U{constructor(e,t){this.timer=new H(e,(()=>this.wrapHandler(t)))}get hasTimer(){return this.timer.hasTimer}async start(e,t){return this.clear(),this.deferred=new F,this.timer.start(e,t?()=>this.wrapHandler(t):void 0),this.deferred.promise}clear(){this.timer.clear(),this.deferred&&(this.deferred.resolve({timerResult:"cancel"}),this.deferred=void 0)}wrapHandler(e){e(),i(!!this.deferred,11),this.deferred.resolve({timerResult:"timeout"}),this.deferred=void 0}}const z=async e=>new Promise((t=>setTimeout((()=>t()),e)));class V{constructor(e,t){this.lastOpSequenceNumber=e,this._lastAttempt=t,this._lastSuccessfulSummary=Object.assign({},t)}get lastAttempt(){return this._lastAttempt}get lastSuccessfulSummary(){return this._lastSuccessfulSummary}updateWithLastSummaryAckInfo(e){this._lastAttempt=e,this._lastSuccessfulSummary=Object.assign({},e)}recordAttempt(e){this._lastAttempt={refSequenceNumber:null!=e?e:this.lastOpSequenceNumber,summaryTime:Date.now()}}markLastAttemptAsSuccessful(){this._lastSuccessfulSummary=Object.assign({},this.lastAttempt)}}class G{constructor(e,t,r,n){this.heuristicData=e,this.configuration=t,this.trySummarize=r,this.logger=n,this.idleTimer=new H(this.configuration.idleTime,(()=>this.trySummarize("idle"))),this.minOpsForLastSummaryAttempt=this.configuration.minOpsForLastSummaryAttempt}get opsSinceLastAck(){return this.heuristicData.lastOpSequenceNumber-this.heuristicData.lastSuccessfulSummary.refSequenceNumber}run(){const e=Date.now()-this.heuristicData.lastSuccessfulSummary.summaryTime,t=this.opsSinceLastAck;e>this.configuration.maxTime?(this.idleTimer.clear(),this.trySummarize("maxTime")):t>this.configuration.maxOps?(this.idleTimer.clear(),this.trySummarize("maxOps")):this.idleTimer.restart()}shouldRunLastSummary(){const e=this.opsSinceLastAck,t=this.minOpsForLastSummaryAttempt;return this.logger.sendTelemetryEvent({eventName:"ShouldRunLastSummary",opsSinceLastAck:e,minOpsForLastSummaryAttempt:t}),e>=t}dispose(){this.idleTimer.clear()}}var K=r(9077);async function W(e,t,r){const n=[e.then((e=>({result:"done",value:e}))),t.then((({timerResult:e})=>({result:e})))];return void 0!==r&&n.push(r.waitCancelled.then((()=>({result:"cancelled"})))),Promise.race(n)}const $={submitSummaryFailure:"Error while generating, uploading, or submitting summary",summaryOpWaitTimeout:"Timeout while waiting for summarize op broadcast",summaryAckWaitTimeout:"Timeout while waiting for summaryAck/summaryNack op",summaryNack:"Server rejected summary via summaryNack op",disconnect:"Summary cancelled due to summarizer or main client disconnect"};class J{constructor(){this.summarySubmitted=new F,this.summaryOpBroadcasted=new F,this.receivedSummaryAckOrNack=new F}fail(e,t,r,n){i(!this.receivedSummaryAckOrNack.isCompleted,606);const s={success:!1,message:e,data:void 0,error:t,retryAfterSeconds:n};this.summarySubmitted.resolve(s),this.summaryOpBroadcasted.resolve(s),this.receivedSummaryAckOrNack.resolve(Object.assign(Object.assign({},s),{data:r}))}build(){return{summarySubmitted:this.summarySubmitted.promise,summaryOpBroadcasted:this.summaryOpBroadcasted.promise,receivedSummaryAckOrNack:this.receivedSummaryAckOrNack.promise}}}class X{constructor(e,t,r,n,s,i,o){this.pendingAckTimer=e,this.heuristicData=t,this.submitSummaryCallback=r,this.raiseSummarizingError=n,this.successfulSummaryCallback=s,this.summaryWatcher=i,this.logger=o,this.summarizeTimer=new H(2e4,(()=>this.summarizeTimerHandler(2e4,1)))}summarize(e,t,r,n=new J){return this.summarizeCore(e,t,n,r).catch((t=>{const r="UnexpectedSummarizeError";this.logger.sendErrorEvent(Object.assign({eventName:r},e),t),n.fail(r,t)})),n.build()}async summarizeCore(e,t,r,n){const{refreshLatestAck:s,fullTree:o}=t,a=g.G2.create(this.logger,void 0,{all:e});let c={fullTree:o,timeSinceLastAttempt:Date.now()-this.heuristicData.lastAttempt.summaryTime,timeSinceLastSummary:Date.now()-this.heuristicData.lastSuccessfulSummary.summaryTime};const h=g.Xr.start(a,Object.assign({eventName:"Summarize",refreshLatestAck:s},c)),l=(e,t,s,i)=>{this.raiseSummarizingError($[e]);const o=(0,K.GS)(t),a=n.cancelled||(null==t?void 0:t.errorType)===D.C.offlineError?"generic":"error";h.cancel(Object.assign(Object.assign({},s),{reason:e,category:a,retryAfterSeconds:o}),t),r.fail((e=>`${e}: ${$[e]}`)(e),t,i,o)};let d;this.summarizeTimer.start();try{d=await this.submitSummaryCallback({fullTree:o,refreshLatestAck:s,summaryLogger:a,cancellationToken:n});const e=d.referenceSequenceNumber,t=e-this.heuristicData.lastSuccessfulSummary.refSequenceNumber;if(c=Object.assign(Object.assign({},c),{referenceSequenceNumber:e,minimumSequenceNumber:d.minimumSequenceNumber,opsSinceLastAttempt:e-this.heuristicData.lastAttempt.refSequenceNumber,opsSinceLastSummary:t}),"base"!==d.stage&&(c=Object.assign(Object.assign(Object.assign({},c),d.summaryStats),{generateDuration:d.generateDuration}),"generate"!==d.stage&&(c=Object.assign(Object.assign({},c),{handle:d.handle,uploadDuration:d.uploadDuration}),"upload"!==d.stage&&(c=Object.assign(Object.assign({},c),{clientSequenceNumber:d.clientSequenceNumber})))),"submit"!==d.stage)return l("submitSummaryFailure",d.error,c);if(!o&&!d.forcedFullTree){const{summarizedDataStoreCount:e,gcStateUpdatedDataStoreCount:r=0}=d.summaryStats;e>r+t&&a.sendErrorEvent({eventName:"IncrementalSummaryViolation",summarizedDataStoreCount:e,gcStateUpdatedDataStoreCount:r,opsSinceLastSummary:t})}h.reportEvent("generate",Object.assign({},c)),r.summarySubmitted.resolve({success:!0,data:d})}catch(e){return l("submitSummaryFailure",e)}finally{this.heuristicData.recordAttempt(null==d?void 0:d.referenceSequenceNumber),this.summarizeTimer.clear()}try{const e=this.pendingAckTimer.start(),t=this.summaryWatcher.watchSummary(d.clientSequenceNumber),s=await W(t.waitBroadcast(),e,n);if("cancelled"===s.result)return l("disconnect");if("done"!==s.result)return l("summaryOpWaitTimeout");const o=s.value,p=Date.now()-this.heuristicData.lastAttempt.summaryTime;r.summaryOpBroadcasted.resolve({success:!0,data:{summarizeOp:o,broadcastDuration:p}}),this.heuristicData.lastAttempt.summarySequenceNumber=o.sequenceNumber,a.sendTelemetryEvent({eventName:"Summarize_Op",duration:p,referenceSequenceNumber:o.referenceSequenceNumber,summarySequenceNumber:o.sequenceNumber,handle:o.contents.handle});const g=await W(t.waitAckNack(),e,n);if("cancelled"===g.result)return l("disconnect");if("done"!==g.result)return l("summaryAckWaitTimeout");const m=g.value;this.pendingAckTimer.clear();const f=Date.now()-this.heuristicData.lastAttempt.summaryTime;if(c=Object.assign({ackWaitDuration:f,ackNackSequenceNumber:m.sequenceNumber,summarySequenceNumber:m.contents.summaryProposal.summarySequenceNumber},c),m.type!==u.SummaryAck){i(m.type===u.SummaryNack,628);const e=m.contents,t=null==e?void 0:e.message,r=null==e?void 0:e.retryAfter,n=new M.j4(`Received summaryNack: ${t}`,{retryAfterSeconds:r});return i((0,K.GS)(n)===r,607),l("summaryNack",n,Object.assign(Object.assign({},c),{nackRetryAfter:r}),{summaryNackOp:m,ackNackDuration:f})}this.heuristicData.markLastAttemptAsSuccessful(),this.successfulSummaryCallback(),h.end(Object.assign(Object.assign({},c),{handle:m.contents.handle})),r.receivedSummaryAckOrNack.resolve({success:!0,data:{summaryAckOp:m,ackNackDuration:f}})}finally{this.pendingAckTimer.clear()}}summarizeTimerHandler(e,t){if(this.logger.sendPerformanceEvent({eventName:"SummarizeTimeout",timeoutTime:e,timeoutCount:t}),t<5){const r=2*e;this.summarizeTimer.start(r,(()=>this.summarizeTimerHandler(r,t+1)))}}dispose(){this.summarizeTimer.clear()}}var Q,Z=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]])}return r};class Y{constructor(e,t,r,n,s,o,a,c,h){this.summaryWatcher=t,this.configuration=r,this.submitSummaryCallback=n,this.heuristicData=s,this.raiseSummarizingError=o,this.summaryCollection=a,this.cancellationToken=c,this.stopSummarizerCallback=h,this.stopping=!1,this._disposed=!1,this.tryWhileSummarizing=!1,this.summarizeCount=0,this.totalSuccessfulAttempts=0,this.tryGetCorrelatedLogger=e=>this.heuristicData.lastAttempt.refSequenceNumber===e?this.logger:void 0;const l={summarizeCount:()=>this.summarizeCount,summarizerSuccessfulAttempts:()=>this.totalSuccessfulAttempts};this.logger=g.G2.create(e,"Running",{all:l}),"disableHeuristics"!==r.state&&(i("enabled"===this.configuration.state,746),this.heuristicRunner=new G(s,this.configuration,(e=>this.trySummarize(e)),this.logger)),i("disabled"!==this.configuration.state,747);const u=Math.min(this.configuration.maxAckWaitTime,6e5);this.pendingAckTimer=new U(u,(()=>{this.raiseSummarizingError("Pending summary ack not received in time"),this.logger.sendErrorEvent({eventName:"SummaryAckWaitTimeout",maxAckWaitTime:u,referenceSequenceNumber:this.heuristicData.lastAttempt.refSequenceNumber,summarySequenceNumber:this.heuristicData.lastAttempt.summarySequenceNumber,timePending:Date.now()-this.heuristicData.lastAttempt.summaryTime})})),a.setPendingAckTimerTimeoutCallback(u,(()=>{this.pendingAckTimer.hasTimer&&(this.logger.sendTelemetryEvent({eventName:"MissingSummaryAckFoundByOps",referenceSequenceNumber:this.heuristicData.lastAttempt.refSequenceNumber,summarySequenceNumber:this.heuristicData.lastAttempt.summarySequenceNumber}),this.pendingAckTimer.clear())})),this.generator=new X(this.pendingAckTimer,this.heuristicData,this.submitSummaryCallback,this.raiseSummarizingError,(()=>{this.totalSuccessfulAttempts++}),this.summaryWatcher,this.logger)}static async start(e,t,r,n,s,i,o,a,c){var h;const l=new Y(e,t,r,n,s,i,o,a,c);return await l.waitStart(),null===(h=l.heuristicRunner)||void 0===h||h.run(),l}get disposed(){return this._disposed}dispose(){var e;this.summaryWatcher.dispose(),null===(e=this.heuristicRunner)||void 0===e||e.dispose(),this.heuristicRunner=void 0,this.generator.dispose(),this.pendingAckTimer.clear(),this.disposeEnqueuedSummary(),this._disposed=!0,this.stopping=!0}handleSystemOp(e){switch(e.type){case u.ClientLeave:case u.ClientJoin:case u.Propose:return void this.handleOp(void 0,e);default:return}}handleOp(e,{sequenceNumber:t,type:r,clientId:n,contents:s}){var i;void 0===e&&(this.heuristicData.lastOpSequenceNumber=t,this.tryRunEnqueuedSummary()||null===(i=this.heuristicRunner)||void 0===i||i.run())}async waitStop(e){var t;this.stopping||(this.stopping=!0,this.disposeEnqueuedSummary(),e&&(null===(t=this.heuristicRunner)||void 0===t?void 0:t.shouldRunLastSummary())&&void 0===this.summarizingLock&&this.trySummarizeOnce({reason:"lastSummary"},{}),await this.summarizingLock)}async waitStart(){const e=await W(this.summaryWatcher.waitFlushed(),this.pendingAckTimer.start());this.pendingAckTimer.clear(),this.summaryCollection.unsetPendingAckTimerTimeoutCallback(),"done"===e.result&&void 0!==e.value&&this.heuristicData.updateWithLastSummaryAckInfo({refSequenceNumber:e.value.summaryOp.referenceSequenceNumber,summaryTime:Date.now(),summarySequenceNumber:e.value.summaryOp.sequenceNumber})}async lockedRefreshSummaryAckAction(e){i(void 0===this.refreshSummaryAckLock,"Refresh Summary Ack - Caller is responsible for checking lock");const t=new F;return this.refreshSummaryAckLock=t.promise,e().finally((()=>{t.resolve(),this.refreshSummaryAckLock=void 0}))}async lockedSummaryAction(e){i(void 0===this.summarizingLock,603);const t=new F;return this.summarizingLock=t.promise,this.summarizeCount++,await this.refreshSummaryAckLock,e().finally((()=>{var e;t.resolve(),this.summarizingLock=void 0;const r=this.tryWhileSummarizing;this.tryWhileSummarizing=!1,this.stopping||this.tryRunEnqueuedSummary()||!r||null===(e=this.heuristicRunner)||void 0===e||e.run()}))}trySummarizeOnce(e,t,r=this.cancellationToken,n=new J){return this.lockedSummaryAction((async()=>this.generator.summarize(e,t,r,n).receivedSummaryAckOrNack)).catch((e=>{})),n.build()}trySummarize(e,t=this.cancellationToken){void 0===this.summarizingLock?this.lockedSummaryAction((async()=>{const r=[{refreshLatestAck:!1,fullTree:!1},{refreshLatestAck:!0,fullTree:!1},{refreshLatestAck:!0,fullTree:!1,delaySeconds:120},{refreshLatestAck:!0,fullTree:!0,delaySeconds:600}];let n,s,i=0,o=0;for(let a=0;a<r.length;){if(this.cancellationToken.cancelled)return;if(++i>1&&"lastSummary"===e)return;o++;const c=r[a],{delaySeconds:h=0}=c,l=Z(c,["delaySeconds"]),u=null!=n?n:h,d=Object.assign({reason:e,summaryAttempts:i,summaryAttemptsPerPhase:o,summaryAttemptPhase:a+1},l);u>0&&(this.logger.sendPerformanceEvent(Object.assign({eventName:"SummarizeAttemptDelay",duration:u,summaryNackDelay:void 0!==n},d)),await z(1e3*u)),await this.refreshSummaryAckLock;const p=this.generator.summarize(d,l,t),g=await p.receivedSummaryAckOrNack;if(g.success)return;n=g.retryAfterSeconds,(void 0===n||o>1)&&(a++,o=0),s=g}this.logger.sendErrorEvent({eventName:"FailToSummarize",reason:e,message:null==s?void 0:s.message},null==s?void 0:s.error),this.stopSummarizerCallback("failToSummarize")})).catch((e=>{this.logger.sendErrorEvent({eventName:"UnexpectedSummarizeError"},e)})):this.tryWhileSummarizing=!0}summarizeOnDemand(e=new J,t){var{reason:r}=t,n=Z(t,["reason"]);if(this.stopping)return e.fail("RunningSummarizer stopped or disposed",void 0),e.build();if(void 0!==this.summarizingLock)throw new S.Oi("Attempted to run an already-running summarizer on demand");return this.trySummarizeOnce({reason:`onDemand/${r}`},n,this.cancellationToken,e)}enqueueSummarize(e){var{reason:t,afterSequenceNumber:r=0,override:n=!1}=e,s=Z(e,["reason","afterSequenceNumber","override"]);const i=`enqueue;${t}`;let o=!1;if(void 0!==this.enqueuedSummary){if(!n)return{alreadyEnqueued:!0};this.enqueuedSummary.resultsBuilder.fail("Aborted; overridden by another enqueue summarize attempt",void 0),this.enqueuedSummary=void 0,o=!0}this.enqueuedSummary={reason:i,afterSequenceNumber:r,options:s,resultsBuilder:new J};const a=this.enqueuedSummary.resultsBuilder.build();return this.tryRunEnqueuedSummary(),o?Object.assign(Object.assign({},a),{alreadyEnqueued:!0,overridden:!0}):a}tryRunEnqueuedSummary(){if(this.stopping)return this.disposeEnqueuedSummary(),!1;if(void 0===this.enqueuedSummary||this.heuristicData.lastOpSequenceNumber<this.enqueuedSummary.afterSequenceNumber||void 0!==this.summarizingLock)return!1;const{reason:e,resultsBuilder:t,options:r}=this.enqueuedSummary;return this.enqueuedSummary=void 0,this.trySummarizeOnce({reason:`enqueuedSummary/${e}`},r,this.cancellationToken,t),!0}disposeEnqueuedSummary(){void 0!==this.enqueuedSummary&&(this.enqueuedSummary.resultsBuilder.fail("RunningSummarizer stopped or disposed",void 0),this.enqueuedSummary=void 0)}}class ee extends M.j4{constructor(e,t=!1){super(e),this.logged=t,this.errorType="summarizingError",this.canRetry=!0}static wrap(e,t=!1,r){return(0,M.bO)(e,(e=>new ee(e,t)),r)}}class te extends a.EventEmitter{constructor(e,t,r,n,s,i,o){super(),this.runtime=t,this.configurationGetter=r,this.internalsProvider=n,this.summaryCollection=i,this.runCoordinatorCreateFn=o,this._disposed=!1,this.starting=!1,this.stopDeferred=new F,this.summarizeOnDemand=(...e)=>{var t;try{if(this._disposed||(null===(t=this.runningSummarizer)||void 0===t?void 0:t.disposed))throw new S.Oi("Summarizer is already disposed.");if(void 0!==this.runtime.summarizerClientId&&this.runtime.summarizerClientId!==this.runtime.clientId)throw new S.Oi("On-demand summary attempted while an elected summarizer is present");const r=new J;return this.runningSummarizer?this.runningSummarizer.summarizeOnDemand(r,...e):(this.runCoordinatorCreateFn(this.runtime).then((t=>{this.start(this.runtime.clientId,t).then((async n=>{n.summarizeOnDemand(r,...e);const s=await Promise.race([this.stopDeferred.promise,t.waitCancelled]);await n.waitStop(!1),t.stop(s),this.close()})).catch((e=>{r.fail("Failed to start summarizer",e)}))})).catch((e=>{r.fail("Failed to create cancellation token",e)})),r.build())}catch(e){throw ee.wrap(e,!1,this.logger)}},this.enqueueSummarize=(...e)=>{if(this._disposed||void 0===this.runningSummarizer||this.runningSummarizer.disposed)throw new S.Oi("Summarizer is not running or already disposed.");return this.runningSummarizer.enqueueSummarize(...e)},this.logger=g.G2.create(this.runtime.logger,"Summarizer"),this.innerHandle=new _(this,e,s)}get IFluidLoadable(){return this}get ISummarizer(){return this}get handle(){return this.innerHandle}static async create(e,t){const r={headers:{[s.A.cache]:!1,[s.A.clientDetails]:{capabilities:{interactive:!1},type:L},[y.i.summarizingClient]:!0,[s.A.reconnect]:!1},url:t},n=await e.resolve(r),i=await(0,E.bb)(n,{url:"_summarizer"});if(void 0===i.ISummarizer)throw new S.Oi("Fluid object does not implement ISummarizer");return i.ISummarizer}async run(e){try{return await this.runCore(e)}catch(e){throw this.stop("summarizerException"),ee.wrap(e,!1,this.logger)}finally{this.close()}}stop(e){this.stopDeferred.resolve(e)}close(){this.dispose(),this.runtime.closeFn()}async runCore(e){const t=await this.runCoordinatorCreateFn(this.runtime),r=Promise.race([t.waitCancelled,this.stopDeferred.promise]);if(r.then((t=>{this.logger.sendTelemetryEvent({eventName:"StoppingSummarizer",onBehalfOf:e,reason:t})})),t.cancelled)return t.waitCancelled;const n=await this.start(e,t),s=await r;return await n.waitStop(!t.cancelled&&te.stopReasonCanRunLastSummary(s)),t.stop(s),s}static stopReasonCanRunLastSummary(e){return"parentNotConnected"===e}async start(e,t){if(this.runningSummarizer){if(this.runningSummarizer.disposed)throw new S.Oi("Starting a disposed summarizer");return this.runningSummarizer}if(this.starting)throw new S.Oi("Attempting to start a summarizer that is already starting");this.starting=!0,this.logger.sendTelemetryEvent({eventName:"RunningSummarizer",onBehalfOf:e,initSummarySeqNumber:this.runtime.deltaManager.initialSequenceNumber,config:JSON.stringify(this.configurationGetter())});const r=this.runtime.clientId;if(void 0===r)throw new S.Oi("clientId should be defined if connected.");const n=await Y.start(this.logger,this.summaryCollection.createWatcher(r),this.configurationGetter(),(async(...e)=>this.internalsProvider.submitSummary(...e)),new V(this.runtime.deltaManager.lastSequenceNumber,{refSequenceNumber:this.runtime.deltaManager.initialSequenceNumber,summaryTime:Date.now()}),(e=>{this._disposed||this.logger.sendErrorEvent({eventName:"summarizingError"},((e,t)=>new ee(e,!0))(e))}),this.summaryCollection,t,(e=>t.stop(e)));return this.runningSummarizer=n,this.starting=!1,this.handleSummaryAcks().catch((e=>{this.logger.sendErrorEvent({eventName:"HandleSummaryAckFatalError"},e)})),this.systemOpListener=e=>n.handleSystemOp(e),this.runtime.deltaManager.inbound.on("op",this.systemOpListener),this.opListener=(e,t)=>n.handleOp(e,t),this.runtime.on("batchEnd",this.opListener),n}dispose(){this.stop("summarizerClientDisconnected"),this._disposed=!0,this.runningSummarizer&&(this.runningSummarizer.dispose(),this.runningSummarizer=void 0),this.systemOpListener&&this.runtime.deltaManager.inbound.off("op",this.systemOpListener),this.opListener&&this.runtime.removeListener("batchEnd",this.opListener)}async handleSummaryAcks(){var e,t,r,n,s;let i,o=this.runtime.deltaManager.initialSequenceNumber;for(;this.runningSummarizer;){const a=null!==(e=this.runningSummarizer.tryGetCorrelatedLogger(o))&&void 0!==e?e:this.logger;try{i=void 0,i=await this.summaryCollection.waitSummaryAck(o),o=i.summaryOp.referenceSequenceNumber;const e=i.summaryOp.contents.handle,t=i.summaryAck.contents.handle;await this.runningSummarizer.lockedRefreshSummaryAckAction((async()=>this.internalsProvider.refreshLatestSummaryAck(e,t,o,a).catch((async r=>{if(!(0,q.IR)(r)||r.errorType!==D.C.fileNotFoundOrAccessDeniedError)throw r;a.sendTelemetryEvent({eventName:"HandleSummaryAckErrorIgnored",referenceSequenceNumber:o,proposalHandle:e,ackHandle:t},r)}))))}catch(e){a.sendErrorEvent({eventName:"HandleSummaryAckError",referenceSequenceNumber:o,handle:null===(r=null===(t=null==i?void 0:i.summaryOp)||void 0===t?void 0:t.contents)||void 0===r?void 0:r.handle,ackHandle:null===(s=null===(n=null==i?void 0:i.summaryAck)||void 0===n?void 0:n.contents)||void 0===s?void 0:s.handle},e)}o++}}}!function(e){e[e.Off=0]="Off",e[e.Starting=1]="Starting",e[e.Running=2]="Running",e[e.Stopping=3]="Stopping"}(Q||(Q={}));class re{constructor(e,t,r,n,s,i,{initialDelayMs:o=5e3,opsToBypassInitialDelay:a=4e3}={},c){this.clientElection=e,this.connectedState=t,this.summaryCollection=r,this.requestSummarizerFn=s,this.startThrottler=i,this.disableHeuristics=c,this.state=Q.Off,this._disposed=!1,this.handleConnected=e=>{this.latestClientId=e,this.refreshSummarizer()},this.handleDisconnected=()=>{this.refreshSummarizer()},this.refreshSummarizer=()=>{const e=this.getShouldSummarizeState();switch(this.state){case Q.Off:return void(e.shouldSummarize&&this.startSummarization());case Q.Starting:return;case Q.Running:return void(!1===e.shouldSummarize&&this.stop(e.stopReason));case Q.Stopping:default:return}},this.summarizeOnDemand=(...e)=>{if(void 0===this.summarizer)throw Error("No running summarizer client");return this.summarizer.summarizeOnDemand(...e)},this.enqueueSummarize=(...e)=>{if(void 0===this.summarizer)throw Error("No running summarizer client");return this.summarizer.enqueueSummarize(...e)},this.logger=g.G2.create(n,"SummaryManager",{all:{clientId:()=>this.latestClientId}}),this.connectedState.on("connected",this.handleConnected),this.connectedState.on("disconnected",this.handleDisconnected),this.latestClientId=this.connectedState.clientId,this.opsToBypassInitialDelay=a,this.initialDelayMs=o}get disposed(){return this._disposed}get currentState(){return this.state}start(){this.clientElection.on("electedSummarizerChanged",this.refreshSummarizer),this.refreshSummarizer()}getShouldSummarizeState(){return this.connectedState.clientId!==this.clientElection.electedParentId||this.state!==Q.Running&&this.connectedState.clientId!==this.clientElection.electedClientId?{shouldSummarize:!1,stopReason:"parentShouldNotSummarize"}:this.connectedState.connected?this.disposed?void i(!1,608):{shouldSummarize:!0}:{shouldSummarize:!1,stopReason:"parentNotConnected"}}startSummarization(){i(this.state===Q.Off,609),this.state=Q.Starting,i(void 0===this.summarizer,610),this.delayBeforeCreatingSummarizer().then((async e=>{if(e&&!1===this.getShouldSummarizeState().shouldSummarize)return"early exit";i(this.state===Q.Starting,611),this.state=Q.Running;const t=await this.requestSummarizerFn();this.summarizer=t;const r=this.getShouldSummarizeState();if(!1===r.shouldSummarize)return this.state=Q.Starting,t.stop(r.stopReason),"early exit after starting summarizer";const n=this.latestClientId;return g.Xr.timedExecAsync(this.logger,{eventName:"RunningSummarizer",attempt:this.startThrottler.numAttempts},(async()=>t.run(n,this.disableHeuristics)))})).then((e=>{this.logger.sendTelemetryEvent({eventName:"EndingSummarizer",reason:e})})).catch((e=>{if(this.logger.sendTelemetryEvent({eventName:"EndingSummarizer",reason:"exception"},e),this.getShouldSummarizeState().shouldSummarize||void 0!==this.summarizer){const t=(null==e?void 0:e.errorType)===D.C.offlineError?"generic":"error";this.logger.sendTelemetryEvent({eventName:"SummarizerException",category:t},e)}})).finally((()=>{var e;i(this.state!==Q.Off,612),this.state=Q.Off,null===(e=this.summarizer)||void 0===e||e.close(),this.summarizer=void 0,this.getShouldSummarizeState().shouldSummarize&&this.startSummarization()}))}stop(e){var t;re.isStartingOrRunning(this.state)&&(this.state=Q.Stopping,null===(t=this.summarizer)||void 0===t||t.stop(e))}async delayBeforeCreatingSummarizer(){let e=this.startThrottler.getDelay();this.logger.sendTelemetryEvent({eventName:"CreatingSummarizer",throttlerDelay:e,initialDelay:this.initialDelayMs,startThrottlerMaxDelayMs:this.startThrottler.maxDelayMs,opsSinceLastAck:this.summaryCollection.opsSinceLastAck,opsToBypassInitialDelay:this.opsToBypassInitialDelay});let t=!1;if(this.summaryCollection.opsSinceLastAck<this.opsToBypassInitialDelay&&(t=!0,e=Math.max(e,this.initialDelayMs)),e>0){let t,r;const n=()=>{this.summaryCollection.opsSinceLastAck>=this.opsToBypassInitialDelay&&(clearTimeout(t),r())},s=new Promise((r=>{t=setTimeout((()=>r()),e)})),i=new Promise((e=>{r=e}));this.summaryCollection.addOpListener(n),await Promise.race([s,i]),this.summaryCollection.removeOpListener(n)}return t}dispose(){this.clientElection.off("electedSummarizerChanged",this.refreshSummarizer),this.connectedState.off("connected",this.handleConnected),this.connectedState.off("disconnected",this.handleDisconnected),this._disposed=!0}}re.isStartingOrRunning=e=>e===Q.Starting||e===Q.Running;class ne{constructor(e,t){this.logger=t,this.processingTimeIncrement=10,this.currentAllowedProcessingTimeForTurn=ne.processingTime,this.schedulingCount=0,this.deltaManager=e,this.deltaManager.inbound.on("idle",(()=>{this.inboundQueueIdle()}))}batchBegin(e){this.processingStartTime||(this.processingStartTime=o.now()),void 0===this.schedulingLog&&this.schedulingCount%500==0&&(this.schedulingLog={opsRemainingToProcess:0,numberOfTurns:1,totalProcessingTime:0,numberOfBatchesProcessed:0,firstSequenceNumber:e.sequenceNumber,lastSequenceNumber:e.sequenceNumber,startTime:o.now()})}batchEnd(e){if(this.schedulingLog&&(this.schedulingLog.numberOfBatchesProcessed++,this.schedulingLog.lastSequenceNumber=e.sequenceNumber,this.schedulingLog.opsRemainingToProcess=this.deltaManager.inbound.length),this.shouldRunScheduler()){const e=o.now(),t=e-this.processingStartTime;t>this.currentAllowedProcessingTimeForTurn&&(this.deltaManager.inbound.pause(),this.currentAllowedProcessingTimeForTurn+=this.processingTimeIncrement,this.schedulingLog&&(this.schedulingLog.numberOfTurns++,this.schedulingLog.totalProcessingTime+=t),setTimeout((()=>{this.schedulingLog&&this.logger.sendTelemetryEvent({eventName:"InboundOpsPartialProcessingTime",duration:g.hy.formatTick(t),opsProcessed:this.schedulingLog.lastSequenceNumber-this.schedulingLog.firstSequenceNumber+1,opsRemainingToProcess:this.deltaManager.inbound.length,processingTime:g.hy.formatTick(this.schedulingLog.totalProcessingTime),numberOfTurns:this.schedulingLog.numberOfTurns,batchesProcessed:this.schedulingLog.numberOfBatchesProcessed,timeToResume:g.hy.formatTick(o.now()-e)}),this.deltaManager.inbound.resume()})),this.processingStartTime=void 0)}}inboundQueueIdle(){if(this.schedulingLog){const e=o.now();this.schedulingLog.totalProcessingTime+=e-this.processingStartTime,this.logger.sendTelemetryEvent({eventName:"InboundOpsProcessingTime",opsRemainingToProcess:this.schedulingLog.opsRemainingToProcess,numberOfTurns:this.schedulingLog.numberOfTurns,processingTime:g.hy.formatTick(this.schedulingLog.totalProcessingTime),opsProcessed:this.schedulingLog.lastSequenceNumber-this.schedulingLog.firstSequenceNumber+1,batchesProcessed:this.schedulingLog.numberOfBatchesProcessed,duration:g.hy.formatTick(e-this.schedulingLog.startTime),schedulingCount:this.schedulingCount}),this.schedulingLog=void 0}this.schedulingCount++,this.processingStartTime=void 0,this.currentAllowedProcessingTimeForTurn=ne.processingTime}shouldRunScheduler(){return this.deltaManager.inbound.length>0}}ne.processingTime=50;class se{constructor(e,t,r){this.clientId=e,this.deltaManager=t,this.pongCount=0,this.msnTrackingTimestamp=0,this.opProcessingTimes={},this.opPerfData={},this.firstConnection=!0,this.bootTime=o.now(),this.connectionStartTime=0,this.gap=0,this.logger=g.G2.create(r,"OpPerf"),this.deltaManager.on("pong",(e=>this.recordPingTime(e))),this.deltaManager.on("submitOp",(e=>this.beforeOpSubmit(e))),this.deltaManager.on("op",(e=>this.afterProcessingOp(e))),this.deltaManager.on("connect",((e,t)=>{this.clientId=e.clientId,void 0!==t&&(this.connectionOpSeqNumber=this.deltaManager.lastKnownSeqNumber,this.gap=t,this.connectionStartTime=o.now(),this.gap<=0&&this.reportGettingUpToDate())})),this.deltaManager.on("disconnect",(()=>{this.sequenceNumberForMsnTracking=void 0,this.clientSequenceNumberForLatencyStatistics=void 0,this.opProcessingTimes={},this.opPerfData={},this.connectionOpSeqNumber=void 0,this.firstConnection=!1,this.pongCount=0})),this.deltaManager.outbound.on("push",(e=>{for(const t of e)t.type===u.Operation&&this.clientSequenceNumberForLatencyStatistics===t.clientSequenceNumber&&(i(void 0===this.opProcessingTimes.outboundPushEventTime,712),i(void 0===this.opPerfData.durationNetwork,713),this.opProcessingTimes.outboundPushEventTime=Date.now(),i(void 0===this.opPerfData.durationOutboundBatching,714),i(void 0!==this.opProcessingTimes.submitOpEventTime,715),this.opPerfData.durationOutboundBatching=this.opProcessingTimes.outboundPushEventTime-this.opProcessingTimes.submitOpEventTime)})),this.deltaManager.inbound.on("push",(e=>{this.clientId===e.clientId&&e.type===u.Operation&&this.clientSequenceNumberForLatencyStatistics===e.clientSequenceNumber&&void 0!==this.opProcessingTimes.outboundPushEventTime&&(this.opProcessingTimes.inboundPushEventTime=Date.now(),this.opPerfData.durationNetwork=this.opProcessingTimes.inboundPushEventTime-this.opProcessingTimes.outboundPushEventTime,this.opProcessingTimes.outboundPushEventTime=void 0,this.opPerfData.lengthInboundQueue=this.deltaManager.inbound.length)})),this.deltaManager.inbound.on("idle",((e,t)=>{"number"==typeof e&&e>=100&&this.logger.sendPerformanceEvent({eventName:"GetDeltas_OpProcessing",count:e,duration:t})}))}reportGettingUpToDate(){this.connectionOpSeqNumber=void 0,this.logger.sendPerformanceEvent({eventName:"ConnectionSpeed",duration:o.now()-this.connectionStartTime,ops:this.gap,timeToConnect:this.firstConnection?g.hy.formatTick(this.connectionStartTime-this.bootTime):void 0,firstConnection:this.firstConnection})}recordPingTime(e){this.pingLatency=e,this.pongCount%100==0&&this.deltaManager.active&&this.logger.sendPerformanceEvent({eventName:"DeltaLatency",duration:e}),this.pongCount++}beforeOpSubmit(e){void 0===this.clientSequenceNumberForLatencyStatistics&&e.clientSequenceNumber%500==1&&(i(void 0===this.opProcessingTimes.outboundPushEventTime,716),i(void 0===this.opPerfData.durationNetwork,717),this.opProcessingTimes.submitOpEventTime=Date.now(),this.clientSequenceNumberForLatencyStatistics=e.clientSequenceNumber)}afterProcessingOp(e){const t=e.sequenceNumber;if(t===this.connectionOpSeqNumber&&this.reportGettingUpToDate(),void 0===this.sequenceNumberForMsnTracking&&t%1e3==0&&(this.sequenceNumberForMsnTracking=t,this.msnTrackingTimestamp=e.timestamp),void 0!==this.sequenceNumberForMsnTracking&&e.minimumSequenceNumber>=this.sequenceNumberForMsnTracking&&(i(void 0!==this.msnTrackingTimestamp,718),this.logger.sendPerformanceEvent({eventName:"MsnStatistics",sequenceNumber:t,msnDistance:t-this.sequenceNumberForMsnTracking,duration:e.timestamp-this.msnTrackingTimestamp}),this.sequenceNumberForMsnTracking=void 0),this.clientId===e.clientId&&this.clientSequenceNumberForLatencyStatistics===e.clientSequenceNumber){i(void 0!==this.opProcessingTimes.submitOpEventTime,288);const r=Date.now();void 0!==this.opProcessingTimes.inboundPushEventTime&&(this.opPerfData.durationInboundToProcessing=r-this.opProcessingTimes.inboundPushEventTime);const n=r-this.opProcessingTimes.submitOpEventTime,s=n>5e3?"error":"performance";this.logger.sendPerformanceEvent(Object.assign({eventName:"OpRoundtripTime",sequenceNumber:t,referenceSequenceNumber:e.referenceSequenceNumber,duration:n,category:s,pingLatency:this.pingLatency,msnDistance:this.deltaManager.lastSequenceNumber-this.deltaManager.minimumSequenceNumber},this.opPerfData)),this.clientSequenceNumberForLatencyStatistics=void 0,this.opPerfData={}}}}class ie{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}}var oe=r(7237),ae=r.n(oe);class ce{constructor(e,t,r){var n;this.stateHandler=e,this.pendingStates=new(ae()),this.disposeOnce=new ie((()=>{this.initialStates.clear(),this.pendingStates.clear()})),this._pendingMessagesCount=0,this.isProcessingBatch=!1,this.dispose=()=>this.disposeOnce.value,this.initialStates=new(ae())(null!==(n=null==r?void 0:r.pendingStates)&&void 0!==n?n:[]),this.flushModeForNextMessage=t,this.onFlushModeUpdated(t)}get pendingMessagesCount(){return this._pendingMessagesCount}hasPendingMessages(){return 0!==this._pendingMessagesCount||!this.initialStates.isEmpty()}getLocalState(){if(i(this.initialStates.isEmpty(),745),this.hasPendingMessages())return{pendingStates:this.pendingStates.toArray().map((e=>"message"===e.type?Object.assign(Object.assign({},e),{localOpMetadata:void 0}):e))}}get disposed(){return this.disposeOnce.evaluated}onSubmitMessage(e,t,r,n,s,i){const o={type:"message",messageType:e,clientSequenceNumber:t,referenceSequenceNumber:r,content:n,localOpMetadata:s,opMetadata:i};this.pendingStates.push(o),this._pendingMessagesCount++}onFlushModeUpdated(e){this.pendingStates.push({type:"flushMode",flushMode:e})}onFlush(){if(this.stateHandler.flushMode()===w.FlushMode.Immediate)return;const e=this.pendingStates.peekBack();"message"===(null==e?void 0:e.type)&&this.pendingStates.push({type:"flush"})}async applyStashedOpsAt(e){for(;!this.initialStates.isEmpty();){const t=this.initialStates.peekFront();if("message"===t.type){if(void 0!==e){if(t.referenceSequenceNumber>e)break;if(t.referenceSequenceNumber<e)throw new Error("loaded from snapshot too recent to apply stashed ops")}const r=await this.stateHandler.applyStashedOp(t.messageType,t.content);t.localOpMetadata=r}this.pendingStates.push(this.initialStates.shift())}}processPendingLocalMessage(e){this.maybeProcessBatchBegin(e);const t=this.peekNextPendingState();if(i("message"===t.type,361),this.pendingStates.shift(),t.clientSequenceNumber===e.clientSequenceNumber)return this._pendingMessagesCount--,this.maybeProcessBatchEnd(e),t.localOpMetadata;{const r=S.Hi.create("pending local message clientSequenceNumber mismatch","unexpectedAckReceived",e,{expectedClientSequenceNumber:t.clientSequenceNumber});this.stateHandler.close(r)}}maybeProcessBatchBegin(e){let t,r=!1,n=this.peekNextPendingState();for(;"message"!==n.type;)"flushMode"===n.type&&(t=n.flushMode),"flush"===n.type&&(r=!0),this.pendingStates.shift(),n=this.peekNextPendingState();void 0!==t&&(this.flushModeForNextMessage=t),t!==w.FlushMode.Immediate&&(t===w.FlushMode.TurnBased||r)&&(i(!this.isProcessingBatch&&void 0===this.pendingBatchBeginMessage,363),this.pendingBatchBeginMessage=e,this.isProcessingBatch=!0)}maybeProcessBatchEnd(e){var t,r;if(!this.isProcessingBatch)return;const n=this.peekNextPendingState();if("message"===n.type)return;i("flushMode"!==n.type,701),i(void 0!==this.pendingBatchBeginMessage,365);const s=null===(t=this.pendingBatchBeginMessage.metadata)||void 0===t?void 0:t.batch;if(this.pendingBatchBeginMessage===e)i(void 0===s,366);else{const t=null===(r=e.metadata)||void 0===r?void 0:r.batch;i(!0===s,367),i(!1===t,368)}this.pendingBatchBeginMessage=void 0,this.isProcessingBatch=!1}checkpoint(){const e=this.pendingStates.peekBack();return{rollback:()=>{try{for(;this.pendingStates.peekBack()!==e;)this.rollbackNextPendingState()}catch(e){const t=(0,M.Jn)(e,(e=>S.Hi.create(`RollbackError: ${e}`,"checkpointRollback",void 0)));throw this.stateHandler.close(t),t}}}}peekNextPendingState(){const e=this.pendingStates.peekFront();return i(!!e,369),e}rollbackNextPendingState(){if(0===this.pendingStates.length)return;this._pendingMessagesCount--;const e=this.pendingStates.pop();if("message"!==e.type)throw new Error(`Can't rollback state ${e.type}`);this.stateHandler.rollback(e.messageType,e.content,e.localOpMetadata)}replayPendingStates(){i(this.stateHandler.connected(),370),i(this.clientId!==this.stateHandler.clientId(),371),this.clientId=this.stateHandler.clientId(),i(this.initialStates.isEmpty(),372);let e=this.pendingStates.length;if(0===e)return;this._pendingMessagesCount=0;const t=this.stateHandler.flushMode();for(this.stateHandler.setFlushMode(this.flushModeForNextMessage);e>0;){const t=this.pendingStates.shift();switch(t.type){case"message":this.stateHandler.reSubmit(t.messageType,t.content,t.localOpMetadata,t.opMetadata);break;case"flushMode":this.stateHandler.setFlushMode(t.flushMode);break;case"flush":this.stateHandler.flush()}e--}this.stateHandler.setFlushMode(t)}}const he="1.3.7";class le{constructor(e,t,r){this.path=e,this.routeContext=t,this.get=r,this.attached=!1,this.absolutePath=(0,P.H)(e,this.routeContext)}get IFluidHandle(){return this}get isAttached(){return this.attached}attachGraph(){this.attached=!0}bind(e){throw new Error("Cannot bind to blob handle")}}class ue{constructor(e,t,r,n,s,i,o){this.routeContext=e,this.getStorage=r,this.attachBlobCallback=n,this.gcNodeUpdated=s,this.runtime=i,this.logger=o,this.blobIds=new Set,this.pendingBlobIds=new Map,this.detachedBlobIds=new Set,this.runtime.once("dispose",(()=>{for(const e of this.pendingBlobIds.values())e.reject(new Error("runtime disposed while blobAttach op in flight"))})),this.load(t)}hasBlob(e){return this.blobIds.has(e)||this.detachedBlobIds.has(e)}getBlobGCNodePath(e){return`/${ue.basePath}/${e}`}async getBlob(e){var t,r;const n=null!==(r=null===(t=this.redirectTable)||void 0===t?void 0:t.get(e))&&void 0!==r?r:e;return i(this.hasBlob(n),287),this.gcNodeUpdated(this.getBlobGCNodePath(e)),new le(`${ue.basePath}/${n}`,this.routeContext,(async()=>g.Xr.timedExecAsync(this.logger,{eventName:"AttachmentReadBlob",id:n},(async()=>this.getStorage().readBlob(n)),{end:!0,cancel:"error"})))}async createBlob(e){var t,r;this.runtime.attachState===n.mB.Attaching&&(this.logger.sendTelemetryEvent({eventName:"CreateBlobWhileAttaching"}),await new Promise((e=>this.runtime.once("attached",e)))),this.runtime.connected||this.runtime.attachState!==n.mB.Attached||await new Promise((e=>this.runtime.once("connected",e)));const s=await g.Xr.timedExecAsync(this.logger,{eventName:"createBlob"},(async()=>this.getStorage().createBlob(e)),{end:!0,cancel:"error"}),i=new le(`${ue.basePath}/${s.id}`,this.routeContext,(async()=>this.getBlob(s.id).then((async e=>e.get()))));return this.runtime.attachState===n.mB.Detached?(this.detachedBlobIds.add(s.id),i):(this.pendingBlobIds.has(s.id)?await(null===(t=this.pendingBlobIds.get(s.id))||void 0===t?void 0:t.promise):this.blobIds.has(s.id)||(this.pendingBlobIds.set(s.id,new F),this.attachBlobCallback(s.id),await(null===(r=this.pendingBlobIds.get(s.id))||void 0===r?void 0:r.promise)),i)}processBlobAttachOp(e,t){if(t){const t=this.pendingBlobIds.get(e);i(void 0!==t,504),t.resolve(),this.pendingBlobIds.delete(e)}this.blobIds.add(e)}static async load(e,t){if(!e)return{};let r;const n=e.blobs[this.redirectTableBlobName];return n&&(r=await t(n)),{ids:Object.entries(e.blobs).filter((([e,t])=>e!==this.redirectTableBlobName)).map((([e,t])=>t)),redirectTable:r}}load(e){var t,r,s;if(e.ids){const t=this.runtime.attachState===n.mB.Detached;e.ids.map((e=>t?this.detachedBlobIds.add(e):this.blobIds.add(e)))}e.redirectTable&&(this.redirectTable=new Map(e.redirectTable)),this.logger.sendTelemetryEvent({eventName:"AttachmentBlobsLoaded",count:null!==(r=null===(t=e.ids)||void 0===t?void 0:t.length)&&void 0!==r?r:0,redirectTable:null===(s=e.redirectTable)||void 0===s?void 0:s.length})}getGCData(e=!1){const t={gcNodes:{}};if(this.blobIds.forEach((e=>{t.gcNodes[this.getBlobGCNodePath(e)]=[]})),void 0!==this.redirectTable)for(const[e,r]of this.redirectTable)t.gcNodes[this.getBlobGCNodePath(e)]=[this.getBlobGCNodePath(r)];return t}deleteUnusedRoutes(e){var t;for(const r of e){const e=r.split("/");i(3===e.length&&e[1]===ue.basePath,725);const n=e[2];(null===(t=this.redirectTable)||void 0===t?void 0:t.has(n))?this.redirectTable.delete(n):this.blobIds.delete(n)}}summarize(e){const t=this.redirectTable||this.runtime.attachState!==n.mB.Detached?this.blobIds:this.detachedBlobIds,r=new A.x1;return t.forEach((e=>{r.addAttachment(e)})),this.redirectTable&&this.redirectTable.size>0&&r.addBlob(ue.redirectTableBlobName,JSON.stringify(Array.from(this.redirectTable.entries()))),r.getSummaryTree()}setRedirectTable(e){i(this.runtime.attachState===n.mB.Detached,594),i(!this.redirectTable,595);for(const[t,r]of e)i(this.detachedBlobIds.delete(t),596),this.blobIds.add(r);i(0===this.detachedBlobIds.size,597),this.redirectTable=e}}ue.basePath="_blobs",ue.redirectTableBlobName=".redirectTable";var de=r(1748),pe=r(6144);class ge extends pe.P{constructor(e,t){super(e),this.blobs=t}get policies(){return this.internalStorageService.policies}async readBlob(e){const t=this.blobs.get(e);return void 0!==t?t:this.internalStorageService.readBlob(e)}}class me{constructor(e){this.notBoundContexts=new Set,this._contexts=new Map,this.deferredContexts=new Map,this.disposeOnce=new ie((()=>{for(const[e,t]of this.deferredContexts)t.promise.then((e=>{e.dispose()})).catch((t=>{this._logger.sendErrorEvent({eventName:"FluidDataStoreContextDisposeError",fluidDataStoreId:e},t)}))})),this.dispose=()=>this.disposeOnce.value,this._logger=g.G2.create(e)}[Symbol.iterator](){return this._contexts.entries()}get size(){return this._contexts.size}get disposed(){return this.disposeOnce.evaluated}notBoundLength(){return this.notBoundContexts.size}isNotBound(e){return this.notBoundContexts.has(e)}has(e){return this._contexts.has(e)}get(e){return this._contexts.get(e)}delete(e){return this.deferredContexts.delete(e),this.notBoundContexts.delete(e),this._contexts.delete(e)}getUnbound(e){if(void 0!==this._contexts.get(e)&&this.notBoundContexts.has(e))return this._contexts.get(e)}addUnbound(e){const t=e.id;i(!this._contexts.has(t),344),this._contexts.set(t,e),this.notBoundContexts.add(t),this.ensureDeferred(t)}async getBoundOrRemoted(e,t){const r=this.ensureDeferred(e);if(t||r.isCompleted)return r.promise}ensureDeferred(e){const t=this.deferredContexts.get(e);if(t)return t;const r=new F;return this.deferredContexts.set(e,r),r}bind(e){i(this.notBoundContexts.delete(e),345),this.resolveDeferred(e)}resolveDeferred(e){const t=this._contexts.get(e);i(!!t,346),i(!this.notBoundContexts.has(e),347);const r=this.deferredContexts.get(e);i(!!r,348),r.resolve(t)}addBoundOrRemoted(e){const t=e.id;i(!this._contexts.has(t),349),this._contexts.set(t,e),this.ensureDeferred(t),this.resolveDeferred(t)}}var fe=r(1044),ye=r(6171);function ve(e,t){const r=new Set,n=[...t];for(const t of n){if(r.has(t))continue;r.add(t);const s=e[t];void 0!==s&&n.push(...s)}const s=[],i=[];for(const t of Object.keys(e))r.has(t)?s.push(t):i.push(t);return{referencedNodeIds:s,deletedNodeIds:i}}var be=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]])}return r};const Se="gc",we="__gc",xe="DataStore",Ce="SubDataStore",Ee="Blob",Ae="Active",Te="Inactive",Oe="SweepReady";class Ne{constructor(e,t,r,n){this.unreferencedTimestampMs=e,this.inactiveTimeoutMs=t,this.sweepTimeoutMs=r,this._state=Ae,void 0!==n&&this.updateTracking(n)}get state(){return this._state}updateTracking(e){const t=e-this.unreferencedTimestampMs;if(void 0!==this.sweepTimeoutMs&&t>=this.sweepTimeoutMs)return this._state=Oe,void this.clearTimers();if(t>=this.inactiveTimeoutMs)return this._state=Te,this.clearTimers(),void(void 0!==this.sweepTimeoutMs&&Fe(this.sweepTimeoutMs-t,(()=>{this._state=Oe}),(e=>{this.sweepTimer=e})));const r=this.inactiveTimeoutMs-t;if(void 0===this.inactiveTimer){const e=()=>{this._state=Te,void 0!==this.sweepTimeoutMs&&Fe(this.sweepTimeoutMs-this.inactiveTimeoutMs,(()=>{this._state=Oe}),(e=>{this.sweepTimer=e}))};this.inactiveTimer=new H(r,(()=>e()))}this.inactiveTimer.restart(r)}clearTimers(){var e;null===(e=this.inactiveTimer)||void 0===e||e.clear(),void 0!==this.sweepTimer&&clearTimeout(this.sweepTimer)}stopTracking(){this.clearTimers(),this._state=Ae}}class Pe{constructor(e){var t,r,n,s,o,a,c;this._writeDataAtRoot=!0,this.initialStateNeedsReset=!1,this.currentGCVersion=1,this.newReferencesSinceLastRun=new Map,this.unreferencedNodesState=new Map,this.loggedUnreferencedEvents=new Set,this.pendingEventsQueue=[],this.completedRuns=0,this.runtime=e.runtime,this.isSummarizerClient=e.isSummarizerClient,this.gcOptions=e.gcOptions,this.getNodePackagePath=e.getNodePackagePath,this.getLastSummaryTimestampMs=e.getLastSummaryTimestampMs;const h=e.baseSnapshot,l=e.metadata,u=e.readAndParseBlob;let d;if(this.mc=(0,m.rZ)(g.G2.create(e.baseLogger,"GarbageCollector",{all:{completedGCRuns:()=>this.completedRuns}})),e.existing)d=_e(l),this.gcEnabled=d>0,this.sweepEnabled=null!==(t=null==l?void 0:l.sweepEnabled)&&void 0!==t&&t,this.sessionExpiryTimeoutMs=null==l?void 0:l.sessionExpiryTimeoutMs;else{if(this.gcOptions.sweepAllowed&&!1===this.gcOptions.gcAllowed)throw new S.Oi("GC sweep phase cannot be enabled without enabling GC mark phase");this.gcEnabled=!1!==this.gcOptions.gcAllowed,this.sweepEnabled=!0===this.gcOptions.sweepAllowed,this.mc.config.getBoolean("Fluid.GarbageCollection.RunSessionExpiry")&&this.gcEnabled&&(this.sessionExpiryTimeoutMs=2592e6)}if(void 0!==this.sessionExpiryTimeoutMs&&!0!==this.mc.config.getBoolean("Fluid.GarbageCollection.DisableSessionExpiry")){const t=this.mc.config.getNumber("Fluid.GarbageCollection.TestOverride.SessionExpiryMs"),r=null!=t?t:this.sessionExpiryTimeoutMs;Fe(r,(()=>{this.runtime.closeFn(new S.Lf("Client session expired.",r))}),(e=>{this.sessionExpiryTimer=e})),void 0!==e.snapshotCacheExpiryMs&&(this.sweepTimeoutMs=this.sessionExpiryTimeoutMs+e.snapshotCacheExpiryMs+864e5)}if(this.latestSummaryGCVersion=null!=d?d:this.currentGCVersion,this.shouldRunGC=null!==(r=this.mc.config.getBoolean("Fluid.GarbageCollection.RunGC"))&&void 0!==r?r:this.gcEnabled&&!this.gcOptions.disableGC,this.shouldRunSweep=this.shouldRunGC&&void 0!==this.sweepTimeoutMs&&(null!==(n=this.mc.config.getBoolean("Fluid.GarbageCollection.RunSweep"))&&void 0!==n?n:this.sweepEnabled),this.trackGCState=!0===this.mc.config.getBoolean("Fluid.GarbageCollection.TrackGCState"),this.inactiveTimeoutMs=null!==(o=null!==(s=this.mc.config.getNumber("Fluid.GarbageCollection.TestOverride.InactiveTimeoutMs"))&&void 0!==s?s:this.gcOptions.inactiveTimeoutMs)&&void 0!==o?o:6048e5,void 0!==this.sweepTimeoutMs&&this.inactiveTimeoutMs>this.sweepTimeoutMs)throw new S.Oi("inactive timeout should not be greated than the sweep timeout");if(this.testMode=null!==(a=this.mc.config.getBoolean("Fluid.GarbageCollection.GCTestMode"))&&void 0!==a?a:!0===this.gcOptions.runGCInTestMode,this._writeDataAtRoot=null===(c=this.mc.config.getBoolean("Fluid.GarbageCollection.WriteDataAtRoot"))||void 0===c||c,this._writeDataAtRoot){const e=void 0!==(null==h?void 0:h.trees[Se]);this.initialStateNeedsReset=e!==this.shouldRunGC}const p=new k((async()=>{var e;if(void 0===h)return;const t=h.trees[Se];if(void 0!==t){this._writeDataAtRoot=!0;const e=await Re(t,u);return this.trackGCState&&(this.latestSerializedSummaryState=JSON.stringify(Ie(e))),e}const r={gcNodes:{"/":{outboundRoutes:[]}}},n=nt(h,l);i(void 0!==n,680);for(const[t,s]of Object.entries(n.trees)){const n=s.blobs[w.gcBlobKey];if(void 0===n)continue;const o=await u(n);if(void 0===(null===(e=o.gcData)||void 0===e?void 0:e.gcNodes))continue;const a=`/${t}`;(await u(s.blobs[Ue])).isRootDataStore&&r.gcNodes["/"].outboundRoutes.push(a);for(const[e,t]of Object.entries(o.gcData.gcNodes)){const n="/"===e?a:`${a}${e}`;r.gcNodes[n]={outboundRoutes:Array.from(t)}}i(void 0!==r.gcNodes[a],681),r.gcNodes[a].unreferencedTimestampMs=o.unrefTimestamp}return 1===Object.keys(r.gcNodes).length?void 0:r}));this.initializeBaseStateP=new k((async()=>{const e=this.runtime.getCurrentReferenceTimestampMs(),t=await p;if(void 0===t)return;const r={};for(const[n,s]of Object.entries(t.gcNodes))void 0!==s.unreferencedTimestampMs&&this.unreferencedNodesState.set(n,new Ne(s.unreferencedTimestampMs,this.inactiveTimeoutMs,this.sweepTimeoutMs,e)),r[n]=Array.from(s.outboundRoutes);this.previousGCDataFromLastRun={gcNodes:r}})),this.baseGCDetailsP=new k((async()=>{const e=await p;if(void 0===e)return new Map;const t={};for(const[r,n]of Object.entries(e.gcNodes))t[r]=Array.from(n.outboundRoutes);const r=ve(t,["/"]).referencedNodeIds,n=(0,O.$I)({gcData:{gcNodes:t},usedRoutes:r});for(const[t,r]of Object.entries(e.gcNodes))if(void 0!==r.unreferencedTimestampMs){const e=n.get(t.slice(1));void 0!==e&&(e.unrefTimestamp=r.unreferencedTimestampMs)}return n}));const f=JSON.stringify(Object.assign({gcEnabled:this.gcEnabled,sweepEnabled:this.sweepEnabled,runGC:this.shouldRunGC,runSweep:this.shouldRunSweep,writeAtRoot:this._writeDataAtRoot,testMode:this.testMode,sessionExpiry:this.sessionExpiryTimeoutMs,inactiveTimeout:this.inactiveTimeoutMs,existing:e.existing,trackGCState:this.trackGCState},this.gcOptions));this.isSummarizerClient&&this.mc.logger.sendTelemetryEvent({eventName:"GarbageCollectorLoaded",gcConfigs:f}),this.shouldRunGC&&this.initializeBaseStateP.catch((e=>{const t=S.Hi.wrapIfUnrecognized(e,"FailedToInitializeGC");throw t.addTelemetryProperties({gcConfigs:f}),t}))}static create(e){return new Pe(e)}get summaryStateNeedsReset(){return this.initialStateNeedsReset||this.shouldRunGC&&this.latestSummaryGCVersion!==this.currentGCVersion}get writeDataAtRoot(){return this._writeDataAtRoot}async collectGarbage(e){const{fullGC:t=!0===this.gcOptions.runFullGC||this.summaryStateNeedsReset}=e,r=e.logger?g.G2.create(e.logger,void 0,{all:{completedGCRuns:()=>this.completedRuns}}):this.mc.logger;return g.Xr.timedExecAsync(r,{eventName:"GarbageCollection"},(async e=>{await this.runPreGCSteps();const n=await this.runtime.getGCData(t),s=ve(n.gcNodes,["/"]),i=await this.runPostGCSteps(n,s,r);return e.end(Object.assign({},i)),this.completedRuns++,i}),{end:!0,cancel:"error"})}async runPreGCSteps(){await this.initializeBaseStateP,await this.runtime.updateStateBeforeGC()}async runPostGCSteps(e,t,r){const n=this.generateStats(t);this.updateStateSinceLastRun(e,r);const s=this.runtime.getCurrentReferenceTimestampMs();return this.updateCurrentState(e,t,s),this.runtime.updateUsedRoutes(t.referencedNodeIds,s),this.logSweepEvents(r,s),this.testMode&&this.runtime.deleteUnusedRoutes(t.deletedNodeIds),await this.logUnreferencedEvents(r),n}summarize(e,t,r){var n;if(!this.shouldRunGC||void 0===this.previousGCDataFromLastRun)return;const s={gcNodes:{}};for(const[e,t]of Object.entries(this.previousGCDataFromLastRun.gcNodes))s.gcNodes[e]={outboundRoutes:t,unreferencedTimestampMs:null===(n=this.unreferencedNodesState.get(e))||void 0===n?void 0:n.unreferencedTimestampMs};const i=JSON.stringify(Ie(s));if(this.trackGCState&&(this.pendingSerializedSummaryState=i,void 0!==this.latestSerializedSummaryState&&this.latestSerializedSummaryState===i&&!e&&t)){const e=(0,A.Jz)();return e.handleNodeCount++,{summary:{type:p.Handle,handle:`/${Se}`,handleType:p.Tree},stats:e}}const o=new A.x1;return o.addBlob(`${we}_root`,i),o.getSummaryTree()}getMetadata(){return{gcFeature:this.gcEnabled?this.currentGCVersion:0,sessionExpiryTimeoutMs:this.sessionExpiryTimeoutMs,sweepEnabled:this.sweepEnabled}}async getBaseGCDetails(){return this.baseGCDetailsP}async latestSummaryStateRefreshed(e,t){if(!this.shouldRunGC||!e.latestSummaryUpdated)return;if(e.wasSummaryTracked)return this.latestSummaryGCVersion=this.currentGCVersion,this.initialStateNeedsReset=!1,void(this.trackGCState&&(this.latestSerializedSummaryState=this.pendingSerializedSummaryState,this.pendingSerializedSummaryState=void 0));const r=e.snapshot,n=r.blobs[qe];if(n){const e=await t(n);this.latestSummaryGCVersion=_e(e)}const s=r.trees[Se];if(void 0!==s&&this.trackGCState){const e=await Re(s,t);this.latestSerializedSummaryState=JSON.stringify(Ie(e))}else this.latestSerializedSummaryState=void 0;this.pendingSerializedSummaryState=void 0}nodeUpdated(e,t,r,n,s){if(!this.shouldRunGC)return;const i=this.unreferencedNodesState.get(e);i&&i.state!==Ae&&this.inactiveNodeUsed(t,e,i,void 0,n,r,s)}addedOutboundReference(e,t){var r;if(!this.shouldRunGC)return;const n=null!==(r=this.newReferencesSinceLastRun.get(e))&&void 0!==r?r:[];n.push(t),this.newReferencesSinceLastRun.set(e,n);const s=this.unreferencedNodesState.get(t);s&&s.state!==Ae&&this.inactiveNodeUsed("Revived",t,s,e)}dispose(){void 0!==this.sessionExpiryTimer&&(clearTimeout(this.sessionExpiryTimer),this.sessionExpiryTimer=void 0)}updateCurrentState(e,t,r){this.previousGCDataFromLastRun=(0,O.rn)(e),this.newReferencesSinceLastRun.clear();for(const e of t.referencedNodeIds){const t=this.unreferencedNodesState.get(e);void 0!==t&&(t.stopTracking(),this.unreferencedNodesState.delete(e))}if(void 0!==r)for(const e of t.deletedNodeIds){const t=this.unreferencedNodesState.get(e);void 0===t?this.unreferencedNodesState.set(e,new Ne(r,this.inactiveTimeoutMs,this.sweepTimeoutMs,r)):t.updateTracking(r)}}updateStateSinceLastRun(e,t){if(void 0===this.previousGCDataFromLastRun)return;const r=this.findMissingExplicitReferences(e,this.previousGCDataFromLastRun,this.newReferencesSinceLastRun);if(this.writeDataAtRoot&&r.length>0&&r.forEach((e=>{const r={eventName:"gcUnknownOutboundReferences",gcNodeId:e[0],gcRoutes:JSON.stringify(e[1])};t.sendPerformanceEvent(r)})),0===this.newReferencesSinceLastRun.size)return;const n=(0,O.$4)(this.previousGCDataFromLastRun,e);this.newReferencesSinceLastRun.forEach(((e,t)=>{void 0===n.gcNodes[t]?n.gcNodes[t]=e:n.gcNodes[t].push(...e)}));const s=ve(n.gcNodes,["/"]);for(const e of s.referencedNodeIds){const t=this.unreferencedNodesState.get(e);void 0!==t&&(t.stopTracking(),this.unreferencedNodesState.delete(e))}}findMissingExplicitReferences(e,t,r){i(void 0!==t,695);const n=Object.entries(e.gcNodes),s=[];return n.forEach((([e,n])=>{var i,o;const a=null!==(i=t.gcNodes[e])&&void 0!==i?i:[],c=null!==(o=r.get(e))&&void 0!==o?o:[],h=[];n.forEach((t=>{const r=this.runtime.getNodeType(t)===Ee||this.runtime.getNodeType(t)===xe,n=!e.startsWith(t);r&&n&&!a.includes(t)&&!c.includes(t)&&h.push(t)})),h.length>0&&s.push([e,h])})),s}generateStats(e){const t={nodeCount:0,dataStoreCount:0,attachmentBlobCount:0,unrefNodeCount:0,unrefDataStoreCount:0,unrefAttachmentBlobCount:0,updatedNodeCount:0,updatedDataStoreCount:0,updatedAttachmentBlobCount:0},r=(e,r)=>{t.nodeCount++;const n=void 0===this.previousGCDataFromLastRun||this.unreferencedNodesState.has(e)===r;n&&t.updatedNodeCount++,r||t.unrefNodeCount++,this.runtime.getNodeType(e)===xe&&(t.dataStoreCount++,n&&t.updatedDataStoreCount++,r||t.unrefDataStoreCount++),this.runtime.getNodeType(e)===Ee&&(t.attachmentBlobCount++,n&&t.updatedAttachmentBlobCount++,r||t.unrefAttachmentBlobCount++)};for(const t of e.referencedNodeIds)r(t,!0);for(const t of e.deletedNodeIds)r(t,!1);return t}logSweepEvents(e,t){!0!==this.mc.config.getBoolean("Fluid.GarbageCollection.DisableSweepLog")&&void 0!==t&&void 0!==this.sweepTimeoutMs&&this.unreferencedNodesState.forEach(((r,n)=>{if(r.state!==Oe)return;const s=this.runtime.getNodeType(n);if(s!==xe&&s!==Ee)return;const i=`Deleted-${n}`;this.loggedUnreferencedEvents.has(i)||(this.loggedUnreferencedEvents.add(i),e.sendTelemetryEvent({eventName:"GCObjectDeleted",id:n,type:s,age:t-r.unreferencedTimestampMs,timeout:this.sweepTimeoutMs,completedGCRuns:this.completedRuns,lastSummaryTime:this.getLastSummaryTimestampMs()}))}))}inactiveNodeUsed(e,t,r,n,s,i=this.runtime.getCurrentReferenceTimestampMs(),o){if(void 0===i||r.state===Ae)return;if(!this.isSummarizerClient&&"Loaded"!==e)return;const a=this.runtime.getNodeType(t);if(a!==xe&&a!==Ee)return;const c=r.state,h=`${c}-${t}-${e}`;if(this.loggedUnreferencedEvents.has(h))return;this.loggedUnreferencedEvents.add(h);const l={id:t,type:a,unrefTime:r.unreferencedTimestampMs,age:i-r.unreferencedTimestampMs,timeout:r.state===Te?this.inactiveTimeoutMs:this.sweepTimeoutMs,completedGCRuns:this.completedRuns,lastSummaryTime:this.getLastSummaryTimestampMs(),externalRequest:null==o?void 0:o[St.externalRequest],viaHandle:null==o?void 0:o[St.viaHandle],fromId:n};this.isSummarizerClient?this.pendingEventsQueue.push(Object.assign(Object.assign({},l),{usageType:e,state:c})):this.mc.logger.sendErrorEvent(Object.assign(Object.assign({},l),{eventName:`${c}Object_${e}`,pkg:s?{value:s.join("/"),tag:g.XI.CodeArtifact}:void 0}))}async logUnreferencedEvents(e){for(const t of this.pendingEventsQueue){const{usageType:r,state:n}=t,s=be(t,["usageType","state"]),i=this.unreferencedNodesState.get(t.id);if("Revived"===r==(void 0===i||i.state===Ae)){const i=await this.getNodePackagePath(t.id),o=t.fromId?await this.getNodePackagePath(t.fromId):void 0;e.sendErrorEvent(Object.assign(Object.assign({},s),{eventName:`${n}Object_${r}`,pkg:i?{value:i.join("/"),tag:g.XI.CodeArtifact}:void 0,fromPkg:o?{value:o.join("/"),tag:g.XI.CodeArtifact}:void 0}))}}this.pendingEventsQueue=[]}}async function Re(e,t){let r={gcNodes:{}};for(const n of Object.keys(e.blobs)){if(!n.startsWith(we))continue;const s=e.blobs[n];if(void 0===s)continue;const o=await t(s);i(void 0!==o,685),r=(0,O.eF)(r,o)}return r}function Ie(e){const t=Object.entries(e.gcNodes);t.sort((([e],[t])=>e.localeCompare(t)));const r={gcNodes:{}};for(const[e,n]of t)n.outboundRoutes.sort(),r.gcNodes[e]=n;return r}function Fe(e,t,r){const n=2147483647;let s;if(e>n){const i=e-n;s=setTimeout((()=>Fe(i,t,r)),n)}else s=setTimeout((()=>t()),e);r(s)}function ke(e){return e.summaryFormatVersion?e.summaryFormatVersion:"0.1"===e.snapshotFormatVersion?1:0}function De(e){return!!e.summaryFormatVersion&&!e.disableIsolatedChannels}const Me=".aliases",qe=".metadata",Le=".chunks",Be=".electedSummarizer",je=".blobs";function _e(e){var t;return e&&null!==(t=e.gcFeature)&&void 0!==t?t:0}const He=[".protocol",".logTail",".serviceProtocol",je,Se],Ue=".component";function ze(e){e.summary={type:p.Tree,tree:{[w.channelsTreeName]:e.summary}},e.stats.treeNodeCount++}function Ve(e,t,r){const n=JSON.stringify(e);return r?{pkg:n,snapshotFormatVersion:"0.1",isRootDataStore:t}:{pkg:n,summaryFormatVersion:2,isRootDataStore:t}}function Ge(e,t,r){const n=Ve(e,t,r);return new fe.Qp(Ue,JSON.stringify(n))}class Ke extends c{constructor(e,t,r,s,o){super(),this.existing=t,this.bindState=r,this.isLocalDataStore=s,this.makeLocallyVisibleFn=o,this._disposed=!1,this.detachedRuntimeCreation=!1,this.loaded=!1,this.pending=[],this._isInMemoryRoot=!1,this._containerRuntime=e.runtime,this.id=e.id,this.storage=e.storage,this.scope=e.scope,this.writeGCDataAtRoot=e.writeGCDataAtRoot,this.disableIsolatedChannels=e.disableIsolatedChannels,this.pkg=e.pkg,i(!this.id.includes("/"),314),this._attachState=this.containerRuntime.attachState!==n.mB.Detached&&this.existing?this.containerRuntime.attachState:n.mB.Detached,this.bindToContext=()=>{i(this.bindState===n.xU.NotBound,315),this.bindState=n.xU.Binding,i(void 0!==this.channel,316),this.makeLocallyVisible(),this.bindState=n.xU.Bound},this.summarizerNode=e.createSummarizerNodeFn((async(e,t,r)=>this.summarizeInternal(e,t,r)),(async e=>this.getGCDataInternal(e)),(async()=>this.getBaseGCDetails())),this.subLogger=g.G2.create(this.logger,"FluidDataStoreContext"),this.thresholdOpsCounter=new ye.z(Ke.pendingOpsCountThreshold,this.subLogger)}get packagePath(){return i(void 0!==this.pkg,313),this.pkg}get options(){return this._containerRuntime.options}get clientId(){return this._containerRuntime.clientId}get clientDetails(){return this._containerRuntime.clientDetails}get logger(){return this._containerRuntime.logger}get deltaManager(){return this._containerRuntime.deltaManager}get connected(){return this._containerRuntime.connected}get IFluidHandleContext(){return this._containerRuntime.IFluidHandleContext}get containerRuntime(){return this._containerRuntime}get isLoaded(){return this.loaded}get baseSnapshot(){return this._baseSnapshot}get disposed(){return this._disposed}get attachState(){return this._attachState}get IFluidDataStoreRegistry(){return this.registry}async isRoot(){return this.isInMemoryRoot()||(await this.getInitialSnapshotDetails()).isRootDataStore}isInMemoryRoot(){return this._isInMemoryRoot}dispose(){this._disposed||(this._disposed=!0,this.channelDeferred&&this.channelDeferred.promise.then((e=>{e.dispose()})).catch((e=>{})))}rejectDeferredRealize(e,t){throw new M.j4(e,{packageName:{value:t,tag:g.XI.PackageData}})}async realize(){return i(!this.detachedRuntimeCreation,317),this.channelDeferred||(this.channelDeferred=new F,this.realizeCore(this.existing).catch((e=>{var t;const r=S.Hi.wrapIfUnrecognized(e,"realizeFluidDataStoreContext");r.addTelemetryProperties({fluidDataStoreId:{value:this.id,tag:"PackageData"}}),null===(t=this.channelDeferred)||void 0===t||t.reject(r),this.logger.sendErrorEvent({eventName:"RealizeError"},r)}))),this.channelDeferred.promise}async factoryFromPackagePath(e){let t;i(this.pkg===e,318),void 0===e&&this.rejectDeferredRealize("packages is undefined");let r,n=this._containerRuntime.IFluidDataStoreRegistry;for(const s of e)n||this.rejectDeferredRealize("No registry for package",r),r=s,t=await n.get(s),t||this.rejectDeferredRealize("Registry does not contain entry for the package",s),n=t.IFluidDataStoreRegistry;const s=null==t?void 0:t.IFluidDataStoreFactory;return void 0===s&&this.rejectDeferredRealize("Can't find factory for package",r),{factory:s,registry:n}}async realizeCore(e){const t=await this.getInitialSnapshotDetails();this._baseSnapshot=t.snapshot;const r=t.pkg,{factory:n,registry:s}=await this.factoryFromPackagePath(r);i(void 0===this.registry,319),this.registry=s;const o=await n.instantiateDataStore(this,e);i(void 0!==o,320),this.bindRuntime(o)}setConnectionState(e,t){this.verifyNotClosed(),this.loaded&&(i(this.connected===e,321),this.channel.setConnectionState(e,t))}process(e,t,r){var n;this.verifyNotClosed();const s=e.contents,o=Object.assign(Object.assign({},e),{type:s.type,contents:s.content});if(this.summarizerNode.recordChange(o),this.loaded)return null===(n=this.channel)||void 0===n?void 0:n.process(o,t,r);i(!t,322),i(void 0!==this.pending,573),this.pending.push(o),this.thresholdOpsCounter.sendIfMultiple("StorePendingOps",this.pending.length)}processSignal(e,t){var r;this.verifyNotClosed(),this.loaded&&(null===(r=this.channel)||void 0===r||r.processSignal(e,t))}getQuorum(){return this._containerRuntime.getQuorum()}getAudience(){return this._containerRuntime.getAudience()}async summarize(e=!1,t=!0,r){return this.summarizerNode.summarize(e,t,r)}async summarizeInternal(e,t,r){await this.realize();const n=await this.channel.summarize(e,t,r);let s;this.disableIsolatedChannels||(ze(n),s=[w.channelsTreeName]);const{pkg:i}=await this.getInitialSnapshotDetails(),o=Ve(i,await this.isRoot(),this.disableIsolatedChannels);return(0,A.Rt)(n,Ue,JSON.stringify(o)),this.writeGCDataAtRoot||(0,A.Rt)(n,w.gcBlobKey,JSON.stringify(this.summarizerNode.getGCSummaryDetails())),this.summarizerNode.isReferenced()||(n.summary.unreferenced=!0,n.stats.unreferencedBlobSize=n.stats.totalBlobSize),Object.assign(Object.assign({},n),{id:this.id,pathPartsForChildren:s})}async getGCData(e=!1){return this.summarizerNode.getGCData(e)}async getGCDataInternal(e=!1){return await this.realize(),i(void 0!==this.channel,323),this.channel.getGCData(e)}updateUsedRoutes(e,t){this.summarizerNode.updateUsedRoutes(e,t),this.lastUsedState={usedRoutes:e,gcTimestamp:t},this.loaded&&this.updateChannelUsedRoutes()}addedGCOutboundReference(e,t){this._containerRuntime.addedGCOutboundReference(e,t)}updateChannelUsedRoutes(){if(i(this.loaded,324),i(void 0!==this.channel,325),void 0===this.lastUsedState)return;const e=this.lastUsedState.usedRoutes.filter((e=>"/"!==e&&""!==e));this.channel.updateUsedRoutes(e,this.lastUsedState.gcTimestamp)}async request(e){return(await this.realize()).request(e)}submitMessage(e,t,r){this.verifyNotClosed(),i(!!this.channel,326);const n={content:t,type:e};this._containerRuntime.submitDataStoreOp(this.id,n,r)}setChannelDirty(e){this.verifyNotClosed();const t=this.deltaManager.lastSequenceNumber;this.summarizerNode.invalidate(t);const r=this.summarizerNode.getChild(e);r&&r.invalidate(t)}submitSignal(e,t){return this.verifyNotClosed(),i(!!this.channel,327),this._containerRuntime.submitDataStoreSignal(this.id,e,t)}makeLocallyVisible(){i(void 0!==this.channel,719),this.makeLocallyVisibleFn()}bindRuntime(e){var t;if(this.channel)throw new Error("Runtime already bound");try{i(!this.detachedRuntimeCreation,328),i(void 0!==this.channelDeferred,329),i(void 0!==this.pkg,330);const t=this.pending;for(const r of t)e.process(r,!1,void 0);this.thresholdOpsCounter.send("ProcessPendingOps",t.length),this.pending=void 0,this.loaded=!0,this.channel=e,Object.freeze(this.pkg),this.updateChannelUsedRoutes(),this.channelDeferred.resolve(this.channel)}catch(e){null===(t=this.channelDeferred)||void 0===t||t.reject(e),this.logger.sendErrorEvent({eventName:"BindRuntimeError",fluidDataStoreId:{value:this.id,tag:"PackageData"}},e)}}async getAbsoluteUrl(e){if(this.attachState===n.mB.Attached)return this._containerRuntime.getAbsoluteUrl(e)}setInMemoryRoot(){this._isInMemoryRoot=!0}reSubmit(e,t){i(!!this.channel,331);const r=e;this.channel.reSubmit(r.type,r.content,t)}rollback(e,t){if(!this.channel)throw new Error("Channel must exist when rolling back ops");if(!this.channel.rollback)throw new Error("Channel doesn't support rollback");const r=e;this.channel.rollback(r.type,r.content,t)}async applyStashedOp(e){this.channel||await this.realize(),i(!!this.channel,332);const t=e;return this.channel.applyStashedOp(t.content)}verifyNotClosed(){if(this._disposed)throw new Error("Context is closed")}getCreateChildSummarizerNodeFn(e,t){return(r,n,s)=>this.summarizerNode.createChild(r,e,t,{throwOnFailure:!0},n,s)}async uploadBlob(e){return this.containerRuntime.uploadBlob(e)}}Ke.pendingOpsCountThreshold=1e3;class We extends Ke{constructor(e){super(e,!0,n.xU.Bound,!1,(()=>{throw new Error("Already attached")})),this.initialSnapshotDetailsP=new k((async()=>{var e,t;let r,n=!0;if("string"==typeof this.initSnapshotValue){const t=(await this.storage.getVersions(this.initSnapshotValue,1))[0];r=null!==(e=await this.storage.getSnapshotTree(t))&&void 0!==e?e:void 0}else r=this.initSnapshotValue;const s=async e=>(0,b.g)(this.storage,e);if(r){const e=await this.summarizerNode.loadBaseSummary(r,s);r=e.baseSummary,this.pending=e.outstandingOps.concat(this.pending)}if(r&&void 0!==r.blobs[Ue]){const e=await s(r.blobs[Ue]);let o;o=ke(e)<1?e.pkg.startsWith('["')&&e.pkg.endsWith('"]')?JSON.parse(e.pkg):[e.pkg]:JSON.parse(e.pkg),this.pkg=o,n=null===(t=e.isRootDataStore)||void 0===t||t,De(e)&&(r=r.trees[w.channelsTreeName],i(void 0!==r,510))}return{pkg:this.pkg,isRootDataStore:n,snapshot:r}})),this.initSnapshotValue=e.snapshotTree,this.baseGCDetailsP=new k((async()=>{var t;return null!==(t=await e.getBaseGCDetails())&&void 0!==t?t:{}}))}async getInitialSnapshotDetails(){return this.initialSnapshotDetailsP}async getInitialGCSummaryDetails(){return this.getBaseGCDetails()}async getBaseGCDetails(){return this.baseGCDetailsP}generateAttachMessage(){throw new Error("Cannot attach remote store")}}class $e extends Ke{constructor(e){super(e,void 0!==e.snapshotTree,e.snapshotTree?n.xU.Bound:n.xU.NotBound,!0,e.makeLocallyVisibleFn),this.snapshotTree=e.snapshotTree,!0===e.isRootDataStore&&this.setInMemoryRoot(),this.createProps=e.createProps,this.attachListeners()}attachListeners(){this.once("attaching",(()=>{i(this.attachState===n.mB.Detached,333),this._attachState=n.mB.Attaching})),this.once("attached",(()=>{i(this.attachState===n.mB.Attaching,334),this._attachState=n.mB.Attached}))}generateAttachMessage(){i(void 0!==this.channel,335),i(void 0!==this.pkg,336);const e=this.channel.getAttachSummary();this.disableIsolatedChannels||ze(e);const t=Ve(this.pkg,this.isInMemoryRoot(),this.disableIsolatedChannels);(0,A.Rt)(e,Ue,JSON.stringify(t));const r=(0,A.H4)(e.summary);return{id:this.id,snapshot:r,type:this.pkg[this.pkg.length-1]}}async getInitialSnapshotDetails(){var e;let t,r=this.snapshotTree,n=!1;return void 0!==r&&(t=await async function(e,t){const r=await(0,b.g)(e,t.blobs[Ue]);return i(ke(r)>0,469),r}(this.storage,r),De(t)&&(r=r.trees[w.channelsTreeName],i(void 0!==r,511)),void 0===this.pkg&&(this.pkg=JSON.parse(t.pkg),(null===(e=t.isRootDataStore)||void 0===e||e)&&(n=!0,this.setInMemoryRoot()))),i(void 0!==this.pkg,338),{pkg:this.pkg,isRootDataStore:n,snapshot:r}}async getInitialGCSummaryDetails(){return{}}async getBaseGCDetails(){return{}}}class Je extends $e{constructor(e){super(e)}}class Xe extends $e{constructor(e){super(e),this.detachedRuntimeCreation=!0}async attachRuntime(e,t){i(this.detachedRuntimeCreation,340),i(void 0===this.channelDeferred,341);const r=e.IFluidDataStoreFactory,n=await this.factoryFromPackagePath(this.pkg);i(n.factory===r,342),i(void 0===this.registry,343),this.registry=n.registry,this.detachedRuntimeCreation=!1,this.channelDeferred=new F,super.bindRuntime(t),await this.isRoot()&&(void 0!==t.makeVisibleAndAttachGraph?t.makeVisibleAndAttachGraph():t.bindToContext())}async getInitialSnapshotDetails(){if(this.detachedRuntimeCreation)throw new Error("Detached Fluid Data Store context can't be realized! Please attach runtime first!");return super.getInitialSnapshotDetails()}}const Qe=e=>"string"==typeof(null==e?void 0:e.internalId)&&"string"==typeof(null==e?void 0:e.alias),Ze=(e,t,r,n,s)=>new tt(e,t,r,n,s);var Ye,et;!function(e){e.Aliased="Aliased",e.Aliasing="Aliasing",e.None="None"}(Ye||(Ye={}));class tt{constructor(e,t,r,n,s){this.fluidDataStoreChannel=e,this.internalId=t,this.runtime=r,this.datastores=n,this.logger=s,this.aliasState=Ye.None}async trySetAlias(e){if(e.includes("/"))throw new S.Oi(`The alias cannot contain slashes: '${e}'`);switch(this.aliasState){case Ye.Aliasing:return i(void 0!==this.aliasResult,790),await this.aliasResult,this.alias===e?"Success":"AlreadyAliased";case Ye.Aliased:return this.alias===e?"Success":"AlreadyAliased";case Ye.None:break;default:h(this.aliasState)}return this.aliasState=Ye.Aliasing,this.aliasResult=this.trySetAliasInternal(e),this.aliasResult}async trySetAliasInternal(e){const t={internalId:this.internalId,alias:e};if(void 0!==this.fluidDataStoreChannel.makeVisibleAndAttachGraph?this.fluidDataStoreChannel.makeVisibleAndAttachGraph():this.fluidDataStoreChannel.bindToContext(),this.runtime.attachState===n.mB.Detached){const e=this.datastores.processAliasMessageCore(t);return this.aliasState=Ye.Aliased,e?"Success":"Conflict"}return await this.ackBasedPromise((e=>{this.runtime.submitDataStoreAliasOp(t,e)})).then((t=>(this.aliasState=Ye.Aliased,t&&(this.alias=e),t))).catch((t=>(this.logger.sendErrorEvent({eventName:"AliasingException",alias:{value:e,tag:g.XI.UserData},internalId:{value:this.internalId,tag:g.XI.PackageData}},t),this.aliasState=Ye.None,!1)))?"Success":"Conflict"}async request(e){return this.fluidDataStoreChannel.request(e)}get IFluidRouter(){return this.fluidDataStoreChannel}async ackBasedPromise(e){let t;return new Promise(((r,n)=>{t=()=>n(new Error("ContainerRuntime disposed while this ack-based Promise was pending")),this.runtime.disposed?t():(this.runtime.on("dispose",t),e(r,n))})).finally((()=>{this.runtime.off("dispose",t)}))}}class rt{constructor(e,t,r,s,i,o,a,c,h,l,u=new me(o)){this.baseSnapshot=e,this.runtime=t,this.submitAttachFn=r,this.getCreateChildSummarizerNodeFn=s,this.deleteChildSummarizerNodeFn=i,this.gcNodeUpdated=c,this.aliasMap=h,this.writeGCDataAtRoot=l,this.contexts=u,this.pendingAttach=new Map,this.attachOpFiredForDataStore=new Set,this.disposeOnce=new ie((()=>this.contexts.dispose())),this.dataStoresSinceLastGC=[],this.dispose=()=>this.disposeOnce.value,this.logger=g.G2.create(o),this.containerRuntimeHandle=new j.B(this.runtime,"/",this.runtime.IFluidHandleContext);const d=new k((async()=>a())),p=async e=>(await d).get(e),m=new Map;if(e)for(const[t,r]of Object.entries(e.trees))m.set(t,r);let f=0;for(const[e,t]of m){let r;if(t.unreferenced&&f++,this.runtime.attachState!==n.mB.Detached)r=new We({id:e,snapshotTree:t,getBaseGCDetails:async()=>p(e),runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(e,{type:w.CreateSummarizerNodeSource.FromSummary}),writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels});else{if("object"!=typeof t)throw new M.j4("Snapshot should be there to load from!!");const n=t;r=new Je({id:e,pkg:void 0,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(e,{type:w.CreateSummarizerNodeSource.FromSummary}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(e),snapshotTree:n,isRootDataStore:void 0,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels})}this.contexts.addBoundOrRemoted(r)}this.containerLoadStats={containerLoadDataStoreCount:m.size,referencedDataStoreCount:m.size-f}}aliases(){return this.aliasMap}processAttachMessage(e,t){var r,n;const s=e.contents;if(this.dataStoresSinceLastGC.push(s.id),t)return i(this.pendingAttach.has(s.id),350),null===(r=this.contexts.get(s.id))||void 0===r||r.emit("attached"),void this.pendingAttach.delete(s.id);if(this.alreadyProcessed(s.id))throw new S.Jd("Duplicate DataStore created with existing id",Object.assign(Object.assign({},(0,S.HN)(e)),{dataStoreId:{value:s.id,tag:g.XI.PackageData}}));const o=new Map;let a;s.snapshot&&(a=(0,de.m)(s.snapshot.entries,o));const c=[s.type],h=new We({id:s.id,snapshotTree:a,getBaseGCDetails:async()=>({}),runtime:this.runtime,storage:new ge(this.runtime.storage,o),scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(s.id,{type:w.CreateSummarizerNodeSource.FromAttach,sequenceNumber:e.sequenceNumber,snapshot:null!==(n=s.snapshot)&&void 0!==n?n:{entries:[Ge(c,!0,this.runtime.disableIsolatedChannels)]}}),writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels,pkg:c});this.contexts.addBoundOrRemoted(h)}processAliasMessage(e,t,r){const n=e.contents;if(!Qe(n))throw new S.Jd("malformedDataStoreAliasMessage",Object.assign({},(0,S.HN)(e)));const s=t,i=this.processAliasMessageCore(n);r&&s(i)}processAliasMessageCore(e){if(this.alreadyProcessed(e.alias))return!1;const t=this.contexts.get(e.internalId);if(void 0===t)return this.logger.sendErrorEvent({eventName:"AliasFluidDataStoreNotFound",fluidDataStoreId:e.internalId}),!1;const r=new j.B(t,e.internalId,this.runtime.IFluidHandleContext);return this.runtime.addedGCOutboundReference(this.containerRuntimeHandle,r),this.aliasMap.set(e.alias,t.id),t.setInMemoryRoot(),!0}alreadyProcessed(e){return void 0!==this.aliasMap.get(e)||void 0!==this.contexts.get(e)}makeDataStoreLocallyVisible(e){const t=this.contexts.getUnbound(e);if(i(!!t,351),this.runtime.attachState!==n.mB.Detached){t.emit("attaching");const r=t.generateAttachMessage();this.pendingAttach.set(e,r),this.submitAttachFn(r),this.attachOpFiredForDataStore.add(e)}this.contexts.bind(e)}createDetachedDataStoreCore(e,t,r=(0,N.Z)()){i(!r.includes("/"),780);const n=new Xe({id:r,pkg:e,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(r,{type:w.CreateSummarizerNodeSource.Local}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(r),snapshotTree:void 0,isRootDataStore:t,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels});return this.contexts.addUnbound(n),n}_createFluidDataStoreContext(e,t,r,n){i(!t.includes("/"),781);const s=new Je({id:t,pkg:e,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(t,{type:w.CreateSummarizerNodeSource.Local}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(t),snapshotTree:void 0,isRootDataStore:r,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels,createProps:n});return this.contexts.addUnbound(s),s}get disposed(){return this.disposeOnce.evaluated}resubmitDataStoreOp(e,t){const r=e,n=this.contexts.get(r.address);i(!!n,352),n.reSubmit(r.contents,t)}rollbackDataStoreOp(e,t){const r=e,n=this.contexts.get(r.address);i(!!n,744),n.rollback(r.contents,t)}async applyStashedOp(e){const t=e,r=this.contexts.get(t.address);return i(!!r,353),r.applyStashedOp(t.contents)}async applyStashedAttachOp(e){this.pendingAttach.set(e.id,e),this.processAttachMessage({contents:e},!1)}processFluidDataStoreOp(e,t,r){const n=e.contents,s=Object.assign(Object.assign({},e),{contents:n.contents}),o=this.contexts.get(n.address);i(!!o,354),o.process(s,t,r),this.gcNodeUpdated(`/${n.address}`,e.timestamp,o.isLoaded?o.packagePath:void 0)}async getDataStore(e,t){const r=await this.contexts.getBoundOrRemoted(e,t);if(void 0===r){const t={url:e};throw(0,E.fu)((0,E.I4)(t),t)}return r}processSignal(e,t,r){const n=this.contexts.get(e);if(!n)return i(!r,355),void this.logger.sendTelemetryEvent({eventName:"SignalFluidDataStoreNotFound",fluidDataStoreId:{value:e,tag:g.XI.PackageData}});n.processSignal(t,r)}setConnectionState(e,t){for(const[r,n]of this.contexts)try{n.setConnectionState(e,t)}catch(e){this.logger.sendErrorEvent({eventName:"SetConnectionStateError",clientId:t,fluidDataStore:r},e)}}setAttachState(e){let t;t=e===n.mB.Attaching?"attaching":"attached";for(const[,e]of this.contexts)this.contexts.isNotBound(e.id)||e.emit(t)}get size(){return this.contexts.size}async summarize(e,t,r){const s=new A.x1;return await Promise.all(Array.from(this.contexts).filter((([e,t])=>(i(t.attachState!==n.mB.Attaching,357),t.attachState===n.mB.Attached))).map((async([n,i])=>{const o=await i.summarize(e,t,r);s.addWithStats(n,o)}))),s.getSummaryTree()}createSummary(e){const t=new A.x1;let r;do{const e=t.summary.tree;r=this.contexts.notBoundLength(),Array.from(this.contexts).filter((([t,r])=>!(this.contexts.isNotBound(t)||e[t]||this.attachOpFiredForDataStore.has(t)))).map((([e,r])=>{let n;if(r.isLoaded){const e=r.generateAttachMessage().snapshot;n=(0,A.j9)(e,!0)}else i(!!this.baseSnapshot,358),n=(0,A.S5)(this.baseSnapshot.trees[e]);t.addWithStats(e,n)}))}while(r!==this.contexts.notBoundLength());return t.getSummaryTree()}async updateStateBeforeGC(){for(const e of this.dataStoresSinceLastGC){const t=this.contexts.get(e);if(i(void 0!==t,694),await t.isRoot()){const r=new j.B(t,e,this.runtime.IFluidHandleContext);this.runtime.addedGCOutboundReference(this.containerRuntimeHandle,r)}}this.dataStoresSinceLastGC=[]}async getGCData(e=!1){const t=new O.iR;return await Promise.all(Array.from(this.contexts).filter((([e,t])=>t.attachState===n.mB.Attached)).map((async([r,n])=>{const s=await n.getGCData(e);t.prefixAndAddNodes(r,s.gcNodes)}))),t.addNode("/",await this.getOutboundRoutes()),t.getGCData()}updateUsedRoutes(e,t){var r;const n=(0,O.xu)(e);for(const[e]of n)i(this.contexts.has(e),359);for(const[e,s]of this.contexts)s.updateUsedRoutes(null!==(r=n.get(e))&&void 0!==r?r:[],t)}deleteUnusedRoutes(e){for(const t of e){const e=t.split("/");if(e.length>2)continue;const r=e[1];i(this.contexts.has(r),727),this.contexts.delete(r),this.deleteChildSummarizerNodeFn(r)}}async getOutboundRoutes(){const e=[];for(const[t,r]of this.contexts)await r.isRoot()&&e.push(`/${t}`);return e}async getDataStorePackagePath(e){var t;const r=this.contexts.get(e.split("/")[1]);return null===(t=await(null==r?void 0:r.getInitialSnapshotDetails()))||void 0===t?void 0:t.pkg}getGCNodeType(e){const t=e.split("/");if(this.contexts.has(t[1]))return 2===t.length?xe:Ce}}function nt(e,t){if(e){if(function(e){return!!e&&!e.disableIsolatedChannels}(t)){const t=e.trees[w.channelsTreeName];return i(!!t,360),t}{const t={};for(const[r,n]of Object.entries(e.trees))He.includes(r)||(t[r]=n);return Object.assign(Object.assign({},e),{trees:t})}}}!function(e){e[e.Local=0]="Local",e[e.Broadcast=1]="Broadcast",e[e.Acked=2]="Acked",e[e.Nacked=-1]="Nacked"}(et||(et={}));class st{constructor(e,t){this.clientId=e,this.clientSequenceNumber=t,this.state=et.Local,this.defSummaryOp=new F,this.defSummaryAck=new F}static createLocal(e,t){return new st(e,t)}static createFromOp(e){const t=new st(e.clientId,e.clientSequenceNumber);return t.broadcast(e),t}get summaryOp(){return this._summaryOp}get summaryAckNack(){return this._summaryAckNack}hasBeenAcked(){return this.state===et.Acked}broadcast(e){return i(this.state===et.Local,373),this._summaryOp=e,this.defSummaryOp.resolve(),this.state=et.Broadcast,!0}ackNack(e){return i(this.state===et.Broadcast,374),this._summaryAckNack=e,this.defSummaryAck.resolve(),this.state=e.type===u.SummaryAck?et.Acked:et.Nacked,!0}async waitBroadcast(){return await this.defSummaryOp.promise,this._summaryOp}async waitAckNack(){return await this.defSummaryAck.promise,this._summaryAckNack}}class it{constructor(e,t){this.clientId=e,this.summaryCollection=t,this.localSummaries=new Map,this._disposed=!1}get disposed(){return this._disposed}watchSummary(e){let t=this.localSummaries.get(e);return t||(t=st.createLocal(this.clientId,e),this.localSummaries.set(t.clientSequenceNumber,t)),t}waitFlushed(){return this.summaryCollection.waitFlushed()}tryGetSummary(e){return this.localSummaries.get(e)}setSummary(e){this.localSummaries.set(e.clientSequenceNumber,e)}dispose(){this.summaryCollection.removeWatcher(this.clientId),this._disposed=!0}}class ot extends c{constructor(e,t){super(),this.deltaManager=e,this.logger=t,this.summaryWatchers=new Map,this.pendingSummaries=new Map,this.refreshWaitNextAck=new F,this.deltaManager.on("op",(e=>this.handleOp(e)))}get latestAck(){return this.lastAck}emit(e,...t){return super.emit(e,...t)}get opsSinceLastAck(){var e,t;return this.deltaManager.lastSequenceNumber-(null!==(t=null===(e=this.lastAck)||void 0===e?void 0:e.summaryAck.sequenceNumber)&&void 0!==t?t:this.deltaManager.initialSequenceNumber)}addOpListener(e){this.deltaManager.on("op",e)}removeOpListener(e){this.deltaManager.off("op",e)}createWatcher(e){const t=new it(e,this);return this.summaryWatchers.set(e,t),t}removeWatcher(e){this.summaryWatchers.delete(e)}setPendingAckTimerTimeoutCallback(e,t){this.maxAckWaitTime=e,this.pendingAckTimerTimeoutCallback=t}unsetPendingAckTimerTimeoutCallback(){this.maxAckWaitTime=void 0,this.pendingAckTimerTimeoutCallback=void 0}async waitFlushed(){for(;this.pendingSummaries.size>0;){const e=Array.from(this.pendingSummaries,(([,e])=>e.waitAckNack()));await Promise.all(e)}return this.lastAck}async waitSummaryAck(e){for(;!this.lastAck||this.lastAck.summaryOp.referenceSequenceNumber<e;)await this.refreshWaitNextAck.promise;return this.lastAck}handleOp(e){var t;switch(e.type){case u.Summarize:return void this.handleSummaryOp(e);case u.SummaryAck:return void this.handleSummaryAck(e);case u.SummaryNack:return void this.handleSummaryNack(e);default:{const r=e.timestamp;return void 0!==this.lastSummaryTimestamp&&void 0!==this.maxAckWaitTime&&r-this.lastSummaryTimestamp>=this.maxAckWaitTime&&(null===(t=this.pendingAckTimerTimeoutCallback)||void 0===t||t.call(this)),void this.emit("default",e)}}}handleSummaryOp(e){let t;const r=this.summaryWatchers.get(e.clientId);r&&(t=r.tryGetSummary(e.clientSequenceNumber),t&&t.broadcast(e)),t||(t=st.createFromOp(e),r&&r.setSummary(t)),this.pendingSummaries.set(e.sequenceNumber,t),this.lastSummaryTimestamp=e.timestamp,this.emit(u.Summarize,e)}handleSummaryAck(e){const t=e.contents.summaryProposal.summarySequenceNumber,r=this.pendingSummaries.get(t);r&&void 0!==r.summaryOp?(r.ackNack(e),this.pendingSummaries.delete(t),(!this.lastAck||t>this.lastAck.summaryAck.contents.summaryProposal.summarySequenceNumber)&&(this.lastAck={summaryOp:r.summaryOp,summaryAck:e},this.refreshWaitNextAck.resolve(),this.refreshWaitNextAck=new F,this.emit(u.SummaryAck,e))):t>=this.deltaManager.initialSequenceNumber&&this.logger.sendErrorEvent({eventName:"SummaryAckWithoutOp",sequenceNumber:e.sequenceNumber,summarySequenceNumber:t,initialSequenceNumber:this.deltaManager.initialSequenceNumber})}handleSummaryNack(e){const t=e.contents.summaryProposal.summarySequenceNumber,r=this.pendingSummaries.get(t);r&&(r.ackNack(e),this.pendingSummaries.delete(t),this.emit(u.SummaryNack,e))}}class at extends c{constructor(e,t,r){super(),this.clientMap=new Map,this.rootNode={sequenceNumber:-1,olderClient:void 0,youngerClient:void 0},this._youngestClient=this.rootNode,this.logger=g.G2.create(e,"OrderedClientCollection");const n=r.getMembers();for(const[e,t]of n)this.addClient(e,t);r.on("addMember",((e,r)=>{const n=this.addClient(e,r);this.emit("addClient",n,t.lastSequenceNumber)})),r.on("removeMember",(e=>{const r=t.lastSequenceNumber,n=this.removeClient(e);void 0===n?this.logger.sendErrorEvent({eventName:"ClientNotFound",clientId:e,sequenceNumber:r}):this.emit("removeClient",n,r)}))}get count(){return this.clientMap.size}get oldestClient(){return this.rootNode.youngerClient}addClient(e,t){i(t.sequenceNumber>-1,502);let r=this._youngestClient;for(;r.sequenceNumber>t.sequenceNumber;)i(void 0!==r.olderClient,503),r=r.olderClient;const n={clientId:e,sequenceNumber:t.sequenceNumber,client:Object.assign({},t.client),olderClient:r,youngerClient:r.youngerClient};return n.olderClient.youngerClient=n,void 0===n.youngerClient?this._youngestClient=n:n.youngerClient.olderClient=n,this.clientMap.set(e,n),n}removeClient(e){const t=this.clientMap.get(e);if(void 0!==t)return t.olderClient.youngerClient=t.youngerClient,void 0===t.youngerClient?this._youngestClient=t.olderClient:t.youngerClient.olderClient=t.olderClient,this.clientMap.delete(e),t}getAllClients(){const e=[];let t=this.rootNode;for(;void 0!==t.youngerClient;)e.push(t.youngerClient),t=t.youngerClient;return e}}class ct extends c{constructor(e,t,r,n){let s,i;super(),this.orderedClientCollection=t,this.isEligibleFn=n,this._eligibleCount=0;for(const e of t.getAllClients())this.addClient(e,0),"number"!=typeof r&&(e.clientId===r.electedClientId&&(s=e,void 0===r.electedParentId&&e.client.details.type!==L&&(i=e)),e.clientId===r.electedParentId&&(i=e));t.on("addClient",((e,t)=>this.addClient(e,t))),t.on("removeClient",((e,t)=>this.removeClient(e,t))),"number"==typeof r?this._electionSequenceNumber=r:((null==s?void 0:s.clientId)!==r.electedClientId?e.sendErrorEvent({eventName:"InitialElectedClientNotFound",electionSequenceNumber:r.electionSequenceNumber,expectedClientId:r.electedClientId,electedClientId:null==s?void 0:s.clientId,clientCount:t.count}):void 0===s||n(s)||(s=i=this.findFirstEligibleParent(i),e.sendErrorEvent({eventName:"InitialElectedClientIneligible",electionSequenceNumber:r.electionSequenceNumber,expectedClientId:r.electedClientId,electedClientId:null==s?void 0:s.clientId})),this._electedParent=i,this._electedClient=s,this._electionSequenceNumber=r.electionSequenceNumber)}get eligibleCount(){return this._eligibleCount}get electionSequenceNumber(){return this._electionSequenceNumber}get electedClient(){return this._electedClient}get electedParent(){return this._electedParent}tryElectingClient(e,t){let r=!1;const n=(null==e?void 0:e.client.details.type)===L,s=this._electedClient;this._electedClient!==e&&(this._electionSequenceNumber=t,this._electedClient=e,r=!0),this._electedParent===e||n||(this._electedParent=e,r=!0),r&&this.emit("election",e,t,s)}tryElectingParent(e,t){this._electedParent!==e&&(this._electedParent=e,this.emit("election",this._electedClient,t,this._electedClient))}findFirstEligibleParent(e){let t=e;for(;void 0!==t&&(!this.isEligibleFn(t)||t.client.details.type===L);)t=t.youngerClient;return t}addClient(e,t){var r;if(this.isEligibleFn(e)){this._eligibleCount++;const n=e.client.details.type===L,s=(null===(r=this._electedClient)||void 0===r?void 0:r.client.details.type)===L;void 0===this._electedClient||!s&&n?this.tryElectingClient(e,t):void 0!==this._electedParent||n||this.tryElectingParent(e,t)}}removeClient(e,t){var r,n,s,i,o;if(this.isEligibleFn(e))if(this._eligibleCount--,this._electedClient===e)if(this._electedParent!==e){if(this._electedClient.client.details.type!==L)throw new S.Oi("Elected client should be a summarizer client 1");this.tryElectingClient(this._electedParent,t)}else{const e=null!==(n=this.findFirstEligibleParent(null===(r=this._electedParent)||void 0===r?void 0:r.youngerClient))&&void 0!==n?n:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this.tryElectingClient(e,t)}else if(this._electedParent===e){if((null===(s=this._electedClient)||void 0===s?void 0:s.client.details.type)!==L)throw new S.Oi("Elected client should be a summarizer client 2");const e=null!==(o=this.findFirstEligibleParent(null===(i=this._electedParent)||void 0===i?void 0:i.youngerClient))&&void 0!==o?o:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this.tryElectingParent(e,t)}}getAllEligibleClients(){return this.orderedClientCollection.getAllClients().filter(this.isEligibleFn)}incrementElectedClient(e){var t,r;const n=null!==(r=this.findFirstEligibleParent(null===(t=this._electedParent)||void 0===t?void 0:t.youngerClient))&&void 0!==r?r:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);void 0===this._electedClient||this._electedClient===this._electedParent?this.tryElectingClient(n,e):this.tryElectingParent(n,e)}resetElectedClient(e){const t=this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);void 0===this._electedClient||this._electedClient===this._electedParent?this.tryElectingClient(t,e):this.tryElectingParent(t,e)}peekNextElectedClient(){var e,t;return null!==(t=this.findFirstEligibleParent(null===(e=this._electedParent)||void 0===e?void 0:e.youngerClient))&&void 0!==t?t:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient)}serialize(){var e,t;return{electionSequenceNumber:this.electionSequenceNumber,electedClientId:null===(e=this.electedClient)||void 0===e?void 0:e.clientId,electedParentId:null===(t=this.electedParent)||void 0===t?void 0:t.clientId}}}class ht{constructor(e,t,r){this.delayWindowMs=e,this.maxDelayMs=t,this.delayFn=r,this.startTimes=[]}get numAttempts(){return this.startTimes.length}getAttempts(){return[...this.startTimes]}get latestAttemptTime(){return this.startTimes.length>0?this.startTimes[this.startTimes.length-1]:void 0}getDelay(){const e=Date.now(),t=this.latestAttemptTime;if(void 0!==t){const r=t-e;r>0&&(this.startTimes=this.startTimes.map((e=>e-r)))}this.startTimes=this.startTimes.filter((t=>e-t<this.delayWindowMs));const r=Math.min(this.delayFn(this.startTimes.length),this.maxDelayMs);return this.startTimes.push(e),this.startTimes=this.startTimes.map((e=>e+r)),r===this.maxDelayMs&&this.startTimes.shift(),r}}new Promise((()=>{}));class lt{constructor(e){this.runtime=e,this._cancelled=!1,this.stopDeferred=new F}get cancelled(){return this._cancelled||i(this.runtime.deltaManager.active,605),this._cancelled}get waitCancelled(){return this.stopDeferred.promise}static async create(e){const t=new lt(e);return await t.waitStart(),t}async waitStart(){if(this.runtime.disposed)this.stop("summarizerClientDisconnected");else{if(this.runtime.once("dispose",(()=>this.stop("summarizerClientDisconnected"))),!this.runtime.connected){const e=new Promise((e=>this.runtime.once("connected",e)));await Promise.race([e,this.waitCancelled])}this.runtime.once("disconnected",(()=>this.stop("summarizerClientDisconnected")))}}stop(e){this._cancelled||(this._cancelled=!0,this.stopDeferred.resolve(e))}}class ut{constructor(e,t,r,n,s=(()=>o.now())){this.batchEventEmitter=e,this.trackedBatchCount=0,this.logger=g.G2.create(t,"Batching"),this.batchEventEmitter.on("batchBegin",(e=>{this.startBatchSequenceNumber=e.sequenceNumber,this.batchProcessingStartTimeStamp=s(),this.trackedBatchCount++})),this.batchEventEmitter.on("batchEnd",((e,t)=>{i(void 0!==this.startBatchSequenceNumber&&void 0!==this.batchProcessingStartTimeStamp,698);const o=t.sequenceNumber-this.startBatchSequenceNumber+1;o>=r&&this.logger.sendErrorEvent({eventName:"LengthTooBig",length:o,threshold:r,batchEndSequenceNumber:t.sequenceNumber,duration:s()-this.batchProcessingStartTimeStamp,batchError:void 0!==e}),this.trackedBatchCount%n==0&&this.logger.sendPerformanceEvent({eventName:"Length",length:o,samplingRate:n,batchEndSequenceNumber:t.sequenceNumber,duration:s()-this.batchProcessingStartTimeStamp}),this.startBatchSequenceNumber=void 0,this.batchProcessingStartTimeStamp=void 0}))}}var dt=r(9742);const pt=(e,t)=>mt.from(e).toString(t);function gt(e){const t=e;return e instanceof ArrayBuffer||"object"==typeof t&&null!==t&&"number"==typeof t.byteLength&&"function"==typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}class mt extends Uint8Array{toString(e){return function(e,t){switch(t){case"base64":return dt.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}(this,e)}static from(e,t,r){if("string"==typeof e)return mt.fromString(e,t);if(null!==e&&"object"==typeof e&&gt(e.buffer))return i(0===e.byteOffset,0),i(e.byteLength===e.buffer.byteLength,1),mt.fromArrayBuffer(e.buffer,t,r);if(gt(e))return mt.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const n=null!=t?t:0,s=null!=r?r:e.byteLength-n;if(n<0||n>e.byteLength||s<0||s+n>e.byteLength)throw new RangeError;return new mt(e,n,s)}static fromString(e,t){switch(t){case"base64":{const t=this.sanitizeBase64(e),r=dt.toByteArray(t);return new mt(r.buffer)}case"utf8":case"utf-8":case void 0:{const t=(new TextEncoder).encode(e);return new mt(t.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!=0&&(t+=["","===","==","="][t.length%4]),t}}class ft{constructor(e,t){this.storageGetter=e,this.blobs=t}static async serializeTree(e,t){const r={};return await this.serializeTreeCore(e,r,t),r}static async serializeTreeCore(e,t,r){const n=[];for(const s of Object.values(e.trees))n.push(this.serializeTreeCore(s,t,r));for(const n of Object.values(e.blobs)){const e=await r.readBlob(n);t[n]=pt(e,"utf8")}return Promise.all(n)}static serializeTreeWithBlobContents(e){const t={};return this.serializeTreeWithBlobContentsCore(e,t),t}static serializeTreeWithBlobContentsCore(e,t){for(const r of Object.values(e.trees))this.serializeTreeWithBlobContentsCore(r,t);for(const r of Object.values(e.blobs)){const n=e.blobsContents[r];i(!!n,748),t[r]=pt(n,"utf8")}}get storage(){return this._storage||(this._storage=this.storageGetter()),this._storage}get repositoryUrl(){return this.storage.repositoryUrl}async readBlob(e){return void 0!==this.blobs[e]?(t=this.blobs[e],"utf8",mt.from(t,"utf8").buffer):this.storage.readBlob(e);var t}async getSnapshotTree(e){return this.storage.getSnapshotTree(e)}async getVersions(e,t){return this.storage.getVersions(e,t)}async createBlob(e){return this.storage.createBlob(e)}async uploadSummaryWithContext(e,t){return this.storage.uploadSummaryWithContext(e,t)}async downloadSummary(e){return this.storage.downloadSummary(e)}}class yt{constructor(e,t){this.messageSize=new Map,this._nonSystemOpCount=0,this._opsSizeAccumulator=0,t||(e.inbound.on("push",(e=>{var t;const r="string"==typeof e.contents?e.contents:null!==(t=JSON.stringify(e.contents))&&void 0!==t?t:"",n=yt.messageHasData(e)?e.data:"";this.messageSize[yt.messageId(e)]=r.length+n.length})),e.on("op",(e=>{var t;this._nonSystemOpCount+=(0,v.LW)(e)?1:0;const r=yt.messageId(e);this._opsSizeAccumulator+=null!==(t=this.messageSize[r])&&void 0!==t?t:0,this.messageSize.delete(r)})))}get nonSystemOpCount(){return this._nonSystemOpCount}get opsSizeAccumulator(){return this._opsSizeAccumulator}static messageId(e){return e.sequenceNumber}static messageHasData(e){return void 0!==e.data}reset(){this._nonSystemOpCount=0,this._opsSizeAccumulator=0}}var vt;!function(e){e.FluidDataStoreOp="component",e.Attach="attach",e.ChunkedOp="chunkedOp",e.BlobAttach="blobAttach",e.Rejoin="rejoin",e.Alias="alias"}(vt||(vt={}));const bt={state:"enabled",idleTime:15e3,maxTime:6e4,maxOps:100,minOpsForLastSummaryAttempt:10,maxAckWaitTime:6e4,maxOpsSinceLastSummary:7e3,initialSummarizerDelayMs:5e3,summarizerClientElection:!1};var St;!function(e){e.wait="wait",e.externalRequest="externalRequest",e.viaHandle="viaHandle"}(St||(St={}));const wt=w.FlushMode.TurnBased;var xt;!function(e){e.FluidDataStoreOp="component",e.Attach="attach",e.ChunkedOp="chunkedOp",e.BlobAttach="blobAttach",e.Rejoin="rejoin",e.Alias="alias",e.Operation="op"}(xt||(xt={}));class Ct{constructor(e,t){this.deltaManager=e,this.logger=t,this.localPaused=!1,this.timePaused=0,this.batchCount=0,this.deltaManager.on("prepareSend",(e=>{if(0===e.length)return;const t=e[0].metadata;if(!(null==t?void 0:t.batch))return;if(1===e.length)return void delete t.batch;const r=e[e.length-1];r.metadata=Object.assign(Object.assign({},r.metadata),{batch:!1})})),this.deltaManager.inbound.on("push",(e=>{this.trackPending(e)})),i(!this.localPaused,659);const r=this.deltaManager.inbound.toArray();for(const e of r)this.trackPending(e);this.deltaManager.on("op",(e=>this.afterOpProcessing(e.sequenceNumber)))}afterOpProcessing(e){i(!this.localPaused,660),0!==this.deltaManager.inbound.length?void 0!==this.pauseSequenceNumber&&(i(e<this.pauseSequenceNumber,662),e+1===this.pauseSequenceNumber&&this.pauseQueue()):i(void 0===this.pauseSequenceNumber,661)}pauseQueue(){i(!this.localPaused,663),this.localPaused=!0,this.timePaused=o.now(),this.deltaManager.inbound.pause()}resumeQueue(e,t){const r=t.sequenceNumber,n=this.localPaused?o.now()-this.timePaused:void 0;this.batchCount++,this.batchCount%1e3==1&&this.logger.sendTelemetryEvent({eventName:"BatchStats",sequenceNumber:r,length:r-e+1,msnDistance:r-t.minimumSequenceNumber,duration:n,batchCount:this.batchCount,interrupted:this.localPaused}),this.localPaused&&(this.localPaused=!1,void 0!==n&&n>5e3&&this.logger.sendErrorEvent({eventName:"MaxBatchWaitTimeExceeded",duration:n,sequenceNumber:r,length:r-e}),this.deltaManager.inbound.resume())}trackPending(e){i(0!==this.deltaManager.inbound.length,664),i(void 0===this.currentBatchClientId==(void 0===this.pauseSequenceNumber),665);const t=e.metadata,r=null==t?void 0:t.batch;if(!(0,v._V)(e))return i(void 0===this.currentBatchClientId,666),i(void 0===r,667),void i(!this.localPaused,668);if(void 0!==this.currentBatchClientId||void 0!==r){if((void 0!==this.currentBatchClientId||!1===r)&&this.currentBatchClientId!==e.clientId)throw new S.Jd("OpBatchIncomplete",Object.assign({runtimeVersion:he,batchClientId:this.currentBatchClientId},(0,S.HN)(e)));r?(i(void 0===this.currentBatchClientId,670),i(!this.localPaused,671),this.pauseSequenceNumber=e.sequenceNumber,this.currentBatchClientId=e.clientId,1===this.deltaManager.inbound.length&&this.pauseQueue()):!1===r?(i(void 0!==this.pauseSequenceNumber,672),this.resumeQueue(this.pauseSequenceNumber,e),this.pauseSequenceNumber=void 0,this.currentBatchClientId=void 0):i(void 0!==this.currentBatchClientId,673)}else i(!this.localPaused,669)}}class Et{constructor(e,t,r){this.deltaManager=e,this.emitter=t,this.logger=r,this.hitError=!1,this.deltaScheduler=new ne(this.deltaManager,g.G2.create(this.logger,"DeltaScheduler")),new Ct(e,r)}beforeOpProcessing(e){var t;if(this.batchClientId!==e.clientId){i(void 0===this.batchClientId,674),this.emitter.emit("batchBegin",e),this.deltaScheduler.batchBegin(e);const r=null===(t=null==e?void 0:e.metadata)||void 0===t?void 0:t.batch;this.batchClientId=r?e.clientId:void 0}}afterOpProcessing(e,t){var r;if(i(!this.hitError,675),e)return this.hitError=!0,this.batchClientId=void 0,this.emitter.emit("batchEnd",e,t),void this.deltaScheduler.batchEnd(t);const n=null===(r=null==t?void 0:t.metadata)||void 0===r?void 0:r.batch;return void 0===this.batchClientId||!1===n?(this.batchClientId=void 0,this.emitter.emit("batchEnd",void 0,t),void this.deltaScheduler.batchEnd(t)):void 0}}const At="_scheduler";class Tt extends c{constructor(e,t,r,s,o,a,c,h,l,d,p,f,y,v){var w,C,E,A,T,O,N,P,I;void 0===v&&(v=Object.assign(Object.assign({},bt),null===(w=c.summaryOptions)||void 0===w?void 0:w.summaryConfigOverrides)),super(),this.context=e,this.registry=t,this.runtimeOptions=c,this.containerScope=h,this.logger=l,this._storage=f,this.requestHandler=y,this.summaryConfiguration=v,this.defaultMaxConsecutiveReconnects=15,this._orderSequentiallyCalls=0,this.needsFlush=!1,this.flushTrigger=!1,this.savedOps=[],this.consecutiveReconnects=0,this._disposed=!1,this.emitDirtyDocumentEvent=!0,this.defaultTelemetrySignalSampleCount=100,this._perfSignalData={signalsLost:0,signalSequenceNumber:0,signalTimestamp:0,trackingSignalSequenceNumber:void 0},this.summarizeOnDemand=(...e)=>{if(this.clientDetails.type===L)return this.summarizer.summarizeOnDemand(...e);if(void 0!==this.summaryManager)return this.summaryManager.summarizeOnDemand(...e);throw new S.Oi(`Can't summarize, disableSummaries: ${this.summariesDisabled}`)},this.enqueueSummarize=(...e)=>{if(this.clientDetails.type===L)return this.summarizer.enqueueSummarize(...e);if(void 0!==this.summaryManager)return this.summaryManager.enqueueSummarize(...e);throw new S.Oi(`Can't summarize, disableSummaries: ${this.summariesDisabled}`)},this.messageAtLastSummary=null==r?void 0:r.message,this.disableIsolatedChannels=null!==(C=this.runtimeOptions.summaryOptions.disableIsolatedChannels)&&void 0!==C&&C,this._connected=this.context.connected,this.chunkMap=new Map(o),this.handleContext=new R("",this),this.mc=(0,m.rZ)(g.G2.create(this.logger,"ContainerRuntime")),this.summariesDisabled=this.isSummariesDisabled(),this.heuristicsDisabled=this.isHeuristicsDisabled(),this.summarizerClientElectionEnabled=this.isSummarizerClientElectionEnabled(),this.maxOpsSinceLastSummary=this.getMaxOpsSinceLastSummary(),this.initialSummarizerDelayMs=this.getInitialSummarizerDelayMs(),this._aliasingEnabled=null!==(E=this.mc.config.getBoolean("Fluid.ContainerRuntime.UseDataStoreAliasing"))&&void 0!==E&&E||null!==(A=c.useDataStoreAliasing)&&void 0!==A&&A,this._maxOpSizeInBytes=null!==(T=this.mc.config.getNumber("Fluid.ContainerRuntime.MaxOpSizeInBytes"))&&void 0!==T?T:768e3,this.maxConsecutiveReconnects=null!==(O=this.mc.config.getNumber("Fluid.ContainerRuntime.MaxConsecutiveReconnects"))&&void 0!==O?O:this.defaultMaxConsecutiveReconnects,this._flushMode=c.flushMode;const F=e.pendingLocalState,k=null!==(N=null==F?void 0:F.baseSnapshot)&&void 0!==N?N:e.baseSnapshot;this.garbageCollector=Pe.create({runtime:this,gcOptions:this.runtimeOptions.gcOptions,baseSnapshot:k,baseLogger:this.mc.logger,existing:d,metadata:r,isSummarizerClient:this.context.clientDetails.type===L,getNodePackagePath:async e=>this.getGCNodePackagePath(e),getLastSummaryTimestampMs:()=>{var e;return null===(e=this.messageAtLastSummary)||void 0===e?void 0:e.timestamp},readAndParseBlob:async e=>(0,b.g)(this.storage,e)});const D=this.deltaManager.initialSequenceNumber;if(this.summarizerNode=(0,x.G)(g.G2.create(this.logger,"SummarizerNode"),(async(e,t,r)=>this.summarizeInternal(e,t,r)),D,k?D:void 0,{canReuseHandle:!1,throwOnFailure:!0,gcDisabled:!this.garbageCollector.shouldRunGC}),k&&this.summarizerNode.loadBaseSummaryWithoutDifferential(k),this.dataStores=new rt(nt(k,r),this,(e=>this.submit(vt.Attach,e)),((e,t)=>(r,n,s)=>this.summarizerNode.createChild(r,e,t,void 0,n,s)),(e=>this.summarizerNode.deleteChild(e)),this.mc.logger,(async()=>this.garbageCollector.getBaseGCDetails()),((e,t,r)=>this.garbageCollector.nodeUpdated(e,"Changed",t,r)),new Map(a),this.garbageCollector.writeDataAtRoot),this.blobManager=new ue(this.handleContext,p,(()=>this.storage),(e=>this.submit(vt.BlobAttach,void 0,void 0,{blobId:e})),(e=>this.garbageCollector.nodeUpdated(e,"Loaded")),this,this.logger),this.scheduleManager=new Et(e.deltaManager,this,g.G2.create(this.logger,"ScheduleManager")),this.deltaSender=this.deltaManager,this.pendingStateManager=new ce({applyStashedOp:this.applyStashedOp.bind(this),clientId:()=>this.clientId,close:this.closeFn,connected:()=>this.connected,flush:this.flush.bind(this),flushMode:()=>this.flushMode,reSubmit:this.reSubmit.bind(this),rollback:this.rollback.bind(this),setFlushMode:e=>this.setFlushMode(e)},this._flushMode,null==F?void 0:F.pending),this.context.quorum.on("removeMember",(e=>{this.clearPartialChunks(e)})),this.summaryCollection=new ot(this.deltaManager,this.logger),this.dirtyContainer=this.context.attachState!==n.mB.Attached||this.pendingStateManager.hasPendingMessages(),this.context.updateDirtyContainerState(this.dirtyContainer),this.summariesDisabled)this.mc.logger.sendTelemetryEvent({eventName:"SummariesDisabled"});else{const e=g.G2.create(this.logger,"OrderedClientElection"),t=new at(e,this.context.deltaManager,this.context.quorum),r=new ct(e,t,null!=s?s:this.context.deltaManager.lastSequenceNumber,B.isClientEligible);if(this.summarizerClientElection=new B(e,this.summaryCollection,r,this.maxOpsSinceLastSummary,this.summarizerClientElectionEnabled),this.context.clientDetails.type===L)this._summarizer=new te("/_summarizer",this,(()=>this.summaryConfiguration),this,this.handleContext,this.summaryCollection,(async e=>lt.create(e)));else if(B.clientDetailsPermitElection(this.context.clientDetails)){const e=()=>{this.summaryCollection.opsSinceLastAck>this.maxOpsSinceLastSummary&&(this.logger.sendErrorEvent({eventName:"SummaryStatus:Behind"}),this.summaryCollection.once(u.SummaryAck,(()=>{this.logger.sendTelemetryEvent({eventName:"SummaryStatus:CaughtUp"}),this.summaryCollection.on("default",e)})),this.summaryCollection.off("default",e))};this.summaryCollection.on("default",e),this.summaryManager=new re(this.summarizerClientElection,this,this.summaryCollection,this.logger,this.formRequestSummarizerFn(this.context.loader),new ht(6e4,3e4,(({multiplier:e=2,coefficient:t=1,offset:r=0,initialDelay:n}={})=>s=>Math.max(0,s<=0&&void 0!==n?n:t*Math.pow(e,s)+r))({coefficient:20,initialDelay:0})),{initialDelayMs:this.initialSummarizerDelayMs},this.heuristicsDisabled),this.summaryManager.start()}}let M;this.deltaManager.on("readonly",(e=>{i(e===this.deltaManager.readOnlyInfo.readonly,292),i(!e||!this.connected,293),this.replayPendingStates()})),l.sendTelemetryEvent(Object.assign({eventName:"DeviceSpec"},function(){try{if("object"==typeof navigator&&null!==navigator)return{deviceMemory:navigator.deviceMemory,hardwareConcurrency:navigator.hardwareConcurrency}}catch(e){}return{}}())),d?(this.createContainerMetadata={createContainerRuntimeVersion:null==r?void 0:r.createContainerRuntimeVersion,createContainerTimestamp:null==r?void 0:r.createContainerTimestamp},M=null!==(I=null!==(P=null==r?void 0:r.summaryNumber)&&void 0!==P?P:null==r?void 0:r.summaryCount)&&void 0!==I?I:0):(this.createContainerMetadata={createContainerRuntimeVersion:he,createContainerTimestamp:Date.now()},M=0),this.nextSummaryNumber=M+1,this.logger.sendTelemetryEvent(Object.assign(Object.assign(Object.assign({eventName:"ContainerLoadStats"},this.createContainerMetadata),this.dataStores.containerLoadStats),{summaryNumber:M,summaryFormatVersion:null==r?void 0:r.summaryFormatVersion,disableIsolatedChannels:null==r?void 0:r.disableIsolatedChannels,gcVersion:null==r?void 0:r.gcFeature})),function(e,t,r){new se(e,t,r)}(this.context.clientId,this.deltaManager,this.logger),((e,t,r=1e3,n=1e3)=>{new ut(e,t,r,n)})(this,this.logger),this.opTracker=new yt(this.deltaManager,!0===this.mc.config.getBoolean("Fluid.ContainerRuntime.DisableOpTracking"))}get IContainerRuntime(){return this}get IFluidRouter(){return this}static async load(e,t,r,n={},s=e.scope,o){var a,c,h;const l=e,u=null!==(a=l.taggedLogger)&&void 0!==a?a:new g.cP(l.logger),d=g.G2.create(u,void 0,{all:{runtimeVersion:he}}),{summaryOptions:p={},gcOptions:m={},loadSequenceNumberVerification:f="close",useDataStoreAliasing:y=!1,flushMode:v=wt,enableOfflineLoad:w=!1}=n,x=e.pendingLocalState,C=null!==(c=null==x?void 0:x.baseSnapshot)&&void 0!==c?c:e.baseSnapshot,E=x?new ft((()=>e.storage),x.snapshotBlobs):e.storage,A=new I.P(t),T=async e=>{const t=null==C?void 0:C.blobs[e];if(C&&t)return i(void 0!==E,501),(0,b.g)(E,t)},[O,N,P,R]=await Promise.all([T(Le),T(qe),T(Be),T(Me)]),F=!0===o||!0===e.existing,k=await ue.load(null==C?void 0:C.trees[je],(async e=>(i(void 0!==E,598),(0,b.g)(E,e)))),D=null===(h=null==N?void 0:N.message)||void 0===h?void 0:h.sequenceNumber;if(!x&&void 0!==D){const t=e.deltaManager.initialSequenceNumber;if("bypass"!==f&&D!==t){const r=new S.Jd("Summary metadata mismatch",{runtimeVersion:he,runtimeSequenceNumber:D,protocolSequenceNumber:t});"log"===f?d.sendErrorEvent({eventName:"SequenceNumberMismatch"},r):e.closeFn(r)}}const M=new Tt(e,A,N,P,null!=O?O:[],null!=R?R:[],{summaryOptions:p,gcOptions:m,loadSequenceNumberVerification:f,useDataStoreAliasing:y,flushMode:v,enableOfflineLoad:w},s,d,F,k,E,r);return x&&(await M.processSavedOps(x),x.savedOps=[]),await M.getSnapshotBlobs(),M}get options(){return this.context.options}get clientId(){return this.context.clientId}get clientDetails(){return this.context.clientDetails}get deltaManager(){return this.context.deltaManager}get storage(){return this._storage}get reSubmitFn(){return this.reSubmit}get closeFn(){return this.context.closeFn}get flushMode(){return this._flushMode}get scope(){return this.containerScope}get IFluidDataStoreRegistry(){return this.registry}get attachState(){return this.context.attachState}get IFluidHandleContext(){return this.handleContext}get connected(){return this._connected}get summarizerClientId(){var e;return null===(e=this.summarizerClientElection)||void 0===e?void 0:e.electedClientId}get disposed(){return this._disposed}get summarizer(){return i(void 0!==this._summarizer,599),this._summarizer}isSummariesDisabled(){return!0===this.runtimeOptions.summaryOptions.disableSummaries||"disabled"===this.summaryConfiguration.state}isHeuristicsDisabled(){var e;return!0===(null===(e=this.runtimeOptions.summaryOptions.summarizerOptions)||void 0===e?void 0:e.disableHeuristics)||"disableHeuristics"===this.summaryConfiguration.state}isSummarizerClientElectionEnabled(){var e;return this.mc.config.getBoolean("Fluid.ContainerRuntime.summarizerClientElection")?null===(e=this.mc.config.getBoolean("Fluid.ContainerRuntime.summarizerClientElection"))||void 0===e||e:!0===this.runtimeOptions.summaryOptions.summarizerClientElection||"disabled"!==this.summaryConfiguration.state&&!0===this.summaryConfiguration.summarizerClientElection}getMaxOpsSinceLastSummary(){return void 0!==this.runtimeOptions.summaryOptions.maxOpsSinceLastSummary?this.runtimeOptions.summaryOptions.maxOpsSinceLastSummary:"disabled"!==this.summaryConfiguration.state?this.summaryConfiguration.maxOpsSinceLastSummary:0}getInitialSummarizerDelayMs(){return void 0!==this.runtimeOptions.summaryOptions.initialSummarizerDelayMs?this.runtimeOptions.summaryOptions.initialSummarizerDelayMs:"disabled"!==this.summaryConfiguration.state?this.summaryConfiguration.initialSummarizerDelayMs:0}dispose(e){var t;this._disposed||(this._disposed=!0,this.logger.sendTelemetryEvent({eventName:"ContainerRuntimeDisposed",isDirty:this.isDirty,lastSequenceNumber:this.deltaManager.lastSequenceNumber,attachState:this.attachState},e),void 0!==this.summaryManager&&this.summaryManager.dispose(),this.garbageCollector.dispose(),null===(t=this._summarizer)||void 0===t||t.dispose(),this.dataStores.dispose(),this.pendingStateManager.dispose(),this.emit("dispose"),this.removeAllListeners())}get IFluidTokenProvider(){var e;if(null===(e=this.options)||void 0===e?void 0:e.intelligence)return{intelligence:this.options.intelligence}}async request(e){try{const t=C.R.create(e);return"_summarizer"===t.pathParts[0]&&1===t.pathParts.length?void 0!==this._summarizer?{status:200,mimeType:"fluid/object",value:this.summarizer}:(0,E.I4)(e):void 0!==this.requestHandler?this.requestHandler(t,this):(0,E.I4)(e)}catch(e){return(0,E.Nj)(e)}}async resolveHandle(e){try{const t=C.R.create(e),r=t.pathParts[0];if("_channels"===r)return this.resolveHandle(t.createSubRequest(1));if(r===ue.basePath&&t.isLeaf(2)){const r=await this.blobManager.getBlob(t.pathParts[1]);return r?{status:200,mimeType:"fluid/object",value:r.get()}:(0,E.I4)(e)}if(t.pathParts.length>0){const n=await this.getDataStoreFromRequest(r,e),s=t.createSubRequest(1);return i(s.url.startsWith("/"),294),n.IFluidRouter.request(s)}return(0,E.I4)(e)}catch(e){return(0,E.Nj)(e)}}internalId(e){var t;return null!==(t=this.dataStores.aliases().get(e))&&void 0!==t?t:e}async getDataStoreFromRequest(e,t){var r,n,s;const i="boolean"!=typeof(null===(r=t.headers)||void 0===r?void 0:r[St.wait])||(null===(n=t.headers)||void 0===n?void 0:n[St.wait]),o=this.internalId(e),a=await this.dataStores.getDataStore(o,i);if((null===(s=t.headers)||void 0===s?void 0:s[St.externalRequest])&&this.garbageCollector.shouldRunGC){const e=(await a.getBaseGCDetails()).usedRoutes;if(void 0!==e&&!e.includes("")&&!e.includes("/"))throw(0,E.fu)((0,E.I4)(t),t)}const c=await a.realize(),h=(0,O.aG)(t.url.split("?")[0]);return this.garbageCollector.nodeUpdated(`/${h}`,"Loaded",void 0,a.packagePath,null==t?void 0:t.headers),c}addMetadataToSummary(e){var t;const r=Object.assign(Object.assign(Object.assign(Object.assign({},this.createContainerMetadata),{summaryCount:this.nextSummaryNumber,summaryNumber:this.nextSummaryNumber++,summaryFormatVersion:1,disableIsolatedChannels:this.disableIsolatedChannels||void 0}),this.garbageCollector.getMetadata()),{message:null!==(n=this.deltaManager.lastMessage,t=void 0===n?void 0:{clientId:n.clientId,clientSequenceNumber:n.clientSequenceNumber,minimumSequenceNumber:n.minimumSequenceNumber,referenceSequenceNumber:n.referenceSequenceNumber,sequenceNumber:n.sequenceNumber,timestamp:n.timestamp,type:n.type})&&void 0!==t?t:this.messageAtLastSummary});var n;(0,A.Rt)(e,qe,JSON.stringify(r))}addContainerStateToSummary(e,t,r,n){var s;if(this.addMetadataToSummary(e),this.chunkMap.size>0){const t=JSON.stringify([...this.chunkMap]);(0,A.Rt)(e,Le,t)}const i=this.dataStores.aliases();if(i.size>0&&(0,A.Rt)(e,Me,JSON.stringify([...i])),this.summarizerClientElection){const t=JSON.stringify(null===(s=this.summarizerClientElection)||void 0===s?void 0:s.serialize());(0,A.Rt)(e,Be,t)}const o=this.blobManager.summarize();if(Object.keys(o.summary.tree).length>0&&(0,A.Jv)(e,je,o),this.garbageCollector.writeDataAtRoot){const s=this.garbageCollector.summarize(t,r,n);void 0!==s&&(0,A.QA)(e,Se,s)}}shouldContinueReconnecting(){return this.maxConsecutiveReconnects<=0||(this.pendingStateManager.hasPendingMessages()?(this.consecutiveReconnects===Math.floor(this.maxConsecutiveReconnects/2)&&this.mc.logger.sendTelemetryEvent({eventName:"ReconnectsWithNoProgress",attempts:this.consecutiveReconnects,pendingMessages:this.pendingStateManager.pendingMessagesCount}),this.consecutiveReconnects<this.maxConsecutiveReconnects):(this.resetReconnectCount(),!0))}resetReconnectCount(){this.consecutiveReconnects=0}replayPendingStates(){if(!this.canSendOps())return;const e=this.dirtyContainer;let t;this.dirtyContainer=!1,i(this.emitDirtyDocumentEvent,295),this.emitDirtyDocumentEvent=!1;try{this.pendingStateManager.replayPendingStates()}finally{t=this.dirtyContainer,this.dirtyContainer=e,this.emitDirtyDocumentEvent=!0}this.updateDocumentDirtyState(t)}async applyStashedOp(e,t){switch(e){case vt.FluidDataStoreOp:return this.dataStores.applyStashedOp(t);case vt.Attach:return this.dataStores.applyStashedAttachOp(t);case vt.Alias:case vt.BlobAttach:return;case vt.ChunkedOp:throw new Error("chunkedOp not expected here");case vt.Rejoin:throw new Error("rejoin not expected here");default:h(0,`Unknown ContainerMessageType: ${e}`)}}setConnectionState(e,t){this.verifyNotClosed();const r=this._connected!==e,n=r&&e;this._connected=e,e||(this._perfSignalData.signalsLost=0,this._perfSignalData.signalTimestamp=0,this._perfSignalData.trackingSignalSequenceNumber=void 0),!n||(this.consecutiveReconnects++,this.shouldContinueReconnecting())?(r&&this.replayPendingStates(),this.dataStores.setConnectionState(e,t),(0,f.Qq)(this.mc.logger,this,e,t)):this.closeFn(S.Hi.create("Runtime detected too many reconnects with no progress syncing local ops","setConnectionState",void 0,{dataLoss:1,attempts:this.consecutiveReconnects,pendingMessages:this.pendingStateManager.pendingMessagesCount}))}process(e,t){var r,n;if(this.verifyNotClosed(),!(0,v._V)(e))return;(null!==(r=this.mc.config.getBoolean("enableOfflineLoad"))&&void 0!==r?r:this.runtimeOptions.enableOfflineLoad)&&this.savedOps.push(e);let s=Object.assign({},e);this.scheduleManager.beforeOpProcessing(s);try{let e;switch(s=function(e){if(e.type===u.Operation){if(void 0!==e.contents.address&&void 0===e.contents.type)e.type=vt.FluidDataStoreOp;else{const t=e.contents;i(void 0!==t.type,289),e.type=t.type,e.contents=t.contents}i((0,v._V)(e),290)}return e}(s),s=this.processRemoteChunkedMessage(s),t&&s.type!==vt.ChunkedOp&&(e=this.pendingStateManager.processPendingLocalMessage(s)),this.pendingStateManager.hasPendingMessages()||this.updateDocumentDirtyState(!1),s.type){case vt.Attach:this.dataStores.processAttachMessage(s,t);break;case vt.Alias:this.processAliasMessage(s,e,t);break;case vt.FluidDataStoreOp:this.dataStores.processFluidDataStoreOp(s,t,e);break;case vt.BlobAttach:i(null===(n=null==s?void 0:s.metadata)||void 0===n?void 0:n.blobId,298),this.blobManager.processBlobAttachOp(s.metadata.blobId,t)}this.emit("op",s),this.scheduleManager.afterOpProcessing(void 0,s),t&&this.resetReconnectCount()}catch(e){throw this.scheduleManager.afterOpProcessing(e,s),e}}processAliasMessage(e,t,r){this.dataStores.processAliasMessage(e,t,r)}sendSignalTelemetryEvent(e){const t=Date.now()-this._perfSignalData.signalTimestamp;this.logger.sendPerformanceEvent({eventName:"SignalLatency",duration:t,signalsLost:this._perfSignalData.signalsLost}),this._perfSignalData.signalsLost=0,this._perfSignalData.signalTimestamp=0}processSignal(e,t){const r=e.content,n={clientId:e.clientId,content:r.contents.content,type:r.contents.type};e.clientId===this.clientId&&this.connected&&(void 0!==this._perfSignalData.trackingSignalSequenceNumber&&r.clientSignalSequenceNumber>this._perfSignalData.trackingSignalSequenceNumber?(this._perfSignalData.signalsLost++,this._perfSignalData.trackingSignalSequenceNumber=void 0,this.logger.sendErrorEvent({eventName:"SignalLost",type:r.contents.type,signalsLost:this._perfSignalData.signalsLost,trackingSequenceNumber:this._perfSignalData.trackingSignalSequenceNumber,clientSignalSequenceNumber:r.clientSignalSequenceNumber})):r.clientSignalSequenceNumber===this._perfSignalData.trackingSignalSequenceNumber&&(this.sendSignalTelemetryEvent(r.clientSignalSequenceNumber),this._perfSignalData.trackingSignalSequenceNumber=void 0)),void 0!==r.address?this.dataStores.processSignal(r.address,n,t):this.emit("signal",n,t)}async getRootDataStore(e,t=!0){const r=this.internalId(e),n=await this.dataStores.getDataStore(r,t);return i(await n.isRoot(),299),n.realize()}setFlushMode(e){e!==this._flushMode&&(this.mc.logger.sendTelemetryEvent({eventName:"FlushMode Updated",old:this._flushMode,new:e}),e===w.FlushMode.Immediate&&this.flush(),this._flushMode=e,this.pendingStateManager.onFlushModeUpdated(e))}flush(){if(i(0===this._orderSequentiallyCalls,588),this.deltaSender&&(this.pendingStateManager.onFlush(),this.needsFlush&&(this.needsFlush=!1,this.canSendOps())))return this.deltaSender.flush()}orderSequentially(e){if(this.flushMode===w.FlushMode.TurnBased)return void this.trackOrderSequentiallyCalls(e);const t=this.flushMode;this.setFlushMode(w.FlushMode.TurnBased);try{this.trackOrderSequentiallyCalls(e),this.flush()}finally{this.setFlushMode(t)}}trackOrderSequentiallyCalls(e){let t;this.mc.config.getBoolean("Fluid.ContainerRuntime.EnableRollback")&&(t=this.pendingStateManager.checkpoint());try{this._orderSequentiallyCalls++,e()}catch(e){throw t?t.rollback():this.closeFn(new S.pY("orderSequentially callback exception",e)),e}finally{this._orderSequentiallyCalls--}}async createDataStore(e){const t=(0,N.Z)();return Ze(await this._createDataStore(e,!1,t),t,this,this.dataStores,this.mc.logger)}async createRootDataStoreLegacy(e,t){const r=await this._createDataStore(e,!0,t);return void 0!==r.makeVisibleAndAttachGraph?r.makeVisibleAndAttachGraph():r.bindToContext(),r}async createRootDataStore(e,t){if(t.includes("/"))throw new S.Oi(`Id cannot contain slashes: '${t}'`);return!0===this._aliasingEnabled?this.createAndAliasDataStore(e,t):this.createRootDataStoreLegacy(e,t)}async createAndAliasDataStore(e,t,r){const n=(0,N.Z)(),s=await this._createDataStore(e,!1,n,r),i=Ze(s,n,this,this.dataStores,this.mc.logger),o=await i.trySetAlias(t);if("Success"!==o)throw new S.pY("dataStoreAliasFailure",void 0,{alias:{value:t,tag:g.XI.UserData},internalId:{value:n,tag:g.XI.PackageData},aliasResult:o});return i}createDetachedRootDataStore(e,t){if(t.includes("/"))throw new S.Oi(`Id cannot contain slashes: '${t}'`);return this.dataStores.createDetachedDataStoreCore(e,!0,t)}createDetachedDataStore(e){return this.dataStores.createDetachedDataStoreCore(e,!1)}async _createDataStoreWithPropsLegacy(e,t,r=(0,N.Z)(),n=!1){const s=await this.dataStores._createFluidDataStoreContext(Array.isArray(e)?e:[e],r,n,t).realize();return n&&(void 0!==s.makeVisibleAndAttachGraph?s.makeVisibleAndAttachGraph():s.bindToContext(),this.logger.sendTelemetryEvent({eventName:"Root datastore with props",hasProps:void 0!==t})),Ze(s,r,this,this.dataStores,this.mc.logger)}async _createDataStoreWithProps(e,t,r=(0,N.Z)(),n=!1){return!0===this._aliasingEnabled&&n?this.createAndAliasDataStore(e,r,t):this._createDataStoreWithPropsLegacy(e,t,r,n)}async _createDataStore(e,t,r=(0,N.Z)(),n){return this.dataStores._createFluidDataStoreContext(Array.isArray(e)?e:[e],r,t,n).realize()}canSendOps(){return this.connected&&!this.deltaManager.readOnlyInfo.readonly}getQuorum(){return this.context.quorum}getAudience(){return this.context.audience}get isDirty(){return this.dirtyContainer}isContainerMessageDirtyable(e,t){if(e===vt.Attach){if(t.id===At)return!1}else if(e===vt.FluidDataStoreOp&&t.address===At)return!1;return!0}createNewSignalEnvelope(e,t,r){const n=++this._perfSignalData.signalSequenceNumber,s={address:e,clientSignalSequenceNumber:n,contents:{type:t,content:r}};return n%this.defaultTelemetrySignalSampleCount==1&&void 0===this._perfSignalData.trackingSignalSequenceNumber&&(this._perfSignalData.signalTimestamp=Date.now(),this._perfSignalData.trackingSignalSequenceNumber=n),s}submitSignal(e,t){this.verifyNotClosed();const r=this.createNewSignalEnvelope(void 0,e,t);return this.context.submitSignalFn(r)}submitDataStoreSignal(e,t,r){const n=this.createNewSignalEnvelope(e,t,r);return this.context.submitSignalFn(n)}setAttachState(e){e===n.mB.Attaching?i(this.attachState===n.mB.Attaching,301):(i(this.attachState===n.mB.Attached,302),this.emit("attached")),e!==n.mB.Attached||this.pendingStateManager.hasPendingMessages()||this.updateDocumentDirtyState(!1),this.dataStores.setAttachState(e)}createSummary(e,t){e&&this.blobManager.setRedirectTable(e);const r=this.dataStores.createSummary(t);return this.disableIsolatedChannels||ze(r),this.addContainerStateToSummary(r,!0,!1,t),r.summary}async getAbsoluteUrl(e){if(void 0===this.context.getAbsoluteUrl)throw new Error("Driver does not implement getAbsoluteUrl");if(this.attachState===n.mB.Attached)return this.context.getAbsoluteUrl(e)}async summarizeInternal(e,t,r){const n=await this.dataStores.summarize(e,t,r);let s;return this.disableIsolatedChannels||(ze(n),s=[w.channelsTreeName]),this.addContainerStateToSummary(n,e,t,r),Object.assign(Object.assign({},n),{id:"",pathPartsForChildren:s})}async summarize(e){this.verifyNotClosed();const{fullTree:t=!1,trackState:r=!0,summaryLogger:n=this.mc.logger,runGC:s=this.garbageCollector.shouldRunGC,runSweep:o,fullGC:a}=e;let c;s&&(c=await this.collectGarbage({logger:n,runSweep:o,fullGC:a}));const h=new A.TA,{stats:l,summary:u}=await this.summarizerNode.summarize(t,r,h);return this.logger.sendTelemetryEvent({eventName:"SummarizeTelemetry",details:h.serialize()}),i(u.type===p.Tree,303),{stats:l,summary:u,gcStats:c}}async updateStateBeforeGC(){return this.dataStores.updateStateBeforeGC()}async getGCData(e){const t=new O.iR,r=await this.dataStores.getGCData(e);t.addNodes(r.gcNodes);const n=this.blobManager.getGCData(e);return t.addNodes(n.gcNodes),t.getGCData()}updateUsedRoutes(e,t){this.summarizerNode.updateUsedRoutes([""]);const r=[];for(const t of e)t.split("/")[1]!==ue.basePath&&r.push(t);return this.dataStores.updateUsedRoutes(r,t)}deleteUnusedRoutes(e){const t=[],r=[];for(const n of e)this.isBlobPath(n)?t.push(n):r.push(n);this.blobManager.deleteUnusedRoutes(t),this.dataStores.deleteUnusedRoutes(r)}getCurrentReferenceTimestampMs(){var e,t,r;return null!==(t=null===(e=this.deltaManager.lastMessage)||void 0===e?void 0:e.timestamp)&&void 0!==t?t:null===(r=this.messageAtLastSummary)||void 0===r?void 0:r.timestamp}getNodeType(e){var t;return this.isBlobPath(e)?Ee:null!==(t=this.dataStores.getGCNodeType(e))&&void 0!==t?t:"Other"}async getGCNodePackagePath(e){switch(this.getNodeType(e)){case Ee:return["_blobs"];case xe:case Ce:return this.dataStores.getDataStorePackagePath(e);default:i(!1,734)}}isBlobPath(e){const t=e.split("/");return!(t.length<2||t[1]!==ue.basePath)}async collectGarbage(e){return this.garbageCollector.collectGarbage(e)}addedGCOutboundReference(e,t){this.garbageCollector.addedOutboundReference(e.absolutePath,t.absolutePath)}async submitSummary(e){var t,r,n;const{fullTree:s,refreshLatestAck:o,summaryLogger:a}=e,c=this.nextSummaryNumber,h=g.G2.create(a,void 0,{all:{summaryNumber:c}});let d;if(o){const e=await this.refreshLatestSummaryAckFromServer(g.G2.create(h,void 0,{all:{safeSummary:!0}})),t=e.latestSnapshotRefSeq;d=e.latestSnapshotVersionId,t>this.deltaManager.lastSequenceNumber&&await g.Xr.timedExecAsync(h,{eventName:"WaitingForSeq",lastSequenceNumber:this.deltaManager.lastSequenceNumber,targetSequenceNumber:t,lastKnownSeqNumber:this.deltaManager.lastKnownSeqNumber},(async()=>Ot(this.deltaManager,t)),{start:!0,end:!0,cancel:"error"})}try{await this.deltaManager.inbound.pause();const o=this.deltaManager.lastSequenceNumber,a=this.deltaManager.minimumSequenceNumber,g=`Summary @${o}:${this.deltaManager.minimumSequenceNumber}`;o!==(null===(t=this.deltaManager.lastMessage)||void 0===t?void 0:t.sequenceNumber)&&h.sendErrorEvent({eventName:"LastSequenceMismatch",error:g}),this.summarizerNode.startSummary(o,h);const m=()=>e.cancellationToken.cancelled?{continue:!1,error:"disconnected"}:(i(this.connected,600),this.deltaManager.lastSequenceNumber!==o?{continue:!1,error:`lastSequenceNumber changed before uploading to storage. ${this.deltaManager.lastSequenceNumber} !== ${o}`}:{continue:!0});let f=m();if(!f.continue)return{stage:"base",referenceSequenceNumber:o,minimumSequenceNumber:a,error:f.error};const y=l.start();let v;const b=this.garbageCollector.summaryStateNeedsReset;try{v=await this.summarize({fullTree:s||b,trackState:!0,summaryLogger:h,runGC:this.garbageCollector.shouldRunGC})}catch(e){return{stage:"base",referenceSequenceNumber:o,minimumSequenceNumber:a,error:e}}const{summary:S,stats:x}=v;this.messageAtLastSummary=this.deltaManager.lastMessage;const C=this.disableIsolatedChannels?S:S.tree[w.channelsTreeName];i(C.type===p.Tree,508);const E=Object.values(C.tree).filter((e=>e.type===p.Handle)).length,T=S.tree[Se]?(0,A.i6)(S.tree[Se]):void 0,O=Object.assign({dataStoreCount:this.dataStores.size,summarizedDataStoreCount:this.dataStores.size-E,gcStateUpdatedDataStoreCount:null===(r=v.gcStats)||void 0===r?void 0:r.updatedDataStoreCount,gcBlobNodeCount:null==T?void 0:T.blobNodeCount,gcTotalBlobsSize:null==T?void 0:T.totalBlobSize,opsSizesSinceLastSummary:this.opTracker.opsSizeAccumulator,nonSystemOpsSinceLastSummary:this.opTracker.nonSystemOpCount,summaryNumber:c},x),N={referenceSequenceNumber:o,minimumSequenceNumber:a,summaryTree:S,summaryStats:O,generateDuration:y.trace().duration,forcedFullTree:b};if(f=m(),!f.continue)return Object.assign(Object.assign({stage:"generate"},N),{error:f.error});const P=this.summaryCollection.latestAck;let R,I;R=(null==P?void 0:P.summaryAck.contents.handle)!==d&&void 0!==d?{proposalHandle:void 0,ackHandle:d,referenceSequenceNumber:o}:void 0===P?{proposalHandle:void 0,ackHandle:null===(n=this.context.getLoadedFromVersion())||void 0===n?void 0:n.id,referenceSequenceNumber:o}:{proposalHandle:P.summaryOp.contents.handle,ackHandle:P.summaryAck.contents.handle,referenceSequenceNumber:o};try{I=await this.storage.uploadSummaryWithContext(v.summary,R)}catch(e){return Object.assign(Object.assign({stage:"generate"},N),{error:e})}const F=R.ackHandle,k={handle:I,head:F,message:g,parents:F?[F]:[]},D=Object.assign(Object.assign({},N),{handle:I,uploadDuration:y.trace().duration});if(f=m(),!f.continue)return Object.assign(Object.assign({stage:"upload"},D),{error:f.error});let M;try{M=this.submitSystemMessage(u.Summarize,k)}catch(e){return Object.assign(Object.assign({stage:"upload"},D),{error:e})}const q=Object.assign(Object.assign({stage:"submit"},D),{clientSequenceNumber:M,submitOpDuration:y.trace().duration});return this.summarizerNode.completeSummary(I),this.opTracker.reset(),q}finally{this.summarizerNode.clearSummary(),this.deltaManager.inbound.resume()}}processRemoteChunkedMessage(e){if(e.type!==vt.ChunkedOp)return e;const t=e.clientId,r=e.contents;if(this.addChunk(t,r),r.chunkId===r.totalChunks){const n=Object.assign({},e),s=this.chunkMap.get(t).join("");return n.contents=JSON.parse(s),n.type=r.originalType,this.clearPartialChunks(t),n}return e}addChunk(e,t){let r=this.chunkMap.get(e);void 0===r&&(r=[],this.chunkMap.set(e,r)),i(t.chunkId===r.length+1,305),r.push(t.contents)}clearPartialChunks(e){this.chunkMap.has(e)&&this.chunkMap.delete(e)}updateDocumentDirtyState(e){this.dirtyContainer!==e&&(this.dirtyContainer=e,this.emitDirtyDocumentEvent&&(this.emit(e?"dirty":"saved"),this.context.updateDirtyContainerState(e)))}submitDataStoreOp(e,t,r=void 0){const n={address:e,contents:t};this.submit(vt.FluidDataStoreOp,n,r)}submitDataStoreAliasOp(e,t){if(!Qe(e))throw new S.Oi("malformedDataStoreAliasMessage");this.submit(vt.Alias,e,t)}async uploadBlob(e){return this.verifyNotClosed(),this.blobManager.createBlob(e)}submit(e,t,r=void 0,s=void 0){this.verifyNotClosed(),i(this.attachState!==n.mB.Detached,306);let o=-1,a=s;if(this.canSendOps()){const r=JSON.stringify(t),n=this.context.deltaManager.maxMessageSize;this.flushMode!==w.FlushMode.TurnBased||this.needsFlush||(a=Object.assign(Object.assign({},s),{batch:!0}),this.needsFlush=!0,this.flushTrigger||Promise.resolve().then((()=>{this.flushTrigger=!1,this.flush()}))),o=this.submitMaybeChunkedMessages(e,t,r,n,this._flushMode===w.FlushMode.TurnBased,a)}this.pendingStateManager.onSubmitMessage(e,o,this.deltaManager.lastSequenceNumber,t,r,a),this.isContainerMessageDirtyable(e,t)&&this.updateDocumentDirtyState(!0)}submitMaybeChunkedMessages(e,t,r,n,s,i=void 0){return this._maxOpSizeInBytes>=0?!r||r.length<=this._maxOpSizeInBytes?this.submitRuntimeMessage(e,t,s,i):(this.closeFn(new S.pY("OpTooLarge",void 0,{length:{value:r.length,tag:g.XI.PackageData},limit:{value:this._maxOpSizeInBytes,tag:g.XI.PackageData}})),-1):!r||r.length<=n?this.submitRuntimeMessage(e,t,s,i):this.submitChunkedMessage(e,r,n)}submitChunkedMessage(e,t,r){const n=t.length,s=Math.floor((n-1)/r)+1;let i=0,o=0;for(let n=1;n<=s;n+=1){const a={chunkId:n,contents:t.substr(i,r),originalType:e,totalChunks:s};i+=r,o=this.submitRuntimeMessage(vt.ChunkedOp,a,!1)}return o}submitSystemMessage(e,t){this.verifyNotClosed(),i(this.connected,307);const r=this.flushMode===w.FlushMode.TurnBased&&this.needsFlush;return r&&this.mc.logger.sendErrorEvent({eventName:"submitSystemMessageError",type:e}),this.context.submitFn(e,t,r)}submitRuntimeMessage(e,t,r,n){this.verifyNotClosed(),i(this.connected,601);const s={type:e,contents:t};return this.context.submitFn(u.Operation,s,r,n)}verifyNotClosed(){if(this._disposed)throw new Error("Runtime is closed")}reSubmit(e,t,r,n){switch(e){case vt.FluidDataStoreOp:this.dataStores.resubmitDataStoreOp(t,r);break;case vt.Attach:case vt.Alias:this.submit(e,t,r);break;case vt.ChunkedOp:throw new Error("chunkedOp not expected here");case vt.BlobAttach:this.submit(e,t,r,n);break;case vt.Rejoin:this.submit(e,t);break;default:h(0,`Unknown ContainerMessageType: ${e}`)}}rollback(e,t,r){if(e!==vt.FluidDataStoreOp)throw new Error(`Can't rollback ${e}`);this.dataStores.rollbackDataStoreOp(t,r)}async refreshLatestSummaryAck(e,t,r,n){const s=async e=>(0,b.g)(this.storage,e),{snapshotTree:i}=await this.fetchSnapshotFromStorage(t,n,{eventName:"RefreshLatestSummaryGetSnapshot",ackHandle:t,summaryRefSeq:r,fetchLatest:!1}),o=await this.summarizerNode.refreshLatestSummary(e,r,(async()=>i),s,n);await this.garbageCollector.latestSummaryStateRefreshed(o,s)}async refreshLatestSummaryAckFromServer(e){const{snapshotTree:t,versionId:r}=await this.fetchSnapshotFromStorage(null,e,{eventName:"RefreshLatestSummaryGetSnapshot",fetchLatest:!0}),n=async e=>(0,b.g)(this.storage,e),s=await(0,T.G)(t,n),i=await this.summarizerNode.refreshLatestSummary(void 0,s,(async()=>t),n,e);return await this.garbageCollector.latestSummaryStateRefreshed(i,n),{latestSnapshotRefSeq:s,latestSnapshotVersionId:r}}async fetchSnapshotFromStorage(e,t,r){return g.Xr.timedExecAsync(t,r,(async t=>{const r={},n=l.start(),s=await this.storage.getVersions(e,1);i(!!s&&!!s[0],311),r.getVersionDuration=n.trace().duration;const o=await this.storage.getSnapshotTree(s[0]);return i(!!o,312),r.getSnapshotDuration=n.trace().duration,t.end(r),{snapshotTree:o,versionId:s[0].id}}))}notifyAttaching(e){var t;(null!==(t=this.mc.config.getBoolean("enableOfflineLoad"))&&void 0!==t?t:this.runtimeOptions.enableOfflineLoad)&&(this.baseSnapshotBlobs=ft.serializeTreeWithBlobContents(e))}async getSnapshotBlobs(){var e;(null!==(e=this.mc.config.getBoolean("enableOfflineLoad"))&&void 0!==e?e:this.runtimeOptions.enableOfflineLoad)&&this.attachState===n.mB.Attached&&!this.context.pendingLocalState&&(i(!!this.context.baseSnapshot,741),this.baseSnapshotBlobs=await ft.serializeTree(this.context.baseSnapshot,this.storage))}getPendingLocalState(){var e;if(!(null!==(e=this.mc.config.getBoolean("enableOfflineLoad"))&&void 0!==e?e:this.runtimeOptions.enableOfflineLoad))throw new S.Oi("can't get state when offline load disabled");const t=this.context.pendingLocalState;return t?{pending:this.pendingStateManager.getLocalState(),snapshotBlobs:t.snapshotBlobs,baseSnapshot:t.baseSnapshot,savedOps:this.savedOps}:(i(!!this.context.baseSnapshot,742),i(!!this.baseSnapshotBlobs,743),{pending:this.pendingStateManager.getLocalState(),snapshotBlobs:this.baseSnapshotBlobs,baseSnapshot:this.context.baseSnapshot,savedOps:this.savedOps})}formRequestSummarizerFn(e){return async()=>{const t={headers:{[s.A.cache]:!1,[s.A.clientDetails]:{capabilities:{interactive:!1},type:L},[y.i.summarizingClient]:!0,[s.A.reconnect]:!1},url:"/_summarizer"},r=(await(0,E.bb)(e,t)).ISummarizer;if(!r)throw new S.Oi("Fluid object does not implement ISummarizer");return r}}async processSavedOps(e){for(const t of e.savedOps)this.process(t,!1),await this.pendingStateManager.applyStashedOpsAt(t.sequenceNumber);await this.pendingStateManager.applyStashedOpsAt()}}const Ot=async(e,t)=>new Promise(((r,n)=>{e.on("closed",n);const s=n=>{n.sequenceNumber>=t&&(r(),e.off("op",s))};e.on("op",s)}))},9680:(e,t,r)=>{"use strict";r.d(t,{P:()=>s});var n=r(9268);class s{constructor(e){this.map=new Map;for(const t of e){if(this.map.has(t[0]))throw new n.Oi("Duplicate entry names exist");this.map.set(t[0],t[1])}}get IFluidDataStoreRegistry(){return this}async get(e){if(this.map.has(e))return this.map.get(e)}}},9268:(e,t,r)=>{"use strict";r.d(t,{FQ:()=>o,HN:()=>u,Hi:()=>l,Jd:()=>h,Lf:()=>c,Oi:()=>a,pY:()=>i});var n=r(7819),s=r(2718);class i extends s.j4{constructor(e,t,r){super(e,r,new Set(["error"])),this.error=t,this.errorType=n.u.genericError}}class o extends s.j4{constructor(e,t,r){super(e,r),this.retryAfterSeconds=t,this.errorType=n.u.throttlingError}static wrap(e,t,r){return(0,s.bO)(e,(e=>new o(e,t)),r)}}class a extends s.j4{constructor(e){super(e,{usageError:!0}),this.errorType="usageError"}}class c extends s.j4{constructor(e,t){super(e,{timeoutMs:t}),this.expiryMs=t,this.errorType=n.u.clientSessionExpiredError}}class h extends s.j4{constructor(e,t){super(e,Object.assign(Object.assign({},t),{dataProcessingError:1})),this.errorType=n.u.dataCorruptionError,this.canRetry=!1}}class l extends s.j4{constructor(e){super(e),this.errorType=n.u.dataProcessingError,this.canRetry=!1}static create(e,t,r,n={}){const s=l.wrapIfUnrecognized(e,t,r);return s.addTelemetryProperties(n),s}static wrapIfUnrecognized(e,t,r){const n=Object.assign({dataProcessingError:1,dataProcessingCodepath:t},void 0===r?void 0:u(r)),i=(0,s.SC)(e,{props:n});if(!(0,s.XY)(i))return i;const o=(0,s.Jn)(i,(e=>new l(e)));return o.addTelemetryProperties(i.getTelemetryProperties()),o}}const u=e=>({messageClientId:e.clientId,messageSequenceNumber:e.sequenceNumber,messageClientSequenceNumber:e.clientSequenceNumber,messageReferenceSequenceNumber:e.referenceSequenceNumber,messageMinimumSequenceNumber:e.minimumSequenceNumber,messageTimestamp:e.timestamp})},8888:(e,t,r)=>{"use strict";r.d(t,{B:()=>s});var n=r(1096);class s{constructor(e,t,r){this.value=e,this.path=t,this.routeContext=r,this.pendingHandlesToMakeVisible=new Set,this.locallyVisible=!1,this.absolutePath=(0,n.H)(t,this.routeContext)}get IFluidHandle(){return this}get isAttached(){return this.routeContext.isAttached}get visible(){return this.isAttached||this.locallyVisible}async get(){return this.value}attachGraph(){this.visible||(this.locallyVisible=!0,this.pendingHandlesToMakeVisible.forEach((e=>{e.attachGraph()})),this.pendingHandlesToMakeVisible.clear(),this.routeContext.attachGraph())}bind(e){this.visible?e.attachGraph():this.pendingHandlesToMakeVisible.add(e)}}},2505:(e,t,r)=>{"use strict";var n;r.d(t,{C:()=>n}),function(e){e.genericError="genericError",e.genericNetworkError="genericNetworkError",e.authorizationError="authorizationError",e.fileNotFoundOrAccessDeniedError="fileNotFoundOrAccessDeniedError",e.throttlingError="throttlingError",e.offlineError="offlineError",e.unsupportedClientProtocolVersion="unsupportedClientProtocolVersion",e.writeError="writeError",e.fetchFailure="fetchFailure",e.incorrectServerResponse="incorrectServerResponse",e.fileOverwrittenInStorage="fileOverwrittenInStorage",e.deltaStreamConnectionForbidden="deltaStreamConnectionForbidden",e.locationRedirection="locationRedirection"}(n||(n={}))},5761:(e,t,r)=>{"use strict";var n;r.d(t,{i:()=>n}),function(e){e.summarizingClient="fluid-client-summarizer",e.createNew="createNew"}(n||(n={}))},1748:(e,t,r)=>{"use strict";r.d(t,{m:()=>l});var n,s,i=r(7384),o=r(686);!function(e){e.File="100644",e.Executable="100755",e.Directory="040000",e.Symlink="120000"}(n||(n={})),function(e){e.Blob="Blob",e.Tree="Tree",e.Attachment="Attachment"}(s||(s={}));var a=r(1044),c=r(2045);function h(e,t,r){const a=[];for(const l of t){const t=`${e}${l.path}`;if(l.type===s.Blob){const e=l.value,s=(0,i.k8)(e.contents,e.encoding),o=(0,c.Z)();r.set(o,s);const h={mode:n[l.mode],path:t,sha:o,size:0,type:"blob",url:""};a.push(h)}else if(l.type===s.Tree){(0,o.h)(l.type===s.Tree,257);const e=l.value,i={mode:n[l.mode],path:t,sha:"",size:-1,type:"tree",url:""};a.push(i);const c=h(`${t}/`,e.entries,r);a.push(...c)}}return a}function l(e,t){const r=function(e,t){return{sha:"",tree:h("",e,t),url:""}}(e,t);return(0,a.eB)(r)}},6144:(e,t,r)=>{"use strict";r.d(t,{P:()=>n});class n{constructor(e){this.internalStorageService=e}set policies(e){this._policies=e}get policies(){var e;return null!==(e=this._policies)&&void 0!==e?e:this.internalStorageService.policies}get repositoryUrl(){return this.internalStorageService.repositoryUrl}async getSnapshotTree(e,t){return this.internalStorageService.getSnapshotTree(e,t)}async getVersions(e,t,r){return this.internalStorageService.getVersions(e,t,r)}async uploadSummaryWithContext(e,t){return this.internalStorageService.uploadSummaryWithContext(e,t)}async downloadSummary(e){return this.internalStorageService.downloadSummary(e)}async createBlob(e){return this.internalStorageService.createBlob(e)}async readBlob(e){return this.internalStorageService.readBlob(e)}}},4025:(e,t,r)=>{"use strict";var n,s,i;function o(e){if(a(e))return!0;switch(e.type){case n.Propose:case n.Reject:case n.NoOp:return!0;default:return!1}}function a(e){return e.type===n.Operation||e.type===n.Summarize}function c(e){return!!Object.values(i).includes(e.type)}r.d(t,{ag:()=>o,LW:()=>a,_V:()=>c}),function(e){e.NoOp="noop",e.ClientJoin="join",e.ClientLeave="leave",e.Propose="propose",e.Reject="reject",e.Summarize="summarize",e.SummaryAck="summaryAck",e.SummaryNack="summaryNack",e.Operation="op",e.RemoteHelp="remoteHelp",e.NoClient="noClient",e.RoundTrip="tripComplete",e.Control="control"}(n||(n={})),function(e){e.ThrottlingError="ThrottlingError",e.InvalidScopeError="InvalidScopeError",e.BadRequestError="BadRequestError",e.LimitExceededError="LimitExceededError"}(s||(s={})),function(e){e.FluidDataStoreOp="component",e.Attach="attach",e.ChunkedOp="chunkedOp",e.BlobAttach="blobAttach",e.Rejoin="rejoin",e.Alias="alias",e.Operation="op"}(i||(i={}))},9077:(e,t,r)=>{"use strict";r.d(t,{GS:()=>v,Gg:()=>a,M_:()=>u,V2:()=>p,Xp:()=>c,Yz:()=>s,ZZ:()=>b,j:()=>m,jx:()=>f,ms:()=>y,y7:()=>l});var n,s,i=r(2505),o=r(2718);function a(){return"object"==typeof navigator&&null!==navigator&&"boolean"==typeof navigator.onLine?navigator.onLine?s.Online:s.Offline:s.Unknown}!function(e){e[e.Offline=0]="Offline",e[e.Online=1]="Online",e[e.Unknown=2]="Unknown"}(s||(s={}));class c extends o.j4{constructor(e,t,r){super(e,r),this.canRetry=t,this.errorType=i.C.genericNetworkError}}const h="deltaStreamConnectionForbidden";class l extends o.j4{constructor(e,t){super(e,Object.assign(Object.assign({},t),{statusCode:400})),this.errorType=l.errorType,this.canRetry=!1}}l.errorType=null!==(n=i.C[h])&&void 0!==n?n:h;class u extends o.j4{constructor(e,t,r,n){super(e,n,new Set(["claims","tenantId"])),this.claims=t,this.tenantId=r,this.errorType=i.C.authorizationError,this.canRetry=!1}}class d extends o.j4{constructor(e,t,r,n){super(e,n),this.errorType=t,this.canRetry=r}}class p extends d{constructor(e,t,r){super(e,t,!1,r),this.errorType=t}}class g extends o.j4{constructor(e,t,r){super(e,r),this.retryAfterSeconds=t,this.errorType=i.C.throttlingError,this.canRetry=!0}}const m=(e,t)=>new p(e,i.C.writeError,t);function f(e,t,r){return void 0!==t.retryAfterMs&&t.canRetry?new g(e,t.retryAfterMs/1e3,r):new c(e,t.canRetry,r)}const y=e=>!0===(null==e?void 0:e.canRetry),v=e=>null==e?void 0:e.retryAfterSeconds,b=e=>void 0!==(null==e?void 0:e.retryAfterSeconds)?1e3*e.retryAfterSeconds:void 0},9252:(e,t,r)=>{"use strict";r.d(t,{g:()=>s});var n=r(7384);async function s(e,t){const r=await e.readBlob(t),s=(0,n.zT)(r,"utf8");return JSON.parse(s)}},686:(e,t,r)=>{"use strict";function n(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}r.d(t,{h:()=>n})},7384:(e,t,r)=>{"use strict";r.d(t,{k8:()=>i,pv:()=>c,zT:()=>o});var n=r(9742),s=r(686);const i=(e,t)=>c.from(e,t).buffer,o=(e,t)=>c.from(e).toString(t);function a(e){const t=e;return e instanceof ArrayBuffer||"object"==typeof t&&null!==t&&"number"==typeof t.byteLength&&"function"==typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}class c extends Uint8Array{toString(e){return function(e,t){switch(t){case"base64":return n.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}(this,e)}static from(e,t,r){if("string"==typeof e)return c.fromString(e,t);if(null!==e&&"object"==typeof e&&a(e.buffer))return(0,s.h)(0===e.byteOffset,0),(0,s.h)(e.byteLength===e.buffer.byteLength,1),c.fromArrayBuffer(e.buffer,t,r);if(a(e))return c.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const n=null!=t?t:0,s=null!=r?r:e.byteLength-n;if(n<0||n>e.byteLength||s<0||s+n>e.byteLength)throw new RangeError;return new c(e,n,s)}static fromString(e,t){switch(t){case"base64":{const t=this.sanitizeBase64(e),r=n.toByteArray(t);return new c(r.buffer)}case"utf8":case"utf-8":case void 0:{const t=(new TextEncoder).encode(e);return new c(t.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!=0&&(t+=["","===","==","="][t.length%4]),t}}},1:(e,t,r)=>{"use strict";r.d(t,{G:()=>s});var n=r(6239);class s extends n.L{constructor(e,t){super(),this.container=e,this.rootDataObject=t,this.connectedHandler=()=>this.emit("connected"),this.disconnectedHandler=()=>this.emit("disconnected"),this.disposedHandler=e=>this.emit("disposed",e),this.savedHandler=()=>this.emit("saved"),this.dirtyHandler=()=>this.emit("dirty"),e.on("connected",this.connectedHandler),e.on("closed",this.disposedHandler),e.on("disconnected",this.disconnectedHandler),e.on("saved",this.savedHandler),e.on("dirty",this.dirtyHandler)}get isDirty(){return this.container.isDirty}get attachState(){return this.container.attachState}get disposed(){return this.container.closed}get connectionState(){return this.container.connectionState}get initialObjects(){return this.rootDataObject.initialObjects}async attach(){throw new Error("Cannot attach container. Container is not in detached state")}async connect(){var e,t;null===(t=(e=this.container).connect)||void 0===t||t.call(e)}async disconnect(){var e,t;null===(t=(e=this.container).disconnect)||void 0===t||t.call(e)}async create(e){return this.rootDataObject.create(e)}dispose(){this.container.close(),this.container.off("connected",this.connectedHandler),this.container.off("closed",this.disposedHandler),this.container.off("disconnected",this.disconnectedHandler),this.container.off("saved",this.savedHandler),this.container.off("dirty",this.dirtyHandler)}}},2434:(e,t,r)=>{"use strict";r.d(t,{Y:()=>de,i:()=>le});var n=r(7648),s=r(5759),i=r(262),o=r(9703),a=r(7187);class c extends a.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}class h extends c{constructor(e){if(super(),this.isDisposed=!1,this.forwardingEvents=new Map,void 0!==e){const t=t=>this.unforwardEvent(e,t),r=t=>this.forwardEvent(e,t);this.on(h.removeListenerEvent,t),this.on(h.newListenerEvent,r)}}static isEmitterEvent(e){return e===h.newListenerEvent||e===h.removeListenerEvent}get disposed(){return this.isDisposed}dispose(){this.isDisposed=!0;for(const e of this.forwardingEvents.values())for(const t of e.values())try{t()}catch(e){}this.removeAllListeners(),this.forwardingEvents.clear()}forwardEvent(e,...t){for(const r of t)if(void 0!==e&&void 0!==r&&!h.isEmitterEvent(r)){let t=this.forwardingEvents.get(r);if(void 0===t&&(t=new Map,this.forwardingEvents.set(r,t)),!t.has(e)){const n=(...e)=>this.emit(r,...e);t.set(e,(()=>e.off(r,n))),e.on(r,n)}}}unforwardEvent(e,...t){for(const r of t)if(void 0!==r&&!h.isEmitterEvent(r)){const t=this.forwardingEvents.get(r);if((null==t?void 0:t.has(e))&&0===this.listenerCount(r)){const n=t.get(e);void 0!==n&&n(),t.delete(e),0===t.size&&this.forwardingEvents.delete(r)}}}}function l(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}h.newListenerEvent="newListener",h.removeListenerEvent="removeListener";var u=r(8888);class d{constructor(e,t){this.absolutePath=e,this.runtime=t,this.isAttached=!0}get IFluidHandle(){return this}attachGraph(){!function(e,t){throw new Error(`0x${202..toString(16).padStart(3,"0")}`)}()}async get(){const e=await this.runtime.IFluidHandleContext.resolveHandle({url:this.absolutePath});if(200===e.status&&"fluid/object"===e.mimeType)return e.value;throw new Error(`Failed to resolve container path ${this.absolutePath}`)}bind(e){throw new Error("Cannot bind to LegacyUriHandle")}}class p extends h{constructor(e){super(),this._disposed=!1,this.runtime=e.runtime,this.context=e.context,this.providers=e.providers,this.initProps=e.initProps,l(void 0===this.runtime._dataObject,189),this.runtime._dataObject=this,this.innerHandle=new u.B(this,"",this.runtime.objectsRoutingContext),this.runtime.once("dispose",(()=>{this._disposed=!0,this.dispose()}))}get disposed(){return this._disposed}get id(){return this.runtime.id}get IFluidRouter(){return this}get IFluidLoadable(){return this}get IFluidHandle(){return this.innerHandle}get handle(){return this.innerHandle}static async getDataObject(e){const t=e._dataObject;return l(void 0!==t,188),await t.finishInitialization(!0),t}async request(e){return this,""===(t=e).url||"/"===t.url||t.url.startsWith("/?")?{mimeType:"fluid/object",status:200,value:this}:(0,o.I4)(t);var t}async finishInitialization(e){return void 0!==this.initializeP||(this.initializeP=this.initializeInternal(e)),this.initializeP}async initializeInternal(e){var t;await this.preInitialize(),e?(l(void 0===this.initProps,190),await this.initializingFromExisting()):await this.initializingFirstTime(null!==(t=this.context.createProps)&&void 0!==t?t:this.initProps),await this.hasInitialized()}async getFluidObjectFromDirectory(e,t,r){const n=r?r(e,t):t.get(e),s=null==n?void 0:n.IFluidHandle;if(s)return s.get()}async getService(e){return function(e,t){return new d(e,t)}(`/_services/${e}`,this.context.containerRuntime).get()}async preInitialize(){}async initializingFirstTime(e){}async initializingFromExisting(){}async hasInitialized(){}dispose(){super.dispose()}}class g extends p{constructor(){super(...arguments),this.rootDirectoryId="root"}async request(e){const t=i.R.create(e);if("bigBlobs"===t.pathParts[0]){const e=this.root.get(t.pathParts.join("/"));return void 0===e?(0,o.I4)(t):{mimeType:"fluid/object",status:200,value:e}}return super.request(t)}get root(){if(!this.internalRoot)throw new Error(this.getUninitializedErrorString("root"));return this.internalRoot}async initializeInternal(e){e?(this.internalRoot=await this.runtime.getChannel(this.rootDirectoryId),this.internalRoot.attributes.type===s.c.Type&&this.runtime.logger.send({category:"generic",eventName:"MapDataObject",message:"Legacy document, SharedMap is masquerading as SharedDirectory in DataObject"})):(this.internalRoot=n.u.create(this.runtime,this.rootDirectoryId),this.internalRoot.bindToContext()),await super.initializeInternal(e)}getUninitializedErrorString(e){return`${e} must be initialized before being accessed.`}}var m=r(9680),f=r(1527),y=r(6734);class v{constructor(){this.handlers=[]}pushHandler(...e){void 0!==e&&this.handlers.push(...e)}async handleRequest(e,t){const r=i.R.create(e);for(const e of this.handlers){const n=await e(r,t);if(void 0!==n)return n}return(0,o.I4)(e)}}const b="IFluidDependencySynthesizer";class S{constructor(...e){this.providers=new Map,this.parents=e.filter((e=>void 0!==e))}get IFluidDependencySynthesizer(){return this}register(e,t){if(this.providers.has(e))throw new Error(`Attempting to register a provider of type ${e} that already exists`);this.providers.set(e,t)}unregister(e){this.providers.has(e)&&this.providers.delete(e)}synthesize(e,t){const r={};return this.generateRequired(r,t),this.generateOptional(r,e),Object.defineProperty(r,b,{get:()=>this}),r}has(e,t){return!!this.providers.has(e)||!0!==t&&this.parents.some((t=>t.has(e)))}getProvider(e){if(this.has(e)){if(this.providers.has(e))return this.providers.get(e);for(const t of this.parents){if(t instanceof S)return t.getProvider(e);{const r=t;if(void 0!==(null==r?void 0:r.getProvider))return r.getProvider(e)}}}}generateRequired(e,t){if(void 0!==t)for(const r of Object.keys(t)){const t=this.resolveProvider(r);if(void 0===t)throw new Error(`Object attempted to be created without registered required provider ${r}`);Object.defineProperty(e,r,t)}}generateOptional(e,t){var r;if(void 0!==t)for(const n of Object.keys(t)){const t=null!==(r=this.resolveProvider(n))&&void 0!==r?r:{get:async()=>{}};Object.defineProperty(e,n,t)}}resolveProvider(e){const t=this.providers.get(e);if(void 0!==t)return"function"==typeof t?{get(){if(t&&"function"==typeof t)return Promise.resolve(this[b]).then((async e=>t(e))).then((t=>null==t?void 0:t[e]))}}:{get(){if(t)return Promise.resolve(t).then((t=>{if(t)return t[e]}))}};for(const t of this.parents){const r={[e]:e},n=t.synthesize(r,{}),s=Object.getOwnPropertyDescriptor(n,e);if(void 0!==s)return s}}}var w=r(4263);class x extends w._{constructor(e,t,r=[],n){super(),this.registryEntries=e,this.dependencyContainer=t,this.requestHandlers=r,this.runtimeOptions=n,this.registry=new m.P(e)}get IFluidDataStoreRegistry(){return this.registry}async instantiateFirstTime(e){await this.containerInitializingFirstTime(e),await this.containerHasInitialized(e)}async instantiateFromExisting(e){await this.containerHasInitialized(e)}async preInitialize(e,t){const r=e.scope,n=new S(this.dependencyContainer,r.IFluidDependencySynthesizer);r.IFluidDependencySynthesizer=n;const s=await f.kE.load(e,this.registryEntries,function(...e){const t=new v;return t.pushHandler(...e),async(e,r)=>t.handleRequest(e,r)}(...this.requestHandlers),this.runtimeOptions,r,t);return n.register(y.IContainerRuntime,s),s}async containerInitializingFirstTime(e){}async containerHasInitialized(e){}}var C=r(3738),E=r(9268);class A extends a.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}class T{constructor(){this.completed=!1,this.p=new Promise(((e,t)=>{this.res=e,this.rej=t}))}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){void 0!==this.res&&(this.completed=!0,this.res(e))}reject(e){void 0!==this.rej&&(this.completed=!0,this.rej(e))}}class O{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return void 0===this.result&&(this.result=this.execute()),this.result}}function N(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}var P,R,I=r(2738),F=r(8595),k=r(2718),D=r(1748);(R=P||(P={})).Tree=1,R.Blob=2,R.Handle=3,R.Attachment=4;var M=r(7983),q=r(1096),L=r(8991),B=r(6705),j=r(2045);class _{constructor(e,t,r,n,s){this.objectId=e,this._connected=t,this.submit=r,this.dirty=n,this.addedGCOutboundReference=s}get handler(){return N(!!this._handler,375),this._handler}get connected(){return this._connected}attach(e){N(void 0===this._handler,376),this._handler=e}setConnectionState(e){this._connected=e,this.handler.setConnectionState(e)}process(e,t,r){try{this.handler.process(e,t,r)}catch(t){throw E.Hi.wrapIfUnrecognized(t,"channelDeltaConnectionFailedToProcessMessage",e)}}reSubmit(e,t){this.handler.reSubmit(e,t)}rollback(e,t){if(void 0===this.handler.rollback)throw new Error("Handler doesn't support rollback");this.handler.rollback(e,t)}applyStashedOp(e){return this.handler.applyStashedOp(e)}}var H=r(484);class U{constructor(e,t,r,n){this.tree=e,this.storage=t,this.logger=r,this.extraBlobs=n,this.flattenedTree={},void 0!==e&&U.flattenTree("",e,this.flattenedTree)}static flattenTree(e,t,r){for(const n in t.trees)U.flattenTree(`${e}${n}/`,t.trees[n],r);for(const n in t.blobs)r[`${e}${n}`]=t.blobs[n]}async contains(e){return void 0!==this.flattenedTree[e]}async readBlob(e){const t=await this.getIdForPath(e),r=void 0!==this.extraBlobs?this.extraBlobs.get(t):void 0;if(void 0!==r)return r;const n=this.storage.readBlob(t);return n.catch((e=>this.logger.sendErrorEvent({eventName:"ChannelStorageBlobError"},e))),n}async list(e){var t;let r=this.tree;const n=(0,H.g)(e);for(;void 0!==r&&n.length>0;){const e=n.shift();r=r.trees[e]}if(void 0===r||0!==n.length)throw new Error("path does not exist");return Object.keys(null!==(t=null==r?void 0:r.blobs)&&void 0!==t?t:{})}async getIdForPath(e){return this.flattenedTree[e]}}const z=".attributes";function V(e,t,r,n,s,i,o,a,c){return{deltaConnection:new _(e,t,((e,t)=>r(e,t)),n,s),objectStorage:new U(a,i,o,c)}}function G(e,t=!1,r=!1,n){const s=e.getAttachSummary(t,r,n);return(0,L.Rt)(s,z,JSON.stringify(e.attributes)),s}async function K(e,t=!1,r=!1,n){const s=await e.summarize(t,r,n);return(0,L.Rt)(s,z,JSON.stringify(e.attributes)),s}var W=r(361),$=r.n(W),J=r(9252);class X{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}}class Q{constructor(e,t,r,n){this.id=e,this.registry=t,this.runtime=r,this.servicesGetter=n,this.globallyVisible=!1,this.pending=[],N(!this.id.includes("/"),783)}async getChannel(){return N(void 0!==this.channel,519),this.channel}get isLoaded(){return void 0!==this.channel}setConnectionState(e,t){this.globallyVisible&&this.isLoaded&&this.servicesGetter().value.deltaConnection.setConnectionState(e)}processOp(e,t,r){N(this.globallyVisible,723),this.isLoaded?this.servicesGetter().value.deltaConnection.process(e,t,r):(N(!1===t,393),this.pending.push(e))}reSubmit(e,t){N(this.isLoaded,394),N(this.globallyVisible,724),this.servicesGetter().value.deltaConnection.reSubmit(e,t)}rollback(e,t){N(this.isLoaded,750),N(this.globallyVisible,751),this.servicesGetter().value.deltaConnection.rollback(e,t)}applyStashedOp(){throw new Error("no stashed ops on local channel")}async summarize(e=!1,t=!1,r){return N(this.isLoaded&&void 0!==this.channel,396),K(this.channel,e,t,r)}getAttachSummary(e){return N(this.isLoaded&&void 0!==this.channel,397),G(this.channel,!0,!1,e)}makeVisible(){if(this.globallyVisible)throw new Error("Channel is already globally visible");this.isLoaded&&(N(!!this.channel,402),this.channel.connect(this.servicesGetter().value)),this.globallyVisible=!0}async getGCData(e=!1){return N(this.isLoaded&&void 0!==this.channel,403),this.channel.getGCData(e)}updateUsedRoutes(e,t){}}class Z extends Q{constructor(e,t,r,n,s,i,o,a,c,h){super(e,t,r,(()=>this.services)),this.snapshotTree=h;const l=new Map,u=$()(this.snapshotTree);this.isSnapshotInOldFormatAndCollectBlobs(u,l)&&this.sanitizeSnapshot(u),this.services=new X((()=>V(this.id,n.connected,o,this.dirtyFn,c,s,i,u,l))),this.dirtyFn=()=>{a(e)}}async getChannel(){return void 0===this.channel&&(this.channel=await this.loadChannel().catch((e=>{throw E.Hi.wrapIfUnrecognized(e,"rehydratedLocalChannelContextFailedToLoadChannel",void 0)}))),this.channel}async loadChannel(){N(!this.isLoaded,398),N(await this.services.value.objectStorage.contains(".attributes"),400);const e=await(0,J.g)(this.services.value.objectStorage,".attributes");if(N(void 0===this.factory,520),this.factory=this.registry.get(e.type),void 0===this.factory)throw new Error(`Channel Factory ${e.type} not registered`);const t=await this.factory.load(this.runtime,this.id,this.services.value,e);this.channel=t;for(const e of this.pending)this.services.value.deltaConnection.process(e,!1,void 0);return this.channel}isSnapshotInOldFormatAndCollectBlobs(e,t){let r=!1;const n=e.blobsContents;Object.entries(n).forEach((([n,s])=>{t.set(n,s),void 0!==e.blobs[n]&&(r=!0)}));for(const n of Object.values(e.trees))r=r||this.isSnapshotInOldFormatAndCollectBlobs(n,t);return r}sanitizeSnapshot(e){const t=new Map(Object.entries(e.blobs));for(const[r,n]of t.entries())void 0===t.get(n)&&delete e.blobs[r];for(const t of Object.values(e.trees))this.sanitizeSnapshot(t)}}class Y extends Q{constructor(e,t,r,n,s,i,o,a,c,h){if(super(e,t,n,(()=>this.services)),N(void 0!==r,521),this.factory=t.get(r),void 0===this.factory)throw new Error(`Channel Factory ${r} not registered`);this.channel=this.factory.create(n,e),this.services=new X((()=>V(this.id,s.connected,a,this.dirtyFn,h,i,o))),this.dirtyFn=()=>{c(e)}}}var ee,te=r(6171);class re{constructor(e,t,r,n,s,i,o,a,c,h,l,u,d){this.runtime=e,this.dataStoreContext=t,this.id=o,this.registry=c,this.attachMessageType=d,this.isLoaded=!1,this.pending=[],N(!this.id.includes("/"),784),this.subLogger=I.G2.create(this.runtime.logger,"RemoteChannelContext"),this.services=V(this.id,this.dataStoreContext.connected,n,(()=>s(this.id)),i,r,this.subLogger,a,h),this.summarizerNode=l((async(e,t,r)=>this.summarizeInternal(e,t,r)),(async e=>this.getGCDataInternal(e)),(async()=>u())),this.thresholdOpsCounter=new te.z(re.pendingOpsCountThreshold,this.subLogger)}getChannel(){return void 0===this.channelP&&(this.channelP=this.loadChannel()),this.channelP}setConnectionState(e,t){this.isLoaded&&this.services.deltaConnection.setConnectionState(e)}applyStashedOp(e){return N(this.isLoaded,404),this.services.deltaConnection.applyStashedOp(e)}processOp(e,t,r){this.summarizerNode.invalidate(e.sequenceNumber),this.isLoaded?this.services.deltaConnection.process(e,t,r):(N(!t,405),N(void 0!==this.pending,574),this.pending.push(e),this.thresholdOpsCounter.sendIfMultiple("StorePendingOps",this.pending.length))}reSubmit(e,t){N(this.isLoaded,406),this.services.deltaConnection.reSubmit(e,t)}rollback(e,t){N(this.isLoaded,752),this.services.deltaConnection.rollback(e,t)}async summarize(e=!1,t=!0,r){return this.summarizerNode.summarize(e,t,r)}async summarizeInternal(e,t,r){const n=await this.getChannel(),s=await K(n,e,t,r);return Object.assign(Object.assign({},s),{id:this.id})}async loadChannel(){let e,t;if(N(!this.isLoaded,407),await this.services.objectStorage.contains(z)&&(e=await(0,J.g)(this.services.objectStorage,z)),void 0===e){if(void 0===this.attachMessageType)throw new E.Jd("channelTypeNotAvailable",{channelId:{value:this.id,tag:I.XI.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:I.XI.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/")});if(t=this.registry.get(this.attachMessageType),void 0===t)throw new E.Jd("channelFactoryNotRegisteredForAttachMessageType",{channelId:{value:this.id,tag:I.XI.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:I.XI.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/"),channelFactoryType:this.attachMessageType});e=t.attributes}else if(t=this.registry.get(e.type),void 0===t)throw new E.Jd("channelFactoryNotRegisteredForGivenType",{channelId:{value:this.id,tag:I.XI.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:I.XI.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/"),channelFactoryType:e.type});void 0!==e.snapshotFormatVersion&&e.snapshotFormatVersion!==t.attributes.snapshotFormatVersion&&this.subLogger.sendTelemetryEvent({eventName:"ChannelAttributesVersionMismatch",channelType:{value:e.type,tag:I.XI.PackageData},channelSnapshotVersion:{value:`${e.snapshotFormatVersion}@${e.packageVersion}`,tag:I.XI.PackageData},channelCodeVersion:{value:`${t.attributes.snapshotFormatVersion}@${t.attributes.packageVersion}`,tag:I.XI.PackageData}});const r=await t.load(this.runtime,this.id,this.services,e);N(void 0!==this.pending,575);for(const e of this.pending)this.services.deltaConnection.process(e,!1,void 0);return this.thresholdOpsCounter.send("ProcessPendingOps",this.pending.length),this.channel=r,this.pending=void 0,this.isLoaded=!0,this.services.deltaConnection.setConnectionState(this.dataStoreContext.connected),this.channel}async getGCData(e=!1){return this.summarizerNode.getGCData(e)}async getGCDataInternal(e=!1){return(await this.getChannel()).getGCData(e)}updateUsedRoutes(e,t){this.summarizerNode.updateUsedRoutes([""])}}re.pendingOpsCountThreshold=1e3,function(e){e.Attach="attach",e.ChannelOp="op"}(ee||(ee={}));class ne extends A{constructor(e,t,r){super(),this.dataStoreContext=e,this.sharedObjectRegistry=t,this._disposed=!1,this.contexts=new Map,this.contextsDeferred=new Map,this.pendingAttach=new Map,this.deferredAttached=new T,this.localChannelContextQueue=new Map,this.notBoundedChannelContextSet=new Set,this.pendingHandlesToMakeVisible=new Set,N(!e.id.includes("/"),782),this.logger=I.G2.create(e.logger,"FluidDataStoreRuntime",{all:{dataStoreId:(0,j.Z)()}}),this.id=e.id,this.options=e.options,this.deltaManager=e.deltaManager,this.quorum=e.getQuorum(),this.audience=e.getAudience();const n=e.baseSnapshot;this.channelsBaseGCDetails=new O((async()=>{var e,t,r;const n=await(null!==(r=null===(t=(e=this.dataStoreContext).getBaseGCDetails)||void 0===t?void 0:t.call(e))&&void 0!==r?r:this.dataStoreContext.getInitialGCSummaryDetails());return(0,B.$I)(n)})),void 0!==(null==n?void 0:n.trees)&&Object.keys(n.trees).forEach((t=>{if("_search"===t)return;let r;e.isLocalDataStore?(r=new Z(t,this.sharedObjectRegistry,this,this.dataStoreContext,this.dataStoreContext.storage,this.logger,((e,r)=>this.submitChannelOp(t,e,r)),(e=>this.setChannelDirty(e)),((e,t)=>this.addedGCOutboundReference(e,t)),n.trees[t]),e.attachState!==C.mB.Detached?r.makeVisible():this.localChannelContextQueue.set(t,r)):r=new re(this,e,e.storage,((e,r)=>this.submitChannelOp(t,e,r)),(e=>this.setChannelDirty(e)),((e,t)=>this.addedGCOutboundReference(e,t)),t,n.trees[t],this.sharedObjectRegistry,void 0,this.dataStoreContext.getCreateChildSummarizerNodeFn(t,{type:M.CreateSummarizerNodeSource.FromSummary}),(async()=>this.getChannelBaseGCDetails(t)));const s=new T;s.resolve(r),this.contexts.set(t,r),this.contextsDeferred.set(t,s)})),this.attachListener(),this.bindState=r?C.xU.Bound:C.xU.NotBound,this._attachState=e.attachState,this.visibilityState=r?e.attachState===C.mB.Detached?M.VisibilityState.LocallyVisible:M.VisibilityState.GloballyVisible:M.VisibilityState.NotVisible,r&&this.deferredAttached.resolve()}static load(e,t,r){return new ne(e,t,r)}get IFluidRouter(){return this}get connected(){return this.dataStoreContext.connected}get clientId(){return this.dataStoreContext.clientId}get clientDetails(){return this.dataStoreContext.clientDetails}get isAttached(){return this.attachState!==C.mB.Detached}get attachState(){return this._attachState}get absolutePath(){return(0,q.H)(this.id,this.routeContext)}get routeContext(){return this.dataStoreContext.IFluidHandleContext}get IFluidHandleContext(){return this}get rootRoutingContext(){return this}get channelsRoutingContext(){return this}get objectsRoutingContext(){return this}get disposed(){return this._disposed}dispose(){this._disposed||(this._disposed=!0,this.emit("dispose"),this.removeAllListeners())}async resolveHandle(e){return this.request(e)}async request(e){try{const t=i.R.create(e),r=t.pathParts[0];if("_channels"===r||"_custom"===r)return this.request(t.createSubRequest(1));if(this.contextsDeferred.has(r)&&t.isLeaf(1))try{const e=await this.contextsDeferred.get(r).promise;return{mimeType:"fluid/object",status:200,value:await e.getChannel()}}catch(t){return this.logger.sendErrorEvent({eventName:"GetChannelFailedInRequest"},t),(0,o.Ys)(500,`Failed to get Channel: ${t}`,e)}return(0,o.I4)(e)}catch(e){return(0,o.Nj)(e)}}async getChannel(e){this.verifyNotClosed(),this.contextsDeferred.has(e)||this.contextsDeferred.set(e,new T);const t=await this.contextsDeferred.get(e).promise;return await t.getChannel()}createChannel(e=(0,j.Z)(),t){if(e.includes("/"))throw new E.Oi(`Id cannot contain slashes: ${e}`);this.verifyNotClosed(),N(!this.contexts.has(e),377),this.notBoundedChannelContextSet.add(e);const r=new Y(e,this.sharedObjectRegistry,t,this,this.dataStoreContext,this.dataStoreContext.storage,this.logger,((t,r)=>this.submitChannelOp(e,t,r)),(e=>this.setChannelDirty(e)),((e,t)=>this.addedGCOutboundReference(e,t)));if(this.contexts.set(e,r),this.contextsDeferred.has(e))this.contextsDeferred.get(e).resolve(r);else{const t=new T;t.resolve(r),this.contextsDeferred.set(e,t)}return N(!!r.channel,378),r.channel}bindChannel(e){N(this.notBoundedChannelContextSet.has(e.id),379),this.notBoundedChannelContextSet.delete(e.id),this.isAttached?this.attachChannel(e):this.pendingHandlesToMakeVisible.has(e.handle)||(this.bind(e.handle),this.localChannelContextQueue.has(e.id)||this.localChannelContextQueue.set(e.id,this.contexts.get(e.id)))}makeVisibleAndAttachGraph(){this.visibilityState===M.VisibilityState.NotVisible&&(this.visibilityState=M.VisibilityState.LocallyVisible,this.pendingHandlesToMakeVisible.forEach((e=>{e.attachGraph()})),this.pendingHandlesToMakeVisible.clear(),this.bindToContext())}attachGraph(){this.makeVisibleAndAttachGraph()}bindToContext(){this.bindState===C.xU.NotBound&&(this.bindState=C.xU.Binding,this.dataStoreContext.bindToContext(),this.bindState=C.xU.Bound)}bind(e){this.visibilityState===M.VisibilityState.NotVisible?this.pendingHandlesToMakeVisible.add(e):e.attachGraph()}setConnectionState(e,t){this.verifyNotClosed();for(const[,r]of this.contexts)r.setConnectionState(e,t);(0,F.Qq)(this.logger,this,e,t)}getQuorum(){return this.quorum}getAudience(){return this.audience}async uploadBlob(e){return this.verifyNotClosed(),this.dataStoreContext.uploadBlob(e)}process(e,t,r){this.verifyNotClosed();try{switch(e.type){case ee.Attach:{const r=e.contents,n=r.id;if(t)N(this.pendingAttach.has(n),380),this.pendingAttach.delete(n);else{N(!this.contexts.has(n),381);const t=new Map,s=(0,D.m)(r.snapshot.entries,t),i=new re(this,this.dataStoreContext,this.dataStoreContext.storage,((e,t)=>this.submitChannelOp(n,e,t)),(e=>this.setChannelDirty(e)),((e,t)=>this.addedGCOutboundReference(e,t)),n,s,this.sharedObjectRegistry,t,this.dataStoreContext.getCreateChildSummarizerNodeFn(n,{type:M.CreateSummarizerNodeSource.FromAttach,sequenceNumber:e.sequenceNumber,snapshot:r.snapshot}),(async()=>this.getChannelBaseGCDetails(n)),r.type);if(this.contexts.set(n,i),this.contextsDeferred.has(n))this.contextsDeferred.get(n).resolve(i);else{const e=new T;e.resolve(i),this.contextsDeferred.set(n,e)}}break}case ee.ChannelOp:this.processChannelOp(e,t,r)}this.emit("op",e)}catch(t){throw E.Hi.wrapIfUnrecognized(t,"fluidDataStoreRuntimeFailedToProcessMessage",e)}}processSignal(e,t){this.emit("signal",e,t)}isChannelAttached(e){return!this.notBoundedChannelContextSet.has(e)&&!this.localChannelContextQueue.has(e)&&!this.pendingAttach.has(e)}getOutboundRoutes(){const e=[];for(const[t]of this.contexts)e.push(`${this.absolutePath}/${t}`);return e}updateGCNodes(e){e.addRouteToAllNodes(this.absolutePath),e.addNode("/",this.getOutboundRoutes())}async getGCData(e=!1){const t=new B.iR;return await Promise.all(Array.from(this.contexts).filter((([e,t])=>this.isChannelAttached(e))).map((async([r,n])=>{const s=await n.getGCData(e);t.prefixAndAddNodes(r,s.gcNodes)}))),this.updateGCNodes(t),t.getGCData()}updateUsedRoutes(e,t){var r;const n=(0,B.xu)(e);for(const[e]of n)N(this.contexts.has(e),382);for(const[e,s]of this.contexts)s.updateUsedRoutes(null!==(r=n.get(e))&&void 0!==r?r:[],t)}addedGCOutboundReference(e,t){var r,n;null===(n=(r=this.dataStoreContext).addedGCOutboundReference)||void 0===n||n.call(r,e,t)}async getChannelBaseGCDetails(e){var t;let r=(await this.channelsBaseGCDetails).get(e);return void 0===r?r={}:void 0!==(null===(t=r.gcData)||void 0===t?void 0:t.gcNodes)&&(0,B.DJ)(r.gcData.gcNodes,this.absolutePath),void 0!==r.usedRoutes&&0!==r.usedRoutes.length||(r.usedRoutes=[""]),r}async summarize(e=!1,t=!0,r){const n=new L.x1;return await Promise.all(Array.from(this.contexts).filter((([e,t])=>{const r=this.isChannelAttached(e);return N(r,383),r})).map((async([s,i])=>{const o=await i.summarize(e,t,r);n.addWithStats(s,o)}))),n.getSummaryTree()}getAttachSummary(e){this.attachGraph();const t=new L.x1;for(const[r,n]of this.contexts){if(!(n instanceof Q))throw new k.j4("Should only be called with local channel handles");if(!this.notBoundedChannelContextSet.has(r)){let s;if(n.isLoaded){const t=n.getAttachSummary(e);N(t.summary.type===P.Tree,384),s={stats:t.stats,summary:t.summary}}else N(!!this.dataStoreContext.baseSnapshot,385),s=(0,L.S5)(this.dataStoreContext.baseSnapshot.trees[r]);t.addWithStats(r,s)}}return t.getSummaryTree()}submitMessage(e,t,r){this.submit(e,t,r)}submitSignal(e,t){return this.verifyNotClosed(),this.dataStoreContext.submitSignal(e,t)}async waitAttached(){return this.deferredAttached.promise}attachChannel(e){if(this.verifyNotClosed(),e.handle.isAttached)return;e.handle.attachGraph(),N(this.isAttached,386),N(this.visibilityState===M.VisibilityState.GloballyVisible,720);const t=G(e,!0,!1),r=(0,L.H4)(t.summary),n={id:e.id,snapshot:r,type:e.attributes.type};this.pendingAttach.set(e.id,n),this.submit(ee.Attach,n),this.contexts.get(e.id).makeVisible()}submitChannelOp(e,t,r){const n={address:e,contents:t};this.submit(ee.ChannelOp,n,r)}submit(e,t,r=void 0){this.verifyNotClosed(),this.dataStoreContext.submitMessage(e,t,r)}reSubmit(e,t,r){switch(this.verifyNotClosed(),e){case ee.ChannelOp:{const e=t,n=this.contexts.get(e.address);N(!!n,387),n.reSubmit(e.contents,r);break}case ee.Attach:this.submit(e,t,r);break;default:!function(e,t="Unreachable Case"){throw new Error(t)}()}}rollback(e,t,r){switch(this.verifyNotClosed(),e){case ee.ChannelOp:{const e=t,n=this.contexts.get(e.address);N(!!n,749),n.rollback(e.contents,r);break}default:throw new k.j4(`Can't rollback ${e} message`)}}async applyStashedOp(e){const t=e,r=this.contexts.get(t.address);return N(!!r,388),await r.getChannel(),r.applyStashedOp(t.contents)}setChannelDirty(e){this.verifyNotClosed(),this.dataStoreContext.setChannelDirty(e)}processChannelOp(e,t,r){this.verifyNotClosed();const n=e.contents,s=Object.assign(Object.assign({},e),{contents:n.contents}),i=this.contexts.get(n.address);return N(!!i,389),i.processOp(s,t,r),i}attachListener(){this.setMaxListeners(Number.MAX_SAFE_INTEGER),this.dataStoreContext.once("attaching",(()=>{this.attachGraph(),this._attachState=C.mB.Attaching,N(this.visibilityState===M.VisibilityState.LocallyVisible,721),this.visibilityState=M.VisibilityState.GloballyVisible,this.localChannelContextQueue.forEach((e=>{e.makeVisible()})),this.localChannelContextQueue.clear(),this.deferredAttached.resolve(),this.emit("attaching")})),this.dataStoreContext.once("attached",(()=>{N(this.visibilityState===M.VisibilityState.GloballyVisible,722),this._attachState=C.mB.Attached,this.emit("attached")}))}verifyNotClosed(){if(this._disposed)throw new k.j4("Runtime is closed")}}const se=(e,t=ne)=>class extends t{async request(t){const r=await super.request(t);return 404===r.status?e(t,this):r}};async function ie(e,t,r,n,s,i,o){let a=s;a=se((async(e,t)=>(await p.getDataObject(t)).request(e)),a);const c=new a(t,r,i),h=t.scope,l=new e({runtime:c,context:t,providers:new S(h.IFluidDependencySynthesizer).synthesize(n,{}),initProps:o});return i||await l.finishInitialization(i),{instance:l,runtime:c}}class oe{constructor(e,t,r,n,s,i=ne){if(this.type=e,this.ctor=t,this.optionalProviders=n,this.runtimeClass=i,""===this.type)throw new Error("undefined type member");void 0!==s&&(this.registry=new m.P(s)),this.sharedObjectRegistry=new Map(r.map((e=>[e.type,e])))}get IFluidDataStoreFactory(){return this}get IFluidDataStoreRegistry(){return this.registry}get registryEntry(){return[this.type,Promise.resolve(this)]}async instantiateDataStore(e,t){const{runtime:r}=await ie(this.ctor,e,this.sharedObjectRegistry,this.optionalProviders,this.runtimeClass,t);return r}async createChildInstance(e,t){return this.createNonRootInstanceCore(e.containerRuntime,[...e.packagePath,this.type],t)}async createPeerInstance(e,t){return this.createNonRootInstanceCore(e.containerRuntime,e.packagePath,t)}async createInstance(e,t){return this.createNonRootInstanceCore(e,[this.type],t)}async createRootInstance(e,t,r){const n=t.createDetachedRootDataStore([this.type],e);return this.createInstanceCore(n,r)}async createNonRootInstanceCore(e,t,r){const n=e.createDetachedDataStore(t);return this.createInstanceCore(n,r)}async createInstanceCore(e,t){const{instance:r,runtime:n}=await ie(this.ctor,e,this.sharedObjectRegistry,this.optionalProviders,this.runtimeClass,!1,t);return await e.attachRuntime(this,n),r}}class ae extends oe{constructor(e,t,r=[],i,o,a=ne){const c=[...r];r.find((e=>e.type===n.y.Type))||c.push(n.u.getFactory()),r.find((e=>e.type===s.c.Type))||c.push(s.G.getFactory()),super(e,t,c,i,o,a)}}const ce=e=>void 0!==(null==e?void 0:e.factory),he=e=>void 0!==(null==e?void 0:e.getFactory);class le extends g{constructor(){super(...arguments),this.initialObjectsDirKey="initial-objects-key",this._initialObjects={}}get initialObjectsDir(){const e=this.root.getSubDirectory(this.initialObjectsDirKey);if(void 0===e)throw new Error("InitialObjects sub-directory was not initialized");return e}async initializingFirstTime(e){this.root.createSubDirectory(this.initialObjectsDirKey);const t=[];Object.entries(e.initialObjects).forEach((([e,r])=>{t.push((async()=>{const t=await this.create(r);this.initialObjectsDir.set(e,t.handle)})())})),await Promise.all(t)}async hasInitialized(){const e=[];for(const[t,r]of Array.from(this.initialObjectsDir.entries())){const n=async()=>{const e=await r.get();Object.assign(this._initialObjects,{[t]:e})};e.push(n())}await Promise.all(e)}get initialObjects(){if(0===Object.keys(this._initialObjects).length)throw new Error("Initial Objects were not correctly initialized");return this._initialObjects}async create(e){if(ce(e))return this.createDataObject(e);if(he(e))return this.createSharedObject(e);throw new Error("Could not create new Fluid object because an unknown object was passed")}async createDataObject(e){const t=e.factory,r=[...this.context.packagePath,t.type],n=await this.context.containerRuntime.createDataStore(r);return(0,o.bb)(n,"/")}createSharedObject(e){const t=e.getFactory();return this.runtime.createChannel(void 0,t.type)}}const ue="rootDOId";class de extends x{constructor(e){const[t,r]=(e=>{var t;const r=new Set,n=new Set;if(new Set([...Object.values(e.initialObjects),...null!==(t=e.dynamicObjectTypes)&&void 0!==t?t:[]]).forEach((e=>{if(he(e))n.add(e.getFactory());else{if(!ce(e))throw new Error("Entry is neither a DataObject or a SharedObject");r.add([e.factory.type,Promise.resolve(e.factory)])}})),0===r.size&&0===n.size)throw new Error("Container cannot be initialized without any DataTypes");return[Array.from(r),Array.from(n)]})(e),n=new ae("rootDO",le,r,{},t);var s;super([n.registryEntry],void 0,[(s=ue,async(e,t)=>{const r=i.R.create(e);if(0===r.pathParts.length)return t.IFluidHandleContext.resolveHandle({url:`/${s}${r.query}`,headers:e.headers})})],{flushMode:M.FlushMode.Immediate}),this.rootDataObjectFactory=n,this.initialObjects=e.initialObjects}async containerInitializingFirstTime(e){await this.rootDataObjectFactory.createRootInstance(ue,e,{initialObjects:this.initialObjects})}}},9074:(e,t,r)=>{"use strict";r.d(t,{c:()=>s});var n=r(6239);class s extends n.L{constructor(e){super(),this.container=e,this.lastMembers=new Map,this.audience=e.audience,this.getMembers(),this.audience.on("addMember",((e,t)=>{if(this.shouldIncludeAsMember(t)){const t=this.getMember(e);this.emit("memberAdded",e,t),this.emit("membersChanged")}})),this.audience.on("removeMember",(e=>{this.lastMembers.has(e)&&(this.emit("memberRemoved",e,this.lastMembers.get(e)),this.emit("membersChanged"))})),this.container.on("connected",(()=>this.emit("membersChanged")))}getMembers(){const e=new Map,t=new Map;return this.audience.getMembers().forEach(((r,n)=>{if(this.shouldIncludeAsMember(r)){const s=r.user.id;let i=e.get(s);void 0===i&&(i=this.createServiceMember(r),e.set(s,i)),i.connections.push({id:n,mode:r.mode}),t.set(n,i)}})),this.lastMembers=t,e}getMyself(){const e=this.container.clientId;if(void 0!==e)return this.getMember(e)}getMember(e){const t=this.audience.getMember(e);if(void 0===t)return;const r=this.getMembers().get(null==t?void 0:t.user.id);if(void 0===r)throw Error(`Attempted to fetch client ${e} that is not part of the current member list`);return r}shouldIncludeAsMember(e){return e.details.capabilities.interactive}}},6239:(e,t,r)=>{"use strict";r.d(t,{L:()=>s});var n=r(7187);class s extends n.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}},6705:(e,t,r)=>{"use strict";function n(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}function s(e){return e.replace(/^\/+|\/+$/g,"")}function i(e){const t={};for(const[r,n]of Object.entries(e.gcNodes))t[r]=Array.from(n);return{gcNodes:t}}function o(e){const t=new Map;if(void 0===e.gcData)return t;const r=e.gcData.gcNodes;delete r["/"];for(const[e,s]of Object.entries(r)){n(e.startsWith("/"),686);const r=e.split("/")[1];let i=e.slice(r.length+1);""===i&&(i="/");let o=t.get(r);void 0===o&&(o={gcData:{gcNodes:{}},usedRoutes:[]}),n(void 0!==o.gcData,687),o.gcData.gcNodes[i]=[...new Set(s)],t.set(r,o)}if(void 0===e.usedRoutes)return t;const s=e.usedRoutes.filter((e=>""!==e&&"/"!==e));for(const e of s){n(e.startsWith("/"),688);const r=e.split("/")[1],s=e.slice(r.length+1),i=t.get(r);n(void 0!==(null==i?void 0:i.usedRoutes),689),i.usedRoutes.push(s),t.set(r,i)}return t}function a(e){const t=e.filter((e=>""!==e&&"/"!==e)),r=new Map;for(const e of t){n(e.startsWith("/"),408);const t=e.split("/")[1],s=e.slice(t.length+1),i=r.get(t);void 0!==i?i.push(s):r.set(t,[s])}return r}function c(e,t){const r=Object.entries(e);for(const[n,s]of r){const r=new Set(s);r.delete(t),e[n]=[...r]}}function h(e,t){var r;const s={};for(const[t,r]of Object.entries(e.gcNodes))s[t]={outboundRoutes:Array.from(r.outboundRoutes),unreferencedTimestampMs:r.unreferencedTimestampMs};for(const[e,i]of Object.entries(t.gcNodes)){let t=s[e];void 0===t?t={outboundRoutes:Array.from(i.outboundRoutes),unreferencedTimestampMs:i.unreferencedTimestampMs}:(void 0!==i.unreferencedTimestampMs&&void 0!==t.unreferencedTimestampMs&&n(i.unreferencedTimestampMs===t.unreferencedTimestampMs,690),t={outboundRoutes:[...new Set([...i.outboundRoutes,...t.outboundRoutes])],unreferencedTimestampMs:null!==(r=i.unreferencedTimestampMs)&&void 0!==r?r:t.unreferencedTimestampMs}),s[e]=t}return{gcNodes:s}}function l(e,t){const r=i(e);for(const[e,n]of Object.entries(t.gcNodes))if(void 0===r.gcNodes[e])r.gcNodes[e]=Array.from(n);else{const t=[...n,...r.gcNodes[e]];r.gcNodes[e]=[...new Set(t)]}return r}r.d(t,{iR:()=>u,rn:()=>i,$4:()=>l,eF:()=>h,DJ:()=>c,aG:()=>s,$I:()=>o,xu:()=>a});class u{constructor(){this.gcNodesSet={}}get gcNodes(){const e={};for(const[t,r]of Object.entries(this.gcNodesSet))e[t]=[...r];return e}addNode(e,t){this.gcNodesSet[e]=new Set(t)}prefixAndAddNodes(e,t){for(const[r,n]of Object.entries(t)){let t=r.replace(/^\/+/g,"");t=`/${e}/${t}`,t=t.replace(/\/+$/g,""),this.gcNodesSet[t]=new Set(n)}}addNodes(e){for(const[t,r]of Object.entries(e))this.gcNodesSet[t]=new Set(r)}addRouteToAllNodes(e){for(const t of Object.values(this.gcNodesSet))t.add(e)}getGCData(){return{gcNodes:this.gcNodes}}}},7648:(e,t,r)=>{"use strict";r.d(t,{y:()=>b,u:()=>S});var n=r(5537),s=r(7187);class i extends s.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}var o,a,c=r(9268),h=r(9252),l=r(4469),u=r(7583),d=r(4148),p=r(8991),g=r(6470),m=r(3080),f=r(7285);const y=g.posix,v="header";class b{get type(){return b.Type}get attributes(){return b.Attributes}async load(e,t,r,n){const s=new S(t,e,n);return await s.load(r),s}create(e,t){const r=new S(t,e,b.Attributes);return r.initializeLocal(),r}}b.Type="https://graph.microsoft.com/types/directory",b.Attributes={type:b.Type,snapshotFormatVersion:"0.1",packageVersion:f.Z};class S extends u.h{constructor(e,t,r){super(e,t,r,"fluid_directory_"),this[o]="SharedDirectory",this.root=new E(this,this.runtime,this.serializer,y.sep),this.messageHandlers=new Map,this.localValueMaker=new m.oU(this.serializer),this.setMessageHandlers(),this.root.on("containedValueChanged",((e,t)=>{this.emit("containedValueChanged",e,t,this)})),this.root.on("subDirectoryCreated",((e,t)=>{this.emit("subDirectoryCreated",e,t,this)})),this.root.on("subDirectoryDeleted",((e,t)=>{this.emit("subDirectoryDeleted",e,t,this)}))}static create(e,t){return e.createChannel(t,b.Type)}static getFactory(){return new b}get absolutePath(){return this.root.absolutePath}get(e){return this.root.get(e)}set(e,t){return this.root.set(e,t),this}dispose(e){this.root.dispose(e)}get disposed(){return this.root.disposed}delete(e){return this.root.delete(e)}clear(){this.root.clear()}has(e){return this.root.has(e)}get size(){return this.root.size}forEach(e){this.root.forEach(e)}[(o=Symbol.toStringTag,Symbol.iterator)](){return this.root[Symbol.iterator]()}entries(){return this.root.entries()}countSubDirectory(){return this.root.countSubDirectory()}keys(){return this.root.keys()}values(){return this.root.values()}createSubDirectory(e){return this.root.createSubDirectory(e)}getSubDirectory(e){return this.root.getSubDirectory(e)}hasSubDirectory(e){return this.root.hasSubDirectory(e)}deleteSubDirectory(e){return this.root.deleteSubDirectory(e)}subdirectories(){return this.root.subdirectories()}getWorkingDirectory(e){const t=this.makeAbsolute(e);if(t===y.sep)return this.root;let r=this.root;const n=t.substr(1).split(y.sep);for(const e of n)if(r=r.getSubDirectory(e),!r)return;return r}summarizeCore(e,t){return this.serializeDirectory(this.root,e)}submitDirectoryMessage(e,t){this.submitLocalMessage(e,t)}onDisconnect(){}reSubmitCore(e,t){const r=e,s=this.messageHandlers.get(r.type);(0,n.h)(void 0!==s,13),s.submit(r,t)}async loadCore(e){const t=await(0,h.g)(e,v),r=t;Array.isArray(r.blobs)?(this.populate(r.content),await Promise.all(r.blobs.map((async t=>{const r=await(0,h.g)(e,t);this.populate(r)})))):this.populate(t)}populate(e){const t=[];for(t.push([this.root,e]);t.length>0;){const[e,r]=t.pop();if(r.subdirectories)for(const[n,s]of Object.entries(r.subdirectories)){let r=e.getSubDirectory(n);r||(r=new E(this,this.runtime,this.serializer,y.join(e.absolutePath,n)),e.populateSubDirectory(n,r)),t.push([r,s])}if(r.storage)for(const[t,n]of Object.entries(r.storage)){const r=this.makeLocal(t,e.absolutePath,n);e.populateStorage(t,r)}}}processCore(e,t,r){if(e.type===l.C.Operation){const s=e.contents,i=this.messageHandlers.get(s.type);(0,n.h)(void 0!==i,14),i.process(s,t,r)}}rollback(e,t){const r=e,n=this.getWorkingDirectory(r.path);n&&n.rollback(r,t)}makeAbsolute(e){return y.resolve(y.sep,e)}makeLocal(e,t,r){return(0,n.h)(r.type===d.G[d.G.Plain]||r.type===d.G[d.G.Shared],484),this.localValueMaker.fromSerializable(r)}setMessageHandlers(){this.messageHandlers.set("clear",{process:(e,t,r)=>{const n=this.getWorkingDirectory(e.path);n&&n.processClearMessage(e,t,r)},submit:(e,t)=>{const r=this.getWorkingDirectory(e.path);r&&r.resubmitClearMessage(e,t)}}),this.messageHandlers.set("delete",{process:(e,t,r)=>{const n=this.getWorkingDirectory(e.path);n&&n.processDeleteMessage(e,t,r)},submit:(e,t)=>{const r=this.getWorkingDirectory(e.path);r&&r.resubmitKeyMessage(e,t)}}),this.messageHandlers.set("set",{process:(e,t,r)=>{const n=this.getWorkingDirectory(e.path);if(n){const s=t?void 0:this.makeLocal(e.key,e.path,e.value);n.processSetMessage(e,s,t,r)}},submit:(e,t)=>{const r=this.getWorkingDirectory(e.path);r&&r.resubmitKeyMessage(e,t)}}),this.messageHandlers.set("createSubDirectory",{process:(e,t,r)=>{const n=this.getWorkingDirectory(e.path);n&&n.processCreateSubDirectoryMessage(e,t,r)},submit:(e,t)=>{const r=this.getWorkingDirectory(e.path);r&&r.resubmitSubDirectoryMessage(e,t)}}),this.messageHandlers.set("deleteSubDirectory",{process:(e,t,r)=>{const n=this.getWorkingDirectory(e.path);n&&n.processDeleteSubDirectoryMessage(e,t,r)},submit:(e,t)=>{const r=this.getWorkingDirectory(e.path);r&&r.resubmitSubDirectoryMessage(e,t)}})}applyStashedOp(){throw new Error("not implemented")}serializeDirectory(e,t,r){const n=new p.x1;let s=0;const i=[],o=[],a={};for(o.push([e,a]);o.length>0;){const[e,r]=o.pop();for(const[o,a]of e.getSerializedStorage(t)){r.storage||(r.storage={});const t={type:a.type,value:a.value&&JSON.parse(a.value)};if(a.value&&a.value.length>=8192){const r={};let a=r;if(e.absolutePath!==y.sep)for(const t of e.absolutePath.substr(1).split(y.sep)){const e={};a.subdirectories={[t]:e},a=e}a.storage={[o]:t};const c=`blob${s}`;s++,i.push(c),n.addBlob(c,JSON.stringify(r))}else r.storage[o]=t}for(const[t,n]of e.subdirectories()){r.subdirectories||(r.subdirectories={});const e={};r.subdirectories[t]=e,o.push([n,e])}}const c={blobs:i,content:a};return n.addBlob(v,JSON.stringify(c)),n.getSummaryTree()}}function w(e){return void 0!==e&&"number"==typeof e.pendingMessageId&&"edit"===e.type}function x(e){return void 0!==e&&"clear"===e.type&&"number"==typeof e.pendingMessageId&&"object"==typeof e.previousStorage}function C(e){return void 0!==e&&"number"==typeof e.pendingMessageId&&("createSubDir"===e.type&&"boolean"==typeof e.previouslyExisted||"deleteSubDir"===e.type)}class E extends i{constructor(e,t,r,n){super(),this.directory=e,this.runtime=t,this.serializer=r,this.absolutePath=n,this._deleted=!1,this[a]="SubDirectory",this._storage=new Map,this._subdirectories=new Map,this.pendingKeys=new Map,this.pendingSubDirectories=new Map,this.pendingMessageId=-1,this.pendingClearMessageIds=[]}dispose(e){this._deleted=!0,this.emit("disposed",this)}undispose(){this._deleted=!1}get disposed(){return this._deleted}throwIfDisposed(){if(this._deleted)throw new c.Oi("Cannot access Disposed subDirectory")}has(e){return this.throwIfDisposed(),this._storage.has(e)}get(e){var t;return this.throwIfDisposed(),null===(t=this._storage.get(e))||void 0===t?void 0:t.value}set(e,t){if(this.throwIfDisposed(),null==e)throw new Error("Undefined and null keys are not supported");const r=this.directory.localValueMaker.fromInMemory(t),n=(0,m.wA)(r,this.serializer,this.directory.handle),s=this.setCore(e,r,!0);if(!this.directory.isAttached())return this;const i={key:e,path:this.absolutePath,type:"set",value:n};return this.submitKeyMessage(i,s),this}countSubDirectory(){return this._subdirectories.size}createSubDirectory(e){if(this.throwIfDisposed(),null==e)throw new Error("SubDirectory name may not be undefined or null");if(e.includes(y.sep))throw new Error(`SubDirectory name may not contain ${y.sep}`);const t=this.createSubDirectoryCore(e,!0),r=this._subdirectories.get(e);if(!this.directory.isAttached())return r;const n={path:this.absolutePath,subdirName:e,type:"createSubDirectory"};return this.submitCreateSubDirectoryMessage(n,!t),r}getSubDirectory(e){return this.throwIfDisposed(),this._subdirectories.get(e)}hasSubDirectory(e){return this.throwIfDisposed(),this._subdirectories.has(e)}deleteSubDirectory(e){this.throwIfDisposed();const t=this.deleteSubDirectoryCore(e,!0);if(!this.directory.isAttached())return void 0!==t;const r={path:this.absolutePath,subdirName:e,type:"deleteSubDirectory"};return this.submitDeleteSubDirectoryMessage(r,t),void 0!==t}subdirectories(){return this.throwIfDisposed(),this._subdirectories.entries()}getWorkingDirectory(e){return this.throwIfDisposed(),this.directory.getWorkingDirectory(this.makeAbsolute(e))}delete(e){this.throwIfDisposed();const t=this.deleteCore(e,!0);if(!this.directory.isAttached())return void 0!==t;const r={key:e,path:this.absolutePath,type:"delete"};return this.submitKeyMessage(r,t),void 0!==t}clear(){if(this.throwIfDisposed(),!this.directory.isAttached())return void this.clearCore(!0);const e=new Map(this._storage);this.clearCore(!0);const t={path:this.absolutePath,type:"clear"};this.submitClearMessage(t,e)}forEach(e){this.throwIfDisposed(),this._storage.forEach(((t,r,n)=>{e(t.value,r,n)}))}get size(){return this.throwIfDisposed(),this._storage.size}entries(){this.throwIfDisposed();const e=this._storage.entries();return{next(){const t=e.next();return t.done?{value:void 0,done:!0}:{value:[t.value[0],t.value[1].value],done:!1}},[Symbol.iterator](){return this}}}keys(){return this.throwIfDisposed(),this._storage.keys()}values(){this.throwIfDisposed();const e=this._storage.values();return{next(){const t=e.next();return t.done?{value:void 0,done:!0}:{value:t.value.value,done:!1}},[Symbol.iterator](){return this}}}[(a=Symbol.toStringTag,Symbol.iterator)](){return this.throwIfDisposed(),this.entries()}processClearMessage(e,t,r){if(this.throwIfDisposed(),t){(0,n.h)(x(r),15);const e=this.pendingClearMessageIds.shift();(0,n.h)(e===r.pendingMessageId,810)}else this.clearExceptPendingKeys()}processDeleteMessage(e,t,r){this.throwIfDisposed(),this.needProcessStorageOperation(e,t,r)&&this.deleteCore(e.key,t)}processSetMessage(e,t,r,n){this.throwIfDisposed(),this.needProcessStorageOperation(e,r,n)&&this.setCore(e.key,t,r)}processCreateSubDirectoryMessage(e,t,r){this.throwIfDisposed(),this.needProcessSubDirectoryOperation(e,t,r)&&this.createSubDirectoryCore(e.subdirName,t)}processDeleteSubDirectoryMessage(e,t,r){this.throwIfDisposed(),this.needProcessSubDirectoryOperation(e,t,r)&&this.deleteSubDirectoryCore(e.subdirName,t)}submitClearMessage(e,t){this.throwIfDisposed();const r=++this.pendingMessageId;this.pendingClearMessageIds.push(r);const n={type:"clear",pendingMessageId:r,previousStorage:t};this.directory.submitDirectoryMessage(e,n)}resubmitClearMessage(e,t){(0,n.h)(x(t),811);const r=this.pendingClearMessageIds.shift();(0,n.h)(r===t.pendingMessageId,812),this.submitClearMessage(e,t.previousStorage)}getKeyMessageId(e){const t=++this.pendingMessageId,r=this.pendingKeys.get(e.key);return void 0!==r?r.push(t):this.pendingKeys.set(e.key,[t]),t}submitKeyMessage(e,t){this.throwIfDisposed();const r={type:"edit",pendingMessageId:this.getKeyMessageId(e),previousValue:t};this.directory.submitDirectoryMessage(e,r)}resubmitKeyMessage(e,t){(0,n.h)(w(t),813);const r=this.pendingKeys.get(e.key);(0,n.h)(void 0!==r&&r[0]===t.pendingMessageId,814),r.shift(),0===r.length&&this.pendingKeys.delete(e.key),this.submitKeyMessage(e,t.previousValue)}getSubDirMessageId(e){const t=++this.pendingMessageId,r=this.pendingSubDirectories.get(e.subdirName);return void 0!==r?r.push(t):this.pendingSubDirectories.set(e.subdirName,[t]),t}submitCreateSubDirectoryMessage(e,t){this.throwIfDisposed();const r={type:"createSubDir",pendingMessageId:this.getSubDirMessageId(e),previouslyExisted:t};this.directory.submitDirectoryMessage(e,r)}submitDeleteSubDirectoryMessage(e,t){this.throwIfDisposed();const r={type:"deleteSubDir",pendingMessageId:this.getSubDirMessageId(e),subDirectory:t};this.directory.submitDirectoryMessage(e,r)}resubmitSubDirectoryMessage(e,t){(0,n.h)(C(t),815);const r=this.pendingSubDirectories.get(e.subdirName);(0,n.h)(void 0!==r&&r[0]===t.pendingMessageId,816),r.shift(),0===r.length&&this.pendingSubDirectories.delete(e.subdirName),"createSubDir"===t.type?this.submitCreateSubDirectoryMessage(e,t.previouslyExisted):this.submitDeleteSubDirectoryMessage(e,t.subDirectory)}*getSerializedStorage(e){this.throwIfDisposed();for(const[t,r]of this._storage){const n=[t,r.makeSerialized(e,this.directory.handle)];yield n}}populateStorage(e,t){this.throwIfDisposed(),this._storage.set(e,t)}populateSubDirectory(e,t){this.throwIfDisposed(),this._subdirectories.set(e,t)}getLocalValue(e){return this.throwIfDisposed(),this._storage.get(e)}rollbackPendingMessageId(e,t,r){const n=e.get(t),s=null==n?void 0:n.pop();if(!n||s!==r)throw new Error("Rollback op does not match last pending");0===n.length&&e.delete(t)}rollback(e,t){if(void 0===(r=t)||"number"!=typeof r.pendingMessageId||!("edit"===r.type||"deleteSubDir"===r.type||"clear"===r.type&&"object"==typeof r.previousStorage||"createSubDir"===r.type&&"boolean"==typeof r.previouslyExisted))throw new Error("Invalid localOpMetadata");var r;if("clear"===e.type&&"clear"===t.type){t.previousStorage.forEach(((e,t)=>{this.setCore(t,e,!0)}));const e=this.pendingClearMessageIds.pop();if(void 0===e||e!==t.pendingMessageId)throw new Error("Rollback op does match last clear")}else if("delete"!==e.type&&"set"!==e.type||"edit"!==t.type)if("createSubDirectory"===e.type&&"createSubDir"===t.type)t.previouslyExisted||this.deleteSubDirectoryCore(e.subdirName,!0),this.rollbackPendingMessageId(this.pendingSubDirectories,e.subdirName,t.pendingMessageId);else{if("deleteSubDirectory"!==e.type||"deleteSubDir"!==t.type)throw new Error("Unsupported op for rollback");void 0!==t.subDirectory&&(this.undeleteSubDirectoryTree(t.subDirectory),this._subdirectories.set(e.subdirName,t.subDirectory),this.emit("subDirectoryCreated",e.subdirName,!0,this)),this.rollbackPendingMessageId(this.pendingSubDirectories,e.subdirName,t.pendingMessageId)}else void 0===t.previousValue?this.deleteCore(e.key,!0):this.setCore(e.key,t.previousValue,!0),this.rollbackPendingMessageId(this.pendingKeys,e.key,t.pendingMessageId)}makeAbsolute(e){return y.resolve(this.absolutePath,e)}needProcessStorageOperation(e,t,r){if(this.pendingClearMessageIds.length>0)return t&&(0,n.h)(void 0!==r&&w(r)&&r.pendingMessageId<this.pendingClearMessageIds[0],16),!1;if(void 0!==this.pendingKeys.get(e.key)){if(t){(0,n.h)(void 0!==r&&w(r),17);const t=this.pendingKeys.get(e.key);(0,n.h)(void 0!==t&&t[0]===r.pendingMessageId,817),t.shift(),0===t.length&&this.pendingKeys.delete(e.key)}return!1}return!t}needProcessSubDirectoryOperation(e,t,r){if(void 0!==this.pendingSubDirectories.get(e.subdirName)){if(t){(0,n.h)(C(r),18);const t=this.pendingSubDirectories.get(e.subdirName);(0,n.h)(void 0!==t&&t[0]===r.pendingMessageId,818),t.shift(),0===t.length&&this.pendingSubDirectories.delete(e.subdirName)}return!1}return!t}clearExceptPendingKeys(){const e=new Map;this.pendingKeys.forEach(((t,r,n)=>{e.set(r,this._storage.get(r))})),this.clearCore(!1),e.forEach(((e,t,r)=>{this.setCore(t,e,!0)}))}clearCore(e){this._storage.clear(),this.directory.emit("clear",e,this.directory)}deleteCore(e,t){const r=this._storage.get(e),n=null==r?void 0:r.value;if(this._storage.delete(e)){const r={key:e,path:this.absolutePath,previousValue:n};this.directory.emit("valueChanged",r,t,this.directory);const s={key:e,previousValue:n};this.emit("containedValueChanged",s,t,this)}return r}setCore(e,t,r){const n=this._storage.get(e),s=null==n?void 0:n.value;this._storage.set(e,t);const i={key:e,path:this.absolutePath,previousValue:s};this.directory.emit("valueChanged",i,r,this.directory);const o={key:e,previousValue:s};return this.emit("containedValueChanged",o,r,this),n}createSubDirectoryCore(e,t){if(!this._subdirectories.has(e)){const r=y.join(this.absolutePath,e),n=new E(this.directory,this.runtime,this.serializer,r);return this.registerEventsOnSubDirectory(n,e),this._subdirectories.set(e,n),this.emit("subDirectoryCreated",e,t,this),!0}return!1}registerEventsOnSubDirectory(e,t){e.on("subDirectoryCreated",((e,r)=>{this.emit("subDirectoryCreated",y.join(t,e),r,this)})),e.on("subDirectoryDeleted",((e,r)=>{this.emit("subDirectoryDeleted",y.join(t,e),r,this)}))}deleteSubDirectoryCore(e,t){const r=this._subdirectories.get(e);return void 0!==r&&(this._subdirectories.delete(e),this.disposeSubDirectoryTree(r),this.emit("subDirectoryDeleted",e,t,this)),r}disposeSubDirectoryTree(e){if(!e)return;const t=e.subdirectories();for(const[e,r]of t)this.disposeSubDirectoryTree(r);"function"==typeof e.dispose&&e.dispose()}undeleteSubDirectoryTree(e){for(const[e,t]of this._subdirectories.entries())this.undeleteSubDirectoryTree(t);e.undispose()}}},3080:(e,t,r)=>{"use strict";r.d(t,{oU:()=>a,wA:()=>i});var n=r(4148),s=r(8343);function i(e,t,r){const n=e.makeSerialized(t,r);return{type:n.type,value:n.value&&JSON.parse(n.value)}}class o{constructor(e){this.value=e}get type(){return n.G[n.G.Plain]}makeSerialized(e,t){const r=(0,s.Yv)(this.value,e,t);return{type:this.type,value:r}}}class a{constructor(e){this.serializer=e}fromSerializable(e){if(e.type===n.G[n.G.Shared]){e.type=n.G[n.G.Plain];const t={type:"__fluid_handle__",url:e.value};e.value=t}const t=(0,s.lB)(e.value,this.serializer);return new o(t)}fromInMemory(e){return new o(e)}}},5759:(e,t,r)=>{"use strict";r.d(t,{c:()=>f,G:()=>y});var n=r(4469),s=r(9252),i=r(7583),o=r(8991),a=r(4148),c=r(5537),h=r(3080);function l(e){return void 0!==e&&"number"==typeof e.pendingMessageId&&("add"===e.type||"edit"===e.type)}function u(e){return void 0!==e&&"clear"===e.type&&"number"==typeof e.pendingMessageId}class d{constructor(e,t,r,n,s){this.serializer=e,this.handle=t,this.submitMessage=r,this.isAttached=n,this.eventEmitter=s,this.messageHandlers=new Map,this.data=new Map,this.pendingKeys=new Map,this.pendingMessageId=-1,this.pendingClearMessageIds=[],this.localValueMaker=new h.oU(e),this.messageHandlers=this.getMessageHandlers()}get size(){return this.data.size}keys(){return this.data.keys()}entries(){const e=this.data.entries();return{next(){const t=e.next();return t.done?{value:void 0,done:!0}:{value:[t.value[0],t.value[1].value],done:!1}},[Symbol.iterator](){return this}}}values(){const e=this.data.values();return{next(){const t=e.next();return t.done?{value:void 0,done:!0}:{value:t.value.value,done:!1}},[Symbol.iterator](){return this}}}[Symbol.iterator](){return this.entries()}forEach(e){this.data.forEach(((t,r,n)=>{e(t.value,r,n)}))}get(e){const t=this.data.get(e);return void 0===t?void 0:t.value}has(e){return this.data.has(e)}set(e,t){if(null==e)throw new Error("Undefined and null keys are not supported");const r=this.localValueMaker.fromInMemory(t),n=(0,h.wA)(r,this.serializer,this.handle),s=this.setCore(e,r,!0);if(!this.isAttached())return;const i={key:e,type:"set",value:n};this.submitMapKeyMessage(i,s)}delete(e){const t=this.deleteCore(e,!0);if(!this.isAttached())return void 0!==t;const r={key:e,type:"delete"};return this.submitMapKeyMessage(r,t),void 0!==t}clear(){const e=this.isAttached()?new Map(this.data):void 0;this.clearCore(!0),this.isAttached()&&this.submitMapClearMessage({type:"clear"},e)}getSerializedStorage(e){const t={};return this.data.forEach(((r,n)=>{t[n]=r.makeSerialized(e,this.handle)})),t}getSerializableStorage(e){const t={};return this.data.forEach(((r,n)=>{t[n]=(0,h.wA)(r,e,this.handle)})),t}serialize(e){return JSON.stringify(this.getSerializableStorage(e))}populateFromSerializable(e){for(const[t,r]of Object.entries(e)){const e={key:t,value:this.makeLocal(t,r)};this.data.set(e.key,e.value)}}populate(e){this.populateFromSerializable(JSON.parse(e))}trySubmitMessage(e,t){const r=this.messageHandlers.get(e.type);return void 0!==r&&(r.submit(e,t),!0)}tryGetStashedOpLocalMetadata(e){const t=this.messageHandlers.get(e.type);if(void 0===t)throw new Error("no apply stashed op handler");return t.getStashedOpLocalMetadata(e)}tryProcessMessage(e,t,r){const n=this.messageHandlers.get(e.type);return void 0!==n&&(n.process(e,t,r),!0)}rollback(e,t){if(void 0===(r=t)||"number"!=typeof r.pendingMessageId||"add"!==r.type&&"edit"!==r.type&&"clear"!==r.type)throw new Error("Invalid localOpMetadata");var r;if("clear"===e.type&&"clear"===t.type){if(void 0===t.previousMap)throw new Error("Cannot rollback without previous map");t.previousMap.forEach(((e,t)=>{this.setCore(t,e,!0)}));const e=this.pendingClearMessageIds.pop();if(void 0===e||e!==t.pendingMessageId)throw new Error("Rollback op does match last clear")}else{if("delete"!==e.type&&"set"!==e.type)throw new Error("Unsupported op for rollback");{if("add"===t.type)this.deleteCore(e.key,!0);else{if("edit"!==t.type||void 0===t.previousValue)throw new Error("Cannot rollback without previous value");this.setCore(e.key,t.previousValue,!0)}const r=this.pendingKeys.get(e.key),n=null==r?void 0:r.pop();if(!r||n!==t.pendingMessageId)throw new Error("Rollback op does not match last pending");0===r.length&&this.pendingKeys.delete(e.key)}}}setCore(e,t,r){const n=this.data.get(e),s=null==n?void 0:n.value;return this.data.set(e,t),this.eventEmitter.emit("valueChanged",{key:e,previousValue:s},r,this.eventEmitter),n}clearCore(e){this.data.clear(),this.eventEmitter.emit("clear",e,this.eventEmitter)}deleteCore(e,t){const r=this.data.get(e),n=null==r?void 0:r.value;return this.data.delete(e)&&this.eventEmitter.emit("valueChanged",{key:e,previousValue:n},t,this.eventEmitter),r}clearExceptPendingKeys(){const e=new Map;this.pendingKeys.forEach(((t,r)=>{e.set(r,this.data.get(r))})),this.clearCore(!1),e.forEach(((e,t)=>{this.setCore(t,e,!0)}))}makeLocal(e,t){if(t.type===a.G[a.G.Plain]||t.type===a.G[a.G.Shared])return this.localValueMaker.fromSerializable(t);throw new Error("Unknown local value type")}needProcessKeyOperation(e,t,r){if(this.pendingClearMessageIds.length>0)return t&&(0,c.h)(void 0!==r&&l(r)&&r.pendingMessageId<this.pendingClearMessageIds[0],19),!1;if(void 0!==this.pendingKeys.get(e.key)){if(t){(0,c.h)(void 0!==r&&l(r),20);const t=this.pendingKeys.get(e.key);(0,c.h)(void 0!==t&&t[0]===r.pendingMessageId,762),t.shift(),0===t.length&&this.pendingKeys.delete(e.key)}return!1}return!t}getMessageHandlers(){const e=new Map;return e.set("clear",{process:(e,t,r)=>{if(t){(0,c.h)(u(r),21);const e=this.pendingClearMessageIds.shift();(0,c.h)(e===r.pendingMessageId,763)}else 0===this.pendingKeys.size?this.clearCore(t):this.clearExceptPendingKeys()},submit:(e,t)=>{(0,c.h)(u(t),764);const r=this.pendingClearMessageIds.shift();(0,c.h)(r===t.pendingMessageId,765),this.submitMapClearMessage(e,t.previousMap)},getStashedOpLocalMetadata:e=>({type:"clear",pendingMessageId:this.getMapClearMessageId()})}),e.set("delete",{process:(e,t,r)=>{this.needProcessKeyOperation(e,t,r)&&this.deleteCore(e.key,t)},submit:(e,t)=>{this.resubmitMapKeyMessage(e,t)},getStashedOpLocalMetadata:e=>({type:"edit",pendingMessageId:this.getMapKeyMessageId(e)})}),e.set("set",{process:(e,t,r)=>{if(!this.needProcessKeyOperation(e,t,r))return;const n=this.makeLocal(e.key,e.value);this.setCore(e.key,n,t)},submit:(e,t)=>{this.resubmitMapKeyMessage(e,t)},getStashedOpLocalMetadata:e=>({type:"edit",pendingMessageId:this.getMapKeyMessageId(e)})}),e}getMapClearMessageId(){const e=++this.pendingMessageId;return this.pendingClearMessageIds.push(e),e}submitMapClearMessage(e,t){const r={type:"clear",pendingMessageId:this.getMapClearMessageId(),previousMap:t};this.submitMessage(e,r)}getMapKeyMessageId(e){const t=++this.pendingMessageId,r=this.pendingKeys.get(e.key);return void 0!==r?r.push(t):this.pendingKeys.set(e.key,[t]),t}submitMapKeyMessage(e,t){const r=this.getMapKeyMessageId(e),n=t?{type:"edit",pendingMessageId:r,previousValue:t}:{type:"add",pendingMessageId:r};this.submitMessage(e,n)}resubmitMapKeyMessage(e,t){(0,c.h)(l(t),766);const r=this.pendingKeys.get(e.key);(0,c.h)(void 0!==r&&r[0]===t.pendingMessageId,767),r.shift(),0===r.length&&this.pendingKeys.delete(e.key);const n=this.getMapKeyMessageId(e),s="edit"===t.type?{type:"edit",pendingMessageId:n,previousValue:t.previousValue}:{type:"add",pendingMessageId:n};this.submitMessage(e,s)}}var p,g=r(7285);const m="header";class f{get type(){return f.Type}get attributes(){return f.Attributes}async load(e,t,r,n){const s=new y(t,e,n);return await s.load(r),s}create(e,t){const r=new y(t,e,f.Attributes);return r.initializeLocal(),r}}f.Type="https://graph.microsoft.com/types/map",f.Attributes={type:f.Type,snapshotFormatVersion:"0.2",packageVersion:g.Z};class y extends i.h{constructor(e,t,r){super(e,t,r,"fluid_map_"),this[p]="SharedMap",this.kernel=new d(this.serializer,this.handle,((e,t)=>this.submitLocalMessage(e,t)),(()=>this.isAttached()),this)}static create(e,t){return e.createChannel(t,f.Type)}static getFactory(){return new f}keys(){return this.kernel.keys()}entries(){return this.kernel.entries()}values(){return this.kernel.values()}[(p=Symbol.toStringTag,Symbol.iterator)](){return this.kernel.entries()}get size(){return this.kernel.size}forEach(e){this.kernel.forEach(e)}get(e){return this.kernel.get(e)}has(e){return this.kernel.has(e)}set(e,t){return this.kernel.set(e,t),this}delete(e){return this.kernel.delete(e)}clear(){this.kernel.clear()}summarizeCore(e,t){let r=0,n=0,s={};const i=[],a=new o.x1,c=this.kernel.getSerializedStorage(e);for(const e of Object.keys(c)){const t=c[e];if(t.value&&t.value.length>=8192){const r=`blob${n}`;n++,i.push(r);const s={[e]:{type:t.type,value:JSON.parse(t.value)}};a.addBlob(r,JSON.stringify(s))}else{if(r+=t.type.length+21,t.value&&(r+=t.value.length),r>16384){const e=`blob${n}`;n++,i.push(e),a.addBlob(e,JSON.stringify(s)),s={},r=0}s[e]={type:t.type,value:void 0===t.value?void 0:JSON.parse(t.value)}}}const h={blobs:i,content:s};return a.addBlob(m,JSON.stringify(h)),a.getSummaryTree()}async loadCore(e){const t=await(0,s.g)(e,m),r=t;Array.isArray(r.blobs)?(this.kernel.populateFromSerializable(r.content),await Promise.all(r.blobs.map((async t=>{const r=await(0,s.g)(e,t);this.kernel.populateFromSerializable(r)})))):this.kernel.populateFromSerializable(t)}onDisconnect(){}reSubmitCore(e,t){this.kernel.trySubmitMessage(e,t)}applyStashedOp(e){return this.kernel.tryProcessMessage(e,!1,void 0),this.kernel.tryGetStashedOpLocalMetadata(e)}processCore(e,t,r){e.type===n.C.Operation&&this.kernel.tryProcessMessage(e.contents,t,r)}rollback(e,t){this.kernel.rollback(e,t)}}},7285:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});const n="1.3.7"},5537:(e,t,r)=>{"use strict";function n(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}r.d(t,{h:()=>n})},4469:(e,t,r)=>{"use strict";var n,s;r.d(t,{C:()=>n}),function(e){e.NoOp="noop",e.ClientJoin="join",e.ClientLeave="leave",e.Propose="propose",e.Reject="reject",e.Summarize="summarize",e.SummaryAck="summaryAck",e.SummaryNack="summaryNack",e.Operation="op",e.RemoteHelp="remoteHelp",e.NoClient="noClient",e.RoundTrip="tripComplete",e.Control="control"}(n||(n={})),function(e){e.ThrottlingError="ThrottlingError",e.InvalidScopeError="InvalidScopeError",e.BadRequestError="BadRequestError",e.LimitExceededError="LimitExceededError"}(s||(s={}))},1044:(e,t,r)=>{"use strict";var n,s,i,o,a;function c(e,t="Unreachable Case"){throw new Error(t)}function h(e){const t=e.type===n.Handle?e.handleType:e.type;switch(t){case n.Blob:case n.Attachment:return s.File;case n.Tree:return s.Directory;default:c(0,`Unknown type: ${t}`)}}function l(e){const t=e.type===n.Handle?e.handleType:e.type;switch(t){case n.Blob:case n.Attachment:return"blob";case n.Tree:return"tree";default:c(0,`Unknown type: ${t}`)}}function u(e,t=new Map,r=!1){const n={},s={id:e.sha,blobs:{},trees:{}};n[""]=s;for(const s of e.tree){const e=r?s.path.replace(/^\.app\//,""):s.path,i=e.lastIndexOf("/"),o=e.slice(0,Math.max(0,i)),a=e.slice(i+1),c=n[o];if("tree"===s.type){const t={id:s.sha,blobs:{},commits:{},trees:{}};c.trees[decodeURIComponent(a)]=t,n[e]=t}else{if("blob"!==s.type)throw new Error("Unknown entry type!!");c.blobs[decodeURIComponent(a)]=s.sha,t.set(s.sha,`/${e}`)}}return s}r.d(t,{sG:()=>g,Qp:()=>d,VN:()=>p,eB:()=>u,ZO:()=>h,FE:()=>l}),function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(n||(n={})),(a=s||(s={})).File="100644",a.Executable="100755",a.Directory="040000",a.Symlink="120000",(o=i||(i={})).Blob="Blob",o.Tree="Tree",o.Attachment="Attachment";class d{constructor(e,t,r="utf-8"){this.path=e,this.mode=s.File,this.type=i.Blob,this.value={contents:t,encoding:r}}}class p{constructor(e,t){this.path=e,this.value=t,this.mode=s.Directory,this.type=i.Tree}}class g{constructor(e,t){this.path=e,this.id=t,this.mode=s.File,this.type=i.Attachment,this.value={id:t}}}},2527:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.VisibilityState=t.FlushMode=void 0,(r=t.FlushMode||(t.FlushMode={}))[r.Immediate=0]="Immediate",r[r.TurnBased=1]="TurnBased",t.VisibilityState={NotVisible:"NotVisible",LocallyVisible:"LocallyVisible",GloballyVisible:"GloballyVisible"}},5397:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IFluidDataStoreFactory=void 0,t.IFluidDataStoreFactory="IFluidDataStoreFactory"},9768:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IFluidDataStoreRegistry=void 0,t.IFluidDataStoreRegistry="IFluidDataStoreRegistry"},739:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.gcBlobKey=void 0,t.gcBlobKey="gc"},7983:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(5397),t),s(r(9768),t),s(r(2527),t),s(r(739),t),s(r(7288),t),s(r(5574),t)},7288:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},5574:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.totalBlobSizePropertyName=t.blobCountPropertyName=t.channelsTreeName=t.CreateSummarizerNodeSource=void 0,(r=t.CreateSummarizerNodeSource||(t.CreateSummarizerNodeSource={}))[r.FromSummary=0]="FromSummary",r[r.FromAttach=1]="FromAttach",r[r.Local=2]="Local",t.channelsTreeName=".channels",t.blobCountPropertyName="BlobCount",t.totalBlobSizePropertyName="TotalBlobSize"},1096:(e,t,r)=>{"use strict";function n(e,t){if(""===e)return void 0===t?"":t.absolutePath;{let r=e.startsWith("/")?e.slice(1):e;return r=r.endsWith("/")?r.slice(0,-1):r,void 0===t?`/${r}`:`${"/"===t.absolutePath?"":t.absolutePath}/${r}`}}r.d(t,{H:()=>n})},9703:(e,t,r)=>{"use strict";r.d(t,{I4:()=>c,N_:()=>l,Nj:()=>i,Ys:()=>h,bb:()=>a,fu:()=>o});var n=r(477),s=r(2718);function i(e){if(null!==e&&"object"==typeof e&&!0===e.errorFromRequestFluidObject){const t=e;return{mimeType:"text/plain",status:t.code,value:t.message,get stack(){return t.stack}}}const t=(0,s.FM)();return{mimeType:"text/plain",status:500,value:`${e}`,get stack(){var r;return null!==(r=null==e?void 0:e.stack)&&void 0!==r?r:t.stack}}}function o(e,t){const r=e.value,n=(0,s.FM)();return{errorFromRequestFluidObject:!0,message:r,name:"Error",code:e.status,get stack(){var t;return null!==(t=e.stack)&&void 0!==t?t:n.stack}}}async function a(e,t){const r="string"==typeof t?{url:t}:t,s=await e.request(r);if(200!==s.status||"fluid/object"!==s.mimeType)throw o(s);return(0,n.h)(s.value,410),s.value}const c=e=>h(404,"not found",e);function h(e,t,r){var i;(0,n.h)(200!==e,411);const o=null===(i=r.url)||void 0===i?void 0:i.split("?")[0],a=(0,s.FM)();return{mimeType:"text/plain",status:e,value:void 0===o?t:`${t}: ${o}`,get stack(){return a.stack}}}function l(e,t){return{type:e,get IFluidDataStoreFactory(){return this},get IFluidDataStoreRegistry(){return this},instantiateDataStore:async(e,r)=>(await t).instantiateDataStore(e,r),get:async e=>{var r;return null===(r=(await t).IFluidDataStoreRegistry)||void 0===r?void 0:r.get(e)}}}},9251:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ObjectStoragePartition:()=>i.M,RequestParser:()=>a.R,RuntimeFactoryHelper:()=>c._,SummaryTreeBuilder:()=>u.x1,TelemetryContext:()=>u.TA,addBlobToSummary:()=>u.Rt,addSummarizeResultToSummary:()=>u.QA,addTreeToSummary:()=>u.Jv,calculateStats:()=>u.i6,convertSnapshotTreeToSummaryTree:()=>u.S5,convertSummaryTreeToITree:()=>u.H4,convertToSummaryTree:()=>u.j9,convertToSummaryTreeWithStats:()=>u.MH,create404Response:()=>s.I4,createDataStoreFactory:()=>s.N_,createResponseError:()=>s.Ys,createRootSummarizerNode:()=>h.j,createRootSummarizerNodeWithGC:()=>l.G,exceptionToResponse:()=>s.Nj,generateHandleContextPath:()=>n.H,getBlobSize:()=>u.$A,getNormalizedObjectStoragePathParts:()=>o.g,listBlobsAtTreePath:()=>o.W,mergeStats:()=>u.Jz,requestFluidObject:()=>s.bb,responseToException:()=>s.fu,seqFromTree:()=>d.G,utf8ByteLength:()=>u.mL});var n=r(1096),s=r(9703),i=r(8597),o=r(484),a=r(262),c=r(4263),h=r(8118),l=r(3953),u=r(8991),d=r(1890)},8597:(e,t,r)=>{"use strict";r.d(t,{M:()=>s});var n=r(477);class s{constructor(e,t){this.storage=e,this.path=t,(0,n.h)(!t.endsWith("/"),412)}async readBlob(e){return this.storage.readBlob(`${this.path}/${e}`)}async contains(e){return this.storage.contains(`${this.path}/${e}`)}async list(e){return this.storage.list(`${this.path}/${e}`)}}},484:(e,t,r)=>{"use strict";function n(e){let t=e;return t.startsWith("/")&&(t=t.substr(1)),t.endsWith("/")&&(t=t.substr(0,t.length-1)),t.length>0?t.split("/"):[]}async function s(e,t){const r=n(t);let s=e;for(;void 0!==(null==s?void 0:s.entries)&&r.length>0;){const e=r.shift(),t=s.entries.find((t=>"Tree"===t.type&&t.path===e));s="Tree"===(null==t?void 0:t.type)?t.value:void 0}if(void 0===(null==s?void 0:s.entries)||0!==r.length)throw new Error("path does not exist");return s.entries.filter((e=>"Blob"===e.type)).map((e=>e.path))}r.d(t,{W:()=>s,g:()=>n})},262:(e,t,r)=>{"use strict";r.d(t,{R:()=>n});class n{constructor(e){this.request=e;const t=this.request.url.indexOf("?");this.query=t>=0?this.request.url.substring(t):""}static getPathParts(e){const t=e.indexOf("?");return e.substring(0,t<0?e.length:t).split("/").reduce(((e,t)=>(void 0!==t&&t.length>0&&e.push(decodeURIComponent(t)),e)),[])}static create(e){return e instanceof n?e:new n(e)}get url(){return this.request.url}get headers(){return this.request.headers}get pathParts(){return void 0===this.requestPathParts&&(this.requestPathParts=n.getPathParts(this.url)),this.requestPathParts}isLeaf(e){return""===this.query&&this.pathParts.length===e}createSubRequest(e){const t=this.pathParts.length;if(e<0||e>t)throw new Error("incorrect sub-request");if(e===t&&this.url.includes("?"))return{url:`/${this.query}`,headers:this.headers};const r=`/${this.pathParts.slice(e).join("/")}`;return{url:""===this.query?r:`${r}/${this.query}`,headers:this.headers}}}},4263:(e,t,r)=>{"use strict";r.d(t,{_:()=>n});class n{get IRuntimeFactory(){return this}async instantiateRuntime(e,t){const r=void 0===t?!0===e.existing:t,n=await this.preInitialize(e,r);return r?await this.instantiateFromExisting(n):await this.instantiateFirstTime(n),await this.hasInitialized(n),n}async instantiateFirstTime(e){}async instantiateFromExisting(e){}async hasInitialized(e){}}},8118:(e,t,r)=>{"use strict";r.d(t,{j:()=>l,z:()=>h});var n=r(7983),s=r(6378),i=r(477),o=r(845),a=r(8991),c=r(3945);class h{constructor(e,t,r,n,s,i,o){var a;this.defaultLogger=e,this.summarizeInternalFn=t,this._changeSequenceNumber=n,this._latestSummary=s,this.initialSummary=i,this.wipSummaryLogger=o,this.children=new Map,this.pendingSummaries=new Map,this.outstandingOps=[],this.wipSkipRecursion=!1,this.canReuseHandle=null===(a=r.canReuseHandle)||void 0===a||a,this.throwOnError=!0,this.trackingSequenceNumber=this._changeSequenceNumber}get referenceSequenceNumber(){var e,t;return null!==(t=null===(e=this._latestSummary)||void 0===e?void 0:e.referenceSequenceNumber)&&void 0!==t?t:0}startSummary(e,t){(0,i.h)(void 0===this.wipSummaryLogger,415),(0,i.h)(void 0===this.wipReferenceSequenceNumber,416),this.wipSummaryLogger=t;for(const t of this.children.values())t.startSummary(e,this.wipSummaryLogger);this.wipReferenceSequenceNumber=e}async summarize(e,t=!0,r){if((0,i.h)(this.isTrackingInProgress(),417),(0,i.h)(void 0!==this.wipSummaryLogger,418),this.canReuseHandle&&!e&&!this.hasChanged()){const e=this._latestSummary;if(void 0!==e){this.wipLocalPaths={localPath:e.localPath,additionalPath:e.additionalPath},this.wipSkipRecursion=!0;const t=(0,a.Jz)();return t.handleNodeCount++,{summary:{type:s.J.Handle,handle:e.fullPath.path,handleType:s.J.Tree},stats:t}}}try{const t=await this.summarizeInternalFn(e,!0,r);return this.wipLocalPaths={localPath:c.Zo.create(t.id)},void 0!==t.pathPartsForChildren&&(this.wipLocalPaths.additionalPath=c.Zo.createAndConcat(t.pathPartsForChildren)),{summary:t.summary,stats:t.stats}}catch(e){if(this.throwOnError||this.trackingSequenceNumber<this._changeSequenceNumber)throw e;const t=this._latestSummary,r=this.initialSummary;let n,s;if(void 0!==t)n={fromSummary:!0,summaryNode:t},s=t.localPath;else{if(void 0===(null==r?void 0:r.summary))throw e;n={fromSummary:!1,initialSummary:r.summary},s=c.Zo.create(r.id)}this.wipSummaryLogger.sendErrorEvent({eventName:"SummarizingWithBasePlusOps"},e);const i=(0,c.Cr)(n,this.outstandingOps);return this.wipLocalPaths={localPath:s,additionalPath:i.additionalPath},this.wipSkipRecursion=!0,{summary:i.summary,stats:i.stats}}}completeSummary(e){this.completeSummaryCore(e,void 0,!1)}completeSummaryCore(e,t,r){(0,i.h)(void 0!==this.wipSummaryLogger,419),(0,i.h)(void 0!==this.wipReferenceSequenceNumber,420);let n=this.wipLocalPaths;if(r){const e=this._latestSummary;if(void 0===e)return void this.clearSummary();n={localPath:e.localPath,additionalPath:e.additionalPath}}(0,i.h)(!!n,421);const s=new c.Yl(Object.assign(Object.assign({},n),{referenceSequenceNumber:this.wipReferenceSequenceNumber,basePath:t})),o=s.fullPathForChildren;for(const t of this.children.values())t.completeSummaryCore(e,o,this.wipSkipRecursion||r);this.pendingSummaries.set(e,s),this.clearSummary()}clearSummary(){this.wipReferenceSequenceNumber=void 0,this.wipLocalPaths=void 0,this.wipSkipRecursion=!1,this.wipSummaryLogger=void 0;for(const e of this.children.values())e.clearSummary()}async refreshLatestSummary(e,t,r,n,s){if(void 0!==e){const t=this.pendingSummaries.get(e);if(void 0!==t)return this.refreshLatestSummaryFromPending(e,t.referenceSequenceNumber),{latestSummaryUpdated:!0,wasSummaryTracked:!0}}if(this.referenceSequenceNumber>=t)return{latestSummaryUpdated:!1};const i=await r();return await this.refreshLatestSummaryFromSnapshot(t,i,void 0,c.Zo.create(""),s,n),{latestSummaryUpdated:!0,wasSummaryTracked:!1,snapshot:i}}refreshLatestSummaryFromPending(e,t){const r=this.pendingSummaries.get(e);if(void 0!==r){(0,i.h)(t===r.referenceSequenceNumber,423),this.pendingSummaries.delete(e),this.refreshLatestSummaryCore(t),this._latestSummary=r;for(const r of this.children.values())r.refreshLatestSummaryFromPending(e,t)}else(0,i.h)(void 0===this._latestSummary,422)}async refreshLatestSummaryFromSnapshot(e,t,r,n,s,i){if(this.referenceSequenceNumber>=e)return;this.refreshLatestSummaryCore(e);const{baseSummary:o,pathParts:a}=(0,c.MD)(t,s);this._latestSummary=new c.Yl({referenceSequenceNumber:e,basePath:r,localPath:n});const{childrenTree:h,childrenPathPart:l}=(0,c.TI)(o);void 0!==l&&a.push(l),a.length>0&&(this._latestSummary.additionalPath=c.Zo.createAndConcat(a));const u=this._latestSummary.fullPathForChildren;await Promise.all(Array.from(this.children).filter((([e])=>void 0!==h.trees[e])).map((async([t,r])=>r.refreshLatestSummaryFromSnapshot(e,h.trees[t],u,c.Zo.create(t),s,i))))}refreshLatestSummaryCore(e){for(const[t,r]of this.pendingSummaries)r.referenceSequenceNumber<e&&this.pendingSummaries.delete(t);for(;this.outstandingOps.length>0&&this.outstandingOps[0].sequenceNumber<=e;)this.outstandingOps.shift()}loadBaseSummaryWithoutDifferential(e){const{childrenPathPart:t}=(0,c.TI)(e);void 0!==t&&void 0!==this._latestSummary&&(this._latestSummary.additionalPath=c.Zo.create(t))}async loadBaseSummary(e,t){const r=(0,c.MD)(e,this.defaultLogger),n=await r.getOutstandingOps(t),{childrenPathPart:s}=(0,c.TI)(r.baseSummary);if(void 0!==s&&r.pathParts.push(s),r.pathParts.length>0&&void 0!==this._latestSummary&&(this._latestSummary.additionalPath=c.Zo.createAndConcat(r.pathParts)),n.length>0){const e=n[n.length-1].sequenceNumber;(0,i.h)(e<=this.trackingSequenceNumber,425)}return{baseSummary:r.baseSummary,outstandingOps:n}}recordChange(e){const t=this.outstandingOps[this.outstandingOps.length-1];void 0!==t&&(0,i.h)(t.sequenceNumber<e.sequenceNumber,426),this.invalidate(e.sequenceNumber),this.trackingSequenceNumber=e.sequenceNumber,this.outstandingOps.push(e)}invalidate(e){e>this._changeSequenceNumber&&(this._changeSequenceNumber=e)}hasChanged(){return this._changeSequenceNumber>this.referenceSequenceNumber}get latestSummary(){return this._latestSummary}createChild(e,t,r,n={}){(0,i.h)(!this.children.has(t),427);const s=this.getCreateDetailsForChild(t,r),o=new h(this.defaultLogger,e,n,s.changeSequenceNumber,s.latestSummary,s.initialSummary,this.wipSummaryLogger);return this.maybeUpdateChildState(o),this.children.set(t,o),o}getChild(e){return this.children.get(e)}getCreateDetailsForChild(e,t){var r;let h,l,u;const d=this._latestSummary;switch(t.type){case n.CreateSummarizerNodeSource.FromAttach:if(void 0!==d&&t.sequenceNumber<=d.referenceSequenceNumber)l=d.createForChild(e);else{const r=(0,a.j9)(t.snapshot);h={sequenceNumber:t.sequenceNumber,id:e,summary:r}}u=t.sequenceNumber;break;case n.CreateSummarizerNodeSource.FromSummary:void 0===this.initialSummary&&(0,i.h)(!!d,428);case n.CreateSummarizerNodeSource.Local:{const o=this.initialSummary;if(void 0!==o){let r,l;if(void 0!==o.summary){const{childrenTree:t}=(0,c.ZI)(o.summary.summary);(0,i.h)(t.type===s.J.Tree,470),r=t.tree[e]}t.type===n.CreateSummarizerNodeSource.FromSummary&&(0,i.h)(!!r,429),void 0!==r&&((0,i.h)(r.type===s.J.Tree,430),l={summary:r,stats:(0,a.i6)(r)}),h={sequenceNumber:o.sequenceNumber,id:e,summary:l}}l=null==d?void 0:d.createForChild(e),u=null!==(r=null==d?void 0:d.referenceSequenceNumber)&&void 0!==r?r:-1;break}default:{const e=t.type;(0,o.U)(t,`Unexpected CreateSummarizerNodeSource: ${e}`)}}return{initialSummary:h,latestSummary:l,changeSequenceNumber:u}}maybeUpdateChildState(e){if(this.isTrackingInProgress()&&(e.wipReferenceSequenceNumber=this.wipReferenceSequenceNumber),void 0!==e._latestSummary)for(const[t,r]of this.pendingSummaries.entries()){const n=new c.Yl({referenceSequenceNumber:r.referenceSequenceNumber,basePath:e._latestSummary.basePath,localPath:e._latestSummary.localPath});e.addPendingSummary(t,n)}}addPendingSummary(e,t){this.pendingSummaries.set(e,t)}isTrackingInProgress(){return void 0!==this.wipReferenceSequenceNumber}}const l=(e,t,r,n,s={})=>new h(e,t,s,r,void 0===n?void 0:c.Yl.createForRoot(n))},3945:(e,t,r)=>{"use strict";r.d(t,{Cr:()=>p,MD:()=>d,TI:()=>g,Yl:()=>u,ZI:()=>m,Zo:()=>l});var n=r(477),s=r(6378),i=r(7983),o=r(8991);const a="_baseSummary",c="_outstandingOps",h=100;class l{constructor(e){this.path=e}static create(e){return new l(encodeURIComponent(e))}static createAndConcat(e){var t;let r=l.create(null!==(t=e[0])&&void 0!==t?t:"");for(let t=1;t<e.length;t++)r=r.concat(l.create(e[t]));return r}toString(){return this.path}concat(e){return new l(`${this.path}/${e.path}`)}}class u{constructor(e){this.summary=e}static createForRoot(e){return new u({referenceSequenceNumber:e,basePath:void 0,localPath:l.create("")})}get referenceSequenceNumber(){return this.summary.referenceSequenceNumber}get basePath(){return this.summary.basePath}get localPath(){return this.summary.localPath}get additionalPath(){return this.summary.additionalPath}set additionalPath(e){this.summary.additionalPath=e}get fullPath(){var e,t;return null!==(t=null===(e=this.basePath)||void 0===e?void 0:e.concat(this.localPath))&&void 0!==t?t:this.localPath}get fullPathForChildren(){return void 0!==this.additionalPath?this.fullPath.concat(this.additionalPath):this.fullPath}createForChild(e){return new u({referenceSequenceNumber:this.referenceSequenceNumber,basePath:this.fullPathForChildren,localPath:l.create(e)})}}function d(e,t){let r=e;const s=[],i=[];for(let e=0;;e++){e>h&&t.sendTelemetryEvent({eventName:"DecodeSummaryMaxDepth",maxDecodeDepth:h});const o=r.blobs[c],l=r.trees[a];if(void 0===o&&void 0===l)return{baseSummary:r,pathParts:s,async getOutstandingOps(e){let r=[];for(const n of i){const s=await e(n);if(r.length>0&&s.length>0){const e=r[r.length-1].sequenceNumber,n=s[0].sequenceNumber;if(n<=e)for(t.sendTelemetryEvent({eventName:"DuplicateOutstandingOps",message:`newEarliestSeq <= latestSeq in decodeSummary: ${n} <= ${e}`});s.length>0&&s[0].sequenceNumber<=e;)s.shift()}r=r.concat(s)}return r}};(0,n.h)(!!o,431),(0,n.h)(void 0!==l,432),r=l,s.push(a),i.unshift(o)}}function p(e,t){let r=l.create(a);const n=new o.x1;if(n.addBlob(c,JSON.stringify(t)),e.fromSummary){const t=e.summaryNode;void 0!==t.additionalPath&&(r=r.concat(t.additionalPath)),n.addHandle(a,s.J.Tree,t.fullPath.path)}else n.addWithStats(a,e.initialSummary);const i=n.getSummaryTree();return Object.assign(Object.assign({},i),{additionalPath:r})}function g(e){const t=e.trees[i.channelsTreeName];return void 0!==t?{childrenTree:t,childrenPathPart:i.channelsTreeName}:{childrenTree:e,childrenPathPart:void 0}}function m(e){const t=e.tree[i.channelsTreeName];return void 0!==t?{childrenTree:t,childrenPathPart:i.channelsTreeName}:{childrenTree:e,childrenPathPart:void 0}}},3953:(e,t,r)=>{"use strict";r.d(t,{G:()=>u});class n{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return void 0===this.result&&(this.result=this.execute()),this.result}}var s=r(477),i=r(6705),o=r(7983),a=r(8118),c=r(3945);class h extends c.Yl{constructor(e,t){super(t),this.serializedUsedRoutes=e}}class l extends a.z{constructor(e,t,r,s,i,o,a,c,h){super(e,(async(e,r,n)=>t(e,!0,n)),r,s,i,o,a),this.summarizeFn=t,this.getGCDataFn=c,this.baseGCDetailsLoaded=!1,this.usedRoutes=[""],this.gcDisabled=!0===r.gcDisabled,this.baseGCDetailsP=new n((async()=>{var e;return null!==(e=await(null==h?void 0:h()))&&void 0!==e?e:{usedRoutes:[]}}))}getGCSummaryDetails(){return this.getBaseGCDetails()}getBaseGCDetails(){return{gcData:this.gcData,usedRoutes:this.usedRoutes,unrefTimestamp:this.unreferencedTimestampMs}}async loadBaseGCDetails(){var e;const t=await this.baseGCDetailsP;this.baseGCDetailsLoaded||(this.baseGCDetailsLoaded=!0,void 0!==t.gcData&&(this.gcData=(0,i.rn)(t.gcData)),this.referenceUsedRoutes=null===(e=t.usedRoutes)||void 0===e?void 0:e.sort(),this.unreferencedTimestampMs=t.unrefTimestamp)}async summarize(e,t=!0,r){return!this.gcDisabled&&this.isTrackingInProgress()&&(0,s.h)(void 0!==this.wipSerializedUsedRoutes,433),t?super.summarize(e,!0,r):this.summarizeFn(e,t,r)}async getGCData(e=!1){if((0,s.h)(!this.gcDisabled,434),(0,s.h)(void 0!==this.getGCDataFn,435),await this.loadBaseGCDetails(),!e&&!this.hasDataChanged()&&void 0!==this.gcData)return(0,i.rn)(this.gcData);const t=await this.getGCDataFn(e);return this.gcData=(0,i.rn)(t),t}startSummary(e,t){this.gcDisabled||(0,s.h)(void 0===this.wipSerializedUsedRoutes,436),super.startSummary(e,t)}completeSummaryCore(e,t,r){let n;if(this.gcDisabled||(n=this.wipSerializedUsedRoutes,(0,s.h)(void 0!==n,437)),super.completeSummaryCore(e,t,r),!this.gcDisabled){const t=this.pendingSummaries.get(e);if(void 0!==t){const r=new h(n,t);this.pendingSummaries.set(e,r)}}}clearSummary(){this.wipSerializedUsedRoutes=void 0,super.clearSummary()}refreshLatestSummaryFromPending(e,t){if(!this.gcDisabled){const t=this.pendingSummaries.get(e);void 0!==t&&(this.referenceUsedRoutes=JSON.parse(t.serializedUsedRoutes))}return super.refreshLatestSummaryFromPending(e,t)}async refreshLatestSummaryFromSnapshot(e,t,r,n,s,i){if(!this.gcDisabled){const r=t.blobs[o.gcBlobKey];if(void 0!==r){const t=await i(r);if(this.referenceSequenceNumber>=e)return;this.referenceUsedRoutes=t.usedRoutes}}return super.refreshLatestSummaryFromSnapshot(e,t,r,n,s,i)}createChild(e,t,r,n={},i,o){var a;(0,s.h)(!this.children.has(t),438);const c=this.getCreateDetailsForChild(t,r),h=new l(this.defaultLogger,e,Object.assign(Object.assign({},n),{gcDisabled:null!==(a=n.gcDisabled)&&void 0!==a?a:this.gcDisabled}),c.changeSequenceNumber,c.latestSummary,c.initialSummary,this.wipSummaryLogger,i,o);return this.maybeUpdateChildState(h),this.children.set(t,h),h}deleteChild(e){this.children.delete(e)}getChild(e){return this.children.get(e)}isReferenced(){return this.usedRoutes.includes("")||this.usedRoutes.includes("/")}updateUsedRoutes(e,t){this.usedRoutes=e.sort(),!this.gcDisabled&&this.isTrackingInProgress()&&(this.wipSerializedUsedRoutes=JSON.stringify(this.usedRoutes)),this.isReferenced()?this.unreferencedTimestampMs=void 0:void 0===this.unreferencedTimestampMs&&(this.unreferencedTimestampMs=t)}hasChanged(){return this.hasDataChanged()||this.hasUsedStateChanged()}hasDataChanged(){return super.hasChanged()}hasUsedStateChanged(){return!this.gcDisabled&&(void 0===this.referenceUsedRoutes||JSON.stringify(this.usedRoutes)!==JSON.stringify(this.referenceUsedRoutes))}}const u=(e,t,r,n,s={},i,o)=>new l(e,t,s,r,void 0===n?void 0:c.Yl.createForRoot(n),void 0,void 0,i,o)},8991:(e,t,r)=>{"use strict";r.d(t,{x1:()=>C,TA:()=>N,Rt:()=>S,QA:()=>x,Jv:()=>w,i6:()=>b,S5:()=>T,H4:()=>O,j9:()=>A,MH:()=>E,$A:()=>y,Jz:()=>m,mL:()=>f});var n=r(9742),s=r(477);function i(e,t){switch(t){case"base64":return n.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}const o=(e,t)=>c.from(e).toString(t);function a(e){const t=e;return e instanceof ArrayBuffer||"object"==typeof t&&null!==t&&"number"==typeof t.byteLength&&"function"==typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}class c extends Uint8Array{toString(e){return i(this,e)}static from(e,t,r){if("string"==typeof e)return c.fromString(e,t);if(null!==e&&"object"==typeof e&&a(e.buffer))return(0,s.h)(0===e.byteOffset,0),(0,s.h)(e.byteLength===e.buffer.byteLength,1),c.fromArrayBuffer(e.buffer,t,r);if(a(e))return c.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const n=null!=t?t:0,s=null!=r?r:e.byteLength-n;if(n<0||n>e.byteLength||s<0||s+n>e.byteLength)throw new RangeError;return new c(e,n,s)}static fromString(e,t){switch(t){case"base64":{const t=this.sanitizeBase64(e),r=n.toByteArray(t);return new c(r.buffer)}case"utf8":case"utf-8":case void 0:{const t=(new TextEncoder).encode(e);return new c(t.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!=0&&(t+=["","===","==","="][t.length%4]),t}}const h=e=>c.from(e,"base64").toString("utf-8");var l,u,d=r(845),p=r(1044),g=r(6378);function m(...e){const t={treeNodeCount:0,blobNodeCount:0,handleNodeCount:0,totalBlobSize:0,unreferencedBlobSize:0};for(const r of e)t.treeNodeCount+=r.treeNodeCount,t.blobNodeCount+=r.blobNodeCount,t.handleNodeCount+=r.handleNodeCount,t.totalBlobSize+=r.totalBlobSize,t.unreferencedBlobSize+=r.unreferencedBlobSize;return t}function f(e){let t=e.length;for(let r=e.length-1;r>=0;r--){const n=e.charCodeAt(r);n>127&&n<=2047?t++:n>2047&&n<=65535&&(t+=2),n>=56320&&n<=57343&&r--}return t}function y(e){return"string"==typeof e?f(e):e.byteLength}function v(e,t){switch(e.type){case g.J.Tree:t.treeNodeCount++;for(const r of Object.values(e.tree))v(r,t);return;case g.J.Handle:return void t.handleNodeCount++;case g.J.Blob:return t.blobNodeCount++,void(t.totalBlobSize+=y(e.content));default:return}}function b(e){const t=m();return v(e,t),t}function S(e,t,r){const n={type:g.J.Blob,content:r};e.summary.tree[t]=n,e.stats.blobNodeCount++,e.stats.totalBlobSize+=y(r)}function w(e,t,r){e.summary.tree[t]=r.summary,e.stats=m(e.stats,r.stats)}function x(e,t,r){e.summary.tree[t]=r.summary,e.stats=m(e.stats,r.stats)}!function(e){e.File="100644",e.Executable="100755",e.Directory="040000",e.Symlink="120000"}(l||(l={})),function(e){e.Blob="Blob",e.Tree="Tree",e.Attachment="Attachment"}(u||(u={}));class C{constructor(){this.attachmentCounter=0,this.summaryTree={},this.summaryStats=m(),this.summaryStats.treeNodeCount++}get summary(){return{type:g.J.Tree,tree:Object.assign({},this.summaryTree)}}get stats(){return Object.assign({},this.summaryStats)}addBlob(e,t){S({summary:{type:g.J.Tree,tree:this.summaryTree},stats:this.summaryStats},e,t)}addHandle(e,t,r){this.summaryTree[e]={type:g.J.Handle,handleType:t,handle:r},this.summaryStats.handleNodeCount++}addWithStats(e,t){this.summaryTree[e]=t.summary,this.summaryStats=m(this.summaryStats,t.stats)}addAttachment(e){this.summaryTree[this.attachmentCounter++]={id:e,type:g.J.Attachment}}getSummaryTree(){return{summary:this.summary,stats:this.stats}}}function E(e,t=!1){const r=new C;for(const n of e.entries)switch(n.type){case u.Blob:{const e=n.value;let t;t="base64"===e.encoding?c.from(e.contents,"base64"):e.contents,r.addBlob(n.path,t);break}case u.Tree:{const e=A(n.value,t);r.addWithStats(n.path,e);break}case u.Attachment:{const e=n.value.id;r.addAttachment(e);break}default:throw new Error("Unexpected TreeEntry type")}const n=r.getSummaryTree();return n.summary.unreferenced=e.unreferenced,n}function A(e,t=!1){if(e.id&&!t){const t=m();return t.handleNodeCount++,{summary:{handle:e.id,handleType:g.J.Tree,type:g.J.Handle},stats:t}}return E(e,t)}function T(e){const t=new C;for(const[r,n]of Object.entries(e.blobs)){let s;if(void 0!==e.blobsContents){const t=e.blobsContents[n];void 0!==t&&(s=o(t,"utf-8"))}else void 0!==e.blobs[n]&&(s=h(e.blobs[n]));void 0!==s&&t.addBlob(r,s)}for(const[r,n]of Object.entries(e.trees)){const e=T(n);t.addWithStats(r,e)}const r=t.getSummaryTree();return r.summary.unreferenced=e.unreferenced,r}function O(e){const t=[];for(const[r,n]of Object.entries(e.tree))switch(n.type){case g.J.Blob:{let e,s="utf-8";"string"==typeof n.content?e=n.content:(e=i(n.content,"base64"),s="base64"),t.push(new p.Qp(r,e,s));break}case g.J.Tree:t.push(new p.VN(r,O(n)));break;case g.J.Attachment:t.push(new p.sG(r,n.id));break;case g.J.Handle:throw new Error("Should not have Handle type in summary tree");default:(0,d.U)(n,"Unexpected summary tree type")}return{entries:t,unreferenced:e.unreferenced}}class N{constructor(){this.telemetry=new Map}set(e,t,r){this.telemetry.set(`${e}${t}`,r)}get(e,t){return this.telemetry.get(`${e}${t}`)}serialize(){const e={};return this.telemetry.forEach(((t,r)=>{e[r]=t})),JSON.stringify(e)}}},1890:(e,t,r)=>{"use strict";async function n(e,t){const r=e.trees[".protocol"].blobs.attributes;return(await t(r)).sequenceNumber}r.d(t,{G:()=>n})},477:(e,t,r)=>{"use strict";function n(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}r.d(t,{h:()=>n})},845:(e,t,r)=>{"use strict";function n(e,t="Unreachable Case"){throw new Error(t)}r.d(t,{U:()=>n})},6378:(e,t,r)=>{"use strict";var n;r.d(t,{J:()=>n}),function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(n||(n={}))},4200:(e,t,r)=>{e.exports=r(4460)},6431:(e,t,r)=>{"use strict";var n=r(637),s=r(6059),i=r(4110),o=r(6354),a=r(1325),c=r(5502),h=r(5097),l=r(4232),u=r(6894),d=r(7274);e.exports=function(e){return new Promise((function(t,r){var p,g=e.data,m=e.headers,f=e.responseType;function y(){e.cancelToken&&e.cancelToken.unsubscribe(p),e.signal&&e.signal.removeEventListener("abort",p)}n.isFormData(g)&&delete m["Content-Type"];var v=new XMLHttpRequest;if(e.auth){var b=e.auth.username||"",S=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";m.Authorization="Basic "+btoa(b+":"+S)}var w=a(e.baseURL,e.url);function x(){if(v){var n="getAllResponseHeaders"in v?c(v.getAllResponseHeaders()):null,i={data:f&&"text"!==f&&"json"!==f?v.response:v.responseText,status:v.status,statusText:v.statusText,headers:n,config:e,request:v};s((function(e){t(e),y()}),(function(e){r(e),y()}),i),v=null}}if(v.open(e.method.toUpperCase(),o(w,e.params,e.paramsSerializer),!0),v.timeout=e.timeout,"onloadend"in v?v.onloadend=x:v.onreadystatechange=function(){v&&4===v.readyState&&(0!==v.status||v.responseURL&&0===v.responseURL.indexOf("file:"))&&setTimeout(x)},v.onabort=function(){v&&(r(l("Request aborted",e,"ECONNABORTED",v)),v=null)},v.onerror=function(){r(l("Network Error",e,null,v)),v=null},v.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",n=e.transitional||u;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),r(l(t,e,n.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",v)),v=null},n.isStandardBrowserEnv()){var C=(e.withCredentials||h(w))&&e.xsrfCookieName?i.read(e.xsrfCookieName):void 0;C&&(m[e.xsrfHeaderName]=C)}"setRequestHeader"in v&&n.forEach(m,(function(e,t){void 0===g&&"content-type"===t.toLowerCase()?delete m[t]:v.setRequestHeader(t,e)})),n.isUndefined(e.withCredentials)||(v.withCredentials=!!e.withCredentials),f&&"json"!==f&&(v.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&v.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&v.upload&&v.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(p=function(e){v&&(r(!e||e&&e.type?new d("canceled"):e),v.abort(),v=null)},e.cancelToken&&e.cancelToken.subscribe(p),e.signal&&(e.signal.aborted?p():e.signal.addEventListener("abort",p))),g||(g=null),v.send(g)}))}},4460:(e,t,r)=>{"use strict";var n=r(637),s=r(9292),i=r(3665),o=r(7561),a=function e(t){var r=new i(t),a=s(i.prototype.request,r);return n.extend(a,i.prototype,r),n.extend(a,r),a.create=function(r){return e(o(t,r))},a}(r(7994));a.Axios=i,a.Cancel=r(7274),a.CancelToken=r(4194),a.isCancel=r(4733),a.VERSION=r(6714).version,a.all=function(e){return Promise.all(e)},a.spread=r(5992),a.isAxiosError=r(844),e.exports=a,e.exports.default=a},7274:e=>{"use strict";function t(e){this.message=e}t.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},t.prototype.__CANCEL__=!0,e.exports=t},4194:(e,t,r)=>{"use strict";var n=r(7274);function s(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var r=this;this.promise.then((function(e){if(r._listeners){var t,n=r._listeners.length;for(t=0;t<n;t++)r._listeners[t](e);r._listeners=null}})),this.promise.then=function(e){var t,n=new Promise((function(e){r.subscribe(e),t=e})).then(e);return n.cancel=function(){r.unsubscribe(t)},n},e((function(e){r.reason||(r.reason=new n(e),t(r.reason))}))}s.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},s.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},s.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},s.source=function(){var e;return{token:new s((function(t){e=t})),cancel:e}},e.exports=s},4733:e=>{"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},3665:(e,t,r)=>{"use strict";var n=r(637),s=r(6354),i=r(353),o=r(9262),a=r(7561),c=r(5369),h=c.validators;function l(e){this.defaults=e,this.interceptors={request:new i,response:new i}}l.prototype.request=function(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},(t=a(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var r=t.transitional;void 0!==r&&c.assertOptions(r,{silentJSONParsing:h.transitional(h.boolean),forcedJSONParsing:h.transitional(h.boolean),clarifyTimeoutError:h.transitional(h.boolean)},!1);var n=[],s=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,n.unshift(e.fulfilled,e.rejected))}));var i,l=[];if(this.interceptors.response.forEach((function(e){l.push(e.fulfilled,e.rejected)})),!s){var u=[o,void 0];for(Array.prototype.unshift.apply(u,n),u=u.concat(l),i=Promise.resolve(t);u.length;)i=i.then(u.shift(),u.shift());return i}for(var d=t;n.length;){var p=n.shift(),g=n.shift();try{d=p(d)}catch(e){g(e);break}}try{i=o(d)}catch(e){return Promise.reject(e)}for(;l.length;)i=i.then(l.shift(),l.shift());return i},l.prototype.getUri=function(e){return e=a(this.defaults,e),s(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},n.forEach(["delete","get","head","options"],(function(e){l.prototype[e]=function(t,r){return this.request(a(r||{},{method:e,url:t,data:(r||{}).data}))}})),n.forEach(["post","put","patch"],(function(e){l.prototype[e]=function(t,r,n){return this.request(a(n||{},{method:e,url:t,data:r}))}})),e.exports=l},353:(e,t,r)=>{"use strict";var n=r(637);function s(){this.handlers=[]}s.prototype.use=function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},s.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},s.prototype.forEach=function(e){n.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=s},1325:(e,t,r)=>{"use strict";var n=r(5339),s=r(5963);e.exports=function(e,t){return e&&!n(t)?s(e,t):t}},4232:(e,t,r)=>{"use strict";var n=r(2950);e.exports=function(e,t,r,s,i){var o=new Error(e);return n(o,t,r,s,i)}},9262:(e,t,r)=>{"use strict";var n=r(637),s=r(5459),i=r(4733),o=r(7994),a=r(7274);function c(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new a("canceled")}e.exports=function(e){return c(e),e.headers=e.headers||{},e.data=s.call(e,e.data,e.headers,e.transformRequest),e.headers=n.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),n.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||o.adapter)(e).then((function(t){return c(e),t.data=s.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return i(t)||(c(e),t&&t.response&&(t.response.data=s.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},2950:e=>{"use strict";e.exports=function(e,t,r,n,s){return e.config=t,r&&(e.code=r),e.request=n,e.response=s,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e}},7561:(e,t,r)=>{"use strict";var n=r(637);e.exports=function(e,t){t=t||{};var r={};function s(e,t){return n.isPlainObject(e)&&n.isPlainObject(t)?n.merge(e,t):n.isPlainObject(t)?n.merge({},t):n.isArray(t)?t.slice():t}function i(r){return n.isUndefined(t[r])?n.isUndefined(e[r])?void 0:s(void 0,e[r]):s(e[r],t[r])}function o(e){if(!n.isUndefined(t[e]))return s(void 0,t[e])}function a(r){return n.isUndefined(t[r])?n.isUndefined(e[r])?void 0:s(void 0,e[r]):s(void 0,t[r])}function c(r){return r in t?s(e[r],t[r]):r in e?s(void 0,e[r]):void 0}var h={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:c};return n.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=h[e]||i,s=t(e);n.isUndefined(s)&&t!==c||(r[e]=s)})),r}},6059:(e,t,r)=>{"use strict";var n=r(4232);e.exports=function(e,t,r){var s=r.config.validateStatus;r.status&&s&&!s(r.status)?t(n("Request failed with status code "+r.status,r.config,null,r.request,r)):e(r)}},5459:(e,t,r)=>{"use strict";var n=r(637),s=r(7994);e.exports=function(e,t,r){var i=this||s;return n.forEach(r,(function(r){e=r.call(i,e,t)})),e}},7994:(e,t,r)=>{"use strict";var n=r(637),s=r(2191),i=r(2950),o=r(6894),a={"Content-Type":"application/x-www-form-urlencoded"};function c(e,t){!n.isUndefined(e)&&n.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var h,l={transitional:o,adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(h=r(6431)),h),transformRequest:[function(e,t){return s(t,"Accept"),s(t,"Content-Type"),n.isFormData(e)||n.isArrayBuffer(e)||n.isBuffer(e)||n.isStream(e)||n.isFile(e)||n.isBlob(e)?e:n.isArrayBufferView(e)?e.buffer:n.isURLSearchParams(e)?(c(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):n.isObject(e)||t&&"application/json"===t["Content-Type"]?(c(t,"application/json"),function(e,t,r){if(n.isString(e))try{return(0,JSON.parse)(e),n.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||l.transitional,r=t&&t.silentJSONParsing,s=t&&t.forcedJSONParsing,o=!r&&"json"===this.responseType;if(o||s&&n.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(o){if("SyntaxError"===e.name)throw i(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};n.forEach(["delete","get","head"],(function(e){l.headers[e]={}})),n.forEach(["post","put","patch"],(function(e){l.headers[e]=n.merge(a)})),e.exports=l},6894:e=>{"use strict";e.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}},6714:e=>{e.exports={version:"0.26.1"}},9292:e=>{"use strict";e.exports=function(e,t){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.apply(t,r)}}},6354:(e,t,r)=>{"use strict";var n=r(637);function s(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,r){if(!t)return e;var i;if(r)i=r(t);else if(n.isURLSearchParams(t))i=t.toString();else{var o=[];n.forEach(t,(function(e,t){null!=e&&(n.isArray(e)?t+="[]":e=[e],n.forEach(e,(function(e){n.isDate(e)?e=e.toISOString():n.isObject(e)&&(e=JSON.stringify(e)),o.push(s(t)+"="+s(e))})))})),i=o.join("&")}if(i){var a=e.indexOf("#");-1!==a&&(e=e.slice(0,a)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}},5963:e=>{"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},4110:(e,t,r)=>{"use strict";var n=r(637);e.exports=n.isStandardBrowserEnv()?{write:function(e,t,r,s,i,o){var a=[];a.push(e+"="+encodeURIComponent(t)),n.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),n.isString(s)&&a.push("path="+s),n.isString(i)&&a.push("domain="+i),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},5339:e=>{"use strict";e.exports=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}},844:(e,t,r)=>{"use strict";var n=r(637);e.exports=function(e){return n.isObject(e)&&!0===e.isAxiosError}},5097:(e,t,r)=>{"use strict";var n=r(637);e.exports=n.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function s(e){var n=e;return t&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return e=s(window.location.href),function(t){var r=n.isString(t)?s(t):t;return r.protocol===e.protocol&&r.host===e.host}}():function(){return!0}},2191:(e,t,r)=>{"use strict";var n=r(637);e.exports=function(e,t){n.forEach(e,(function(r,n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[n])}))}},5502:(e,t,r)=>{"use strict";var n=r(637),s=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,r,i,o={};return e?(n.forEach(e.split("\n"),(function(e){if(i=e.indexOf(":"),t=n.trim(e.substr(0,i)).toLowerCase(),r=n.trim(e.substr(i+1)),t){if(o[t]&&s.indexOf(t)>=0)return;o[t]="set-cookie"===t?(o[t]?o[t]:[]).concat([r]):o[t]?o[t]+", "+r:r}})),o):o}},5992:e=>{"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},5369:(e,t,r)=>{"use strict";var n=r(6714).version,s={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){s[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}}));var i={};s.transitional=function(e,t,r){function s(e,t){return"[Axios v"+n+"] Transitional option '"+e+"'"+t+(r?". "+r:"")}return function(r,n,o){if(!1===e)throw new Error(s(n," has been removed"+(t?" in "+t:"")));return t&&!i[n]&&(i[n]=!0,console.warn(s(n," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,n,o)}},e.exports={assertOptions:function(e,t,r){if("object"!=typeof e)throw new TypeError("options must be an object");for(var n=Object.keys(e),s=n.length;s-- >0;){var i=n[s],o=t[i];if(o){var a=e[i],c=void 0===a||o(a,i,e);if(!0!==c)throw new TypeError("option "+i+" must be "+c)}else if(!0!==r)throw Error("Unknown option "+i)}},validators:s}},637:(e,t,r)=>{"use strict";var n=r(9292),s=Object.prototype.toString;function i(e){return Array.isArray(e)}function o(e){return void 0===e}function a(e){return"[object ArrayBuffer]"===s.call(e)}function c(e){return null!==e&&"object"==typeof e}function h(e){if("[object Object]"!==s.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function l(e){return"[object Function]"===s.call(e)}function u(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),i(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.call(null,e[s],s,e)}e.exports={isArray:i,isArrayBuffer:a,isBuffer:function(e){return null!==e&&!o(e)&&null!==e.constructor&&!o(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"[object FormData]"===s.call(e)},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&a(e.buffer)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:c,isPlainObject:h,isUndefined:o,isDate:function(e){return"[object Date]"===s.call(e)},isFile:function(e){return"[object File]"===s.call(e)},isBlob:function(e){return"[object Blob]"===s.call(e)},isFunction:l,isStream:function(e){return c(e)&&l(e.pipe)},isURLSearchParams:function(e){return"[object URLSearchParams]"===s.call(e)},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:u,merge:function e(){var t={};function r(r,n){h(t[n])&&h(r)?t[n]=e(t[n],r):h(r)?t[n]=e({},r):i(r)?t[n]=r.slice():t[n]=r}for(var n=0,s=arguments.length;n<s;n++)u(arguments[n],r);return t},extend:function(e,t,r){return u(t,(function(t,s){e[s]=r&&"function"==typeof t?n(t,r):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}},921:(e,t,r)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,s=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(n++,"%c"===e&&(s=n))})),t.splice(s,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(4990)(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},4990:(e,t,r)=>{e.exports=function(e){function t(e){let r,s,i,o=null;function a(...e){if(!a.enabled)return;const n=a,s=Number(new Date),i=s-(r||s);n.diff=i,n.prev=r,n.curr=s,r=s,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,s)=>{if("%%"===r)return"%";o++;const i=t.formatters[s];if("function"==typeof i){const t=e[o];r=i.call(n,t),e.splice(o,1),o--}return r})),t.formatArgs.call(n,e),(n.log||t.log).apply(n,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=n,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(s!==t.namespaces&&(s=t.namespaces,i=t.enabled(e)),i),set:e=>{o=e}}),"function"==typeof t.init&&t.init(a),a}function n(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(s),...t.skips.map(s).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),s=n.length;for(r=0;r<s;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(3473),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},3473:e=>{var t=1e3,r=60*t,n=60*r,s=24*n;function i(e,t,r,n){var s=t>=1.5*r;return Math.round(e/r)+" "+n+(s?"s":"")}e.exports=function(e,o){o=o||{};var a,c,h=typeof e;if("string"===h&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var i=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(i){var o=parseFloat(i[1]);switch((i[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return o*s;case"hours":case"hour":case"hrs":case"hr":case"h":return o*n;case"minutes":case"minute":case"mins":case"min":case"m":return o*r;case"seconds":case"second":case"secs":case"sec":case"s":return o*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}(e);if("number"===h&&isFinite(e))return o.long?(a=e,(c=Math.abs(a))>=s?i(a,c,s,"day"):c>=n?i(a,c,n,"hour"):c>=r?i(a,c,r,"minute"):c>=t?i(a,c,t,"second"):a+" ms"):function(e){var i=Math.abs(e);return i>=s?Math.round(e/s)+"d":i>=n?Math.round(e/n)+"h":i>=r?Math.round(e/r)+"m":i>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},7583:(e,t,r)=>{"use strict";r.d(t,{h:()=>w});var n=r(2045);function s(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}var i=r(3738),o=r(7983),a=r(120),c=r(2738),h=r(4839),l=r(1468),u=r(9268),d=r(1096),p=r(1527),g=r(9703);class m{constructor(e,t){this.absolutePath=e,this.routeContext=t,this.isAttached=!0,s(e.startsWith("/"),413)}get IFluidRouter(){return this}get IFluidHandleContext(){return this}get IFluidHandle(){return this}async get(){if(void 0===this.objectP){const e={url:this.absolutePath,headers:{[p.lf.viaHandle]:!0}};this.objectP=this.routeContext.resolveHandle(e).then((t=>{if("fluid/object"===t.mimeType)return t.value;throw(0,g.fu)(t,e)}))}return this.objectP}attachGraph(){}bind(e){e.attachGraph()}async request(e){try{const t=(await this.get()).IFluidRouter;return void 0!==t?t.request(e):(0,g.I4)(e)}catch(e){return(0,g.Nj)(e)}}}class f{constructor(e,t){for(this.context=e,this.handleParsedCb=t,this.encodeValue=(e,t)=>{const r=null==e?void 0:e.IFluidHandle;return void 0!==r?this.serializeHandle(r,t):e},this.decodeValue=e=>{if((e=>"__fluid_handle__"===(null==e?void 0:e.type))(e)){const t=e.url.startsWith("/")?e.url:(0,d.H)(e.url,this.context),r=new m(t,this.root);return this.handleParsedCb(r),r}return e},this.root=this.context;void 0!==this.root.routeContext;)this.root=this.root.routeContext}get IFluidSerializer(){return this}encode(e,t){return e&&"object"==typeof e?this.recursivelyReplace(e,this.encodeValue,t):e}decode(e){return e&&"object"==typeof e?this.recursivelyReplace(e,this.decodeValue):e}stringify(e,t){return JSON.stringify(e,((e,r)=>this.encodeValue(r,t)))}parse(e){return JSON.parse(e,((e,t)=>this.decodeValue(t)))}recursivelyReplace(e,t,r){const n=t(e,r);if(n!==e)return n;let s;for(const n of Object.keys(e)){const i=e[n];if(i&&"object"==typeof i){const o=this.recursivelyReplace(i,t,r);o!==i&&(s=null!=s?s:Array.isArray(e)?[...e]:Object.assign({},e),s[n]=o)}}return null!=s?s:e}serializeHandle(e,t){return t.bind(e),{type:"__fluid_handle__",url:e.absolutePath}}}var y=r(8888);class v extends y.B{get isAttached(){return this.value.isAttached()}constructor(e,t,r){super(e,t,r)}attachGraph(){this.value.bindToContext(),super.attachGraph()}}class b extends f{constructor(){super(...arguments),this.serializedRoutes=new Set}getSerializedRoutes(){return Array.from(this.serializedRoutes)}serializeHandle(e,t){return this.serializedRoutes.add(e.absolutePath),super.serializeHandle(e,t)}}class S extends a.M{constructor(e,t,r){super(((e,t)=>this.eventListenerErrorHandler(e,t))),this.id=e,this.runtime=t,this.attributes=r,this._connected=!1,this._isBoundToContext=!1,s(!e.includes("/"),772),this.handle=new v(this,e,t.IFluidHandleContext),this.logger=c.G2.create(t.logger,void 0,{all:{sharedObjectId:(0,n.Z)(),ddsType:{value:this.attributes.type,tag:c.XI.CodeArtifact}}}),this.mc=(0,h.rZ)(this.logger),[this.opProcessingHelper,this.callbacksHelper]=this.setUpSampledTelemetryHelpers(),this.attachListeners()}get IFluidLoadable(){return this}get connected(){return this._connected}setUpSampledTelemetryHelpers(){var e,t;s(void 0!==this.mc&&void 0!==this.logger,"this.mc and/or this.logger has not been set");const r=new l.E({eventName:"ddsOpProcessing",category:"performance"},this.logger,null!==(e=this.mc.config.getNumber("Fluid.SharedObject.OpProcessingTelemetrySampling"))&&void 0!==e?e:100,!0,new Map([["local",{localOp:!0}],["remote",{localOp:!1}]])),n=new l.E({eventName:"ddsEventCallbacks",category:"performance"},this.logger,null!==(t=this.mc.config.getNumber("Fluid.SharedObject.DdsCallbacksTelemetrySampling"))&&void 0!==t?t:100,!0);return this.runtime.once("dispose",(()=>{this.callbacksHelper.dispose(),this.opProcessingHelper.dispose()})),[r,n]}closeWithError(e){void 0===this.closeError&&(this.closeError=e)}verifyNotClosed(){if(void 0!==this.closeError)throw this.closeError}eventListenerErrorHandler(e,t){const r=u.Hi.wrapIfUnrecognized(t,"SharedObjectEventListenerException");throw r.addTelemetryProperties({emittedEventName:String(e)}),this.closeWithError(r),r}attachListeners(){this.isAttached()||this.runtime.once("attaching",(()=>{this.didAttach()}))}async load(e){this.runtime.attachState!==i.mB.Detached&&(this.services=e),await this.loadCore(e.objectStorage),this.runtime.attachState!==i.mB.Detached&&this.attachDeltaHandler()}initializeLocal(){this.initializeLocalCore()}bindToContext(){this._isBoundToContext||(this._isBoundToContext=!0,this.runtime.bindChannel(this))}connect(e){this.services=e,this.attachDeltaHandler()}isAttached(){return void 0!==this.services&&this.runtime.attachState!==i.mB.Detached}handleDecoded(e){var t,r,n;this.isAttached()&&(null===(n=null===(t=this.services)||void 0===t?void 0:(r=t.deltaConnection).addedGCOutboundReference)||void 0===n||n.call(r,this.handle,e))}initializeLocalCore(){}didAttach(){}submitLocalMessage(e,t=void 0){this.verifyNotClosed(),this.isAttached()&&this.services.deltaConnection.submit(e,t)}dirty(){this.isAttached()&&this.services.deltaConnection.dirty()}onConnect(){}reSubmitCore(e,t){this.submitLocalMessage(e,t)}async newAckBasedPromise(e){let t;return new Promise(((r,n)=>{t=()=>n(new Error("FluidDataStoreRuntime disposed while this ack-based Promise was pending")),this.runtime.disposed?t():(this.runtime.on("dispose",t),e(r,n))})).finally((()=>{this.runtime.off("dispose",t)}))}attachDeltaHandler(){s(void 0!==this.services,122),this._isBoundToContext=!0,this.didAttach(),this.services.deltaConnection.attach({process:(e,t,r)=>{this.process(e,t,r)},setConnectionState:e=>{this.setConnectionState(e)},reSubmit:(e,t)=>{this.reSubmit(e,t)},applyStashedOp:e=>this.applyStashedOp(e),rollback:(e,t)=>{this.rollback(e,t)}}),this.setConnectionState(this.services.deltaConnection.connected)}setConnectionState(e){this._connected!==e&&(this._connected=e,e?this.onConnect():this.onDisconnect())}process(e,t,r){this.verifyNotClosed(),this.emitInternal("pre-op",e,t,this),this.opProcessingHelper.measure((()=>{this.processCore(e,t,r)}),t?"local":"remote"),this.emitInternal("op",e,t,this)}reSubmit(e,t){this.reSubmitCore(e,t)}rollback(e,t){throw new Error("rollback not supported")}emit(e,...t){return this.callbacksHelper.measure((()=>super.emit(e,...t)))}emitInternal(e,...t){return super.emit(e,...t)}}class w extends S{constructor(e,t,r,n){super(e,t,r),this.telemetryContextPrefix=n,this._isGCing=!1,this._serializer=new f(this.runtime.channelsRoutingContext,(e=>this.handleDecoded(e)))}get serializer(){return s(!this._isGCing,117),this._serializer}getAttachSummary(e=!1,t=!1,r){const n=this.summarizeCore(this.serializer,r);return this.incrementTelemetryMetric(o.blobCountPropertyName,n.stats.blobNodeCount,r),this.incrementTelemetryMetric(o.totalBlobSizePropertyName,n.stats.totalBlobSize,r),n}async summarize(e=!1,t=!1,r){const n=this.summarizeCore(this.serializer,r);return this.incrementTelemetryMetric(o.blobCountPropertyName,n.stats.blobNodeCount,r),this.incrementTelemetryMetric(o.totalBlobSizePropertyName,n.stats.totalBlobSize,r),n}getGCData(e=!1){let t;s(!this._isGCing,120),this._isGCing=!0;try{const e=new b(this.runtime.channelsRoutingContext,(e=>this.handleDecoded(e)));this.processGCDataCore(e),t={gcNodes:{"/":e.getSerializedRoutes()}},s(this._isGCing,121)}finally{this._isGCing=!1}return t}processGCDataCore(e){this.summarizeCore(e)}incrementTelemetryMetric(e,t,r){var n;const s=null!==(n=null==r?void 0:r.get(this.telemetryContextPrefix,e))&&void 0!==n?n:0;null==r||r.set(this.telemetryContextPrefix,e,s+t)}}},8343:(e,t,r)=>{"use strict";r.d(t,{Ho:()=>a,Yv:()=>s,i8:()=>i,lB:()=>o});var n=r(8991);function s(e,t,r){return void 0!==e?t.stringify(e,r):e}function i(e,t,r){return t.encode(e,r)}function o(e,t){return void 0!==e?t.parse(JSON.stringify(e)):e}function a(e,t){const r=new n.x1;return r.addBlob(e,t),r.getSummaryTree()}},4148:(e,t,r)=>{"use strict";var n;r.d(t,{G:()=>n}),function(e){e[e.Shared=0]="Shared",e[e.Plain=1]="Plain"}(n||(n={}))},4839:(e,t,r)=>{"use strict";r.d(t,{MD:()=>h,yV:()=>l,rZ:()=>u,UK:()=>d,of:()=>n});const n=new class{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}}((()=>i(c()))),s={getRawConfig:()=>{}},i=e=>null!=e?new h({getRawConfig:t=>{var r,n;try{return null===(n=a(null!==(r=e.getItem(t))&&void 0!==r?r:void 0))||void 0===n?void 0:n.raw}catch(e){}}}):s;function o(e){switch(e){case"boolean":case"number":case"string":return!0;default:return!1}}function a(e){let t,r=e;if("string"==typeof e)try{r=JSON.parse(e),t={raw:e,string:e}}catch(e){}if(void 0===r)return t;const n=typeof r;if(o(n))return Object.assign(Object.assign({},t),{raw:e,[n]:r});if(Array.isArray(r)){const n=typeof r[0];if(!o(n))return t;for(const e of r)if(typeof e!==n)return t;return Object.assign(Object.assign({},t),{raw:e,[`${n}[]`]:r})}return t}const c=()=>{try{return null!==sessionStorage?sessionStorage:void 0}catch(e){return}};class h{constructor(...e){this.configCache=new Map,this.orderedBaseProviders=[];const t=new Set,r=[...e];for(;r.length>0;){const e=r.shift();void 0!==e&&p(e)&&!t.has(e)&&(t.add(e),e instanceof h?r.push(...e.orderedBaseProviders):this.orderedBaseProviders.push(e))}}getBoolean(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.boolean}getNumber(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.number}getString(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.string}getBooleanArray(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["boolean[]"]}getNumberArray(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["number[]"]}getStringArray(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["string[]"]}getRawConfig(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.raw}getCacheEntry(e){if(!this.configCache.has(e)){for(const t of this.orderedBaseProviders){const r=a(null==t?void 0:t.getRawConfig(e));if(void 0!==r)return this.configCache.set(e,r),r}this.configCache.set(e,{raw:void 0})}return this.configCache.get(e)}}function l(e){const t=e;return p(null==t?void 0:t.config)&&void 0!==(null==t?void 0:t.logger)}function u(e){return l(e)?e:d(e,n.value)}function d(e,...t){if(l(e))throw new Error("Logger is already a monitoring context");const r=e;return r.config=new h(...t),r.logger=e,r}function p(e){return"function"==typeof(null==e?void 0:e.getRawConfig)}},2186:(e,t,r)=>{"use strict";r.d(t,{b:()=>o});var n=r(1836),s=r(4501),i=r(2738);class o extends i.hy{constructor(e,t,r){super(void 0,r),this.debug=e,this.debugErr=t}static create(e,t){const r=(0,s.debug)(e),n=(0,s.debug)(e);return n.log=console.error.bind(console),n.enabled=!0,new o(r,n,t)}static mixinDebugLogger(e,t,r){if(!t)return o.create(e,r);const n=new i.yw(void 0,r);return n.addLogger(o.create(e,this.tryGetBaseLoggerProps(t))),n.addLogger(i.G2.create(t,e)),n}static tryGetBaseLoggerProps(e){if(e instanceof i.hy)return e.properties}send(e){const t=this.prepareEvent(e),r="error"===t.category;let s=r?this.debugErr:this.debug;const o=e.eventName.lastIndexOf(i.hy.eventNamespaceSeparator),a=e.eventName.substring(o+1);o>0&&(s=s.extend(e.eventName.substring(0,o))),t.eventName=void 0;let c="";c=`tick=${i.hy.formatTick(n.S.now())}`;const h=t.stack?t.stack:"";let l;t.stack=void 0;try{l=JSON.stringify(t)}catch(e){t.error=void 0,l=JSON.stringify(t)}"{}"===l&&(l=""),r&&(s.enabled=!0),s(`${a} ${l} ${c} ${h}`)}}},2718:(e,t,r)=>{"use strict";r.d(t,{FM:()=>l,Jn:()=>d,SC:()=>c,XY:()=>m,YC:()=>o,bO:()=>p,fd:()=>y,gr:()=>u,j4:()=>v,nE:()=>a,zt:()=>f});var n=r(2045),s=r(9203);const i=e=>null!==e&&!Array.isArray(e)&&"object"==typeof e;function o(e,t){const r={message:"string"==typeof(null==e?void 0:e.message)?e.message:String(e)};if(i(e)){const{errorType:n,stack:s,name:i}=e;if("string"==typeof n&&(r.errorType=n),"string"==typeof s){const e="string"==typeof i?i:void 0;r.stack=((e,r)=>{if(!t)return e;const n=e.split("\n");return n.shift(),void 0!==r&&n.unshift(r),n.join("\n")})(s,e)}}return r}const a=e=>"function"==typeof(null==e?void 0:e.getTelemetryProperties);function c(e,t={}){var r;if((0,s.n5)(e)&&function(e){const t=e;void 0===t.errorInstanceId&&(t.errorInstanceId=(0,n.Z)())}(e),(0,s.IR)(e))return e.addTelemetryProperties(null!==(r=t.props)&&void 0!==r?r:{}),e;const{message:i,stack:h}=o(e,!1),l=new b({message:i,stack:h});if("object"==typeof e&&null!==e){const{canRetry:t,retryAfterSeconds:r}=e;Object.assign(c,{canRetry:t,retryAfterSeconds:r})}"object"!=typeof e&&l.addTelemetryProperties({typeofError:typeof e});const u=a(e)?e.getTelemetryProperties():{};return l.addTelemetryProperties(Object.assign(Object.assign(Object.assign({},u),t.props),{untrustedOrigin:1})),l}let h;function l(){const e=new Error("<<generated stack>>");if(void 0===h&&(h=void 0!==e.stack),h)return e;try{throw e}catch(e){return e}}function u(){return l().stack}function d(e,t){const{message:r,stack:n}=o(e,!1),i=t(r);return void 0!==n&&g(i,n),m(e)&&i.addTelemetryProperties({untrustedOrigin:1}),(0,s.uD)(e)&&(i.overwriteErrorInstanceId(e.errorInstanceId),i.addTelemetryProperties({innerErrorInstanceId:e.errorInstanceId})),a(e)&&i.addTelemetryProperties(e.getTelemetryProperties()),i}function p(e,t,r){const n=d(e,t),s=n.errorInstanceId,i=s;return r.sendTelemetryEvent({eventName:"WrapError",errorInstanceId:s,wrappedByErrorInstanceId:i},e),n}function g(e,t){try{Object.assign(e,{stack:t})}catch(r){e.addTelemetryProperties({stack2:t})}}function m(e){return!(0,s.n5)(e)||1===e.getTelemetryProperties().untrustedOrigin&&e.errorType===b.normalizedErrorType}function f(e){return"object"!=typeof(null==e?void 0:e.value)&&"string"==typeof(null==e?void 0:e.tag)}const y=()=>{const e=new WeakSet;return(t,r)=>{if("object"==typeof r&&null!==r){if(e.has(r))return"<removed/circular>";e.add(r)}return r}};class v extends Error{constructor(e,t,r=new Set){super(e),this.omitPropsFromLogging=r,this._errorInstanceId=(0,n.Z)(),this.fluidErrorCode="-",r.add("omitPropsFromLogging"),r.add("_errorInstanceId"),t&&this.addTelemetryProperties(t)}get errorInstanceId(){return this._errorInstanceId}overwriteErrorInstanceId(e){this._errorInstanceId=e}addTelemetryProperties(e){!function(e,t){for(const r of Object.keys(t))void 0===e[r]&&(e[r]=t[r])}(this,e)}getTelemetryProperties(){const e=function(e,t){const r={};for(const n of Object.keys(e)){if(t.has(n))continue;const s=e[n];switch(typeof s){case"string":case"number":case"boolean":case"undefined":r[n]=s;break;default:f(s)?r[n]=s:r[n]="REDACTED (arbitrary object)"}}return r}(this,this.omitPropsFromLogging);return Object.assign(Object.assign({},e),{stack:this.stack,message:this.message,errorInstanceId:this._errorInstanceId})}}class b extends v{constructor(e){super(e.message),this.errorType=b.normalizedErrorType,void 0!==e.stack&&g(this,e.stack)}}b.normalizedErrorType="genericError"},120:(e,t,r)=>{"use strict";r.d(t,{M:()=>i});var n=r(7187);class s extends n.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}class i extends s{constructor(e){super(),this.errorHandler=e}emit(e,...t){try{return super.emit(e,...t)}catch(t){return this.errorHandler(e,t),!0}}}},8595:(e,t,r)=>{"use strict";r.d(t,{Eb:()=>i,Qq:()=>o,h$:()=>s,tZ:()=>n});const n="connected",s="disconnected";function i(e,t,r,...n){try{e.emit(r,...n)}catch(e){t.sendErrorEvent({eventName:"RaiseEventError",event:r},e)}}function o(e,t,r,i){try{r?t.emit(n,i):t.emit(s)}catch(t){e.sendErrorEvent({eventName:"RaiseConnectedEventError"},t)}}},9203:(e,t,r)=>{"use strict";r.d(t,{IR:()=>i,n5:()=>o,uD:()=>s});const n=e=>"function"==typeof(null==e?void 0:e.getTelemetryProperties)&&"function"==typeof(null==e?void 0:e.addTelemetryProperties),s=e=>"string"==typeof(null==e?void 0:e.errorInstanceId);function i(e){return"string"==typeof(null==e?void 0:e.errorType)&&"string"==typeof(null==e?void 0:e.message)&&s(e)&&n(e)}function o(e){return"string"==typeof(null==e?void 0:e.errorType)&&"string"==typeof(null==e?void 0:e.message)&&n(e)}},2609:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ChildLogger:()=>c.G2,DebugLogger:()=>n.b,EventEmitterWithErrorHandling:()=>i.M,LoggingError:()=>s.j4,MockLogger:()=>h,MultiSinkLogger:()=>c.yw,PerformanceEvent:()=>c.Xr,SampledTelemetryHelper:()=>d.E,TaggedLoggerAdapter:()=>c.cP,TelemetryDataTag:()=>c.XI,TelemetryLogger:()=>c.hy,TelemetryUTLogger:()=>c.nI,ThresholdCounter:()=>l.z,connectedEventName:()=>o.tZ,disconnectedEventName:()=>o.h$,extractLogSafeErrorProperties:()=>s.YC,generateErrorWithStack:()=>s.FM,generateStack:()=>s.gr,getCircularReplacer:()=>s.fd,hasErrorInstanceId:()=>a.uD,isExternalError:()=>s.XY,isFluidError:()=>a.IR,isILoggingError:()=>s.nE,isTaggedTelemetryPropertyValue:()=>s.zt,isValidLegacyError:()=>a.n5,logIfFalse:()=>u.M,loggerToMonitoringContext:()=>p.rZ,mixinMonitoringContext:()=>p.UK,normalizeError:()=>s.SC,raiseConnectedEvent:()=>o.Qq,safeRaiseEvent:()=>o.Eb,sessionStorageConfigProvider:()=>p.of,wrapError:()=>s.Jn,wrapErrorAndLog:()=>s.bO});var n=r(2186),s=r(2718),i=r(120),o=r(8595),a=r(9203),c=r(2738);class h extends c.hy{constructor(){super(),this.events=[]}clear(){this.events=[]}send(e){this.events.push(e)}matchEvents(e){const t=this.getMatchedEventsCount(e);return 0==e.length-t}assertMatch(e,t){const r=this.events;if(!this.matchEvents(e))throw new Error(`${t}\nexpected:\n${JSON.stringify(e)}\n\nactual:\n${JSON.stringify(r)}`)}matchAnyEvent(e){return this.getMatchedEventsCount(e)>0}assertMatchAny(e,t){const r=this.events;if(!this.matchAnyEvent(e))throw new Error(`${t}\nexpected:\n${JSON.stringify(e)}\n\nactual:\n${JSON.stringify(r)}`)}getMatchedEventsCount(e){let t=0;return this.events.forEach((r=>{t<e.length&&h.eventsMatch(r,e[t])&&++t})),this.events=[],t}static eventsMatch(e,t){const r=Object.assign(Object.assign({},e),t);return JSON.stringify(r)===JSON.stringify(e)}}var l=r(6171),u=r(5708),d=r(1468),p=r(4839)},2738:(e,t,r)=>{"use strict";r.d(t,{G2:()=>l,yw:()=>u,Xr:()=>d,cP:()=>h,XI:()=>s,hy:()=>c,nI:()=>p});class n{send(e){}}var s,i=r(1836),o=r(4839),a=r(2718);!function(e){e.PackageData="PackageData",e.CodeArtifact="CodeArtifact",e.UserData="UserData"}(s||(s={}));class c{constructor(e,t){this.namespace=e,this.properties=t}static formatTick(e){return Math.floor(e)}static numberFromString(e){if(null==e)return;const t=Number(e);return Number.isNaN(t)?e:t}static sanitizePkgName(e){return e.replace("@","").replace("/","-")}static prepareErrorObject(e,t,r){const{message:n,errorType:s,stack:i}=(0,a.YC)(t,!0);if(e.stack=i,e.error=n,e.errorType=s,(0,a.nE)(t)){const r=t.getTelemetryProperties();for(const t of Object.keys(r))void 0===e[t]&&(e[t]=r[t])}void 0===e.stack&&r&&(e.stack=(0,a.gr)())}sendTelemetryEvent(e,t){var r;this.sendTelemetryEventCore(Object.assign(Object.assign({},e),{category:null!==(r=e.category)&&void 0!==r?r:"generic"}),t)}sendTelemetryEventCore(e,t){const r=Object.assign({},e);void 0!==t&&c.prepareErrorObject(r,t,!1),"number"==typeof r.duration&&(r.duration=c.formatTick(r.duration)),this.send(r)}sendErrorEvent(e,t){this.sendTelemetryEventCore(Object.assign(Object.assign({error:e.eventName},e),{category:"error"}),t)}sendPerformanceEvent(e,t){var r;const n=Object.assign(Object.assign({},e),{category:null!==(r=e.category)&&void 0!==r?r:"performance"});this.sendTelemetryEventCore(n,t)}prepareEvent(e){const t="error"===e.category||void 0!==e.error,r=Object.assign({},e);if(void 0!==this.namespace&&(r.eventName=`${this.namespace}${c.eventNamespaceSeparator}${r.eventName}`),this.properties){const n=[];n.push(this.properties.all),t&&n.push(this.properties.error);for(const t of n)if(void 0!==t)for(const n of Object.keys(t)){if(void 0!==e[n])continue;const s=t[n],i="function"==typeof s?s():s;void 0!==i&&(r[n]=i)}}return r}}c.eventNamespaceSeparator=":";class h{constructor(e){this.logger=e}send(e){const t={category:e.category,eventName:e.eventName};for(const r of Object.keys(e)){const n=e[r],{value:i,tag:o}="object"==typeof n?n:{value:n,tag:void 0};switch(o){case void 0:case s.PackageData:t[r]=i;break;case s.UserData:t[r]="REDACTED (UserData)";break;default:t[r]="REDACTED (unknown tag)"}}this.logger.send(t)}}class l extends c{constructor(e,t,r){super(t,r),this.baseLogger=e,(0,o.yV)(e)&&(0,o.UK)(this,new o.MD(e.config))}static create(e,t,r){if(e instanceof l){const n={};for(const t of[e.properties,r])void 0!==t&&(void 0!==t.all&&(n.all=Object.assign(Object.assign({},n.all),t.all)),void 0!==t.error&&(n.error=Object.assign(Object.assign({},n.error),t.error)));const s=void 0===e.namespace?t:void 0===t?e.namespace:`${e.namespace}${c.eventNamespaceSeparator}${t}`;return new l(e.baseLogger,s,n)}return new l(e||new n,t,r)}send(e){this.baseLogger.send(this.prepareEvent(e))}}class u extends c{constructor(e,t){super(e,t),this.loggers=[]}addLogger(e){null!=e&&this.loggers.push(e)}send(e){const t=this.prepareEvent(e);this.loggers.forEach((e=>{e.send(t)}))}}class d{constructor(e,t,r={end:!0,cancel:"generic"}){this.logger=e,this.markers=r,this.startTime=i.S.now(),this.event=Object.assign({},t),this.markers.start&&this.reportEvent("start"),"object"==typeof window&&null!=window&&window.performance&&(this.startMark=`${t.eventName}-start`,window.performance.mark(this.startMark))}static start(e,t,r){return new d(e,t,r)}static timedExec(e,t,r,n){const s=d.start(e,t,n);try{const e=r(s);return s.autoEnd(),e}catch(e){throw s.cancel(void 0,e),e}}static async timedExecAsync(e,t,r,n){const s=d.start(e,t,n);try{const e=await r(s);return s.autoEnd(),e}catch(e){throw s.cancel(void 0,e),e}}get duration(){return i.S.now()-this.startTime}reportProgress(e,t="update"){this.reportEvent(t,e)}autoEnd(){this.event&&this.markers.end&&this.reportEvent("end"),this.performanceEndMark(),this.event=void 0}end(e){this.reportEvent("end",e),this.performanceEndMark(),this.event=void 0}performanceEndMark(){if(this.startMark&&this.event){const e=`${this.event.eventName}-end`;window.performance.mark(e),window.performance.measure(`${this.event.eventName}`,this.startMark,e),this.startMark=void 0}}cancel(e,t){void 0!==this.markers.cancel&&this.reportEvent("cancel",Object.assign({category:this.markers.cancel},e),t),this.event=void 0}reportEvent(e,t,r){if(!this.event)return;const n=Object.assign(Object.assign({},this.event),t);n.eventName=`${n.eventName}_${e}`,"start"!==e&&(n.duration=this.duration),this.logger.sendPerformanceEvent(n,r)}}class p{send(e){}sendTelemetryEvent(e,t){}sendErrorEvent(e,t){this.reportError("errorEvent in UT logger!",e,t)}sendPerformanceEvent(e,t){}logGenericError(e,t){this.reportError("genericError in UT logger!",{eventName:e},t)}logException(e,t){this.reportError("exception in UT logger!",e,t)}debugAssert(e,t){this.reportError("debugAssert in UT logger!")}shipAssert(e,t){this.reportError("shipAssert in UT logger!")}reportError(e,t,r){const n=new Error(e);throw n.error=n,n.event=t,console.error(e),console.error(n),n}}},1468:(e,t,r)=>{"use strict";r.d(t,{E:()=>s});var n=r(1836);class s{constructor(e,t,r,n=!1,s=new Map){this.eventBase=e,this.logger=t,this.sampleThreshold=r,this.includeAggregateMetrics=n,this.perBucketProperties=s,this.disposed=!1,this.measurementsMap=new Map}measure(e,t=""){var r,s,i;const o=n.S.now(),a=e(),c=n.S.now()-o;let h=this.measurementsMap.get(t);return void 0===h&&(h={count:0,duration:-1},this.measurementsMap.set(t,h)),h.count++,h.duration=c,this.includeAggregateMetrics&&(h.totalDuration=(null!==(r=h.totalDuration)&&void 0!==r?r:0)+c,h.minDuration=Math.min(null!==(s=h.minDuration)&&void 0!==s?s:c,c),h.maxDuration=Math.max(null!==(i=h.maxDuration)&&void 0!==i?i:0,c)),h.count>=this.sampleThreshold&&this.flushBucket(t),a}flushBucket(e){const t=this.measurementsMap.get(e);if(void 0!==t&&0!==t.count){const r=this.perBucketProperties.get(e),n=Object.assign(Object.assign(Object.assign({},this.eventBase),r),t);this.logger.sendPerformanceEvent(n),this.measurementsMap.delete(e)}}dispose(e){this.measurementsMap.forEach(((e,t)=>this.flushBucket(t)))}}},6171:(e,t,r)=>{"use strict";r.d(t,{z:()=>n});class n{constructor(e,t,r=e){this.threshold=e,this.logger=t,this.thresholdMultiple=r}send(e,t){t<this.threshold||this.logger.sendPerformanceEvent({eventName:e,value:t})}sendIfMultiple(e,t){t===this.thresholdMultiple&&(this.logger.sendPerformanceEvent({eventName:e,value:t}),this.thresholdMultiple=2*this.thresholdMultiple)}}},5708:(e,t,r)=>{"use strict";function n(e,t,r){if(e)return!0;const n="string"==typeof r?{eventName:r,category:"error"}:Object.assign({category:"error"},r);return t.send(n),!1}r.d(t,{M:()=>n})},1836:(e,t,r)=>{"use strict";r.d(t,{S:()=>n});const n=window.performance},4501:(e,t,r)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,s=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(n++,"%c"===e&&(s=n))})),t.splice(s,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(1588)(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},1588:(e,t,r)=>{e.exports=function(e){function t(e){let r,s,i,o=null;function a(...e){if(!a.enabled)return;const n=a,s=Number(new Date),i=s-(r||s);n.diff=i,n.prev=r,n.curr=s,r=s,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,s)=>{if("%%"===r)return"%";o++;const i=t.formatters[s];if("function"==typeof i){const t=e[o];r=i.call(n,t),e.splice(o,1),o--}return r})),t.formatArgs.call(n,e),(n.log||t.log).apply(n,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=n,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(s!==t.namespaces&&(s=t.namespaces,i=t.enabled(e)),i),set:e=>{o=e}}),"function"==typeof t.init&&t.init(a),a}function n(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(s),...t.skips.map(s).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),s=n.length;for(r=0;r<s;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(2326),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},2326:e=>{var t=1e3,r=60*t,n=60*r,s=24*n;function i(e,t,r,n){var s=t>=1.5*r;return Math.round(e/r)+" "+n+(s?"s":"")}e.exports=function(e,o){o=o||{};var a,c,h=typeof e;if("string"===h&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var i=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(i){var o=parseFloat(i[1]);switch((i[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return o*s;case"hours":case"hour":case"hrs":case"hr":case"h":return o*n;case"minutes":case"minute":case"mins":case"min":case"m":return o*r;case"seconds":case"second":case"secs":case"sec":case"s":return o*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}(e);if("number"===h&&isFinite(e))return o.long?(a=e,(c=Math.abs(a))>=s?i(a,c,s,"day"):c>=n?i(a,c,n,"hour"):c>=r?i(a,c,r,"minute"):c>=t?i(a,c,t,"second"):a+" ms"):function(e){var i=Math.abs(e);return i>=s?Math.round(e/s)+"d":i>=n?Math.round(e/n)+"h":i>=r?Math.round(e/r)+"m":i>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},9894:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.generateTestUser=void 0;const s=n(r(8280)),i=r(8410);t.generateTestUser=()=>({id:(0,i.v4)(),name:(0,s.default)()})},7719:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateTestUser=t.InsecureTokenProvider=void 0;var n=r(2098);Object.defineProperty(t,"InsecureTokenProvider",{enumerable:!0,get:function(){return n.InsecureTokenProvider}});var s=r(9894);Object.defineProperty(t,"generateTestUser",{enumerable:!0,get:function(){return s.generateTestUser}})},979:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shortCodeMap=void 0,t.shortCodeMap={"0x000":"nonzero isobuffer byte offset","0x001":"unexpected isobuffer byte length","0x003":"Primary to add to range < last primary!","0x004":"Secondary to add to range < last secondary!","0x005":"Target primary to retrieve < first range's primary!","0x006":"Target primary to retrieve < last range's primary!","0x007":"Target primary to update < first range's primary!","0x008":"Target primary to update < last range's primary!","0x009":"After update, target primary is not first range's primary!","0x00a":"Running timer missing handler","0x00b":"Handler executed without deferred","0x00c":"messageId is incorrect from from the local client's ACK","0x00d":"Missing message handler for message type","0x00e":"Missing message handler for message type","0x00f":"pendingMessageId is missing from the local client's operation","0x010":"Received out of order storage op when there is an unackd clear message","0x011":"pendingMessageId is missing from the local client's operation","0x012":"pendingMessageId is missing from the local client's operation","0x013":"Received out of order op when there is an unackd clear message","0x014":"pendingMessageId is missing from the local client's operation","0x015":"pendingMessageId is missing from the local client's clear operation","0x016":"apply stashed op not implemented for custom value type ops","0x017":"Trying to add invalid handle!","0x018":"Trying to insert handle into position with already valid handle!","0x019":"SharedMatrix.openUndo() supports at most a single IUndoConsumer.","0x01a":"Trying to set out-of-bounds cell!","0x01b":"Trying to set multiple out-of-bounds cells!","0x01c":"The 'localSeq' of the vector submitting an op must >= the 'localSeq' of the other vector.","0x01d":"Trying to submit message to runtime while detached!","0x01e":"Row and col collab window 'localSeq' desynchronized!","0x01f":"Row and col collab window 'collaborating' status desynchronized!","0x020":"Unknown SharedMatrix 'op' type.","0x021":"SharedMatrix message contents have unexpected type!","0x022":"SharedMatrix row and/or col handles are invalid!","0x023":"The 'localSeq' of pending write (if any) must be <= the localSeq of the currently processed op.","0x024":"Start of PermutationSegment already allocated!","0x025":"Trying to set start of PermutationSegment to invalid handle!","0x026":"Trying to split segment at out-of-bounds position!","0x027":"Trying to get handle of out-of-bounds position!","0x028":"'localSeq' for op being resubmitted must be <= the 'localSeq' of the last submitted op.","0x029":"Invalid handle at start of containing segment!","0x02a":"On vector undo, unexpected 'currentOp' type/state!","0x02b":"Must not nest calls to IRevertible.revert()","0x02c":"On cellSet(), invalid row and/or column handles!","0x02d":"Unexpected op type on range remove!","0x02e":"Unexpected op type on range annotate!","0x02f":"Unexpected op type on range insert!","0x030":"Incoming remote op sequence# <= local collabWindow's currentSequence#","0x031":"Incoming remote op minSequence# < local collabWindow's minSequence#","0x032":"localSeq greater than collab window","0x033":"Segment group undefined","0x034":"Segment group not at head of merge tree pending queue","0x035":"Segment group not at head of segment pending queue","0x036":"Segment has no pending properties","0x037":"Segment already has assigned sequence number","0x038":"Incoming op sequence# < local collabWindow's currentSequence#","0x039":"Incoming op sequence# < minSequence#","0x03a":"Number of ops in 'resetOp' must match the number of segment groups provided.","0x03b":"Number of ops in 'resetOp' must match the number of segment groups provided.","0x03c":"Reset op has 'group' delta type!","0x03d":"segmentGroup is array rather than singleton!","0x03e":"minSeq mismatch between collab window and delta manager!","0x03f":"New format should not emit catchup ops","0x040":"Child count is not within [1,7] range!","0x041":"Unexpected child ordinal length!","0x043":"On ack, unexpected segmentGroup!","0x044":"On annotate ack, missing segment property manager!","0x045":"On insert, seq number already assigned!","0x046":"On remove ack, missing removal info!","0x048":"onMinGE()","0x049":"Trying to reload from segments while collaborating!","0x04f":"minSeq of collab window > target minSeq!","0x050":"Next segment changes are undefined!","0x051":"Too many children on merge block!","0x054":"Sequence number less than minSeq!","0x055":"Sequence number is not sorted!","0x056":"Unexpected total for accumulation of all seglen adjustments!","0x057":"Negative length after length adjustment!","0x058":"Both overlapRemoveClients and clientPartials are set!","0x059":"Client view exists but flat view does not!","0x05a":"Mismatch between number of partial lengths on client and flat views!","0x05b":"Flat view exists but client view does not!","0x05c":"Trying to update more annotate props than do exist!","0x05d":"emit: mismatch in segmentsTotalLength","0x05e":"emit: mismatch in totalSegmentCount","0x05f":"Missing blob header on legacy snapshot!","0x060":"There should be only one blob with catch up ops","0x061":"Mismatch in totalLength","0x062":"Mismatch in totalSegmentCount","0x063":"Mismatch in totalLength","0x064":"Mismatch in totalSegmentCount","0x065":"On removal info preservation, segment has invalid removed sequence number!","0x066":"Corrupted preservation of segment metadata!","0x067":"Missing clientId for removal!","0x068":"On consensusOrderedCollection load, job tracking size > 0","0x069":"On consensusOrderedCollection load, data size > 0","0x06a":"Trying to submit message while detached!","0x06b":"Loading snapshot into a non-empty collection","0x06c":"Value should be undefined or non-empty","0x06d":"SharedObjects contained in ConsensusRegisterCollection can no longer be deserialized as of 0.17","0x06e":"Message's reference sequence number < op's reference sequence number!","0x06f":"data missing for non-atomic inbound update!","0x070":"sequence numbers are expected to be 0 when unattached","0x071":"Versions should naturally be ordered by sequenceNumber","0x072":"Unexpected local op when loading not finished","0x073":"Sequence message not operation","0x074":"Snapshot called when not fully loaded","0x075":"SummarySerializer should be used for serializing data during summary.","0x078":"Possible re-entrancy! Summary should not already be in progress.","0x079":"Possible re-entrancy! Summary should have been in progress.","0x07a":"Services should be there to attach delta handler","0x07b":"Unexpected op","0x07c":"Unexpected op type","0x07d":"Unexpected op","0x07e":"Unexpected op type","0x07f":"clientId undefined","0x080":"Invalid document service!","0x081":"Document service already set!","0x082":"Document storage service already set!","0x083":"User selection status does not match replay controller use status!","0x084":"On storage resolve, user selection already made!","0x085":"On storage resolve, missing storage!","0x086":"After storage resolve, user selection status still false!","0x088":"Missing button ops button!","0x089":"Stringified length of chunk contents > total starting length","0x08a":"resetting ChunkedOpProcessor that never wrote back its contents","0x08b":"Unexpected type on contents for fix of an attach!","0x08c":"innerContent for fixing op contents is undefined!","0x08d":"After sanitize, pending incomplete ops!","0x08e":"Potentially missed initial messages","0x08f":"No op handler is setup!","0x090":"No signal handler is setup!","0x091":"Retrieved ops' first sequence number has unexpected value!","0x092":"version input for reading snapshot tree is null!","0x093":"invalid version input for reading snapshot tree!","0x094":"Missing snapshot tree!","0x096":"Trying to remove valid tree IDs in removeNullTreeIds()!","0x097":"Missing param from office.com URL parameter","0x098":"OuterDocumentServiceFactoryProxy unavailable","0x099":"OuterUrlResolverProxy unavailable","0x09a":"'documentId' must be a defined, non-zero length string.","0x09d":"Connection details should contain epoch","0x09f":"No more socketIO refs to remove!","0x0a0":"Unexpected socketIO references on timeout","0x0a1":"Socket reference set unexpectedly does not point to this socket!","0x0a2":"reentrancy not supported!","0x0a4":"Unexpected blob encoding type","0x0a5":"Trying to set ops when they are already set!","0x0a8":"Docid should not contain slashes!!","0x0ad":"Snapshot entry has both a tree value and a referenced id!","0x0ae":"Tried to create rate limiter with 0 max requests!","0x0b0":"Missing document snapshot tree!","0x0b1":"Storage service not initialized","0x0b2":"Missing orderer URL!","0x0b7":"Pathname should be defined","0x0b8":"'tenantId' and 'documentId' must be defined, non-zero length strings.","0x0b9":"PathName should exist","0x0ba":"Tenant id should exist","0x0bb":"Document id should exist","0x0bc":"Runtime has no DataObject!","0x0bd":"Object runtime already has DataObject!","0x0be":"Trying to initialize from existing while initProps is set!","0x0bf":"set called recursively from the interception callback","0x0c0":"set called recursively from the interception callback","0x0c1":"Interception wrapper methods called recursively from the interception callback","0x0c2":"Interception wrapper methods called recursively from the interception callback","0x0c3":"Interception wrapper methods called recursively from the interception callback","0x0c4":"Interception wrapper methods called recursively from the interception callback","0x0c5":"Interception wrapper methods called recursively from the interception callback","0x0c6":"Interception wrapper methods called recursively from the interception callback","0x0c7":"Interception wrapper methods called recursively from the interception callback","0x0c8":"Interception wrapper methods called recursively from the interception callback","0x0c9":"Interception wrapper methods called recursively from the interception callback","0x0ca":"Trying to use legacy graph attach!","0x0cd":"Container disconnected while waiting for ops!","0x0cf":"disconnect event was not raised!","0x0d1":"Container should be attached before close","0x0d2":"resolved url should be valid Fluid url","0x0d3":"Should only be called in detached container","0x0d6":"Inbound queue should be empty when attaching","0x0d9":"Attempting to connect() a closed DeltaManager","0x0dd":"Existing context not disposed","0x0de":"Mismatch in connection state while setting","0x0df":"Missing active connection","0x0e0":"lost minBlobSize policy","0x0e2":"DeltaManager already has attached op handler!","0x0e3":"Newly set op handler is null/undefined!","0x0e4":"Lost old connection!","0x0e6":"old connection exists on new connection setup","0x0e7":"claims/connectionMode mismatch","0x0e8":"readonly perf with write connection","0x0e9":"messageBuffer is not empty on new connection","0x0eb":"Missing connection for reconnect","0x0ec":"Unexpected value for previously processed message's sequence number","0x0ed":"non-system message have to have clientId","0x0ee":"Not accounting local messages correctly","0x0ef":"client seq# not growing","0x0f0":"Incoming local client seq# > generated by this client","0x0f2":"previouslyProcessedMessage","0x0f3":"not positive","0x0f4":"Nonzero pause-count on resume()","0x0f6":"real blob ID exists","0x0f7":"aggregate blob missing","0x0f8":"blob from aggregate blob exists on its own","0x0f9":"never read summary","0x0fa":"virtual blob not found","0x0fb":"logic err with aggregator","0x0fc":"tree reuse at lower level","0x0fd":"data stores are writing incremental summaries!","0x0fe":"attachment is aggregate blob","0x0ff":"duplicate aggregate blob","0x100":"logic error","0x101":"Unexpected tree entry type on flatten!","0x102":"invalid level of concurrency","0x103":"trying to parallel run while not working","0x104":"undefined end point for parallel fetch","0x105":"unexpected end point for parallel fetch","0x107":"ending dispatch with remaining results to be sent","0x108":"ending results dispatch but knew in advance about more requests","0x109":"unexpected next chunk position","0x10a":"cannot add parallel request while not working","0x10b":"invalid parallel request range","0x10c":"invalid parallel request start point","0x10d":"invalid parallel request end point","0x10e":"should not throw result if we knew about boundary in advance","0x10f":"empty/partial chunks should not be returned by caching","0x110":"callback should retry until valid fetch before it learns new boundary","0x112":"cannot push onto queue if done","0x113":"deferred queue should be empty","0x114":"cannot pop if deferred","0x115":"queue should not be done during pop","0x116":"Missing handle on scheduler load","0x117":"Trying to get missing clientId!","0x118":"Bad client interactive check","0x119":"This agent became inactive while releasing","0x11a":"Unsuccessful registration","0x11b":"Trying to clear tasks on inactive agent","0x11c":"Detached object routing context","0x11d":"task is already running","0x11e":"client is undefined","0x11f":"requesting unknown blobs","0x120":"Undefined latency statistics (op send time)","0x121":"Undefined inner contents type!","0x122":"Message to unpack is not proper runtime message","0x124":"inconsistent readonly property/event state","0x125":"Unsafe to transition to read-only state!","0x126":"Expected createSubRequest url to include a leading slash","0x127":"dirty document event not set on replay","0x12a":"Missing blob id on metadata","0x12b":"did not get root data store","0x12d":"Container Context should already be in attaching state","0x12e":"Container Context should already be in attached state","0x12f":"Container Runtime's summarize should always return a tree","0x131":"Mismatch between new chunkId and expected chunkMap","0x132":"sending ops in detached container","0x133":"Container disconnected when trying to submit system message","0x137":"Failed to get version from storage","0x138":"Failed to get snapshot from storage","0x139":"Undefined package path","0x13a":"Data store ID contains slash","0x13b":"datastore context is already in bound state","0x13c":"undefined channel on datastore context","0x13d":"Detached runtime creation on realize()","0x13e":"Unexpected package path","0x13f":"datastore context registry is already set","0x140":"undefined channel on datastore context","0x141":"Unexpected connected state","0x142":"local store channel is not loaded","0x143":"Channel should not be undefined when running GC","0x144":"Channel should be loaded when updating used routes","0x145":"Channel should be present when data store is loaded","0x146":"Channel must exist when submitting message","0x147":"Channel must exist on submitting signal","0x148":"Detached runtime creation on runtime bind","0x149":"Undefined channel deferral","0x14a":"Undefined package path","0x14b":"Channel must exist when resubmitting ops","0x14c":"Channel must exist when rebasing ops","0x14d":"Should move from detached to attaching","0x14e":"Should move from attaching to attached","0x14f":"There should be a channel when generating attach message","0x150":"pkg should be available in local data store context","0x152":"pkg should be available in local data store","0x154":"runtime creation is already attached","0x155":"channel deferral is already set","0x156":"Unexpected factory for package path","0x157":"datastore registry already attached","0x158":"Creating store with existing ID","0x159":"The given id was not found in notBoundContexts to delete","0x15a":"Cannot find context to resolve to","0x15b":"Expected this id to already be removed from notBoundContexts","0x15c":"Cannot find deferred to resolve","0x15d":"Creating store with existing ID","0x15e":"Local object does not have matching attach message id","0x15f":"Could not find unbound context to bind","0x160":"There should be a store context for the op","0x161":"There should be a store context for the op","0x162":"There should be a store context for the op","0x163":"Missing datastore for local signal","0x165":"Summarizer cannot work if client has local changes","0x166":"BaseSnapshot should be there as detached container loaded from snapshot","0x167":"Used route does not belong to any known data store","0x168":"Expected tree in snapshot not found","0x169":"No pending message found for this remote message","0x16b":"The pending batch state indicates we are already processing a batch","0x16d":"There is no pending batch begin message","0x16e":"Batch with single message should not have batch metadata","0x16f":"Did not receive batch begin metadata","0x170":"Did not receive batch end metadata","0x171":"No pending state found for the remote message","0x172":"The connection state is not consistent with the runtime","0x173":"replayPendingStates called twice for same clientId!","0x174":"initial states should be empty before replaying pending","0x175":"Can only broadcast if summarizer starts in local state","0x176":"Can only ack/nack if summarizer is in broadcasting state","0x177":"Missing delta handler","0x178":"Missing delta handler on attach","0x179":"createChannel() with existing ID","0x17a":"Channel should be loaded when created!!","0x17b":"Channel to be binded should be in not bounded set","0x17c":"Unexpected attach (local) channel OP","0x17e":"Used route does not belong to any known context","0x17f":"Not expecting detached channels during summarize","0x180":"getAttachSummary should always return a tree","0x181":"BaseSnapshot should be there as detached container loaded from snapshot","0x182":"Data store should be attached to attach the channel.","0x183":"There should be a channel context for the op","0x184":"There should be a channel context for the op","0x185":"Channel not found","0x189":"Should always be remote because a local dds shouldn't generate ops before loading","0x18a":"Channel should be loaded to resubmit ops","0x18c":"Channel should be loaded to summarize","0x18d":"Channel should be loaded to take snapshot","0x18e":"Channel must not already be loaded when loading","0x190":".attributes blob should be present","0x192":"Channel should be there if loaded!!","0x193":"Channel should be loaded to run GC","0x194":"Remote channel must be loaded when rebasing op","0x195":"Remote channel must not be local when processing op","0x196":"Remote channel must be loaded when resubmitting op","0x197":"Remote channel must not already be loaded when loading","0x198":"Used route should always be an absolute route","0x19a":"Invalid response value for Fluid object request","0x19b":"Cannot not create response error on 200 status","0x19c":"storage service path has trailing separator","0x19d":"Handles should always have absolute paths","0x19f":"wipSummaryLogger should not be set yet in startSummary","0x1a0":"Already tracking a summary","0x1a1":"summarize should not be called when not tracking the summary","0x1a2":"wipSummaryLogger should have been set in startSummary or ctor","0x1a3":"wipSummaryLogger should have been set in startSummary or ctor","0x1a4":"Not tracking a summary","0x1a5":"Tracked summary local paths not set","0x1a6":"Not found pending summary, but this node has previously completed a summary","0x1a7":"Pending summary reference sequence number should be consistent","0x1a9":"When loading base summary, expected outstanding ops <= tracking sequence number","0x1aa":"Out of order change recorded","0x1ab":"Create SummarizerNode child already exists","0x1ac":"Cannot create child from summary if parent does not have latest summary","0x1ad":"Missing child summary tree","0x1ae":"Child summary object is not a tree","0x1af":"Outstanding ops blob missing, but base summary tree exists","0x1b0":"Base summary tree missing, but outstanding ops blob exists","0x1b1":"wip used routes should be set if tracking a summary","0x1b2":"Getting GC data should not be called when GC is disabled!","0x1b3":"GC data cannot be retrieved without getGCDataFn","0x1b4":"We should not already be tracking used routes when to track a new summary","0x1b5":"We should have been tracking used routes","0x1b6":"Create SummarizerNode child already exists","0x1b7":"Bad session state for processing quorum messages","0x1b8":"Bad session state for processing quorum messages","0x1b9":"Unexpected value for sequence number of first message in file","0x1ba":"should not return empty buckets","0x1bb":"Unexpected sequence number on first of messages to save","0x1bc":"Unexpected sequence number on last of messages to save","0x1bd":"Stopped writing at unexpected sequence number","0x1c5":"snapshot should be set before retrieving it","0x1c6":"snapshot should be set before retrieving it","0x1c7":"snapshot should be set before retrieving it as expanded string","0x1c8":"Mismatch between document sequence number and current op number","0x1c9":"Leftover documents after replay!","0x1ca":"replay-to target is <= current op in replay cycle","0x1cb":"Bad window to verify snapshot","0x1cc":"Unexpected previous snapshot op number","0x1ce":"clientId not found","0x1cf":"clientId not found","0x1d0":"sequenceNumber not found","0x1d3":"Missing client id on disconnect","0x1d5":"Invalid snapshot format version","0x1d6":"Parent summary object is not a tree","0x1d8":"Should only transition from Connecting state","0x1d9":"addRequestCore() should break into smaller chunks","0x1da":"Client id should be set if connected","0x1db":"epoch exists","0x1dc":"all entries have to have epoch","0x1dd":"no epoch","0x1de":"Not an ODSP resolved url","0x1e0":"Protocol and App summary trees should be present","0x1e2":"Caller must ensure 'isAttached()' before calling 'sendSetCellOp'.","0x1e4":"Unexpected serializable type","0x1e5":"Storage token should not be null","0x1e6":"Epoch  should be present in response","0x1e7":"caching was not performed!","0x1e8":"reentrancy","0x1e9":"Pending ops","0x1ea":"Prefetch snapshot only available for odsp!","0x1eb":"Snapshot should be prefetched!","0x1ec":"No refresh token provided.","0x1ed":"Share link should be present","0x1ef":"services must be defined","0x1f0":"Unexpected mismatch in readonly","0x1f5":"Attached state should have storage","0x1f6":"Negative client sequence number not allowed","0x1f7":"Previous client should always be defined","0x1f8":"local BlobAttach op with no pending blob","0x1fc":"summary is not a tree","0x1fe":"isolated channels subtree should exist in remote datastore snapshot","0x1ff":"isolated channels subtree should exist in local datastore snapshot","0x200":"Returned odsp snapshot is malformed. No trees!","0x201":"Returned odsp snapshot is malformed. No blobs!","0x203":"Summary handle is undefined","0x205":"attach() called more than once","0x207":"Channel should be defined","0x208":"Factory should be undefined before loading","0x209":"Factory Type should be defined","0x20a":"register for event on disposed object","0x20b":"mismatch","0x20c":"connection disposed","0x20d":"double connection listener","0x20e":"double tracked listener","0x20f":"Driver min read version should >= to server minReadVersion","0x210":"Snapshot should be created with minReadVersion or above","0x219":"1 root should be there","0x21b":"Snapshot id should be provided","0x21c":"Seq number should be provided","0x21d":"body is not string","0x21e":"improper boundary format","0x220":"socket key collision","0x221":"Root tree should contain the id","0x222":"Root tree should contain the id!!","0x223":"unexpected end of buffer","0x224":"Skip length should be positive","0x225":"Data should be there","0x226":"Should write complete data","0x227":"Data should be there","0x22b":"Should be a pair","0x22c":"reading pairs","0x231":"Number should be an integer","0x232":"Payload should not be negative","0x233":"Unexpected data at the end of buffer","0x234":"has joinOpTimer","0x235":"no joinOpTimer","0x236":"In all cases it should be already installed","0x237":"Snapshot should exist","0x238":"called only in connected state","0x239":"called only in disconnected state","0x23a":"seq#'s","0x23b":"we are not packing at the right level","0x23c":"we are not packing at the right level","0x23d":"pending is undefined","0x23e":"pending is undefined","0x23f":"pending undefined","0x240":"Binary format snapshot only for odsp driver!!","0x241":"disconnect should result in stopSequenceNumberUpdate() call","0x242":"has timer","0x243":"stopSequenceNumberUpdate should be called as result of sending any op!","0x244":"Socket is closed, but connection is not!","0x245":"tracked listener","0x246":"checking consistency of socket & _disposed flags","0x247":"Use addTrackedListener instead","0x248":"should not subscribe to forwarded events","0x24c":"Cannot call `flush()` from `orderSequentially`'s callback","0x24e":"assertion for type narrowing","0x250":"serialized container with attachment blobs must be rehydrated with detached blob storage","0x251":"creation summary has to have seq=0 && handle === undefined","0x252":"redirect table can only be set in detached container","0x253":"redirect table already exists","0x254":"unrecognized id in redirect table","0x255":"detached blob id absent in redirect table","0x256":"storage undefined in attached container","0x257":"This is not summarizing container","0x258":"connected","0x259":"Container disconnected when trying to submit system message","0x25b":"Caller is responsible for checking lock","0x25d":"We should never connect as 'read'","0x25e":"no reason to call fail if all promises have been completed","0x25f":"retryAfterSeconds","0x260":"Disposed should mean disconnected!","0x261":"Expected: off","0x262":"Old summarizer is still working!","0x263":"Expected: starting","0x264":"Expected: Not Off","0x266":"lastKnownSeqNumber should never be below last processed sequence number","0x267":"lastObservedSeqNumber should be updated first","0x268":"There can't be pending fetch that early in boot sequence!","0x269":"pending ops are not dropped","0x26a":"not closed","0x26b":"initial state","0x26c":"handler should be installed","0x26d":"wrong start","0x26e":"wrong start","0x26f":"continuous and no duplicates","0x270":"All requested ops fetched","0x272":"empty request","0x273":"Invalid document id from parsed URL","0x274":"type check","0x275":"Root tree should contain the id","0x278":"API is not supported for non-connecting or closed container","0x27b":"reentrancy may result in incorrect behavior","0x280":"Validate first op seq number","0x281":"Unreferenced if present should be true","0x282":"Headers should be present now","0x283":"Length of data len should fit in the bytes from the map","0x284":"Length of id should fit in the bytes from the map","0x285":"Start code should not undefined","0x286":"End code should not undefined","0x287":"key must exist in the map","0x288":"All properties should exist","0x289":"logic error","0x28a":"can't be disposed - Callers need to ensure that!","0x292":"Unexpected undefined result from getFileLinkCore","0x293":"initial state","0x294":"can't have op processing paused if we are processing an op","0x295":"there should be no pending batch if we have no ops","0x296":"we should never start processing incomplete batch!","0x297":"always called from resumed state","0x298":"we have something in the queue that generates this event","0x299":"non-synchronized state","0x29a":"System message in the middle of batch!","0x29b":"system op in a batch?","0x29c":"we should be processing ops when there is no active batch","0x29d":"we should be processing ops when there is no active batch","0x29e":"there can't be active batch","0x29f":"we should be processing ops when there is no active batch","0x2a0":"batch presence was validated above","0x2a1":"logic error","0x2a2":"Batch is interrupted by other client op. Should be caught by trackPending()","0x2a3":"container should be closed on any error","0x2a5":"join timer","0x2a6":"waitingForLeaveOp should imply writeConnection (we need to be ready to flush pending ops)","0x2a7":"Container is not attached","0x2a8":"Expected data store snapshot tree in base snapshot","0x2a9":"GC nodes for data store not in GC blob","0x2ac":"Connected when timeout waiting for leave from previous session fired!","0x2ad":"GC blob missing from snapshot","0x2ae":"node id should always be an absolute route","0x2af":"Child GC data should have been initialized","0x2b0":"Used route should always be an absolute route","0x2b1":"This should have be initiallized when generate GC nodes above","0x2b2":"Two entries for the same GC node with different unreferenced timestamp","0x2b3":"logic error","0x2b4":"not connected on sending ops!","0x2b5":"logic error","0x2b6":"Missing data store context","0x2b8":"Chunk should be set in map","0x2ba":"batchBegin must fire before batchEnd","0x2bb":"Instrumented token fetcher with throwOnNullToken = true should never return null","0x2bc":"Instrumented token fetcher with throwOnNullToken =true should never return null","0x2bd":"We should not see a pending FlushMode until we see a flush when processing a batch","0x2be":"LocalReferences array contains a gap","0x2bf":"both removedClientIds and removedSeq should be set or not set","0x2c0":"ID must be created before adding interval to collection","0x2c1":"Creating an interval collection that already exists?","0x2c2":"Create Version should be equal to currentReadVersion","0x2c4":"client should not be summarizer before container is created","0x2c5":"Attempting to connect() a closed Container","0x2c6":"Attempting to connect() a container that is not attached","0x2c7":"Attempting to disconnect() a closed Container","0x2c8":"outboundPushEventTime should be undefined","0x2c9":"durationNetwork should be undefined","0x2ca":"durationOutboundBatching should be undefined","0x2cb":"submitOpEventTime should be undefined","0x2cc":"OpTimeSittingInboundQueue should be undefined","0x2cd":"durationNetwork should be undefined","0x2ce":"msnTrackingTimestamp should not be undefined","0x2cf":"undefined channel on datastore context","0x2d0":"Data store should be globally visible to attach channels.","0x2d1":"Data store should be locally visible before it can become globally visible.","0x2d2":"Data store should be globally visible when its attached.","0x2d3":"Local channel must be globally visible when processing op","0x2d4":"Local channel must be globally visible when resubmitting op","0x2d5":"Invalid blob node id in unused routes.","0x2d7":"No data store with specified id","0x2d8":"Empty change event should not be emitted.","0x2da":"Unknown SharedMatrix 'op' type.","0x2db":"Applying op must generate a pending segment","0x2dc":"Cannot find code proposal","0x2dd":"Cannot find blob for a given id","0x2de":"Package path requested for unsupported node type.","0x2df":"transient references cannot be bound to segments","0x2e0":"lref not a Local Reference","0x2e1":"Support for plain value types removed.","0x2e2":"Must only wait for leave message when clientId in quorum","0x2e3":"Must have a valid protocol handler instance","0x2e4":"there should be service config for active connection","0x2e5":"Must have a base snapshot","0x2e6":"Must have a base snapshot","0x2e7":"Must serialize base snapshot blobs before getting runtime state","0x2e8":"There should be a store context for the op","0x2e9":"Must call getLocalState() after applying initial states","0x2ea":"Configuration state should be enabled","0x2eb":"Summary not supported with configuration disabled","0x2ec":"Blob must be present in blobsContents","0x2ed":"There should be a channel context for the op","0x2ee":"Channel should be loaded to rollback ops","0x2ef":"Local channel must be globally visible when rolling back op","0x2f0":"Remote channel must be loaded when rolling back op","0x2f1":"slideReferences from a segment which has not been removed and acked","0x2f2":"Ref not in the segment localRefs","0x2f3":"Ref not in the segment localRefs","0x2f4":"localRefs must be allocated","0x2f5":"op create references must be SlideOnRemove","0x2f6":"SlideOnRemove references must be op created","0x2f8":"Unexpected accept op, nothing pending","0x2f9":"Unexpected accept op, client not in expectedSignoffs","0x2fa":"Unexpected pending message received","0x2fb":"pendingMessageId does not match","0x2fc":"Invalid localOpMetadata for clear","0x2fd":"pendingMessageId does not match","0x2fe":"Invalid localOpMetadata in submit","0x2ff":"Unexpected pending message received","0x300":"localSeq greater than collab window","0x301":"Either seq or localSeq should be defined","0x302":"No segment found","0x303":"Invalid offset","0x304":"Id cannot contain slashes","0x305":"registerDependent on disposed Dependee","0x306":"invalidateDependents on disposed Dependee","0x307":"endInitialization should be called exactly once","0x308":"onDispose should be set when disposing","0x309":"Cannot unregister dependees on a disposed SimpleObservingDependent.","0x30a":"shouldClientJoinWrite should imply this is a writeConnection","0x30b":"Must have a valid protocol handler instance","0x30c":"Id cannot contain slashes","0x30d":"Id cannot contain slashes","0x30e":"Id cannot contain slashes. DataStoreContext should have validated this.","0x30f":"Channel context ID cannot contain slashes","0x310":"Channel context ID cannot contain slashes","0x311":"expected id to exist on interval","0x312":"snapshot should be parsed","0x313":'Specified user was not of type "TinyliciousUser".',"0x314":"Container properly closed","0x315":"re-entrancy","0x316":"There should be a cached promise of in-progress aliasing","0x317":"dataStoreFactory is undefined","0x318":"resolvedUrl is undefined","0x319":"No delta connection server associated with specified document ID","0x31a":"resolvedUrl is undefined","0x31b":"container1.resolvedUrl is undefined","0x31c":"rightDiv is undefined","0x31d":'options are not of type "IRouterliciousRouteOptions" as expected',"0x31e":"options.tenantId is undefined","0x320":"options.tenantId is undefined","0x322":"options.fluidHost is undefined","0x324":"options.server is undefined","0x325":"options.odspAccessToken is undefined","0x326":"lockResolver is undefined","0x327":"options.server is undefined","0x328":"options.server is undefined","0x329":"browser.umd property is undefined","0x32a":"pendingMessageId does not match","0x32b":"Invalid localOpMetadata for clear","0x32c":"pendingMessageId does not match","0x32d":"Invalid localOpMetadata in submit","0x32e":"Unexpected pending message received","0x32f":"Invalid localOpMetadata for sub directory op","0x330":"Unexpected pending message received","0x331":"Unexpected pending message received","0x332":"Unexpected pending message received","0x333":"PathShared.splice can only insert detached ranges","0x334":"Anchor must not be double freed","0x335":"ObjectForest.getRoot only valid for existing roots","0x336":"ObjectForest must only be given its own Anchors","0x337":"ObjectForest must only be given its own Cursor type","0x338":"ObjectForest must only be given its own Cursor","0x339":"Anchor must not be double freed","0x33a":"Anchor must not be double freed","0x33b":"Cursor must not be freed","0x33c":"Cursor must not be freed","0x33d":"Cursor must be current to be used","0x33e":"Cursor must be current to be used","0x33f":"Cursor must not be double freed","0x340":"Cursor must be current to be used","0x341":"Cursor must be current to be used","0x342":'Invalid usage. "blobid" should always be null',"0x343":'Invalid usage. "count" should always be 1',"0x344":"this.pendingConnection should be undefined","0x345":"this.pendingConnection is undefined when trying to cancel","0x346":"inboundQueuePausedFromInit should be true"}},9477:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateUser=t.generateToken=void 0;const n=r(1166),s=r(8410);function i(){return{id:(0,s.v4)(),name:(0,s.v4)()}}t.generateToken=function(e,t,r,o,a,c=3600,h="1.0"){let l=a||i();""!==l.id&&void 0!==l.id||(l=i());const u=Math.round(Date.now()/1e3),d={documentId:null!=o?o:"",scopes:r,tenantId:e,user:l,iat:u,exp:u+c,ver:h,jti:(0,s.v4)()},p={utf8:t};return n.KJUR.jws.JWS.sign(null,JSON.stringify({alg:"HS256",typ:"JWT"}),d,p)},t.generateUser=i},2098:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(4926),t),s(r(2697),t),s(r(3891),t),s(r(591),t),s(r(2248),t),s(r(6749),t),s(r(3261),t),s(r(726),t)},4926:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InsecureTokenProvider=void 0;const n=r(2499),s=r(9477);t.InsecureTokenProvider=class{constructor(e,t){this.tenantKey=e,this.user=t}async fetchOrdererToken(e,t){return{fromCache:!0,jwt:(0,s.generateToken)(e,this.tenantKey,[n.ScopeType.DocRead,n.ScopeType.DocWrite,n.ScopeType.SummaryWrite],t,this.user)}}async fetchStorageToken(e,t){return{fromCache:!0,jwt:(0,s.generateToken)(e,this.tenantKey,[n.ScopeType.DocRead,n.ScopeType.DocWrite,n.ScopeType.SummaryWrite],t,this.user)}}}},3891:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MockDeltaManager=t.MockDeltaQueue=void 0;const n=r(7187),s=r(4690);class i extends n.EventEmitter{constructor(){super(),this.queue=[],this.pauseCount=0,this.processCallback=()=>{}}get disposed(){}get paused(){return 0!==this.pauseCount}get length(){return this.queue.length}get idle(){return 0===this.queue.length}process(){Promise.resolve().then((()=>{for(;0===this.pauseCount&&this.length>0;){const e=this.pop();(0,s.assert)(void 0!==e,"this is impossible due to the above length check"),this.processCallback(e)}}))}push(e){this.queue.push(e),this.emit("push",e),this.process()}pop(){return this.queue.shift()}async pause(){this.pauseCount++}resume(){this.pauseCount--,this.process()}peek(){return this.queue[0]}toArray(){return this.queue}dispose(){}async waitTillProcessingDone(){throw new Error("NYI")}}t.MockDeltaQueue=i;class o extends s.TypedEventEmitter{constructor(){super(),this.readOnlyInfo={readonly:!1},this.clientType=void 0,this.clientDetails=void 0,this._inbound=void 0,this._inboundSignal=void 0,this._outbound=void 0,this.minimumSequenceNumber=0,this.lastSequenceNumber=0,this.lastKnownSeqNumber=0,this.initialSequenceNumber=0,this.hasCheckpointSequenceNumber=!1,this._inbound=new i,this._outbound=new i,this._inboundSignal=new i}get disposed(){}get IDeltaSender(){return this}get inbound(){return this._inbound}get outbound(){return this._outbound}get inboundSignal(){return this._inboundSignal}get version(){}get maxMessageSize(){return 0}get serviceConfiguration(){}get active(){return!0}close(){}submitSignal(e){}flush(){}submit(e,t,r=!1,n){return 0}dispose(){}}t.MockDeltaManager=o},591:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MockHandle=void 0;const n=r(2994);t.MockHandle=class{constructor(e,t=`mock-handle-${Math.random().toString(36).slice(2)}`,r=`/${t}`){this.value=e,this.path=t,this.absolutePath=r,this.graphAttachState=n.AttachState.Detached}get IFluidHandle(){return this}get isAttached(){return this.graphAttachState===n.AttachState.Attached}async get(){return this.value}attachGraph(){this.graphAttachState=n.AttachState.Attached}bind(){throw Error("MockHandle.bind() unimplemented.")}}},3261:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MockStorage=void 0;const n=r(4690),s=r(9251);class i{constructor(e){this.tree=e}static createFromSummary(e){const t=(0,s.convertSummaryTreeToITree)(e);return new i(t)}static readBlobCore(e,t){if(e)for(const r of e.entries)if(r.path===t[0])return"Blob"===r.type?((0,n.assert)(1===t.length,JSON.stringify(Object.assign({},arguments))),r.value):"Tree"===r.type?i.readBlobCore(r.value,t.slice(1)):void 0}async readBlob(e){const t=i.readBlobCore(this.tree,e.split("/"));return(0,n.assert)(void 0!==t,`Blob does not exist: ${e}`),(0,n.stringToBuffer)(t.contents,t.encoding)}async contains(e){return void 0!==i.readBlobCore(this.tree,e.split("/"))}async list(e){return(0,s.listBlobsAtTreePath)(this.tree,e)}}t.MockStorage=i},2248:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MockSharedObjectServices=t.MockObjectStorageService=t.MockEmptyDeltaConnection=t.MockFluidDataStoreRuntime=t.MockQuorumClients=t.MockContainerRuntimeFactory=t.MockContainerRuntime=t.MockDeltaConnection=void 0;const n=r(7187),s=r(4690),i=r(2994),o=r(2609),a=r(2499),c=r(9251),h=r(8410),l=r(3891);class u{constructor(e,t){this.submitFn=e,this.dirtyFn=t,this._connected=!0}get connected(){return this._connected}attach(e){this.handler=e,e.setConnectionState(this.connected)}submit(e,t){return this.submitFn(e,t)}dirty(){this.dirtyFn()}setConnectionState(e){var t;this._connected=e,null===(t=this.handler)||void 0===t||t.setConnectionState(e)}process(e,t,r){var n;null===(n=this.handler)||void 0===n||n.process(e,t,r)}reSubmit(e,t){var r;null===(r=this.handler)||void 0===r||r.reSubmit(e,t)}}t.MockDeltaConnection=u;class d{constructor(e,t){var r;this.dataStoreRuntime=e,this.factory=t,this.clientSequenceNumber=0,this.deltaConnections=[],this.pendingMessages=[],this.deltaManager=new l.MockDeltaManager,this.dataStoreRuntime.deltaManager=this.deltaManager,this.dataStoreRuntime.quorum=t.quorum,this.clientId=null!==(r=this.dataStoreRuntime.clientId)&&void 0!==r?r:(0,h.v4)(),t.quorum.addMember(this.clientId,{})}createDeltaConnection(){const e=new u(((e,t)=>this.submit(e,t)),(()=>this.dirty()));return this.deltaConnections.push(e),e}submit(e,t){const r=this.clientSequenceNumber++,n={clientId:this.clientId,clientSequenceNumber:r,contents:e,referenceSequenceNumber:this.deltaManager.lastSequenceNumber,type:a.MessageType.Operation};return this.factory.pushMessage(n),this.addPendingMessage(e,t,r),r}dirty(){}process(e){this.deltaManager.lastSequenceNumber=e.sequenceNumber,this.deltaManager.lastMessage=e,this.deltaManager.minimumSequenceNumber=e.minimumSequenceNumber;const[t,r]=this.processInternal(e);this.deltaConnections.forEach((n=>{n.process(e,t,r)}))}addPendingMessage(e,t,r){const n={content:e,clientSequenceNumber:r,localOpMetadata:t};this.pendingMessages.push(n)}processInternal(e){let t;const r=this.clientId===e.clientId;if(r){const r=this.pendingMessages.shift();(0,s.assert)((null==r?void 0:r.clientSequenceNumber)===e.clientSequenceNumber,"Unexpected client sequence number from message"),t=r.localOpMetadata}return[r,t]}}t.MockContainerRuntime=d,t.MockContainerRuntimeFactory=class{constructor(){this.sequenceNumber=0,this.minSeq=new Map,this.quorum=new p,this.messages=[],this.runtimes=[]}get outstandingMessageCount(){return this.messages.length}getMinSeq(){let e;for(const[t,r]of this.minSeq)void 0!==this.quorum.getMember(t)&&(e=void 0===e?r:Math.min(e,r));return null!=e?e:0}createContainerRuntime(e){const t=new d(e,this);return this.runtimes.push(t),t}pushMessage(e){e.clientId&&void 0!==e.referenceSequenceNumber&&!this.minSeq.has(e.clientId)&&this.minSeq.set(e.clientId,e.referenceSequenceNumber),this.messages.push(e)}processOneMessage(){if(0===this.messages.length)throw new Error("Tried to process a message that did not exist");let e=this.messages.shift();e=JSON.parse(JSON.stringify(e)),this.minSeq.set(e.clientId,e.referenceSequenceNumber),e.sequenceNumber=++this.sequenceNumber,e.minimumSequenceNumber=this.getMinSeq();for(const t of this.runtimes)t.process(e)}processSomeMessages(e){if(e>this.messages.length)throw new Error("Tried to process more messages than exist");for(let t=0;t<e;t++)this.processOneMessage()}processAllMessages(){for(;this.messages.length>0;)this.processOneMessage()}};class p{constructor(...e){var t;this.eventEmitter=new n.EventEmitter,this.disposed=!1,this.members=new Map(null!==(t=e)&&void 0!==t?t:[])}addMember(e,t){this.members.set(e,t),this.eventEmitter.emit("addMember",e,t)}removeMember(e){this.members.delete(e)&&this.eventEmitter.emit("removeMember",e)}getMembers(){return this.members}getMember(e){return this.getMembers().get(e)}dispose(){throw new Error("Method not implemented.")}addListener(e,t){throw new Error("Method not implemented.")}on(e,t){switch(e){case"afterOn":return this.eventEmitter.on(e,t),this;case"addMember":case"removeMember":return this.eventEmitter.on(e,t),this.eventEmitter.emit("afterOn",e),this;default:throw new Error("Method not implemented.")}}once(e,t){throw new Error("Method not implemented.")}prependListener(e,t){throw new Error("Method not implemented.")}prependOnceListener(e,t){throw new Error("Method not implemented.")}removeListener(e,t){return this.eventEmitter.removeListener(e,t),this}off(e,t){return this.eventEmitter.off(e,t),this}removeAllListeners(e){throw new Error("Method not implemented.")}setMaxListeners(e){throw new Error("Method not implemented.")}getMaxListeners(){throw new Error("Method not implemented.")}listeners(e){throw new Error("Method not implemented.")}rawListeners(e){throw new Error("Method not implemented.")}emit(e,...t){throw new Error("Method not implemented.")}eventNames(){throw new Error("Method not implemented.")}listenerCount(e){throw new Error("Method not implemented.")}}t.MockQuorumClients=p;class g extends n.EventEmitter{constructor(){super(...arguments),this.documentId=void 0,this.id=(0,h.v4)(),this.existing=void 0,this.options={},this.clientId=(0,h.v4)(),this.path="",this.connected=!0,this.deltaManager=new l.MockDeltaManager,this.loader=void 0,this.logger=o.DebugLogger.create("fluid:MockFluidDataStoreRuntime"),this.quorum=new p,this._local=!1,this._disposed=!1}get IFluidHandleContext(){return this}get rootRoutingContext(){return this}get channelsRoutingContext(){return this}get objectsRoutingContext(){return this}get IFluidRouter(){return this}get absolutePath(){return`/${this.id}`}get local(){return this._local}set local(e){this._local=e}get disposed(){return this._disposed}dispose(){this._disposed=!0}async getChannel(e){return null}createChannel(e,t){return null}get isAttached(){return!this.local}get attachState(){return this.local?i.AttachState.Detached:i.AttachState.Attached}bindChannel(e){}attachGraph(){}bindToContext(){}bind(e){}getQuorum(){return this.quorum}getAudience(){return null}save(e){}async close(){}async uploadBlob(e){return null}async getBlob(e){return null}submitMessage(e,t){return null}submitSignal(e,t){return null}process(e,t){}processSignal(e,t){}updateMinSequenceNumber(e){}setConnectionState(e,t){}async resolveHandle(e){return this.request(e)}async request(e){return null}addedGCOutboundReference(e,t){}async summarize(e,t){const r=(0,c.mergeStats)();return r.treeNodeCount++,{summary:{type:a.SummaryType.Tree,tree:{}},stats:r}}async getGCData(){return{gcNodes:{}}}updateUsedRoutes(e,t){}getAttachSnapshot(){return[]}getAttachSummary(){const e=(0,c.mergeStats)();return e.treeNodeCount++,{summary:{type:a.SummaryType.Tree,tree:{}},stats:e}}setAttachState(e){}async waitAttached(){}async requestDataStore(e){return null}reSubmit(e,t){}async applyStashedOp(e){}rollback(e,t){}}t.MockFluidDataStoreRuntime=g;class m{constructor(){this.connected=!1}attach(e){}submit(e){return(0,s.assert)(!1,"Throw submit error on mock empty delta connection"),0}dirty(){}}t.MockEmptyDeltaConnection=m;class f{constructor(e){this.contents=e}async readBlob(e){return(0,s.stringToBuffer)(this.contents[e],"utf8")}async contains(e){return void 0!==this.contents[e]}async list(e){const t=(0,c.getNormalizedObjectStoragePathParts)(e).length;return Object.keys(this.contents).filter((r=>r.startsWith(e)&&r.split("/").length===t+1))}}t.MockObjectStorageService=f;class y{constructor(e){this.deltaConnection=new m,this.objectStorage=new f(e)}static createFromSummary(e){const t={};for(const[r,n]of Object.entries(e.tree))(0,s.assert)(n.type===a.SummaryType.Blob,"Unexpected summary type on mock createFromSummary"),t[r]=n.content;return new y(t)}}t.MockSharedObjectServices=y},2697:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MockFluidDataStoreContext=void 0;const n=r(2609),s=r(8410);t.MockFluidDataStoreContext=class{constructor(e=(0,s.v4)(),t=!1,r=n.DebugLogger.create("fluid:MockFluidDataStoreContext")){this.id=e,this.existing=t,this.logger=r,this.documentId=void 0,this.isLocalDataStore=!0,this.packagePath=void 0,this.options=void 0,this.clientId=(0,s.v4)(),this.clientDetails=void 0,this.connected=!0,this.deltaManager=void 0,this.containerRuntime=void 0,this.storage=void 0,this.IFluidDataStoreRegistry=void 0,this.IFluidHandleContext=void 0,this.attachState=void 0,this.scope=void 0}on(e,t){switch(e){case"attaching":case"attached":return this;default:throw new Error("Method not implemented.")}}once(e,t){return this}off(e,t){throw new Error("Method not implemented.")}getQuorum(){}getAudience(){}submitMessage(e,t,r){throw new Error("Method not implemented.")}submitSignal(e,t){throw new Error("Method not implemented.")}bindToContext(){throw new Error("Method not implemented.")}setChannelDirty(e){throw new Error("Method not implemented.")}async getAbsoluteUrl(e){throw new Error("Method not implemented.")}getCreateChildSummarizerNodeFn(e,t){throw new Error("Method not implemented.")}async uploadBlob(e){throw new Error("Method not implemented.")}async getInitialGCSummaryDetails(){throw new Error("Method not implemented.")}async getBaseGCDetails(){throw new Error("Method not implemented.")}}},6749:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MockContainerRuntimeFactoryForReconnection=t.MockContainerRuntimeForReconnection=void 0;const n=r(8410),s=r(4690),i=r(2248);class o extends i.MockContainerRuntime{constructor(e,t){super(e,t),this.pendingRemoteMessages=[],this._connected=!0}get connected(){return this._connected}set connected(e){if(this._connected!==e){if(this._connected=e,e){for(const e of this.pendingRemoteMessages)this.process(e);this.pendingRemoteMessages.length=0,this.clientSequenceNumber=0,this.clientId=(0,n.v4)(),this.dataStoreRuntime.clientId=this.clientId,this.factory.quorum.addMember(this.clientId,{}),this.reSubmitMessages()}else this.factory.clearOutstandingClientMessages(this.clientId),this.factory.quorum.removeMember(this.clientId);this.deltaConnections.forEach((e=>{e.setConnectionState(this.connected)}))}}process(e){this.connected?super.process(e):this.pendingRemoteMessages.push(e)}submit(e,t){return this.connected?super.submit(e,t):(this.addPendingMessage(e,t,-1),-1)}reSubmitMessages(){let e=this.pendingMessages.length;for(;e>0;){const t=this.pendingMessages.shift();(0,s.assert)(void 0!==t,"this is impossible due to the above length check"),this.deltaConnections.forEach((e=>{e.reSubmit(t.content,t.localOpMetadata)})),e--}}}t.MockContainerRuntimeForReconnection=o;class a extends i.MockContainerRuntimeFactory{createContainerRuntime(e){const t=new o(e,this);return this.runtimes.push(t),t}clearOutstandingClientMessages(e){this.messages=this.messages.filter((t=>t.clientId!==e))}}t.MockContainerRuntimeFactoryForReconnection=a},726:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateAssertionError=void 0;const n=r(979);t.validateAssertionError=function(e,t){var r;const s=null!==(r=n.shortCodeMap[e.message])&&void 0!==r?r:e.message;if(s!==t)throw new Error(`Unexpected assertion thrown: ${e.message} ('${s}')`);return!0}},4690:(e,t,r)=>{"use strict";function n(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}r.r(t),r.d(t,{BaseTelemetryNullLogger:()=>C,BatchManager:()=>f,Deferred:()=>N,EventForwarder:()=>S,Heap:()=>x,IsoBuffer:()=>h,Lazy:()=>j,LazyPromise:()=>P,NumberComparer:()=>w,PromiseCache:()=>O,PromiseTimer:()=>q,RangeTracker:()=>F,RateLimiter:()=>k,TelemetryNullLogger:()=>E,Timer:()=>M,Trace:()=>L,TypedEventEmitter:()=>b,Uint8ArrayToArrayBuffer:()=>H,Uint8ArrayToString:()=>i,assert:()=>n,bufferToString:()=>a,delay:()=>_,doIfNotDisposed:()=>y,extractLogSafeErrorProperties:()=>A,fromBase64ToUtf8:()=>p,fromUtf8ToBase64:()=>g,gitHashFile:()=>u,hashFile:()=>l,isArrayBuffer:()=>c,performance:()=>d,safelyParseJSON:()=>D,stringToBuffer:()=>o,toUtf8:()=>m,unreachableCase:()=>B});var s=r(9742);function i(e,t){switch(t){case"base64":return s.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}const o=(e,t)=>h.from(e,t).buffer,a=(e,t)=>h.from(e).toString(t);function c(e){const t=e;return e instanceof ArrayBuffer||"object"==typeof t&&null!==t&&"number"==typeof t.byteLength&&"function"==typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}class h extends Uint8Array{toString(e){return i(this,e)}static from(e,t,r){if("string"==typeof e)return h.fromString(e,t);if(null!==e&&"object"==typeof e&&c(e.buffer))return n(0===e.byteOffset,0),n(e.byteLength===e.buffer.byteLength,1),h.fromArrayBuffer(e.buffer,t,r);if(c(e))return h.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const n=null!=t?t:0,s=null!=r?r:e.byteLength-n;if(n<0||n>e.byteLength||s<0||s+n>e.byteLength)throw new RangeError;return new h(e,n,s)}static fromString(e,t){switch(t){case"base64":{const t=this.sanitizeBase64(e),r=s.toByteArray(t);return new h(r.buffer)}case"utf8":case"utf-8":case void 0:{const t=(new TextEncoder).encode(e);return new h(t.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!=0&&(t+=["","===","==","="][t.length%4]),t}}async function l(e,t="SHA-1",n="hex"){if(void 0===crypto.subtle)return r.e(564).then(r.bind(r,4569)).then((async r=>r.hashFile(e,t,n)));const i=await async function(e,t){const r=await crypto.subtle.digest(t,e);return new Uint8Array(r)}(e,t);return function(e,t){switch(t){case"hex":return Array.prototype.map.call(e,(e=>e.toString(16).padStart(2,"0"))).join("");case"base64":return s.fromByteArray(e)}}(i,n)}async function u(e){const t=`blob ${e.byteLength.toString()}${String.fromCharCode(0)}`;return l(h.from(t+e.toString()))}const d=window.performance,p=e=>h.from(e,"base64").toString("utf-8"),g=e=>h.from(e,"utf8").toString("base64"),m=(e,t)=>{switch(t){case"utf8":case"utf-8":return e;default:return h.from(e,t).toString()}};class f{constructor(e,t=100){this.process=e,this.maxBatchSize=t,this.pendingWork=new Map}add(e,t){this.pendingWork.has(e)||this.pendingWork.set(e,[]),this.pendingWork.get(e).push(t),this.pendingWork.get(e).length>=this.maxBatchSize?(void 0!==this.pendingTimer&&clearTimeout(this.pendingTimer),this.pendingTimer=void 0,this.startWork()):void 0===this.pendingTimer&&(this.pendingTimer=setTimeout((()=>{this.pendingTimer=void 0,this.startWork()}),0))}drain(){this.startWork()}startWork(){const e=this.pendingWork;this.pendingWork=new Map;for(const[t,r]of e)this.process(t,r)}}function y(e,t){return(...r)=>{if(e.disposed)throw new Error("Already disposed");return t(...r)}}var v=r(7187);class b extends v.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}class S extends b{constructor(e){if(super(),this.isDisposed=!1,this.forwardingEvents=new Map,void 0!==e){const t=t=>this.unforwardEvent(e,t),r=t=>this.forwardEvent(e,t);this.on(S.removeListenerEvent,t),this.on(S.newListenerEvent,r)}}static isEmitterEvent(e){return e===S.newListenerEvent||e===S.removeListenerEvent}get disposed(){return this.isDisposed}dispose(){this.isDisposed=!0;for(const e of this.forwardingEvents.values())for(const t of e.values())try{t()}catch(e){}this.removeAllListeners(),this.forwardingEvents.clear()}forwardEvent(e,...t){for(const r of t)if(void 0!==e&&void 0!==r&&!S.isEmitterEvent(r)){let t=this.forwardingEvents.get(r);if(void 0===t&&(t=new Map,this.forwardingEvents.set(r,t)),!t.has(e)){const n=(...e)=>this.emit(r,...e);t.set(e,(()=>e.off(r,n))),e.on(r,n)}}}unforwardEvent(e,...t){for(const r of t)if(void 0!==r&&!S.isEmitterEvent(r)){const t=this.forwardingEvents.get(r);if((null==t?void 0:t.has(e))&&0===this.listenerCount(r)){const n=t.get(e);void 0!==n&&n(),t.delete(e),0===t.size&&this.forwardingEvents.delete(r)}}}}S.newListenerEvent="newListener",S.removeListenerEvent="removeListener";const w={compare:(e,t)=>e-t,min:Number.MIN_VALUE};class x{constructor(e){this.comp=e,this.L=[{value:e.min,position:0}]}peek(){return this.L[1]}get(){this.swap(1,this.count());const e=this.L.pop();return this.fixdown(1),e.value}add(e){const t={value:e,position:this.L.length};return this.L.push(t),this.fixup(this.count()),t}update(e){const t=e.position;this.isGreaterThanParent(t)?this.fixup(t):this.fixdown(t)}remove(e){const t=e.position;this.swap(e.position,this.L.length-1),this.L.splice(this.L.length-1),t!==this.L.length&&this.update(this.L[t])}count(){return this.L.length-1}fixup(e){let t=e;for(;this.isGreaterThanParent(t);){const e=t>>1;this.swap(t,e),t=e}}isGreaterThanParent(e){return e>1&&this.comp.compare(this.L[e>>1].value,this.L[e].value)>0}fixdown(e){let t=e;for(;t<<1<=this.count();){let e=t<<1;if(e<this.count()&&this.comp.compare(this.L[e].value,this.L[e+1].value)>0&&e++,this.comp.compare(this.L[t].value,this.L[e].value)<=0)break;this.swap(t,e),t=e}}swap(e,t){const r=this.L[e];this.L[e]=this.L[t],this.L[e].position=e,this.L[t]=r,this.L[t].position=t}}class C{send(e){}}class E{send(e){}sendTelemetryEvent(e,t){}sendErrorEvent(e,t){}sendPerformanceEvent(e,t){}}function A(e){const t={message:"string"==typeof(null==e?void 0:e.message)?e.message:String(e)};if(null!==(r=e)&&!Array.isArray(r)&&"object"==typeof r){const{errorType:r,stack:n,name:s}=e;if("string"==typeof r&&(t.errorType=r),"string"==typeof n){const e="string"==typeof s?s:void 0;t.stack=((e,t)=>{const r=e.split("\n");return r.shift(),void 0!==t&&r.unshift(t),r.join("\n")})(n,e)}}var r;return t}class T{constructor(e,t){this.expiry=e,this.cleanup=t,this.gcTimeouts=new Map}schedule(e){"indefinite"!==this.expiry.policy&&this.gcTimeouts.set(e,setTimeout((()=>{this.cleanup(e),this.cancel(e)}),this.expiry.durationMs))}cancel(e){const t=this.gcTimeouts.get(e);void 0!==t&&(clearTimeout(t),this.gcTimeouts.delete(e))}update(e){"sliding"===this.expiry.policy&&(this.cancel(e),this.schedule(e))}}class O{constructor({expiry:e={policy:"indefinite"},removeOnError:t=(()=>!0)}={}){this.cache=new Map,this.removeOnError=t,this.gc=new T(e,(e=>this.remove(e)))}has(e){return this.cache.has(e)}get(e){return this.has(e)&&this.gc.update(e),this.cache.get(e)}remove(e){return this.gc.cancel(e),this.cache.delete(e)}async addOrGet(e,t){let r=this.get(e);return void 0===r&&(r=(async()=>t())(),this.cache.set(e,r),r.catch((t=>{this.removeOnError(t)&&this.remove(e)})),this.gc.schedule(e)),r}add(e,t){const r=this.has(e);return this.addOrGet(e,t).catch((()=>{})),!r}async addValueOrGet(e,t){return this.addOrGet(e,(async()=>t))}addValue(e,t){return this.add(e,(async()=>t))}}class N{constructor(){this.completed=!1,this.p=new Promise(((e,t)=>{this.res=e,this.rej=t}))}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){void 0!==this.res&&(this.completed=!0,this.res(e))}reject(e){void 0!==this.rej&&(this.completed=!0,this.rej(e))}}class P{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return void 0===this.result&&(this.result=this.execute()),this.result}}var R=r(361),I=r.n(R);class F{constructor(e,t){"number"==typeof e?(this.ranges=[{length:0,primary:e,secondary:t}],this.lastPrimary=e,this.lastSecondary=t):(this.ranges=I()(e.ranges),this.lastPrimary=e.lastPrimary,this.lastSecondary=e.lastSecondary)}get base(){return this.ranges[0].primary}get primaryHead(){return this.lastPrimary}get secondaryHead(){return this.lastSecondary}serialize(){return{lastPrimary:this.lastPrimary,lastSecondary:this.lastSecondary,ranges:I()(this.ranges)}}add(e,t){n(e>=this.lastPrimary,3),void 0!==this.lastSecondary&&n(t>=this.lastSecondary,4),this.lastPrimary=e,this.lastSecondary=t;const r=this.ranges[this.ranges.length-1],s=r.primary+r.length,i=r.secondary+r.length;t!==i&&(e===s?0===r.length?r.secondary=t:(r.length--,this.ranges.push({length:0,primary:e,secondary:t})):s+1===e&&i+1===t?r.length++:this.ranges.push({length:0,primary:e,secondary:t}))}get(e){n(e>=this.ranges[0].primary,5);let t=1;for(;t<this.ranges.length&&!(e<this.ranges[t].primary);t++);n(e>=this.ranges[t-1].primary,6);const r=this.ranges[t-1];return Math.min(e-r.primary,r.length)+r.secondary}updateBase(e){n(e>=this.ranges[0].primary,7);let t=1;for(;t<this.ranges.length&&!(e<this.ranges[t].primary);t++);n(e>=this.ranges[t-1].primary,8);const r=this.ranges[t-1],s=e-r.primary;r.secondary=r.secondary+Math.min(s,r.length),r.length=Math.max(r.length-s,0),r.primary=e,this.ranges=t-1>0?this.ranges.slice(t-1):this.ranges,n(e===this.ranges[0].primary,9)}}class k{constructor(e){this.windowMSec=e,this.requestMap=new Map}filter(e,t){const r=[],n=Date.now();for(const s of t){const t=`${e}/${s}`;if(this.requestMap.has(t)){if(this.requestMap.get(t)+this.windowMSec>n)continue;this.requestMap.set(t,n),r.push(s)}else this.requestMap.set(t,n),r.push(s)}return r}}function D(e){let t;try{t=JSON.parse(e)}catch(e){}return t}class M{constructor(e,t,r=(()=>Date.now())){this.defaultTimeout=e,this.defaultHandler=t,this.getCurrentTick=r}get hasTimer(){return!!this.runningState}start(e=this.defaultTimeout,t=this.defaultHandler){this.startCore(e,t,e)}clear(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}restart(e,t){var r,n;if(this.runningState){const s=null!=e?e:this.runningState.intendedDuration,i=null!==(n=null!=t?t:null===(r=this.runningState.restart)||void 0===r?void 0:r.handler)&&void 0!==n?n:this.runningState.handler,o=this.calculateRemainingTime(this.runningState);s<o?this.start(s,i):s===o?(this.runningState.handler=i,this.runningState.restart=void 0,this.runningState.intendedDuration=s):this.runningState.restart={startTick:this.getCurrentTick(),duration:s,handler:i}}else this.start(e,t)}startCore(e,t,r){this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:e,intendedDuration:r,handler:t,timeout:setTimeout((()=>this.handler()),e)}}handler(){n(!!this.runningState,10);const e=this.runningState.restart;if(void 0!==e){const t=this.calculateRemainingTime(e);this.startCore(t,(()=>e.handler()),e.duration)}else{const e=this.runningState.handler;this.clear(),e()}}calculateRemainingTime(e){const t=this.getCurrentTick()-e.startTick;return e.duration-t}}class q{constructor(e,t){this.timer=new M(e,(()=>this.wrapHandler(t)))}get hasTimer(){return this.timer.hasTimer}async start(e,t){return this.clear(),this.deferred=new N,this.timer.start(e,t?()=>this.wrapHandler(t):void 0),this.deferred.promise}clear(){this.timer.clear(),this.deferred&&(this.deferred.resolve({timerResult:"cancel"}),this.deferred=void 0)}wrapHandler(e){e(),n(!!this.deferred,11),this.deferred.resolve({timerResult:"timeout"}),this.deferred=void 0}}class L{constructor(e){this.startTick=e,this.lastTick=e}static start(){const e=d.now();return new L(e)}trace(){const e=d.now(),t={totalTimeElapsed:e-this.startTick,duration:e-this.lastTick,tick:e};return this.lastTick=e,t}}function B(e,t="Unreachable Case"){throw new Error(t)}class j{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}}const _=async e=>new Promise((t=>setTimeout((()=>t()),e)));function H(e){return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}},2499:(e,t,r)=>{"use strict";var n,s,i,o,a,c;r.r(t),r.d(t,{FileMode:()=>i,MessageType:()=>n,NackErrorType:()=>s,ScopeType:()=>c,SummaryType:()=>a,TreeEntry:()=>o}),function(e){e.NoOp="noop",e.ClientJoin="join",e.ClientLeave="leave",e.Propose="propose",e.Reject="reject",e.Summarize="summarize",e.SummaryAck="summaryAck",e.SummaryNack="summaryNack",e.Operation="op",e.RemoteHelp="remoteHelp",e.NoClient="noClient",e.RoundTrip="tripComplete",e.Control="control"}(n||(n={})),function(e){e.ThrottlingError="ThrottlingError",e.InvalidScopeError="InvalidScopeError",e.BadRequestError="BadRequestError",e.LimitExceededError="LimitExceededError"}(s||(s={})),function(e){e.File="100644",e.Executable="100755",e.Directory="040000",e.Symlink="120000"}(i||(i={})),function(e){e.Blob="Blob",e.Tree="Tree",e.Attachment="Attachment"}(o||(o={})),function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(a||(a={})),function(e){e.DocRead="doc:read",e.DocWrite="doc:write",e.SummaryWrite="summary:write"}(c||(c={}))},8599:e=>{"use strict";const{AbortController:t,AbortSignal:r}="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0;e.exports=t,e.exports.AbortSignal=r,e.exports.default=t},9742:(e,t)=>{"use strict";t.byteLength=function(e){var t=a(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,i=a(e),o=i[0],c=i[1],h=new s(function(e,t,r){return 3*(t+r)/4-r}(0,o,c)),l=0,u=c>0?o-4:o;for(r=0;r<u;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],h[l++]=t>>16&255,h[l++]=t>>8&255,h[l++]=255&t;return 2===c&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,h[l++]=255&t),1===c&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,h[l++]=t>>8&255,h[l++]=255&t),h},t.fromByteArray=function(e){for(var t,n=e.length,s=n%3,i=[],o=16383,a=0,h=n-s;a<h;a+=o)i.push(c(e,a,a+o>h?h:a+o));return 1===s?(t=e[n-1],i.push(r[t>>2]+r[t<<4&63]+"==")):2===s&&(t=(e[n-2]<<8)+e[n-1],i.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),i.join("")};for(var r=[],n=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0;o<64;++o)r[o]=i[o],n[i.charCodeAt(o)]=o;function a(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function c(e,t,n){for(var s,i,o=[],a=t;a<n;a+=3)s=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(r[(i=s)>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return o.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},1924:(e,t,r)=>{"use strict";var n=r(210),s=r(5559),i=s(n("String.prototype.indexOf"));e.exports=function(e,t){var r=n(e,!!t);return"function"==typeof r&&i(e,".prototype.")>-1?s(r):r}},5559:(e,t,r)=>{"use strict";var n=r(2514),s=r(210),i=r(7771),o=s("%TypeError%"),a=s("%Function.prototype.apply%"),c=s("%Function.prototype.call%"),h=s("%Reflect.apply%",!0)||n.call(c,a),l=s("%Object.defineProperty%",!0),u=s("%Math.max%");if(l)try{l({},"a",{value:1})}catch(e){l=null}e.exports=function(e){if("function"!=typeof e)throw new o("a function is required");var t=h(n,c,arguments);return i(t,1+u(0,e.length-(arguments.length-1)),!0)};var d=function(){return h(n,a,arguments)};l?l(e.exports,"apply",{value:d}):e.exports.apply=d},4098:function(e,t){var r="undefined"!=typeof self?self:this,n=function(){function e(){this.fetch=!1,this.DOMException=r.DOMException}return e.prototype=r,new e}();!function(e){!function(t){var r="URLSearchParams"in e,n="Symbol"in e&&"iterator"in Symbol,s="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),i="FormData"in e,o="ArrayBuffer"in e;if(o)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],c=ArrayBuffer.isView||function(e){return e&&a.indexOf(Object.prototype.toString.call(e))>-1};function h(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function l(e){return"string"!=typeof e&&(e=String(e)),e}function u(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function d(e){this.map={},e instanceof d?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function p(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function g(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function m(e){var t=new FileReader,r=g(t);return t.readAsArrayBuffer(e),r}function f(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function y(){return this.bodyUsed=!1,this._initBody=function(e){var t;this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:s&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:i&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:r&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():o&&s&&(t=e)&&DataView.prototype.isPrototypeOf(t)?(this._bodyArrayBuffer=f(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):o&&(ArrayBuffer.prototype.isPrototypeOf(e)||c(e))?this._bodyArrayBuffer=f(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},s&&(this.blob=function(){var e=p(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?p(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(m)}),this.text=function(){var e,t,r,n=p(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,r=g(t=new FileReader),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(S)}),this.json=function(){return this.text().then(JSON.parse)},this}d.prototype.append=function(e,t){e=h(e),t=l(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},d.prototype.delete=function(e){delete this.map[h(e)]},d.prototype.get=function(e){return e=h(e),this.has(e)?this.map[e]:null},d.prototype.has=function(e){return this.map.hasOwnProperty(h(e))},d.prototype.set=function(e,t){this.map[h(e)]=l(t)},d.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},d.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),u(e)},d.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),u(e)},d.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),u(e)},n&&(d.prototype[Symbol.iterator]=d.prototype.entries);var v=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function b(e,t){var r,n,s=(t=t||{}).body;if(e instanceof b){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new d(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,s||null==e._bodyInit||(s=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new d(t.headers)),this.method=(n=(r=t.method||this.method||"GET").toUpperCase(),v.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&s)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(s)}function S(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),s=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(s))}})),t}function w(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new d(t.headers),this.url=t.url||"",this._initBody(e)}b.prototype.clone=function(){return new b(this,{body:this._bodyInit})},y.call(b.prototype),y.call(w.prototype),w.prototype.clone=function(){return new w(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},w.error=function(){var e=new w(null,{status:0,statusText:""});return e.type="error",e};var x=[301,302,303,307,308];w.redirect=function(e,t){if(-1===x.indexOf(t))throw new RangeError("Invalid status code");return new w(null,{status:t,headers:{location:e}})},t.DOMException=e.DOMException;try{new t.DOMException}catch(e){t.DOMException=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function C(e,r){return new Promise((function(n,i){var o=new b(e,r);if(o.signal&&o.signal.aborted)return i(new t.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function c(){a.abort()}a.onload=function(){var e,t,r={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new d,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var s=r.join(":").trim();t.append(n,s)}})),t)};r.url="responseURL"in a?a.responseURL:r.headers.get("X-Request-URL");var s="response"in a?a.response:a.responseText;n(new w(s,r))},a.onerror=function(){i(new TypeError("Network request failed"))},a.ontimeout=function(){i(new TypeError("Network request failed"))},a.onabort=function(){i(new t.DOMException("Aborted","AbortError"))},a.open(o.method,o.url,!0),"include"===o.credentials?a.withCredentials=!0:"omit"===o.credentials&&(a.withCredentials=!1),"responseType"in a&&s&&(a.responseType="blob"),o.headers.forEach((function(e,t){a.setRequestHeader(t,e)})),o.signal&&(o.signal.addEventListener("abort",c),a.onreadystatechange=function(){4===a.readyState&&o.signal.removeEventListener("abort",c)}),a.send(void 0===o._bodyInit?null:o._bodyInit)}))}C.polyfill=!0,e.fetch||(e.fetch=C,e.Headers=d,e.Request=b,e.Response=w),t.Headers=d,t.Request=b,t.Response=w,t.fetch=C,Object.defineProperty(t,"__esModule",{value:!0})}({})}(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var s=n;(t=s.fetch).default=s.fetch,t.fetch=s.fetch,t.Headers=s.Headers,t.Request=s.Request,t.Response=s.Response,e.exports=t},2296:(e,t,r)=>{"use strict";var n=r(3596)(),s=r(210),i=n&&s("%Object.defineProperty%",!0);if(i)try{i({},"a",{value:1})}catch(e){i=!1}var o=s("%SyntaxError%"),a=s("%TypeError%"),c=r(7296);e.exports=function(e,t,r){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new a("`obj` must be an object or a function`");if("string"!=typeof t&&"symbol"!=typeof t)throw new a("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new a("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new a("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new a("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new a("`loose`, if provided, must be a boolean");var n=arguments.length>3?arguments[3]:null,s=arguments.length>4?arguments[4]:null,h=arguments.length>5?arguments[5]:null,l=arguments.length>6&&arguments[6],u=!!c&&c(e,t);if(i)i(e,t,{configurable:null===h&&u?u.configurable:!h,enumerable:null===n&&u?u.enumerable:!n,value:r,writable:null===s&&u?u.writable:!s});else{if(!l&&(n||s||h))throw new o("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");e[t]=r}}},7237:e=>{"use strict";function t(e){if(this._capacity=n(e),this._length=0,this._front=0,r(e)){for(var t=e.length,s=0;s<t;++s)this[s]=e[s];this._length=t}}t.prototype.toArray=function(){for(var e=this._length,t=new Array(e),r=this._front,n=this._capacity,s=0;s<e;++s)t[s]=this[r+s&n-1];return t},t.prototype.push=function(e){var t=arguments.length,r=this._length;if(t>1){var n=this._capacity;if(r+t>n){for(var s=0;s<t;++s)this._checkCapacity(r+1),this[i=this._front+r&this._capacity-1]=arguments[s],r++,this._length=r;return r}var i=this._front;for(s=0;s<t;++s)this[i+r&n-1]=arguments[s],i++;return this._length=r+t,r+t}return 0===t?r:(this._checkCapacity(r+1),this[s=this._front+r&this._capacity-1]=e,this._length=r+1,r+1)},t.prototype.pop=function(){var e=this._length;if(0!==e){var t=this._front+e-1&this._capacity-1,r=this[t];return this[t]=void 0,this._length=e-1,r}},t.prototype.shift=function(){var e=this._length;if(0!==e){var t=this._front,r=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length=e-1,r}},t.prototype.unshift=function(e){var t=this._length,r=arguments.length;if(r>1){if(t+r>(s=this._capacity)){for(var n=r-1;n>=0;n--){this._checkCapacity(t+1);var s=this._capacity;this[o=(this._front-1&s-1^s)-s]=arguments[n],t++,this._length=t,this._front=o}return t}var i=this._front;for(n=r-1;n>=0;n--){var o;this[o=(i-1&s-1^s)-s]=arguments[n],i=o}return this._front=i,this._length=t+r,t+r}return 0===r?t:(this._checkCapacity(t+1),s=this._capacity,this[n=(this._front-1&s-1^s)-s]=e,this._length=t+1,this._front=n,t+1)},t.prototype.peekBack=function(){var e=this._length;if(0!==e)return this[this._front+e-1&this._capacity-1]},t.prototype.peekFront=function(){if(0!==this._length)return this[this._front]},t.prototype.get=function(e){var t=e;if(t===(0|t)){var r=this._length;if(t<0&&(t+=r),!(t<0||t>=r))return this[this._front+t&this._capacity-1]}},t.prototype.isEmpty=function(){return 0===this._length},t.prototype.clear=function(){for(var e=this._length,t=this._front,r=this._capacity,n=0;n<e;++n)this[t+n&r-1]=void 0;this._length=0,this._front=0},t.prototype.toString=function(){return this.toArray().toString()},t.prototype.valueOf=t.prototype.toString,t.prototype.removeFront=t.prototype.shift,t.prototype.removeBack=t.prototype.pop,t.prototype.insertFront=t.prototype.unshift,t.prototype.insertBack=t.prototype.push,t.prototype.enqueue=t.prototype.push,t.prototype.dequeue=t.prototype.shift,t.prototype.toJSON=t.prototype.toArray,Object.defineProperty(t.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}}),t.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(n(1.5*this._capacity+16))},t.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var r=this._front,n=this._length;r+n>t&&function(e,t,r,n,s){for(var i=0;i<s;++i)r[i+n]=e[i+0],e[i+0]=void 0}(this,0,this,t,r+n&t-1)};var r=Array.isArray;function n(e){if("number"!=typeof e){if(!r(e))return 16;e=e.length}return t=Math.min(Math.max(16,e),1073741824),t>>>=0,t-=1,t|=t>>1,t|=t>>2,t|=t>>4,1+((t|=t>>8)|t>>16);var t}e.exports=t},7187:e=>{"use strict";var t,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function i(){i.init.call(this)}e.exports=i,e.exports.once=function(e,t){return new Promise((function(r,n){function s(r){e.removeListener(t,i),n(r)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",s),r([].slice.call(arguments))}m(e,t,i,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&m(e,"error",t,{once:!0})}(e,s)}))},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var o=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function h(e,t,r,n){var s,i,o,h;if(a(r),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),i=e._events),o=i[t]),void 0===o)o=i[t]=r,++e._eventsCount;else if("function"==typeof o?o=i[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),(s=c(e))>0&&o.length>s&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=o.length,h=l,console&&console.warn&&console.warn(h)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},s=l.bind(n);return s.listener=r,n.wrapFn=s,s}function d(e,t,r){var n=e._events;if(void 0===n)return[];var s=n[t];return void 0===s?[]:"function"==typeof s?r?[s.listener||s]:[s]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(s):g(s,s.length)}function p(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function g(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function m(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function s(i){n.once&&e.removeEventListener(t,s),r(i)}))}}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return c(this)},i.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var s="error"===e,i=this._events;if(void 0!==i)s=s&&void 0===i.error;else if(!s)return!1;if(s){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)n(c,this,t);else{var h=c.length,l=g(c,h);for(r=0;r<h;++r)n(l[r],this,t)}return!0},i.prototype.addListener=function(e,t){return h(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return h(this,e,t,!0)},i.prototype.once=function(e,t){return a(t),this.on(e,u(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,u(this,e,t)),this},i.prototype.removeListener=function(e,t){var r,n,s,i,o;if(a(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(s=-1,i=r.length-1;i>=0;i--)if(r[i]===t||r[i].listener===t){o=r[i].listener,s=i;break}if(s<0)return this;0===s?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,s),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var s,i=Object.keys(r);for(n=0;n<i.length;++n)"removeListener"!==(s=i[n])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},i.prototype.listeners=function(e){return d(this,e,!0)},i.prototype.rawListeners=function(e){return d(this,e,!1)},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},i.prototype.listenerCount=p,i.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},2580:(e,t,r)=>{"use strict";r.r(t),r.d(t,{AttachState:()=>n.mB,ConnectionState:()=>i.e,ContainerErrorType:()=>s.u,DOProviderContainerRuntimeFactory:()=>c.Y,DirectoryFactory:()=>u.y,DriverErrorType:()=>o.C,FluidContainer:()=>a.G,Interval:()=>te,IntervalCollection:()=>ge,IntervalCollectionIterator:()=>pe,IntervalType:()=>ee,LocalValueMaker:()=>d.oU,MapFactory:()=>l.c,PaddingSegment:()=>$t,RootDataObject:()=>c.i,RunSegment:()=>Jt,SequenceDeltaEvent:()=>kt,SequenceEvent:()=>Ft,SequenceInterval:()=>re,SequenceMaintenanceEvent:()=>Dt,ServiceAudience:()=>h.c,SharedDirectory:()=>u.u,SharedIntervalCollection:()=>cr,SharedIntervalCollectionFactory:()=>ar,SharedMap:()=>l.G,SharedNumberSequence:()=>Ut,SharedNumberSequenceFactory:()=>Kt,SharedObjectSequence:()=>zt,SharedObjectSequenceFactory:()=>Gt,SharedSegmentSequence:()=>Bt,SharedSequence:()=>Ht,SharedString:()=>Wt,SharedStringFactory:()=>Vt,SparseMatrix:()=>nr,SparseMatrixFactory:()=>sr,SubSequence:()=>_t,maxCellPosition:()=>er,maxCol:()=>Xt,maxCols:()=>Qt,maxRow:()=>Zt,maxRows:()=>Yt,positionToRowCol:()=>rr,rowColToPosition:()=>tr});var n=r(3738),s=r(7819),i=r(1434),o=r(2505),a=r(1),c=r(2434),h=r(9074),l=r(5759),u=r(7648),d=r(3080);function p(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}var g=r(7187);class m extends g.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}var f,y=r(9268);!function(e){e[e.Simple=0]="Simple",e[e.Tile=1]="Tile",e[e.NestBegin=2]="NestBegin",e[e.NestEnd=4]="NestEnd",e[e.RangeBegin=16]="RangeBegin",e[e.RangeEnd=32]="RangeEnd",e[e.SlideOnRemove=64]="SlideOnRemove",e[e.StayOnRemove=128]="StayOnRemove",e[e.Transient=256]="Transient"}(f||(f={}));const v={INSERT:0,REMOVE:1,ANNOTATE:2,GROUP:3},b="referenceRangeLabels";function S(e,t){return 0!=(("number"==typeof e?e:e.refType)&t)}const w=e=>S(e,f.Tile)&&e.properties?e.properties.referenceTileLabels:void 0,x=e=>S(e,f.NestBegin|f.NestEnd)&&e.properties?e.properties[b]:void 0;function C(e,t){const r=w(e);if(r)for(const e of r)if(t===e)return!0;return!1}function E(e,t){const r=x(e);if(r)for(const e of r)if(t===e)return!0;return!1}function A(e){return void 0!==w(e)}function T(e){return void 0!==x(e)}function O(e,t){const r=e.getSegment(),n=t.getSegment();return r===n?e.getOffset()-t.getOffset():void 0===r||void 0!==n&&r.ordinal<n.ordinal?-1:1}function N(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}const P=-1,R=-2,I=-1,F=-2;function k(e,t,r,n){let s=t;switch(void 0===s&&(s=e.defaultValue),e.name){case"incr":s+=r,e.minValue&&s<e.minValue&&(s=e.minValue);break;case"consensus":if(void 0===s)s={value:r,seq:n};else{const e=s;-1===e.seq&&(e.seq=n)}}return s}function D(e,t){if(e){if(!t)return!1;for(const r in e){if(void 0===t[r])return!1;if("object"==typeof t[r]){if(!D(e[r],t[r]))return!1}else if(t[r]!==e[r])return!1}for(const r in t)if(void 0===e[r])return!1}else if(t)return!1;return!0}function M(e,t,r,n){if(void 0!==t)for(const s in t){const i=t[s];null===i?delete e[s]:r&&"rewrite"!==r.name?e[s]=k(r,e[s],i,n):e[s]=i}return e}function q(e,t,r,n){let s=e;return(!s||r&&"rewrite"===r.name)&&(s=L()),M(s,t,r,n),s}function L(){return Object.create(null)}class B{constructor(){this.pendingRewriteCount=0}ackPendingProperties(e){var t,r;e.combiningOp&&"rewrite"===e.combiningOp.name&&this.pendingRewriteCount--;for(const n of Object.keys(e.props))void 0!==(null===(t=this.pendingKeyUpdateCount)||void 0===t?void 0:t[n])&&(N(this.pendingKeyUpdateCount[n]>0,92),this.pendingKeyUpdateCount[n]--,0===(null===(r=this.pendingKeyUpdateCount)||void 0===r?void 0:r[n])&&delete this.pendingKeyUpdateCount[n])}addProperties(e,t,r,n,s=!1){var i;if(this.pendingKeyUpdateCount||(this.pendingKeyUpdateCount=L()),this.pendingRewriteCount>0&&n!==P&&s)return;const o=r&&"rewrite"===r.name,a=o?void 0:r||void 0,c=e=>{var t;return!(n!==P&&void 0!==(null===(t=this.pendingKeyUpdateCount)||void 0===t?void 0:t[e])&&!a)},h={};if(o){s&&n===P&&this.pendingRewriteCount++;for(const r of Object.keys(e))!t[r]&&c(r)&&(h[r]=e[r],delete e[r])}for(const r of Object.keys(t)){if(s)if(n===P)void 0===(null===(i=this.pendingKeyUpdateCount)||void 0===i?void 0:i[r])&&(this.pendingKeyUpdateCount[r]=0),this.pendingKeyUpdateCount[r]++;else if(!c(r))continue;const o=e[r];let l;h[r]=void 0===o?null:o,l=a?k(a,o,l,n):t[r],null===l?delete e[r]:e[r]=l}return h}copyTo(e,t,r){if(e){if(t||(t=L()),!r)throw new Error("Must provide new PropertyManager");for(const r of Object.keys(e))t[r]=e[r];r.pendingRewriteCount=this.pendingRewriteCount,r.pendingKeyUpdateCount=L();for(const e of Object.keys(this.pendingKeyUpdateCount))r.pendingKeyUpdateCount[e]=this.pendingKeyUpdateCount[e]}return t}hasPendingProperties(){return this.pendingRewriteCount>0||Object.keys(this.pendingKeyUpdateCount).length>0}}class j{constructor(){this.items=[]}push(e){this.items.push(e)}empty(){return 0===this.items.length}top(){return this.items[this.items.length-1]}pop(){return this.items.pop()}}function _(e){if(void 0!==e&&!e.isHead)return e.next.prev=e.prev,e.prev.next=e.next,e}function H(e){return new z(!1,e)}function U(){return new z(!0,void 0)}class z{constructor(e,t){this.isHead=e,this.data=t,this.prev=this,this.next=this}clear(){this.isHead&&(this.prev=this,this.next=this)}add(e){const t=H(e);return this.prev.next=t,t.next=this,t.prev=this.prev,this.prev=t,t}dequeue(){if(!this.empty())return _(this.next).data}enqueue(e){return this.add(e)}walk(e){for(let t=this.next;!t.isHead;t=t.next)e(t.data,t)}some(e,t){const r=[];for(let n=t?this.prev:this.next;!n.isHead;n=t?n.prev:n.next){const s=n.data;e(s,n)&&(t?r.unshift(s):r.push(s))}return r}count(){let e,t;for(e=this.next,t=0;!e.isHead;t++)e=e.next;return t}first(){if(!this.empty())return this.next.data}last(){if(!this.empty())return this.prev.data}empty(){return this.next===this}push(e){this.unshift(e)}unshift(e){const t=H(e);t.data=e,t.isHead=!1,t.next=this.next,t.prev=this,this.next=t,t.next.prev=t}[Symbol.iterator](){let e=this;return{next(){for(;e&&!1===e.next.isHead;)if(e=e.next,void 0!==e.data)return{value:e.data,done:!1};return{value:void 0,done:!0}},[Symbol.iterator](){return this}}}}class V{constructor(e,t){this.comp=t,this.L=[t.min];for(let t=0,r=e.length;t<r;t++)this.add(e[t])}count(){return this.L.length-1}peek(){return this.L[1]}get(){const e=this.L[1];return this.L[1]=this.L[this.count()],this.L.pop(),this.fixDown(1),e}add(e){this.L.push(e),this.fixup(this.count())}fixup(e){let t=e;for(;t>1&&this.comp.compare(this.L[t>>1],this.L[t])>0;){const e=this.L[t>>1];this.L[t>>1]=this.L[t],this.L[t]=e,t>>=1}}fixDown(e){let t=e;for(;t<<1<=this.count();){let e=t<<1;if(e<this.count()&&this.comp.compare(this.L[e],this.L[e+1])>0&&e++,this.comp.compare(this.L[t],this.L[e])<=0)break;const r=this.L[t];this.L[t]=this.L[e],this.L[e]=r,t=e}}}class G{constructor(e,t){this.compareKeys=e,this.aug=t}makeNode(e,t,r,n){return{key:e,data:t,color:r,size:n}}isRed(e){return!!e&&0===e.color}nodeSize(e){return e?e.size:0}size(){return this.nodeSize(this.root)}isEmpty(){return!this.root}get(e){if(void 0!==e)return this.nodeGet(this.root,e)}nodeGet(e,t){let r=e;for(;r;){const e=this.compareKeys(t,r.key);if(e<0)r=r.left;else{if(!(e>0))return r;r=r.right}}}contains(e){return this.get(e)}gather(e,t){const r=[];return void 0!==e&&this.nodeGather(this.root,r,e,t),r}nodeGather(e,t,r,n){e&&(n.continueSubtree(e.left,r)&&this.nodeGather(e.left,t,r,n),n.matchNode(e,r)&&t.push(e),n.continueSubtree(e.right,r)&&this.nodeGather(e.right,t,r,n))}walkExactMatchesForward(e,t,r,n){this.nodeWalkExactMatchesForward(this.root,e,t,r,n)}nodeWalkExactMatchesForward(e,t,r,n,s){if(!e)return;const i=t(e);n(i)&&this.nodeWalkExactMatchesForward(e.left,t,r,n,s),0===i&&r(e),s(i)&&this.nodeWalkExactMatchesForward(e.right,t,r,n,s)}walkExactMatchesBackward(e,t,r,n){this.nodeWalkExactMatchesBackward(this.root,e,t,r,n)}nodeWalkExactMatchesBackward(e,t,r,n,s){if(!e)return;const i=t(e);s(i)&&this.nodeWalkExactMatchesBackward(e.right,t,r,n,s),0===i&&r(e),n(i)&&this.nodeWalkExactMatchesBackward(e.left,t,r,n,s)}put(e,t,r){void 0!==e&&(void 0===t?this.remove(e):(this.root=this.nodePut(this.root,e,t,r),this.root.color=1))}nodePut(e,t,r,n){let s=e;if(s){const e=this.compareKeys(t,s.key);if(e<0)s.left=this.nodePut(s.left,t,r,n);else if(e>0)s.right=this.nodePut(s.right,t,r,n);else if(n){const e=n(t,s.key,r,s.data);e.key&&(s.key=e.key),e.data?s.data=e.data:s.data=r}else s.data=r;return this.isRed(s.right)&&!this.isRed(s.left)&&(s=this.rotateLeft(s)),this.isRed(s.left)&&this.isRed(s.left.left)&&(s=this.rotateRight(s)),this.isRed(s.left)&&this.isRed(s.right)&&this.flipColors(s),s.size=this.nodeSize(s.left)+this.nodeSize(s.right)+1,this.aug&&this.updateLocal(s),s}return this.makeNode(t,r,0,1)}updateLocal(e){this.aug&&(this.isRed(e.left)&&this.aug.update(e.left),this.isRed(e.right)&&this.aug.update(e.right),this.aug.update(e))}nodeRemoveMin(e){let t=e;if(t.left)return this.isRed(t.left)||this.isRed(t.left.left)||(t=this.moveRedLeft(t)),t.left=this.nodeRemoveMin(t.left),this.balance(t)}remove(e){if(void 0!==e){if(!this.contains(e))return;this.removeExisting(e)}}removeExisting(e){this.isRed(this.root.left)||this.isRed(this.root.right)||(this.root.color=0),this.root=this.nodeRemove(this.root,e)}nodeRemove(e,t){let r=e;if(this.compareKeys(t,r.key)<0)this.isRed(r.left)||this.isRed(r.left.left)||(r=this.moveRedLeft(r)),r.left=this.nodeRemove(r.left,t);else{if(this.isRed(r.left)&&(r=this.rotateRight(r)),0===this.compareKeys(t,r.key)&&!r.right)return;if(this.isRed(r.right)||this.isRed(r.right.left)||(r=this.moveRedRight(r)),0===this.compareKeys(t,r.key)){const e=this.nodeMin(r.right);r.key=e.key,r.data=e.data,r.right=this.nodeRemoveMin(r.right)}else r.right=this.nodeRemove(r.right,t)}return this.balance(r)}floor(e){if(!this.isEmpty())return this.nodeFloor(this.root,e)}nodeFloor(e,t){if(e){const r=this.compareKeys(t,e.key);if(0===r)return e;if(r<0)return this.nodeFloor(e.left,t);return this.nodeFloor(e.right,t)||e}}ceil(e){if(!this.isEmpty())return this.nodeCeil(this.root,e)}nodeCeil(e,t){if(e){const r=this.compareKeys(t,e.key);if(0===r)return e;if(r>0)return this.nodeCeil(e.right,t);return this.nodeCeil(e.left,t)||e}}min(){if(this.root)return this.nodeMin(this.root)}nodeMin(e){return e.left?this.nodeMin(e.left):e}max(){if(this.root)return this.nodeMax(this.root)}nodeMax(e){return e.right?this.nodeMax(e.right):e}rotateRight(e){const t=e.left;return e.left=t.right,t.right=e,t.color=t.right.color,t.right.color=0,t.size=e.size,e.size=this.nodeSize(e.left)+this.nodeSize(e.right)+1,this.aug&&(this.updateLocal(e),this.updateLocal(t)),t}rotateLeft(e){const t=e.right;return e.right=t.left,t.left=e,t.color=t.left.color,t.left.color=0,t.size=e.size,e.size=this.nodeSize(e.left)+this.nodeSize(e.right)+1,this.aug&&(this.updateLocal(e),this.updateLocal(t)),t}oppositeColor(e){return 1===e?0:1}flipColors(e){e.color=this.oppositeColor(e.color),e.left.color=this.oppositeColor(e.left.color),e.right.color=this.oppositeColor(e.right.color)}moveRedLeft(e){let t=e;return this.flipColors(t),this.isRed(t.right.left)&&(t.right=this.rotateRight(t.right),t=this.rotateLeft(t),this.flipColors(t)),t}moveRedRight(e){let t=e;return this.flipColors(t),this.isRed(t.left.left)&&(t=this.rotateRight(t),this.flipColors(t)),t}balance(e){let t=e;return this.isRed(t.right)&&(t=this.rotateLeft(t)),this.isRed(t.left)&&this.isRed(t.left.left)&&(t=this.rotateRight(t)),this.isRed(t.left)&&this.isRed(t.right)&&this.flipColors(t),t.size=this.nodeSize(t.left)+this.nodeSize(t.right)+1,this.aug&&this.aug.update(t),t}mapRange(e,t,r,n){this.nodeMap(this.root,e,r,n)}map(e,t){this.nodeMap(this.root,e,t)}keys(){const e=[],t={showStructure:!0,infix:t=>(e.push(t.key),!0)};return this.walk(t),e}walk(e){this.nodeWalk(this.root,e)}walkBackward(e){this.nodeWalkBackward(this.root,e)}nodeWalk(e,t){let r=!0;return e&&(t.pre&&(t.showStructure||1===e.color)&&(r=t.pre(e)),e.left&&(r=this.nodeWalk(e.left,t)),r&&t.infix&&(t.showStructure||1===e.color)&&(r=t.infix(e)),r&&(r=this.nodeWalk(e.right,t)),r&&t.post&&(t.showStructure||1===e.color)&&(r=t.post(e))),r}nodeWalkBackward(e,t){let r=!0;return e&&(t.pre&&(t.showStructure||1===e.color)&&(r=t.pre(e)),e.right&&(r=this.nodeWalkBackward(e.right,t)),r&&t.infix&&(t.showStructure||1===e.color)&&(r=t.infix(e)),r&&(r=this.nodeWalkBackward(e.left,t)),r&&t.post&&(t.showStructure||1===e.color)&&(r=t.post(e))),r}nodeMap(e,t,r,n,s){let i=n,o=s;if(!e)return!0;void 0===i&&(i=this.nodeMin(e).key),void 0===o&&(o=this.nodeMax(e).key);const a=this.compareKeys(i,e.key),c=this.compareKeys(o,e.key);let h=!0;return a<0&&(h=this.nodeMap(e.left,t,r,i,o)),h&&a<=0&&c>=0&&(h=t(e,r)),h&&c>0&&(h=this.nodeMap(e.right,t,r,i,o)),h}}const K=(e,t)=>e.compare(t);class W{constructor(){this.intervals=new G(K,this)}remove(e){this.intervals.remove(e)}removeExisting(e){this.intervals.removeExisting(e)}put(e,t){let r;t&&(r=(e,r)=>({key:t(e,r)})),this.intervals.put(e,{minmax:e.clone()},r)}map(e){const t={infix:t=>(e(t.key),!0),showStructure:!0};this.intervals.walk(t)}mapUntil(e){const t={infix:t=>e(t.key),showStructure:!0};this.intervals.walk(t)}mapBackward(e){const t={infix:t=>(e(t.key),!0),showStructure:!0};this.intervals.walkBackward(t)}match(e){return this.intervals.gather(e,this)}matchNode(e,t){return!!e&&e.key.overlaps(t)}continueSubtree(e,t){return!!e&&e.data.minmax.overlaps(t)}update(e){e.left&&e.right?e.data.minmax=e.key.union(e.left.data.minmax.union(e.right.data.minmax)):e.left?e.data.minmax=e.key.union(e.left.data.minmax):e.right?e.data.minmax=e.key.union(e.right.data.minmax):e.data.minmax=e.key.clone()}}class ${constructor(e,t,r=0,n=f.Simple,s){this.client=e,this.offset=r,this.refType=n,function(e){let t=0;if(S(e,f.Transient)&&++t,S(e,f.SlideOnRemove)&&++t,S(e,f.StayOnRemove)&&++t,t>1)throw new y.Oi("Reference types can only be one of Transient, SlideOnRemove, and StayOnRemove")}(n),this.segment=t,this.properties=s}min(e){return function(e,t){return O(e,t)<0?e:t}(this,e)}max(e){return function(e,t){return O(e,t)>0?e:t}(this,e)}compare(e){return O(this,e)}toPosition(){return this.getClient().localReferencePositionToPosition(this)}hasTileLabels(){return A(this)}hasRangeLabels(){return T(this)}hasTileLabel(e){return C(this,e)}hasRangeLabel(e){return E(this,e)}getTileLabels(){return w(this)}getRangeLabels(){return x(this)}isLeaf(){return!1}addProperties(e,t){this.properties=q(this.properties,e,t)}getClient(){return this.client}getSegment(){return this.segment}getOffset(){return this.offset}getProperties(){return this.properties}}function J(e){N(e instanceof $,736)}$.DetachedPosition=-1;class X{constructor(e,t=new Array(e.cachedLength)){this.segment=e,this.hierRefCount=0,this.refCount=0,this.refsByOffset=t}static append(e,t){t.localRefs&&!t.localRefs.empty?(e.localRefs||(e.localRefs=new X(e)),N(e.localRefs.refsByOffset.length===e.cachedLength,702),e.localRefs.append(t.localRefs)):e.localRefs&&(e.localRefs.refsByOffset.length+=t.cachedLength)}[Symbol.iterator](){const e=[];for(const t of this.refsByOffset)t&&(t.before&&e.push(t.before[Symbol.iterator]()),t.at&&e.push(t.at[Symbol.iterator]()),t.after&&e.push(t.after[Symbol.iterator]()));return{next(){for(;e.length>0;){const t=e[0].next();if(!0!==t.done)return t;e.shift()}return{value:void 0,done:!0}},[Symbol.iterator](){return this}}}clear(){this.refCount=0,this.hierRefCount=0;const e=e=>{if(e)for(const t of e)t.segment===this.segment&&(t.segment=void 0)};for(let t=0;t<this.refsByOffset.length;t++){const r=this.refsByOffset[t];r&&(e(r.before),e(r.at),e(r.before),this.refsByOffset[t]=void 0)}}get empty(){return 0===this.refCount}createLocalRef(e,t,r,n){const s=new $(n,this.segment,e,t,r);return S(s,f.Transient)||this.addLocalRef(s),s}addLocalRef(e){var t,r;N(!S(e,f.Transient),735),J(e);const n=this.refsByOffset[e.offset]=null!==(t=this.refsByOffset[e.offset])&&void 0!==t?t:{at:U()};(n.at=null!==(r=n.at)&&void 0!==r?r:U()).enqueue(e),(T(e)||A(e))&&this.hierRefCount++,this.refCount++}removeLocalRef(e){J(e);const t=t=>{if(t){let r=t;do{if(r=r.next,r.data===e)return _(r),(T(e)||A(e))&&this.hierRefCount--,this.refCount--,e}while(!r.isHead)}},r=this.refsByOffset[e.offset];if(void 0!==r){let e=t(r.before);if(e)return e;if(e=t(r.at),e)return e;if(e=t(r.after),e)return e}}append(e){if(e&&!e.empty){this.hierRefCount+=e.hierRefCount,this.refCount+=e.refCount,e.hierRefCount=0;for(const t of e)t.segment=this.segment,t.offset+=this.refsByOffset.length;this.refsByOffset.push(...e.refsByOffset)}}split(e,t){if(this.empty)this.refsByOffset.length=e;else{const r=new X(t,this.refsByOffset.splice(e,this.refsByOffset.length-e));t.localRefs=r;for(const n of r)n.segment=t,n.offset-=e,(T(n)||A(n))&&(this.hierRefCount--,r.hierRefCount++),this.refCount--,r.refCount++}}addBeforeTombstones(...e){var t,r,n,s,i;const o=null!==(r=null===(t=this.refsByOffset[0])||void 0===t?void 0:t.before)&&void 0!==r?r:U();for(const t of e)for(const e of t)J(e),S(e,f.SlideOnRemove)?(o.push(e),e.segment=this.segment,e.offset=0,(T(e)||A(e))&&this.hierRefCount++,this.refCount++):e.segment=void 0;if(!o.empty()&&void 0===(null===(n=this.refsByOffset[0])||void 0===n?void 0:n.before)){const e=this.refsByOffset[0]=null!==(s=this.refsByOffset[0])&&void 0!==s?s:{before:o};e.before=null!==(i=e.before)&&void 0!==i?i:o}}addAfterTombstones(...e){var t,r,n,s,i;const o=this.refsByOffset.length-1,a=null!==(r=null===(t=this.refsByOffset[o])||void 0===t?void 0:t.after)&&void 0!==r?r:U();for(const t of e)for(const e of t)J(e),S(e,f.SlideOnRemove)?(a.push(e),e.segment=this.segment,e.offset=this.segment.cachedLength-1,(T(e)||A(e))&&this.hierRefCount++,this.refCount++):e.segment=void 0;if(!a.empty()&&void 0===(null===(n=this.refsByOffset[o])||void 0===n?void 0:n.after)){const e=this.refsByOffset[o]=null!==(s=this.refsByOffset[o])&&void 0!==s?s:{after:a};e.after=null!==(i=e.after)&&void 0!==i?i:a}}}var Q=r(2718),Z=r(2045);const Y="intervalId";var ee;!function(e){e[e.Simple=0]="Simple",e[e.Nest=1]="Nest",e[e.SlideOnRemove=2]="SlideOnRemove",e[e.Transient=4]="Transient"}(ee||(ee={}));class te{constructor(e,t,r){this.start=e,this.end=t,this.propertyManager=new B,this.properties={},r&&this.addProperties(r)}getIntervalId(){var e;const t=null===(e=this.properties)||void 0===e?void 0:e[Y];if(void 0!==t)return`${t}`}getAdditionalPropertySets(){return this.auxProps}addPropertySet(e){void 0===this.auxProps&&(this.auxProps=[]),this.auxProps.push(e)}serialize(e){let t=0;e&&(t=e.getCurrentSeq());const r={end:this.end,intervalType:0,sequenceNumber:t,start:this.start};return this.properties&&(r.properties=this.properties),r}clone(){return new te(this.start,this.end,this.properties)}compare(e){const t=this.compareStart(e);if(0===t){const t=this.compareEnd(e);if(0===t){const t=this.getIntervalId();if(t){const r=e.getIntervalId();return r?t>r?1:t<r?-1:0:0}return 0}return t}return t}compareStart(e){return this.start-e.start}compareEnd(e){return this.end-e.end}overlaps(e){return this.start<=e.end&&this.end>=e.start}union(e){return new te(Math.min(this.start,e.start),Math.max(this.end,e.end),this.properties)}getProperties(){return this.properties}addProperties(e,t=!1,r,n){if(e)return this.initializeProperties(),this.propertyManager.addProperties(this.properties,e,n,r,t)}modify(e,t,r,n){const s=null!=t?t:this.start,i=null!=r?r:this.end;if(this.start===s&&this.end===i)return;const o=new te(s,i);return this.properties&&(o.initializeProperties(),this.propertyManager.copyTo(this.properties,o.properties,o.propertyManager)),o}initializeProperties(){this.propertyManager||(this.propertyManager=new B),this.properties||(this.properties=L())}}class re{constructor(e,t,r,n){this.start=e,this.end=t,this.intervalType=r,this.propertyManager=new B,this.properties={},n&&this.addProperties(n)}addPositionChangeListeners(e,t){var r,n,s,i;if(void 0===this.callbacks){this.callbacks={beforePositionChange:e,afterPositionChange:t};const o=null!==(r=(s=this.start).callbacks)&&void 0!==r?r:s.callbacks={},a=null!==(n=(i=this.end).callbacks)&&void 0!==n?n:i.callbacks={};o.beforeSlide=a.beforeSlide=e,o.afterSlide=a.afterSlide=t}}removePositionChangeListeners(){this.callbacks&&(this.callbacks=void 0,this.start.callbacks=void 0,this.end.callbacks=void 0)}serialize(e){const t=this.start.toPosition(),r={end:this.end.toPosition(),intervalType:this.intervalType,sequenceNumber:e.getCurrentSeq(),start:t};return this.properties&&(r.properties=this.properties),r}clone(){return new re(this.start,this.end,this.intervalType,this.properties)}compare(e){const t=this.compareStart(e);if(0===t){const t=this.compareEnd(e);if(0===t){const t=this.getIntervalId();if(t){const r=e.getIntervalId();return r?t>r?1:t<r?-1:0:0}return 0}return t}return t}compareStart(e){return this.start.compare(e.start)}compareEnd(e){return this.end.compare(e.end)}overlaps(e){return this.start.compare(e.end)<=0&&this.end.compare(e.start)>=0}getIntervalId(){var e;const t=null===(e=this.properties)||void 0===e?void 0:e[Y];if(void 0!==t)return`${t}`}union(e){return new re(this.start.min(e.start),this.end.max(e.end),this.intervalType)}addProperties(e,t=!1,r,n){return this.initializeProperties(),this.propertyManager.addProperties(this.properties,e,n,r,t)}overlapsPos(e,t){const r=this.start.toPosition();return this.start.toPosition()>e&&r<t}modify(e,t,r,n){const s=e=>{let t=e;return void 0===n&&(t&=~f.SlideOnRemove,t|=f.StayOnRemove),t};let i=this.start;void 0!==t&&(i=se(this.start.getClient(),t,s(this.start.refType),n),i.addProperties(this.start.properties));let o=this.end;void 0!==r&&(o=se(this.end.getClient(),r,s(this.end.refType),n),o.addProperties(this.end.properties)),i.pairedRef=o,o.pairedRef=i;const a=new re(i,o,this.intervalType);return this.properties&&(a.initializeProperties(),this.propertyManager.copyTo(this.properties,a.properties,a.propertyManager)),a}initializeProperties(){this.propertyManager||(this.propertyManager=new B),this.properties||(this.properties=L())}}function ne(e,t,r,n){if(t.segment)return e.createLocalReferencePosition(t.segment,t.offset,r,void 0);if(!n&&!S(r,f.Transient))throw new y.Oi("Non-transient references need segment");return new $(e,void 0,0,r)}function se(e,t,r,n){let s;return n?(p(0!=(r&f.SlideOnRemove),757),s=e.getContainingSegment(t,n),s=e.getSlideToSegment(s)):(p(0==(r&f.SlideOnRemove),758),s=e.getContainingSegment(t)),ne(e,s,r,n)}function ie(e,t,r,n,s,i){let o=f.RangeBegin,a=f.RangeEnd;s===ee.Transient?(o=f.Transient,a=f.Transient):(s===ee.Nest&&(o=f.NestBegin,a=f.NestEnd),i?(o|=f.SlideOnRemove,a|=f.SlideOnRemove):(o|=f.StayOnRemove,a|=f.StayOnRemove));const c=se(n,t,o,i),h=se(n,r,a,i);c.pairedRef=h,h.pairedRef=c;const l={[b]:[e]};return c.addProperties(l),h.addProperties(l),new re(c,h,s,l)}class oe{constructor(e,t,r,n){this.client=e,this.label=t,this.helpers=r,this.onPositionChange=n,this.intervalTree=new W,this.intervalIdMap=new Map,this.endIntervalTree=new G(r.compareEnds)}addConflictResolver(e){this.conflictResolver=e,this.endConflictResolver=(t,r)=>{const n=e(t,r);return{data:n,key:n}}}map(e){this.intervalTree.map(e)}createLegacyId(e,t){return`${oe.legacyIdPrefix}${e}-${t}`}ensureSerializedId(e){var t;let r=null===(t=e.properties)||void 0===t?void 0:t[Y];if(void 0===r){r=this.createLegacyId(e.start,e.end);const t={[Y]:r};e.properties=q(e.properties,t)}return Object.defineProperty(e.properties,Y,{configurable:!1,enumerable:!0,writable:!1}),r}mapUntil(e){this.intervalTree.mapUntil(e)}gatherIterationResults(e,t,r,n){if(!this.intervalTree.intervals.isEmpty())if(void 0===r&&void 0===n)t?this.intervalTree.map((t=>{e.push(t)})):this.intervalTree.mapBackward((t=>{e.push(t)}));else{const s=this.helpers.create("transient",r,n,this.client,ee.Transient);if(void 0===r)t?this.intervalTree.map((t=>{0===s.compareEnd(t)&&e.push(t)})):this.intervalTree.mapBackward((t=>{0===s.compareEnd(t)&&e.push(t)}));else{const r=void 0===n?e=>s.compareStart(e.key):e=>s.compare(e.key),i=e=>e<=0,o=e=>e>=0,a=t=>{e.push(t.key)};t?this.intervalTree.intervals.walkExactMatchesForward(r,a,i,o):this.intervalTree.intervals.walkExactMatchesBackward(r,a,i,o)}}}findOverlappingIntervals(e,t){if(t<e||this.intervalTree.intervals.isEmpty())return[];const r=this.helpers.create("transient",e,t,this.client,ee.Transient);return this.intervalTree.match(r).map((e=>e.key))}previousInterval(e){const t=this.helpers.create("transient",e,e,this.client,ee.Transient),r=this.endIntervalTree.floor(t);if(r)return r.data}nextInterval(e){const t=this.helpers.create("transient",e,e,this.client,ee.Transient),r=this.endIntervalTree.ceil(t);if(r)return r.data}removeInterval(e,t){const r=this.helpers.create("transient",e,t,this.client,ee.Transient);return this.intervalTree.remove(r),this.endIntervalTree.remove(r),r}removeIntervalFromIndex(e){this.intervalTree.removeExisting(e),this.endIntervalTree.remove(e);const t=e.getIntervalId();p(void 0!==t,785),this.intervalIdMap.delete(t)}removeExistingInterval(e){this.removeIntervalFromIndex(e),this.removeIntervalListeners(e)}createInterval(e,t,r,n){return this.helpers.create(this.label,e,t,this.client,r,n)}addInterval(e,t,r,n,s){const i=this.createInterval(e,t,r,s);return i&&(i.properties||(i.properties=L()),n&&i.addProperties(n),void 0===i.properties[Y]&&(i.properties[Y]=(0,Z.Z)()),this.add(i)),i}addIntervalToIndex(e){const t=e.getIntervalId();p(void 0!==t,704),Object.defineProperty(e.properties,Y,{configurable:!1,enumerable:!0,writable:!1}),this.intervalTree.put(e,this.conflictResolver),this.endIntervalTree.put(e,e,this.endConflictResolver),this.intervalIdMap.set(t,e)}add(e){this.addIntervalToIndex(e),this.addIntervalListeners(e)}getIntervalById(e){return this.intervalIdMap.get(e)}changeInterval(e,t,r,n){const s=e.modify(this.label,t,r,n);return s&&(this.removeExistingInterval(e),this.add(s)),s}serialize(){const e=this.client,t=this.intervalTree.intervals.keys();return{label:this.label,intervals:t.map((t=>function(e){const{start:t,end:r,sequenceNumber:n,intervalType:s,properties:i}=e;return[t,r,n,s,Object.assign(Object.assign({},i),{[b]:void 0})]}(t.serialize(e)))),version:2}}addIntervalListeners(e){e instanceof re&&e.addPositionChangeListeners((()=>this.removeIntervalFromIndex(e)),(()=>{var t;this.addIntervalToIndex(e),null===(t=this.onPositionChange)||void 0===t||t.call(this,e)}))}removeIntervalListeners(e){e instanceof re&&e.removePositionChangeListeners()}}oe.legacyIdPrefix="legacy";const ae=(e,t)=>e.end.compare(t.end);class ce{get name(){return ce.Name}get factory(){return ce._factory}get ops(){return ce._ops}}ce.Name="sharedStringIntervalCollection",ce._factory=new class{load(e,t=[]){return new ge({compareEnds:ae,create:ie},!0,e,t)}store(e){return e.serializeInternal()}},ce._ops=de();const he=(e,t)=>e.end-t.end;function le(e,t,r,n){const s={};return e&&e.length>0&&(s[b]=[e]),new te(t,r,s)}class ue{get name(){return ue.Name}get factory(){return ue._factory}get ops(){return ue._ops}}function de(){const e=(e,t,r)=>{const{localSeq:n}=r,s=e.rebaseLocalInterval(t.opName,t.value,n);return{rebasedOp:Object.assign(Object.assign({},t),{value:s}),rebasedLocalOpMetadata:r}};return new Map([["add",{process:(e,t,r,n)=>{e.ackAdd(t,r,n)},rebase:e}],["delete",{process:(e,t,r,n)=>{e.ackDelete(t,r,n)},rebase:(e,t,r)=>({rebasedOp:t,rebasedLocalOpMetadata:r})}],["change",{process:(e,t,r,n)=>{e.ackChange(t,r,n)},rebase:e}]])}ue.Name="sharedIntervalCollection",ue._factory=new class{load(e,t=[]){const r=new ge({compareEnds:he,create:le},!1,e,t);return r.attachGraph(void 0,""),r}store(e){return e.serializeInternal()}},ue._ops=de();class pe{constructor(e,t=!0,r,n){this.results=[],this.index=0,e.gatherIterationResults(this.results,t,r,n)}next(){let e,t=!0;return this.index<this.results.length&&(e=this.results[this.index++],t=!1),{value:e,done:t}}}class ge extends m{constructor(e,t,r,n){super(),this.helpers=e,this.requiresClient=t,this.emitter=r,this.pendingChangesStart=new Map,this.pendingChangesEnd=new Map,Array.isArray(n)?this.savedSerializedIntervals=n:this.savedSerializedIntervals=n.intervals.map((e=>{return t=e,r=n.label,{start:t[0],end:t[1],sequenceNumber:t[2],intervalType:t[3],properties:Object.assign(Object.assign({},t[4]),{[b]:r})};var t,r}))}get attached(){return!!this.localCollection}attachGraph(e,t){if(this.attached)throw new Q.j4("Only supports one Sequence attach");if(void 0===e&&this.requiresClient)throw new Q.j4("Client required for this collection");if(this.client=e,this.localCollection=new oe(e,t,this.helpers,(e=>this.emit("changeInterval",e,!0,void 0))),this.savedSerializedIntervals)for(const e of this.savedSerializedIntervals)this.localCollection.ensureSerializedId(e),this.localCollection.addInterval(e.start,e.end,e.intervalType,e.properties);this.savedSerializedIntervals=void 0}getNextLocalSeq(){return++this.client.getCollabWindow().localSeq}getIntervalById(e){if(!this.attached)throw new Q.j4("attach must be called before accessing intervals");return this.localCollection.getIntervalById(e)}add(e,t,r,n){var s,i;if(!this.attached)throw new Q.j4("attach must be called prior to adding intervals");if(r&ee.Transient)throw new Q.j4("Can not add transient intervals");const o=this.localCollection.addInterval(e,t,r,n);if(o){const n={end:t,intervalType:r,properties:o.properties,sequenceNumber:null!==(i=null===(s=this.client)||void 0===s?void 0:s.getCurrentSeq())&&void 0!==i?i:0,start:e};this.emitter.emit("add",void 0,n,{localSeq:this.getNextLocalSeq()})}return this.emit("addInterval",o,!0,void 0),o}deleteExistingInterval(e,t,r){this.localCollection.removeExistingInterval(e),e&&(t?this.emitter.emit("delete",void 0,e.serialize(this.client),{localSeq:this.getNextLocalSeq()}):this.onDeserialize&&this.onDeserialize(e)),this.emit("deleteInterval",e,t,r)}removeIntervalById(e){const t=this.localCollection.getIntervalById(e);return t&&this.deleteExistingInterval(t,!0,void 0),t}changeProperties(e,t){if(!this.attached)throw new Q.j4("Attach must be called before accessing intervals");if("string"!=typeof e)throw new Q.j4("Change API requires an ID that is a string");if(!t)throw new Q.j4("changeProperties should be called with a property set");const r=this.getIntervalById(e);if(r){const e=r.addProperties(t,!0,P),n=r.serialize(this.client);n.start=void 0,n.end=void 0,n.properties=t,n.properties[Y]=r.getIntervalId(),this.emitter.emit("change",void 0,n,{localSeq:this.getNextLocalSeq()}),this.emit("propertyChanged",r,e)}this.emit("changeInterval",r,!0,void 0)}change(e,t,r){if(!this.attached)throw new Q.j4("Attach must be called before accessing intervals");if("string"!=typeof e)throw new Q.j4("Change API requires an ID that is a string");const n=this.getIntervalById(e);if(n){const s=this.localCollection.changeInterval(n,t,r),i=n.serialize(this.client);return i.start=t,i.end=r,i.properties={[Y]:n.getIntervalId()},this.emitter.emit("change",void 0,i,{localSeq:this.getNextLocalSeq()}),this.addPendingChange(e,i),this.emit("changeInterval",s,!0,void 0),s}}addPendingChange(e,t){void 0!==t.start&&this.addPendingChangeHelper(e,this.pendingChangesStart,t),void 0!==t.end&&this.addPendingChangeHelper(e,this.pendingChangesEnd,t)}addPendingChangeHelper(e,t,r){let n=t.get(e);n||(n=[],t.set(e,n)),n.push(r)}removePendingChange(e){var t;const r=null===(t=e.properties)||void 0===t?void 0:t[Y];void 0!==e.start&&this.removePendingChangeHelper(r,this.pendingChangesStart,e),void 0!==e.end&&this.removePendingChangeHelper(r,this.pendingChangesEnd,e)}removePendingChangeHelper(e,t,r){const n=t.get(e);if(n){const s=n.shift();if(0===n.length&&t.delete(e),(null==s?void 0:s.start)!==r.start||(null==s?void 0:s.end)!==r.end)throw new Q.j4("Mismatch in pending changes")}}hasPendingChangeStart(e){const t=this.pendingChangesStart.get(e);return t&&0!==t.length}hasPendingChangeEnd(e){const t=this.pendingChangesEnd.get(e);return t&&0!==t.length}changeInterval(e,t,r){return this.ackChange(e,t,r)}ackChange(e,t,r){var n,s,i,o;if(!this.attached)throw new Q.j4("Attach must be called before accessing intervals");let a;if(t){this.removePendingChange(e);const t=null===(n=e.properties)||void 0===n?void 0:n[Y];a=this.getIntervalById(t),a&&(null===(s=a.propertyManager)||void 0===s||s.ackPendingProperties({type:v.ANNOTATE,props:null!==(i=e.properties)&&void 0!==i?i:{}}),this.ackInterval(a,r))}else{const t=e.properties,n=Y,s=t[n],i=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]])}return r}(t,["symbol"==typeof n?n:n+""]);if(a=this.getIntervalById(s),a){let t,n;this.hasPendingChangeStart(s)||(t=e.start),this.hasPendingChangeEnd(s)||(n=e.end),void 0===t&&void 0===n||(a=null!==(o=this.localCollection.changeInterval(a,t,n,r))&&void 0!==o?o:a);const c=a.addProperties(i,!0,r.sequenceNumber);this.onDeserialize&&this.onDeserialize(a),this.emit("propertyChanged",a,c)}}a&&this.emit("changeInterval",a,t,r)}addConflictResolver(e){if(!this.attached)throw new Q.j4("attachSequence must be called");this.localCollection.addConflictResolver(e)}attachDeserializer(e){e&&(this.onDeserialize=e,this.localCollection.map((t=>{e(t)})))}rebaseLocalInterval(e,t,r){var n,s;if(!this.attached)throw new Q.j4("attachSequence must be called");const{start:i,end:o,intervalType:a,properties:c,sequenceNumber:h}=t,l=void 0===i?void 0:this.client.rebasePosition(i,h,r),u=void 0===o?void 0:this.client.rebasePosition(o,h,r),d=null==c?void 0:c[Y],p={start:l,end:u,intervalType:a,sequenceNumber:null!==(s=null===(n=this.client)||void 0===n?void 0:n.getCurrentSeq())&&void 0!==s?s:0,properties:c};return"change"===e&&(this.hasPendingChangeStart(d)||this.hasPendingChangeEnd(d))&&(this.removePendingChange(t),this.addPendingChange(d,p)),p}getSlideToSegment(e){const t={segment:e.segment,offset:e.offset},r=this.client.getSlideToSegment(t);return t.segment===r.segment&&t.offset===r.offset?void 0:r}setSlideOnRemove(e){let t=e.refType;t&=~f.StayOnRemove,t|=f.SlideOnRemove,e.refType=t}ackInterval(e,t){if(!(e instanceof re))return;if(!S(e.start,f.StayOnRemove)&&!S(e.end,f.StayOnRemove))return;const r=this.getSlideToSegment(e.start),n=this.getSlideToSegment(e.end),s=e.properties[Y],i=this.hasPendingChangeStart(s),o=this.hasPendingChangeEnd(s);i||this.setSlideOnRemove(e.start),o||this.setSlideOnRemove(e.end);const a=void 0!==r&&!i,c=void 0!==n&&!o;if(a||c){if(this.localCollection.removeExistingInterval(e),a){const n=e.start.properties;this.client.removeLocalReferencePosition(e.start),e.start=ne(this.client,r,e.start.refType,t),n&&e.start.addProperties(n)}if(c){const r=e.end.properties;this.client.removeLocalReferencePosition(e.end),e.end=ne(this.client,n,e.end.refType,t),r&&e.end.addProperties(r)}this.localCollection.add(e)}}addInternal(e,t,r){return this.ackAdd(e,t,r)}ackAdd(e,t,r){var n;if(t){const t=null===(n=e.properties)||void 0===n?void 0:n[Y],s=this.getIntervalById(t);return void(s&&this.ackInterval(s,r))}if(!this.attached)throw new Q.j4("attachSequence must be called");this.localCollection.ensureSerializedId(e);const s=this.localCollection.addInterval(e.start,e.end,e.intervalType,e.properties,r);return s&&this.onDeserialize&&this.onDeserialize(s),this.emit("addInterval",s,t,r),s}deleteInterval(e,t,r){return this.ackDelete(e,t,r)}ackDelete(e,t,r){if(t)return;if(!this.attached)throw new Q.j4("attach must be called prior to deleting intervals");const n=this.localCollection.ensureSerializedId(e),s=this.localCollection.getIntervalById(n);s&&this.deleteExistingInterval(s,t,r)}serializeInternal(){if(!this.attached)throw new Q.j4("attachSequence must be called");return this.localCollection.serialize()}[Symbol.iterator](){return new pe(this)}CreateForwardIteratorWithStartPosition(e){return new pe(this,!0,e)}CreateBackwardIteratorWithStartPosition(e){return new pe(this,!1,e)}CreateForwardIteratorWithEndPosition(e){return new pe(this,!0,void 0,e)}CreateBackwardIteratorWithEndPosition(e){return new pe(this,!1,void 0,e)}gatherIterationResults(e,t,r,n){this.attached&&this.localCollection.gatherIterationResults(e,t,r,n)}findOverlappingIntervals(e,t){if(!this.attached)throw new Q.j4("attachSequence must be called");return this.localCollection.findOverlappingIntervals(e,t)}map(e){if(!this.attached)throw new Q.j4("attachSequence must be called");this.localCollection.map(e)}previousInterval(e){if(!this.attached)throw new Q.j4("attachSequence must be called");return this.localCollection.previousInterval(e)}nextInterval(e){if(!this.attached)throw new Q.j4("attachSequence must be called");return this.localCollection.nextInterval(e)}}class me{constructor(e){this.segment=e,this.trackingGroups=new Set}link(e){e&&(this.trackingGroups.has(e)||this.trackingGroups.add(e),e.has(this.segment)||e.link(this.segment))}unlink(e){e.has(this.segment)&&e.unlink(this.segment),this.trackingGroups.delete(e)}copyTo(e){this.trackingGroups.forEach((t=>e.trackingCollection.link(t)))}get empty(){return 0===this.trackingGroups.size}matches(e){if(!e||this.trackingGroups.size!==e.trackingGroups.size)return!1;for(const t of this.trackingGroups.values())if(!e.trackingGroups.has(t))return!1;return!0}}function fe(e,t){let r=-1,n=0,s=e.length-1;for(;n<=s;){const i=n+Math.floor((s-n)/2);e[i].seq<=t?((r<0||e[r].seq<e[i].seq)&&(r=i),n=i+1):s=i-1}return r}class ye{constructor(e){this.minSeq=e,this.minLength=0,this.segmentCount=0,this.partialLengths=[],this.clientSeqNumbers=[]}static combine(e,t,r,n=!1){return ye.combineBranch(e,t,r,n)}static combineBranch(e,t,r,n=!1){let s,i=new ye(r.minSeq);function o(e){if(!e)return;const t=new G(De);return e.map((e=>(t.put(e.data.clientId,Object.assign({},e.data)),!0))),t}function a(e){const t=e.seq;let r=0;if(s){if(s.seq===e.seq)return s.seglen+=e.seglen,s.len+=e.seglen,void function(e,t){const r=e.overlapRemoveClients;r?t.overlapRemoveClients&&t.overlapRemoveClients.map((e=>{const t=r.get(e.key);return t?t.data.seglen+=e.data.seglen:r.put(e.data.clientId,Object.assign({},e.data)),!0})):e.overlapRemoveClients=o(t.overlapRemoveClients)}(s,e);r=s.len,i.addClientSeqNumberFromPartial(s)}s={clientId:e.clientId,len:r+e.seglen,overlapRemoveClients:o(e.overlapRemoveClients),seglen:e.seglen,seq:t},i.partialLengths.push(s)}ye.fromLeaves(i,t,r);const c=[];for(let s=0;s<t.childCount;s++){const i=t.children[s];if(!i.isLeaf()){const t=i;n&&(t.partialLengths=ye.combine(e,t,r,!0)),c.push(t.partialLengths)}}let h=c.length;if(0!==h){i.partialLengths.length>0&&(c.push(i),h++,i=new ye(r.minSeq));const e=new Array(h),t=new Array(h);for(let r=0;r<h;r++)e[r]=0,t[r]=c[r].partialLengths.length,i.minLength+=c[r].minLength,i.segmentCount+=c[r].segmentCount;let n,o=0;for(;o>=0;){o=-1;for(let r=0;r<h;r++)if(e[r]<t[r]){const t=c[r].partialLengths[e[r]];(o<0||t.seq<n.seq)&&(o=r,n=t)}o>=0&&(a(n),e[o]++)}s&&i.addClientSeqNumberFromPartial(s)}return ye.options.zamboni&&i.zamboni(r),ye.options.verify&&i.verify(),i}static fromLeaves(e,t,r){function n(e,t){return void 0!==e&&e!==P&&e<=t}e.minLength=0,e.segmentCount=t.childCount;for(let s=0;s<t.childCount;s++){const i=t.children[s];if(i.isLeaf()){const t=i;n(t.seq,r.minSeq)?e.minLength+=t.cachedLength:t.seq!==P&&ye.insertSegment(e,t);const s=be(t);n(null==s?void 0:s.removedSeq,r.minSeq)?e.minLength-=t.cachedLength:void 0!==s&&s.removedSeq!==P&&ye.insertSegment(e,t,s)}}const s=e.partialLengths,i=s.length;let o=0;for(let t=0;t<i;t++)s[t].len=o+s[t].seglen,o=s[t].len,e.addClientSeqNumberFromPartial(s[t]);ye.options.verify&&e.verify()}static getOverlapClients(e,t){const r=new G(De);for(const n of e)r.put(n,{clientId:n,seglen:t});return r}static accumulateRemoveClientOverlap(e,t,r){if(e.overlapRemoveClients)for(const n of t){const t=e.overlapRemoveClients.get(n);t?t.data.seglen+=r:e.overlapRemoveClients.put(n,{clientId:n,seglen:r})}else e.overlapRemoveClients=ye.getOverlapClients(t,r)}static insertSegment(e,t,r){let n,s=t.seq,i=t.cachedLength,o=t.clientId;r&&(s=r.removedSeq,i=-i,o=r.removedClientIds[0],n=r.removedClientIds.length>1?r.removedClientIds.slice(1):void 0);const a=e.partialLengths,c=a.length;let h=0;for(;h<c&&!(a[h].seq>=s);h++);if(h<c&&a[h].seq===s)a[h].seglen+=i,n&&ye.accumulateRemoveClientOverlap(a[h],n,i);else{let e;if(e=n?{seq:s,clientId:o,len:0,seglen:i,overlapRemoveClients:ye.getOverlapClients(n,i)}:{seq:s,clientId:o,len:0,seglen:i},h<c){for(let e=c;e>h;e--)a[e]=a[e-1];a[h]=e}else a.push(e)}}static addSeq(e,t,r,n){let s,i,o=fe(e,t);if(o>=0){const r=e[o];r.seq===t?(s=r,o=fe(e,t-1),o>=0&&(i=e[o])):i=r}void 0===s?(s={clientId:n,seglen:r,seq:t},e.push(s)):s.seglen=r,s.len=void 0!==i?s.seglen+i.len:s.seglen}update(e,t,r,n,s){let i=0,o=0;for(let e=0;e<t.childCount;e++){const n=t.children[e];if(n.isLeaf()){const e=n,t=be(e);e.seq===r?(null==t?void 0:t.removedSeq)!==r&&(i+=e.cachedLength):(null==t?void 0:t.removedSeq)===r&&(i-=e.cachedLength),o++}else{const e=n.partialLengths,t=e.partialLengths,s=fe(t,r);if(s>=0){const e=t[s];e.seq===r&&(i+=e.seglen)}o+=e.segmentCount}}this.segmentCount=o,ye.addSeq(this.partialLengths,r,i,n),void 0===this.clientSeqNumbers[n]&&(this.clientSeqNumbers[n]=[]),ye.addSeq(this.clientSeqNumbers[n],r,i),ye.options.zamboni&&this.zamboni(s),ye.options.verify&&this.verify()}getPartialLength(e,t){let r=this.minLength;const n=fe(this.partialLengths,e),s=this.cliLatest(t),i=this.clientSeqNumbers[t];if(n>=0){if(r+=this.partialLengths[n].len,s>=0){const n=i[s];if(n.seq>e){r+=n.len;const s=this.cliLatestLEQ(t,e);s>=0&&(r-=i[s].len)}}}else s>=0&&(r+=i[s].len);return r}toString(e,t=0){let r="";for(const e of this.partialLengths)r+=`(${e.seq},${e.len}) `;for(const t in this.clientSeqNumbers)if(this.clientSeqNumbers[t].length>0){r+="Client ",r+=e?`${e(+t)}`:`${t}`,r+="[";for(const e of this.clientSeqNumbers[t])r+=`(${e.seq},${e.len})`;r+="]"}return r=`min(seq ${this.minSeq}): ${this.minLength}; sc: ${this.segmentCount};${r}`,r}zamboni(e){function t(t){const r=fe(t,e.minSeq);let n=0;if(r>=0){n=t[r].len;const e=t.length;if(r<=e-1){const s=e-r-1;for(let e=0;e<s;e++)t[e]=t[e+r+1],t[e].len-=n;t.length=s}}return n}this.minLength+=t(this.partialLengths);for(const e in this.clientSeqNumbers){const r=this.clientSeqNumbers[e];r&&t(r)}}addClientSeqNumber(e,t,r){void 0===this.clientSeqNumbers[e]&&(this.clientSeqNumbers[e]=[]);const n=this.clientSeqNumbers[e];let s=r;n.length>0&&(s+=n[n.length-1].len),n.push({seq:t,len:s,seglen:r})}addClientSeqNumberFromPartial(e){this.addClientSeqNumber(e.clientId,e.seq,e.seglen),e.overlapRemoveClients&&e.overlapRemoveClients.map((t=>(this.addClientSeqNumber(t.data.clientId,e.seq,t.data.seglen),!0)))}cliLatestLEQ(e,t){const r=this.clientSeqNumbers[e];return r?fe(r,t):-1}cliLatest(e){const t=this.clientSeqNumbers[e];return t&&t.length>0?t.length-1:-1}verifyPartialLengths(e,t){if(0===e.length)return 0;let r=0,n=0,s=0;for(const i of e)s++,N(this.minSeq<=i.seq,84),N(r<i.seq,85),r=i.seq,n+=i.seglen,n!==i.len&&N(!1,86),t||this.minLength+i.len<0&&N(!1,87),i.overlapRemoveClients&&(N(!t,88),s+=i.overlapRemoveClients.size());return s}verify(){if(this.clientSeqNumbers){let e=0;for(const t of this.clientSeqNumbers)t&&(e+=this.verifyPartialLengths(t,!0));N(!!this.partialLengths,89),N(this.verifyPartialLengths(this.partialLengths,!1)===e,90)}else N(!this.partialLengths,91)}}ye.options={verify:!1,zamboni:!0};class ve{constructor(e){this.segment=e,this.segmentGroups=U()}get size(){return this.segmentGroups.count()}get empty(){return this.segmentGroups.empty()}enqueue(e){this.segmentGroups.enqueue(e),e.segments.push(this.segment)}dequeue(){return this.segmentGroups.dequeue()}clear(){this.segmentGroups.clear()}copyTo(e){this.segmentGroups.walk((t=>e.segmentGroups.enqueue(t)))}}function be(e){if(void 0!==(null==e?void 0:e.removedClientIds)&&void 0!==(null==e?void 0:e.removedSeq))return e;N(void 0===(null==e?void 0:e.removedClientIds)&&void 0===(null==e?void 0:e.removedSeq),703)}function Se(e){const t=be(e);return void 0!==t&&t.removedSeq!==P}class we{constructor(){this.index=0,this.ordinal="",this.cachedLength=0}isLeaf(){return!1}}function xe(e,t){const r=w(e);if(r)for(const n of r)t[n]=e}function Ce(e,t){const r=w(e);if(r)for(const n of r)void 0===t[n]&&(t[n]=e)}function Ee(e,t){for(const r in t){const n=t[r];if(!n.empty()){let t=e[r];void 0===t&&(t=new j,e[r]=t);for(const e of n.items)Ae(t,e)}}}function Ae(e,t){if(S(t,f.NestBegin))return e.push(t),!0;{const r=e.top();return r&&S(r,f.NestBegin)?e.pop():e.push(t),!1}}class Te extends we{constructor(e){super(),this.childCount=e,this.children=new Array(8)}hierBlock(){}setOrdinal(e,t){let r,n=this.childCount;8===n&&(n=7),N(n>=1&&n<=7,64);const s=1<<8-(n+1);if(0===t)r=s-1;else{const e=this.children[t-1].ordinal;r=e.charCodeAt(e.length-1)+s}e.ordinal=this.ordinal+String.fromCharCode(r),N(e.ordinal.length===this.ordinal.length+1,65),t>0&&N(e.ordinal>this.children[t-1].ordinal,66)}assignChild(e,t,r=!0){e.parent=this,e.index=t,r&&this.setOrdinal(e,t),this.children[t]=e}}class Oe extends Te{constructor(e){super(e),this.rightmostTiles=L(),this.leftmostTiles=L(),this.rangeStacks=L()}addNodeReferences(e,t){!function(e,t,r,n,s){var i;function o(e,t){let r=s[e];void 0===r&&(r=new j,s[e]=r),Ae(r,t)}if(t.isLeaf()){const s=t;if((null!==(i=e.localNetLength(s))&&void 0!==i?i:0)>0)if(Re.is(s)){const t=s.getId();if(t&&e.mapIdToSegment(t,s),S(s,f.Tile)&&(xe(s,r),Ce(s,n)),s.refType&(f.NestBegin|f.NestEnd)){const e=x(s);if(e)for(const t of e)o(t,s)}}else{const e=t;if(e.localRefs&&void 0!==e.localRefs.hierRefCount&&e.localRefs.hierRefCount>0)for(const t of e.localRefs)if(S(t,f.Tile)&&(xe(t,r),Ce(t,n)),t.refType&(f.NestBegin|f.NestEnd))for(const e of x(t))o(e,t)}}else{const e=t;Ee(s,e.rangeStacks),M(r,e.rightmostTiles),function(e,t){if(void 0!==t)for(const r in t)void 0===e[r]&&(e[r]=t[r])}(n,e.leftmostTiles)}}(e,t,this.rightmostTiles,this.leftmostTiles,this.rangeStacks)}hierBlock(){return this}hierToString(e){let t="";for(const r in this.rangeStacks){const n=this.rangeStacks[r];t+=Le(e),t+=`${r}: `;for(const e of n.items)t+=`${e.toString()} `;t+="\n"}return t}}class Ne extends we{constructor(){super(...arguments),this.clientId=I,this.seq=0,this.segmentGroups=new ve(this),this.trackingCollection=new me(this)}addProperties(e,t,r,n){return this.propertyManager||(this.propertyManager=new B),this.properties||(this.properties=L()),this.propertyManager.addProperties(this.properties,e,t,r,n&&n.collaborating)}hasProperty(e){return!!this.properties&&void 0!==this.properties[e]}isLeaf(){return!0}cloneInto(e){var t;e.clientId=this.clientId,e.properties=function(e){if(void 0===e)return;const t=L();for(const r in e){const n=e[r];null!==n&&(t[r]=n)}return t}(this.properties),e.removedClientIds=null===(t=this.removedClientIds)||void 0===t?void 0:t.slice(),e.removedSeq=this.removedSeq,e.seq=this.seq}canAppend(e){return!1}addSerializedProps(e){this.properties&&(e.props=this.properties)}ack(e,t,r){switch(N(this.segmentGroups.dequeue()===e,67),t.op.type){case v.ANNOTATE:return N(!!this.propertyManager,68),this.propertyManager.ackPendingProperties(t.op),!0;case v.INSERT:return N(this.seq===P,69),this.seq=t.sequencedMessage.sequenceNumber,this.localSeq=void 0,!0;case v.REMOVE:const e=be(this);return N(void 0!==e,70),this.localRemovedSeq=void 0,e.removedSeq===P&&(e.removedSeq=t.sequencedMessage.sequenceNumber,!0);default:throw new Error(`${t.op.type} is in unrecognized operation type`)}}splitAt(e){var t;if(e>0){const r=this.createSplitSegmentAt(e);return r&&(this.copyPropertiesTo(r),r.parent=this.parent,r.ordinal=this.ordinal+String.fromCharCode(0),r.removedClientIds=null===(t=this.removedClientIds)||void 0===t?void 0:t.slice(),r.removedSeq=this.removedSeq,r.localRemovedSeq=this.localRemovedSeq,r.seq=this.seq,r.localSeq=this.localSeq,r.clientId=this.clientId,this.segmentGroups.copyTo(r),this.trackingCollection.copyTo(r),this.localRefs&&this.localRefs.split(e,r)),r}}copyPropertiesTo(e){this.propertyManager&&this.properties&&(e.propertyManager=new B,e.properties=this.propertyManager.copyTo(this.properties,e.properties,e.propertyManager))}}const Pe="markerId";class Re extends Ne{constructor(e){super(),this.refType=e,this.type=Re.type,this.cachedLength=1}static is(e){return e.type===Re.type}static make(e,t){const r=new Re(e);return t&&r.addProperties(t),r}toJSONObject(){const e={marker:{refType:this.refType}};return super.addSerializedProps(e),e}static fromJSONObject(e){if(e&&"object"==typeof e&&"marker"in e)return Re.make(e.marker.refType,e.props)}clone(){const e=Re.make(this.refType,this.properties);return this.cloneInto(e),e}getSegment(){return this}getOffset(){return 0}hasSimpleType(e){return!!this.properties&&this.properties.markerSimpleType===e}getProperties(){return this.properties}getId(){if(this.properties&&this.properties[Pe])return this.properties[Pe]}hasTileLabels(){return A(this)}hasRangeLabels(){return T(this)}hasTileLabel(e){return C(this,e)}hasRangeLabel(e){return E(this,e)}getTileLabels(){return w(this)}getRangeLabels(){return x(this)}toString(){let e="";S(this,f.Tile)&&(e+="Tile"),S(this,f.NestBegin)&&(e.length>0&&(e+="; "),e+="RangeBegin"),S(this,f.NestEnd)&&(e.length>0&&(e+="; "),e+="RangeEnd");let t="";const r=this.getId();r&&(e+=` (${r}) `);const n=w(this);if(n){t+="tile -- ";for(let e=0,r=n.length;e<r;e++)e>0&&(t+="; "),t+=n[e]}const s=x(this);if(s){let e="begin";S(this,f.NestEnd)&&(e="end"),n&&(t+=" "),t+=`range ${e} -- `;const r=s;for(let e=0,n=r.length;e<n;e++)e>0&&(t+="; "),t+=r[e]}let i="";return this.properties&&(i+=JSON.stringify(this.properties,((e,t)=>{const r=!!t&&t.IFluidHandle;return r?`#Handle(${r.routeContext.path}/${r.path})`:t}))),`M ${e}: ${t} ${i}`}createSplitSegmentAt(e){}canAppend(e){return!1}append(){throw new Error("Can not append to marker")}}var Ie;Re.type="Marker",function(e){e[e.Go=0]="Go",e[e.Stop=1]="Stop",e[e.Yield=2]="Yield"}(Ie||(Ie={}));class Fe{constructor(e,t,r,n,s,i,o,a,c=0){this.block=e,this.actions=t,this.pos=r,this.refSeq=n,this.clientId=s,this.context=i,this.start=o,this.end=a,this.childIndex=c,this.op=Ie.Go}}class ke{constructor(){this.clientId=I,this.collaborating=!1,this.minSeq=0,this.currentSeq=0,this.localSeq=0}loadFrom(e){this.clientId=e.clientId,this.collaborating=e.collaborating,this.minSeq=e.minSeq,this.currentSeq=e.currentSeq}}const De=(e,t)=>e-t,Me=(e,t)=>e.localeCompare(t),qe=[""," ","  "];function Le(e){if(void 0===qe[e]){qe[e]="";for(let t=0;t<e;t++)qe[e]+=" "}return qe[e]}const Be={min:{maxSeq:-2},compare:(e,t)=>e.maxSeq-t.maxSeq};function je(e,t){for(const r of t.rangeLabels)if(E(e,r)){let n=t.stacks[r];void 0===n&&(n=new j,t.stacks[r]=n),Ae(n,e)}}function _e(e,t,r,n,s,i,o){return Re.is(e)&&e.refType&(f.NestBegin|f.NestEnd)&&je(e,o),!1}function He(e,t,r,n,s,i,o){var a;if(e.isLeaf()){const t=e;(null!==(a=o.mergeTree.localNetLength(t))&&void 0!==a?a:0)>0&&Re.is(t)&&t.refType&(f.NestBegin|f.NestEnd)&&je(t,o)}else{const t=e;Ee(o.stacks,t.rangeStacks)}return!0}function Ue(e,t,r,n,s,i,o){return Re.is(e)&&C(e,o.tileLabel)&&(o.tile=e),!1}function ze(e,t,r,n,s,i,o){if(e.isLeaf()){const t=e;o.mergeTree.localNetLength(t)>0&&Re.is(t)&&C(t,o.tileLabel)&&(o.tile=t)}else{const t=e;let r;r=o.posPrecedesTile?t.rightmostTiles[o.tileLabel]:t.leftmostTiles[o.tileLabel],void 0!==r&&(o.tile=r)}return!0}const Ve={min:{minRequired:Number.MIN_VALUE,onMinGE:()=>{N(!1,72)}},compare:(e,t)=>e.minRequired-t.minRequired};class Ge{constructor(e){this.options=e,this.blockUpdateActions=Ge.initBlockUpdateActions,this.collabWindow=new ke,this.idToSegment=new Map,this.splitLeafSegment=(e,t)=>{if(!(t>0&&e))return{};const r=e.splitAt(t);return this.mergeTreeMaintenanceCallback&&this.mergeTreeMaintenanceCallback({operation:-2,deltaSegments:[{segment:e},{segment:r}]},void 0),{next:r}},this.root=this.makeBlock(0)}makeBlock(e){const t=new Oe(e);return t.ordinal="",t}clone(){const e=new Ge(this.options);e.root=e.blockClone(this.root)}blockClone(e,t){const r=this.makeBlock(e.childCount);for(let n=0;n<e.childCount;n++){const s=e.children[n];if(s.isLeaf()){const e=this.segmentClone(s);r.assignChild(e,n),t&&t.push(e)}else r.assignChild(this.blockClone(s,t),n)}return this.nodeUpdateLengthNewStructure(r),this.nodeUpdateOrdinals(r),r}segmentClone(e){return e.clone()}localNetLength(e){return void 0!==be(e)?0:e.cachedLength}mapIdToSegment(e,t){this.idToSegment.set(e,t)}addNode(e,t){const r=e.childCount++;return e.assignChild(t,r,!1),r}reloadFromSegments(e){N(!this.collabWindow.collaborating,73);const t=e=>{const r=Math.ceil(e.length/7),n=new Array(r);for(let t=0,s=0;s<r;s++){const r=n[s]=this.makeBlock(0);for(let n=0;n<7&&t<e.length;n++,t++)this.addNode(r,e[t]);this.blockUpdate(r)}return 1===n.length?n[0]:t(n)};e.length>0?(this.root=t(e),this.nodeUpdateOrdinals(this.root)):this.root=this.makeBlock(0)}startCollaboration(e,t,r){this.collabWindow.clientId=e,this.collabWindow.minSeq=t,this.collabWindow.collaborating=!0,this.collabWindow.currentSeq=r,this.segmentsToScour=new V([],Be),this.pendingSegments=U(),this.nodeUpdateLengthNewStructure(this.root,!0)}addToLRUSet(e,t){!0!==e.parent.needsScour&&t>this.collabWindow.currentSeq&&(e.parent.needsScour=!0,this.segmentsToScour.add({segment:e,maxSeq:t}))}underflow(e){return e.childCount<4}scourNode(e,t){let r;for(let n=0;n<e.childCount;n++){const s=e.children[n];if(s.isLeaf()){const e=s;e.segmentGroups.empty?void 0!==e.removedSeq?(e.removedSeq>this.collabWindow.minSeq?t.push(e):e.trackingCollection.empty?(this.mergeTreeMaintenanceCallback&&this.mergeTreeMaintenanceCallback({operation:-3,deltaSegments:[{segment:e}]},void 0),e.parent=void 0):t.push(e),r=void 0):e.seq<=this.collabWindow.minSeq?r&&r.canAppend(e)&&D(r.properties,e.properties)&&r.trackingCollection.matches(e.trackingCollection)&&this.localNetLength(e)>0?(r.append(e),this.mergeTreeMaintenanceCallback&&this.mergeTreeMaintenanceCallback({operation:-1,deltaSegments:[{segment:r},{segment:e}]},void 0),e.parent=void 0,e.trackingCollection.trackingGroups.forEach((t=>t.unlink(e)))):(t.push(e),r=this.localNetLength(e)>0?e:void 0):(t.push(e),r=void 0):(t.push(e),r=void 0)}else t.push(s),r=void 0}}packParent(e){const t=e.children;let r,n;const s=[];for(r=0;r<e.childCount;r++)n=t[r],this.scourNode(n,s),n.parent=void 0;const i=s.length;let o=Math.min(7,Math.floor(i/4));o<1&&(o=1);const a=Math.floor(i/o);let c=i%o;const h=new Array(8);let l=0;for(let t=0;t<o;t++){let r=a;c>0&&(r++,c--);const n=this.makeBlock(r);for(let e=0;e<r;e++){const t=s[l++];n.assignChild(t,e,!1)}n.parent=e,h[t]=n,this.nodeUpdateLengthNewStructure(n)}e.children=h;for(let t=0;t<o;t++)e.assignChild(h[t],t,!1);e.childCount=o,this.underflow(e)&&e.parent?this.packParent(e.parent):(this.nodeUpdateOrdinals(e),this.blockUpdatePathLengths(e,P,-1,!0))}zamboniSegments(e=Ge.zamboniSegmentsMaxCount){if(this.collabWindow.collaborating)for(let t=0;t<e;t++){let e=this.segmentsToScour.peek();if(!e||e.maxSeq>this.collabWindow.minSeq)break;if(e=this.segmentsToScour.get(),e.segment.parent&&!1!==e.segment.parent.needsScour){const t=e.segment.parent,r=[];this.scourNode(t,r),t.needsScour=!1;const n=r.length;if(n<t.childCount){t.childCount=n,t.children=r;for(let e=0;e<n;e++)t.assignChild(r[e],e,!1);this.underflow(t)&&t.parent?this.packParent(t.parent):(this.nodeUpdateOrdinals(t),this.blockUpdatePathLengths(t,P,-1,!0))}}}}getCollabWindow(){return this.collabWindow}getStats(){const e=t=>{const r={maxHeight:0,nodeCount:0,leafCount:0,removedLeafCount:0,liveCount:0,histo:[]};for(let e=0;e<8;e++)r.histo[e]=0;for(let n=0;n<t.childCount;n++){const s=t.children[n];let i=1;if(s.isLeaf())r.leafCount++,void 0!==s.removedSeq&&r.removedLeafCount++;else{const t=e(s);i=1+t.maxHeight,r.nodeCount+=t.nodeCount,r.leafCount+=t.leafCount,r.removedLeafCount+=t.removedLeafCount,r.liveCount+=t.liveCount;for(let e=0;e<8;e++)r.histo[e]+=t.histo[e]}i>r.maxHeight&&(r.maxHeight=i)}return r.histo[t.childCount]++,r.nodeCount++,r.liveCount+=t.childCount,r};return e(this.root)}getLength(e,t){return this.blockLength(this.root,e,t)}get length(){return this.root.cachedLength}getPosition(e,t,r){var n;let s,i=0,o=e.parent;for(;o;){const a=o.children;for(let c=0;c<o.childCount;c++){const o=a[c];if(s&&o===s||o===e)break;i+=null!==(n=this.nodeLength(o,t,r))&&void 0!==n?n:0}s=o,o=o.parent}return i}getContainingSegment(e,t,r){let n,s;return this.searchBlock(this.root,e,0,t,r,{leaf:(e,t,r,i,o)=>(n=e,s=o,!1)},void 0),{segment:n,offset:s}}_getSlideToSegment(e){if(!e.segment||!Se(e.segment))return e;let t;const r=e=>!(e.seq!==P&&!Se(e)&&(t=e,1));return this.rightExcursion(e.segment,r),t?{segment:t,offset:0}:(this.leftExcursion(e.segment,r),t?{segment:t,offset:t.cachedLength-1}:{segment:void 0,offset:0})}slideReferences(e,t){var r,n,s,i,o;N(Se(e),753),N(!!e.localRefs,754);const a=this._getSlideToSegment({segment:e,offset:0}),c=a.segment;c&&!c.localRefs&&(c.localRefs=new X(c));for(const h of t)null===(n=null===(r=h.callbacks)||void 0===r?void 0:r.beforeSlide)||void 0===n||n.call(r),N(h===e.localRefs.removeLocalRef(h),755),c?(h.segment=c,h.offset=null!==(s=a.offset)&&void 0!==s?s:0,N(!!c.localRefs,756),c.localRefs.addLocalRef(h)):(h.segment=void 0,h.offset=0),null===(o=null===(i=h.callbacks)||void 0===i?void 0:i.afterSlide)||void 0===o||o.call(i);c&&this.blockUpdatePathLengths(c.parent,R,I)}updateSegmentRefsAfterMarkRemoved(e,t){if(!e.localRefs||e.localRefs.empty)return;const r=[],n=[];for(const s of e.localRefs)S(s,f.StayOnRemove)?n.push(s):S(s,f.SlideOnRemove)&&(t?n.push(s):r.push(s));t||this.slideReferences(e,r),e.localRefs.clear();for(const t of n)t.segment=e,e.localRefs.addLocalRef(t)}blockLength(e,t,r){return this.collabWindow.collaborating&&r!==this.collabWindow.clientId?e.partialLengths.getPartialLength(t,r):e.cachedLength}nodeLength(e,t,r){if(this.collabWindow.collaborating&&this.collabWindow.clientId!==r){if(e.isLeaf()){const n=e,s=be(n);if(void 0!==s&&s.removedSeq!==P&&s.removedSeq<=t)return;if(n.clientId===r||n.seq!==P&&n.seq<=t)return void 0!==s&&s.removedClientIds.includes(r)?0:n.cachedLength;if(void 0!==s&&s.removedSeq!==P)return;return 0}return e.partialLengths.getPartialLength(t,r)}return e.isLeaf()?this.localNetLength(e):e.cachedLength}addMinSeqListener(e,t){this.minSeqListeners||(this.minSeqListeners=new V([],Ve)),this.minSeqListeners.add({minRequired:e,onMinGE:t})}notifyMinSeqListeners(){if(this.minSeqListeners)for(;this.minSeqListeners.count()>0&&this.minSeqListeners.peek().minRequired<=this.collabWindow.minSeq;)this.minSeqListeners.get().onMinGE(this.collabWindow.minSeq)}setMinSeq(e){N(e<=this.collabWindow.currentSeq,78),N(this.collabWindow.minSeq<=e,79),e>this.collabWindow.minSeq&&(this.collabWindow.minSeq=e,Ge.options.zamboniSegments&&this.zamboniSegments(),this.notifyMinSeqListeners())}referencePositionToLocalPosition(e,t=this.collabWindow.currentSeq,r=this.collabWindow.clientId){const n=e.getSegment();return n&&n.parent?(n.removedSeq?0:e.getOffset())+this.getPosition(n,t,r):$.DetachedPosition}getStackContext(e,t,r){const n={mergeTree:this,stacks:L(),rangeLabels:r};return this.search(e,0,t,{leaf:_e,shift:He},n),n.stacks}findTile(e,t,r,n=!0){const s={mergeTree:this,posPrecedesTile:n,tileLabel:r};if(n?this.search(e,0,t,{leaf:Ue,shift:ze},s):this.backwardSearch(e,0,t,{leaf:Ue,shift:ze},s),s.tile){let e;if(s.tile.isLeaf()){const r=s.tile;e=this.getPosition(r,0,t)}else e=s.tile.toPosition();return{tile:s.tile,pos:e}}}search(e,t,r,n,s){return this.searchBlock(this.root,e,0,t,r,n,s)}searchBlock(e,t,r,n,s,i,o){var a;let c=t,h=r;const l=e.children;i&&i.pre&&i.pre(e,h,n,s,void 0,void 0,o);const u=i&&i.contains;for(let t=0;t<e.childCount;t++){const e=l[t],r=null!==(a=this.nodeLength(e,n,s))&&void 0!==a?a:0;if(!u&&c<r||u&&u(e,c,n,s,void 0,void 0,o))return e.isLeaf()?(i&&i.leaf&&i.leaf(e,h,n,s,c,-1,o),e):this.searchBlock(e,c,h,n,s,i,o);i&&i.shift&&i.shift(e,h,n,s,c,void 0,o),c-=r,h+=r}i&&i.post&&i.post(e,h,n,s,void 0,void 0,o)}backwardSearch(e,t,r,n,s){const i=this.getLength(t,r);if(!(e>i))return this.backwardSearchBlock(this.root,e,i,t,r,n,s)}backwardSearchBlock(e,t,r,n,s,i,o){var a;let c=r;const h=e.children;i&&i.pre&&i.pre(e,c,n,s,void 0,void 0,o);const l=i&&i.contains;for(let r=e.childCount-1;r>=0;r--){const e=h[r],u=c-(null!==(a=this.nodeLength(e,n,s))&&void 0!==a?a:0);if(!l&&t>=u||l&&l(e,t,n,s,void 0,void 0,o))return e.isLeaf()?(i&&i.leaf&&i.leaf(e,u,n,s,t,-1,o),e):this.backwardSearchBlock(e,t,c,n,s,i,o);i&&i.shift&&i.shift(e,u,n,s,t,void 0,o),c=u}i&&i.post&&i.post(e,c,n,s,void 0,void 0,o)}updateRoot(e){if(void 0!==e){const t=this.makeBlock(2);t.assignChild(this.root,0,!1),t.assignChild(e,1,!1),this.root=t,this.nodeUpdateOrdinals(this.root),this.nodeUpdateLengthNewStructure(this.root)}}ackPendingSegment(e){const t=e.sequencedMessage.sequenceNumber,r=this.pendingSegments.dequeue(),n=[];let s=!1;if(void 0!==r){const i=[];r.segments.map((o=>{const a=!o.ack(r,e,this);s=a||s,a||e.op.type!==v.REMOVE||this.updateSegmentRefsAfterMarkRemoved(o,!1),Ge.options.zamboniSegments&&this.addToLRUSet(o,t),n.includes(o.parent)||n.push(o.parent),i.push({segment:o})})),this.mergeTreeMaintenanceCallback&&this.mergeTreeMaintenanceCallback({deltaSegments:i,operation:-4},e);const o=this.collabWindow.clientId;for(const e of n)this.blockUpdatePathLengths(e,t,o,s)}Ge.options.zamboniSegments&&this.zamboniSegments()}addToPendingList(e,t,r){let n=t;return void 0===n&&(n={segments:[],localSeq:r},this.pendingSegments.enqueue(n)),e.segmentGroups.enqueue(n),n}getMarkerFromId(e){return this.idToSegment.get(e)}posFromRelativePos(e,t=this.collabWindow.currentSeq,r=this.collabWindow.clientId){let n,s=-1;return e.id&&(n=this.getMarkerFromId(e.id)),n&&(s=this.getPosition(n,t,r),e.before?void 0!==e.offset&&(s-=e.offset):(s+=n.cachedLength,void 0!==e.offset&&(s+=e.offset))),s}insertSegments(e,t,r,n,s,i){this.ensureIntervalBoundary(e,r,n);const o=s===P?++this.collabWindow.localSeq:void 0;this.blockInsert(e,r,n,s,o,t),this.mergeTreeDeltaCallback&&void 0!==i&&this.mergeTreeDeltaCallback(i,{operation:v.INSERT,deltaSegments:t.map((e=>({segment:e})))}),this.collabWindow.collaborating&&Ge.options.zamboniSegments&&s!==P&&this.zamboniSegments()}insertAtReferencePosition(e,t,r){if(0===t.cachedLength)return;if(t.parent||t.removedSeq||0!==t.seq)throw new Error("Cannot insert segment that has already been inserted.");const n=e=>{let t=e.parent,r=t;for(;void 0!==t;){if(t.childCount>=8){const e=this.split(t);t===this.root?(this.updateRoot(e),r=void 0):(this.insertChildNode(t.parent,e,t.index+1),r=e.parent,this.blockUpdateLength(t.parent,P,s))}else this.blockUpdateLength(t,P,s);t=t.parent}r&&this.nodeUpdateOrdinals(r)},s=this.collabWindow.clientId,i=e.getSegment(),o=e.getOffset(),a=this.nodeLength(i,this.collabWindow.currentSeq,s);let c=i;if(0!==o&&void 0!==a&&0!==a){const e=this.splitLeafSegment(i,o);N(!!e.next,80),this.insertChildNode(i.parent,e.next,i.index+1),n(e.next),c=e.next}if(this.leftExcursion(c,(e=>{if(!e.isLeaf())return!0;const t=this.nodeLength(e,this.collabWindow.currentSeq,s);return void 0===t||0===t&&(this.breakTie(0,e,P)&&(c=e),!0)})),this.collabWindow.collaborating?(t.localSeq=++this.collabWindow.localSeq,t.seq=P):t.seq=0,t.clientId=s,Re.is(t)){const e=t.getId();e&&this.mapIdToSegment(e,t)}this.insertChildNode(c.parent,t,c.index),n(t),this.mergeTreeDeltaCallback&&this.mergeTreeDeltaCallback(r,{deltaSegments:[{segment:t}],operation:v.INSERT}),this.collabWindow.collaborating&&this.addToPendingList(t,void 0,t.localSeq)}resolveRemoteClientPosition(e,t,r){if(t<this.collabWindow.minSeq)return;const n=this.getContainingSegment(e,t,r),s=this.getCollabWindow();return n&&n.segment?this.getPosition(n.segment,s.currentSeq,s.clientId)+n.offset:e===this.getLength(t,r)?this.getLength(s.currentSeq,s.clientId):void 0}insertChildNode(e,t,r){N(e.childCount<8,81);for(let t=e.childCount;t>r;t--)e.children[t]=e.children[t-1],e.children[t].index=t;e.childCount++,e.assignChild(t,r,!1)}blockInsert(e,t,r,n,s,i){let o=!1;const a=e=>(e.seq===P&&(o=!0),!1),c=e=>(o=!1,this.rightExcursion(e,a),o);let h;const l=e=>{this.collabWindow.collaborating&&(e.seq===P&&r===this.collabWindow.clientId?h=this.addToPendingList(e,h,s):e.seq>this.collabWindow.minSeq&&Ge.options.zamboniSegments&&this.addToLRUSet(e,e.seq))},u=(e,t,r)=>{const n={};return e?(n.replaceCurrent=r.candidateSegment,n.next=e):n.next=r.candidateSegment,n};let d=e;for(const e of i)if(o=!1,e.cachedLength>0){if(e.seq=n,e.localSeq=s,e.clientId=r,Re.is(e)){const t=e.getId();t&&this.mapIdToSegment(t,e)}const i=this.insertingWalk(this.root,d,t,r,n,{leaf:u,candidateSegment:e,continuePredicate:c});if(void 0===e.parent)throw new Error(`MergeTree insert failed: ${JSON.stringify({currentSeq:this.collabWindow.currentSeq,minSeq:this.collabWindow.minSeq,segSeq:e.seq})}`);this.updateRoot(i),l(e),d+=e.cachedLength}}ensureIntervalBoundary(e,t,r){const n=this.insertingWalk(this.root,e,t,r,R,{leaf:this.splitLeafSegment});this.updateRoot(n)}breakTie(e,t,r){var n;return!t.isLeaf()||0===e&&(r===P?Number.MAX_SAFE_INTEGER:r)>(t.seq===P?Number.MAX_SAFE_INTEGER-1:null!==(n=t.seq)&&void 0!==n?n:0)}leftExcursion(e,t){let r=!0,n=e,s=n.parent;for(;s;){const e=s.children;let i,o,a=!1;for(i=s.childCount-1;i>=0;i--)if(o=e[i],a){if(o.isLeaf())r=t(o,0,0,this.collabWindow.clientId,0,0,void 0);else{const e=o;r=this.nodeMapReverse(e,t,0,0,this.collabWindow.clientId)}if(!r)return}else a=n===o;n=s,s=s.parent}}rightExcursion(e,t){let r=!0,n=e,s=n.parent;for(;s;){const e=s.children;let i,o,a=!1;for(i=0;i<s.childCount;i++)if(o=e[i],a){if(o.isLeaf())r=t(o);else{const e=o;r=this.walkAllSegments(e,t)}if(!r)return}else a=n===o;n=s,s=s.parent}}insertingWalk(e,t,r,n,s,i){let o=t;const a=e.children;let c,h,l,u;for(c=0;c<e.childCount;c++){h=a[c];const t=this.nodeLength(h,r,n);if(void 0!==t){if(o<t||o===t&&this.breakTie(o,h,s)){if(h.isLeaf()){const t=h,r=i.leaf(t,o,i);if(r.replaceCurrent&&(e.assignChild(r.replaceCurrent,c,!1),r.replaceCurrent.ordinal=h.ordinal),!r.next)return void(i.structureChange&&this.nodeUpdateLengthNewStructure(e));l=r.next,c++}else{const a=h,d=this.insertingWalk(a,o,r,n,s,i);if(void 0===d)return void(i.structureChange?this.nodeUpdateLengthNewStructure(e):this.blockUpdateLength(e,s,n));if(d===Ge.theUnfinishedNode){o-=t;continue}l=d,u=d,c++}break}o-=t}}if(!l&&0===o){if(s!==P&&i.continuePredicate&&i.continuePredicate(e))return Ge.theUnfinishedNode;l=i.leaf(void 0,o,i).next}if(l){for(let t=e.childCount;t>c;t--)e.children[t]=e.children[t-1],e.children[t].index=t;return e.assignChild(l,c,!1),e.childCount++,e.setOrdinal(l,c),e.childCount<8?(u&&this.nodeUpdateOrdinals(u),void(i.structureChange?this.nodeUpdateLengthNewStructure(e):this.blockUpdateLength(e,s,n))):this.split(e)}}split(e){const t=this.makeBlock(4);e.childCount=4,this.nodeUpdateOrdinals(e);for(let r=0;r<4;r++)t.assignChild(e.children[4+r],r,!1),e.children[4+r]=void 0;return this.nodeUpdateLengthNewStructure(e),this.nodeUpdateLengthNewStructure(t),t}nodeUpdateOrdinals(e){for(let t=0;t<e.childCount;t++){const r=e.children[t];e.setOrdinal(r,t),r.isLeaf()||this.nodeUpdateOrdinals(r)}}annotateRange(e,t,r,n,s,i,o,a){this.ensureIntervalBoundary(e,s,i),this.ensureIntervalBoundary(t,s,i);const c=[],h=o===P?++this.collabWindow.localSeq:void 0;let l;this.mapRange({leaf:e=>{const t=e.addProperties(r,n,o,this.collabWindow);return c.push({segment:e,propertyDeltas:t}),this.collabWindow.collaborating&&(o===P?l=this.addToPendingList(e,l,h):Ge.options.zamboniSegments&&this.addToLRUSet(e,o)),!0}},s,i,void 0,e,t),this.mergeTreeDeltaCallback&&c.length>0&&this.mergeTreeDeltaCallback(a,{operation:v.ANNOTATE,deltaSegments:c}),this.collabWindow.collaborating&&o!==P&&Ge.options.zamboniSegments&&this.zamboniSegments()}markRangeRemoved(e,t,r,n,s,i=!1,o){let a,c=i;this.ensureIntervalBoundary(e,r,n),this.ensureIntervalBoundary(t,r,n);const h=[],l=[],u=s===P?++this.collabWindow.localSeq:void 0;this.mapRange({leaf:(e,t,r,i)=>{const o=be(e);return void 0!==o?(c=!0,o.removedSeq===P?(o.removedClientIds.unshift(n),o.removedSeq=s,e.localRemovedSeq=void 0):o.removedClientIds.push(n)):(e.removedClientIds=[n],e.removedSeq=s,e.localRemovedSeq=u,h.push({segment:e})),e.localRefs&&!e.localRefs.empty&&l.push(e),this.collabWindow.collaborating&&(e.removedSeq===P&&n===this.collabWindow.clientId?a=this.addToPendingList(e,a,u):Ge.options.zamboniSegments&&this.addToLRUSet(e,s)),!0},post:(e,t,r,i)=>(c?this.nodeUpdateLengthNewStructure(e):this.blockUpdateLength(e,s,n),!0)},r,n,void 0,e,t);const d=this.collabWindow.collaborating&&n===this.collabWindow.clientId;for(const e of l)this.updateSegmentRefsAfterMarkRemoved(e,d);this.mergeTreeDeltaCallback&&h.length>0&&this.mergeTreeDeltaCallback(o,{operation:v.REMOVE,deltaSegments:h}),this.collabWindow.collaborating&&s!==P&&Ge.options.zamboniSegments&&this.zamboniSegments()}nodeUpdateLengthNewStructure(e,t=!1){this.blockUpdate(e),this.collabWindow.collaborating&&(e.partialLengths=ye.combine(this,e,this.collabWindow,t))}removeLocalReferencePosition(e){var t;const r=e.getSegment();if(r){const n=null===(t=null==r?void 0:r.localRefs)||void 0===t?void 0:t.removeLocalRef(e);return void 0!==n&&this.blockUpdatePathLengths(r.parent,R,I),n}}createLocalReferencePosition(e,t,r,n,s){var i;if(function(e){return void 0!==be(e)}(e)&&!S(r,f.SlideOnRemove|f.Transient))throw new y.Oi("Can only create SlideOnRemove or Transient local reference position on a removed segment");const o=null!==(i=e.localRefs)&&void 0!==i?i:new X(e);e.localRefs=o;const a=o.createLocalRef(t,r,n,s);return this.blockUpdatePathLengths(e.parent,R,I),a}removeLocalReference(e,t){e.localRefs&&e.localRefs.removeLocalRef(t)&&this.blockUpdatePathLengths(e.parent,R,I)}addLocalReference(e){const t=e.segment;let r=t.localRefs;r||(r=new X(t),t.localRefs=r),r.addLocalRef(e),this.blockUpdatePathLengths(t.parent,R,I)}blockUpdate(e){var t;let r=0;const n=e.hierBlock();n&&(n.rightmostTiles=L(),n.leftmostTiles=L(),n.rangeStacks={});for(let i=0;i<e.childCount;i++){const o=e.children[i];r+=null!==(this,t=(s=o).isLeaf()?this.localNetLength(s):s.cachedLength)&&void 0!==t?t:0,n&&n.addNodeReferences(this,o),this.blockUpdateActions&&this.blockUpdateActions.child(e,i)}var s;e.cachedLength=r}blockUpdatePathLengths(e,t,r,n=!1){let s=e;for(;void 0!==s;)n?this.nodeUpdateLengthNewStructure(s):this.blockUpdateLength(s,t,r),s=s.parent}blockUpdateLength(e,t,r){this.blockUpdate(e),this.collabWindow.collaborating&&t!==P&&t!==R&&(void 0!==e.partialLengths&&Ge.options.incrementalUpdate&&r!==F?e.partialLengths.update(this,e,t,r,this.collabWindow):e.partialLengths=ye.combine(this,e,this.collabWindow))}map(e,t,r,n){this.nodeMap(this.root,e,0,t,r,n)}mapRange(e,t,r,n,s,i,o=!1){o&&(s&&this.ensureIntervalBoundary(s,t,r),i&&this.ensureIntervalBoundary(i,t,r)),this.nodeMap(this.root,e,0,t,r,n,s,i)}incrementalBlockMap(e){for(var t;!e.empty();){const r=e.top();if(r.op!==Ie.Go)return;if(0===r.childIndex&&(void 0===r.start&&(r.start=0),void 0===r.end&&(r.end=this.blockLength(r.block,r.refSeq,r.clientId)),r.actions.pre&&r.actions.pre(r)),r.op===Ie.Go&&r.childIndex<r.block.childCount){const n=r.block.children[r.childIndex],s=null!==(t=this.nodeLength(n,r.refSeq,r.clientId))&&void 0!==t?t:0;if(s>0&&r.start<s&&r.end>0)if(n.isLeaf())r.actions.leaf(n,r);else{const t=new Fe(n,r.actions,r.pos,r.refSeq,r.clientId,r.context,r.start,r.end,0);e.push(t)}r.pos+=s,r.start-=s,r.end-=s,r.childIndex++}else r.childIndex===r.block.childCount&&(r.op===Ie.Go&&r.actions.post&&r.actions.post(r),e.pop())}}nodeMap(e,t,r,n,s,i,o,a){var c;let h=o,l=a,u=r;void 0===h&&(h=0),void 0===l&&(l=this.blockLength(e,n,s));let d=!0;if(t.pre&&(d=t.pre(e,u,n,s,h,l,i),!d))return!0;const p=e.children;for(let r=0;r<e.childCount;r++){const e=p[r],o=null!==(c=this.nodeLength(e,n,s))&&void 0!==c?c:0;if(d&&l>0&&o>0&&h<o&&(e.isLeaf()?t.leaf&&(d=t.leaf(e,u,n,s,h,l,i)):d&&(d=this.nodeMap(e,t,u,n,s,i,h,l))),!d)break;t.shift&&t.shift(e,u,n,s,h,l,i),u+=o,h-=o,l-=o}return d&&t.post&&(d=t.post(e,u,n,s,h,l,i)),d}walkAllSegments(e,t,r){let n=!0;const s=e.children;for(let i=0;n&&i<e.childCount;i++){const e=s[i];n=e.isLeaf()?t(e,r):this.walkAllSegments(e,t,r)}return n}nodeMapReverse(e,t,r,n,s){let i=!0;const o=e.children;for(let a=e.childCount-1;a>=0;a--){const e=o[a];if(i&&(e.isLeaf()?i=t(e,r,n,s,0,0,void 0):i&&(i=this.nodeMapReverse(e,t,r,n,s))),!i)break}return i}}Ge.zamboniSegmentsMaxCount=2,Ge.options={incrementalUpdate:!0,insertAfterRemovedSegs:!0,zamboniSegments:!0},Ge.theUnfinishedNode={childCount:-1};class Ke extends Ne{constructor(e){super(),this.text=e,this.type=Ke.type,this.cachedLength=e.length}static is(e){return e.type===Ke.type}static make(e,t){const r=new Ke(e);return t&&r.addProperties(t),r}static fromJSONObject(e){if("string"==typeof e)return new Ke(e);if(e&&"object"==typeof e&&"text"in e){const t=e;return Ke.make(t.text,t.props)}}toJSONObject(){return this.properties?{text:this.text,props:this.properties}:this.text}clone(e=0,t){const r=this.text.substring(e,t),n=Ke.make(r,this.properties);return this.cloneInto(n),n}canAppend(e){return!this.text.endsWith("\n")&&Ke.is(e)&&(this.cachedLength<=256||e.cachedLength<=256)}toString(){return this.text}append(e){if(!Ke.is(e))throw new Error("can only append text segment");X.append(this,e),this.text+=e.text,this.cachedLength=this.text.length}removeRange(e,t){let r="";const n=this.text.length;return e>0&&(r+=this.text.substring(0,e)),t<n&&(r+=this.text.substring(t)),this.text=r,this.cachedLength=r.length,0===r.length}createSplitSegmentAt(e){if(e>0){const t=this.text.substring(e);return this.text=this.text.substring(0,e),this.cachedLength=this.text.length,new Ke(t)}}}function We(e){return!0===e.parallelArrays}Ke.type="TextSegment";class $e{constructor(e){this.mergeTree=e,this.gatherText=(e,t,r,n,s,i,o)=>{var a,c;let h=s;if(Ke.is(e)){let t="",r="";if(We(o)){const n=[],s=[];(null===(a=e.properties)||void 0===a?void 0:a["font-weight"])&&n.push("b"),(null===(c=e.properties)||void 0===c?void 0:c["text-decoration"])&&n.push("u");const i=[];if(n.length>0){for(const e of n)o.tagsInProgress.includes(e)||(t+=`<${e}>`,s.push(e));for(const e of o.tagsInProgress)n.includes(e)||(r+=`</${e}>`,i.push(e));for(const e of s.reverse())o.tagsInProgress.push(e)}else for(const e of o.tagsInProgress)r+=`</${e}>`,i.push(e);for(const e of i){const t=o.tagsInProgress.indexOf(e);t>=0&&o.tagsInProgress.splice(t,1)}}o.textSegment.text+=r,o.textSegment.text+=t,h<=0&&i>=e.text.length?o.textSegment.text+=e.text:(h<0&&(h=0),i>=e.text.length?o.textSegment.text+=e.text.substring(h):o.textSegment.text+=e.text.substring(h,i))}else if(o.placeholder&&o.placeholder.length>0)if("*"===o.placeholder){const t=e;o.textSegment.text+=`\n${t.toString()}`}else for(let t=0;t<e.cachedLength;t++)o.textSegment.text+=o.placeholder;else if(We(o)){const t=e;t.hasTileLabel(o.parallelMarkerLabel)&&(o.parallelMarkers.push(t),o.parallelText.push(o.textSegment.text),o.textSegment.text="")}return!0}}getTextAndMarkers(e,t,r,n,s){const i=this.getValidRange(n,s,e,t),o={parallelArrays:!0,parallelMarkerLabel:r,parallelMarkers:[],parallelText:[],tagsInProgress:[],textSegment:new Ke("")};return this.mergeTree.mapRange({leaf:this.gatherText},e,t,o,i.start,i.end),{parallelText:o.parallelText,parallelMarkers:o.parallelMarkers}}getText(e,t,r="",n,s){const i=this.getValidRange(n,s,e,t),o={textSegment:new Ke(""),placeholder:r};return this.mergeTree.mapRange({leaf:this.gatherText},e,t,o,i.start,i.end),o.textSegment.text}getValidRange(e,t,r,n){return{end:null!=t?t:this.mergeTree.getLength(r,n),start:null!=e?e:0}}}class Je{constructor(){this.completed=!1,this.p=new Promise(((e,t)=>{this.res=e,this.rej=t}))}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){void 0!==this.res&&(this.completed=!0,this.res(e))}reject(e){void 0!==this.rej&&(this.completed=!0,this.rej(e))}}Symbol.toStringTag;var Xe=r(9742);const Qe=(e,t)=>Ye.from(e).toString(t);function Ze(e){const t=e;return e instanceof ArrayBuffer||"object"==typeof t&&null!==t&&"number"==typeof t.byteLength&&"function"==typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}class Ye extends Uint8Array{toString(e){return function(e,t){switch(t){case"base64":return Xe.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}(this,e)}static from(e,t,r){if("string"==typeof e)return Ye.fromString(e,t);if(null!==e&&"object"==typeof e&&Ze(e.buffer))return p(0===e.byteOffset,0),p(e.byteLength===e.buffer.byteLength,1),Ye.fromArrayBuffer(e.buffer,t,r);if(Ze(e))return Ye.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const n=null!=t?t:0,s=null!=r?r:e.byteLength-n;if(n<0||n>e.byteLength||s<0||s+n>e.byteLength)throw new RangeError;return new Ye(e,n,s)}static fromString(e,t){switch(t){case"base64":{const t=this.sanitizeBase64(e),r=Xe.toByteArray(t);return new Ye(r.buffer)}case"utf8":case"utf-8":case void 0:{const t=(new TextEncoder).encode(e);return new Ye(t.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!=0&&(t+=["","===","==","="][t.length%4]),t}}var et,tt,rt,nt,st=r(2738);!function(e){e.NoOp="noop",e.ClientJoin="join",e.ClientLeave="leave",e.Propose="propose",e.Reject="reject",e.Summarize="summarize",e.SummaryAck="summaryAck",e.SummaryNack="summaryNack",e.Operation="op",e.RemoteHelp="remoteHelp",e.NoClient="noClient",e.RoundTrip="tripComplete",e.Control="control"}(et||(et={})),function(e){e.ThrottlingError="ThrottlingError",e.InvalidScopeError="InvalidScopeError",e.BadRequestError="BadRequestError",e.LimitExceededError="LimitExceededError"}(tt||(tt={})),function(e){e.NoOp="noop",e.ClientJoin="join",e.ClientLeave="leave",e.Propose="propose",e.Reject="reject",e.Summarize="summarize",e.SummaryAck="summaryAck",e.SummaryNack="summaryNack",e.Operation="op",e.RemoteHelp="remoteHelp",e.NoClient="noClient",e.RoundTrip="tripComplete",e.Control="control"}(rt||(rt={})),function(e){e.ThrottlingError="ThrottlingError",e.InvalidScopeError="InvalidScopeError",e.BadRequestError="BadRequestError",e.LimitExceededError="LimitExceededError"}(nt||(nt={}));const it=window.performance;class ot{constructor(e){this.startTick=e,this.lastTick=e}static start(){const e=it.now();return new ot(e)}trace(){const e=it.now(),t={totalTimeElapsed:e-this.startTick,duration:e-this.lastTick,tick:e};return this.lastTick=e,t}}function at(e,t,r,n){return{combiningOp:n,pos1:e,pos2:t,props:r,type:v.ANNOTATE}}function ct(e,t){return{pos1:e,pos2:t,type:v.REMOVE}}function ht(e,t){return lt(e,t.toJSONObject())}function lt(e,t){return{pos1:e,seg:t,type:v.INSERT}}function ut(...e){return{ops:e,type:v.GROUP}}var dt=r(8991);function pt(e,t,r,n,s,i){let o;switch(void 0!==t.version&&r.send({eventName:"MergeTreeChunk:serializeAsMinSupportedVersion",category:"generic",fromChunkVersion:t.version,toChunkVersion:void 0}),t.version){case void 0:o=t,o.headerMetadata=ft(e,o);break;case"1":const r=t,n=e===yt.header?r.headerMetadata:void 0;o={version:void 0,chunkStartSegmentIndex:r.startIndex,chunkLengthChars:r.length,chunkSegmentCount:r.segmentCount,segmentTexts:r.segments,totalLengthChars:null==n?void 0:n.totalLength,totalSegmentCount:null==n?void 0:n.totalSegmentCount,chunkSequenceNumber:null==n?void 0:n.sequenceNumber,chunkMinSequenceNumber:null==n?void 0:n.minSequenceNumber,headerMetadata:n};break;default:throw new Error(`Unsupported chunk path: ${e} version: ${t.version}`)}return s.stringify(o,i)}function gt(e,t,r,n,s,i){const o=mt(e,t,0,n);return s.stringify(o,i)}function mt(e,t,r,n){switch(t.version){case void 0:{const r=t;return{version:"1",length:r.chunkLengthChars,segmentCount:r.chunkSegmentCount,headerMetadata:ft(e,r),segments:r.segmentTexts,startIndex:r.chunkStartSegmentIndex}}case"1":return t;default:throw new Error(`Unsupported chunk path: ${e} version: ${t.version}`)}}function ft(e,t,r){if(e===yt.header){if(void 0!==t.headerMetadata)return t.headerMetadata;const e=[{id:yt.header}];return t.chunkLengthChars<t.totalLengthChars&&e.push({id:yt.body}),{orderedChunkMetadata:e,minSequenceNumber:t.chunkMinSequenceNumber,sequenceNumber:t.chunkSequenceNumber,totalLength:t.totalLengthChars,totalSegmentCount:t.totalSegmentCount}}}class yt{constructor(e,t,r,n){var s,i;this.mergeTree=e,this.filename=r,this.onCompletion=n,this.logger=st.G2.create(t,"Snapshot"),this.chunkSize=null!==(i=null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.mergeTreeSnapshotChunkSize)&&void 0!==i?i:yt.sizeOfFirstChunk}getSeqLengthSegs(e,t,r,n=0){const s=[];let i=0,o=0;for(;i<r&&n+o<e.length;){const r=e[n+o];s.push(r),i+=t[n+o],o++}return{version:void 0,chunkStartSegmentIndex:n,chunkSegmentCount:o,chunkLengthChars:i,totalLengthChars:this.header.segmentsTotalLength,totalSegmentCount:e.length,chunkSequenceNumber:this.header.seq,segmentTexts:s}}emit(e,t,r){var n,s;const i=this.getSeqLengthSegs(this.segments,this.segmentLengths,this.chunkSize);let o=i.chunkLengthChars,a=i.chunkSegmentCount;const c=new dt.x1;if(c.addBlob(yt.header,pt(yt.header,i,this.logger,this.mergeTree.options,t,r)),i.chunkSegmentCount<i.totalSegmentCount){const e=this.getSeqLengthSegs(this.segments,this.segmentLengths,this.header.segmentsTotalLength,i.chunkSegmentCount);o+=e.chunkLengthChars,a+=e.chunkSegmentCount,c.addBlob(yt.body,pt(yt.body,e,this.logger,this.mergeTree.options,t,r))}return N(o===this.header.segmentsTotalLength,93),N(a===i.totalSegmentCount,94),void 0!==e&&e.length>0&&c.addBlob(null!==(s=null===(n=this.mergeTree.options)||void 0===n?void 0:n.catchUpBlobName)&&void 0!==s?s:yt.catchupOps,t?t.stringify(e,r):JSON.stringify(e)),c.getSummaryTree()}extractSync(){const e=this.mergeTree.getCollabWindow();this.seq=e.minSeq,this.header={segmentsTotalLength:this.mergeTree.getLength(this.mergeTree.collabWindow.minSeq,F),seq:this.mergeTree.collabWindow.minSeq};const t=[];let r;this.mergeTree.map({leaf:(e,n,s,i,o,a)=>(e.seq!==P&&e.seq<=this.seq&&(void 0===e.removedSeq||e.removedSeq===P||e.removedSeq>this.seq)&&((null==r?void 0:r.canAppend(e))&&D(r.properties,e.properties)?(r=r.clone(),r.append(e.clone())):(r&&t.push(r),r=e)),!0)},this.seq,F,void 0),r&&t.push(r),this.segments=[],this.segmentLengths=[];let n=0;return t.map((e=>{n+=e.cachedLength,this.segments.push(e.toJSONObject()),this.segmentLengths.push(e.cachedLength)})),this.header.segmentsTotalLength!==n&&(this.logger.sendErrorEvent({eventName:"SegmentsTotalLengthMismatch",totalLength:n,segmentsTotalLength:this.header.segmentsTotalLength}),this.header.segmentsTotalLength=n),this.segments}}yt.header="header",yt.body="body",yt.catchupOps="catchupOps",yt.sizeOfFirstChunk=1e4;const vt=(e,t)=>St.from(e).toString(t);function bt(e){const t=e;return e instanceof ArrayBuffer||"object"==typeof t&&null!==t&&"number"==typeof t.byteLength&&"function"==typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}class St extends Uint8Array{toString(e){return function(e,t){switch(t){case"base64":return Xe.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}(this,e)}static from(e,t,r){if("string"==typeof e)return St.fromString(e,t);if(null!==e&&"object"==typeof e&&bt(e.buffer))return N(0===e.byteOffset,0),N(e.byteLength===e.buffer.byteLength,1),St.fromArrayBuffer(e.buffer,t,r);if(bt(e))return St.fromArrayBuffer(e,t,r);throw new TypeError}static fromArrayBuffer(e,t,r){const n=null!=t?t:0,s=null!=r?r:e.byteLength-n;if(n<0||n>e.byteLength||s<0||s+n>e.byteLength)throw new RangeError;return new St(e,n,s)}static fromString(e,t){switch(t){case"base64":{const t=this.sanitizeBase64(e),r=Xe.toByteArray(t);return new St(r.buffer)}case"utf8":case"utf-8":case void 0:{const t=(new TextEncoder).encode(e);return new St(t.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!=0&&(t+=["","===","==","="][t.length%4]),t}}class wt{constructor(e,t,r,n,s){var i,o;this.mergeTree=e,this.getLongClientId=r,this.filename=n,this.onCompletion=s,this.logger=st.G2.create(t,"Snapshot"),this.chunkSize=null!==(o=null===(i=null==e?void 0:e.options)||void 0===i?void 0:i.mergeTreeSnapshotChunkSize)&&void 0!==o?o:wt.chunkSize;const{currentSeq:a,minSeq:c}=e.getCollabWindow();this.header={minSequenceNumber:c,sequenceNumber:a,orderedChunkMetadata:[],totalLength:0,totalSegmentCount:0},this.segments=[],this.segmentLengths=[]}getSeqLengthSegs(e,t,r,n=0){const s=[];let i=0,o=0;for(;i<r&&n+o<e.length;){const r=e[n+o];s.push(r),i+=t[n+o],o++}return{version:"1",segmentCount:o,length:i,segments:s,startIndex:n,headerMetadata:void 0}}emit(e,t){const r=[];this.header.totalSegmentCount=0,this.header.totalLength=0;do{const e=this.getSeqLengthSegs(this.segments,this.segmentLengths,this.chunkSize,this.header.totalSegmentCount);r.push(e),this.header.totalSegmentCount+=e.segmentCount,this.header.totalLength+=e.length}while(this.header.totalSegmentCount<this.segments.length);const n=r.shift();n.headerMetadata=this.header,n.headerMetadata.orderedChunkMetadata=[{id:yt.header}];const s=[];r.forEach(((r,n)=>{const i=`${yt.body}_${n}`;this.header.orderedChunkMetadata.push({id:i}),s.push([i,gt(i,r,this.logger,this.mergeTree.options,e,t)])}));const i=new dt.x1;return i.addBlob(yt.header,gt(yt.header,n,this.logger,this.mergeTree.options,e,t)),s.forEach((e=>{i.addBlob(e[0],e[1])})),i.getSummaryTree()}extractSync(){const e=this.mergeTree,t=this.header.minSequenceNumber,r=(e,t)=>{this.segments.push(e),this.segmentLengths.push(t)},n=e=>{e&&r(e.toJSONObject(),e.cachedLength)};let s;return e.walkAllSegments(e.root,(e=>{var i;if(e.seq===P||e.removedSeq<=t)return!0;if(e.seq<=t&&(void 0===e.removedSeq||e.removedSeq===P))s?s.canAppend(e)&&D(s.properties,e.properties)?(s=s.clone(),s.append(e.clone())):(n(s),s=e):s=e;else{n(s),s=void 0;const o={json:e.toJSONObject()};e.seq>t&&(o.seq=e.seq,o.client=this.getLongClientId(e.clientId)),void 0!==e.removedSeq&&(N(e.removedSeq!==P&&e.removedSeq>t,101),o.removedSeq=e.removedSeq,o.removedClient=void 0!==e.removedClientIds?this.getLongClientId(e.removedClientIds[0]):void 0,o.removedClientIds=null===(i=e.removedClientIds)||void 0===i?void 0:i.map((e=>this.getLongClientId(e)))),N(void 0!==o.seq&&void 0!==o.client||void 0!==o.removedSeq&&void 0!==o.removedClient,102),r(o,e.cachedLength)}return!0}),this),n(s),this.segments}static async loadChunk(e,t,r,n,s){const i=await e.readBlob(t),o=vt(i,"utf8");return wt.processChunk(t,o,r,n,s)}static processChunk(e,t,r,n,s){return mt(e,s?s.parse(t):JSON.parse(t))}}wt.chunkSize=1e4;class xt{constructor(e,t,r,n,s){this.runtime=e,this.client=t,this.mergeTree=r,this.serializer=s,this.specToSegment=e=>{var t;let r;return function(e){return!!e&&"object"==typeof e&&"json"in e}(e)?(r=this.client.specToSegment(e.json),r.clientId=void 0!==e.client?this.client.getOrAddShortClientId(e.client):F,r.seq=void 0!==e.seq?e.seq:0,void 0!==e.removedSeq&&(r.removedSeq=e.removedSeq),void 0!==e.removedClient&&(r.removedClientIds=[this.client.getOrAddShortClientId(e.removedClient)]),void 0!==e.removedClientIds&&(r.removedClientIds=null===(t=e.removedClientIds)||void 0===t?void 0:t.map((e=>this.client.getOrAddShortClientId(e))))):(r=this.client.specToSegment(e),r.seq=0,r.clientId=F),r},this.logger=st.G2.create(n,"SnapshotLoader")}async initialize(e){const t=e.readBlob(yt.header).then((e=>(N(!!e,95),this.loadHeader(vt(e,"utf8"))))),r=this.loadBodyAndCatchupOps(t,e);return r.catch((e=>this.logger.sendErrorEvent({eventName:"CatchupOpsLoadFailure"},e))),await t,{catchupOpsP:r}}async loadBodyAndCatchupOps(e,t){const r=t.list(""),n=await e;await this.loadBody(n,t);const s=await r;if(s.length===n.headerMetadata.orderedChunkMetadata.length+1)return n.headerMetadata.orderedChunkMetadata.forEach((e=>s.splice(s.indexOf(e.id),1))),N(1===s.length,96),this.loadCatchupOps(t.readBlob(s[0]));if(s.length!==n.headerMetadata.orderedChunkMetadata.length)throw new Error("Unexpected blobs in snapshot");return[]}loadHeader(e){var t;const r=wt.processChunk(yt.header,e,this.logger,this.mergeTree.options,this.serializer),s=r.segments.map(this.specToSegment);if(this.mergeTree.reloadFromSegments(s),void 0===r.headerMetadata)throw new Error("header metadata not available");return this.runtime.attachState!==n.mB.Detached&&this.client.startOrUpdateCollaboration(null!==(t=this.runtime.clientId)&&void 0!==t?t:"snapshot",void 0!==r.headerMetadata.minSequenceNumber?r.headerMetadata.minSequenceNumber:r.headerMetadata.sequenceNumber,r.headerMetadata.sequenceNumber),r}async loadBody(e,t){if(N(e.length<=e.headerMetadata.totalLength,97),N(e.segmentCount<=e.headerMetadata.totalSegmentCount,98),e.segmentCount===e.headerMetadata.totalSegmentCount)return;const r=[];let n=e.length;for(let s=1;s<e.headerMetadata.orderedChunkMetadata.length;s++){const i=await wt.loadChunk(t,e.headerMetadata.orderedChunkMetadata[s].id,this.logger,this.mergeTree.options,this.serializer);n+=i.length,r.push(...i.segments.map(this.specToSegment))}N(n===e.headerMetadata.totalLength,99),N(e.segmentCount+r.length===e.headerMetadata.totalSegmentCount,100);const s=this.mergeTree,i=(e,t,r)=>{s.insertSegments(s.root.cachedLength,e,0,t,r,void 0)},o=[],a=()=>{o.length>0&&i(o,F,0)};for(const e of r){const t=e.clientId,r=e.seq;t===F&&0===r?o.push(e):(a(),i([e],t,r))}a()}async loadCatchupOps(e){return JSON.parse(vt(await e,"utf8"))}}function Ct(e){return 1e3*e.trace().duration}class Et{constructor(e,t,r){this.specToSegment=e,this.logger=t,this.measureOps=!1,this.accumTime=0,this.localTime=0,this.localOps=0,this.accumWindowTime=0,this.accumWindow=0,this.accumOps=0,this.maxWindowTime=0,this.clientNameToIds=new G(Me),this.shortClientIdMap=[],this.pendingConsensus=new Map,this.mergeTree=new Ge(r)}get mergeTreeDeltaCallback(){return this.mergeTree.mergeTreeDeltaCallback}set mergeTreeDeltaCallback(e){this.mergeTree.mergeTreeDeltaCallback=e}get mergeTreeMaintenanceCallback(){return this.mergeTree.mergeTreeMaintenanceCallback}set mergeTreeMaintenanceCallback(e){this.mergeTree.mergeTreeMaintenanceCallback=e}peekPendingSegmentGroups(e=1){var t,r;if(1===e)return null===(t=this.mergeTree.pendingSegments)||void 0===t?void 0:t.last();let n=0;return null===(r=this.mergeTree.pendingSegments)||void 0===r?void 0:r.some((()=>n<e&&(n++,!0)),!0)}annotateMarkerNotifyConsensus(e,t,r){const n=this.annotateMarker(e,t,{name:"consensus"});if(n){const t={callback:r,marker:e};return this.pendingConsensus.set(e.getId(),t),n}}annotateMarker(e,t,r){const n=function(e,t,r){const n=e.getId();if(n)return{combiningOp:r,props:t,relativePos1:{id:n,before:!0},relativePos2:{id:n},type:v.ANNOTATE}}(e,t,r);return this.applyAnnotateRangeOp({op:n})?n:void 0}annotateRangeLocal(e,t,r,n){const s=at(e,t,r,n);if(this.applyAnnotateRangeOp({op:s}))return s}removeRangeLocal(e,t){const r=ct(e,t);if(this.applyRemoveRangeOp({op:r}))return r}insertSegmentLocal(e,t){if(t.cachedLength<=0)return;const r=ht(e,t);return this.applyInsertOp({op:r})?r:void 0}insertAtReferencePositionLocal(e,t){const r=this.mergeTree.referencePositionToLocalPosition(e,this.getCurrentSeq(),this.getClientId());if(r===$.DetachedPosition)return;const n=ht(r,t),s={op:n};let i;return this.measureOps&&(i=ot.start()),this.mergeTree.insertAtReferencePosition(e,t,s),this.completeAndLogOp(s,this.getClientSequenceArgs(s),{start:n.pos1},i),n}walkSegments(e,t,r,n,s=!1){this.mergeTree.mapRange({leaf:e},this.getCurrentSeq(),this.getClientId(),n,t,r,s)}serializeGCData(e,t){this.mergeTree.walkAllSegments(this.mergeTree.root,(r=>(void 0===r.removedSeq&&t.stringify(r.clone().toJSONObject(),e),!0)))}getCollabWindow(){return this.mergeTree.getCollabWindow()}getPosition(e){return void 0===(null==e?void 0:e.parent)?-1:this.mergeTree.getPosition(e,this.getCurrentSeq(),this.getClientId())}addLocalReference(e){return this.mergeTree.addLocalReference(e)}removeLocalReference(e){return this.removeLocalReferencePosition(e)}createLocalReferencePosition(e,t,r,n){return this.mergeTree.createLocalReferencePosition(e,t,r,n,this)}removeLocalReferencePosition(e){return this.mergeTree.removeLocalReferencePosition(e)}localReferencePositionToPosition(e){return this.mergeTree.referencePositionToLocalPosition(e)}posFromRelativePos(e){return this.mergeTree.posFromRelativePos(e)}getMarkerFromId(e){return this.mergeTree.getMarkerFromId(e)}applyRemoveRangeOp(e){N(e.op.type===v.REMOVE,45);const t=e.op,r=this.getClientSequenceArgs(e),n=this.getValidOpRange(t,r);if(!n)return!1;let s;return this.measureOps&&(s=ot.start()),this.mergeTree.markRangeRemoved(n.start,n.end,r.referenceSequenceNumber,r.clientId,r.sequenceNumber,!1,e),this.completeAndLogOp(e,r,n,s),!0}applyAnnotateRangeOp(e){N(e.op.type===v.ANNOTATE,46);const t=e.op,r=this.getClientSequenceArgs(e),n=this.getValidOpRange(t,r);if(!n)return!1;let s;return this.measureOps&&(s=ot.start()),this.mergeTree.annotateRange(n.start,n.end,t.props,t.combiningOp,r.referenceSequenceNumber,r.clientId,r.sequenceNumber,e),this.completeAndLogOp(e,r,n,s),!0}applyInsertOp(e){N(e.op.type===v.INSERT,47);const t=e.op,r=this.getClientSequenceArgs(e),n=this.getValidOpRange(t,r);if(!n)return!1;let s,i;return t.seg&&(s=[this.specToSegment(t.seg)]),!(!s||0===s.length||(this.measureOps&&(i=ot.start()),this.mergeTree.insertSegments(n.start,s,r.referenceSequenceNumber,r.clientId,r.sequenceNumber,e),this.completeAndLogOp(e,r,n,i),0))}completeAndLogOp(e,t,r,n){e.sequencedMessage?(N(this.mergeTree.getCollabWindow().currentSeq<t.sequenceNumber,48),N(this.mergeTree.getCollabWindow().minSeq<=e.sequencedMessage.minimumSequenceNumber,49),n&&(this.accumTime+=Ct(n),this.accumOps++,this.accumWindow+=this.getCurrentSeq()-this.getCollabWindow().minSeq)):n&&(this.localTime+=Ct(n),this.localOps++)}getValidOpRange(e,t){let r=e.pos1;void 0===r&&e.relativePos1&&(r=this.mergeTree.posFromRelativePos(e.relativePos1,t.referenceSequenceNumber,t.clientId));let n=e.pos2;if(void 0===n&&e.relativePos2&&(n=this.mergeTree.posFromRelativePos(e.relativePos2,t.referenceSequenceNumber,t.clientId)),t.clientId===this.getClientId()){const t=this.getLength(),s=[];if((void 0===r||r<0||r>t||r===t&&e.type!==v.INSERT)&&s.push("start"),e.type===v.INSERT&&void 0===n||(void 0===n||n<=r)&&s.push("end"),s.length>0)throw new Q.j4("RangeOutOfBounds",{usageError:!0,end:n,invalidPositions:s.toString(),length:t,opPos1:e.pos1,opPos1Relative:void 0!==e.relativePos1,opPos2:e.pos2,opPos2Relative:void 0!==e.relativePos2,opType:e.type,start:r})}return{start:r,end:n}}getClientSequenceArgsForMessage(e){if(e)return{clientId:this.getOrAddShortClientId(e.clientId),referenceSequenceNumber:e.referenceSequenceNumber,sequenceNumber:e.sequenceNumber};{const e=this.getCollabWindow();return{clientId:e.clientId,referenceSequenceNumber:e.currentSeq,sequenceNumber:this.getLocalSequenceNumber()}}}getClientSequenceArgs(e){return this.getClientSequenceArgsForMessage(e.sequencedMessage)}ackPendingSegment(e){const t=e=>{let t;this.measureOps&&(t=ot.start()),this.mergeTree.ackPendingSegment(e),e.op.type===v.ANNOTATE&&e.op.combiningOp&&"consensus"===e.op.combiningOp.name&&this.updateConsensusProperty(e.op,e.sequencedMessage),t&&(this.accumTime+=Ct(t),this.accumOps++,this.accumWindow+=this.getCurrentSeq()-this.getCollabWindow().minSeq)};if(e.op.type===v.GROUP)for(const r of e.op.ops)t({groupOp:e.op,op:r,sequencedMessage:e.sequencedMessage});else t(e)}cloneFromSegments(){const e=new Et(this.specToSegment,this.logger,this.mergeTree.options),t=this.mergeTree.blockClone(this.mergeTree.root,[]);return e.mergeTree.root=t,e}getOrAddShortClientId(e){return this.clientNameToIds.get(e)||this.addLongClientId(e),this.getShortClientId(e)}getShortClientId(e){return this.clientNameToIds.get(e).data}getLongClientId(e){return e>=0?this.shortClientIdMap[e]:"original"}addLongClientId(e){this.clientNameToIds.put(e,this.shortClientIdMap.length),this.shortClientIdMap.push(e)}findReconnectionPosition(e,t){N(t<=this.mergeTree.collabWindow.localSeq,50);let r=0;return this.mergeTree.walkAllSegments(this.mergeTree.root,(n=>n!==e&&((void 0===n.localSeq||n.localSeq<=t)&&(void 0===n.removedSeq||n.localRemovedSeq>t)&&(r+=n.cachedLength),!0))),r}rebasePosition(e,t,r){let n;N(r<=this.mergeTree.collabWindow.localSeq,768);let s=0,i=e;this.mergeTree.walkAllSegments(this.mergeTree.root,(o=>(N(void 0!==o.seq||void 0!==o.localSeq,769),n=o,(e=>void 0!==e.seq&&e.seq!==P&&e.seq<=t||void 0!==e.localSeq&&e.localSeq<=r)(o)&&!(({removedSeq:e,localRemovedSeq:n})=>void 0!==e&&e!==P&&e<=t||void 0!==n&&n<=r)(o)&&(s+=o.cachedLength,i>=o.cachedLength&&(i-=o.cachedLength)),s<=e))),N(void 0!==n,770);const o=this.getCollabWindow().currentSeq;return(void 0!==n.removedSeq&&n.removedSeq!==P&&n.removedSeq<=o||void 0!==n.localRemovedSeq&&n.localRemovedSeq<=r)&&(i=0),N(0<=i&&i<n.cachedLength,771),this.findReconnectionPosition(n,r)+i}resetPendingDeltaToOps(e,t){var r,n;N(!!t,51),N(t===(null===(r=this.mergeTree.pendingSegments)||void 0===r?void 0:r.dequeue()),52);const s=[];for(const r of t.segments.sort(((e,t)=>e.ordinal<t.ordinal?-1:1))){N(t===r.segmentGroups.dequeue(),53);const i=this.findReconnectionPosition(r,t.localSeq);let o;switch(e.type){case v.ANNOTATE:N(!0===(null===(n=r.propertyManager)||void 0===n?void 0:n.hasPendingProperties()),54),void 0!==r.removedSeq&&void 0===r.localRemovedSeq||(o=at(i,i+r.cachedLength,e.props,e.combiningOp));break;case v.INSERT:N(r.seq===P,55);let t=r;"object"==typeof e.seg&&void 0!==e.seg.props&&(t=r.clone(),t.properties=e.seg.props),o=ht(i,t);break;case v.REMOVE:void 0!==r.localRemovedSeq&&(o=ct(i,i+r.cachedLength));break;default:throw new Error("Invalid op type")}if(o){const e={segments:[],localSeq:t.localSeq};r.segmentGroups.enqueue(e),this.mergeTree.pendingSegments.enqueue(e),s.push(o)}}return s}applyRemoteOp(e){const t=e.op,r=e.sequencedMessage;switch(this.getOrAddShortClientId(r.clientId),t.type){case v.INSERT:this.applyInsertOp(e);break;case v.REMOVE:this.applyRemoveRangeOp(e);break;case v.ANNOTATE:this.applyAnnotateRangeOp(e);break;case v.GROUP:for(const e of t.ops)this.applyRemoteOp({op:e,groupOp:t,sequencedMessage:r})}}applyStashedOp(e){let t;switch(e.type){case v.INSERT:this.applyInsertOp({op:e}),t=this.peekPendingSegmentGroups();break;case v.REMOVE:this.applyRemoveRangeOp({op:e}),t=this.peekPendingSegmentGroups();break;case v.ANNOTATE:this.applyAnnotateRangeOp({op:e}),t=this.peekPendingSegmentGroups();break;case v.GROUP:return e.ops.map((e=>this.applyStashedOp(e)));default:!function(e,t="Unreachable Case"){throw new Error(t)}(0,"unrecognized op type")}return N(!!t,731),t}applyMsg(e,t=!1){var r;if(this.getOrAddShortClientId(e.clientId),e.type===rt.Operation){const n={op:e.contents,sequencedMessage:e};(null===(r=n.sequencedMessage)||void 0===r?void 0:r.clientId)===this.longClientId||t?this.ackPendingSegment(n):this.applyRemoteOp(n)}this.updateSeqNumbers(e.minimumSequenceNumber,e.sequenceNumber)}updateSeqNumbers(e,t){const r=this.mergeTree.getCollabWindow();N(r.currentSeq<=t,56),r.currentSeq=t,N(e<=t,57),this.updateMinSeq(e)}resolveRemoteClientPosition(e,t,r){const n=this.getOrAddShortClientId(r);return this.mergeTree.resolveRemoteClientPosition(e,t,n)}regeneratePendingOp(e,t){const r=[];if(e.type===v.GROUP)if(Array.isArray(t)){N(e.ops.length===t.length,58);for(let n=0;n<e.ops.length;n++)r.push(...this.resetPendingDeltaToOps(e.ops[n],t[n]))}else N(1===e.ops.length,59),r.push(...this.resetPendingDeltaToOps(e.ops[0],t));else N(e.type!==v.GROUP,60),N(!Array.isArray(t),61),r.push(...this.resetPendingDeltaToOps(e,t));return 1===r.length?r[0]:ut(...r)}createTextHelper(){return new $e(this.mergeTree)}summarize(e,t,r,n){var s;const i=e.deltaManager,o=i.minimumSequenceNumber;if(this.updateSeqNumbers(o,i.lastSequenceNumber),N(this.getCollabWindow().minSeq===o,62),!0===(null===(s=this.mergeTree.options)||void 0===s?void 0:s.newMergeTreeSnapshotFormat)){N(void 0===n||0===n.length,63);const e=new wt(this.mergeTree,this.logger,(e=>this.getLongClientId(e)));return e.extractSync(),e.emit(r,t)}{const e=new yt(this.mergeTree,this.logger);return e.extractSync(),e.emit(n,r,t)}}async load(e,t,r){return new xt(e,this,this.mergeTree,this.logger,r).initialize(t)}getStackContext(e,t){return this.mergeTree.getStackContext(e,this.getCollabWindow().clientId,t)}getLocalSequenceNumber(){return this.getCollabWindow().collaborating?P:0}localTransaction(e){for(const t of e.ops){const r={op:t,groupOp:e};switch(t.type){case v.INSERT:this.applyInsertOp(r);break;case v.ANNOTATE:this.applyAnnotateRangeOp(r);break;case v.REMOVE:this.applyRemoveRangeOp(r)}}}updateConsensusProperty(e,t){const r=e.relativePos1.id,n=this.pendingConsensus.get(r);n&&n.marker.addProperties(e.props,e.combiningOp,t.sequenceNumber),this.mergeTree.addMinSeqListener(t.sequenceNumber,(()=>n.callback(n.marker)))}updateMinSeq(e){let t;if(this.measureOps&&(t=ot.start()),this.mergeTree.setMinSeq(e),t){const e=Ct(t);this.accumWindowTime+=e,e>this.maxWindowTime&&(this.maxWindowTime=e)}}getContainingSegment(e,t){const r=this.getClientSequenceArgsForMessage(t);return this.mergeTree.getContainingSegment(e,r.referenceSequenceNumber,r.clientId)}getSlideToSegment(e){return this.mergeTree._getSlideToSegment(e)}getPropertiesAtPosition(e){let t;const r=this.getContainingSegment(e).segment;return r&&(t=r.properties),t}getRangeExtentsOfPosition(e){let t,r;const n=this.getContainingSegment(e).segment;return n&&(t=this.getPosition(n),r=t+n.cachedLength),{posStart:t,posAfterEnd:r}}getCurrentSeq(){return this.getCollabWindow().currentSeq}getClientId(){return this.getCollabWindow().clientId}getLength(){return this.mergeTree.length}startOrUpdateCollaboration(e,t=0,r=0){if(void 0!==e)if(void 0===this.longClientId)this.longClientId=e,this.addLongClientId(this.longClientId),this.mergeTree.startCollaboration(this.getShortClientId(this.longClientId),t,r);else{const t=this.longClientId,r=this.clientNameToIds.get(t).data;this.longClientId=e,this.clientNameToIds.put(e,r),this.shortClientIdMap[r]=e}}findTile(e,t,r=!0){const n=this.getClientId();return this.mergeTree.findTile(e,n,t,r)}}var At=r(8597),Tt=r(7583),Ot=r(8343),Nt=r(4148);class Pt{constructor(e,t){this.value=e,this.valueType=t}get type(){return this.valueType.name}makeSerialized(e,t){const r=this.valueType.factory.store(this.value),n=(0,Ot.Yv)(r,e,t);return{type:this.type,value:n}}getOpHandler(e){const t=this.valueType.ops.get(e);if(!t)throw new Error("Unknown type message");return t}}class Rt{constructor(e,t,r,n,s=new m){this.serializer=e,this.handle=t,this.submitMessage=r,this.type=n,this.eventEmitter=s,this.messageHandlers=new Map,this.data=new Map,this.messageHandlers=this.getMessageHandlers()}get size(){return this.data.size}keys(){return this.data.keys()}entries(){const e=this.data.entries();return{next(){const t=e.next();return t.done?{value:void 0,done:!0}:{value:[t.value[0],t.value[1].value],done:!1}},[Symbol.iterator](){return this}}}values(){const e=this.data.values();return{next(){const t=e.next();return t.done?{value:void 0,done:!0}:{value:t.value.value,done:!1}},[Symbol.iterator](){return this}}}[Symbol.iterator](){return this.entries()}forEach(e){this.data.forEach(((t,r,n)=>{e(t.value,r,n)}))}get(e){var t;return(null!==(t=this.data.get(e))&&void 0!==t?t:this.createCore(e,!0)).value}has(e){return this.data.has(e)}getSerializedStorage(e){const t={};return this.data.forEach(((r,n)=>{t[n]=r.makeSerialized(e,this.handle)})),t}getSerializableStorage(e){const t={};return this.data.forEach(((r,n)=>{t[n]=function(e,t,r){const n=e.makeSerialized(t,r);return{type:n.type,value:n.value&&JSON.parse(n.value)}}(r,e,this.handle)})),t}serialize(e){return JSON.stringify(this.getSerializableStorage(e))}populateFromSerializable(e){for(const[t,r]of Object.entries(e)){if(r.type===Nt.G[Nt.G.Plain]||r.type===Nt.G[Nt.G.Shared])continue;const e={key:t.startsWith("intervalCollections/")?t.substring(20):t,value:this.makeLocal(t,r)};this.data.set(e.key,e.value)}}populate(e){this.populateFromSerializable(JSON.parse(e))}tryResubmitMessage(e,t){const r=e.type,n=this.messageHandlers.get(r);return void 0!==n&&(n.resubmit(e,t),!0)}tryGetStashedOpLocalMetadata(e){const t=e.type;if(this.messageHandlers.has(t))return this.messageHandlers.get(t).getStashedOpLocalMetadata(e);throw new Error("no apply stashed op handler")}tryProcessMessage(e,t,r,n){const s=this.messageHandlers.get(e.type);return void 0!==s&&(s.process(e,t,r,n),!0)}createCore(e,t){const r=new Pt(this.type.factory.load(this.makeMapValueOpEmitter(e),void 0),this.type),n=this.data.get(e);this.data.set(e,r);const s={key:e,previousValue:n};return this.eventEmitter.emit("create",s,t,this.eventEmitter),r}makeLocal(e,t){p(t.type!==Nt.G[Nt.G.Plain]&&t.type!==Nt.G[Nt.G.Shared],737),t.value=(0,Ot.lB)(t.value,this.serializer);const r=this.type.factory.load(this.makeMapValueOpEmitter(e),t.value);return new Pt(r,this.type)}getMessageHandlers(){const e=new Map;return e.set("act",{process:(e,t,r,n)=>{var s;const i=null!==(s=this.data.get(e.key))&&void 0!==s?s:this.createCore(e.key,t),o=i.getOpHandler(e.value.opName),a=i.value,c=(0,Ot.lB)(e.value.value,this.serializer);o.process(a,c,t,r,n);const h={key:e.key,previousValue:a};this.eventEmitter.emit("valueChanged",h,t,r,this.eventEmitter)},submit:(e,t)=>{this.submitMessage(e,t)},resubmit:(e,t)=>{const r=this.data.get(e.key),n=r.getOpHandler(e.value.opName),{rebasedOp:s,rebasedLocalOpMetadata:i}=n.rebase(r.value,e.value,t);this.submitMessage(Object.assign(Object.assign({},e),{value:s}),i)},getStashedOpLocalMetadata:e=>{p(!1,22)}}),e}makeMapValueOpEmitter(e){return{emit:(t,r,n,s)=>{const i=(0,Ot.i8)(n,this.serializer,this.handle),o={key:e,type:"act",value:{opName:t,value:i}};this.submitMessage(o,s);const a={key:e,previousValue:r};this.eventEmitter.emit("valueChanged",a,!0,null,this.eventEmitter)}}}}class It{constructor(){this.ordinalSortedItems=[]}get size(){return this.ordinalSortedItems.length}get items(){return this.ordinalSortedItems}addOrUpdate(e,t){const r=this.findOrdinalPosition(this.getOrdinal(e));r.exists?t&&t(this.ordinalSortedItems[r.index],e):this.ordinalSortedItems.splice(r.index,0,e)}remove(e){const t=this.findOrdinalPosition(this.getOrdinal(e));return!!t.exists&&(this.ordinalSortedItems.splice(t.index,1),!0)}has(e){return this.findOrdinalPosition(this.getOrdinal(e)).exists}getOrdinal(e){const t=e;return(null==t?void 0:t.segment)?t.segment.ordinal:e.ordinal}findOrdinalPosition(e,t,r){if(0===this.ordinalSortedItems.length)return{exists:!1,index:0};if(void 0===t||void 0===r)return this.findOrdinalPosition(e,0,this.ordinalSortedItems.length-1);const n=t+Math.floor((r-t)/2);return this.getOrdinal(this.ordinalSortedItems[n])>e?t===n?{exists:!1,index:n}:this.findOrdinalPosition(e,t,n-1):this.getOrdinal(this.ordinalSortedItems[n])<e?n===r?{exists:!1,index:n+1}:this.findOrdinalPosition(e,n+1,r):{exists:!0,index:n}}}class Ft{constructor(e,t){this.deltaArgs=e,this.mergeTreeClient=t,p(e.deltaSegments.length>0,728),this.isEmpty=!1,this.deltaOperation=e.operation,this.sortedRanges=new Mt((()=>{const e=new It;return this.deltaArgs.deltaSegments.forEach((t=>{const r={operation:this.deltaArgs.operation,position:this.mergeTreeClient.getPosition(t.segment),propertyDeltas:t.propertyDeltas,segment:t.segment};e.addOrUpdate(r)})),e})),this.pFirst=new Mt((()=>this.sortedRanges.value.items[0])),this.pLast=new Mt((()=>this.sortedRanges.value.items[this.sortedRanges.value.size-1]))}get ranges(){return this.sortedRanges.value.items}get clientId(){return this.mergeTreeClient.longClientId}get first(){return this.pFirst.value}get last(){return this.pLast.value}}class kt extends Ft{constructor(e,t,r){super(t,r),this.opArgs=e,this.isLocal=void 0===e.sequencedMessage}}class Dt extends Ft{constructor(e,t,r){super(t,r),this.opArgs=e}}class Mt{constructor(e){this.valueGenerator=e,this.pEvaluated=!1}get evaluated(){return this.pEvaluated}get value(){return this.pEvaluated||(this.pEvaluated=!0,this.pValue=this.valueGenerator()),this.pValue}}const qt="header",Lt="content";class Bt extends Tt.h{constructor(e,t,r,n){super(t,e,r,"fluid_sequence_"),this.dataStoreRuntime=e,this.id=t,this.segmentFromSpec=n,this.loadedDeferred=new Je,this.loadedDeferredOutgoingOps=[],this.deferIncomingOps=!0,this.loadedDeferredIncomingOps=[],this.messagesSinceMSNChange=[],this.loadedDeferred.promise.catch((e=>{this.logger.sendErrorEvent({eventName:"SequenceLoadFailed"},e)})),this.client=new Et(n,st.G2.create(this.logger,"SharedSegmentSequence.MergeTreeClient"),e.options),super.on("newListener",(e=>{switch(e){case"sequenceDelta":this.client.mergeTreeDeltaCallback||(this.client.mergeTreeDeltaCallback=(e,t)=>{this.emit("sequenceDelta",new kt(e,t,this.client),this)});break;case"maintenance":this.client.mergeTreeMaintenanceCallback||(this.client.mergeTreeMaintenanceCallback=(e,t)=>{this.emit("maintenance",new Dt(t,e,this.client),this)})}})),super.on("removeListener",(e=>{switch(e){case"sequenceDelta":0===super.listenerCount(e)&&(this.client.mergeTreeDeltaCallback=void 0);break;case"maintenance":0===super.listenerCount(e)&&(this.client.mergeTreeMaintenanceCallback=void 0)}})),this.intervalCollections=new Rt(this.serializer,this.handle,((e,t)=>this.submitLocalMessage(e,t)),new ce)}get loaded(){return this.loadedDeferred.promise}static createOpsFromDelta(e){var t,r;const n=[];for(const s of e.ranges)switch(e.deltaOperation){case v.ANNOTATE:{const e=n[n.length-1],i={};for(const e of Object.keys(s.propertyDeltas))i[e]=null!==(r=null===(t=s.segment.properties)||void 0===t?void 0:t[e])&&void 0!==r?r:null;e&&e.pos2===s.position&&D(e.props,i)?e.pos2+=s.segment.cachedLength:n.push(at(s.position,s.position+s.segment.cachedLength,i,void 0));break}case v.INSERT:n.push(lt(s.position,s.segment.clone().toJSONObject()));break;case v.REMOVE:{const e=n[n.length-1];(null==e?void 0:e.pos1)===s.position?e.pos2+=s.segment.cachedLength:n.push(ct(s.position,s.position+s.segment.cachedLength));break}}return n}removeRange(e,t){const r=this.client.removeRangeLocal(e,t);return r&&this.submitSequenceMessage(r),r}groupOperation(e){this.client.localTransaction(e),this.submitSequenceMessage(e)}getContainingSegment(e){return this.client.getContainingSegment(e)}getLength(){return this.client.getLength()}getPosition(e){return this.client.getPosition(e)}annotateRange(e,t,r,n){const s=this.client.annotateRangeLocal(e,t,r,n);s&&this.submitSequenceMessage(s)}getPropertiesAtPosition(e){return this.client.getPropertiesAtPosition(e)}getRangeExtentsOfPosition(e){return this.client.getRangeExtentsOfPosition(e)}createPositionReference(e,t,r){const n=new $(this.client,e,t,r);return r!==f.Transient&&this.addLocalReference(n),n}createLocalReferencePosition(e,t,r,n){return this.client.createLocalReferencePosition(e,t,r,n)}localRefToPos(e){return this.client.localReferencePositionToPosition(e)}localReferencePositionToPosition(e){return this.client.localReferencePositionToPosition(e)}resolveRemoteClientPosition(e,t,r){return this.client.resolveRemoteClientPosition(e,t,r)}submitSequenceMessage(e){if(!this.isAttached())return;const t=(0,Ot.i8)(e,this.serializer,this.handle),r=this.client.peekPendingSegmentGroups(e.type===v.GROUP?e.ops.length:1);this.loadedDeferred.isCompleted?this.submitLocalMessage(t,r):this.loadedDeferredOutgoingOps.push([t,r])}addLocalReference(e){return this.client.addLocalReference(e)}removeLocalReference(e){return this.client.removeLocalReferencePosition(e)}removeLocalReferencePosition(e){return this.client.removeLocalReferencePosition(e)}posFromRelativePos(e){return this.client.posFromRelativePos(e)}walkSegments(e,t,r,n,s=!1){return this.client.walkSegments(e,t,r,n,s)}getStackContext(e,t){return this.client.getStackContext(e,t)}getCurrentSeq(){return this.client.getCurrentSeq()}insertAtReferencePosition(e,t){const r=this.client.insertAtReferencePositionLocal(e,t);r&&this.submitSequenceMessage(r)}async waitIntervalCollection(e){return this.intervalCollections.get(e)}getIntervalCollection(e){return this.intervalCollections.get(e)}getIntervalCollectionLabels(){return this.intervalCollections.keys()}summarizeCore(e,t){const r=new dt.x1;return this.intervalCollections.size>0&&r.addBlob(qt,this.intervalCollections.serialize(e)),r.addWithStats(Lt,this.summarizeMergeTree(e)),r.getSummaryTree()}processGCDataCore(e){this.intervalCollections.size>0&&this.intervalCollections.serialize(e),this.client.serializeGCData(this.handle,e)}replaceRange(e,t,r){const n=Math.max(e,t),s=this.client.insertSegmentLocal(n,r);if(s)if(e<t){const r=this.client.removeRangeLocal(e,t);this.submitSequenceMessage(ut(s,r))}else this.submitSequenceMessage(s)}onConnect(){this.client.startOrUpdateCollaboration(this.runtime.clientId)}onDisconnect(){}reSubmitCore(e,t){this.intervalCollections.tryResubmitMessage(e,t)||this.submitSequenceMessage(this.client.regeneratePendingOp(e,t))}async loadCore(e){var t;if(await e.contains(qt)){const t=await e.readBlob(qt),r=Qe(t,"utf8");this.intervalCollections.populate(r)}try{const{catchupOpsP:r}=await this.client.load(this.runtime,new At.M(e,Lt),this.serializer),n=r.then((e=>{e.forEach((e=>{const t=this.client.getCollabWindow();if(e.minimumSequenceNumber<t.minSeq||e.referenceSequenceNumber<t.minSeq||e.sequenceNumber<=t.minSeq||e.sequenceNumber<=t.currentSeq)throw new Error(`Invalid catchup operations in snapshot: ${JSON.stringify({op:{seq:e.sequenceNumber,minSeq:e.minimumSequenceNumber,refSeq:e.referenceSequenceNumber},collabWindow:{seq:t.currentSeq,minSeq:t.minSeq}})}`);this.processMergeTreeMsg(e)})),this.loadFinished()})).catch((e=>{this.loadFinished(e)}));!0!==(null===(t=this.dataStoreRuntime.options)||void 0===t?void 0:t.sequenceInitializeFromHeaderOnly)&&await n}catch(e){this.loadFinished(e)}}processCore(e,t,r){this.deferIncomingOps?(p(!t,114),this.loadedDeferredIncomingOps.push(e)):(p(e.type===et.Operation,115),this.intervalCollections.tryProcessMessage(e.contents,t,e,r)||this.processMergeTreeMsg(e,t))}didAttach(){var e;this.isAttached()&&this.client.startOrUpdateCollaboration(null!==(e=this.runtime.clientId)&&void 0!==e?e:"attached")}initializeLocalCore(){super.initializeLocalCore(),this.loadFinished()}applyStashedOp(e){return this.client.applyStashedOp(e)}summarizeMergeTree(e){p(this.loadedDeferred.isCompleted,116);const t=this.runtime.deltaManager.minimumSequenceNumber;return this.processMinSequenceNumberChanged(t),this.messagesSinceMSNChange.forEach((e=>{e.minimumSequenceNumber=t})),this.client.summarize(this.runtime,this.handle,e,this.messagesSinceMSNChange)}processMergeTreeMsg(e,t){var r,n;const s=(0,Ot.lB)(e,this.serializer),i=[];function o(e){i.push(...Bt.createOpsFromDelta(e))}const a=s.referenceSequenceNumber!==s.sequenceNumber-1;let c=s;!0!==(null===(r=this.runtime.options)||void 0===r?void 0:r.newMergeTreeSnapshotFormat)&&a&&this.on("sequenceDelta",o),this.client.applyMsg(s,t),!0!==(null===(n=this.runtime.options)||void 0===n?void 0:n.newMergeTreeSnapshotFormat)&&(a&&(this.removeListener("sequenceDelta",o),c=Object.assign(Object.assign({},s),{referenceSequenceNumber:c.sequenceNumber-1,contents:1!==i.length?ut(...i):i[0]})),this.messagesSinceMSNChange.push(c),this.messagesSinceMSNChange.length>20&&this.messagesSinceMSNChange[20].sequenceNumber<s.minimumSequenceNumber&&this.processMinSequenceNumberChanged(s.minimumSequenceNumber))}processMinSequenceNumberChanged(e){let t=0;for(;t<this.messagesSinceMSNChange.length&&!(this.messagesSinceMSNChange[t].sequenceNumber>e);t++);0!==t&&(this.messagesSinceMSNChange=this.messagesSinceMSNChange.slice(t))}loadFinished(e){if(!this.loadedDeferred.isCompleted){if(this.initializeIntervalCollections(),e)throw this.loadedDeferred.reject(e),e;this.deferIncomingOps=!1;for(const e of this.loadedDeferredIncomingOps)this.processCore(e,!1,void 0);this.loadedDeferredIncomingOps.length=0,this.loadedDeferred.resolve();for(const[e,t]of this.loadedDeferredOutgoingOps)this.reSubmitCore(e,t);this.loadedDeferredOutgoingOps.length=0}}initializeIntervalCollections(){this.intervalCollections.eventEmitter.on("create",(({key:e,previousValue:t},r)=>{const n=this.intervalCollections.get(e);n.attached||n.attachGraph(this.client,e),p(void 0===t,705),this.emit("createIntervalCollection",e,r,this)}));for(const e of this.intervalCollections.keys())this.intervalCollections.get(e).attachGraph(this.client,e)}}const jt="1.3.7";class _t extends Ne{constructor(e){super(),this.items=e,this.type=_t.typeString,this.cachedLength=e.length}static is(e){return e.type===_t.typeString}static fromJSONObject(e){if(e&&"object"==typeof e&&"items"in e){const t=new _t(e.items);return e.props&&t.addProperties(e.props),t}}toJSONObject(){const e={items:this.items};return super.addSerializedProps(e),e}clone(e=0,t){const r=this.items.slice(e,t),n=new _t(r);return this.cloneInto(n),n}canAppend(e){return _t.is(e)&&(this.cachedLength<=128||e.cachedLength<=128)}toString(){return this.items.toString()}append(e){if(!_t.is(e))throw new Error("can only append another run segment");X.append(this,e),this.items=this.items.concat(e.items),this.cachedLength=this.items.length}removeRange(e,t){let r=[];const n=this.items.length;return e>0&&(r=r.concat(this.items.slice(0,e))),t<n&&(r=r.concat(this.items.slice(t))),this.items=r,this.cachedLength=this.items.length,0===this.items.length}createSplitSegmentAt(e){if(e>0){const t=this.items.slice(e);return this.items=this.items.slice(0,e),this.cachedLength=this.items.length,new _t(t)}}}_t.typeString="SubSequence";class Ht extends Bt{constructor(e,t,r,n){super(e,t,r,n),this.id=t}insert(e,t,r){const n=new _t(t);r&&n.addProperties(r);const s=this.client.insertSegmentLocal(e,n);s&&this.submitSequenceMessage(s)}remove(e,t){this.removeRange(e,t)}getItemCount(){return this.getLength()}getItems(e,t){const r=[];let n;return void 0!==t&&t<=e||(this.walkSegments((e=>(_t.is(e)&&(void 0===n&&(n=e),r.push(...e.items)),!0)),e,t),void 0!==n&&r.splice(0,e-this.getPosition(n)),void 0!==t&&r.splice(t-e)),r}}class Ut extends Ht{constructor(e,t,r){super(e,t,r,Kt.segmentFromSpec),this.id=t}static create(e,t){return e.createChannel(t,Kt.Type)}static getFactory(){return new Kt}getRange(e,t){return this.getItems(e,t)}}class zt extends Ht{constructor(e,t,r){super(e,t,r,Gt.segmentFromSpec),this.id=t}static create(e,t){return e.createChannel(t,Gt.Type)}static getFactory(){return new Gt}getRange(e,t){return this.getItems(e,t)}}class Vt{static segmentFromSpec(e){const t=Ke.fromJSONObject(e);if(t)return t;return Re.fromJSONObject(e)||void 0}get type(){return Vt.Type}get attributes(){return Vt.Attributes}async load(e,t,r,n){const s=new Wt(e,t,n);return await s.load(r),s}create(e,t){const r=new Wt(e,t,this.attributes);return r.initializeLocal(),r}}Vt.Type="https://graph.microsoft.com/types/mergeTree",Vt.Attributes={type:Vt.Type,snapshotFormatVersion:"0.1",packageVersion:jt};class Gt{static segmentFromSpec(e){const t=e;if(t.items){const e=new _t(t.items);return t.props&&e.addProperties(t.props),e}}get type(){return Gt.Type}get attributes(){return Gt.Attributes}async load(e,t,r,n){const s=new zt(e,t,n);return await s.load(r),s}create(e,t){const r=new zt(e,t,this.attributes);return r.initializeLocal(),r}}Gt.Type="https://graph.microsoft.com/types/mergeTree/object-sequence",Gt.Attributes={type:Gt.Type,snapshotFormatVersion:"0.1",packageVersion:jt};class Kt{static segmentFromSpec(e){const t=e;if(t.items){const e=new _t(t.items);return t.props&&e.addProperties(t.props),e}}get type(){return Kt.Type}get attributes(){return Kt.Attributes}async load(e,t,r,n){const s=new Ut(e,t,n);return await s.load(r),s}create(e,t){const r=new Ut(e,t,this.attributes);return r.initializeLocal(),r}}Kt.Type="https://graph.microsoft.com/types/mergeTree/number-sequence",Kt.Attributes={type:Kt.Type,snapshotFormatVersion:"0.1",packageVersion:jt};class Wt extends Bt{constructor(e,t,r){super(e,t,r,Vt.segmentFromSpec),this.id=t,this.mergeTreeTextHelper=this.client.createTextHelper()}static create(e,t){return e.createChannel(t,Vt.Type)}static getFactory(){return new Vt}get ISharedString(){return this}insertMarkerRelative(e,t,r){const n=new Re(t);r&&n.addProperties(r);const s=this.posFromRelativePos(e),i=this.client.insertSegmentLocal(s,n);i&&this.submitSequenceMessage(i)}insertMarker(e,t,r){const n=new Re(t);r&&n.addProperties(r);const s=this.client.insertSegmentLocal(e,n);return s&&this.submitSequenceMessage(s),s}insertTextRelative(e,t,r){const n=new Ke(t);r&&n.addProperties(r);const s=this.posFromRelativePos(e),i=this.client.insertSegmentLocal(s,n);i&&this.submitSequenceMessage(i)}insertText(e,t,r){const n=new Ke(t);r&&n.addProperties(r);const s=this.client.insertSegmentLocal(e,n);s&&this.submitSequenceMessage(s)}replaceText(e,t,r,n){this.replaceRange(e,t,Ke.make(r,n))}removeText(e,t){return this.removeRange(e,t)}annotateMarkerNotifyConsensus(e,t,r){const n=this.client.annotateMarkerNotifyConsensus(e,t,r);n&&this.submitSequenceMessage(n)}annotateMarker(e,t,r){const n=this.client.annotateMarker(e,t,r);n&&this.submitSequenceMessage(n)}findTile(e,t,r=!0){return this.client.findTile(e,t,r)}getTextAndMarkers(e){const t=this.client.getCollabWindow();return this.mergeTreeTextHelper.getTextAndMarkers(t.currentSeq,t.clientId,e)}getText(e,t){const r=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(r.currentSeq,r.clientId,"",e,t)}getTextWithPlaceholders(){const e=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(e.currentSeq,e.clientId," ")}getTextRangeWithPlaceholders(e,t){const r=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(r.currentSeq,r.clientId," ",e,t)}getTextRangeWithMarkers(e,t){const r=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(r.currentSeq,r.clientId,"*",e,t)}getMarkerFromId(e){return this.client.getMarkerFromId(e)}}class $t extends Ne{constructor(e){super(),this.type=$t.typeString,this.cachedLength=e}static is(e){return e.type===$t.typeString}static fromJSONObject(e){if(e&&"object"==typeof e&&"pad"in e){const t=new $t(e.pad);return e.props&&t.addProperties(e.props),t}}toJSONObject(){return{pad:this.cachedLength,props:this.properties}}clone(e=0,t){const r=new $t(this.cachedLength);return this.cloneInto(r),r}canAppend(e){return $t.is(e)}toString(){return`[padding: ${this.cachedLength}]`}append(e){if(!$t.is(e))throw new Error("can only append padding segment");X.append(this,e),this.cachedLength+=e.cachedLength}removeRange(e,t){return this.cachedLength-=t-e,0===this.cachedLength}createSplitSegmentAt(e){const t=e,r=this.cachedLength-e;return this.cachedLength=t,new $t(r)}}$t.typeString="PaddingSegment";class Jt extends _t{constructor(e){super(e),this.items=e,this.type=Jt.typeString,this.tags=new Array(e.length).fill(void 0)}static is(e){return e.type===Jt.typeString}static fromJSONObject(e){if(e&&"object"==typeof e&&"items"in e){const t=new Jt(e.items);return e.props&&t.addProperties(e.props),t}}clone(e=0,t){const r=new Jt(this.items.slice(e,t));return this.tags&&(r.tags=this.tags.slice(e,t)),this.cloneInto(r),r}append(e){super.append(e);const t=e;return t.tags&&this.tags&&this.tags.splice(this.items.length,0,...t.tags),this}removeRange(e,t){return this.tags.splice(e,t-e),super.removeRange(e,t)}getTag(e){return this.tags[e]}setTag(e,t){this.tags[e]=t}createSplitSegmentAt(e){if(e>0){const t=this.items.slice(e);this.items=this.items.slice(0,e),this.cachedLength=this.items.length;const r=new Jt(t);return r.tags=this.tags.slice(e),this.tags.length=e,r}}}Jt.typeString="RunSegment";const Xt=2097152,Qt=Xt+1,Zt=4294967295,Yt=Zt+1,er=Xt*Zt,tr=(e,t)=>e*Qt+t;function rr(e){const t=Math.floor(e/Qt);return{row:t,col:e-t*Qt}}class nr extends Bt{constructor(e,t,r){super(e,t,r,sr.segmentFromSpec),this.id=t}static create(e,t){return e.createChannel(t,sr.Type)}static getFactory(){return new sr}get numRows(){return rr(this.getLength()).row}setItems(e,t,r,n){const s=tr(e,t),i=s+r.length,o=new Jt(r);n&&o.addProperties(n),this.replaceRange(s,i,o)}getItem(e,t){const r=tr(e,t),{segment:n,offset:s}=this.getContainingSegment(r);if(n&&Jt.is(n))return n.items[s];if(!n||!$t.is(n))throw new Error("Unrecognized Segment type")}getTag(e,t){const{segment:r,offset:n}=this.getSegment(e,t);if(Jt.is(r))return r.getTag(n)}setTag(e,t,r){const{segment:n,offset:s}=this.getSegment(e,t);if(Jt.is(n))n.setTag(s,r);else if(void 0!==r)throw new Error(`Must not attempt to set tags on '${n.constructor.name}'.`)}insertRows(e,t){const r=tr(e,0),n=new $t(Qt*t),s=this.client.insertSegmentLocal(r,n);s&&this.submitSequenceMessage(s)}removeRows(e,t){const r=tr(e,0),n=Qt*t;this.removeRange(r,r+n)}insertCols(e,t){this.moveAsPadding(Xt-t,e,t)}removeCols(e,t){this.moveAsPadding(e,Xt-t,t)}annotatePosition(e,t,r){const n=tr(e,t);this.annotateRange(n,n+1,r)}getPositionProperties(e,t){const r=tr(e,t);return this.getPropertiesAtPosition(r)}moveAsPadding(e,t,r){const n=e,s=e+r,i=[];for(let e=0,o=0;e<this.numRows;e++,o+=Qt){i.push(this.client.removeRangeLocal(o+n,o+s));const e=o+t,a=new $t(r);i.push(this.client.insertSegmentLocal(e,a))}this.submitSequenceMessage(ut(...i))}getSegment(e,t){const r=tr(e,t);return this.getContainingSegment(r)}}class sr{static segmentFromSpec(e){const t=$t.fromJSONObject(e);if(t)return t;const r=Jt.fromJSONObject(e);if(r)return r;throw new Error(`Unrecognized IJSONObject: '${JSON.stringify(e)}'`)}get type(){return sr.Type}get attributes(){return sr.Attributes}async load(e,t,r,n){const s=new nr(e,t,n);return await s.load(r),s}create(e,t){const r=new nr(e,t,this.attributes);return r.initializeLocal(),r}}var ir;sr.Type="https://graph.microsoft.com/types/mergeTree/sparse-matrix",sr.Attributes={type:sr.Type,snapshotFormatVersion:"0.1",packageVersion:jt};const or="header";class ar{get type(){return ar.Type}get attributes(){return ar.Attributes}async load(e,t,r,n){const s=new cr(t,e,n);return await s.load(r),s}create(e,t){const r=new cr(t,e,this.attributes);return r.initializeLocal(),r}}ar.Type="https://graph.microsoft.com/types/sharedIntervalCollection",ar.Attributes={type:ar.Type,snapshotFormatVersion:"0.1",packageVersion:jt};class cr extends Tt.h{constructor(e,t,r){super(e,t,r,"fluid_sharedIntervalCollection_"),this[ir]="SharedIntervalCollection",this.intervalCollections=new Rt(this.serializer,this.handle,((e,t)=>this.submitLocalMessage(e,t)),new ue)}static create(e,t){return e.createChannel(t,ar.Type)}static getFactory(){return new ar}async waitIntervalCollection(e){return this.intervalCollections.get(this.getIntervalCollectionPath(e))}getIntervalCollection(e){const t=this.getIntervalCollectionPath(e);return this.intervalCollections.get(t)}summarizeCore(e){return(0,Ot.Ho)(or,this.intervalCollections.serialize(e))}reSubmitCore(e,t){this.intervalCollections.tryResubmitMessage(e,t)}onDisconnect(){}async loadCore(e){const t=await e.readBlob(or),r=Qe(t,"utf8");this.intervalCollections.populate(r)}processCore(e,t,r){e.type===et.Operation&&this.intervalCollections.tryProcessMessage(e.contents,t,e,r)}getIntervalCollectionPath(e){return e}applyStashedOp(){throw new Error("not implemented")}}ir=Symbol.toStringTag},9092:e=>{"use strict";var t=Object.prototype.toString,r=Math.max,n=function(e,t){for(var r=[],n=0;n<e.length;n+=1)r[n]=e[n];for(var s=0;s<t.length;s+=1)r[s+e.length]=t[s];return r};e.exports=function(e){var s=this;if("function"!=typeof s||"[object Function]"!==t.apply(s))throw new TypeError("Function.prototype.bind called on incompatible "+s);for(var i,o=function(e,t){for(var r=[],n=1,s=0;n<e.length;n+=1,s+=1)r[s]=e[n];return r}(arguments),a=r(0,s.length-o.length),c=[],h=0;h<a;h++)c[h]="$"+h;if(i=Function("binder","return function ("+function(e,t){for(var r="",n=0;n<e.length;n+=1)r+=e[n],n+1<e.length&&(r+=",");return r}(c)+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof i){var t=s.apply(this,n(o,arguments));return Object(t)===t?t:this}return s.apply(e,n(o,arguments))})),s.prototype){var l=function(){};l.prototype=s.prototype,i.prototype=new l,l.prototype=null}return i}},2514:(e,t,r)=>{"use strict";var n=r(9092);e.exports=Function.prototype.bind||n},210:(e,t,r)=>{"use strict";var n,s=SyntaxError,i=Function,o=TypeError,a=function(e){try{return i('"use strict"; return ('+e+").constructor;")()}catch(e){}},c=Object.getOwnPropertyDescriptor;if(c)try{c({},"")}catch(e){c=null}var h=function(){throw new o},l=c?function(){try{return h}catch(e){try{return c(arguments,"callee").get}catch(e){return h}}}():h,u=r(1405)(),d=r(8185)(),p=Object.getPrototypeOf||(d?function(e){return e.__proto__}:null),g={},m="undefined"!=typeof Uint8Array&&p?p(Uint8Array):n,f={"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":u&&p?p([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":g,"%AsyncGenerator%":g,"%AsyncGeneratorFunction%":g,"%AsyncIteratorPrototype%":g,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?n:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":i,"%GeneratorFunction%":g,"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":u&&p?p(p([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&u&&p?p((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&u&&p?p((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":u&&p?p(""[Symbol.iterator]()):n,"%Symbol%":u?Symbol:n,"%SyntaxError%":s,"%ThrowTypeError%":l,"%TypedArray%":m,"%TypeError%":o,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet};if(p)try{null.error}catch(e){var y=p(p(e));f["%Error.prototype%"]=y}var v=function e(t){var r;if("%AsyncFunction%"===t)r=a("async function () {}");else if("%GeneratorFunction%"===t)r=a("function* () {}");else if("%AsyncGeneratorFunction%"===t)r=a("async function* () {}");else if("%AsyncGenerator%"===t){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if("%AsyncIteratorPrototype%"===t){var s=e("%AsyncGenerator%");s&&p&&(r=p(s.prototype))}return f[t]=r,r},b={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},S=r(2514),w=r(8824),x=S.call(Function.call,Array.prototype.concat),C=S.call(Function.apply,Array.prototype.splice),E=S.call(Function.call,String.prototype.replace),A=S.call(Function.call,String.prototype.slice),T=S.call(Function.call,RegExp.prototype.exec),O=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,N=/\\(\\)?/g,P=function(e,t){var r,n=e;if(w(b,n)&&(n="%"+(r=b[n])[0]+"%"),w(f,n)){var i=f[n];if(i===g&&(i=v(n)),void 0===i&&!t)throw new o("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:r,name:n,value:i}}throw new s("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new o('"allowMissing" argument must be a boolean');if(null===T(/^%?[^%]*%?$/,e))throw new s("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=function(e){var t=A(e,0,1),r=A(e,-1);if("%"===t&&"%"!==r)throw new s("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==t)throw new s("invalid intrinsic syntax, expected opening `%`");var n=[];return E(e,O,(function(e,t,r,s){n[n.length]=r?E(s,N,"$1"):t||e})),n}(e),n=r.length>0?r[0]:"",i=P("%"+n+"%",t),a=i.name,h=i.value,l=!1,u=i.alias;u&&(n=u[0],C(r,x([0,1],u)));for(var d=1,p=!0;d<r.length;d+=1){var g=r[d],m=A(g,0,1),y=A(g,-1);if(('"'===m||"'"===m||"`"===m||'"'===y||"'"===y||"`"===y)&&m!==y)throw new s("property names with quotes must have matching quotes");if("constructor"!==g&&p||(l=!0),w(f,a="%"+(n+="."+g)+"%"))h=f[a];else if(null!=h){if(!(g in h)){if(!t)throw new o("base intrinsic for "+e+" exists, but the property is not available.");return}if(c&&d+1>=r.length){var v=c(h,g);h=(p=!!v)&&"get"in v&&!("originalValue"in v.get)?v.get:h[g]}else p=w(h,g),h=h[g];p&&!l&&(f[a]=h)}}return h}},7296:(e,t,r)=>{"use strict";var n=r(210)("%Object.getOwnPropertyDescriptor%",!0);if(n)try{n([],"length")}catch(e){n=null}e.exports=n},3596:(e,t,r)=>{"use strict";var n=r(210)("%Object.defineProperty%",!0),s=function(){if(n)try{return n({},"a",{value:1}),!0}catch(e){return!1}return!1};s.hasArrayLengthDefineBug=function(){if(!s())return null;try{return 1!==n([],"length",{value:1}).length}catch(e){return!0}},e.exports=s},8185:e=>{"use strict";var t={foo:{}},r=Object;e.exports=function(){return{__proto__:t}.foo===t.foo&&!({__proto__:null}instanceof r)}},1405:(e,t,r)=>{"use strict";var n="undefined"!=typeof Symbol&&Symbol,s=r(5419);e.exports=function(){return"function"==typeof n&&"function"==typeof Symbol&&"symbol"==typeof n("foo")&&"symbol"==typeof Symbol("bar")&&s()}},5419:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),r=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var n=Object.getOwnPropertySymbols(e);if(1!==n.length||n[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var s=Object.getOwnPropertyDescriptor(e,t);if(42!==s.value||!0!==s.enumerable)return!1}return!0}},8824:(e,t,r)=>{"use strict";var n=Function.prototype.call,s=Object.prototype.hasOwnProperty,i=r(2514);e.exports=i.call(n,s)},4530:(e,t)=>{function r(e,t){var r=[],n=[];return null==t&&(t=function(e,t){return r[0]===t?"[Circular ~]":"[Circular ~."+n.slice(0,r.indexOf(t)).join(".")+"]"}),function(s,i){if(r.length>0){var o=r.indexOf(this);~o?r.splice(o+1):r.push(this),~o?n.splice(o,1/0,s):n.push(s),~r.indexOf(i)&&(i=t.call(this,s,i))}else r.push(i);return null==e?i:e.call(this,s,i)}}(e.exports=function(e,t,n,s){return JSON.stringify(e,r(t,s),n)}).getSerialize=r},1166:(e,t)=>{var r,n,s,i,o,a,c,h,l,u={userAgent:!1},d={},p=p||function(e,t){var r={},n=r.lib={},s=n.Base=function(){function e(){}return{extend:function(t){e.prototype=this;var r=new e;return t&&r.mixIn(t),r.hasOwnProperty("init")||(r.init=function(){r.$super.init.apply(this,arguments)}),r.init.prototype=r,r.$super=this,r},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),i=n.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,s=e.sigBytes;if(this.clamp(),n%4)for(var i=0;i<s;i++){var o=r[i>>>2]>>>24-i%4*8&255;t[n+i>>>2]|=o<<24-(n+i)%4*8}else for(i=0;i<s;i+=4)t[n+i>>>2]=r[i>>>2];return this.sigBytes+=s,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r=[],n=0;n<t;n+=4)r.push(4294967296*e.random()|0);return new i.init(r,t)}}),o=r.enc={},a=o.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],s=0;s<r;s++){var i=t[s>>>2]>>>24-s%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new i.init(r,t/2)}},c=o.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],s=0;s<r;s++){var i=t[s>>>2]>>>24-s%4*8&255;n.push(String.fromCharCode(i))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new i.init(r,t)}},h=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},l=n.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new i.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,n=r.words,s=r.sigBytes,o=this.blockSize,a=s/(4*o),c=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*o,h=e.min(4*c,s);if(c){for(var l=0;l<c;l+=o)this._doProcessBlock(n,l);var u=n.splice(0,c);r.sigBytes-=h}return new i.init(u,h)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),u=(n.Hasher=l.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new u.HMAC.init(e,r).finalize(t)}}}),r.algo={});return r}(Math);n=(r=p).lib,s=n.Base,i=n.WordArray,(r=r.x64={}).Word=s.extend({init:function(e,t){this.high=e,this.low=t}}),r.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,r=[],n=0;n<t;n++){var s=e[n];r.push(s.high),r.push(s.low)}return i.create(r,this.sigBytes)},clone:function(){for(var e=s.clone.call(this),t=e.words=this.words.slice(0),r=t.length,n=0;n<r;n++)t[n]=t[n].clone();return e}}),p.lib.Cipher||function(e){var t=(g=p).lib,r=t.Base,n=t.WordArray,s=t.BufferedBlockAlgorithm,i=g.enc.Base64,o=g.algo.EvpKDF,a=t.Cipher=s.extend({cfg:r.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){s.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,r,n){return("string"==typeof r?m:d).encrypt(e,t,r,n)},decrypt:function(t,r,n){return("string"==typeof r?m:d).decrypt(e,t,r,n)}}}});t.StreamCipher=a.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var c=g.mode={},h=function(e,t,r){var n=this._iv;n?this._iv=void 0:n=this._prevBlock;for(var s=0;s<r;s++)e[t+s]^=n[s]},l=(t.BlockCipherMode=r.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();l.Encryptor=l.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize;h.call(this,e,t,n),r.encryptBlock(e,t),this._prevBlock=e.slice(t,t+n)}}),l.Decryptor=l.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,s=e.slice(t,t+n);r.decryptBlock(e,t),h.call(this,e,t,n),this._prevBlock=s}}),c=c.CBC=l,l=(g.pad={}).Pkcs7={pad:function(e,t){for(var r,s=(r=(r=4*t)-e.sigBytes%r)<<24|r<<16|r<<8|r,i=[],o=0;o<r;o+=4)i.push(s);r=n.create(i,r),e.concat(r)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},t.BlockCipher=a.extend({cfg:a.cfg.extend({mode:c,padding:l}),reset:function(){a.reset.call(this);var e=(t=this.cfg).iv,t=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var r=t.createEncryptor;else r=t.createDecryptor,this._minBufferSize=1;this._mode=r.call(t,this,e&&e.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var u=t.CipherParams=r.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),d=(c=(g.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return((e=e.salt)?n.create([1398893684,1701076831]).concat(e).concat(t):t).toString(i)},parse:function(e){var t=(e=i.parse(e)).words;if(1398893684==t[0]&&1701076831==t[1]){var r=n.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return u.create({ciphertext:e,salt:r})}},t.SerializableCipher=r.extend({cfg:r.extend({format:c}),encrypt:function(e,t,r,n){n=this.cfg.extend(n);var s=e.createEncryptor(r,n);return t=s.finalize(t),s=s.cfg,u.create({ciphertext:t,key:r,iv:s.iv,algorithm:e,mode:s.mode,padding:s.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),e.createDecryptor(r,n).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}})),g=(g.kdf={}).OpenSSL={execute:function(e,t,r,s){return s||(s=n.random(8)),e=o.create({keySize:t+r}).compute(e,s),r=n.create(e.words.slice(t),4*r),e.sigBytes=4*t,u.create({key:e,iv:r,salt:s})}},m=t.PasswordBasedCipher=d.extend({cfg:d.cfg.extend({kdf:g}),encrypt:function(e,t,r,n){return r=(n=this.cfg.extend(n)).kdf.execute(r,e.keySize,e.ivSize),n.iv=r.iv,(e=d.encrypt.call(this,e,t,r.key,n)).mixIn(r),e},decrypt:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),r=n.kdf.execute(r,e.keySize,e.ivSize,t.salt),n.iv=r.iv,d.decrypt.call(this,e,t,r.key,n)}})}(),function(){for(var e=p,t=e.lib.BlockCipher,r=e.algo,n=[],s=[],i=[],o=[],a=[],c=[],h=[],l=[],u=[],d=[],g=[],m=0;256>m;m++)g[m]=128>m?m<<1:m<<1^283;var f=0,y=0;for(m=0;256>m;m++){var v=(v=y^y<<1^y<<2^y<<3^y<<4)>>>8^255&v^99;n[f]=v,s[v]=f;var b=g[f],S=g[b],w=g[S],x=257*g[v]^16843008*v;i[f]=x<<24|x>>>8,o[f]=x<<16|x>>>16,a[f]=x<<8|x>>>24,c[f]=x,x=16843009*w^65537*S^257*b^16843008*f,h[v]=x<<24|x>>>8,l[v]=x<<16|x>>>16,u[v]=x<<8|x>>>24,d[v]=x,f?(f=b^g[g[g[w^b]]],y^=g[g[y]]):f=y=1}var C=[0,1,2,4,8,16,32,64,128,27,54];r=r.AES=t.extend({_doReset:function(){for(var e=(r=this._key).words,t=r.sigBytes/4,r=4*((this._nRounds=t+6)+1),s=this._keySchedule=[],i=0;i<r;i++)if(i<t)s[i]=e[i];else{var o=s[i-1];i%t?6<t&&4==i%t&&(o=n[o>>>24]<<24|n[o>>>16&255]<<16|n[o>>>8&255]<<8|n[255&o]):(o=n[(o=o<<8|o>>>24)>>>24]<<24|n[o>>>16&255]<<16|n[o>>>8&255]<<8|n[255&o],o^=C[i/t|0]<<24),s[i]=s[i-t]^o}for(e=this._invKeySchedule=[],t=0;t<r;t++)i=r-t,o=t%4?s[i]:s[i-4],e[t]=4>t||4>=i?o:h[n[o>>>24]]^l[n[o>>>16&255]]^u[n[o>>>8&255]]^d[n[255&o]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,i,o,a,c,n)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,h,l,u,d,s),r=e[t+1],e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,n,s,i,o,a){for(var c=this._nRounds,h=e[t]^r[0],l=e[t+1]^r[1],u=e[t+2]^r[2],d=e[t+3]^r[3],p=4,g=1;g<c;g++){var m=n[h>>>24]^s[l>>>16&255]^i[u>>>8&255]^o[255&d]^r[p++],f=n[l>>>24]^s[u>>>16&255]^i[d>>>8&255]^o[255&h]^r[p++],y=n[u>>>24]^s[d>>>16&255]^i[h>>>8&255]^o[255&l]^r[p++];d=n[d>>>24]^s[h>>>16&255]^i[l>>>8&255]^o[255&u]^r[p++],h=m,l=f,u=y}m=(a[h>>>24]<<24|a[l>>>16&255]<<16|a[u>>>8&255]<<8|a[255&d])^r[p++],f=(a[l>>>24]<<24|a[u>>>16&255]<<16|a[d>>>8&255]<<8|a[255&h])^r[p++],y=(a[u>>>24]<<24|a[d>>>16&255]<<16|a[h>>>8&255]<<8|a[255&l])^r[p++],d=(a[d>>>24]<<24|a[h>>>16&255]<<16|a[l>>>8&255]<<8|a[255&u])^r[p++],e[t]=m,e[t+1]=f,e[t+2]=y,e[t+3]=d},keySize:8}),e.AES=t._createHelper(r)}(),function(){function e(e,t){var r=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=r,this._lBlock^=r<<e}function t(e,t){var r=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=r,this._rBlock^=r<<e}var r=p,n=(s=r.lib).WordArray,s=s.BlockCipher,i=r.algo,o=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],a=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],h=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],l=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],u=i.DES=s.extend({_doReset:function(){for(var e=this._key.words,t=[],r=0;56>r;r++){var n=o[r]-1;t[r]=e[n>>>5]>>>31-n%32&1}for(e=this._subKeys=[],n=0;16>n;n++){var s=e[n]=[],i=c[n];for(r=0;24>r;r++)s[r/6|0]|=t[(a[r]-1+i)%28]<<31-r%6,s[4+(r/6|0)]|=t[28+(a[r+24]-1+i)%28]<<31-r%6;for(s[0]=s[0]<<1|s[0]>>>31,r=1;7>r;r++)s[r]>>>=4*(r-1)+3;s[7]=s[7]<<5|s[7]>>>27}for(t=this._invSubKeys=[],r=0;16>r;r++)t[r]=e[15-r]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(r,n,s){this._lBlock=r[n],this._rBlock=r[n+1],e.call(this,4,252645135),e.call(this,16,65535),t.call(this,2,858993459),t.call(this,8,16711935),e.call(this,1,1431655765);for(var i=0;16>i;i++){for(var o=s[i],a=this._lBlock,c=this._rBlock,u=0,d=0;8>d;d++)u|=h[d][((c^o[d])&l[d])>>>0];this._lBlock=c,this._rBlock=a^u}s=this._lBlock,this._lBlock=this._rBlock,this._rBlock=s,e.call(this,1,1431655765),t.call(this,8,16711935),t.call(this,2,858993459),e.call(this,16,65535),e.call(this,4,252645135),r[n]=this._lBlock,r[n+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});r.DES=s._createHelper(u),i=i.TripleDES=s.extend({_doReset:function(){var e=this._key.words;this._des1=u.createEncryptor(n.create(e.slice(0,2))),this._des2=u.createEncryptor(n.create(e.slice(2,4))),this._des3=u.createEncryptor(n.create(e.slice(4,6)))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2}),r.TripleDES=s._createHelper(i)}(),function(){var e=p,t=e.lib.WordArray;e.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp(),e=[];for(var s=0;s<r;s+=3)for(var i=(t[s>>>2]>>>24-s%4*8&255)<<16|(t[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|t[s+2>>>2]>>>24-(s+2)%4*8&255,o=0;4>o&&s+.75*o<r;o++)e.push(n.charAt(i>>>6*(3-o)&63));if(t=n.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var r=e.length,n=this._map;(s=n.charAt(64))&&-1!=(s=e.indexOf(s))&&(r=s);for(var s=[],i=0,o=0;o<r;o++)if(o%4){var a=n.indexOf(e.charAt(o-1))<<o%4*2,c=n.indexOf(e.charAt(o))>>>6-o%4*2;s[i>>>2]|=(a|c)<<24-i%4*8,i++}return t.create(s,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(e){function t(e,t,r,n,s,i,o){return((e=e+(t&r|~t&n)+s+o)<<i|e>>>32-i)+t}function r(e,t,r,n,s,i,o){return((e=e+(t&n|r&~n)+s+o)<<i|e>>>32-i)+t}function n(e,t,r,n,s,i,o){return((e=e+(t^r^n)+s+o)<<i|e>>>32-i)+t}function s(e,t,r,n,s,i,o){return((e=e+(r^(t|~n))+s+o)<<i|e>>>32-i)+t}for(var i=p,o=(c=i.lib).WordArray,a=c.Hasher,c=i.algo,h=[],l=0;64>l;l++)h[l]=4294967296*e.abs(e.sin(l+1))|0;c=c.MD5=a.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,i){for(var o=0;16>o;o++){var a=e[c=i+o];e[c]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}o=this._hash.words;var c=e[i+0],l=(a=e[i+1],e[i+2]),u=e[i+3],d=e[i+4],p=e[i+5],g=e[i+6],m=e[i+7],f=e[i+8],y=e[i+9],v=e[i+10],b=e[i+11],S=e[i+12],w=e[i+13],x=e[i+14],C=e[i+15],E=t(E=o[0],O=o[1],T=o[2],A=o[3],c,7,h[0]),A=t(A,E,O,T,a,12,h[1]),T=t(T,A,E,O,l,17,h[2]),O=t(O,T,A,E,u,22,h[3]);E=t(E,O,T,A,d,7,h[4]),A=t(A,E,O,T,p,12,h[5]),T=t(T,A,E,O,g,17,h[6]),O=t(O,T,A,E,m,22,h[7]),E=t(E,O,T,A,f,7,h[8]),A=t(A,E,O,T,y,12,h[9]),T=t(T,A,E,O,v,17,h[10]),O=t(O,T,A,E,b,22,h[11]),E=t(E,O,T,A,S,7,h[12]),A=t(A,E,O,T,w,12,h[13]),T=t(T,A,E,O,x,17,h[14]),E=r(E,O=t(O,T,A,E,C,22,h[15]),T,A,a,5,h[16]),A=r(A,E,O,T,g,9,h[17]),T=r(T,A,E,O,b,14,h[18]),O=r(O,T,A,E,c,20,h[19]),E=r(E,O,T,A,p,5,h[20]),A=r(A,E,O,T,v,9,h[21]),T=r(T,A,E,O,C,14,h[22]),O=r(O,T,A,E,d,20,h[23]),E=r(E,O,T,A,y,5,h[24]),A=r(A,E,O,T,x,9,h[25]),T=r(T,A,E,O,u,14,h[26]),O=r(O,T,A,E,f,20,h[27]),E=r(E,O,T,A,w,5,h[28]),A=r(A,E,O,T,l,9,h[29]),T=r(T,A,E,O,m,14,h[30]),E=n(E,O=r(O,T,A,E,S,20,h[31]),T,A,p,4,h[32]),A=n(A,E,O,T,f,11,h[33]),T=n(T,A,E,O,b,16,h[34]),O=n(O,T,A,E,x,23,h[35]),E=n(E,O,T,A,a,4,h[36]),A=n(A,E,O,T,d,11,h[37]),T=n(T,A,E,O,m,16,h[38]),O=n(O,T,A,E,v,23,h[39]),E=n(E,O,T,A,w,4,h[40]),A=n(A,E,O,T,c,11,h[41]),T=n(T,A,E,O,u,16,h[42]),O=n(O,T,A,E,g,23,h[43]),E=n(E,O,T,A,y,4,h[44]),A=n(A,E,O,T,S,11,h[45]),T=n(T,A,E,O,C,16,h[46]),E=s(E,O=n(O,T,A,E,l,23,h[47]),T,A,c,6,h[48]),A=s(A,E,O,T,m,10,h[49]),T=s(T,A,E,O,x,15,h[50]),O=s(O,T,A,E,p,21,h[51]),E=s(E,O,T,A,S,6,h[52]),A=s(A,E,O,T,u,10,h[53]),T=s(T,A,E,O,v,15,h[54]),O=s(O,T,A,E,a,21,h[55]),E=s(E,O,T,A,f,6,h[56]),A=s(A,E,O,T,C,10,h[57]),T=s(T,A,E,O,g,15,h[58]),O=s(O,T,A,E,w,21,h[59]),E=s(E,O,T,A,d,6,h[60]),A=s(A,E,O,T,b,10,h[61]),T=s(T,A,E,O,l,15,h[62]),O=s(O,T,A,E,y,21,h[63]),o[0]=o[0]+E|0,o[1]=o[1]+O|0,o[2]=o[2]+T|0,o[3]=o[3]+A|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,s=8*t.sigBytes;r[s>>>5]|=128<<24-s%32;var i=e.floor(n/4294967296);for(r[15+(s+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),r[14+(s+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),t.sigBytes=4*(r.length+1),this._process(),r=(t=this._hash).words,n=0;4>n;n++)s=r[n],r[n]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8);return t},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}}),i.MD5=a._createHelper(c),i.HmacMD5=a._createHmacHelper(c)}(Math),a=(l=(o=p).lib).WordArray,c=l.Hasher,h=[],l=o.algo.SHA1=c.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],s=r[1],i=r[2],o=r[3],a=r[4],c=0;80>c;c++){if(16>c)h[c]=0|e[t+c];else{var l=h[c-3]^h[c-8]^h[c-14]^h[c-16];h[c]=l<<1|l>>>31}l=(n<<5|n>>>27)+a+h[c],l=20>c?l+(1518500249+(s&i|~s&o)):40>c?l+(1859775393+(s^i^o)):60>c?l+((s&i|s&o|i&o)-1894007588):l+((s^i^o)-899497514),a=o,o=i,i=s<<30|s>>>2,s=n,n=l}r[0]=r[0]+n|0,r[1]=r[1]+s|0,r[2]=r[2]+i|0,r[3]=r[3]+o|0,r[4]=r[4]+a|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(n+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=c.clone.call(this);return e._hash=this._hash.clone(),e}}),o.SHA1=c._createHelper(l),o.HmacSHA1=c._createHmacHelper(l),function(e){for(var t=p,r=(s=t.lib).WordArray,n=s.Hasher,s=t.algo,i=[],o=[],a=function(e){return 4294967296*(e-(0|e))|0},c=2,h=0;64>h;){var l;e:{l=c;for(var u=e.sqrt(l),d=2;d<=u;d++)if(!(l%d)){l=!1;break e}l=!0}l&&(8>h&&(i[h]=a(e.pow(c,.5))),o[h]=a(e.pow(c,1/3)),h++),c++}var g=[];s=s.SHA256=n.extend({_doReset:function(){this._hash=new r.init(i.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],s=r[1],i=r[2],a=r[3],c=r[4],h=r[5],l=r[6],u=r[7],d=0;64>d;d++){if(16>d)g[d]=0|e[t+d];else{var p=g[d-15],m=g[d-2];g[d]=((p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3)+g[d-7]+((m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10)+g[d-16]}p=u+((c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25))+(c&h^~c&l)+o[d]+g[d],m=((n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22))+(n&s^n&i^s&i),u=l,l=h,h=c,c=a+p|0,a=i,i=s,s=n,n=p+m|0}r[0]=r[0]+n|0,r[1]=r[1]+s|0,r[2]=r[2]+i|0,r[3]=r[3]+a|0,r[4]=r[4]+c|0,r[5]=r[5]+h|0,r[6]=r[6]+l|0,r[7]=r[7]+u|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,s=8*t.sigBytes;return r[s>>>5]|=128<<24-s%32,r[14+(s+64>>>9<<4)]=e.floor(n/4294967296),r[15+(s+64>>>9<<4)]=n,t.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}}),t.SHA256=n._createHelper(s),t.HmacSHA256=n._createHmacHelper(s)}(Math),function(){var e=p,t=e.lib.WordArray,r=(n=e.algo).SHA256,n=n.SHA224=r.extend({_doReset:function(){this._hash=new t.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=r._doFinalize.call(this);return e.sigBytes-=4,e}});e.SHA224=r._createHelper(n),e.HmacSHA224=r._createHmacHelper(n)}(),function(){function e(){return n.create.apply(n,arguments)}for(var t=p,r=t.lib.Hasher,n=(i=t.x64).Word,s=i.WordArray,i=t.algo,o=[e(1116352408,3609767458),e(1899447441,602891725),e(3049323471,3964484399),e(3921009573,2173295548),e(961987163,4081628472),e(1508970993,3053834265),e(2453635748,2937671579),e(2870763221,3664609560),e(3624381080,2734883394),e(310598401,1164996542),e(607225278,1323610764),e(1426881987,3590304994),e(1925078388,4068182383),e(2162078206,991336113),e(2614888103,633803317),e(3248222580,3479774868),e(3835390401,2666613458),e(4022224774,944711139),e(264347078,2341262773),e(604807628,2007800933),e(770255983,1495990901),e(1249150122,1856431235),e(1555081692,3175218132),e(1996064986,2198950837),e(2554220882,3999719339),e(2821834349,766784016),e(2952996808,2566594879),e(3210313671,3203337956),e(3336571891,1034457026),e(3584528711,2466948901),e(113926993,3758326383),e(338241895,168717936),e(666307205,1188179964),e(773529912,1546045734),e(1294757372,1522805485),e(1396182291,2643833823),e(1695183700,2343527390),e(1986661051,1014477480),e(2177026350,1206759142),e(2456956037,344077627),e(2730485921,1290863460),e(2820302411,3158454273),e(3259730800,3505952657),e(3345764771,106217008),e(3516065817,3606008344),e(3600352804,1432725776),e(4094571909,1467031594),e(275423344,851169720),e(430227734,3100823752),e(506948616,1363258195),e(659060556,3750685593),e(883997877,3785050280),e(958139571,3318307427),e(1322822218,3812723403),e(1537002063,2003034995),e(1747873779,3602036899),e(1955562222,1575990012),e(2024104815,1125592928),e(2227730452,2716904306),e(2361852424,442776044),e(2428436474,593698344),e(2756734187,3733110249),e(3204031479,2999351573),e(3329325298,3815920427),e(3391569614,3928383900),e(3515267271,566280711),e(3940187606,3454069534),e(4118630271,4000239992),e(116418474,1914138554),e(174292421,2731055270),e(289380356,3203993006),e(460393269,320620315),e(685471733,587496836),e(852142971,1086792851),e(1017036298,365543100),e(1126000580,2618297676),e(1288033470,3409855158),e(1501505948,4234509866),e(1607167915,987167468),e(1816402316,1246189591)],a=[],c=0;80>c;c++)a[c]=e();i=i.SHA512=r.extend({_doReset:function(){this._hash=new s.init([new n.init(1779033703,4089235720),new n.init(3144134277,2227873595),new n.init(1013904242,4271175723),new n.init(2773480762,1595750129),new n.init(1359893119,2917565137),new n.init(2600822924,725511199),new n.init(528734635,4215389547),new n.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var r=(u=this._hash.words)[0],n=u[1],s=u[2],i=u[3],c=u[4],h=u[5],l=u[6],u=u[7],d=r.high,p=r.low,g=n.high,m=n.low,f=s.high,y=s.low,v=i.high,b=i.low,S=c.high,w=c.low,x=h.high,C=h.low,E=l.high,A=l.low,T=u.high,O=u.low,N=d,P=p,R=g,I=m,F=f,k=y,D=v,M=b,q=S,L=w,B=x,j=C,_=E,H=A,U=T,z=O,V=0;80>V;V++){var G=a[V];if(16>V)var K=G.high=0|e[t+2*V],W=G.low=0|e[t+2*V+1];else{K=((W=(K=a[V-15]).high)>>>1|($=K.low)<<31)^(W>>>8|$<<24)^W>>>7;var $=($>>>1|W<<31)^($>>>8|W<<24)^($>>>7|W<<25),J=((W=(J=a[V-2]).high)>>>19|(X=J.low)<<13)^(W<<3|X>>>29)^W>>>6,X=(X>>>19|W<<13)^(X<<3|W>>>29)^(X>>>6|W<<26),Q=(W=a[V-7]).high,Z=(Y=a[V-16]).high,Y=Y.low;K=(K=(K=K+Q+((W=$+W.low)>>>0<$>>>0?1:0))+J+((W+=X)>>>0<X>>>0?1:0))+Z+((W+=Y)>>>0<Y>>>0?1:0),G.high=K,G.low=W}Q=q&B^~q&_,Y=L&j^~L&H,G=N&R^N&F^R&F;var ee=P&I^P&k^I&k,te=($=(N>>>28|P<<4)^(N<<30|P>>>2)^(N<<25|P>>>7),J=(P>>>28|N<<4)^(P<<30|N>>>2)^(P<<25|N>>>7),(X=o[V]).high),re=X.low;Z=U+((q>>>14|L<<18)^(q>>>18|L<<14)^(q<<23|L>>>9))+((X=z+((L>>>14|q<<18)^(L>>>18|q<<14)^(L<<23|q>>>9)))>>>0<z>>>0?1:0),U=_,z=H,_=B,H=j,B=q,j=L,q=D+(Z=(Z=(Z=Z+Q+((X+=Y)>>>0<Y>>>0?1:0))+te+((X+=re)>>>0<re>>>0?1:0))+K+((X+=W)>>>0<W>>>0?1:0))+((L=M+X|0)>>>0<M>>>0?1:0)|0,D=F,M=k,F=R,k=I,R=N,I=P,N=Z+(G=$+G+((W=J+ee)>>>0<J>>>0?1:0))+((P=X+W|0)>>>0<X>>>0?1:0)|0}p=r.low=p+P,r.high=d+N+(p>>>0<P>>>0?1:0),m=n.low=m+I,n.high=g+R+(m>>>0<I>>>0?1:0),y=s.low=y+k,s.high=f+F+(y>>>0<k>>>0?1:0),b=i.low=b+M,i.high=v+D+(b>>>0<M>>>0?1:0),w=c.low=w+L,c.high=S+q+(w>>>0<L>>>0?1:0),C=h.low=C+j,h.high=x+B+(C>>>0<j>>>0?1:0),A=l.low=A+H,l.high=E+_+(A>>>0<H>>>0?1:0),O=u.low=O+z,u.high=T+U+(O>>>0<z>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[30+(n+128>>>10<<5)]=Math.floor(r/4294967296),t[31+(n+128>>>10<<5)]=r,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32}),t.SHA512=r._createHelper(i),t.HmacSHA512=r._createHmacHelper(i)}(),function(){var e=p,t=(s=e.x64).Word,r=s.WordArray,n=(s=e.algo).SHA512,s=s.SHA384=n.extend({_doReset:function(){this._hash=new r.init([new t.init(3418070365,3238371032),new t.init(1654270250,914150663),new t.init(2438529370,812702999),new t.init(355462360,4144912697),new t.init(1731405415,4290775857),new t.init(2394180231,1750603025),new t.init(3675008525,1694076839),new t.init(1203062813,3204075428)])},_doFinalize:function(){var e=n._doFinalize.call(this);return e.sigBytes-=16,e}});e.SHA384=n._createHelper(s),e.HmacSHA384=n._createHmacHelper(s)}(),function(){var e=p,t=(n=e.lib).WordArray,r=n.Hasher,n=e.algo,s=t.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),i=t.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),o=t.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),a=t.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),c=t.create([0,1518500249,1859775393,2400959708,2840853838]),h=t.create([1352829926,1548603684,1836072691,2053994217,0]);n=n.RIPEMD160=r.extend({_doReset:function(){this._hash=t.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=0;16>r;r++){var n=e[w=t+r];e[w]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8)}var l,u,d,p,g,m,f,y,v,b,S,w=this._hash.words,x=(n=c.words,h.words),C=s.words,E=i.words,A=o.words,T=a.words;for(m=l=w[0],f=u=w[1],y=d=w[2],v=p=w[3],b=g=w[4],r=0;80>r;r+=1)S=l+e[t+C[r]]|0,S=16>r?S+((u^d^p)+n[0]):32>r?S+((u&d|~u&p)+n[1]):48>r?S+(((u|~d)^p)+n[2]):64>r?S+((u&p|d&~p)+n[3]):S+((u^(d|~p))+n[4]),S=(S=(S|=0)<<A[r]|S>>>32-A[r])+g|0,l=g,g=p,p=d<<10|d>>>22,d=u,u=S,S=m+e[t+E[r]]|0,S=16>r?S+((f^(y|~v))+x[0]):32>r?S+((f&v|y&~v)+x[1]):48>r?S+(((f|~y)^v)+x[2]):64>r?S+((f&y|~f&v)+x[3]):S+((f^y^v)+x[4]),S=(S=(S|=0)<<T[r]|S>>>32-T[r])+b|0,m=b,b=v,v=y<<10|y>>>22,y=f,f=S;S=w[1]+d+v|0,w[1]=w[2]+p+b|0,w[2]=w[3]+g+m|0,w[3]=w[4]+l+f|0,w[4]=w[0]+u+y|0,w[0]=S},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;for(t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),e.sigBytes=4*(t.length+1),this._process(),t=(e=this._hash).words,r=0;5>r;r++)n=t[r],t[r]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8);return e},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}}),e.RIPEMD160=r._createHelper(n),e.HmacRIPEMD160=r._createHmacHelper(n)}(Math),function(){var e=p,t=e.enc.Utf8;e.algo.HMAC=e.lib.Base.extend({init:function(e,r){e=this._hasher=new e.init,"string"==typeof r&&(r=t.parse(r));var n=e.blockSize,s=4*n;r.sigBytes>s&&(r=e.finalize(r)),r.clamp();for(var i=this._oKey=r.clone(),o=this._iKey=r.clone(),a=i.words,c=o.words,h=0;h<n;h++)a[h]^=1549556828,c[h]^=909522486;i.sigBytes=o.sigBytes=s,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}})}(),function(){var e,t=p,r=(e=t.lib).Base,n=e.WordArray,s=(e=t.algo).HMAC,i=e.PBKDF2=r.extend({cfg:r.extend({keySize:4,hasher:e.SHA1,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){var r=this.cfg,i=s.create(r.hasher,e),o=n.create(),a=n.create([1]),c=o.words,h=a.words,l=r.keySize;for(r=r.iterations;c.length<l;){var u=i.update(t).finalize(a);i.reset();for(var d=u.words,p=d.length,g=u,m=1;m<r;m++){g=i.finalize(g),i.reset();for(var f=g.words,y=0;y<p;y++)d[y]^=f[y]}o.concat(u),h[0]++}return o.sigBytes=4*l,o}});t.PBKDF2=function(e,t,r){return i.create(r).compute(e,t)}}();var g,m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f="=";function y(e){var t,r,n="";for(t=0;t+3<=e.length;t+=3)r=parseInt(e.substring(t,t+3),16),n+=m.charAt(r>>6)+m.charAt(63&r);if(t+1==e.length?(r=parseInt(e.substring(t,t+1),16),n+=m.charAt(r<<2)):t+2==e.length&&(r=parseInt(e.substring(t,t+2),16),n+=m.charAt(r>>2)+m.charAt((3&r)<<4)),f)for(;(3&n.length)>0;)n+=f;return n}function v(e){var t,r,n,s="",i=0;for(t=0;t<e.length&&e.charAt(t)!=f;++t)(n=m.indexOf(e.charAt(t)))<0||(0==i?(s+=T(n>>2),r=3&n,i=1):1==i?(s+=T(r<<2|n>>4),r=15&n,i=2):2==i?(s+=T(r),s+=T(n>>2),r=3&n,i=3):(s+=T(r<<2|n>>4),s+=T(15&n),i=0));return 1==i&&(s+=T(r<<2)),s}function b(e){var t,r=v(e),n=new Array;for(t=0;2*t<r.length;++t)n[t]=parseInt(r.substring(2*t,2*t+2),16);return n}function S(e,t,r){null!=e&&("number"==typeof e?this.fromNumber(e,t,r):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function w(){return new S(null)}"Microsoft Internet Explorer"==u.appName?(S.prototype.am=function(e,t,r,n,s,i){for(var o=32767&t,a=t>>15;--i>=0;){var c=32767&this[e],h=this[e++]>>15,l=a*c+h*o;s=((c=o*c+((32767&l)<<15)+r[n]+(1073741823&s))>>>30)+(l>>>15)+a*h+(s>>>30),r[n++]=1073741823&c}return s},g=30):"Netscape"!=u.appName?(S.prototype.am=function(e,t,r,n,s,i){for(;--i>=0;){var o=t*this[e++]+r[n]+s;s=Math.floor(o/67108864),r[n++]=67108863&o}return s},g=26):(S.prototype.am=function(e,t,r,n,s,i){for(var o=16383&t,a=t>>14;--i>=0;){var c=16383&this[e],h=this[e++]>>14,l=a*c+h*o;s=((c=o*c+((16383&l)<<14)+r[n]+s)>>28)+(l>>14)+a*h,r[n++]=268435455&c}return s},g=28),S.prototype.DB=g,S.prototype.DM=(1<<g)-1,S.prototype.DV=1<<g,S.prototype.FV=Math.pow(2,52),S.prototype.F1=52-g,S.prototype.F2=2*g-52;var x,C,E="0123456789abcdefghijklmnopqrstuvwxyz",A=new Array;for(x="0".charCodeAt(0),C=0;C<=9;++C)A[x++]=C;for(x="a".charCodeAt(0),C=10;C<36;++C)A[x++]=C;for(x="A".charCodeAt(0),C=10;C<36;++C)A[x++]=C;function T(e){return E.charAt(e)}function O(e,t){var r=A[e.charCodeAt(t)];return null==r?-1:r}function N(e){var t=w();return t.fromInt(e),t}function P(e){var t,r=1;return 0!=(t=e>>>16)&&(e=t,r+=16),0!=(t=e>>8)&&(e=t,r+=8),0!=(t=e>>4)&&(e=t,r+=4),0!=(t=e>>2)&&(e=t,r+=2),0!=(t=e>>1)&&(e=t,r+=1),r}function R(e){this.m=e}function I(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function F(e,t){return e&t}function k(e,t){return e|t}function D(e,t){return e^t}function M(e,t){return e&~t}function q(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function L(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function B(){}function j(e){return e}function _(e){this.r2=w(),this.q3=w(),S.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}R.prototype.convert=function(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},R.prototype.revert=function(e){return e},R.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},R.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},R.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},I.prototype.convert=function(e){var t=w();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(S.ZERO)>0&&this.m.subTo(t,t),t},I.prototype.revert=function(e){var t=w();return e.copyTo(t),this.reduce(t),t},I.prototype.reduce=function(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var r=32767&e[t],n=r*this.mpl+((r*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[r=t+this.m.t]+=this.m.am(0,n,e,t,0,this.m.t);e[r]>=e.DV;)e[r]-=e.DV,e[++r]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},I.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},I.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},S.prototype.copyTo=function(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s},S.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0},S.prototype.fromString=function(e,t){var r;if(16==t)r=4;else if(8==t)r=3;else if(256==t)r=8;else if(2==t)r=1;else if(32==t)r=5;else{if(4!=t)return void this.fromRadix(e,t);r=2}this.t=0,this.s=0;for(var n=e.length,s=!1,i=0;--n>=0;){var o=8==r?255&e[n]:O(e,n);o<0?"-"==e.charAt(n)&&(s=!0):(s=!1,0==i?this[this.t++]=o:i+r>this.DB?(this[this.t-1]|=(o&(1<<this.DB-i)-1)<<i,this[this.t++]=o>>this.DB-i):this[this.t-1]|=o<<i,(i+=r)>=this.DB&&(i-=this.DB))}8==r&&0!=(128&e[0])&&(this.s=-1,i>0&&(this[this.t-1]|=(1<<this.DB-i)-1<<i)),this.clamp(),s&&S.ZERO.subTo(this,this)},S.prototype.clamp=function(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t},S.prototype.dlShiftTo=function(e,t){var r;for(r=this.t-1;r>=0;--r)t[r+e]=this[r];for(r=e-1;r>=0;--r)t[r]=0;t.t=this.t+e,t.s=this.s},S.prototype.drShiftTo=function(e,t){for(var r=e;r<this.t;++r)t[r-e]=this[r];t.t=Math.max(this.t-e,0),t.s=this.s},S.prototype.lShiftTo=function(e,t){var r,n=e%this.DB,s=this.DB-n,i=(1<<s)-1,o=Math.floor(e/this.DB),a=this.s<<n&this.DM;for(r=this.t-1;r>=0;--r)t[r+o+1]=this[r]>>s|a,a=(this[r]&i)<<n;for(r=o-1;r>=0;--r)t[r]=0;t[o]=a,t.t=this.t+o+1,t.s=this.s,t.clamp()},S.prototype.rShiftTo=function(e,t){t.s=this.s;var r=Math.floor(e/this.DB);if(r>=this.t)t.t=0;else{var n=e%this.DB,s=this.DB-n,i=(1<<n)-1;t[0]=this[r]>>n;for(var o=r+1;o<this.t;++o)t[o-r-1]|=(this[o]&i)<<s,t[o-r]=this[o]>>n;n>0&&(t[this.t-r-1]|=(this.s&i)<<s),t.t=this.t-r,t.clamp()}},S.prototype.subTo=function(e,t){for(var r=0,n=0,s=Math.min(e.t,this.t);r<s;)n+=this[r]-e[r],t[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n-=e.s;r<this.t;)n+=this[r],t[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n-=e[r],t[r++]=n&this.DM,n>>=this.DB;n-=e.s}t.s=n<0?-1:0,n<-1?t[r++]=this.DV+n:n>0&&(t[r++]=n),t.t=r,t.clamp()},S.prototype.multiplyTo=function(e,t){var r=this.abs(),n=e.abs(),s=r.t;for(t.t=s+n.t;--s>=0;)t[s]=0;for(s=0;s<n.t;++s)t[s+r.t]=r.am(0,n[s],t,s,0,r.t);t.s=0,t.clamp(),this.s!=e.s&&S.ZERO.subTo(t,t)},S.prototype.squareTo=function(e){for(var t=this.abs(),r=e.t=2*t.t;--r>=0;)e[r]=0;for(r=0;r<t.t-1;++r){var n=t.am(r,t[r],e,2*r,0,1);(e[r+t.t]+=t.am(r+1,2*t[r],e,2*r+1,n,t.t-r-1))>=t.DV&&(e[r+t.t]-=t.DV,e[r+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(r,t[r],e,2*r,0,1)),e.s=0,e.clamp()},S.prototype.divRemTo=function(e,t,r){var n=e.abs();if(!(n.t<=0)){var s=this.abs();if(s.t<n.t)return null!=t&&t.fromInt(0),void(null!=r&&this.copyTo(r));null==r&&(r=w());var i=w(),o=this.s,a=e.s,c=this.DB-P(n[n.t-1]);c>0?(n.lShiftTo(c,i),s.lShiftTo(c,r)):(n.copyTo(i),s.copyTo(r));var h=i.t,l=i[h-1];if(0!=l){var u=l*(1<<this.F1)+(h>1?i[h-2]>>this.F2:0),d=this.FV/u,p=(1<<this.F1)/u,g=1<<this.F2,m=r.t,f=m-h,y=null==t?w():t;for(i.dlShiftTo(f,y),r.compareTo(y)>=0&&(r[r.t++]=1,r.subTo(y,r)),S.ONE.dlShiftTo(h,y),y.subTo(i,i);i.t<h;)i[i.t++]=0;for(;--f>=0;){var v=r[--m]==l?this.DM:Math.floor(r[m]*d+(r[m-1]+g)*p);if((r[m]+=i.am(0,v,r,f,0,h))<v)for(i.dlShiftTo(f,y),r.subTo(y,r);r[m]<--v;)r.subTo(y,r)}null!=t&&(r.drShiftTo(h,t),o!=a&&S.ZERO.subTo(t,t)),r.t=h,r.clamp(),c>0&&r.rShiftTo(c,r),o<0&&S.ZERO.subTo(r,r)}}},S.prototype.invDigit=function(){if(this.t<1)return 0;var e=this[0];if(0==(1&e))return 0;var t=3&e;return(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)>0?this.DV-t:-t},S.prototype.isEven=function(){return 0==(this.t>0?1&this[0]:this.s)},S.prototype.exp=function(e,t){if(e>4294967295||e<1)return S.ONE;var r=w(),n=w(),s=t.convert(this),i=P(e)-1;for(s.copyTo(r);--i>=0;)if(t.sqrTo(r,n),(e&1<<i)>0)t.mulTo(n,s,r);else{var o=r;r=n,n=o}return t.revert(r)},S.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var r,n=(1<<t)-1,s=!1,i="",o=this.t,a=this.DB-o*this.DB%t;if(o-- >0)for(a<this.DB&&(r=this[o]>>a)>0&&(s=!0,i=T(r));o>=0;)a<t?(r=(this[o]&(1<<a)-1)<<t-a,r|=this[--o]>>(a+=this.DB-t)):(r=this[o]>>(a-=t)&n,a<=0&&(a+=this.DB,--o)),r>0&&(s=!0),s&&(i+=T(r));return s?i:"0"},S.prototype.negate=function(){var e=w();return S.ZERO.subTo(this,e),e},S.prototype.abs=function(){return this.s<0?this.negate():this},S.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var r=this.t;if(0!=(t=r-e.t))return this.s<0?-t:t;for(;--r>=0;)if(0!=(t=this[r]-e[r]))return t;return 0},S.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+P(this[this.t-1]^this.s&this.DM)},S.prototype.mod=function(e){var t=w();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(S.ZERO)>0&&e.subTo(t,t),t},S.prototype.modPowInt=function(e,t){var r;return r=e<256||t.isEven()?new R(t):new I(t),this.exp(e,r)},S.ZERO=N(0),S.ONE=N(1),B.prototype.convert=j,B.prototype.revert=j,B.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r)},B.prototype.sqrTo=function(e,t){e.squareTo(t)},_.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=w();return e.copyTo(t),this.reduce(t),t},_.prototype.revert=function(e){return e},_.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},_.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},_.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)};var H=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],U=(1<<26)/H[H.length-1];function z(){this.i=0,this.j=0,this.S=new Array}S.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},S.prototype.toRadix=function(e){if(null==e&&(e=10),0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),r=Math.pow(e,t),n=N(r),s=w(),i=w(),o="";for(this.divRemTo(n,s,i);s.signum()>0;)o=(r+i.intValue()).toString(e).substr(1)+o,s.divRemTo(n,s,i);return i.intValue().toString(e)+o},S.prototype.fromRadix=function(e,t){this.fromInt(0),null==t&&(t=10);for(var r=this.chunkSize(t),n=Math.pow(t,r),s=!1,i=0,o=0,a=0;a<e.length;++a){var c=O(e,a);c<0?"-"==e.charAt(a)&&0==this.signum()&&(s=!0):(o=t*o+c,++i>=r&&(this.dMultiply(n),this.dAddOffset(o,0),i=0,o=0))}i>0&&(this.dMultiply(Math.pow(t,i)),this.dAddOffset(o,0)),s&&S.ZERO.subTo(this,this)},S.prototype.fromNumber=function(e,t,r){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,r),this.testBit(e-1)||this.bitwiseTo(S.ONE.shiftLeft(e-1),k,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(S.ONE.shiftLeft(e-1),this);else{var n=new Array,s=7&e;n.length=1+(e>>3),t.nextBytes(n),s>0?n[0]&=(1<<s)-1:n[0]=0,this.fromString(n,256)}},S.prototype.bitwiseTo=function(e,t,r){var n,s,i=Math.min(e.t,this.t);for(n=0;n<i;++n)r[n]=t(this[n],e[n]);if(e.t<this.t){for(s=e.s&this.DM,n=i;n<this.t;++n)r[n]=t(this[n],s);r.t=this.t}else{for(s=this.s&this.DM,n=i;n<e.t;++n)r[n]=t(s,e[n]);r.t=e.t}r.s=t(this.s,e.s),r.clamp()},S.prototype.changeBit=function(e,t){var r=S.ONE.shiftLeft(e);return this.bitwiseTo(r,t,r),r},S.prototype.addTo=function(e,t){for(var r=0,n=0,s=Math.min(e.t,this.t);r<s;)n+=this[r]+e[r],t[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n+=e.s;r<this.t;)n+=this[r],t[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n+=e[r],t[r++]=n&this.DM,n>>=this.DB;n+=e.s}t.s=n<0?-1:0,n>0?t[r++]=n:n<-1&&(t[r++]=this.DV+n),t.t=r,t.clamp()},S.prototype.dMultiply=function(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},S.prototype.dAddOffset=function(e,t){if(0!=e){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=e;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}},S.prototype.multiplyLowerTo=function(e,t,r){var n,s=Math.min(this.t+e.t,t);for(r.s=0,r.t=s;s>0;)r[--s]=0;for(n=r.t-this.t;s<n;++s)r[s+this.t]=this.am(0,e[s],r,s,0,this.t);for(n=Math.min(e.t,t);s<n;++s)this.am(0,e[s],r,s,0,t-s);r.clamp()},S.prototype.multiplyUpperTo=function(e,t,r){--t;var n=r.t=this.t+e.t-t;for(r.s=0;--n>=0;)r[n]=0;for(n=Math.max(t-this.t,0);n<e.t;++n)r[this.t+n-t]=this.am(t-n,e[n],r,0,0,this.t+n-t);r.clamp(),r.drShiftTo(1,r)},S.prototype.modInt=function(e){if(e<=0)return 0;var t=this.DV%e,r=this.s<0?e-1:0;if(this.t>0)if(0==t)r=this[0]%e;else for(var n=this.t-1;n>=0;--n)r=(t*r+this[n])%e;return r},S.prototype.millerRabin=function(e){var t=this.subtract(S.ONE),r=t.getLowestSetBit();if(r<=0)return!1;var n=t.shiftRight(r);(e=e+1>>1)>H.length&&(e=H.length);for(var s=w(),i=0;i<e;++i){s.fromInt(H[Math.floor(Math.random()*H.length)]);var o=s.modPow(n,this);if(0!=o.compareTo(S.ONE)&&0!=o.compareTo(t)){for(var a=1;a++<r&&0!=o.compareTo(t);)if(0==(o=o.modPowInt(2,this)).compareTo(S.ONE))return!1;if(0!=o.compareTo(t))return!1}}return!0},S.prototype.clone=function(){var e=w();return this.copyTo(e),e},S.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},S.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},S.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},S.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},S.prototype.toByteArray=function(){var e=this.t,t=new Array;t[0]=this.s;var r,n=this.DB-e*this.DB%8,s=0;if(e-- >0)for(n<this.DB&&(r=this[e]>>n)!=(this.s&this.DM)>>n&&(t[s++]=r|this.s<<this.DB-n);e>=0;)n<8?(r=(this[e]&(1<<n)-1)<<8-n,r|=this[--e]>>(n+=this.DB-8)):(r=this[e]>>(n-=8)&255,n<=0&&(n+=this.DB,--e)),0!=(128&r)&&(r|=-256),0==s&&(128&this.s)!=(128&r)&&++s,(s>0||r!=this.s)&&(t[s++]=r);return t},S.prototype.equals=function(e){return 0==this.compareTo(e)},S.prototype.min=function(e){return this.compareTo(e)<0?this:e},S.prototype.max=function(e){return this.compareTo(e)>0?this:e},S.prototype.and=function(e){var t=w();return this.bitwiseTo(e,F,t),t},S.prototype.or=function(e){var t=w();return this.bitwiseTo(e,k,t),t},S.prototype.xor=function(e){var t=w();return this.bitwiseTo(e,D,t),t},S.prototype.andNot=function(e){var t=w();return this.bitwiseTo(e,M,t),t},S.prototype.not=function(){for(var e=w(),t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e},S.prototype.shiftLeft=function(e){var t=w();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},S.prototype.shiftRight=function(e){var t=w();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},S.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this[e])return e*this.DB+q(this[e]);return this.s<0?this.t*this.DB:-1},S.prototype.bitCount=function(){for(var e=0,t=this.s&this.DM,r=0;r<this.t;++r)e+=L(this[r]^t);return e},S.prototype.testBit=function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this[t]&1<<e%this.DB)},S.prototype.setBit=function(e){return this.changeBit(e,k)},S.prototype.clearBit=function(e){return this.changeBit(e,M)},S.prototype.flipBit=function(e){return this.changeBit(e,D)},S.prototype.add=function(e){var t=w();return this.addTo(e,t),t},S.prototype.subtract=function(e){var t=w();return this.subTo(e,t),t},S.prototype.multiply=function(e){var t=w();return this.multiplyTo(e,t),t},S.prototype.divide=function(e){var t=w();return this.divRemTo(e,t,null),t},S.prototype.remainder=function(e){var t=w();return this.divRemTo(e,null,t),t},S.prototype.divideAndRemainder=function(e){var t=w(),r=w();return this.divRemTo(e,t,r),new Array(t,r)},S.prototype.modPow=function(e,t){var r,n,s=e.bitLength(),i=N(1);if(s<=0)return i;r=s<18?1:s<48?3:s<144?4:s<768?5:6,n=s<8?new R(t):t.isEven()?new _(t):new I(t);var o=new Array,a=3,c=r-1,h=(1<<r)-1;if(o[1]=n.convert(this),r>1){var l=w();for(n.sqrTo(o[1],l);a<=h;)o[a]=w(),n.mulTo(l,o[a-2],o[a]),a+=2}var u,d,p=e.t-1,g=!0,m=w();for(s=P(e[p])-1;p>=0;){for(s>=c?u=e[p]>>s-c&h:(u=(e[p]&(1<<s+1)-1)<<c-s,p>0&&(u|=e[p-1]>>this.DB+s-c)),a=r;0==(1&u);)u>>=1,--a;if((s-=a)<0&&(s+=this.DB,--p),g)o[u].copyTo(i),g=!1;else{for(;a>1;)n.sqrTo(i,m),n.sqrTo(m,i),a-=2;a>0?n.sqrTo(i,m):(d=i,i=m,m=d),n.mulTo(m,o[u],i)}for(;p>=0&&0==(e[p]&1<<s);)n.sqrTo(i,m),d=i,i=m,m=d,--s<0&&(s=this.DB-1,--p)}return n.revert(i)},S.prototype.modInverse=function(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return S.ZERO;for(var r=e.clone(),n=this.clone(),s=N(1),i=N(0),o=N(0),a=N(1);0!=r.signum();){for(;r.isEven();)r.rShiftTo(1,r),t?(s.isEven()&&i.isEven()||(s.addTo(this,s),i.subTo(e,i)),s.rShiftTo(1,s)):i.isEven()||i.subTo(e,i),i.rShiftTo(1,i);for(;n.isEven();)n.rShiftTo(1,n),t?(o.isEven()&&a.isEven()||(o.addTo(this,o),a.subTo(e,a)),o.rShiftTo(1,o)):a.isEven()||a.subTo(e,a),a.rShiftTo(1,a);r.compareTo(n)>=0?(r.subTo(n,r),t&&s.subTo(o,s),i.subTo(a,i)):(n.subTo(r,n),t&&o.subTo(s,o),a.subTo(i,a))}return 0!=n.compareTo(S.ONE)?S.ZERO:a.compareTo(e)>=0?a.subtract(e):a.signum()<0?(a.addTo(e,a),a.signum()<0?a.add(e):a):a},S.prototype.pow=function(e){return this.exp(e,new B)},S.prototype.gcd=function(e){var t=this.s<0?this.negate():this.clone(),r=e.s<0?e.negate():e.clone();if(t.compareTo(r)<0){var n=t;t=r,r=n}var s=t.getLowestSetBit(),i=r.getLowestSetBit();if(i<0)return t;for(s<i&&(i=s),i>0&&(t.rShiftTo(i,t),r.rShiftTo(i,r));t.signum()>0;)(s=t.getLowestSetBit())>0&&t.rShiftTo(s,t),(s=r.getLowestSetBit())>0&&r.rShiftTo(s,r),t.compareTo(r)>=0?(t.subTo(r,t),t.rShiftTo(1,t)):(r.subTo(t,r),r.rShiftTo(1,r));return i>0&&r.lShiftTo(i,r),r},S.prototype.isProbablePrime=function(e){var t,r=this.abs();if(1==r.t&&r[0]<=H[H.length-1]){for(t=0;t<H.length;++t)if(r[0]==H[t])return!0;return!1}if(r.isEven())return!1;for(t=1;t<H.length;){for(var n=H[t],s=t+1;s<H.length&&n<U;)n*=H[s++];for(n=r.modInt(n);t<s;)if(n%H[t++]==0)return!1}return r.millerRabin(e)},S.prototype.square=function(){var e=w();return this.squareTo(e),e},z.prototype.init=function(e){var t,r,n;for(t=0;t<256;++t)this.S[t]=t;for(r=0,t=0;t<256;++t)r=r+this.S[t]+e[t%e.length]&255,n=this.S[t],this.S[t]=this.S[r],this.S[r]=n;this.i=0,this.j=0},z.prototype.next=function(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]};var V,G,K,W=256;function $(){!function(e){G[K++]^=255&e,G[K++]^=e>>8&255,G[K++]^=e>>16&255,G[K++]^=e>>24&255,K>=W&&(K-=W)}((new Date).getTime())}if(null==G){var J;if(G=new Array,K=0,void 0!==d&&(void 0!==d.crypto||void 0!==d.msCrypto)){var X=d.crypto||d.msCrypto;if(X.getRandomValues){var Q=new Uint8Array(32);for(X.getRandomValues(Q),J=0;J<32;++J)G[K++]=Q[J]}else if("Netscape"==u.appName&&u.appVersion<"5"){var Z=d.crypto.random(32);for(J=0;J<Z.length;++J)G[K++]=255&Z.charCodeAt(J)}}for(;K<W;)J=Math.floor(65536*Math.random()),G[K++]=J>>>8,G[K++]=255&J;K=0,$()}function Y(){if(null==V){for($(),(V=new z).init(G),K=0;K<G.length;++K)G[K]=0;K=0}return V.next()}function ee(){}function te(e,t){return new S(e,t)}function re(e,t,r){for(var n="",s=0;n.length<t;)n+=r(String.fromCharCode.apply(String,e.concat([(4278190080&s)>>24,(16711680&s)>>16,(65280&s)>>8,255&s]))),s+=1;return n}function ne(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function se(e,t,r){for(var n="",s=0;n.length<t;)n+=r(e+String.fromCharCode.apply(String,[(4278190080&s)>>24,(16711680&s)>>16,(65280&s)>>8,255&s])),s+=1;return n}function ie(e,t){this.x=t,this.q=e}function oe(e,t,r,n){this.curve=e,this.x=t,this.y=r,this.z=null==n?S.ONE:n,this.zinv=null}function ae(e,t,r){this.q=e,this.a=this.fromBigInteger(t),this.b=this.fromBigInteger(r),this.infinity=new oe(this,null,null)}ee.prototype.nextBytes=function(e){var t;for(t=0;t<e.length;++t)e[t]=Y()},ne.prototype.doPublic=function(e){return e.modPowInt(this.e,this.n)},ne.prototype.setPublic=function(e,t){if(this.isPublic=!0,this.isPrivate=!1,"string"!=typeof e)this.n=e,this.e=t;else{if(!(null!=e&&null!=t&&e.length>0&&t.length>0))throw"Invalid RSA public key";this.n=te(e,16),this.e=parseInt(t,16)}},ne.prototype.encrypt=function(e){var t=function(e,t){if(t<e.length+11)throw"Message too long for RSA";for(var r=new Array,n=e.length-1;n>=0&&t>0;){var s=e.charCodeAt(n--);s<128?r[--t]=s:s>127&&s<2048?(r[--t]=63&s|128,r[--t]=s>>6|192):(r[--t]=63&s|128,r[--t]=s>>6&63|128,r[--t]=s>>12|224)}r[--t]=0;for(var i=new ee,o=new Array;t>2;){for(o[0]=0;0==o[0];)i.nextBytes(o);r[--t]=o[0]}return r[--t]=2,r[--t]=0,new S(r)}(e,this.n.bitLength()+7>>3);if(null==t)return null;var r=this.doPublic(t);if(null==r)return null;var n=r.toString(16);return 0==(1&n.length)?n:"0"+n},ne.prototype.encryptOAEP=function(e,t,r){var n=this.n.bitLength()+7>>3,s=function(e,t,r,n){var s=he.crypto.MessageDigest,i=he.crypto.Util,o=null;if(r||(r="sha1"),"string"==typeof r&&(o=s.getCanonicalAlgName(r),n=s.getHashLength(o),r=function(e){return Ee(i.hashHex(Ae(e),o))}),e.length+2*n+2>t)throw"Message too long for RSA";var a,c="";for(a=0;a<t-e.length-2*n-2;a+=1)c+="\0";var h=r("")+c+""+e,l=new Array(n);(new ee).nextBytes(l);var u=re(l,h.length,r),d=[];for(a=0;a<h.length;a+=1)d[a]=h.charCodeAt(a)^u.charCodeAt(a);var p=re(d,l.length,r),g=[0];for(a=0;a<l.length;a+=1)g[a+1]=l[a]^p.charCodeAt(a);return new S(g.concat(d))}(e,n,t,r);if(null==s)return null;var i=this.doPublic(s);if(null==i)return null;for(var o=i.toString(16);o.length<2*n;)o="0"+o;return o},ne.prototype.type="RSA",ne.prototype.doPrivate=function(e){if(null==this.p||null==this.q)return e.modPow(this.d,this.n);for(var t=e.mod(this.p).modPow(this.dmp1,this.p),r=e.mod(this.q).modPow(this.dmq1,this.q);t.compareTo(r)<0;)t=t.add(this.p);return t.subtract(r).multiply(this.coeff).mod(this.p).multiply(this.q).add(r)},ne.prototype.setPrivate=function(e,t,r){if(this.isPrivate=!0,"string"!=typeof e)this.n=e,this.e=t,this.d=r;else{if(!(null!=e&&null!=t&&e.length>0&&t.length>0))throw"Invalid RSA private key";this.n=te(e,16),this.e=parseInt(t,16),this.d=te(r,16)}},ne.prototype.setPrivateEx=function(e,t,r,n,s,i,o,a){if(this.isPrivate=!0,this.isPublic=!1,null==e)throw"RSASetPrivateEx N == null";if(null==t)throw"RSASetPrivateEx E == null";if(0==e.length)throw"RSASetPrivateEx N.length == 0";if(0==t.length)throw"RSASetPrivateEx E.length == 0";if(!(null!=e&&null!=t&&e.length>0&&t.length>0))throw"Invalid RSA private key in RSASetPrivateEx";this.n=te(e,16),this.e=parseInt(t,16),this.d=te(r,16),this.p=te(n,16),this.q=te(s,16),this.dmp1=te(i,16),this.dmq1=te(o,16),this.coeff=te(a,16)},ne.prototype.generate=function(e,t){var r=new ee,n=e>>1;this.e=parseInt(t,16);for(var s=new S(t,16),i=e/2-100,o=S.ONE.shiftLeft(i);;){for(;this.p=new S(e-n,1,r),0!=this.p.subtract(S.ONE).gcd(s).compareTo(S.ONE)||!this.p.isProbablePrime(10););for(;this.q=new S(n,1,r),0!=this.q.subtract(S.ONE).gcd(s).compareTo(S.ONE)||!this.q.isProbablePrime(10););if(this.p.compareTo(this.q)<=0){var a=this.p;this.p=this.q,this.q=a}var c=this.q.subtract(this.p).abs();if(!(c.bitLength()<i||c.compareTo(o)<=0)){var h=this.p.subtract(S.ONE),l=this.q.subtract(S.ONE),u=h.multiply(l);if(0==u.gcd(s).compareTo(S.ONE)&&(this.n=this.p.multiply(this.q),this.n.bitLength()==e)){this.d=s.modInverse(u),this.dmp1=this.d.mod(h),this.dmq1=this.d.mod(l),this.coeff=this.q.modInverse(this.p);break}}}this.isPrivate=!0},ne.prototype.decrypt=function(e){if(e.length!=Math.ceil(this.n.bitLength()/4))throw new Error("wrong ctext length");var t=te(e,16),r=this.doPrivate(t);return null==r?null:function(e,t){for(var r=e.toByteArray(),n=0;n<r.length&&0==r[n];)++n;if(r.length-n!=t-1||2!=r[n])return null;for(++n;0!=r[n];)if(++n>=r.length)return null;for(var s="";++n<r.length;){var i=255&r[n];i<128?s+=String.fromCharCode(i):i>191&&i<224?(s+=String.fromCharCode((31&i)<<6|63&r[n+1]),++n):(s+=String.fromCharCode((15&i)<<12|(63&r[n+1])<<6|63&r[n+2]),n+=2)}return s}(r,this.n.bitLength()+7>>3)},ne.prototype.decryptOAEP=function(e,t,r){if(e.length!=Math.ceil(this.n.bitLength()/4))throw new Error("wrong ctext length");var n=te(e,16),s=this.doPrivate(n);return null==s?null:function(e,t,r,n){var s=he.crypto.MessageDigest,i=he.crypto.Util,o=null;for(r||(r="sha1"),"string"==typeof r&&(o=s.getCanonicalAlgName(r),n=s.getHashLength(o),r=function(e){return Ee(i.hashHex(Ae(e),o))}),e=e.toByteArray(),a=0;a<e.length;a+=1)e[a]&=255;for(;e.length<t;)e.unshift(0);if((e=String.fromCharCode.apply(String,e)).length<2*n+2)throw"Cipher too short";var a,c=e.substr(1,n),h=e.substr(n+1),l=se(h,n,r),u=[];for(a=0;a<c.length;a+=1)u[a]=c.charCodeAt(a)^l.charCodeAt(a);var d=se(String.fromCharCode.apply(String,u),e.length-n,r),p=[];for(a=0;a<h.length;a+=1)p[a]=h.charCodeAt(a)^d.charCodeAt(a);if((p=String.fromCharCode.apply(String,p)).substr(0,n)!==r(""))throw"Hash mismatch";var g=(p=p.substr(n)).indexOf("");if((-1!=g?p.substr(0,g).lastIndexOf("\0"):-1)+1!=g)throw"Malformed data";return p.substr(g+1)}(s,this.n.bitLength()+7>>3,t,r)},ie.prototype.equals=function(e){return e==this||this.q.equals(e.q)&&this.x.equals(e.x)},ie.prototype.toBigInteger=function(){return this.x},ie.prototype.negate=function(){return new ie(this.q,this.x.negate().mod(this.q))},ie.prototype.add=function(e){return new ie(this.q,this.x.add(e.toBigInteger()).mod(this.q))},ie.prototype.subtract=function(e){return new ie(this.q,this.x.subtract(e.toBigInteger()).mod(this.q))},ie.prototype.multiply=function(e){return new ie(this.q,this.x.multiply(e.toBigInteger()).mod(this.q))},ie.prototype.square=function(){return new ie(this.q,this.x.square().mod(this.q))},ie.prototype.divide=function(e){return new ie(this.q,this.x.multiply(e.toBigInteger().modInverse(this.q)).mod(this.q))},ie.prototype.sqrt=function(){return new ie(this.q,this.x.sqrt().mod(this.q))},oe.prototype.getX=function(){return null==this.zinv&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))},oe.prototype.getY=function(){return null==this.zinv&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))},oe.prototype.equals=function(e){return e==this||(this.isInfinity()?e.isInfinity():e.isInfinity()?this.isInfinity():!!e.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(e.z)).mod(this.curve.q).equals(S.ZERO)&&e.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(e.z)).mod(this.curve.q).equals(S.ZERO))},oe.prototype.isInfinity=function(){return null==this.x&&null==this.y||this.z.equals(S.ZERO)&&!this.y.toBigInteger().equals(S.ZERO)},oe.prototype.negate=function(){return new oe(this.curve,this.x,this.y.negate(),this.z)},oe.prototype.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var t=e.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(e.z)).mod(this.curve.q),r=e.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(e.z)).mod(this.curve.q);if(S.ZERO.equals(r))return S.ZERO.equals(t)?this.twice():this.curve.getInfinity();var n=new S("3"),s=this.x.toBigInteger(),i=this.y.toBigInteger(),o=(e.x.toBigInteger(),e.y.toBigInteger(),r.square()),a=o.multiply(r),c=s.multiply(o),h=t.square().multiply(this.z),l=h.subtract(c.shiftLeft(1)).multiply(e.z).subtract(a).multiply(r).mod(this.curve.q),u=c.multiply(n).multiply(t).subtract(i.multiply(a)).subtract(h.multiply(t)).multiply(e.z).add(t.multiply(a)).mod(this.curve.q),d=a.multiply(this.z).multiply(e.z).mod(this.curve.q);return new oe(this.curve,this.curve.fromBigInteger(l),this.curve.fromBigInteger(u),d)},oe.prototype.twice=function(){if(this.isInfinity())return this;if(0==this.y.toBigInteger().signum())return this.curve.getInfinity();var e=new S("3"),t=this.x.toBigInteger(),r=this.y.toBigInteger(),n=r.multiply(this.z),s=n.multiply(r).mod(this.curve.q),i=this.curve.a.toBigInteger(),o=t.square().multiply(e);S.ZERO.equals(i)||(o=o.add(this.z.square().multiply(i)));var a=(o=o.mod(this.curve.q)).square().subtract(t.shiftLeft(3).multiply(s)).shiftLeft(1).multiply(n).mod(this.curve.q),c=o.multiply(e).multiply(t).subtract(s.shiftLeft(1)).shiftLeft(2).multiply(s).subtract(o.square().multiply(o)).mod(this.curve.q),h=n.square().multiply(n).shiftLeft(3).mod(this.curve.q);return new oe(this.curve,this.curve.fromBigInteger(a),this.curve.fromBigInteger(c),h)},oe.prototype.multiply=function(e){if(this.isInfinity())return this;if(0==e.signum())return this.curve.getInfinity();var t,r=e,n=r.multiply(new S("3")),s=this.negate(),i=this,o=this.curve.q.subtract(e),a=o.multiply(new S("3")),c=new oe(this.curve,this.x,this.y),h=c.negate();for(t=n.bitLength()-2;t>0;--t){i=i.twice();var l=n.testBit(t);l!=r.testBit(t)&&(i=i.add(l?this:s))}for(t=a.bitLength()-2;t>0;--t){c=c.twice();var u=a.testBit(t);u!=o.testBit(t)&&(c=c.add(u?c:h))}return i},oe.prototype.multiplyTwo=function(e,t,r){var n;n=e.bitLength()>r.bitLength()?e.bitLength()-1:r.bitLength()-1;for(var s=this.curve.getInfinity(),i=this.add(t);n>=0;)s=s.twice(),e.testBit(n)?s=r.testBit(n)?s.add(i):s.add(this):r.testBit(n)&&(s=s.add(t)),--n;return s},ae.prototype.getQ=function(){return this.q},ae.prototype.getA=function(){return this.a},ae.prototype.getB=function(){return this.b},ae.prototype.equals=function(e){return e==this||this.q.equals(e.q)&&this.a.equals(e.a)&&this.b.equals(e.b)},ae.prototype.getInfinity=function(){return this.infinity},ae.prototype.fromBigInteger=function(e){return new ie(this.q,e)},ae.prototype.decodePointHex=function(e){switch(parseInt(e.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:var t=e.substr(0,2),r=(e.substr(2),this.fromBigInteger(new S(a,16))),n=this.getA(),s=this.getB(),i=r.square().add(n).multiply(r).add(s).sqrt();return"03"==t&&(i=i.negate()),new oe(this,r,i);case 4:case 6:case 7:var o=(e.length-2)/2,a=e.substr(2,o),c=e.substr(o+2,o);return new oe(this,this.fromBigInteger(new S(a,16)),this.fromBigInteger(new S(c,16)));default:return null}},ie.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)},oe.prototype.getEncoded=function(e){var t=function(e,t){var r=e.toByteArrayUnsigned();if(t<r.length)r=r.slice(r.length-t);else for(;t>r.length;)r.unshift(0);return r},r=this.getX().toBigInteger(),n=this.getY().toBigInteger(),s=t(r,32);return e?n.isEven()?s.unshift(2):s.unshift(3):(s.unshift(4),s=s.concat(t(n,32))),s},oe.decodeFrom=function(e,t){t[0];var r=t.length-1,n=t.slice(1,1+r/2),s=t.slice(1+r/2,1+r);n.unshift(0),s.unshift(0);var i=new S(n),o=new S(s);return new oe(e,e.fromBigInteger(i),e.fromBigInteger(o))},oe.decodeFromHex=function(e,t){t.substr(0,2);var r=t.length-2,n=t.substr(2,r/2),s=t.substr(2+r/2,r/2),i=new S(n,16),o=new S(s,16);return new oe(e,e.fromBigInteger(i),e.fromBigInteger(o))},oe.prototype.add2D=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;if(this.x.equals(e.x))return this.y.equals(e.y)?this.twice():this.curve.getInfinity();var t=e.x.subtract(this.x),r=e.y.subtract(this.y).divide(t),n=r.square().subtract(this.x).subtract(e.x),s=r.multiply(this.x.subtract(n)).subtract(this.y);return new oe(this.curve,n,s)},oe.prototype.twice2D=function(){if(this.isInfinity())return this;if(0==this.y.toBigInteger().signum())return this.curve.getInfinity();var e=this.curve.fromBigInteger(S.valueOf(2)),t=this.curve.fromBigInteger(S.valueOf(3)),r=this.x.square().multiply(t).add(this.curve.a).divide(this.y.multiply(e)),n=r.square().subtract(this.x.multiply(e)),s=r.multiply(this.x.subtract(n)).subtract(this.y);return new oe(this.curve,n,s)},oe.prototype.multiply2D=function(e){if(this.isInfinity())return this;if(0==e.signum())return this.curve.getInfinity();var t,r=e,n=r.multiply(new S("3")),s=this.negate(),i=this;for(t=n.bitLength()-2;t>0;--t){i=i.twice();var o=n.testBit(t);o!=r.testBit(t)&&(i=i.add2D(o?this:s))}return i},oe.prototype.isOnCurve=function(){var e=this.getX().toBigInteger(),t=this.getY().toBigInteger(),r=this.curve.getA().toBigInteger(),n=this.curve.getB().toBigInteger(),s=this.curve.getQ(),i=t.multiply(t).mod(s),o=e.multiply(e).multiply(e).add(r.multiply(e)).add(n).mod(s);return i.equals(o)},oe.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"},oe.prototype.validate=function(){var e=this.curve.getQ();if(this.isInfinity())throw new Error("Point is at infinity.");var t=this.getX().toBigInteger(),r=this.getY().toBigInteger();if(t.compareTo(S.ONE)<0||t.compareTo(e.subtract(S.ONE))>0)throw new Error("x coordinate out of bounds");if(r.compareTo(S.ONE)<0||r.compareTo(e.subtract(S.ONE))>0)throw new Error("y coordinate out of bounds");if(!this.isOnCurve())throw new Error("Point is not on the curve.");if(this.multiply(e).isInfinity())throw new Error("Point is not a scalar multiple of G.");return!0};var ce=function(){var e=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),t=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),r={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};function n(e,t,n){return t?r[t]:String.fromCharCode(parseInt(n,16))}var s=new String(""),i=Object.hasOwnProperty;return function(r,o){var a,c,h=r.match(e),l=h[0],u=!1;"{"===l?a={}:"["===l?a=[]:(a=[],u=!0);for(var d=[a],p=1-u,g=h.length;p<g;++p){var m;switch((l=h[p]).charCodeAt(0)){default:(m=d[0])[c||m.length]=+l,c=void 0;break;case 34:if(-1!==(l=l.substring(1,l.length-1)).indexOf("\\")&&(l=l.replace(t,n)),m=d[0],!c){if(!(m instanceof Array)){c=l||s;break}c=m.length}m[c]=l,c=void 0;break;case 91:m=d[0],d.unshift(m[c||m.length]=[]),c=void 0;break;case 93:case 125:d.shift();break;case 102:(m=d[0])[c||m.length]=!1,c=void 0;break;case 110:(m=d[0])[c||m.length]=null,c=void 0;break;case 116:(m=d[0])[c||m.length]=!0,c=void 0;break;case 123:m=d[0],d.unshift(m[c||m.length]={}),c=void 0}}if(u){if(1!==d.length)throw new Error;a=a[0]}else if(d.length)throw new Error;if(o){var f=function(e,t){var r=e[t];if(r&&"object"==typeof r){var n=null;for(var s in r)if(i.call(r,s)&&r!==e){var a=f(r,s);void 0!==a?r[s]=a:(n||(n=[]),n.push(s))}if(n)for(var c=n.length;--c>=0;)delete r[n[c]]}return o.call(e,t,r)};a=f({"":a},"")}return a}}();void 0!==he&&he||(he={}),void 0!==he.asn1&&he.asn1||(he.asn1={}),he.asn1.ASN1Util=new function(){this.integerToByteHex=function(e){var t=e.toString(16);return t.length%2==1&&(t="0"+t),t},this.bigIntToMinTwosComplementsHex=function(e){return Xe(e)},this.getPEMStringFromHex=function(e,t){return Pe(e,t)},this.newObject=function(e){var t=he.asn1,r=t.ASN1Object,n=t.DERBoolean,s=t.DERInteger,i=t.DERBitString,o=t.DEROctetString,a=t.DERNull,c=t.DERObjectIdentifier,h=t.DEREnumerated,l=t.DERUTF8String,u=t.DERNumericString,d=t.DERPrintableString,p=t.DERTeletexString,g=t.DERIA5String,m=t.DERUTCTime,f=t.DERGeneralizedTime,y=t.DERVisibleString,v=t.DERBMPString,b=t.DERSequence,S=t.DERSet,w=t.DERTaggedObject,x=t.ASN1Util.newObject;if(e instanceof t.ASN1Object)return e;var C=Object.keys(e);if(1!=C.length)throw new Error("key of param shall be only one.");var E=C[0];if(-1==":asn1:bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:visstr:bmpstr:seq:set:tag:".indexOf(":"+E+":"))throw new Error("undefined key: "+E);if("bool"==E)return new n(e[E]);if("int"==E)return new s(e[E]);if("bitstr"==E)return new i(e[E]);if("octstr"==E)return new o(e[E]);if("null"==E)return new a(e[E]);if("oid"==E)return new c(e[E]);if("enum"==E)return new h(e[E]);if("utf8str"==E)return new l(e[E]);if("numstr"==E)return new u(e[E]);if("prnstr"==E)return new d(e[E]);if("telstr"==E)return new p(e[E]);if("ia5str"==E)return new g(e[E]);if("utctime"==E)return new m(e[E]);if("gentime"==E)return new f(e[E]);if("visstr"==E)return new y(e[E]);if("bmpstr"==E)return new v(e[E]);if("asn1"==E)return new r(e[E]);if("seq"==E){for(var A=e[E],T=[],O=0;O<A.length;O++){var N=x(A[O]);T.push(N)}return new b({array:T})}if("set"==E){for(A=e[E],T=[],O=0;O<A.length;O++)N=x(A[O]),T.push(N);return new S({array:T})}if("tag"==E){var P=e[E];if("[object Array]"===Object.prototype.toString.call(P)&&3==P.length){var R=x(P[2]);return new w({tag:P[0],explicit:P[1],obj:R})}return new w(P)}},this.jsonToASN1HEX=function(e){return this.newObject(e).tohex()}},he.asn1.ASN1Util.oidHexToInt=function(e){for(var t="",r=parseInt(e.substr(0,2),16),n=(t=Math.floor(r/40)+"."+r%40,""),s=2;s<e.length;s+=2){var i=("00000000"+parseInt(e.substr(s,2),16).toString(2)).slice(-8);n+=i.substr(1,7),"0"==i.substr(0,1)&&(t=t+"."+new S(n,2).toString(10),n="")}return t},he.asn1.ASN1Util.oidIntToHex=function(e){var t=function(e){var t=e.toString(16);return 1==t.length&&(t="0"+t),t},r=function(e){var r="",n=new S(e,10).toString(2),s=7-n.length%7;7==s&&(s=0);for(var i="",o=0;o<s;o++)i+="0";for(n=i+n,o=0;o<n.length-1;o+=7){var a=n.substr(o,7);o!=n.length-7&&(a="1"+a),r+=t(parseInt(a,2))}return r};if(!e.match(/^[0-9.]+$/))throw"malformed oid string: "+e;var n="",s=e.split("."),i=40*parseInt(s[0])+parseInt(s[1]);n+=t(i),s.splice(0,2);for(var o=0;o<s.length;o++)n+=r(s[o]);return n},he.asn1.ASN1Object=function(e){this.params=null,this.getLengthHexFromValue=function(){if(void 0===this.hV||null==this.hV)throw new Error("this.hV is null or undefined");if(this.hV.length%2==1)throw new Error("value hex must be even length: n=0,v="+this.hV);var e=this.hV.length/2,t=e.toString(16);if(t.length%2==1&&(t="0"+t),e<128)return t;var r=t.length/2;if(r>15)throw new Error("ASN.1 length too long to represent by 8x: n = "+e.toString(16));return(128+r).toString(16)+t},this.tohex=function(){return(null==this.hTLV||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getEncodedHex=function(){return this.tohex()},this.getValueHex=function(){return this.tohex(),this.hV},this.getFreshValueHex=function(){return""},this.setByParam=function(e){this.params=e},null!=e&&null!=e.tlv&&(this.hTLV=e.tlv,this.isModified=!1)},he.asn1.DERAbstractString=function(e){he.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(e){this.hTLV=null,this.isModified=!0,this.s=e,this.hV=we(this.s).toLowerCase()},this.setStringHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.getFreshValueHex=function(){return this.hV},void 0!==e&&("string"==typeof e?this.setString(e):void 0!==e.str?this.setString(e.str):void 0!==e.hex&&this.setStringHex(e.hex))},nt(he.asn1.DERAbstractString,he.asn1.ASN1Object),he.asn1.DERAbstractTime=function(e){he.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(e){var t=e.getTime()+6e4*e.getTimezoneOffset();return new Date(t)},this.formatDate=function(e,t,r){var n=this.zeroPadding,s=this.localDateToUTC(e),i=String(s.getFullYear());"utc"==t&&(i=i.substr(2,2));var o=i+n(String(s.getMonth()+1),2)+n(String(s.getDate()),2)+n(String(s.getHours()),2)+n(String(s.getMinutes()),2)+n(String(s.getSeconds()),2);if(!0===r){var a=s.getMilliseconds();if(0!=a){var c=n(String(a),3);o=o+"."+(c=c.replace(/[0]+$/,""))}}return o+"Z"},this.zeroPadding=function(e,t){return e.length>=t?e:new Array(t-e.length+1).join("0")+e},this.setByParam=function(e){this.hV=null,this.hTLV=null,this.params=e},this.getString=function(){},this.setString=function(e){this.hTLV=null,this.isModified=!0,null==this.params&&(this.params={}),this.params.str=e},this.setByDate=function(e){this.hTLV=null,this.isModified=!0,null==this.params&&(this.params={}),this.params.date=e},this.setByDateValue=function(e,t,r,n,s,i){var o=new Date(Date.UTC(e,t-1,r,n,s,i,0));this.setByDate(o)},this.getFreshValueHex=function(){return this.hV}},nt(he.asn1.DERAbstractTime,he.asn1.ASN1Object),he.asn1.DERAbstractStructured=function(e){he.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array=e},this.appendASN1Object=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array.push(e)},this.asn1Array=new Array,void 0!==e&&void 0!==e.array&&(this.asn1Array=e.array)},nt(he.asn1.DERAbstractStructured,he.asn1.ASN1Object),he.asn1.DERBoolean=function(e){he.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV=0==e?"010100":"0101ff"},nt(he.asn1.DERBoolean,he.asn1.ASN1Object),he.asn1.DERInteger=function(e){he.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.params=null;var t=Xe;this.setByBigInteger=function(e){this.isModified=!0,this.params={bigint:e}},this.setByInteger=function(e){this.isModified=!0,this.params=e},this.setValueHex=function(e){this.isModified=!0,this.params={hex:e}},this.getFreshValueHex=function(){var e=this.params,r=null;if(null==e)throw new Error("value not set");if("object"==typeof e&&null!=e.hex)return this.hV=e.hex,this.hV;if("number"==typeof e)r=new S(String(e),10);else if(null!=e.int)r=new S(String(e.int),10);else{if(null==e.bigint)throw new Error("wrong parameter");r=e.bigint}return this.hV=t(r),this.hV},null!=e&&(this.params=e)},nt(he.asn1.DERInteger,he.asn1.ASN1Object),he.asn1.DERBitString=function(e){if(void 0!==e&&void 0!==e.obj){var t=he.asn1.ASN1Util.newObject(e.obj);e.hex="00"+t.tohex()}he.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(e){this.hTLV=null,this.isModified=!0,this.hV=e},this.setUnusedBitsAndHexValue=function(e,t){if(e<0||7<e)throw"unused bits shall be from 0 to 7: u = "+e;var r="0"+e;this.hTLV=null,this.isModified=!0,this.hV=r+t},this.setByBinaryString=function(e){var t=8-(e=e.replace(/0+$/,"")).length%8;8==t&&(t=0),e+="0000000".substr(0,t);for(var r="",n=0;n<e.length-1;n+=8){var s=e.substr(n,8),i=parseInt(s,2).toString(16);1==i.length&&(i="0"+i),r+=i}this.hTLV=null,this.isModified=!0,this.hV="0"+t+r},this.setByBooleanArray=function(e){for(var t="",r=0;r<e.length;r++)1==e[r]?t+="1":t+="0";this.setByBinaryString(t)},this.newFalseArray=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=!1;return t},this.getFreshValueHex=function(){return this.hV},void 0!==e&&("string"==typeof e&&e.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(e):void 0!==e.hex?this.setHexValueIncludingUnusedBits(e.hex):void 0!==e.bin?this.setByBinaryString(e.bin):void 0!==e.array&&this.setByBooleanArray(e.array))},nt(he.asn1.DERBitString,he.asn1.ASN1Object),he.asn1.DEROctetString=function(e){if(void 0!==e&&void 0!==e.obj){var t=he.asn1.ASN1Util.newObject(e.obj);e.hex=t.tohex()}he.asn1.DEROctetString.superclass.constructor.call(this,e),this.hT="04"},nt(he.asn1.DEROctetString,he.asn1.DERAbstractString),he.asn1.DERNull=function(){he.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},nt(he.asn1.DERNull,he.asn1.ASN1Object),he.asn1.DERObjectIdentifier=function(e){he.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.setValueOidString=function(e){var t=We(e);if(null==t)throw new Error("malformed oid string: "+e);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=t},this.setValueName=function(e){var t=he.asn1.x509.OID.name2oid(e);if(""===t)throw new Error("DERObjectIdentifier oidName undefined: "+e);this.setValueOidString(t)},this.setValueNameOrOid=function(e){e.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(e):this.setValueName(e)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(e){"string"==typeof e?this.setValueNameOrOid(e):void 0!==e.oid?this.setValueNameOrOid(e.oid):void 0!==e.name?this.setValueNameOrOid(e.name):void 0!==e.hex&&this.setValueHex(e.hex)},void 0!==e&&this.setByParam(e)},nt(he.asn1.DERObjectIdentifier,he.asn1.ASN1Object),he.asn1.DEREnumerated=function(e){he.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(e){this.hTLV=null,this.isModified=!0,this.hV=Xe(e)},this.setByInteger=function(e){var t=new S(String(e),10);this.setByBigInteger(t)},this.setValueHex=function(e){this.hV=e},this.getFreshValueHex=function(){return this.hV},void 0!==e&&(void 0!==e.int?this.setByInteger(e.int):"number"==typeof e?this.setByInteger(e):void 0!==e.hex&&this.setValueHex(e.hex))},nt(he.asn1.DEREnumerated,he.asn1.ASN1Object),he.asn1.DERUTF8String=function(e){he.asn1.DERUTF8String.superclass.constructor.call(this,e),this.hT="0c"},nt(he.asn1.DERUTF8String,he.asn1.DERAbstractString),he.asn1.DERNumericString=function(e){he.asn1.DERNumericString.superclass.constructor.call(this,e),this.hT="12"},nt(he.asn1.DERNumericString,he.asn1.DERAbstractString),he.asn1.DERPrintableString=function(e){he.asn1.DERPrintableString.superclass.constructor.call(this,e),this.hT="13"},nt(he.asn1.DERPrintableString,he.asn1.DERAbstractString),he.asn1.DERTeletexString=function(e){he.asn1.DERTeletexString.superclass.constructor.call(this,e),this.hT="14"},nt(he.asn1.DERTeletexString,he.asn1.DERAbstractString),he.asn1.DERIA5String=function(e){he.asn1.DERIA5String.superclass.constructor.call(this,e),this.hT="16"},nt(he.asn1.DERIA5String,he.asn1.DERAbstractString),he.asn1.DERVisibleString=function(e){he.asn1.DERIA5String.superclass.constructor.call(this,e),this.hT="1a"},nt(he.asn1.DERVisibleString,he.asn1.DERAbstractString),he.asn1.DERBMPString=function(e){he.asn1.DERBMPString.superclass.constructor.call(this,e),this.hT="1e"},nt(he.asn1.DERBMPString,he.asn1.DERAbstractString),he.asn1.DERUTCTime=function(e){he.asn1.DERUTCTime.superclass.constructor.call(this,e),this.hT="17",this.params=void 0,this.getFreshValueHex=function(){var e=this.params;if(null==this.params&&(e={date:new Date}),"string"==typeof e){if(!e.match(/^[0-9]{12}Z$/)&&!e.match(/^[0-9]{12}\.[0-9]+Z$/))throw new Error("malformed string for UTCTime: "+e);this.hV=fe(e)}else if(null!=e.str)this.hV=fe(e.str);else if(null==e.date&&1==e.millis){var t=new Date;this.hV=fe(this.formatDate(t,"utc",!0))}else if(null!=e.date&&e.date instanceof Date){var r=!0===e.millis;this.hV=fe(this.formatDate(e.date,"utc",r))}else e instanceof Date&&(this.hV=fe(this.formatDate(e,"utc")));if(null==this.hV)throw new Error("parameter not specified properly for UTCTime");return this.hV},null!=e&&this.setByParam(e)},nt(he.asn1.DERUTCTime,he.asn1.DERAbstractTime),he.asn1.DERGeneralizedTime=function(e){he.asn1.DERGeneralizedTime.superclass.constructor.call(this,e),this.hT="18",this.params=e,this.getFreshValueHex=function(){var e=this.params;if(null==this.params&&(e={date:new Date}),"string"==typeof e){if(!e.match(/^[0-9]{14}Z$/)&&!e.match(/^[0-9]{14}\.[0-9]+Z$/))throw new Error("malformed string for GeneralizedTime: "+e);this.hV=fe(e)}else if(null!=e.str)this.hV=fe(e.str);else if(null==e.date&&1==e.millis){var t=new Date;this.hV=fe(this.formatDate(t,"gen",!0))}else if(null!=e.date&&e.date instanceof Date){var r=!0===e.millis;this.hV=fe(this.formatDate(e.date,"gen",r))}else e instanceof Date&&(this.hV=fe(this.formatDate(e,"gen")));if(null==this.hV)throw new Error("parameter not specified properly for GeneralizedTime");return this.hV},null!=e&&this.setByParam(e)},nt(he.asn1.DERGeneralizedTime,he.asn1.DERAbstractTime),he.asn1.DERSequence=function(e){he.asn1.DERSequence.superclass.constructor.call(this,e),this.hT="30",this.getFreshValueHex=function(){for(var e="",t=0;t<this.asn1Array.length;t++)e+=this.asn1Array[t].tohex();return this.hV=e,this.hV}},nt(he.asn1.DERSequence,he.asn1.DERAbstractStructured),he.asn1.DERSet=function(e){he.asn1.DERSet.superclass.constructor.call(this,e),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var e=new Array,t=0;t<this.asn1Array.length;t++){var r=this.asn1Array[t];e.push(r.tohex())}return 1==this.sortFlag&&e.sort(),this.hV=e.join(""),this.hV},void 0!==e&&void 0!==e.sortflag&&0==e.sortflag&&(this.sortFlag=!1)},nt(he.asn1.DERSet,he.asn1.DERAbstractStructured),he.asn1.DERTaggedObject=function(e){he.asn1.DERTaggedObject.superclass.constructor.call(this);var t=he.asn1,r=de,n=r.getV,s=(r.isASN1HEX,t.ASN1Util.newObject);this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.params={tag:"a0",explicit:!0},this.setASN1Object=function(e,t,r){this.params={tag:t,explicit:e,obj:r}},this.getFreshValueHex=function(){var e=this.params;if(null==e.explicit&&(e.explicit=!0),null!=e.tage&&(e.tag=e.tage,e.explicit=!0),null!=e.tagi&&(e.tag=e.tagi,e.explicit=!1),null!=e.str)this.hV=we(e.str);else if(null!=e.hex)this.hV=e.hex;else{if(null==e.obj)throw new Error("str, hex nor obj not specified");var r;e.obj instanceof t.ASN1Object?r=e.obj.tohex():"object"==typeof e.obj&&(r=s(e.obj).tohex()),e.explicit?this.hV=r:this.hV=n(r,0)}return null==e.tag&&(e.tag="a0"),this.hT=e.tag,this.hTLV=null,this.isModified=!0,this.hV},this.setByParam=function(e){this.params=e},void 0!==e&&this.setByParam(e)},nt(he.asn1.DERTaggedObject,he.asn1.ASN1Object);var he,le,ue,de=new function(){};function pe(e){for(var t=new Array,r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}function ge(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}function me(e){for(var t="",r=0;r<e.length;r++){var n=e[r].toString(16);1==n.length&&(n="0"+n),t+=n}return t}function fe(e){return me(pe(e))}function ye(e){return(e=(e=e.replace(/\=/g,"")).replace(/\+/g,"-")).replace(/\//g,"_")}function ve(e){return e.length%4==2?e+="==":e.length%4==3&&(e+="="),(e=e.replace(/-/g,"+")).replace(/_/g,"/")}function be(e){return e.length%2==1&&(e="0"+e),ye(y(e))}function Se(e){return v(ve(e))}function we(e){return De(ze(e)).toLowerCase()}function xe(e){try{return decodeURIComponent(Me(e))}catch(e){return null}}function Ce(e){return xe(function(e){for(var t=e.match(/.{1,2}/g),r=[],n=0;n<t.length;n++){var s=parseInt(t[n],16);161<=s&&s<=191?(r.push("c2"),r.push(t[n])):192<=s&&s<=255?(r.push("c3"),r.push((s-64).toString(16))):r.push(t[n])}return r.join("")}(e))}function Ee(e){for(var t="",r=0;r<e.length-1;r+=2)t+=String.fromCharCode(parseInt(e.substr(r,2),16));return t}function Ae(e){for(var t="",r=0;r<e.length;r++)t+=("0"+e.charCodeAt(r).toString(16)).slice(-2);return t}function Te(e){return y(e)}function Oe(e,t){return(e=e.replace(new RegExp("(.{"+t+"})","g"),"$1\r\n")).replace(/\s+$/,"")}function Ne(e){return v(e.replace(/[^0-9A-Za-z\/+=]*/g,""))}function Pe(e,t){return"-----BEGIN "+t+"-----\r\n"+Oe(Te(e),64)+"\r\n-----END "+t+"-----\r\n"}function Re(e,t){if(-1==e.indexOf("-----BEGIN "))throw new Error("can't find PEM header");return Ne(e=void 0!==t?(e=e.replace(new RegExp("^[^]*-----BEGIN "+t+"-----"),"")).replace(new RegExp("-----END "+t+"-----[^]*$"),""):(e=e.replace(/^[^]*-----BEGIN [^-]+-----/,"")).replace(/-----END [^-]+-----[^]*$/,""))}function Ie(e){var t,r,n,s,i,o,a,c,h,l;if(l=(e=ke(e)).match(/^(\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(|\.\d+)Z$/))return t=parseInt(l[1]),r=parseInt(l[2])-1,n=parseInt(l[3]),s=parseInt(l[4]),i=parseInt(l[5]),o=parseInt(l[6]),a=0,""!==(c=l[7])&&(h=(c.substr(1)+"00").substr(0,3),a=parseInt(h)),Date.UTC(t,r,n,s,i,o,a);throw new Error("unsupported zulu format: "+e)}function Fe(e){return Math.round(Ie(e)/1e3)}function ke(e){return e.match(/^[0-9]{12}Z$/)||e.match(/^[0-9]{12}[.][0-9]*Z$/)?e.match(/^[0-4]/)?"20"+e:"19"+e:e}function De(e){return e.replace(/%/g,"")}function Me(e){return e.replace(/(..)/g,"%$1")}function qe(e){var t="malformed IPv6 address";if(!e.match(/^[0-9A-Fa-f:]+$/))throw t;var r=(e=e.toLowerCase()).split(":").length-1;if(r<2)throw t;var n=":".repeat(7-r+2),s=(e=e.replace("::",n)).split(":");if(8!=s.length)throw t;for(var i=0;i<8;i++)s[i]=("0000"+s[i]).slice(-4);return s.join("")}function Le(e){if(!e.match(/^[0-9A-Fa-f]{32}$/))throw new Error("malformed IPv6 address: "+e);var t=(e=e.toLowerCase()).match(/.{1,4}/g);t=t.map((function(e){return e.replace(/^0+/,"")})),t=t.map((function(e){return""==e?"0":e}));var r=(e=":"+t.join(":")+":").match(/:(0:){2,}/g);if(null==r)return e.slice(1,-1);var n=r.sort().slice(-1)[0];return"::"!=(e=e.replace(n.substr(0,n.length-1),":")).substr(0,2)&&(e=e.substr(1)),"::"!=e.substr(-2,2)&&(e=e.substr(0,e.length-1)),e}function Be(e){var t=new Error("malformed hex value");if(!e.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw t;if(8==e.length)try{return parseInt(e.substr(0,2),16)+"."+parseInt(e.substr(2,2),16)+"."+parseInt(e.substr(4,2),16)+"."+parseInt(e.substr(6,2),16)}catch(e){throw t}else{if(16!=e.length){if(32==e.length)return Le(e);if(64==e.length){try{return Le(e.substr(0,32))+"/"+je(e.substr(32))}catch(e){throw t}return}return e}try{return Be(e.substr(0,8))+"/"+je(e.substr(8))}catch(e){throw t}}}function je(e){var t,r=new Error("malformed mask");try{t=new S(e,16).toString(2)}catch(e){throw r}if(!t.match(/^1*0*$/))throw r;return t.replace(/0+$/,"").length}function _e(e){var t=new Error("malformed IP address");if(!(e=e.toLowerCase(e)).match(/^[0-9a-f.:/]+$/))throw t;if(!e.match(/^[0-9.]+$/)){var r;if(e.match(/^[0-9.]+\/[0-9]+$/))return _e((r=e.split("/"))[0])+He(parseInt(r[1]),32);if(e.match(/^[0-9a-f:]+$/)&&-1!==e.indexOf(":"))return qe(e);if(e.match(/^[0-9a-f:]+\/[0-9]+$/)&&-1!==e.indexOf(":"))return qe((r=e.split("/"))[0])+He(parseInt(r[1]),128);throw t}var n=e.split(".");if(4!==n.length)throw t;var s="";try{for(var i=0;i<4;i++)s+=("0"+parseInt(n[i]).toString(16)).slice(-2);return s}catch(e){throw t}}function He(e,t){return 32==t&&0==e?"00000000":128==t&&0==e?"00000000000000000000000000000000":new S(Array(e+1).join("1")+Array(t-e+1).join("0"),2).toString(16)}function Ue(e){var t=e.match(/.{4}/g).map((function(e){var t=parseInt(e.substr(0,2),16),r=parseInt(e.substr(2),16);if(0==t&r<128)return String.fromCharCode(r);if(t<8){var n=128|63&r;return xe((192|(7&t)<<3|(192&r)>>6).toString(16)+n.toString(16))}n=128|(15&t)<<2|(192&r)>>6;var s=128|63&r;return xe((224|(240&t)>>4).toString(16)+n.toString(16)+s.toString(16))}));return t.join("")}function ze(e){for(var t=encodeURIComponent(e),r="",n=0;n<t.length;n++)"%"==t[n]?(r+=t.substr(n,3),n+=2):r=r+"%"+fe(t[n]);return r}function Ve(e){return!(e.length%2!=0||!e.match(/^[0-9a-f]+$/)&&!e.match(/^[0-9A-F]+$/))}function Ge(e){return!!e.match(/^[0-9A-Za-z-_.]+$/)}function Ke(e){return e.length%2==1?"0"+e:e.substr(0,1)>"7"?"00"+e:e}function We(e){var t=function(e){var t=e.toString(16);return 1==t.length&&(t="0"+t),t},r=function(e){var r="",n=parseInt(e,10).toString(2),s=7-n.length%7;7==s&&(s=0);for(var i="",o=0;o<s;o++)i+="0";for(n=i+n,o=0;o<n.length-1;o+=7){var a=n.substr(o,7);o!=n.length-7&&(a="1"+a),r+=t(parseInt(a,2))}return r};try{if(!e.match(/^[0-9.]+$/))return null;var n="",s=e.split("."),i=40*parseInt(s[0],10)+parseInt(s[1],10);n+=t(i),s.splice(0,2);for(var o=0;o<s.length;o++)n+=r(s[o]);return n}catch(e){return null}}function $e(e){if(!Ve(e))return null;try{var t=[],r=e.substr(0,2),n=parseInt(r,16);t[0]=new String(Math.floor(n/40)),t[1]=new String(n%40);for(var s=e.substr(2),i=[],o=0;o<s.length/2;o++)i.push(parseInt(s.substr(2*o,2),16));var a=[],c="";for(o=0;o<i.length;o++)128&i[o]?c+=Qe((127&i[o]).toString(2),7):(c+=Qe((127&i[o]).toString(2),7),a.push(new String(parseInt(c,2))),c="");var h=t.join(".");return a.length>0&&(h=h+"."+a.join(".")),h}catch(e){return null}}function Je(e){return Xe(new S(String(e),10))}function Xe(e){var t=e.toString(16);if("-"!=t.substr(0,1))return t.length%2==1?t="0"+t:t.match(/^[0-7]/)||(t="00"+t),t;var r=t.substr(1).length;r%2==1?r+=1:t.match(/^[0-7]/)||(r+=2);for(var n="",s=0;s<r;s++)n+="f";return new S(n,16).xor(e).add(S.ONE).toString(16).replace(/^-/,"")}de.getLblen=function(e,t){if("8"!=e.substr(t+2,1))return 1;var r=parseInt(e.substr(t+3,1));return 0==r?-1:0<r&&r<10?r+1:-2},de.getL=function(e,t){var r=de.getLblen(e,t);return r<1?"":e.substr(t+2,2*r)},de.getVblen=function(e,t){var r;return""==(r=de.getL(e,t))?-1:("8"===r.substr(0,1)?new S(r.substr(2),16):new S(r,16)).intValue()},de.getVidx=function(e,t){var r=de.getLblen(e,t);return r<0?r:t+2*(r+1)},de.getV=function(e,t){var r=de.getVidx(e,t),n=de.getVblen(e,t);return e.substr(r,2*n)},de.getTLV=function(e,t){return e.substr(t,2)+de.getL(e,t)+de.getV(e,t)},de.getTLVblen=function(e,t){return 2+2*de.getLblen(e,t)+2*de.getVblen(e,t)},de.getNextSiblingIdx=function(e,t){return de.getVidx(e,t)+2*de.getVblen(e,t)},de.getChildIdx=function(e,t){var r,n,s,i=de,o=[];r=i.getVidx(e,t),n=2*i.getVblen(e,t),"03"==e.substr(t,2)&&(r+=2,n-=2),s=0;for(var a=r;s<=n;){var c=i.getTLVblen(e,a);if((s+=c)<=n&&o.push(a),a+=c,s>=n)break}return o},de.getNthChildIdx=function(e,t,r){return de.getChildIdx(e,t)[r]},de.getIdxbyList=function(e,t,r,n){var s,i,o=de;return 0==r.length?void 0!==n&&e.substr(t,2)!==n?-1:t:(s=r.shift())>=(i=o.getChildIdx(e,t)).length?-1:o.getIdxbyList(e,i[s],r,n)},de.getIdxbyListEx=function(e,t,r,n){var s,i,o=de;if(0==r.length)return void 0!==n&&e.substr(t,2)!==n?-1:t;s=r.shift(),i=o.getChildIdx(e,t);for(var a=0,c=0;c<i.length;c++){var h=e.substr(i[c],2);if("number"==typeof s&&!o.isContextTag(h)&&a==s||"string"==typeof s&&o.isContextTag(h,s))return o.getIdxbyListEx(e,i[c],r,n);o.isContextTag(h)||a++}return-1},de.getTLVbyList=function(e,t,r,n){var s=de,i=s.getIdxbyList(e,t,r,n);return-1==i||i>=e.length?null:s.getTLV(e,i)},de.getTLVbyListEx=function(e,t,r,n){var s=de,i=s.getIdxbyListEx(e,t,r,n);return-1==i?null:s.getTLV(e,i)},de.getVbyList=function(e,t,r,n,s){var i,o,a=de;return-1==(i=a.getIdxbyList(e,t,r,n))||i>=e.length?null:(o=a.getV(e,i),!0===s&&(o=o.substr(2)),o)},de.getVbyListEx=function(e,t,r,n,s){var i,o,a=de;return-1==(i=a.getIdxbyListEx(e,t,r,n))?null:(o=a.getV(e,i),"03"==e.substr(i,2)&&!1!==s&&(o=o.substr(2)),o)},de.getInt=function(e,t,r){null==r&&(r=-1);try{var n=e.substr(t,2);if("02"!=n&&"03"!=n)return r;var s=de.getV(e,t);return"02"==n?parseInt(s,16):Ze(s)}catch(e){return r}},de.getOID=function(e,t,r){null==r&&(r=null);try{return"06"!=e.substr(t,2)?r:$e(de.getV(e,t))}catch(e){return r}},de.getOIDName=function(e,t,r){null==r&&(r=null);try{var n=de.getOID(e,t,r);if(n==r)return r;var s=he.asn1.x509.OID.oid2name(n);return""==s?n:s}catch(e){return r}},de.getString=function(e,t,r){null==r&&(r=null);try{return Ee(de.getV(e,t))}catch(e){return r}},de.hextooidstr=function(e){var t=function(e,t){return e.length>=t?e:new Array(t-e.length+1).join("0")+e},r=[],n=e.substr(0,2),s=parseInt(n,16);r[0]=new String(Math.floor(s/40)),r[1]=new String(s%40);for(var i=e.substr(2),o=[],a=0;a<i.length/2;a++)o.push(parseInt(i.substr(2*a,2),16));var c=[],h="";for(a=0;a<o.length;a++)128&o[a]?h+=t((127&o[a]).toString(2),7):(h+=t((127&o[a]).toString(2),7),c.push(new String(parseInt(h,2))),h="");var l=r.join(".");return c.length>0&&(l=l+"."+c.join(".")),l},de.dump=function(e,t,r,n){var s=de,i=s.getV,o=s.dump,a=s.getChildIdx,c=e;e instanceof he.asn1.ASN1Object&&(c=e.tohex());var h=function(e,t){return e.length<=2*t?e:e.substr(0,t)+"..(total "+e.length/2+"bytes).."+e.substr(e.length-t,t)};void 0===t&&(t={ommit_long_octet:32}),void 0===r&&(r=0),void 0===n&&(n="");var l,u=t.ommit_long_octet;if("01"==(l=c.substr(r,2)))return"00"==(d=i(c,r))?n+"BOOLEAN FALSE\n":n+"BOOLEAN TRUE\n";if("02"==l)return n+"INTEGER "+h(d=i(c,r),u)+"\n";if("03"==l){var d=i(c,r);return s.isASN1HEX(d.substr(2))?(w=n+"BITSTRING, encapsulates\n")+o(d.substr(2),t,0,n+"  "):n+"BITSTRING "+h(d,u)+"\n"}if("04"==l)return d=i(c,r),s.isASN1HEX(d)?(w=n+"OCTETSTRING, encapsulates\n")+o(d,t,0,n+"  "):n+"OCTETSTRING "+h(d,u)+"\n";if("05"==l)return n+"NULL\n";if("06"==l){var p=i(c,r),g=he.asn1.ASN1Util.oidHexToInt(p),m=he.asn1.x509.OID.oid2name(g),f=g.replace(/\./g," ");return""!=m?n+"ObjectIdentifier "+m+" ("+f+")\n":n+"ObjectIdentifier ("+f+")\n"}if("0a"==l)return n+"ENUMERATED "+parseInt(i(c,r))+"\n";if("0c"==l)return n+"UTF8String '"+xe(i(c,r))+"'\n";if("13"==l)return n+"PrintableString '"+xe(i(c,r))+"'\n";if("14"==l)return n+"TeletexString '"+xe(i(c,r))+"'\n";if("16"==l)return n+"IA5String '"+xe(i(c,r))+"'\n";if("17"==l)return n+"UTCTime "+xe(i(c,r))+"\n";if("18"==l)return n+"GeneralizedTime "+xe(i(c,r))+"\n";if("1a"==l)return n+"VisualString '"+xe(i(c,r))+"'\n";if("1e"==l)return n+"BMPString '"+Ue(i(c,r))+"'\n";if("30"==l){if("3000"==c.substr(r,4))return n+"SEQUENCE {}\n";w=n+"SEQUENCE\n";var y=t;if((2==(S=a(c,r)).length||3==S.length)&&"06"==c.substr(S[0],2)&&"04"==c.substr(S[S.length-1],2)){m=s.oidname(i(c,S[0]));var v=JSON.parse(JSON.stringify(t));v.x509ExtName=m,y=v}for(var b=0;b<S.length;b++)w+=o(c,y,S[b],n+"  ");return w}if("31"==l){w=n+"SET\n";var S=a(c,r);for(b=0;b<S.length;b++)w+=o(c,t,S[b],n+"  ");return w}if(0!=(128&(l=parseInt(l,16)))){var w,x=31&l;if(0!=(32&l)){for(w=n+"["+x+"]\n",S=a(c,r),b=0;b<S.length;b++)w+=o(c,t,S[b],n+"  ");return w}return d=i(c,r),de.isASN1HEX(d)?(w=n+"["+x+"]\n")+o(d,t,0,n+"  "):(("68747470"==d.substr(0,8)||"subjectAltName"===t.x509ExtName&&2==x)&&(d=xe(d)),n+"["+x+"] "+d+"\n")}return n+"UNKNOWN("+l+") "+i(c,r)+"\n"},de.parse=function(e){var t=de,r=t.parse,n=t.isASN1HEX,s=t.getV,i=t.getTLV,o=t.getChildIdx,a=he.asn1,c=a.ASN1Util.oidHexToInt,h=a.x509.OID.oid2name,l=xe,u=Ue,d=Ce,p={"0c":"utf8str",12:"numstr",13:"prnstr",14:"telstr",16:"ia5str",17:"utctime",18:"gentime","1a":"visstr","1e":"bmpstr",30:"seq",31:"set"},g=e.substr(0,2),m={},f=s(e,0);if("01"==g)return"0101ff"==e?{bool:!0}:{bool:!1};if("02"==g)return{int:{hex:f}};if("03"==g)try{if("00"!=f.substr(0,2))throw"not encap";var y=f.substr(2);if(!n(y))throw"not encap";return{bitstr:{obj:r(y)}}}catch(e){var v=null;return f.length<=10&&(v=et(f)),null==v?{bitstr:{hex:f}}:{bitstr:{bin:v}}}else if("04"==g)try{if(!n(f))throw"not encap";return{octstr:{obj:r(f)}}}catch(e){return{octstr:{hex:f}}}else{if("05"==g)return{null:""};if("06"==g){var b=c(f),S=h(b);return""==S?{oid:b}:{oid:S}}if("0a"==g)return f.length>4?{enum:{hex:f}}:{enum:parseInt(f,16)};if("30"==g||"31"==g)return m[p[g]]=function(e){for(var t=[],n=o(e,0),s=0;s<n.length;s++){var a=n[s],c=i(e,a),h=r(c);t.push(h)}return t}(e),m;if("14"==g){var w=d(f);return m[p[g]]={str:w},m}if("1e"==g)return w=u(f),m[p[g]]={str:w},m;if(-1!=":0c:12:13:16:17:18:1a:".indexOf(g))return w=l(f),m[p[g]]={str:w},m;if(g.match(/^8[0-9]$/))return null==(w=l(f))|""==w||null!=w.match(/[\x00-\x1F\x7F-\x9F]/)||null!=w.match(/[\u0000-\u001F\u0080–\u009F]/)?{tag:{tag:g,explicit:!1,hex:f}}:{tag:{tag:g,explicit:!1,str:w}};if(!g.match(/^a[0-9]$/)){var x=new he.asn1.ASN1Object;return x.hV=f,{asn1:{tlv:g+x.getLengthHexFromValue()+f}}}try{if(!n(f))throw new Error("not encap");return{tag:{tag:g,explicit:!0,obj:r(f)}}}catch(e){return{tag:{tag:g,explicit:!0,hex:f}}}}},de.isContextTag=function(e,t){var r,n;e=e.toLowerCase();try{r=parseInt(e,16)}catch(e){return-1}if(void 0===t)return 128==(192&r);try{return null!=t.match(/^\[[0-9]+\]$/)&&!((n=parseInt(t.substr(1,t.length-1),10))>31)&&128==(192&r)&&(31&r)==n}catch(e){return!1}},de.isASN1HEX=function(e){var t=de;if(e.length%2==1)return!1;var r=t.getVblen(e,0),n=e.substr(0,2),s=t.getL(e,0);return e.length-n.length-s.length==2*r},de.checkStrictDER=function(e,t,r,n,s){var i=de;if(void 0===r){if("string"!=typeof e)throw new Error("not hex string");if(e=e.toLowerCase(),!he.lang.String.isHex(e))throw new Error("not hex string");r=e.length,s=(n=e.length/2)<128?1:Math.ceil(n.toString(16))+1}if(i.getL(e,t).length>2*s)throw new Error("L of TLV too long: idx="+t);var o=i.getVblen(e,t);if(o>n)throw new Error("value of L too long than hex: idx="+t);var a=i.getTLV(e,t),c=a.length-2-i.getL(e,t).length;if(c!==2*o)throw new Error("V string length and L's value not the same:"+c+"/"+2*o);if(0===t&&e.length!=a.length)throw new Error("total length and TLV length unmatch:"+e.length+"!="+a.length);var h=e.substr(t,2);if("02"===h){var l=i.getVidx(e,t);if("00"==e.substr(l,2)&&e.charCodeAt(l+2)<56)throw new Error("not least zeros for DER INTEGER")}if(32&parseInt(h,16)){for(var u=i.getVblen(e,t),d=0,p=i.getChildIdx(e,t),g=0;g<p.length;g++)d+=i.getTLV(e,p[g]).length,i.checkStrictDER(e,p[g],r,n,s);if(2*u!=d)throw new Error("sum of children's TLV length and L unmatch: "+2*u+"!="+d)}},de.oidname=function(e){var t=he.asn1;he.lang.String.isHex(e)&&(e=t.ASN1Util.oidHexToInt(e));var r=t.x509.OID.oid2name(e);return""===r&&(r=e),r},void 0!==he&&he||(he={}),void 0!==he.asn1&&he.asn1||(he.asn1={}),void 0!==he.asn1.x509&&he.asn1.x509||(he.asn1.x509={}),he.asn1.x509.Certificate=function(e){he.asn1.x509.Certificate.superclass.constructor.call(this);var t=he.asn1,r=t.DERBitString,n=t.DERSequence,s=t.x509,i=s.TBSCertificate,o=s.AlgorithmIdentifier;this.params=void 0,this.setByParam=function(e){this.params=e},this.sign=function(){var e=this.params,t=e.sigalg;null!=e.sigalg.name&&(t=e.sigalg.name);var r=e.tbsobj.tohex(),n=new he.crypto.Signature({alg:t});n.init(e.cakey),n.updateHex(r),e.sighex=n.sign()},this.getPEM=function(){return Pe(this.tohex(),"CERTIFICATE")},this.tohex=function(){var e=this.params;if(null!=e.tbsobj&&null!=e.tbsobj||(e.tbsobj=new i(e)),null==e.sighex&&null!=e.cakey&&this.sign(),null==e.sighex)throw new Error("sighex or cakey parameter not defined");var t=[];return t.push(e.tbsobj),t.push(new o({name:e.sigalg})),t.push(new r({hex:"00"+e.sighex})),new n({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&(this.params=e)},nt(he.asn1.x509.Certificate,he.asn1.ASN1Object),he.asn1.x509.TBSCertificate=function(e){he.asn1.x509.TBSCertificate.superclass.constructor.call(this);var t=he.asn1,r=t.x509,n=t.DERTaggedObject,s=t.DERInteger,i=t.DERSequence,o=r.AlgorithmIdentifier,a=r.Time,c=r.X500Name,h=r.Extensions,l=r.SubjectPublicKeyInfo;this.params=null,this.setByParam=function(e){this.params=e},this.tohex=function(){var e=[],t=this.params;if(null!=t.version||1!=t.version){var r=2;null!=t.version&&(r=t.version-1);var u=new n({obj:new s({int:r})});e.push(u)}return e.push(new s(t.serial)),e.push(new o({name:t.sigalg})),e.push(new c(t.issuer)),e.push(new i({array:[new a(t.notbefore),new a(t.notafter)]})),e.push(new c(t.subject)),e.push(new l(st.getKey(t.sbjpubkey))),void 0!==t.ext&&t.ext.length>0&&e.push(new n({tag:"a3",obj:new h(t.ext)})),new he.asn1.DERSequence({array:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},nt(he.asn1.x509.TBSCertificate,he.asn1.ASN1Object),he.asn1.x509.Extensions=function(e){he.asn1.x509.Extensions.superclass.constructor.call(this);var t=he.asn1,r=t.DERSequence,n=t.x509;this.aParam=[],this.setByParam=function(e){this.aParam=e},this.tohex=function(){for(var e=[],t=0;t<this.aParam.length;t++){var s=this.aParam[t],i=s.extname,o=null;if(null!=s.extn)o=new n.PrivateExtension(s);else if("subjectKeyIdentifier"==i)o=new n.SubjectKeyIdentifier(s);else if("keyUsage"==i)o=new n.KeyUsage(s);else if("subjectAltName"==i)o=new n.SubjectAltName(s);else if("issuerAltName"==i)o=new n.IssuerAltName(s);else if("basicConstraints"==i)o=new n.BasicConstraints(s);else if("nameConstraints"==i)o=new n.NameConstraints(s);else if("cRLDistributionPoints"==i)o=new n.CRLDistributionPoints(s);else if("certificatePolicies"==i)o=new n.CertificatePolicies(s);else if("policyMappings"==i)o=new n.PolicyMappings(s);else if("policyConstraints"==i)o=new n.PolicyConstraints(s);else if("inhibitAnyPolicy"==i)o=new n.InhibitAnyPolicy(s);else if("authorityKeyIdentifier"==i)o=new n.AuthorityKeyIdentifier(s);else if("extKeyUsage"==i)o=new n.ExtKeyUsage(s);else if("authorityInfoAccess"==i)o=new n.AuthorityInfoAccess(s);else if("cRLNumber"==i)o=new n.CRLNumber(s);else if("cRLReason"==i)o=new n.CRLReason(s);else if("ocspNonce"==i)o=new n.OCSPNonce(s);else if("ocspNoCheck"==i)o=new n.OCSPNoCheck(s);else if("adobeTimeStamp"==i)o=new n.AdobeTimeStamp(s);else{if("subjectDirectoryAttributes"!=i)throw new Error("extension not supported:"+JSON.stringify(s));o=new n.SubjectDirectoryAttributes(s)}null!=o&&e.push(o)}return new r({array:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},nt(he.asn1.x509.Extensions,he.asn1.ASN1Object),he.asn1.x509.Extension=function(e){he.asn1.x509.Extension.superclass.constructor.call(this);var t=he.asn1,r=t.DERObjectIdentifier,n=t.DEROctetString,s=(t.DERBitString,t.DERBoolean),i=t.DERSequence;this.tohex=function(){var e=new r({oid:this.oid}),t=new n({hex:this.getExtnValueHex()}),o=new Array;return o.push(e),this.critical&&o.push(new s),o.push(t),new i({array:o}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.critical=!1,void 0!==e&&void 0!==e.critical&&(this.critical=e.critical)},nt(he.asn1.x509.Extension,he.asn1.ASN1Object),he.asn1.x509.KeyUsage=function(e){he.asn1.x509.KeyUsage.superclass.constructor.call(this,e);var t=Error,r={digitalSignature:0,nonRepudiation:1,keyEncipherment:2,dataEncipherment:3,keyAgreement:4,keyCertSign:5,cRLSign:6,encipherOnly:7,decipherOnly:8};this.getExtnValueHex=function(){var e=this.getBinValue();return this.asn1ExtnValue=new he.asn1.DERBitString({bin:e}),this.asn1ExtnValue.tohex()},this.getBinValue=function(){var e=this.params;if("object"!=typeof e||"object"!=typeof e.names&&"string"!=typeof e.bin)throw new t("parameter not yet set");if(null!=e.names)return tt(e.names,r);if(null!=e.bin)return e.bin;throw new t("parameter not set properly")},this.oid="2.5.29.15",void 0!==e&&(this.params=e)},nt(he.asn1.x509.KeyUsage,he.asn1.x509.Extension),he.asn1.x509.BasicConstraints=function(e){he.asn1.x509.BasicConstraints.superclass.constructor.call(this,e);var t=he.asn1,r=t.DERBoolean,n=t.DERInteger,s=t.DERSequence;this.getExtnValueHex=function(){var e=new Array;this.cA&&e.push(new r),this.pathLen>-1&&e.push(new n({int:this.pathLen}));var t=new s({array:e});return this.asn1ExtnValue=t,this.asn1ExtnValue.tohex()},this.oid="2.5.29.19",this.cA=!1,this.pathLen=-1,void 0!==e&&(void 0!==e.cA&&(this.cA=e.cA),void 0!==e.pathLen&&(this.pathLen=e.pathLen))},nt(he.asn1.x509.BasicConstraints,he.asn1.x509.Extension),he.asn1.x509.CRLDistributionPoints=function(e){he.asn1.x509.CRLDistributionPoints.superclass.constructor.call(this,e);var t=he.asn1,r=t.x509;this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.setByDPArray=function(e){for(var n=[],s=0;s<e.length;s++)if(e[s]instanceof he.asn1.ASN1Object)n.push(e[s]);else{var i=new r.DistributionPoint(e[s]);n.push(i)}this.asn1ExtnValue=new t.DERSequence({array:n})},this.setByOneURI=function(e){var t=new r.DistributionPoint({fulluri:e});this.setByDPArray([t])},this.oid="2.5.29.31",void 0!==e&&(void 0!==e.array?this.setByDPArray(e.array):void 0!==e.uri&&this.setByOneURI(e.uri))},nt(he.asn1.x509.CRLDistributionPoints,he.asn1.x509.Extension),he.asn1.x509.DistributionPoint=function(e){he.asn1.x509.DistributionPoint.superclass.constructor.call(this);var t=he.asn1,r=t.x509.DistributionPointName;this.tohex=function(){var e=new t.DERSequence;if(null!=this.asn1DP){var r=new t.DERTaggedObject({explicit:!0,tag:"a0",obj:this.asn1DP});e.appendASN1Object(r)}return this.hTLV=e.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(void 0!==e.dpobj?this.asn1DP=e.dpobj:void 0!==e.dpname?this.asn1DP=new r(e.dpname):void 0!==e.fulluri&&(this.asn1DP=new r({full:[{uri:e.fulluri}]})))},nt(he.asn1.x509.DistributionPoint,he.asn1.ASN1Object),he.asn1.x509.DistributionPointName=function(e){he.asn1.x509.DistributionPointName.superclass.constructor.call(this);var t=he.asn1,r=t.DERTaggedObject;if(this.tohex=function(){if("full"!=this.type)throw new Error("currently type shall be 'full': "+this.type);return this.asn1Obj=new r({explicit:!1,tag:this.tag,obj:this.asn1V}),this.hTLV=this.asn1Obj.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e)if(t.x509.GeneralNames.prototype.isPrototypeOf(e))this.type="full",this.tag="a0",this.asn1V=e;else{if(void 0===e.full)throw new Error("This class supports GeneralNames only as argument");this.type="full",this.tag="a0",this.asn1V=new t.x509.GeneralNames(e.full)}},nt(he.asn1.x509.DistributionPointName,he.asn1.ASN1Object),he.asn1.x509.CertificatePolicies=function(e){he.asn1.x509.CertificatePolicies.superclass.constructor.call(this,e);var t=he.asn1,r=t.x509,n=t.DERSequence,s=r.PolicyInformation;this.params=null,this.getExtnValueHex=function(){for(var e=[],t=0;t<this.params.array.length;t++)e.push(new s(this.params.array[t]));var r=new n({array:e});return this.asn1ExtnValue=r,this.asn1ExtnValue.tohex()},this.oid="2.5.29.32",void 0!==e&&(this.params=e)},nt(he.asn1.x509.CertificatePolicies,he.asn1.x509.Extension),he.asn1.x509.PolicyInformation=function(e){he.asn1.x509.PolicyInformation.superclass.constructor.call(this,e);var t=he.asn1,r=t.DERSequence,n=t.DERObjectIdentifier,s=t.x509.PolicyQualifierInfo;this.params=null,this.tohex=function(){if(void 0===this.params.policyoid&&void 0===this.params.array)throw new Error("parameter oid and array missing");var e=[new n(this.params.policyoid)];if(void 0!==this.params.array){for(var t=[],i=0;i<this.params.array.length;i++)t.push(new s(this.params.array[i]));t.length>0&&e.push(new r({array:t}))}return new r({array:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(this.params=e)},nt(he.asn1.x509.PolicyInformation,he.asn1.ASN1Object),he.asn1.x509.PolicyQualifierInfo=function(e){he.asn1.x509.PolicyQualifierInfo.superclass.constructor.call(this,e);var t=he.asn1,r=t.DERSequence,n=t.DERIA5String,s=t.DERObjectIdentifier,i=t.x509.UserNotice;this.params=null,this.tohex=function(){return void 0!==this.params.cps?new r({array:[new s({oid:"1.3.6.1.5.5.7.2.1"}),new n({str:this.params.cps})]}).tohex():null!=this.params.unotice?new r({array:[new s({oid:"1.3.6.1.5.5.7.2.2"}),new i(this.params.unotice)]}).tohex():void 0},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(this.params=e)},nt(he.asn1.x509.PolicyQualifierInfo,he.asn1.ASN1Object),he.asn1.x509.UserNotice=function(e){he.asn1.x509.UserNotice.superclass.constructor.call(this,e);var t=he.asn1.DERSequence,r=(he.asn1.DERInteger,he.asn1.x509.DisplayText),n=he.asn1.x509.NoticeReference;this.params=null,this.tohex=function(){var e=[];return void 0!==this.params.noticeref&&e.push(new n(this.params.noticeref)),void 0!==this.params.exptext&&e.push(new r(this.params.exptext)),new t({array:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(this.params=e)},nt(he.asn1.x509.UserNotice,he.asn1.ASN1Object),he.asn1.x509.NoticeReference=function(e){he.asn1.x509.NoticeReference.superclass.constructor.call(this,e);var t=he.asn1.DERSequence,r=he.asn1.DERInteger,n=he.asn1.x509.DisplayText;this.params=null,this.tohex=function(){var e=[];if(void 0!==this.params.org&&e.push(new n(this.params.org)),void 0!==this.params.noticenum){for(var s=[],i=this.params.noticenum,o=0;o<i.length;o++)s.push(new r(i[o]));e.push(new t({array:s}))}if(0==e.length)throw new Error("parameter is empty");return new t({array:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(this.params=e)},nt(he.asn1.x509.NoticeReference,he.asn1.ASN1Object),he.asn1.x509.DisplayText=function(e){he.asn1.x509.DisplayText.superclass.constructor.call(this,e),this.hT="0c",void 0!==e&&("ia5"===e.type?this.hT="16":"vis"===e.type?this.hT="1a":"bmp"===e.type&&(this.hT="1e"))},nt(he.asn1.x509.DisplayText,he.asn1.DERAbstractString),he.asn1.x509.PolicyMappings=function(e){he.asn1.x509.PolicyMappings.superclass.constructor.call(this,e);var t=he.asn1,r=(t.x509,t.ASN1Util.newObject);this.params=null,this.getExtnValueHex=function(){for(var e=this.params,t=[],n=0;n<e.array.length;n++){var s=e.array[n];t.push({seq:[{oid:s[0]},{oid:s[1]}]})}return this.asn1ExtnValue=r({seq:t}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.33",void 0!==e&&(this.params=e)},nt(he.asn1.x509.PolicyMappings,he.asn1.x509.Extension),he.asn1.x509.PolicyConstraints=function(e){he.asn1.x509.PolicyConstraints.superclass.constructor.call(this,e);var t=he.asn1,r=(t.x509,t.ASN1Util.newObject);this.params=null,this.getExtnValueHex=function(){var e=this.params,t=[];return null!=e.reqexp&&t.push({tag:{tagi:"80",obj:{int:e.reqexp}}}),null!=e.inhibit&&t.push({tag:{tagi:"81",obj:{int:e.inhibit}}}),this.asn1ExtnValue=r({seq:t}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.36",void 0!==e&&(this.params=e)},nt(he.asn1.x509.PolicyConstraints,he.asn1.x509.Extension),he.asn1.x509.InhibitAnyPolicy=function(e){he.asn1.x509.InhibitAnyPolicy.superclass.constructor.call(this,e);var t=he.asn1,r=(t.x509,t.ASN1Util.newObject);this.params=null,this.getExtnValueHex=function(){return this.asn1ExtnValue=r({int:this.params.skip}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.54",void 0!==e&&(this.params=e)},nt(he.asn1.x509.InhibitAnyPolicy,he.asn1.x509.Extension),he.asn1.x509.NameConstraints=function(e){he.asn1.x509.NameConstraints.superclass.constructor.call(this,e);var t=he.asn1,r=t.x509,n=t.ASN1Util.newObject,s=r.GeneralSubtree;this.params=null,this.getExtnValueHex=function(){var e=this.params,t=[];if(null!=e.permit&&null!=e.permit.length){for(var r=[],i=0;i<e.permit.length;i++)r.push(new s(e.permit[i]));t.push({tag:{tagi:"a0",obj:{seq:r}}})}if(null!=e.exclude&&null!=e.exclude.length){var o=[];for(i=0;i<e.exclude.length;i++)o.push(new s(e.exclude[i]));t.push({tag:{tagi:"a1",obj:{seq:o}}})}return this.asn1ExtnValue=n({seq:t}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.30",void 0!==e&&(this.params=e)},nt(he.asn1.x509.NameConstraints,he.asn1.x509.Extension),he.asn1.x509.GeneralSubtree=function(e){he.asn1.x509.GeneralSubtree.superclass.constructor.call(this);var t=he.asn1,r=t.x509.GeneralName,n=t.ASN1Util.newObject;this.params=null,this.setByParam=function(e){this.params=e},this.tohex=function(){var e=this.params,t=[new r(e)];return null!=e.min&&t.push({tag:{tagi:"80",obj:{int:e.min}}}),null!=e.max&&t.push({tag:{tagi:"81",obj:{int:e.max}}}),n({seq:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},nt(he.asn1.x509.GeneralSubtree,he.asn1.ASN1Object),he.asn1.x509.ExtKeyUsage=function(e){he.asn1.x509.ExtKeyUsage.superclass.constructor.call(this,e);var t=he.asn1;this.setPurposeArray=function(e){this.asn1ExtnValue=new t.DERSequence;for(var r=0;r<e.length;r++){var n=new t.DERObjectIdentifier(e[r]);this.asn1ExtnValue.appendASN1Object(n)}},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.37",void 0!==e&&void 0!==e.array&&this.setPurposeArray(e.array)},nt(he.asn1.x509.ExtKeyUsage,he.asn1.x509.Extension),he.asn1.x509.AuthorityKeyIdentifier=function(e){he.asn1.x509.AuthorityKeyIdentifier.superclass.constructor.call(this,e);var t=he,r=t.asn1,n=r.DERTaggedObject,s=r.x509.GeneralNames;t.crypto.Util.isKey,this.asn1KID=null,this.asn1CertIssuer=null,this.asn1CertSN=null,this.getExtnValueHex=function(){var e=new Array;this.asn1KID&&e.push(new n({explicit:!1,tag:"80",obj:this.asn1KID})),this.asn1CertIssuer&&e.push(new n({explicit:!1,tag:"a1",obj:new s([{dn:this.asn1CertIssuer}])})),this.asn1CertSN&&e.push(new n({explicit:!1,tag:"82",obj:this.asn1CertSN}));var t=new r.DERSequence({array:e});return this.asn1ExtnValue=t,this.asn1ExtnValue.tohex()},this.setKIDByParam=function(e){if(void 0!==e.str||void 0!==e.hex)this.asn1KID=new he.asn1.DEROctetString(e);else if("object"==typeof e&&he.crypto.Util.isKey(e)||"string"==typeof e&&-1!=e.indexOf("BEGIN ")){var t=e;"string"==typeof e&&(t=st.getKey(e));var r=st.getKeyID(t);this.asn1KID=new he.asn1.DEROctetString({hex:r})}},this.setCertIssuerByParam=function(e){void 0!==e.str||void 0!==e.ldapstr||void 0!==e.hex||void 0!==e.certsubject||void 0!==e.certissuer?this.asn1CertIssuer=new he.asn1.x509.X500Name(e):"string"==typeof e&&-1!=e.indexOf("BEGIN ")&&-1!=e.indexOf("CERTIFICATE")&&(this.asn1CertIssuer=new he.asn1.x509.X500Name({certissuer:e}))},this.setCertSNByParam=function(e){if(void 0!==e.str||void 0!==e.bigint||void 0!==e.hex)this.asn1CertSN=new he.asn1.DERInteger(e);else if("string"==typeof e&&-1!=e.indexOf("BEGIN ")&&e.indexOf("CERTIFICATE")){var t=new ct;t.readCertPEM(e);var r=t.getSerialNumberHex();this.asn1CertSN=new he.asn1.DERInteger({hex:r})}},this.oid="2.5.29.35",void 0!==e&&(void 0!==e.kid&&this.setKIDByParam(e.kid),void 0!==e.issuer&&this.setCertIssuerByParam(e.issuer),void 0!==e.sn&&this.setCertSNByParam(e.sn),void 0!==e.issuersn&&"string"==typeof e.issuersn&&-1!=e.issuersn.indexOf("BEGIN ")&&e.issuersn.indexOf("CERTIFICATE")&&(this.setCertSNByParam(e.issuersn),this.setCertIssuerByParam(e.issuersn)))},nt(he.asn1.x509.AuthorityKeyIdentifier,he.asn1.x509.Extension),he.asn1.x509.SubjectKeyIdentifier=function(e){he.asn1.x509.SubjectKeyIdentifier.superclass.constructor.call(this,e);var t=he.asn1.DEROctetString;this.asn1KID=null,this.getExtnValueHex=function(){return this.asn1ExtnValue=this.asn1KID,this.asn1ExtnValue.tohex()},this.setKIDByParam=function(e){if(void 0!==e.str||void 0!==e.hex)this.asn1KID=new t(e);else if("object"==typeof e&&he.crypto.Util.isKey(e)||"string"==typeof e&&-1!=e.indexOf("BEGIN")){var r=e;"string"==typeof e&&(r=st.getKey(e));var n=st.getKeyID(r);this.asn1KID=new he.asn1.DEROctetString({hex:n})}},this.oid="2.5.29.14",void 0!==e&&void 0!==e.kid&&this.setKIDByParam(e.kid)},nt(he.asn1.x509.SubjectKeyIdentifier,he.asn1.x509.Extension),he.asn1.x509.AuthorityInfoAccess=function(e){he.asn1.x509.AuthorityInfoAccess.superclass.constructor.call(this,e),this.setAccessDescriptionArray=function(e){for(var t=new Array,r=he.asn1,n=r.DERSequence,s=r.DERObjectIdentifier,i=r.x509.GeneralName,o=0;o<e.length;o++){var a,c=e[o];if(void 0!==c.ocsp)a=new n({array:[new s({oid:"1.3.6.1.5.5.7.48.1"}),new i({uri:c.ocsp})]});else{if(void 0===c.caissuer)throw new Error("unknown AccessMethod parameter: "+JSON.stringify(c));a=new n({array:[new s({oid:"1.3.6.1.5.5.7.48.2"}),new i({uri:c.caissuer})]})}t.push(a)}this.asn1ExtnValue=new n({array:t})},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.1.1",void 0!==e&&void 0!==e.array&&this.setAccessDescriptionArray(e.array)},nt(he.asn1.x509.AuthorityInfoAccess,he.asn1.x509.Extension),he.asn1.x509.SubjectAltName=function(e){he.asn1.x509.SubjectAltName.superclass.constructor.call(this,e),this.setNameArray=function(e){this.asn1ExtnValue=new he.asn1.x509.GeneralNames(e)},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.17",void 0!==e&&void 0!==e.array&&this.setNameArray(e.array)},nt(he.asn1.x509.SubjectAltName,he.asn1.x509.Extension),he.asn1.x509.IssuerAltName=function(e){he.asn1.x509.IssuerAltName.superclass.constructor.call(this,e),this.setNameArray=function(e){this.asn1ExtnValue=new he.asn1.x509.GeneralNames(e)},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.18",void 0!==e&&void 0!==e.array&&this.setNameArray(e.array)},nt(he.asn1.x509.IssuerAltName,he.asn1.x509.Extension),he.asn1.x509.SubjectDirectoryAttributes=function(e){he.asn1.x509.SubjectDirectoryAttributes.superclass.constructor.call(this,e);var t=he.asn1,r=t.DERSequence,n=t.ASN1Util.newObject,s=t.x509.OID.name2oid;this.params=null,this.getExtnValueHex=function(){for(var e=[],t=0;t<this.params.array.length;t++){var i=this.params.array[t];if(null==i.attr||null==i.array){var o={seq:[{oid:"1.2.3.4"},{set:[{utf8str:"DE"}]}]};if("dateOfBirth"==i.attr)o.seq[0].oid=s(i.attr),o.seq[1].set[0]={gentime:i.str};else if("placeOfBirth"==i.attr)o.seq[0].oid=s(i.attr),o.seq[1].set[0]={utf8str:i.str};else if("gender"==i.attr)o.seq[0].oid=s(i.attr),o.seq[1].set[0]={prnstr:i.str};else if("countryOfCitizenship"==i.attr)o.seq[0].oid=s(i.attr),o.seq[1].set[0]={prnstr:i.str};else{if("countryOfResidence"!=i.attr)throw new Error("unsupported attribute: "+i.attr);o.seq[0].oid=s(i.attr),o.seq[1].set[0]={prnstr:i.str}}e.push(new n(o))}else{var a={seq:[{oid:i.attr},{set:i.array}]};e.push(n(a))}}var c=new r({array:e});return this.asn1ExtnValue=c,this.asn1ExtnValue.tohex()},this.oid="2.5.29.9",void 0!==e&&(this.params=e)},nt(he.asn1.x509.SubjectDirectoryAttributes,he.asn1.x509.Extension),he.asn1.x509.PrivateExtension=function(e){he.asn1.x509.PrivateExtension.superclass.constructor.call(this,e);var t=he,r=t.lang.String.isHex,n=t.asn1,s=n.x509.OID.name2oid,i=n.ASN1Util.newObject;this.params=null,this.setByParam=function(e){this.oid=s(e.extname),this.params=e},this.getExtnValueHex=function(){if(null==this.params.extname||null==this.params.extn)throw new Error("extname or extnhex not specified");var e=this.params.extn;if("string"==typeof e&&r(e))return e;if("object"==typeof e)try{return i(e).tohex()}catch(e){}throw new Error("unsupported extn value")},null!=e&&this.setByParam(e)},nt(he.asn1.x509.PrivateExtension,he.asn1.x509.Extension),he.asn1.x509.CRL=function(e){he.asn1.x509.CRL.superclass.constructor.call(this);var t=he.asn1,r=t.DERSequence,n=t.DERBitString,s=t.x509,i=s.AlgorithmIdentifier,o=s.TBSCertList;this.params=void 0,this.setByParam=function(e){this.params=e},this.sign=function(){var e=new o(this.params).tohex(),t=new he.crypto.Signature({alg:this.params.sigalg});t.init(this.params.cakey),t.updateHex(e);var r=t.sign();this.params.sighex=r},this.getPEM=function(){return Pe(this.tohex(),"X509 CRL")},this.tohex=function(){var e=this.params;if(null==e.tbsobj&&(e.tbsobj=new o(e)),null==e.sighex&&null!=e.cakey&&this.sign(),null==e.sighex)throw new Error("sighex or cakey parameter not defined");var t=[];return t.push(e.tbsobj),t.push(new i({name:e.sigalg})),t.push(new n({hex:"00"+e.sighex})),new r({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&(this.params=e)},nt(he.asn1.x509.CRL,he.asn1.ASN1Object),he.asn1.x509.TBSCertList=function(e){he.asn1.x509.TBSCertList.superclass.constructor.call(this);var t=he.asn1,r=t.DERInteger,n=t.DERSequence,s=t.DERTaggedObject,i=(t.DERObjectIdentifier,t.x509),o=i.AlgorithmIdentifier,a=i.Time,c=i.Extensions,h=i.X500Name;this.params=null,this.setByParam=function(e){this.params=e},this.getRevCertSequence=function(){for(var e=[],t=this.params.revcert,s=0;s<t.length;s++){var i=[new r(t[s].sn),new a(t[s].date)];null!=t[s].ext&&i.push(new c(t[s].ext)),e.push(new n({array:i}))}return new n({array:e})},this.tohex=function(){var e=[],t=this.params;if(null!=t.version){var i=t.version-1,l=new r({int:i});e.push(l)}if(e.push(new o({name:t.sigalg})),e.push(new h(t.issuer)),e.push(new a(t.thisupdate)),null!=t.nextupdate&&e.push(new a(t.nextupdate)),null!=t.revcert&&e.push(this.getRevCertSequence()),null!=t.ext){var u=new c(t.ext);e.push(new s({tag:"a0",explicit:!0,obj:u}))}return new n({array:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},nt(he.asn1.x509.TBSCertList,he.asn1.ASN1Object),he.asn1.x509.CRLEntry=function(e){he.asn1.x509.CRLEntry.superclass.constructor.call(this);var t=he.asn1;this.setCertSerial=function(e){this.sn=new t.DERInteger(e)},this.setRevocationDate=function(e){this.time=new t.x509.Time(e)},this.tohex=function(){var e=new t.DERSequence({array:[this.sn,this.time]});return this.TLV=e.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(void 0!==e.time&&this.setRevocationDate(e.time),void 0!==e.sn&&this.setCertSerial(e.sn))},nt(he.asn1.x509.CRLEntry,he.asn1.ASN1Object),he.asn1.x509.CRLNumber=function(e){he.asn1.x509.CRLNumber.superclass.constructor.call(this,e),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new he.asn1.DERInteger(this.params.num),this.asn1ExtnValue.tohex()},this.oid="2.5.29.20",null!=e&&(this.params=e)},nt(he.asn1.x509.CRLNumber,he.asn1.x509.Extension),he.asn1.x509.CRLReason=function(e){he.asn1.x509.CRLReason.superclass.constructor.call(this,e),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new he.asn1.DEREnumerated(this.params.code),this.asn1ExtnValue.tohex()},this.oid="2.5.29.21",null!=e&&(this.params=e)},nt(he.asn1.x509.CRLReason,he.asn1.x509.Extension),he.asn1.x509.OCSPNonce=function(e){he.asn1.x509.OCSPNonce.superclass.constructor.call(this,e),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new he.asn1.DEROctetString(this.params),this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.48.1.2",null!=e&&(this.params=e)},nt(he.asn1.x509.OCSPNonce,he.asn1.x509.Extension),he.asn1.x509.OCSPNoCheck=function(e){he.asn1.x509.OCSPNoCheck.superclass.constructor.call(this,e),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new he.asn1.DERNull,this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.48.1.5",null!=e&&(this.params=e)},nt(he.asn1.x509.OCSPNoCheck,he.asn1.x509.Extension),he.asn1.x509.AdobeTimeStamp=function(e){he.asn1.x509.AdobeTimeStamp.superclass.constructor.call(this,e);var t=he.asn1,r=t.DERInteger,n=t.DERBoolean,s=t.DERSequence,i=t.x509.GeneralName;this.params=null,this.getExtnValueHex=function(){var e=this.params,t=[new r(1)];return t.push(new i({uri:e.uri})),null!=e.reqauth&&t.push(new n(e.reqauth)),this.asn1ExtnValue=new s({array:t}),this.asn1ExtnValue.tohex()},this.oid="1.2.840.113583.1.1.9.1",void 0!==e&&this.setByParam(e)},nt(he.asn1.x509.AdobeTimeStamp,he.asn1.x509.Extension),he.asn1.x509.X500Name=function(e){he.asn1.x509.X500Name.superclass.constructor.call(this),this.asn1Array=[],this.paramArray=[],this.sRule="utf8";var t=he.asn1,r=t.x509,n=r.RDN;this.setByString=function(e,t){void 0!==t&&(this.sRule=t);var r=e.split("/");r.shift();for(var s=[],i=0;i<r.length;i++)if(r[i].match(/^[^=]+=.+$/))s.push(r[i]);else{var o=s.length-1;s[o]=s[o]+"/"+r[i]}for(i=0;i<s.length;i++)this.asn1Array.push(new n({str:s[i],rule:this.sRule}))},this.setByLdapString=function(e,t){void 0!==t&&(this.sRule=t);var n=r.X500Name.ldapToCompat(e);this.setByString(n,t)},this.setByObject=function(e,t){for(var r in void 0!==t&&(this.sRule=t),e)if(e.hasOwnProperty(r)){var s=new n({str:r+"="+e[r],rule:this.sRule});this.asn1Array?this.asn1Array.push(s):this.asn1Array=[s]}},this.setByParam=function(e){var t;void 0!==e.rule&&(this.sRule=e.rule),void 0!==e.array?this.paramArray=e.array:void 0!==e.str?this.setByString(e.str):void 0!==e.ldapstr?this.setByLdapString(e.ldapstr):void 0!==e.hex?this.hTLV=e.hex:void 0!==e.certissuer?((t=new ct).readCertPEM(e.certissuer),this.hTLV=t.getIssuerHex()):void 0!==e.certsubject?((t=new ct).readCertPEM(e.certsubject),this.hTLV=t.getSubjectHex()):"object"==typeof e&&void 0===e.certsubject&&void 0===e.certissuer&&this.setByObject(e)},this.tohex=function(){if("string"==typeof this.hTLV)return this.hTLV;if(0==this.asn1Array.length&&this.paramArray.length>0)for(var e=0;e<this.paramArray.length;e++){var r={array:this.paramArray[e]};"utf8"!=this.sRule&&(r.rule=this.sRule);var s=new n(r);this.asn1Array.push(s)}var i=new t.DERSequence({array:this.asn1Array});return this.hTLV=i.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},nt(he.asn1.x509.X500Name,he.asn1.ASN1Object),he.asn1.x509.X500Name.compatToLDAP=function(e){if("/"!==e.substr(0,1))throw"malformed input";var t=(e=e.substr(1)).split("/");return t.reverse(),t=t.map((function(e){return e.replace(/,/,"\\,")})),t.join(",")},he.asn1.x509.X500Name.onelineToLDAP=function(e){return he.asn1.x509.X500Name.compatToLDAP(e)},he.asn1.x509.X500Name.ldapToCompat=function(e){for(var t=e.split(","),r=!1,n=[],s=0;t.length>0;s++){var i=t.shift();if(!0===r){var o=(n.pop()+","+i).replace(/\\,/g,",");n.push(o),r=!1}else n.push(i);"\\"===i.substr(-1,1)&&(r=!0)}return n=n.map((function(e){return e.replace("/","\\/")})),n.reverse(),"/"+n.join("/")},he.asn1.x509.X500Name.ldapToOneline=function(e){return he.asn1.x509.X500Name.ldapToCompat(e)},he.asn1.x509.RDN=function(e){he.asn1.x509.RDN.superclass.constructor.call(this),this.asn1Array=[],this.paramArray=[],this.sRule="utf8";var t=he.asn1.x509.AttributeTypeAndValue;this.setByParam=function(e){void 0!==e.rule&&(this.sRule=e.rule),void 0!==e.str&&this.addByMultiValuedString(e.str),void 0!==e.array&&(this.paramArray=e.array)},this.addByString=function(e){this.asn1Array.push(new he.asn1.x509.AttributeTypeAndValue({str:e,rule:this.sRule}))},this.addByMultiValuedString=function(e){for(var t=he.asn1.x509.RDN.parseString(e),r=0;r<t.length;r++)this.addByString(t[r])},this.tohex=function(){if(0==this.asn1Array.length&&this.paramArray.length>0)for(var e=0;e<this.paramArray.length;e++){var r=this.paramArray[e];void 0!==r.rule&&"utf8"!=this.sRule&&(r.rule=this.sRule);var n=new t(r);this.asn1Array.push(n)}var s=new he.asn1.DERSet({array:this.asn1Array});return this.TLV=s.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},nt(he.asn1.x509.RDN,he.asn1.ASN1Object),he.asn1.x509.RDN.parseString=function(e){for(var t=e.split(/\+/),r=!1,n=[],s=0;t.length>0;s++){var i=t.shift();if(!0===r){var o=(n.pop()+"+"+i).replace(/\\\+/g,"+");n.push(o),r=!1}else n.push(i);"\\"===i.substr(-1,1)&&(r=!0)}var a=!1,c=[];for(s=0;n.length>0;s++){if(i=n.shift(),!0===a){var h=c.pop();i.match(/"$/)?(o=(h+"+"+i).replace(/^([^=]+)="(.*)"$/,"$1=$2"),c.push(o),a=!1):c.push(h+"+"+i)}else c.push(i);i.match(/^[^=]+="/)&&(a=!0)}return c},he.asn1.x509.AttributeTypeAndValue=function(e){he.asn1.x509.AttributeTypeAndValue.superclass.constructor.call(this),this.sRule="utf8",this.sType=null,this.sValue=null,this.dsType=null;var t=he,r=t.asn1,n=r.DERSequence,s=r.DERUTF8String,i=r.DERPrintableString,o=r.DERTeletexString,a=r.DERIA5String,c=r.DERVisibleString,h=r.DERBMPString,l=t.lang.String.isMail,u=t.lang.String.isPrintable;this.setByParam=function(e){if(void 0!==e.rule&&(this.sRule=e.rule),void 0!==e.ds&&(this.dsType=e.ds),void 0===e.value&&void 0!==e.str){var t=e.str.match(/^([^=]+)=(.+)$/);if(!t)throw new Error("malformed attrTypeAndValueStr: "+attrTypeAndValueStr);this.sType=t[1],this.sValue=t[2]}else this.sType=e.type,this.sValue=e.value},this.setByString=function(e,t){void 0!==t&&(this.sRule=t);var r=e.match(/^([^=]+)=(.+)$/);if(!r)throw new Error("malformed attrTypeAndValueStr: "+attrTypeAndValueStr);this.setByAttrTypeAndValueStr(r[1],r[2])},this._getDsType=function(){var e=this.sType,t=this.sValue,r=this.sRule;return"prn"===r?"CN"==e&&l(t)?"ia5":u(t)?"prn":"utf8":"utf8"===r?"CN"==e&&l(t)?"ia5":"C"==e?"prn":"utf8":"utf8"},this.setByAttrTypeAndValueStr=function(e,t,r){void 0!==r&&(this.sRule=r),this.sType=e,this.sValue=t},this.getValueObj=function(e,t){if("utf8"==e)return new s({str:t});if("prn"==e)return new i({str:t});if("tel"==e)return new o({str:t});if("ia5"==e)return new a({str:t});if("vis"==e)return new c({str:t});if("bmp"==e)return new h({str:t});throw new Error("unsupported directory string type: type="+e+" value="+t)},this.tohex=function(){null==this.dsType&&(this.dsType=this._getDsType());var e=he.asn1.x509.OID.atype2obj(this.sType),t=this.getValueObj(this.dsType,this.sValue),r=new n({array:[e,t]});return this.TLV=r.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},nt(he.asn1.x509.AttributeTypeAndValue,he.asn1.ASN1Object),he.asn1.x509.SubjectPublicKeyInfo=function(e){he.asn1.x509.SubjectPublicKeyInfo.superclass.constructor.call(this);var t=he,r=t.asn1,n=r.DERInteger,s=r.DERBitString,i=r.DERObjectIdentifier,o=r.DERSequence,a=r.ASN1Util.newObject,c=r.x509.AlgorithmIdentifier,h=t.crypto;h.ECDSA,h.DSA,this.getASN1Object=function(){if(null==this.asn1AlgId||null==this.asn1SubjPKey)throw"algId and/or subjPubKey not set";return new o({array:[this.asn1AlgId,this.asn1SubjPKey]})},this.tohex=function(){var e=this.getASN1Object();return this.hTLV=e.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},this.setPubKey=function(e){try{if(e instanceof ne){var t=a({seq:[{int:{bigint:e.n}},{int:{int:e.e}}]}).tohex();this.asn1AlgId=new c({name:"rsaEncryption"}),this.asn1SubjPKey=new s({hex:"00"+t})}}catch(e){}try{if(e instanceof he.crypto.ECDSA){var r=new i({name:e.curveName});this.asn1AlgId=new c({name:"ecPublicKey",asn1params:r}),this.asn1SubjPKey=new s({hex:"00"+e.pubKeyHex})}}catch(e){}try{if(e instanceof he.crypto.DSA){r=new a({seq:[{int:{bigint:e.p}},{int:{bigint:e.q}},{int:{bigint:e.g}}]}),this.asn1AlgId=new c({name:"dsa",asn1params:r});var o=new n({bigint:e.y});this.asn1SubjPKey=new s({hex:"00"+o.tohex()})}}catch(e){}},void 0!==e&&this.setPubKey(e)},nt(he.asn1.x509.SubjectPublicKeyInfo,he.asn1.ASN1Object),he.asn1.x509.Time=function(e){he.asn1.x509.Time.superclass.constructor.call(this);var t=he.asn1,r=t.DERUTCTime,n=t.DERGeneralizedTime;this.params=null,this.type=null,this.setTimeParams=function(e){this.timeParams=e},this.setByParam=function(e){this.params=e},this.getType=function(e){return e.match(/^[0-9]{12}Z$/)?"utc":e.match(/^[0-9]{14}Z$/)?"gen":e.match(/^[0-9]{12}\.[0-9]+Z$/)?"utc":e.match(/^[0-9]{14}\.[0-9]+Z$/)?"gen":null},this.tohex=function(){var e=this.params,t=null;if("string"==typeof e&&(e={str:e}),null==e||!e.str||null!=e.type&&null!=e.type||(e.type=this.getType(e.str)),null!=e&&e.str?("utc"==e.type&&(t=new r(e.str)),"gen"==e.type&&(t=new n(e.str))):t="gen"==this.type?new n:new r,null==t)throw new Error("wrong setting for Time");return this.TLV=t.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},he.asn1.x509.Time_bak=function(e){he.asn1.x509.Time_bak.superclass.constructor.call(this);var t=he.asn1,r=t.DERUTCTime,n=t.DERGeneralizedTime;this.setTimeParams=function(e){this.timeParams=e},this.tohex=function(){var e=null;return e=null!=this.timeParams?"utc"==this.type?new r(this.timeParams):new n(this.timeParams):"utc"==this.type?new r:new n,this.TLV=e.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},this.type="utc",void 0!==e&&(void 0!==e.type?this.type=e.type:void 0!==e.str&&(e.str.match(/^[0-9]{12}Z$/)&&(this.type="utc"),e.str.match(/^[0-9]{14}Z$/)&&(this.type="gen")),this.timeParams=e)},nt(he.asn1.x509.Time,he.asn1.ASN1Object),he.asn1.x509.AlgorithmIdentifier=function(e){he.asn1.x509.AlgorithmIdentifier.superclass.constructor.call(this),this.nameAlg=null,this.asn1Alg=null,this.asn1Params=null,this.paramEmpty=!1;var t=he.asn1,r=t.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV;if(this.tohex=function(){if(null===this.nameAlg&&null===this.asn1Alg)throw new Error("algorithm not specified");if(null!==this.nameAlg){var e=null;for(var n in r)n===this.nameAlg&&(e=r[n]);if(null!==e)return this.hTLV=e,this.hTLV}null!==this.nameAlg&&null===this.asn1Alg&&(this.asn1Alg=t.x509.OID.name2obj(this.nameAlg));var s=[this.asn1Alg];null!==this.asn1Params&&s.push(this.asn1Params);var i=new t.DERSequence({array:s});return this.hTLV=i.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(void 0!==e.name&&(this.nameAlg=e.name),void 0!==e.asn1params&&(this.asn1Params=e.asn1params),void 0!==e.paramempty&&(this.paramEmpty=e.paramempty)),null===this.asn1Params&&!1===this.paramEmpty&&null!==this.nameAlg){void 0!==this.nameAlg.name&&(this.nameAlg=this.nameAlg.name);var n=this.nameAlg.toLowerCase();"withdsa"!==n.substr(-7,7)&&"withecdsa"!==n.substr(-9,9)&&(this.asn1Params=new t.DERNull)}},nt(he.asn1.x509.AlgorithmIdentifier,he.asn1.ASN1Object),he.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV={SHAwithRSAandMGF1:"300d06092a864886f70d01010a3000",SHA256withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040201a11a301806092a864886f70d010108300b0609608648016503040201a203020120",SHA384withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040202a11a301806092a864886f70d010108300b0609608648016503040202a203020130",SHA512withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040203a11a301806092a864886f70d010108300b0609608648016503040203a203020140"},he.asn1.x509.GeneralName=function(e){he.asn1.x509.GeneralName.superclass.constructor.call(this);var t=he.asn1,r=t.x509,n=r.X500Name,s=r.OtherName,i=t.DERIA5String,o=(t.DERPrintableString,t.DEROctetString),a=t.DERTaggedObject,c=t.ASN1Object,h=Error;this.params=null,this.setByParam=function(e){this.params=e},this.tohex=function(){var e,t,r=this.params,l=!1;if(void 0!==r.other)e="a0",t=new s(r.other);else if(void 0!==r.rfc822)e="81",t=new i({str:r.rfc822});else if(void 0!==r.dns)e="82",t=new i({str:r.dns});else if(void 0!==r.dn)e="a4",l=!0,t="string"==typeof r.dn?new n({str:r.dn}):r.dn instanceof he.asn1.x509.X500Name?r.dn:new n(r.dn);else if(void 0!==r.ldapdn)e="a4",l=!0,t=new n({ldapstr:r.ldapdn});else if(void 0!==r.certissuer||void 0!==r.certsubj){var u,d;e="a4",l=!0;var p=null;if(void 0!==r.certsubj?(u=!1,d=r.certsubj):(u=!0,d=r.certissuer),d.match(/^[0-9A-Fa-f]+$/),-1!=d.indexOf("-----BEGIN ")&&(p=Re(d)),null==p)throw new Error("certsubj/certissuer not cert");var g,m=new ct;m.hex=p,g=u?m.getIssuerHex():m.getSubjectHex(),(t=new c).hTLV=g}else if(void 0!==r.uri)e="86",t=new i({str:r.uri});else{if(void 0===r.ip)throw new h("improper params");var f;e="87";var y=r.ip;try{if(y.match(/^[0-9a-f]+$/)){var v=y.length;if(8!=v&&16!=v&&32!=v&&64!=v)throw"err";f=y}else f=_e(y)}catch(e){throw new h("malformed IP address: "+r.ip+":"+e.message)}t=new o({hex:f})}return new a({tag:e,explicit:l,obj:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},nt(he.asn1.x509.GeneralName,he.asn1.ASN1Object),he.asn1.x509.GeneralNames=function(e){he.asn1.x509.GeneralNames.superclass.constructor.call(this);var t=he.asn1;this.setByParamArray=function(e){for(var r=0;r<e.length;r++){var n=new t.x509.GeneralName(e[r]);this.asn1Array.push(n)}},this.tohex=function(){return new t.DERSequence({array:this.asn1Array}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.asn1Array=new Array,void 0!==e&&this.setByParamArray(e)},nt(he.asn1.x509.GeneralNames,he.asn1.ASN1Object),he.asn1.x509.OtherName=function(e){he.asn1.x509.OtherName.superclass.constructor.call(this);var t=he.asn1,r=t.DERObjectIdentifier,n=t.DERSequence,s=t.ASN1Util.newObject;this.params=null,this.setByParam=function(e){this.params=e},this.tohex=function(){var e=this.params;if(null==e.oid||null==e.value)throw new Error("oid or value not specified");var t=new r({oid:e.oid}),i=s({tag:{tag:"a0",explicit:!0,obj:e.value}});return new n({array:[t,i]}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},nt(he.asn1.x509.OtherName,he.asn1.ASN1Object),he.asn1.x509.OID=new function(){var e=he.asn1.DERObjectIdentifier;this.name2oidList={"aes128-CBC":"2.16.840.1.101.3.4.1.2","aes256-CBC":"2.16.840.1.101.3.4.1.42",sha1:"1.3.14.3.2.26",sha256:"2.16.840.1.101.3.4.2.1",sha384:"2.16.840.1.101.3.4.2.2",sha512:"2.16.840.1.101.3.4.2.3",sha224:"2.16.840.1.101.3.4.2.4",md5:"1.2.840.113549.2.5",md2:"1.3.14.7.2.2.1",ripemd160:"1.3.36.3.2.1",hmacWithSHA1:"1.2.840.113549.2.7",hmacWithSHA224:"1.2.840.113549.2.8",hmacWithSHA256:"1.2.840.113549.2.9",hmacWithSHA384:"1.2.840.113549.2.10",hmacWithSHA512:"1.2.840.113549.2.11",MD2withRSA:"1.2.840.113549.1.1.2",MD4withRSA:"1.2.840.113549.1.1.3",MD5withRSA:"1.2.840.113549.1.1.4",SHA1withRSA:"1.2.840.113549.1.1.5","pkcs1-MGF":"1.2.840.113549.1.1.8",rsaPSS:"1.2.840.113549.1.1.10",SHA224withRSA:"1.2.840.113549.1.1.14",SHA256withRSA:"1.2.840.113549.1.1.11",SHA384withRSA:"1.2.840.113549.1.1.12",SHA512withRSA:"1.2.840.113549.1.1.13",SHA1withECDSA:"1.2.840.10045.4.1",SHA224withECDSA:"1.2.840.10045.4.3.1",SHA256withECDSA:"1.2.840.10045.4.3.2",SHA384withECDSA:"1.2.840.10045.4.3.3",SHA512withECDSA:"1.2.840.10045.4.3.4",dsa:"1.2.840.10040.4.1",SHA1withDSA:"1.2.840.10040.4.3",SHA224withDSA:"2.16.840.1.101.3.4.3.1",SHA256withDSA:"2.16.840.1.101.3.4.3.2",rsaEncryption:"1.2.840.113549.1.1.1",commonName:"2.5.4.3",countryName:"2.5.4.6",localityName:"2.5.4.7",stateOrProvinceName:"2.5.4.8",streetAddress:"2.5.4.9",organizationName:"2.5.4.10",organizationalUnitName:"2.5.4.11",domainComponent:"0.9.2342.19200300.100.1.25",userId:"0.9.2342.19200300.100.1.1",surname:"2.5.4.4",givenName:"2.5.4.42",title:"2.5.4.12",distinguishedName:"2.5.4.49",emailAddress:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3",subjectDirectoryAttributes:"2.5.29.9",subjectKeyIdentifier:"2.5.29.14",keyUsage:"2.5.29.15",subjectAltName:"2.5.29.17",issuerAltName:"2.5.29.18",basicConstraints:"2.5.29.19",cRLNumber:"2.5.29.20",cRLReason:"2.5.29.21",nameConstraints:"2.5.29.30",cRLDistributionPoints:"2.5.29.31",certificatePolicies:"2.5.29.32",anyPolicy:"2.5.29.32.0",policyMappings:"2.5.29.33",authorityKeyIdentifier:"2.5.29.35",policyConstraints:"2.5.29.36",extKeyUsage:"2.5.29.37",inhibitAnyPolicy:"2.5.29.54",authorityInfoAccess:"1.3.6.1.5.5.7.1.1",ocsp:"1.3.6.1.5.5.7.48.1",ocspBasic:"1.3.6.1.5.5.7.48.1.1",ocspNonce:"1.3.6.1.5.5.7.48.1.2",ocspNoCheck:"1.3.6.1.5.5.7.48.1.5",caIssuers:"1.3.6.1.5.5.7.48.2",anyExtendedKeyUsage:"2.5.29.37.0",serverAuth:"1.3.6.1.5.5.7.3.1",clientAuth:"1.3.6.1.5.5.7.3.2",codeSigning:"1.3.6.1.5.5.7.3.3",emailProtection:"1.3.6.1.5.5.7.3.4",timeStamping:"1.3.6.1.5.5.7.3.8",ocspSigning:"1.3.6.1.5.5.7.3.9",smtpUTF8Mailbox:"1.3.6.1.5.5.7.8.9",dateOfBirth:"1.3.6.1.5.5.7.9.1",placeOfBirth:"1.3.6.1.5.5.7.9.2",gender:"1.3.6.1.5.5.7.9.3",countryOfCitizenship:"1.3.6.1.5.5.7.9.4",countryOfResidence:"1.3.6.1.5.5.7.9.5",ecPublicKey:"1.2.840.10045.2.1","P-256":"1.2.840.10045.3.1.7",secp256r1:"1.2.840.10045.3.1.7",secp256k1:"1.3.132.0.10",secp384r1:"1.3.132.0.34",secp521r1:"1.3.132.0.35",pkcs5PBES2:"1.2.840.113549.1.5.13",pkcs5PBKDF2:"1.2.840.113549.1.5.12","des-EDE3-CBC":"1.2.840.113549.3.7",data:"1.2.840.113549.1.7.1","signed-data":"1.2.840.113549.1.7.2","enveloped-data":"1.2.840.113549.1.7.3","digested-data":"1.2.840.113549.1.7.5","encrypted-data":"1.2.840.113549.1.7.6","authenticated-data":"1.2.840.113549.1.9.16.1.2",tstinfo:"1.2.840.113549.1.9.16.1.4",signingCertificate:"1.2.840.113549.1.9.16.2.12",timeStampToken:"1.2.840.113549.1.9.16.2.14",signaturePolicyIdentifier:"1.2.840.113549.1.9.16.2.15",etsArchiveTimeStamp:"1.2.840.113549.1.9.16.2.27",signingCertificateV2:"1.2.840.113549.1.9.16.2.47",etsArchiveTimeStampV2:"1.2.840.113549.1.9.16.2.48",extensionRequest:"1.2.840.113549.1.9.14",contentType:"1.2.840.113549.1.9.3",messageDigest:"1.2.840.113549.1.9.4",signingTime:"1.2.840.113549.1.9.5",counterSignature:"1.2.840.113549.1.9.6",archiveTimeStampV3:"0.4.0.1733.2.4",pdfRevocationInfoArchival:"1.2.840.113583.1.1.8",adobeTimeStamp:"1.2.840.113583.1.1.9.1",smimeMailboxLegacy:"2.23.140.1.5.1.1",smimeMailboxMulti:"2.23.140.1.5.1.2",smimeMailboxStrict:"2.23.140.1.5.1.3",smimeOrganizationLegacy:"2.23.140.1.5.2.1",smimeOrganizationMulti:"2.23.140.1.5.2.2",smimeOrganizationStrict:"2.23.140.1.5.2.3",smimeSponsorLegacy:"2.23.140.1.5.3.1",smimeSponsorMulti:"2.23.140.1.5.3.2",smimeSponsorStrict:"2.23.140.1.5.3.3",smimeIndividualLegacy:"2.23.140.1.5.4.1",smimeIndividualMulti:"2.23.140.1.5.4.2",smimeIndividualStrict:"2.23.140.1.5.4.3"},this.atype2oidList={CN:"2.5.4.3",L:"2.5.4.7",ST:"2.5.4.8",O:"2.5.4.10",OU:"2.5.4.11",C:"2.5.4.6",STREET:"2.5.4.9",DC:"0.9.2342.19200300.100.1.25",UID:"0.9.2342.19200300.100.1.1",SN:"2.5.4.4",T:"2.5.4.12",GN:"2.5.4.42",DN:"2.5.4.49",E:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",serialNumber:"2.5.4.5",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3"},this.objCache={},this.name2obj=function(t){if(void 0!==this.objCache[t])return this.objCache[t];if(void 0===this.name2oidList[t])throw"Name of ObjectIdentifier not defined: "+t;var r=this.name2oidList[t],n=new e({oid:r});return this.objCache[t]=n,n},this.atype2obj=function(t){if(void 0!==this.objCache[t])return this.objCache[t];var r;if(t.match(/^\d+\.\d+\.[0-9.]+$/))r=t;else if(void 0!==this.atype2oidList[t])r=this.atype2oidList[t];else{if(void 0===this.name2oidList[t])throw new Error("AttributeType name undefined: "+t);r=this.name2oidList[t]}var n=new e({oid:r});return this.objCache[t]=n,n},this.registerOIDs=function(e){if(this.checkOIDs(e))for(var t in e)this.name2oidList[t]=e[t]},this.checkOIDs=function(e){try{var t=Object.keys(e);return 0!=t.length&&(t.map((function(e,t,r){if(!this[e].match(/^[0-2]\.[0-9.]+$/))throw new Error("value is not OID")}),e),!0)}catch(e){return!1}}},he.asn1.x509.OID.oid2name=function(e){var t=he.asn1.x509.OID.name2oidList;for(var r in t)if(t[r]==e)return r;return""},he.asn1.x509.OID.oid2atype=function(e){var t=he.asn1.x509.OID.atype2oidList;for(var r in t)if(t[r]==e)return r;return e},he.asn1.x509.OID.name2oid=function(e){if(e.match(/^[0-9.]+$/))return e;var t=he.asn1.x509.OID.name2oidList;return void 0===t[e]?"":t[e]},he.asn1.x509.X509Util={},he.asn1.x509.X509Util.newCertPEM=function(e){var t=he.asn1.x509;return t.TBSCertificate,new(0,t.Certificate)(e).getPEM()},void 0!==he&&he||(he={}),void 0!==he.asn1&&he.asn1||(he.asn1={}),void 0!==he.asn1.cms&&he.asn1.cms||(he.asn1.cms={}),he.asn1.cms.Attribute=function(e){var t=Error,r=he.asn1,n=r.DERSequence,s=r.DERSet,i=r.DERObjectIdentifier;this.params=null,this.typeOid=null,this.setByParam=function(e){this.params=e},this.getValueArray=function(){throw new t("not yet implemented abstract")},this.tohex=function(){var e=new i({oid:this.typeOid}),t=new s({array:this.getValueArray()});return new n({array:[e,t]}).tohex()},this.getEncodedHex=function(){return this.tohex()}},nt(he.asn1.cms.Attribute,he.asn1.ASN1Object),he.asn1.cms.ContentType=function(e){var t=he.asn1;t.cms.ContentType.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.3",this.getValueArray=function(){return[new t.DERObjectIdentifier(this.params.type)]},null!=e&&this.setByParam(e)},nt(he.asn1.cms.ContentType,he.asn1.cms.Attribute),he.asn1.cms.MessageDigest=function(e){var t=he.asn1,r=t.DEROctetString;t.cms.MessageDigest.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.4",this.getValueArray=function(){return[new r(this.params)]},null!=e&&this.setByParam(e)},nt(he.asn1.cms.MessageDigest,he.asn1.cms.Attribute),he.asn1.cms.SigningTime=function(e){var t=he.asn1;t.cms.SigningTime.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.5",this.getValueArray=function(){return[new t.x509.Time(this.params)]},null!=e&&this.setByParam(e)},nt(he.asn1.cms.SigningTime,he.asn1.cms.Attribute),he.asn1.cms.SigningCertificate=function(e){var t=Error,r=he,n=r.asn1,s=n.DERSequence,i=n.cms,o=i.ESSCertID;r.crypto,i.SigningCertificate.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.12",this.getValueArray=function(){if(null==this.params||null==this.params||null==this.params.array)throw new t("parameter 'array' not specified");for(var r=this.params.array,n=[],i=0;i<r.length;i++){var a=r[i];0!=e.hasis||"string"!=typeof a||-1==a.indexOf("-----BEGIN")&&!de.isASN1HEX(a)||(a={cert:a}),0!=a.hasis&&0==e.hasis&&(a.hasis=!1),n.push(new o(a))}var c=new s({array:n});return[new s({array:[c]})]},null!=e&&this.setByParam(e)},nt(he.asn1.cms.SigningCertificate,he.asn1.cms.Attribute),he.asn1.cms.ESSCertID=function(e){he.asn1.cms.ESSCertID.superclass.constructor.call(this);var t=Error,r=he,n=r.asn1,s=n.DEROctetString,i=n.DERSequence,o=n.cms.IssuerSerial;this.params=null,this.getCertHash=function(e,n){if(null!=e.hash)return e.hash;if("string"==typeof e&&-1==e.indexOf("-----BEGIN")&&!de.isASN1HEX(e))return e;var s,i,o;if("string"==typeof e)s=e;else{if(null==e.cert)throw new t("hash nor cert unspecified");s=e.cert}if(i=-1!=s.indexOf("-----BEGIN")?Re(s):s,"string"==typeof e&&(-1!=e.indexOf("-----BEGIN")?i=Re(e):de.isASN1HEX(e)&&(i=e)),null!=e.alg)o=e.alg;else{if(null==n)throw new t("hash alg unspecified");o=n}return r.crypto.Util.hashHex(i,o)},this.tohex=function(){var e=this.params,t=this.getCertHash(e,"sha1"),r=[];return r.push(new s({hex:t})),("string"==typeof e&&-1!=e.indexOf("-----BEGIN")||null!=e.cert&&0!=e.hasis||null!=e.issuer&&null!=e.serial)&&r.push(new o(e)),new i({array:r}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},nt(he.asn1.cms.ESSCertID,he.asn1.ASN1Object),he.asn1.cms.SigningCertificateV2=function(e){var t=Error,r=he,n=r.asn1,s=n.DERSequence,i=(n.x509,n.cms),o=i.ESSCertIDv2;r.crypto,i.SigningCertificateV2.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.47",this.getValueArray=function(){if(null==this.params||null==this.params||null==this.params.array)throw new t("parameter 'array' not specified");for(var r=this.params.array,n=[],i=0;i<r.length;i++){var a=r[i];null==e.alg&&0!=e.hasis||"string"!=typeof a||-1==a.indexOf("-----BEGIN")&&!de.isASN1HEX(a)||(a={cert:a}),null==a.alg&&null!=e.alg&&(a.alg=e.alg),0!=a.hasis&&0==e.hasis&&(a.hasis=!1),n.push(new o(a))}var c=new s({array:n});return[new s({array:[c]})]},null!=e&&this.setByParam(e)},nt(he.asn1.cms.SigningCertificateV2,he.asn1.cms.Attribute),he.asn1.cms.ESSCertIDv2=function(e){he.asn1.cms.ESSCertIDv2.superclass.constructor.call(this),Error;var t=he.asn1,r=t.DEROctetString,n=t.DERSequence,s=t.cms.IssuerSerial,i=t.x509.AlgorithmIdentifier;this.params=null,this.tohex=function(){var e=this.params,t=this.getCertHash(e,"sha256"),o=[];return null!=e.alg&&"sha256"!=e.alg&&o.push(new i({name:e.alg})),o.push(new r({hex:t})),("string"==typeof e&&-1!=e.indexOf("-----BEGIN")||null!=e.cert&&0!=e.hasis||null!=e.issuer&&null!=e.serial)&&o.push(new s(e)),new n({array:o}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},nt(he.asn1.cms.ESSCertIDv2,he.asn1.cms.ESSCertID),he.asn1.cms.IssuerSerial=function(e){var t=Error,r=he.asn1,n=r.DERInteger,s=r.DERSequence,i=r.cms,o=r.x509.GeneralNames,a=ct;i.IssuerSerial.superclass.constructor.call(this),this.setByParam=function(e){this.params=e},this.tohex=function(){var e,r,i=this.params;if("string"==typeof i&&-1!=i.indexOf("-----BEGIN")||null!=i.cert){var c;c=null!=i.cert?i.cert:i;var h=new a;h.readCertPEM(c),e=h.getIssuer(),r={hex:h.getSerialNumberHex()}}else{if(null==i.issuer||!i.serial)throw new t("cert or issuer and serial parameter not specified");e=i.issuer,r=i.serial}var l=new o([{dn:e}]),u=new n(r);return new s({array:[l,u]}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},nt(he.asn1.cms.IssuerSerial,he.asn1.ASN1Object),he.asn1.cms.SignerIdentifier=function(e){var t=he.asn1,r=(t.DERInteger,t.DERSequence,t.cms),n=r.IssuerAndSerialNumber,s=r.SubjectKeyIdentifier;t.x509.X500Name,Error,r.SignerIdentifier.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;if("isssn"==e.type)return new n(e).tohex();if("skid"==e.type)return new s(e).tohex();throw new Error("wrong property for isssn or skid")},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},nt(he.asn1.cms.SignerIdentifier,he.asn1.ASN1Object),he.asn1.cms.IssuerAndSerialNumber=function(e){var t=he.asn1,r=t.DERInteger,n=t.DERSequence,s=t.cms,i=t.x509.X500Name,o=ct,a=Error;s.IssuerAndSerialNumber.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e,t,s=this.params;if("string"==typeof s&&-1!=s.indexOf("-----BEGIN")||null!=s.cert){var c;c=null!=s.cert?s.cert:s;var h=new o;h.readCertPEM(c),e=h.getIssuer(),t={hex:h.getSerialNumberHex()}}else{if(null==s.issuer||!s.serial)throw new a("cert or issuer and serial parameter not specified");e=s.issuer,t=s.serial}var l=new i(e),u=new r(t);return new n({array:[l,u]}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},null!=e&&this.setByParam(e)},nt(he.asn1.cms.IssuerAndSerialNumber,he.asn1.ASN1Object),he.asn1.cms.SubjectKeyIdentifier=function(e){var t=he.asn1,r=(t.DERInteger,t.DERSequence,t.ASN1Util.newObject),n=t.cms,s=(n.IssuerAndSerialName,n.SubjectKeyIdentifier,t.x509.X500Name,ct),i=Error;n.SubjectKeyIdentifier.superclass.constructor.call(this),this.tohex=function(){var e,t=this.params;if(null==t.cert&&null==t.skid)throw new i("property cert nor skid undefined");return null!=t.cert?e=new s(t.cert).getExtSubjectKeyIdentifier().kid.hex:null!=t.skid&&(e=t.skid),r({tag:{tage:"a0",obj:{octstr:{hex:e}}}}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},nt(he.asn1.cms.SubjectKeyIdentifier,he.asn1.ASN1Object),he.asn1.cms.AttributeList=function(e){var t=Error,r=he.asn1,n=r.DERSet,s=r.cms;s.AttributeList.superclass.constructor.call(this),this.params=null,this.hTLV=null,this.setByParam=function(e){this.params=e},this.tohex=function(){var e=this.params;if(null!=this.hTLV)return this.hTLV;var r=!0;null!=e.sortflag&&(r=e.sortflag);for(var i=e.array,o=[],a=0;a<i.length;a++){var c=i[a],h=c.attr;if("contentType"==h)o.push(new s.ContentType(c));else if("messageDigest"==h)o.push(new s.MessageDigest(c));else if("signingTime"==h)o.push(new s.SigningTime(c));else if("signingCertificate"==h)o.push(new s.SigningCertificate(c));else if("signingCertificateV2"==h)o.push(new s.SigningCertificateV2(c));else if("signaturePolicyIdentifier"==h)o.push(new he.asn1.cades.SignaturePolicyIdentifier(c));else{if("signatureTimeStamp"!=h&&"timeStampToken"!=h)throw new t("unknown attr: "+h);o.push(new he.asn1.cades.SignatureTimeStamp(c))}}var l=new n({array:o,sortflag:r});return this.hTLV=l.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},nt(he.asn1.cms.AttributeList,he.asn1.ASN1Object),he.asn1.cms.SignerInfo=function(e){var t=Error,r=he,n=r.asn1,s=n.DERInteger,i=n.DEROctetString,o=n.DERSequence,a=n.DERTaggedObject,c=n.cms,h=c.SignerIdentifier,l=c.AttributeList,u=(c.ContentType,c.EncapsulatedContentInfo,c.MessageDigest,c.SignedData,n.x509.AlgorithmIdentifier),d=r.crypto,p=st;c.SignerInfo.superclass.constructor.call(this),this.params=null,this.sign=function(){var e=this.params,t=e.sigalg,r=new l(e.sattrs).tohex(),n=p.getKey(e.signkey),s=new d.Signature({alg:t});s.init(n),s.updateHex(r);var i=s.sign();e.sighex=i},this.tohex=function(){var e=this.params,r=[];if(r.push(new s({int:e.version})),r.push(new h(e.id)),r.push(new u({name:e.hashalg})),null!=e.sattrs){var n=new l(e.sattrs);try{r.push(new a({tag:"a0",explicit:!1,obj:n}))}catch(e){throw new t("si sattr error: "+e)}}if(null!=e.sigalgfield?r.push(new u({name:e.sigalgfield})):r.push(new u({name:e.sigalg})),null==e.sighex&&null!=e.signkey&&this.sign(),r.push(new i({hex:e.sighex})),null!=e.uattrs){n=new l(e.uattrs);try{r.push(new a({tag:"a1",explicit:!1,obj:n}))}catch(e){throw new t("si uattr error: "+e)}}return new o({array:r}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},nt(he.asn1.cms.SignerInfo,he.asn1.ASN1Object),he.asn1.cms.EncapsulatedContentInfo=function(e){var t=he.asn1,r=t.DERTaggedObject,n=t.DERSequence,s=t.DERObjectIdentifier,i=t.DEROctetString;t.cms.EncapsulatedContentInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,t=[];if(t.push(new s(e.type)),null!=e.content&&(null!=e.content.hex||null!=e.content.str)&&1!=e.isDetached){var o=new i(e.content),a=new r({tag:"a0",explicit:!0,obj:o});t.push(a)}return new n({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},null!=e&&this.setByParam(e)},nt(he.asn1.cms.EncapsulatedContentInfo,he.asn1.ASN1Object),he.asn1.cms.ContentInfo=function(e){var t=he.asn1,r=t.DERTaggedObject,n=t.DERSequence,s=t.DERObjectIdentifier;t.x509.OID.name2obj,he.asn1.cms.ContentInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,t=[];t.push(new s(e.type));var i=new r({tag:"a0",explicit:!0,obj:e.obj});return t.push(i),new n({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},null!=e&&this.setByParam(e)},nt(he.asn1.cms.ContentInfo,he.asn1.ASN1Object),he.asn1.cms.SignedData=function(e){Error;var t=he.asn1,r=(t.ASN1Object,t.DERInteger),n=t.DERSet,s=t.DERSequence,i=(t.DERTaggedObject,t.cms),o=i.EncapsulatedContentInfo,a=i.SignerInfo,c=i.ContentInfo,h=i.CertificateSet,l=i.RevocationInfoChoices,u=t.x509.AlgorithmIdentifier;he.asn1.cms.SignedData.superclass.constructor.call(this),this.params=null,this.checkAndFixParam=function(){var e=this.params;this._setDigestAlgs(e),this._setContentTypeByEContent(e),this._setMessageDigestByEContent(e),this._setSignerInfoVersion(e),this._setSignedDataVersion(e)},this._setDigestAlgs=function(e){for(var t={},r=e.sinfos,n=0;n<r.length;n++)t[r[n].hashalg]=1;e.hashalgs=Object.keys(t).sort()},this._setContentTypeByEContent=function(e){for(var t=e.econtent.type,r=e.sinfos,n=0;n<r.length;n++){var s=r[n];this._getAttrParamByName(s,"contentType").type=t}},this._setMessageDigestByEContent=function(e){var t=e.econtent,r=(e.econtent.type,t.content.hex);null==r&&"data"==t.type&&null!=t.content.str&&(r=Ae(t.content.str));for(var n=e.sinfos,s=0;s<n.length;s++){var i=n[s],o=i.hashalg,a=this._getAttrParamByName(i,"messageDigest"),c=he.crypto.Util.hashHex(r,o);a.hex=c}},this._getAttrParamByName=function(e,t){for(var r=e.sattrs.array,n=0;n<r.length;n++)if(r[n].attr==t)return r[n]},this._setSignerInfoVersion=function(e){for(var t=e.sinfos,r=0;r<t.length;r++){var n=t[r],s=1;"skid"==n.id.type&&(s=3),n.version=s}},this._setSignedDataVersion=function(e){var t=this._getSignedDataVersion(e);e.version=t},this._getSignedDataVersion=function(e){if(null!=e.revinfos)for(var t=e.revinfos,r=0;r<t.length;r++)if(null!=t[r].ocsp)return 5;var n=e.sinfos;for(r=0;r<n.length;r++)if(3==e.sinfos[r].version)return 3;return"data"!=e.econtent.type?3:1},this.tohex=function(){var e=this.params;null!=this.getEncodedHexPrepare&&this.getEncodedHexPrepare(),1!=e.fixed&&this.checkAndFixParam();var t=[];t.push(new r({int:e.version}));for(var i=[],c=0;c<e.hashalgs.length;c++){var d=e.hashalgs[c];i.push(new u({name:d}))}t.push(new n({array:i})),t.push(new o(e.econtent)),null!=e.certs&&t.push(new h(e.certs)),null!=e.revinfos&&t.push(new l(e.revinfos));var p=[];for(c=0;c<e.sinfos.length;c++){var g=e.sinfos[c];p.push(new a(g))}return t.push(new n({array:p})),new s({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.getContentInfo=function(){return new c({type:"signed-data",obj:this})},this.getContentInfoEncodedHex=function(){return this.getContentInfo().tohex()},null!=e&&this.setByParam(e)},nt(he.asn1.cms.SignedData,he.asn1.ASN1Object),he.asn1.cms.CertificateSet=function(e){he.asn1.cms.CertificateSet.superclass.constructor.call(this);var t=Error,r=he.asn1,n=r.DERTaggedObject,s=r.DERSet,i=r.ASN1Object;this.params=null,this.tohex=function(){var e,r=this.params,o=[];if(r instanceof Array)e=r;else{if(null==r.array)throw new t("cert array not specified");e=r.array}for(var a=0;a<e.length;a++){var c=Re(e[a]),h=new i;h.hTLV=c,o.push(h)}var l={array:o};0==r.sortflag&&(l.sortflag=!1);var u=new s(l);return new n({tag:"a0",explicit:!1,obj:u}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},nt(he.asn1.cms.CertificateSet,he.asn1.ASN1Object),he.asn1.cms.RevocationInfoChoices=function(e){he.asn1.cms.RevocationInfoChoices.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;if(!e instanceof Array)throw new Error("params is not array");for(var t=[],r=0;r<e.length;r++)t.push(new he.asn1.cms.RevocationInfoChoice(e[r]));return he.asn1.ASN1Util.newObject({tag:{tagi:"a1",obj:{set:t}}}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},nt(he.asn1.cms.RevocationInfoChoices,he.asn1.ASN1Object),he.asn1.cms.RevocationInfoChoice=function(e){he.asn1.cms.RevocationInfoChoice.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;if(null!=e.crl&&"string"==typeof e.crl){var t=e.crl;return-1!=e.crl.indexOf("-----BEGIN")&&(t=Re(e.crl)),t}if(null!=e.ocsp)return he.asn1.ASN1Util.newObject({tag:{tagi:"a1",obj:new he.asn1.cms.OtherRevocationFormat(e)}}).tohex();throw new Error("property crl or ocsp undefined")},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},nt(he.asn1.cms.RevocationInfoChoice,he.asn1.ASN1Object),he.asn1.cms.OtherRevocationFormat=function(e){he.asn1.cms.OtherRevocationFormat.superclass.constructor.call(this);var t=Error,r=he,n=r.asn1.ASN1Util.newObject,s=r.lang.String.isHex;this.params=null,this.tohex=function(){var e=this.params;if(null==e.ocsp)throw new t("property ocsp not specified");if(!s(e.ocsp)||!de.isASN1HEX(e.ocsp))throw new t("ocsp value not ASN.1 hex string");return n({seq:[{oid:"1.3.6.1.5.5.7.16.2"},{asn1:{tlv:e.ocsp}}]}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},nt(he.asn1.cms.OtherRevocationFormat,he.asn1.ASN1Object),he.asn1.cms.CMSUtil=new function(){},he.asn1.cms.CMSUtil.newSignedData=function(e){return new he.asn1.cms.SignedData(e)},he.asn1.cms.CMSUtil.verifySignedData=function(e){var t=he,r=t.asn1,n=r.cms,s=(n.SignerInfo,n.SignedData,n.SigningTime,n.SigningCertificate,n.SigningCertificateV2,r.cades.SignaturePolicyIdentifier,t.lang.String.isHex),i=de,o=i.getVbyList,a=i.getTLVbyList,c=i.getIdxbyList,h=i.getChildIdx,l=i.getTLV,u=i.oidname,d=t.crypto.Util.hashHex;void 0===e.cms&&s(e.cms);var p=e.cms,g=function(e,t){var r=t.idx;t.signerid_issuer1=a(e,r,[1,0],"30"),t.signerid_serial1=o(e,r,[1,1],"02"),t.hashalg=u(o(e,r,[2,0],"06"));var n=c(e,r,[3],"a0");t.idxSignedAttrs=n,m(e,t,n);var s=h(e,r).length;if(s<6)throw"malformed SignerInfo";t.sigalg=u(o(e,r,[s-2,0],"06")),t.sigval=o(e,r,[s-1],"04")},m=function(e,t,r){var n=h(e,r);t.signedAttrIdxList=n;for(var s=0;s<n.length;s++){var i,a=n[s],c=o(e,a,[0],"06");"2a864886f70d010905"===c?(i=xe(o(e,a,[1,0])),t.saSigningTime=i):"2a864886f70d010904"===c&&(i=o(e,a,[1,0],"04"),t.saMessageDigest=i)}},f=function(e,t,r,n){r.verifyDetail={};var s=r.verifyDetail,i=t.parse.econtent,o=r.hashalg,a=r.saMessageDigest;s.validMessageDigest=!1,d(i,o)===a&&(s.validMessageDigest=!0),function(e,t,r,n){var s,i=t.parse.certsIdx;if(void 0===t.certs){s=[],t.certkeys=[];for(var o=h(e,i),a=0;a<o.length;a++){var c=l(e,o[a]),u=new ct;u.readCertHex(c),s[a]=u,t.certkeys[a]=u.getPublicKey()}t.certs=s}else s=t.certs;for(t.cccc=s.length,t.cccci=o.length,a=0;a<s.length;a++){var d=u.getIssuerHex(),p=u.getSerialNumberHex();r.signerid_issuer1===d&&r.signerid_serial1===p&&(r.certkey_idx=a)}}(e,t,r),s.validSignatureValue=!1;var c=r.sigalg,u="31"+l(e,r.idxSignedAttrs).substr(2);r.signedattrshex=u;var p=t.certs[r.certkey_idx].getPublicKey(),g=new he.crypto.Signature({alg:c});g.init(p),g.updateHex(u);var m=g.verify(r.sigval);s.validSignatureValue_isValid=m,!0===m&&(s.validSignatureValue=!0),r.isValid=!1,s.validMessageDigest&&s.validSignatureValue&&(r.isValid=!0)},y={isValid:!1,parse:{}};return function(e,t){if("2a864886f70d010702"!==o(e,0,[0],"06"))return t;t.cmsType="signedData",t.econtent=o(e,0,[1,0,2,1,0]),function(e,t){for(var r,n=3;n<6;n++)if(void 0!==(r=c(e,0,[1,0,n]))){var s=e.substr(r,2);"a0"===s&&(t.certsIdx=r),"a1"===s&&(t.revinfosIdx=r),"31"===s&&(t.signerinfosIdx=r)}}(e,t),t.signerInfos=[],function(e,t){var r=t.signerinfosIdx;if(void 0!==r){var n=h(e,r);t.signerInfoIdxList=n;for(var s=0;s<n.length;s++){var i={idx:n[s]};g(e,i),t.signerInfos.push(i)}}}(e,t)}(p,y.parse),function(e,t){for(var r=t.parse.signerInfos,n=r.length,s=!0,i=0;i<n;i++){var o=r[i];f(e,t,o),o.isValid||(s=!1)}t.isValid=s}(p,y),y},he.asn1.cms.CMSParser=function(){var e=Error,t=ct,r=new t,n=de,s=n.getV,i=n.getTLV,o=(n.getIdxbyList,n.getTLVbyList),a=n.getTLVbyListEx,c=n.getVbyList,h=n.getVbyListEx,l=n.getChildIdx;this.getCMSSignedData=function(e){var t=o(e,0,[1,0]);return this.getSignedData(t)},this.getSignedData=function(e){var t=l(e,0),r={},n=s(e,t[0]),o=parseInt(n,16);r.version=o;var c=i(e,t[1]);r.hashalgs=this.getHashAlgArray(c);var h=i(e,t[2]);r.econtent=this.getEContent(h);var u=a(e,0,["[0]"]);null!=u&&(r.certs=this.getCertificateSet(u)),a(e,0,["[1]"]);var d=a(e,0,[3]);return r.sinfos=this.getSignerInfos(d),r},this.getHashAlgArray=function(e){for(var r=l(e,0),n=new t,s=[],o=0;o<r.length;o++){var a=i(e,r[o]),c=n.getAlgorithmIdentifierName(a);s.push(c)}return s},this.getEContent=function(e){var t={},r=c(e,0,[0]),n=c(e,0,[1,0]);return t.type=he.asn1.x509.OID.oid2name(de.hextooidstr(r)),t.content={hex:n},t},this.getSignerInfos=function(e){for(var t=[],r=l(e,0),n=0;n<r.length;n++){var s=i(e,r[n]),o=this.getSignerInfo(s);t.push(o)}return t},this.getSignerInfo=function(e){var t={},s=l(e,0),o=n.getInt(e,s[0],-1);-1!=o&&(t.version=o);var c=i(e,s[1]),u=this.getIssuerAndSerialNumber(c);t.id=u;var d=i(e,s[2]),p=r.getAlgorithmIdentifierName(d);t.hashalg=p;var g=a(e,0,["[0]"]);if(null!=g){var m=this.getAttributeList(g);t.sattrs=m}var f=a(e,0,[3]),y=r.getAlgorithmIdentifierName(f);t.sigalg=y;var v=h(e,0,[4]);t.sighex=v;var b=a(e,0,["[1]"]);if(null!=b){var S=this.getAttributeList(b);t.uattrs=S}return t},this.getSignerIdentifier=function(e){if("30"==e.substr(0,2))return this.getIssuerAndSerialNumber(e);throw new Error("SKID of signerIdentifier not supported")},this.getIssuerAndSerialNumber=function(e){var t={type:"isssn"},n=l(e,0),o=i(e,n[0]);t.issuer=r.getX500Name(o);var a=s(e,n[1]);return t.serial={hex:a},t},this.getAttributeList=function(e){for(var t=[],r=l(e,0),n=0;n<r.length;n++){var s=i(e,r[n]),o=this.getAttribute(s);t.push(o)}return{array:t}},this.getAttribute=function(e){var t={},r=l(e,0),s=n.getOID(e,r[0]),o=he.asn1.x509.OID.oid2name(s);t.attr=o;var a=i(e,r[1]),c=l(a,0);if(1==c.length)t.valhex=i(a,c[0]);else{for(var h=[],u=0;u<c.length;u++)h.push(i(a,c[u]));t.valhex=h}return"contentType"==o?this.setContentType(t):"messageDigest"==o?this.setMessageDigest(t):"signingTime"==o?this.setSigningTime(t):"signingCertificate"==o?this.setSigningCertificate(t):"signingCertificateV2"==o?this.setSigningCertificateV2(t):"signaturePolicyIdentifier"==o&&this.setSignaturePolicyIdentifier(t),t},this.setContentType=function(e){var t=n.getOIDName(e.valhex,0,null);null!=t&&(e.type=t,delete e.valhex)},this.setSigningTime=function(e){var t=xe(s(e.valhex,0));e.str=t,delete e.valhex},this.setMessageDigest=function(e){var t=s(e.valhex,0);e.hex=t,delete e.valhex},this.setSigningCertificate=function(e){var t=l(e.valhex,0);if(t.length>0){for(var r=i(e.valhex,t[0]),n=l(r,0),s=[],o=0;o<n.length;o++){var a=i(r,n[o]),c=this.getESSCertID(a);s.push(c)}e.array=s}if(t.length>1){var h=i(e.valhex,t[1]);e.polhex=h}delete e.valhex},this.setSignaturePolicyIdentifier=function(e){var r=l(e.valhex,0);if(r.length>0){var o=n.getOID(e.valhex,r[0]);e.oid=o}if(r.length>1){var a=new t,c=l(e.valhex,r[1]),h=i(e.valhex,c[0]),u=a.getAlgorithmIdentifierName(h);e.alg=u;var d=s(e.valhex,c[1]);e.hash=d}delete e.valhex},this.setSigningCertificateV2=function(e){var t=l(e.valhex,0);if(t.length>0){for(var r=i(e.valhex,t[0]),n=l(r,0),s=[],o=0;o<n.length;o++){var a=i(r,n[o]),c=this.getESSCertIDv2(a);s.push(c)}e.array=s}if(t.length>1){var h=i(e.valhex,t[1]);e.polhex=h}delete e.valhex},this.getESSCertID=function(e){var t={},r=l(e,0);if(r.length>0){var n=s(e,r[0]);t.hash=n}if(r.length>1){var o=i(e,r[1]),a=this.getIssuerSerial(o);null!=a.serial&&(t.serial=a.serial),null!=a.issuer&&(t.issuer=a.issuer)}return t},this.getESSCertIDv2=function(t){var n={},o=l(t,0);if(o.length<1||3<o.length)throw new e("wrong number of elements");var a=0;if("30"==t.substr(o[0],2)){var c=i(t,o[0]);n.alg=r.getAlgorithmIdentifierName(c),a++}else n.alg="sha256";var h=s(t,o[a]);if(n.hash=h,o.length>a+1){var u=i(t,o[a+1]),d=this.getIssuerSerial(u);n.issuer=d.issuer,n.serial=d.serial}return n},this.getIssuerSerial=function(e){var t={},n=l(e,0),o=i(e,n[0]),a=r.getGeneralNames(o)[0].dn;t.issuer=a;var c=s(e,n[1]);return t.serial={hex:c},t},this.getCertificateSet=function(e){for(var t=l(e,0),r=[],n=0;n<t.length;n++){var s=i(e,t[n]);if("30"==s.substr(0,2)){var o=Pe(s,"CERTIFICATE");r.push(o)}}return{array:r,sortflag:!1}}},void 0!==he&&he||(he={}),void 0!==he.asn1&&he.asn1||(he.asn1={}),void 0!==he.asn1.tsp&&he.asn1.tsp||(he.asn1.tsp={}),he.asn1.tsp.TimeStampToken=function(e){var t=he.asn1.tsp;t.TimeStampToken.superclass.constructor.call(this),this.params=null,this.getEncodedHexPrepare=function(){var e=new t.TSTInfo(this.params.econtent.content);this.params.econtent.content.hex=e.tohex()},null!=e&&this.setByParam(e)},nt(he.asn1.tsp.TimeStampToken,he.asn1.cms.SignedData),he.asn1.tsp.TSTInfo=function(e){Error;var t=he.asn1,r=t.DERSequence,n=t.DERInteger,s=t.DERBoolean,i=t.DERGeneralizedTime,o=t.DERObjectIdentifier,a=t.DERTaggedObject,c=t.tsp,h=c.MessageImprint,l=c.Accuracy,u=(t.x509.X500Name,t.x509.GeneralName);if(c.TSTInfo.superclass.constructor.call(this),this.dVersion=new n({int:1}),this.dPolicy=null,this.dMessageImprint=null,this.dSerial=null,this.dGenTime=null,this.dAccuracy=null,this.dOrdering=null,this.dNonce=null,this.dTsa=null,this.tohex=function(){var e=[this.dVersion];if(null==this.dPolicy)throw new Error("policy shall be specified.");if(e.push(this.dPolicy),null==this.dMessageImprint)throw new Error("messageImprint shall be specified.");if(e.push(this.dMessageImprint),null==this.dSerial)throw new Error("serialNumber shall be specified.");if(e.push(this.dSerial),null==this.dGenTime)throw new Error("genTime shall be specified.");e.push(this.dGenTime),null!=this.dAccuracy&&e.push(this.dAccuracy),null!=this.dOrdering&&e.push(this.dOrdering),null!=this.dNonce&&e.push(this.dNonce),null!=this.dTsa&&e.push(this.dTsa);var t=new r({array:e});return this.hTLV=t.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e){if("string"==typeof e.policy){if(!e.policy.match(/^[0-9.]+$/))throw"policy shall be oid like 0.1.4.134";this.dPolicy=new o({oid:e.policy})}void 0!==e.messageImprint&&(this.dMessageImprint=new h(e.messageImprint)),void 0!==e.serial&&(this.dSerial=new n(e.serial)),void 0!==e.genTime&&(this.dGenTime=new i(e.genTime)),void 0!==e.accuracy&&(this.dAccuracy=new l(e.accuracy)),void 0!==e.ordering&&1==e.ordering&&(this.dOrdering=new s),void 0!==e.nonce&&(this.dNonce=new n(e.nonce)),void 0!==e.tsa&&(this.dTsa=new a({tag:"a0",explicit:!0,obj:new u({dn:e.tsa})}))}},nt(he.asn1.tsp.TSTInfo,he.asn1.ASN1Object),he.asn1.tsp.Accuracy=function(e){var t=he.asn1,r=t.ASN1Util.newObject;t.tsp.Accuracy.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,t=[];return null!=e.seconds&&"number"==typeof e.seconds&&t.push({int:e.seconds}),null!=e.millis&&"number"==typeof e.millis&&t.push({tag:{tagi:"80",obj:{int:e.millis}}}),null!=e.micros&&"number"==typeof e.micros&&t.push({tag:{tagi:"81",obj:{int:e.micros}}}),r({seq:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},nt(he.asn1.tsp.Accuracy,he.asn1.ASN1Object),he.asn1.tsp.MessageImprint=function(e){var t=he.asn1,r=t.DERSequence,n=t.DEROctetString,s=t.x509.AlgorithmIdentifier;t.tsp.MessageImprint.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,t=new s({name:e.alg}),i=new n({hex:e.hash});return new r({array:[t,i]}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},nt(he.asn1.tsp.MessageImprint,he.asn1.ASN1Object),he.asn1.tsp.TimeStampReq=function(e){var t=he.asn1,r=t.DERSequence,n=t.DERInteger,s=t.DERBoolean,i=(t.ASN1Object,t.DERObjectIdentifier),o=t.tsp,a=o.MessageImprint;o.TimeStampReq.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,t=[];return t.push(new n({int:1})),e.messageImprint instanceof he.asn1.ASN1Object?t.push(e.messageImprint):t.push(new a(e.messageImprint)),null!=e.policy&&t.push(new i(e.policy)),null!=e.nonce&&t.push(new n(e.nonce)),1==e.certreq&&t.push(new s),new r({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},nt(he.asn1.tsp.TimeStampReq,he.asn1.ASN1Object),he.asn1.tsp.TimeStampResp=function(e){var t=he.asn1,r=t.DERSequence,n=(t.ASN1Object,t.tsp),s=n.PKIStatusInfo;n.TimeStampResp.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,i=[];if(null!=e.econtent||null!=e.tst)if(null!=e.statusinfo?i.push(new s(e.statusinfo)):i.push(new s("granted")),null!=e.econtent)i.push(new n.TimeStampToken(e).getContentInfo());else{if(!(e.tst instanceof t.ASN1Object))throw new Error("improper member tst value");i.push(e.tst)}else{if(null==e.statusinfo)throw new Error("parameter for token nor statusinfo not specified");i.push(new s(e.statusinfo))}return new r({array:i}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},nt(he.asn1.tsp.TimeStampResp,he.asn1.ASN1Object),he.asn1.tsp.PKIStatusInfo=function(e){var t=Error,r=he.asn1,n=r.DERSequence,s=r.tsp,i=s.PKIStatus,o=s.PKIFreeText,a=s.PKIFailureInfo;s.PKIStatusInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,r=[];if("string"==typeof e)r.push(new i(e));else{if(null==e.status)throw new t("property 'status' unspecified");r.push(new i(e.status)),null!=e.statusstr&&r.push(new o(e.statusstr)),null!=e.failinfo&&r.push(new a(e.failinfo))}return new n({array:r}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},nt(he.asn1.tsp.PKIStatusInfo,he.asn1.ASN1Object),he.asn1.tsp.PKIStatus=function(e){var t=Error,r=he.asn1,n=r.DERInteger;r.tsp.PKIStatus.superclass.constructor.call(this);var s={granted:0,grantedWithMods:1,rejection:2,waiting:3,revocationWarning:4,revocationNotification:5};this.params=null,this.tohex=function(){var e,r=this.params;if("string"==typeof r)try{e=s[r]}catch(e){throw new t("undefined name: "+r)}else{if("number"!=typeof r)throw new t("unsupported params");e=r}return new n({int:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},nt(he.asn1.tsp.PKIStatus,he.asn1.ASN1Object),he.asn1.tsp.PKIFreeText=function(e){var t=Error,r=he.asn1,n=r.DERSequence,s=r.DERUTF8String;r.tsp.PKIFreeText.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;if(!e instanceof Array)throw new t("wrong params: not array");for(var r=[],i=0;i<e.length;i++)r.push(new s({str:e[i]}));return new n({array:r}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},nt(he.asn1.tsp.PKIFreeText,he.asn1.ASN1Object),he.asn1.tsp.PKIFailureInfo=function(e){var t=Error,r=he.asn1,n=r.DERBitString,s=r.tsp.PKIFailureInfo,i={badAlg:0,badRequest:2,badDataFormat:5,timeNotAvailable:14,unacceptedPolicy:15,unacceptedExtension:16,addInfoNotAvailable:17,systemFailure:25};s.superclass.constructor.call(this),this.params=null,this.getBinValue=function(){var e=this.params,r=0;if("number"==typeof e&&0<=e&&e<=25){for(var n=(r|=1<<e).toString(2),s="",o=n.length-1;o>=0;o--)s+=n[o];return s}if("string"==typeof e&&null!=i[e])return tt([e],i);if("object"==typeof e&&null!=e.length)return tt(e,i);throw new t("wrong params")},this.tohex=function(){this.params;var e=this.getBinValue();return new n({bin:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},nt(he.asn1.tsp.PKIFailureInfo,he.asn1.ASN1Object),he.asn1.tsp.AbstractTSAAdapter=function(e){this.getTSTHex=function(e,t){throw"not implemented yet"}},he.asn1.tsp.SimpleTSAAdapter=function(e){var t=he,r=t.asn1.tsp,n=t.crypto.Util.hashHex;r.SimpleTSAAdapter.superclass.constructor.call(this),this.params=null,this.serial=0,this.getTSTHex=function(e,t){var s=n(e,t);this.params.econtent.content.messageImprint={alg:t,hash:s},this.params.econtent.content.serial={int:this.serial++};var i=Math.floor(1e9*Math.random());return this.params.econtent.content.nonce={int:i},new r.TimeStampToken(this.params).getContentInfoEncodedHex()},void 0!==e&&(this.params=e)},nt(he.asn1.tsp.SimpleTSAAdapter,he.asn1.tsp.AbstractTSAAdapter),he.asn1.tsp.FixedTSAAdapter=function(e){var t=he,r=t.asn1.tsp,n=t.crypto.Util.hashHex;r.FixedTSAAdapter.superclass.constructor.call(this),this.params=null,this.getTSTHex=function(e,t){var s=n(e,t);return this.params.econtent.content.messageImprint={alg:t,hash:s},new r.TimeStampToken(this.params).getContentInfoEncodedHex()},void 0!==e&&(this.params=e)},nt(he.asn1.tsp.FixedTSAAdapter,he.asn1.tsp.AbstractTSAAdapter),he.asn1.tsp.TSPUtil=new function(){},he.asn1.tsp.TSPUtil.newTimeStampToken=function(e){return new he.asn1.tsp.TimeStampToken(e)},he.asn1.tsp.TSPUtil.parseTimeStampReq=function(e){return(new he.asn1.tsp.TSPParser).getTimeStampReq(e)},he.asn1.tsp.TSPUtil.parseMessageImprint=function(e){return(new he.asn1.tsp.TSPParser).getMessageImprint(e)},he.asn1.tsp.TSPParser=function(){Error;var e=new ct,t=de,r=t.getV,n=t.getTLV,s=t.getIdxbyList,i=(t.getTLVbyListEx,t.getChildIdx),o=["granted","grantedWithMods","rejection","waiting","revocationWarning","revocationNotification"],a={0:"badAlg",2:"badRequest",5:"badDataFormat",14:"timeNotAvailable",15:"unacceptedPolicy",16:"unacceptedExtension",17:"addInfoNotAvailable",25:"systemFailure"};this.getResponse=function(e){var t=i(e,0);if(1==t.length)return this.getPKIStatusInfo(n(e,t[0]));if(t.length>1){var r=this.getPKIStatusInfo(n(e,t[0])),s=n(e,t[1]),o=this.getToken(s);return o.statusinfo=r,o}},this.getToken=function(e){var t=(new he.asn1.cms.CMSParser).getCMSSignedData(e);return this.setTSTInfo(t),t},this.setTSTInfo=function(e){var t=e.econtent;if("tstinfo"==t.type){var r=t.content.hex,n=this.getTSTInfo(r);t.content=n}},this.getTSTInfo=function(t){var s={},o=i(t,0),a=r(t,o[1]);s.policy=$e(a);var c=n(t,o[2]);s.messageImprint=this.getMessageImprint(c);var h=r(t,o[3]);s.serial={hex:h};var l=r(t,o[4]);s.genTime={str:xe(l)};var u=0;if(o.length>5&&"30"==t.substr(o[5],2)){var d=n(t,o[5]);s.accuracy=this.getAccuracy(d),u++}if(o.length>5+u&&"01"==t.substr(o[5+u],2)&&("ff"==r(t,o[5+u])&&(s.ordering=!0),u++),o.length>5+u&&"02"==t.substr(o[5+u],2)){var p=r(t,o[5+u]);s.nonce={hex:p},u++}if(o.length>5+u&&"a0"==t.substr(o[5+u],2)){var g=n(t,o[5+u]);g="30"+g.substr(2),pGeneralNames=e.getGeneralNames(g);var m=pGeneralNames[0].dn;s.tsa=m,u++}if(o.length>5+u&&"a1"==t.substr(o[5+u],2)){var f=n(t,o[5+u]);f="30"+f.substr(2);var y=e.getExtParamArray(f);s.ext=y,u++}return s},this.getAccuracy=function(e){for(var t={},n=i(e,0),s=0;s<n.length;s++){var o=e.substr(n[s],2),a=r(e,n[s]),c=parseInt(a,16);"02"==o?t.seconds=c:"80"==o?t.millis=c:"81"==o&&(t.micros=c)}return t},this.getMessageImprint=function(e){if("30"!=e.substr(0,2))throw new Error("head of messageImprint hex shall be x30");var n={},o=(i(e,0),s(e,0,[0,0])),a=r(e,o),c=t.hextooidstr(a),h=he.asn1.x509.OID.oid2name(c);if(""==h)throw new Error("hashAlg name undefined: "+c);var l=h,u=s(e,0,[1]);return n.alg=l,n.hash=r(e,u),n},this.getPKIStatusInfo=function(e){var t={},s=i(e,0),a=0;try{var c=r(e,s[0]),h=parseInt(c,16);t.status=o[h]}catch(e){}if(s.length>1&&"30"==e.substr(s[1],2)){var l=n(e,s[1]);t.statusstr=this.getPKIFreeText(l),a++}if(s.length>a&&"03"==e.substr(s[1+a],2)){var u=n(e,s[1+a]);t.failinfo=this.getPKIFailureInfo(u)}return t},this.getPKIFreeText=function(e){for(var r=[],n=i(e,0),s=0;s<n.length;s++)r.push(t.getString(e,n[s]));return r},this.getPKIFailureInfo=function(e){var r=t.getInt(e,0);return null!=a[r]?a[r]:r},this.getTimeStampReq=function(e){var s={certreq:!1},o=i(e,0);if(o.length<2)throw new Error("TimeStampReq must have at least 2 items");var a=n(e,o[1]);s.messageImprint=he.asn1.tsp.TSPUtil.parseMessageImprint(a);for(var c=2;c<o.length;c++){var h=o[c],l=e.substr(h,2);if("06"==l){var u=r(e,h);s.policy=t.hextooidstr(u)}"02"==l&&(s.nonce=r(e,h)),"01"==l&&(s.certreq=!0)}return s}},void 0!==he&&he||(he={}),void 0!==he.asn1&&he.asn1||(he.asn1={}),void 0!==he.asn1.cades&&he.asn1.cades||(he.asn1.cades={}),he.asn1.cades.SignaturePolicyIdentifier=function(e){var t=he.asn1.cades,r=t.SignaturePolicyId;t.SignaturePolicyIdentifier.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.15",this.params=null,this.getValueArray=function(){return[new r(this.params)]},this.setByParam=function(e){this.params=e},null!=e&&this.setByParam(e)},nt(he.asn1.cades.SignaturePolicyIdentifier,he.asn1.cms.Attribute),he.asn1.cades.SignaturePolicyId=function(e){var t=he.asn1,r=t.DERSequence,n=t.DERObjectIdentifier,s=(t.x509.AlgorithmIdentifier,t.cades),i=s.SignaturePolicyId,o=s.OtherHashAlgAndValue;i.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,t=[];return t.push(new n(e.oid)),t.push(new o(e)),new r({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},null!=e&&this.setByParam(e)},nt(he.asn1.cades.SignaturePolicyId,he.asn1.ASN1Object),he.asn1.cades.OtherHashAlgAndValue=function(e){var t=Error,r=he.asn1,n=r.DERSequence,s=r.DEROctetString,i=r.x509.AlgorithmIdentifier;r.cades.OtherHashAlgAndValue.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;if(null==e.alg)throw new t("property 'alg' not specified");if(null==e.hash&&null==e.cert)throw new t("property 'hash' nor 'cert' not specified");var r=null;if(null!=e.hash)r=e.hash;else if(null!=e.cert){if("string"!=typeof e.cert)throw new t("cert not string");var o=e.cert;-1!=e.cert.indexOf("-----BEGIN")&&(o=Re(e.cert)),r=he.crypto.Util.hashHex(o,e.alg)}var a=[];return a.push(new i({name:e.alg})),a.push(new s({hex:r})),new n({array:a}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},nt(he.asn1.cades.OtherHashAlgAndValue,he.asn1.ASN1Object),he.asn1.cades.OtherHashValue=function(e){he.asn1.cades.OtherHashValue.superclass.constructor.call(this);var t=Error,r=he,n=(r.lang.String.isHex,r.asn1.DEROctetString);r.crypto.Util.hashHex,this.params=null,this.tohex=function(){var e=this.params;if(null==e.hash&&null==e.cert)throw new t("hash or cert not specified");var r=null;if(null!=e.hash)r=e.hash;else if(null!=e.cert){if("string"!=typeof e.cert)throw new t("cert not string");var s=e.cert;-1!=e.cert.indexOf("-----BEGIN")&&(s=Re(e.cert)),r=he.crypto.Util.hashHex(s,"sha1")}return new n({hex:r}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},nt(he.asn1.cades.OtherHashValue,he.asn1.ASN1Object),he.asn1.cades.SignatureTimeStamp=function(e){var t=Error,r=he,n=r.lang.String.isHex,s=r.asn1,i=s.ASN1Object;s.x509,s.cades.SignatureTimeStamp.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.14",this.params=null,this.getValueArray=function(){var e=this.params;if(null!=e.tst){if(n(e.tst))return(r=new i).hTLV=e.tst,[r];if(e.tst instanceof i)return[e.tst];throw new t("params.tst has wrong value")}if(null!=e.res){var r,s=e.res;if(s instanceof i&&(s=s.tohex()),"string"!=typeof s||!n(s))throw new t("params.res has wrong value");return de.getTLVbyList(s,0,[1]),(r=new i).hTLV=e.tst,[r]}},null!=e&&this.setByParam(e)},nt(he.asn1.cades.SignatureTimeStamp,he.asn1.cms.Attribute),he.asn1.cades.CompleteCertificateRefs=function(e){var t=Error,r=he,n=r.asn1,s=n.DERSequence,i=n.cades,o=i.OtherCertID,a=r.lang.String.isHex;i.CompleteCertificateRefs.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.21",this.params=null,this.getValueArray=function(){for(var e=this.params,r=[],n=0;n<e.array.length;n++){var i=e.array[n];if("string"==typeof i)if(-1!=i.indexOf("-----BEGIN"))i={cert:i};else{if(!a(i))throw new t("unsupported value: "+i);i={hash:i}}null!=e.alg&&null==i.alg&&(i.alg=e.alg),null!=e.hasis&&null==i.hasis&&(i.hasis=e.hasis);var c=new o(i);r.push(c)}return[new s({array:r})]},null!=e&&this.setByParam(e)},nt(he.asn1.cades.CompleteCertificateRefs,he.asn1.cms.Attribute),he.asn1.cades.OtherCertID=function(e){var t=he.asn1,r=t.DERSequence,n=t.cms.IssuerSerial,s=t.cades,i=s.OtherHashValue,o=s.OtherHashAlgAndValue;s.OtherCertID.superclass.constructor.call(this),this.params=e,this.tohex=function(){var e=this.params;"string"==typeof e&&(-1!=e.indexOf("-----BEGIN")?e={cert:e}:_isHex(e)&&(e={hash:e}));var t,s=[];if(t=null!=e.alg?new o(e):new i(e),s.push(t),null!=e.cert&&1==e.hasis||null!=e.issuer&&null!=e.serial){var a=new n(e);s.push(a)}return new r({array:s}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},nt(he.asn1.cades.OtherCertID,he.asn1.ASN1Object),he.asn1.cades.OtherHash=function(e){Error;var t=he,r=t.asn1,n=(r.cms,r.cades),s=n.OtherHashAlgAndValue,i=n.OtherHashValue,o=(t.crypto.Util.hashHex,t.lang.String.isHex);n.OtherHash.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;return"string"==typeof e&&(-1!=e.indexOf("-----BEGIN")?e={cert:e}:o(e)&&(e={hash:e})),(null!=e.alg?new s(e):new i(e)).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},nt(he.asn1.cades.OtherHash,he.asn1.ASN1Object),he.asn1.cades.CAdESUtil=new function(){},he.asn1.cades.CAdESUtil.parseSignedDataForAddingUnsigned=function(e){return(new he.asn1.cms.CMSParser).getCMSSignedData(e)},he.asn1.cades.CAdESUtil.parseSignerInfoForAddingUnsigned=function(e,t,r){var n=de,s=n.getChildIdx,i=n.getTLV,o=n.getV,a=he.asn1,c=a.ASN1Object,h=a.cms,l=h.AttributeList,u=h.SignerInfo,d={},p=s(e,t);if(6!=p.length)throw"not supported items for SignerInfo (!=6)";var g=p.shift();d.version=i(e,g);var m=p.shift();d.si=i(e,m);var f=p.shift();d.digalg=i(e,f);var y=p.shift();d.sattrs=i(e,y);var v=p.shift();d.sigalg=i(e,v);var b=p.shift();d.sig=i(e,b),d.sigval=o(e,b);var S=null;return d.obj=new u,(S=new c).hTLV=d.version,d.obj.dCMSVersion=S,(S=new c).hTLV=d.si,d.obj.dSignerIdentifier=S,(S=new c).hTLV=d.digalg,d.obj.dDigestAlgorithm=S,(S=new c).hTLV=d.sattrs,d.obj.dSignedAttrs=S,(S=new c).hTLV=d.sigalg,d.obj.dSigAlg=S,(S=new c).hTLV=d.sig,d.obj.dSig=S,d.obj.dUnsignedAttrs=new l,d},void 0!==he.asn1.csr&&he.asn1.csr||(he.asn1.csr={}),he.asn1.csr.CertificationRequest=function(e){var t=he.asn1,r=t.DERBitString,n=t.DERSequence,s=t.csr,i=(t.x509,s.CertificationRequestInfo);s.CertificationRequest.superclass.constructor.call(this),this.setByParam=function(e){this.params=e},this.sign=function(){var e=new i(this.params).tohex(),t=new he.crypto.Signature({alg:this.params.sigalg});t.init(this.params.sbjprvkey),t.updateHex(e);var r=t.sign();this.params.sighex=r},this.getPEM=function(){return Pe(this.tohex(),"CERTIFICATE REQUEST")},this.tohex=function(){var e=this.params,t=new he.asn1.csr.CertificationRequestInfo(this.params),s=new he.asn1.x509.AlgorithmIdentifier({name:e.sigalg});if(null==e.sighex&&null!=e.sbjprvkey&&this.sign(),null==e.sighex)throw new Error("sighex or sbjprvkey parameter not defined");var i=new r({hex:"00"+e.sighex});return new n({array:[t,s,i]}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},nt(he.asn1.csr.CertificationRequest,he.asn1.ASN1Object),he.asn1.csr.CertificationRequestInfo=function(e){var t=he.asn1,r=(t.DERBitString,t.DERSequence),n=t.DERInteger,s=t.DERUTF8String,i=t.DERTaggedObject,o=t.ASN1Util.newObject,a=t.csr,c=t.x509,h=c.X500Name,l=c.Extensions,u=c.SubjectPublicKeyInfo;a.AttributeList,a.CertificationRequestInfo.superclass.constructor.call(this),this.params=null,this.setByParam=function(e){null!=e&&(this.params=e)},this.tohex=function(){var e=this.params,t=[];if(t.push(new n({int:0})),t.push(new h(e.subject)),t.push(new u(st.getKey(e.sbjpubkey))),null!=e.attrs){var a=function(e){for(var t=Error,r=he.asn1.x509.Extensions,n=[],s=0;s<e.length;s++){var i=e[s],o=i.attr;if("extensionRequest"==o){var a={seq:[{oid:"1.2.840.113549.1.9.14"},{set:[new r(i.ext)]}]};n.push(a)}else if("unstructuredName"==o)a={seq:[{oid:"1.2.840.113549.1.9.2"},{set:i.names}]},n.push(a);else{if("challengePassword"!=o)throw new t("unknown CSR attribute");a={seq:[{oid:"1.2.840.113549.1.9.7"},{set:[{utf8str:i.password}]}]},n.push(a)}}return{set:n}}(e.attrs),c=o({tag:{tage:"a0",obj:a}});t.push(c)}else if(null!=e.extreq){var d=new l(e.extreq);c=o({tag:{tage:"a0",obj:{seq:[{oid:"1.2.840.113549.1.9.14"},{set:[d]}]}}}),t.push(c)}else t.push(new i({tag:"a0",explicit:!1,obj:new s({str:""})}));return new r({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},nt(he.asn1.csr.CertificationRequestInfo,he.asn1.ASN1Object),he.asn1.csr.AttributeList=function(e){},nt(he.asn1.csr.AttributeList,he.asn1.ASN1Object),he.asn1.csr.CSRUtil=new function(){},he.asn1.csr.CSRUtil.newCSRPEM=function(e){return new he.asn1.csr.CertificationRequest(e).getPEM()},he.asn1.csr.CSRUtil.getParam=function(e,t){var r=de,n=r.getV,s=r.getIdxbyList,i=r.getTLVbyList,o=r.getTLVbyListEx,a=r.getVbyListEx,c={};if(-1==e.indexOf("-----BEGIN CERTIFICATE REQUEST"))throw new Error("argument is not PEM file");var h=Re(e,"CERTIFICATE REQUEST");t&&(c.tbs=i(h,0,[0]));try{var l=o(h,0,[0,1]);if("3000"==l)c.subject={};else{var u=new ct;c.subject=u.getX500Name(l)}}catch(e){}var d=o(h,0,[0,2]),p=st.getKey(d,null,"pkcs8pub");c.sbjpubkey=st.getPEM(p,"PKCS8PUB");var g=function(e){var t=s(e,0,[0,3,0,0],"06");return"2a864886f70d01090e"!=n(e,t)?null:i(e,0,[0,3,0,1,0],"30")}(h);u=new ct,null!=g&&(c.extreq=u.getExtParamArray(g));try{var m=o(h,0,[1],"30");u=new ct,c.sigalg=u.getAlgorithmIdentifierName(m)}catch(e){}try{var f=a(h,0,[2]);c.sighex=f}catch(e){}return c},he.asn1.csr.CSRUtil.verifySignature=function(e){try{var t=null;if("string"==typeof e&&-1!=e.indexOf("-----BEGIN CERTIFICATE REQUEST")?t=he.asn1.csr.CSRUtil.getParam(e,!0):"object"==typeof e&&null!=e.sbjpubkey&&null!=e.sigalg&&null!=e.sighex&&null!=e.tbs&&(t=e),null==t)return!1;var r=new he.crypto.Signature({alg:t.sigalg});return r.init(t.sbjpubkey),r.updateHex(t.tbs),r.verify(t.sighex)}catch(e){return alert(e),!1}},void 0!==he&&he||(he={}),void 0!==he.asn1&&he.asn1||(he.asn1={}),void 0!==he.asn1.ocsp&&he.asn1.ocsp||(he.asn1.ocsp={}),he.asn1.ocsp.DEFAULT_HASH="sha1",he.asn1.ocsp.OCSPResponse=function(e){he.asn1.ocsp.OCSPResponse.superclass.constructor.call(this),he.asn1.DEREnumerated;var t=he.asn1.ASN1Util.newObject,r=he.asn1.ocsp.ResponseBytes,n=["successful","malformedRequest","internalError","tryLater","_not_used_","sigRequired","unauthorized"];this.params=null,this._getStatusCode=function(){var e=this.params.resstatus;return"number"==typeof e?e:"string"!=typeof e?-1:n.indexOf(e)},this.setByParam=function(e){this.params=e},this.tohex=function(){var e=this.params,n=this._getStatusCode();if(-1==n)throw new Error("responseStatus not supported: "+e.resstatus);if(0!=n)return t({seq:[{enum:{int:n}}]}).tohex();var s=new r(e);return t({seq:[{enum:{int:0}},{tag:{tag:"a0",explicit:!0,obj:s}}]}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},nt(he.asn1.ocsp.OCSPResponse,he.asn1.ASN1Object),he.asn1.ocsp.ResponseBytes=function(e){he.asn1.ocsp.ResponseBytes.superclass.constructor.call(this);var t=he.asn1,r=t.DERSequence,n=t.DERObjectIdentifier,s=t.DEROctetString,i=t.ocsp.BasicOCSPResponse;this.params=null,this.setByParam=function(e){this.params=e},this.tohex=function(){var e=this.params;if("ocspBasic"!=e.restype)throw new Error("not supported responseType: "+e.restype);var t=new i(e),o=[];return o.push(new n({name:"ocspBasic"})),o.push(new s({hex:t.tohex()})),new r({array:o}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},nt(he.asn1.ocsp.ResponseBytes,he.asn1.ASN1Object),he.asn1.ocsp.BasicOCSPResponse=function(e){he.asn1.ocsp.BasicOCSPResponse.superclass.constructor.call(this);var t=Error,r=he.asn1,n=r.ASN1Object,s=r.DERSequence,i=(r.DERGeneralizedTime,r.DERTaggedObject),o=r.DERBitString,a=(r.x509.Extensions,r.x509.AlgorithmIdentifier),c=r.ocsp;c.ResponderID,_SingleResponseList=c.SingleResponseList,_ResponseData=c.ResponseData,this.params=null,this.setByParam=function(e){this.params=e},this.sign=function(){var e=this.params,t=e.tbsresp.tohex(),r=new he.crypto.Signature({alg:e.sigalg});r.init(e.reskey),r.updateHex(t),e.sighex=r.sign()},this.tohex=function(){var e=this.params;null==e.tbsresp&&(e.tbsresp=new _ResponseData(e)),null==e.sighex&&null!=e.reskey&&this.sign();var r=[];if(r.push(e.tbsresp),r.push(new a({name:e.sigalg})),r.push(new o({hex:"00"+e.sighex})),null!=e.certs&&null!=e.certs.length){for(var c=[],h=0;h<e.certs.length;h++){var l=e.certs[h],u=null;if(de.isASN1HEX(l))u=l;else{if(!l.match(/-----BEGIN/))throw new t("certs["+h+"] not hex or PEM");u=Re(l)}c.push(new n({tlv:u}))}var d=new s({array:c});r.push(new i({tag:"a0",explicit:!0,obj:d}))}return new s({array:r}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},nt(he.asn1.ocsp.BasicOCSPResponse,he.asn1.ASN1Object),he.asn1.ocsp.ResponseData=function(e){he.asn1.ocsp.ResponseData.superclass.constructor.call(this);var t=Error,r=he.asn1,n=r.DERSequence,s=r.DERGeneralizedTime,i=r.DERTaggedObject,o=r.x509.Extensions,a=r.ocsp,c=a.ResponderID;_SingleResponseList=a.SingleResponseList,this.params=null,this.tohex=function(){var e=this.params;null!=e.respid&&new t("respid not specified"),null!=e.prodat&&new t("prodat not specified"),null!=e.array&&new t("array not specified");var r=[];if(r.push(new c(e.respid)),r.push(new s(e.prodat)),r.push(new _SingleResponseList(e.array)),null!=e.ext){var a=new o(e.ext);r.push(new i({tag:"a1",explicit:!0,obj:a}))}return new n({array:r}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},void 0!==e&&this.setByParam(e)},nt(he.asn1.ocsp.ResponseData,he.asn1.ASN1Object),he.asn1.ocsp.ResponderID=function(e){he.asn1.ocsp.ResponderID.superclass.constructor.call(this);var t=he,r=t.asn1,n=r.ASN1Util.newObject,s=r.x509.X500Name,i=t.lang.String.isHex,o=Error;this.params=null,this.tohex=function(){var e=this.params;if(null!=e.key){var t,r=null;if("string"==typeof e.key?(i(e.key)&&(r=e.key),e.key.match(/-----BEGIN CERTIFICATE/)&&null!=(t=new ct(e.key).getExtSubjectKeyIdentifier())&&(r=t.kid.hex)):e.key instanceof ct&&null!=(t=e.key.getExtSubjectKeyIdentifier())&&(r=t.kid.hex),null==r)throw new o("wrong key member value");return n({tag:{tag:"a2",explicit:!0,obj:{octstr:{hex:r}}}}).tohex()}if(null!=e.name){var a=null;if("string"==typeof e.name&&e.name.match(/-----BEGIN CERTIFICATE/)?a=new ct(e.name).getSubject():e.name instanceof ct?a=e.name.getSubject():"object"!=typeof e.name||null==e.name.array&&null==e.name.str||(a=e.name),null==a)throw new o("wrong name member value");return n({tag:{tag:"a1",explicit:!0,obj:new s(a)}}).tohex()}throw new o("key or name not specified")},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},void 0!==e&&this.setByParam(e)},nt(he.asn1.ocsp.ResponderID,he.asn1.ASN1Object),he.asn1.ocsp.SingleResponseList=function(e){he.asn1.ocsp.SingleResponseList.superclass.constructor.call(this);var t=he.asn1,r=t.DERSequence,n=t.ocsp.SingleResponse;this.params=null,this.tohex=function(){var e=this.params;if("object"!=typeof e||null==e.length)throw new Error("params not specified properly");for(var t=[],s=0;s<e.length;s++)t.push(new n(e[s]));return new r({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},void 0!==e&&this.setByParam(e)},nt(he.asn1.ocsp.SingleResponseList,he.asn1.ASN1Object),he.asn1.ocsp.SingleResponse=function(e){var t=Error,r=he.asn1,n=r.DERSequence,s=r.DERGeneralizedTime,i=r.DERTaggedObject,o=r.ocsp,a=o.CertID,c=o.CertStatus,h=r.x509.Extensions;o.SingleResponse.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,r=[];if(null==e.certid)throw new t("certid unspecified");if(null==e.status)throw new t("status unspecified");if(null==e.thisupdate)throw new t("thisupdate unspecified");if(r.push(new a(e.certid)),r.push(new c(e.status)),r.push(new s(e.thisupdate)),null!=e.nextupdate){var o=new s(e.nextupdate);r.push(new i({tag:"a0",explicit:!0,obj:o}))}if(null!=e.ext){var l=new h(e.ext);r.push(new i({tag:"a1",explicit:!0,obj:l}))}return new n({array:r}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},void 0!==e&&this.setByParam(e)},nt(he.asn1.ocsp.SingleResponse,he.asn1.ASN1Object),he.asn1.ocsp.CertID=function(e){var t=he,r=t.asn1,n=r.DEROctetString,s=r.DERInteger,i=r.DERSequence,o=r.x509.AlgorithmIdentifier,a=r.ocsp,c=(a.DEFAULT_HASH,t.crypto.Util.hashHex),h=ct,l=de.getVbyList;a.CertID.superclass.constructor.call(this),this.DEFAULT_HASH="sha1",this.params=null,this.setByValue=function(e,t,r,n){null==n&&(n=this.DEFAULT_HASH),this.params={alg:n,issname:e,isskey:t,sbjsn:r}},this.setByCert=function(e,t,r){null==r&&(r=this.DEFAULT_HASH),this.params={alg:r,issuerCert:e,subjectCert:t}},this.getParamByCerts=function(e,t,r){null==r&&(r=this.DEFAULT_HASH);var n=new h(e),s=new h(t),i=c(n.getSubjectHex(),r),o=n.getPublicKeyHex();return{alg:r,issname:i,isskey:c(l(o,0,[1],"03",!0),r),sbjsn:s.getSerialNumberHex()}},this.tohex=function(){if("object"!=typeof this.params)throw new Error("params not set");var e,t,r,a,c=this.params;if(a=null==c.alg?this.DEFAULT_HASH:c.alg,null!=c.issuerCert&&null!=c.subjectCert){var h=this.getParamByCerts(c.issuerCert,c.subjectCert,a);e=h.issname,t=h.isskey,r=h.sbjsn}else{if(null==c.issname||null==c.isskey||null==c.sbjsn)throw new Error("required param members not defined");e=c.issname,t=c.isskey,r=c.sbjsn}var l=new o({name:a}),u=new n({hex:e}),d=new n({hex:t}),p=new s({hex:r}),g=new i({array:[l,u,d,p]});return this.hTLV=g.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},nt(he.asn1.ocsp.CertID,he.asn1.ASN1Object),he.asn1.ocsp.CertStatus=function(e){he.asn1.ocsp.CertStatus.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;if("good"==e.status)return"8000";if("unknown"==e.status)return"8200";if("revoked"==e.status){var t=[{gentime:{str:e.time}}];null!=e.reason&&t.push({tag:{tag:"a0",explicit:!0,obj:{enum:{int:e.reason}}}});var r={tag:"a1",explicit:!1,obj:{seq:t}};return he.asn1.ASN1Util.newObject({tag:r}).tohex()}throw new Error("bad status")},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},void 0!==e&&this.setByParam(e)},nt(he.asn1.ocsp.CertStatus,he.asn1.ASN1Object),he.asn1.ocsp.Request=function(e){var t=he.asn1,r=t.DERSequence,n=t.ocsp;if(n.Request.superclass.constructor.call(this),this.dReqCert=null,this.dExt=null,this.tohex=function(){var e=[];if(null===this.dReqCert)throw"reqCert not set";e.push(this.dReqCert);var t=new r({array:e});return this.hTLV=t.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e){var s=new n.CertID(e);this.dReqCert=s}},nt(he.asn1.ocsp.Request,he.asn1.ASN1Object),he.asn1.ocsp.TBSRequest=function(e){var t=he.asn1,r=t.DERSequence,n=t.ocsp;n.TBSRequest.superclass.constructor.call(this),this.version=0,this.dRequestorName=null,this.dRequestList=[],this.dRequestExt=null,this.setRequestListByParam=function(e){for(var t=[],r=0;r<e.length;r++){var s=new n.Request(e[0]);t.push(s)}this.dRequestList=t},this.tohex=function(){var e=[];if(0!==this.version)throw"not supported version: "+this.version;if(null!==this.dRequestorName)throw"requestorName not supported";var t=new r({array:this.dRequestList});if(e.push(t),null!==this.dRequestExt)throw"requestExtensions not supported";var n=new r({array:e});return this.hTLV=n.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&void 0!==e.reqList&&this.setRequestListByParam(e.reqList)},nt(he.asn1.ocsp.TBSRequest,he.asn1.ASN1Object),he.asn1.ocsp.OCSPRequest=function(e){var t=he.asn1,r=t.DERSequence,n=t.ocsp;if(n.OCSPRequest.superclass.constructor.call(this),this.dTbsRequest=null,this.dOptionalSignature=null,this.tohex=function(){var e=[];if(null===this.dTbsRequest)throw"tbsRequest not set";if(e.push(this.dTbsRequest),null!==this.dOptionalSignature)throw"optionalSignature not supported";var t=new r({array:e});return this.hTLV=t.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&void 0!==e.reqList){var s=new n.TBSRequest(e);this.dTbsRequest=s}},nt(he.asn1.ocsp.OCSPRequest,he.asn1.ASN1Object),he.asn1.ocsp.OCSPUtil={},he.asn1.ocsp.OCSPUtil.getRequestHex=function(e,t,r){var n=he.asn1.ocsp;void 0===r&&(r=n.DEFAULT_HASH);var s={alg:r,issuerCert:e,subjectCert:t};return new n.OCSPRequest({reqList:[s]}).tohex()},he.asn1.ocsp.OCSPUtil.getOCSPResponseInfo=function(e){var t=de,r=t.getVbyList,n=t.getVbyListEx,s=t.getIdxbyList,i=(t.getIdxbyListEx,t.getV),o={};try{var a=n(e,0,[0],"0a");o.responseStatus=parseInt(a,16)}catch(e){}if(0!==o.responseStatus)return o;try{var c=s(e,0,[1,0,1,0,0,2,0,1]);"80"===e.substr(c,2)?o.certStatus="good":"a1"===e.substr(c,2)?(o.certStatus="revoked",o.revocationTime=xe(r(e,c,[0]))):"82"===e.substr(c,2)&&(o.certStatus="unknown")}catch(e){}try{var h=s(e,0,[1,0,1,0,0,2,0,2]);o.thisUpdate=xe(i(e,h))}catch(e){}try{var l=s(e,0,[1,0,1,0,0,2,0,3]);"a0"===e.substr(l,2)&&(o.nextUpdate=xe(r(e,l,[0])))}catch(e){}return o},he.asn1.ocsp.OCSPParser=function(){var e=Error,t=ct,r=new t,n=de,s=n.getV,i=n.getTLV,o=n.getIdxbyList,a=n.getVbyList,c=n.getTLVbyList,h=n.getVbyListEx,l=n.getTLVbyListEx,u=n.getChildIdx;this.getOCSPRequest=function(t){var r=u(t,0);if(1!=r.length&&2!=r.length)throw new e("wrong number elements: "+r.length);return this.getTBSRequest(i(t,r[0]))},this.getTBSRequest=function(e){var t={},n=l(e,0,[0],"30");t.array=this.getRequestList(n);var s=l(e,0,["[2]",0],"30");return null!=s&&(t.ext=r.getExtParamArray(s)),t},this.getRequestList=function(e){for(var t=[],r=u(e,0),n=0;n<r.length;n++)e=i(e,r[n]),t.push(this.getRequest(e));return t},this.getRequest=function(t){var n=u(t,0);if(1!=n.length&&2!=n.length)throw new e("wrong number elements: "+n.length);var s=this.getCertID(i(t,n[0]));if(2==n.length){var a=o(t,0,[1,0]);s.ext=r.getExtParamArray(i(t,a))}return s},this.getCertID=function(r){var n=u(r,0);if(4!=n.length)throw new e("wrong number elements: "+n.length);var o=new t,a={};return a.alg=o.getAlgorithmIdentifierName(i(r,n[0])),a.issname=s(r,n[1]),a.isskey=s(r,n[2]),a.sbjsn=s(r,n[3]),a},this.getOCSPResponse=function(e){var t,r=u(e,0),n=s(e,r[0]),i=parseInt(n);if(1==r.length)return{resstatus:i};var o=c(e,0,[1,0]);return(t=this.getResponseBytes(o)).resstatus=i,t},this.getResponseBytes=function(e){var t,r=u(e,0),n=c(e,0,[1,0]);t=this.getBasicOCSPResponse(n);var i=s(e,r[0]);return t.restype=he.asn1.x509.OID.oid2name($e(i)),t},this.getBasicOCSPResponse=function(e){var t,r=u(e,0);t=this.getResponseData(i(e,r[0]));var n=new ct;t.alg=n.getAlgorithmIdentifierName(i(e,r[1]));var o=s(e,r[2]);t.sighex=o.substr(2);var a=h(e,0,["[0]"]);if(null!=a){for(var c=u(a,0),l=[],d=0;d<c.length;d++){var p=i(a,c[d]);l.push(p)}t.certs=l}return t},this.getResponseData=function(e){var t=u(e,0),r=t.length,n={},o=0;"a0"==e.substr(t[0],2)&&o++,n.respid=this.getResponderID(i(e,t[o++]));var a=s(e,t[o++]);if(n.prodat=xe(a),n.array=this.getSingleResponseList(i(e,t[o++])),"a1"==e.substr(t[r-1],2)){var h=c(e,t[r-1],[0]),l=new ct;n.ext=l.getExtParamArray(h)}return n},this.getResponderID=function(e){var t={};if("a2"==e.substr(0,2)){var r=a(e,0,[0]);t.key=r}if("a1"==e.substr(0,2)){var n=c(e,0,[0]),s=new ct;t.name=s.getX500Name(n)}return t},this.getSingleResponseList=function(e){for(var t=u(e,0),r=[],n=0;n<t.length;n++){var s=this.getSingleResponse(i(e,t[n]));r.push(s)}return r},this.getSingleResponse=function(e){var t=u(e,0),r={},n=this.getCertID(i(e,t[0]));r.certid=n;var o=this.getCertStatus(i(e,t[1]));if(r.status=o,"18"==e.substr(t[2],2)){var h=s(e,t[2]);r.thisupdate=xe(h)}for(var l=3;l<t.length;l++){if("a0"==e.substr(t[l],2)){var d=a(e,t[l],[0],"18");r.nextupdate=xe(d)}if("a1"==e.substr(t[l],2)){var p=new ct,g=c(e,0,[l,0]);r.ext=p.getExtParamArray(g)}}return r},this.getCertStatus=function(e){var t={};if("8000"==e)return{status:"good"};if("8200"==e)return{status:"unknown"};if("a1"==e.substr(0,2)){t.status="revoked";var r=xe(a(e,0,[0]));t.time=r}return t}},void 0!==he&&he||(he={}),void 0!==he.lang&&he.lang||(he.lang={}),he.lang.String=function(){},"function"==typeof Buffer?(le=function(e){return ye(Buffer.from(e,"utf8").toString("base64"))},ue=function(e){return Buffer.from(ve(e),"base64").toString("utf8")}):(le=function(e){return be(De(ze(e)))},ue=function(e){return decodeURIComponent(Me(Se(e)))}),he.lang.String.isInteger=function(e){return!!e.match(/^[0-9]+$/)||!!e.match(/^-[0-9]+$/)},he.lang.String.isHex=function(e){return Ve(e)},he.lang.String.isBase64=function(e){return!(!(e=e.replace(/\s+/g,"")).match(/^[0-9A-Za-z+\/]+={0,3}$/)||e.length%4!=0)},he.lang.String.isBase64URL=function(e){return!e.match(/[+/=]/)&&(e=ve(e),he.lang.String.isBase64(e))},he.lang.String.isIntegerArray=function(e){return!!(e=e.replace(/\s+/g,"")).match(/^\[[0-9,]+\]$/)},he.lang.String.isPrintable=function(e){return null!==e.match(/^[0-9A-Za-z '()+,-./:=?]*$/)},he.lang.String.isIA5=function(e){return null!==e.match(/^[\x20-\x21\x23-\x7f]*$/)},he.lang.String.isMail=function(e){return null!==e.match(/^[A-Za-z0-9]{1}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-]{1,}\.[A-Za-z0-9]{1,}$/)};var Qe=function(e,t,r){return null==r&&(r="0"),e.length>=t?e:new Array(t-e.length+1).join(r)+e};function Ze(e){if(e.length%2!=0)return-1;if(null==(e=e.toLowerCase()).match(/^[0-9a-f]+$/))return-1;try{var t=e.substr(0,2);if("00"==t)return parseInt(e.substr(2),16);var r=parseInt(t,16);if(r>7)return-1;var n=e.substr(2),s=parseInt(n,16).toString(2);"0"==s&&(s="00000000"),s=s.slice(0,0-r);var i=parseInt(s,2);return NaN==i?-1:i}catch(e){return-1}}function Ye(e){if("number"!=typeof e)return null;if(e<0)return null;var t=Number(e).toString(2),r=8-t.length%8;8==r&&(r=0),t+=Qe("",r,"0");var n=parseInt(t,2).toString(16);return n.length%2==1&&(n="0"+n),"0"+r+n}function et(e){if("string"!=typeof e)return null;if(e.length%2!=0)return null;if(!e.match(/^[0-9a-f]+$/))return null;try{var t=parseInt(e.substr(0,2),16);if(t<0||7<t)return null;for(var r=e.substr(2),n="",s=0;s<r.length;s+=2){var i=r.substr(s,2),o=parseInt(i,16).toString(2);n+=o=("0000000"+o).slice(-8)}return n.substr(0,n.length-t)}catch(e){return null}}function tt(e,t){for(var r=0,n=0;n<e.length;n++)r|=1<<t[e[n]];var s=r.toString(2),i="";for(n=s.length-1;n>=0;n--)i+=s[n];return i}function rt(e,t,r){if("object"==typeof e){t=String(t).split(".");for(var n=0;n<t.length&&e;n++){var s=t[n];s.match(/^[0-9]+$/)&&(s=parseInt(s)),e=e[s]}return e||!1===e?e:r}}function nt(e,t){var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.superclass=t.prototype,t.prototype.constructor==Object.prototype.constructor&&(t.prototype.constructor=t)}void 0!==he&&he||(he={}),void 0!==he.crypto&&he.crypto||(he.crypto={}),he.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHAwithRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:p.algo.MD5,sha1:p.algo.SHA1,sha224:p.algo.SHA224,sha256:p.algo.SHA256,sha384:p.algo.SHA384,sha512:p.algo.SHA512,ripemd160:p.algo.RIPEMD160},this.getDigestInfoHex=function(e,t){if(void 0===this.DIGESTINFOHEAD[t])throw"alg not supported in Util.DIGESTINFOHEAD: "+t;return this.DIGESTINFOHEAD[t]+e},this.getPaddedDigestInfoHex=function(e,t,r){var n=this.getDigestInfoHex(e,t),s=r/4;if(n.length+22>s)throw"key is too short for SigAlg: keylen="+r+","+t;for(var i="00"+n,o="",a=s-4-i.length,c=0;c<a;c+=2)o+="ff";return"0001"+o+i},this.hashString=function(e,t){return new he.crypto.MessageDigest({alg:t}).digestString(e)},this.hashHex=function(e,t){return new he.crypto.MessageDigest({alg:t}).digestHex(e)},this.sha1=function(e){return this.hashString(e,"sha1")},this.sha256=function(e){return this.hashString(e,"sha256")},this.sha256Hex=function(e){return this.hashHex(e,"sha256")},this.sha512=function(e){return this.hashString(e,"sha512")},this.sha512Hex=function(e){return this.hashHex(e,"sha512")},this.isKey=function(e){return e instanceof ne||e instanceof he.crypto.DSA||e instanceof he.crypto.ECDSA}},he.crypto.Util.md5=function(e){return new he.crypto.MessageDigest({alg:"md5",prov:"cryptojs"}).digestString(e)},he.crypto.Util.ripemd160=function(e){return new he.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"}).digestString(e)},he.crypto.Util.SECURERANDOMGEN=new ee,he.crypto.Util.getRandomHexOfNbytes=function(e){var t=new Array(e);return he.crypto.Util.SECURERANDOMGEN.nextBytes(t),me(t)},he.crypto.Util.getRandomBigIntegerOfNbytes=function(e){return new S(he.crypto.Util.getRandomHexOfNbytes(e),16)},he.crypto.Util.getRandomHexOfNbits=function(e){var t=e%8,r=new Array((e-t)/8+1);return he.crypto.Util.SECURERANDOMGEN.nextBytes(r),r[0]=(255<<t&255^255)&r[0],me(r)},he.crypto.Util.getRandomBigIntegerOfNbits=function(e){return new S(he.crypto.Util.getRandomHexOfNbits(e),16)},he.crypto.Util.getRandomBigIntegerZeroToMax=function(e){for(var t=e.bitLength();;){var r=he.crypto.Util.getRandomBigIntegerOfNbits(t);if(-1!=e.compareTo(r))return r}},he.crypto.Util.getRandomBigIntegerMinToMax=function(e,t){var r=e.compareTo(t);if(1==r)throw"biMin is greater than biMax";if(0==r)return e;var n=t.subtract(e);return he.crypto.Util.getRandomBigIntegerZeroToMax(n).add(e)},he.crypto.MessageDigest=function(e){this.setAlgAndProvider=function(e,t){if(null!==(e=he.crypto.MessageDigest.getCanonicalAlgName(e))&&void 0===t&&(t=he.crypto.Util.DEFAULTPROVIDER[e]),-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(e)&&"cryptojs"==t){try{this.md=he.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[e].create()}catch(t){throw"setAlgAndProvider hash alg set fail alg="+e+"/"+t}this.updateString=function(e){this.md.update(e)},this.updateHex=function(e){var t=p.enc.Hex.parse(e);this.md.update(t)},this.digest=function(){return this.md.finalize().toString(p.enc.Hex)},this.digestString=function(e){return this.updateString(e),this.digest()},this.digestHex=function(e){return this.updateHex(e),this.digest()}}if(-1!=":sha256:".indexOf(e)&&"sjcl"==t){try{this.md=new sjcl.hash.sha256}catch(t){throw"setAlgAndProvider hash alg set fail alg="+e+"/"+t}this.updateString=function(e){this.md.update(e)},this.updateHex=function(e){var t=sjcl.codec.hex.toBits(e);this.md.update(t)},this.digest=function(){var e=this.md.finalize();return sjcl.codec.hex.fromBits(e)},this.digestString=function(e){return this.updateString(e),this.digest()},this.digestHex=function(e){return this.updateHex(e),this.digest()}}},this.updateString=function(e){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(e){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(e){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(e){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},void 0!==e&&void 0!==e.alg&&(this.algName=e.alg,void 0===e.prov&&(this.provName=he.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},he.crypto.MessageDigest.getCanonicalAlgName=function(e){return"string"==typeof e&&(e=(e=e.toLowerCase()).replace(/-/,"")),e},he.crypto.MessageDigest.getHashLength=function(e){var t=he.crypto.MessageDigest,r=t.getCanonicalAlgName(e);if(void 0===t.HASHLENGTH[r])throw"not supported algorithm: "+e;return t.HASHLENGTH[r]},he.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20},he.crypto.Mac=function(e){this.setAlgAndProvider=function(e,t){if(null==(e=e.toLowerCase())&&(e="hmacsha1"),"hmac"!=(e=e.toLowerCase()).substr(0,4))throw"setAlgAndProvider unsupported HMAC alg: "+e;void 0===t&&(t=he.crypto.Util.DEFAULTPROVIDER[e]),this.algProv=e+"/"+t;var r=e.substr(4);if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(r)&&"cryptojs"==t){try{var n=he.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[r];this.mac=p.algo.HMAC.create(n,this.pass)}catch(e){throw"setAlgAndProvider hash alg set fail hashAlg="+r+"/"+e}this.updateString=function(e){this.mac.update(e)},this.updateHex=function(e){var t=p.enc.Hex.parse(e);this.mac.update(t)},this.doFinal=function(){return this.mac.finalize().toString(p.enc.Hex)},this.doFinalString=function(e){return this.updateString(e),this.doFinal()},this.doFinalHex=function(e){return this.updateHex(e),this.doFinal()}}},this.updateString=function(e){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(e){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(e){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(e){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(e){if("string"==typeof e){var t=e;return e.length%2!=1&&e.match(/^[0-9A-Fa-f]+$/)||(t=Ae(e)),void(this.pass=p.enc.Hex.parse(t))}if("object"!=typeof e)throw"KJUR.crypto.Mac unsupported password type: "+e;if(t=null,void 0!==e.hex){if(e.hex.length%2!=0||!e.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+e.hex;t=e.hex}if(void 0!==e.utf8&&(t=we(e.utf8)),void 0!==e.rstr&&(t=Ae(e.rstr)),void 0!==e.b64&&(t=v(e.b64)),void 0!==e.b64u&&(t=Se(e.b64u)),null==t)throw"KJUR.crypto.Mac unsupported password type: "+e;this.pass=p.enc.Hex.parse(t)},void 0!==e&&(void 0!==e.pass&&this.setPassword(e.pass),void 0!==e.alg&&(this.algName=e.alg,void 0===e.prov&&(this.provName=he.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},he.crypto.Signature=function(e){var t=null;if(this._setAlgNames=function(){var e=this.algName.match(/^(.+)with(.+)$/);e&&(this.mdAlgName=e[1].toLowerCase(),this.pubkeyAlgName=e[2].toLowerCase(),"rsaandmgf1"==this.pubkeyAlgName&&"sha"==this.mdAlgName&&(this.mdAlgName="sha1"))},this._zeroPaddingOfSignature=function(e,t){for(var r="",n=t/4-e.length,s=0;s<n;s++)r+="0";return r+e},this.setAlgAndProvider=function(e,t){if(this._setAlgNames(),"cryptojs/jsrsa"!=t)throw new Error("provider not supported: "+t);if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)){try{this.md=new he.crypto.MessageDigest({alg:this.mdAlgName})}catch(e){throw new Error("setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+e)}this.init=function(e,t){var r=null;try{r=void 0===t?st.getKey(e):st.getKey(e,t)}catch(e){throw"init failed:"+e}if(!0===r.isPrivate)this.prvKey=r,this.state="SIGN";else{if(!0!==r.isPublic)throw"init failed.:"+r;this.pubKey=r,this.state="VERIFY"}},this.updateString=function(e){this.md.updateString(e)},this.updateHex=function(e){this.md.updateHex(e)},this.sign=function(){if(this.sHashHex=this.md.digest(),void 0===this.prvKey&&void 0!==this.ecprvhex&&void 0!==this.eccurvename&&void 0!==he.crypto.ECDSA&&(this.prvKey=new he.crypto.ECDSA({curve:this.eccurvename,prv:this.ecprvhex})),this.prvKey instanceof ne&&"rsaandmgf1"===this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof ne&&"rsa"===this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof he.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else{if(!(this.prvKey instanceof he.crypto.DSA))throw"Signature: unsupported private key alg: "+this.pubkeyAlgName;this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}return this.hSign},this.signString=function(e){return this.updateString(e),this.sign()},this.signHex=function(e){return this.updateHex(e),this.sign()},this.verify=function(e){if(this.sHashHex=this.md.digest(),void 0===this.pubKey&&void 0!==this.ecpubhex&&void 0!==this.eccurvename&&void 0!==he.crypto.ECDSA&&(this.pubKey=new he.crypto.ECDSA({curve:this.eccurvename,pub:this.ecpubhex})),this.pubKey instanceof ne&&"rsaandmgf1"===this.pubkeyAlgName)return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,e,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof ne&&"rsa"===this.pubkeyAlgName)return this.pubKey.verifyWithMessageHash(this.sHashHex,e);if(void 0!==he.crypto.ECDSA&&this.pubKey instanceof he.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,e);if(void 0!==he.crypto.DSA&&this.pubKey instanceof he.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,e);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(e,t){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.updateString=function(e){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(e){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(e){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(e){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(e){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=e,void 0!==e&&(void 0!==e.alg&&(this.algName=e.alg,void 0===e.prov?this.provName=he.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=e.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),void 0!==e.psssaltlen&&(this.pssSaltLen=e.psssaltlen),void 0!==e.prvkeypem)){if(void 0!==e.prvkeypas)throw"both prvkeypem and prvkeypas parameters not supported";try{t=st.getKey(e.prvkeypem),this.init(t)}catch(e){throw"fatal error to load pem private key: "+e}}},he.crypto.Cipher=function(e){},he.crypto.Cipher.encrypt=function(e,t,r,n){if(null!=rt(n,"enclag")&&(r=n.encalg),"string"==typeof r&&"-CBC"==r.substr(-4)){var s=t,i=e;null!=rt(n,"key")&&(s=n.key),null!=rt(n,"enc")&&(hEnc=n.enc);var o,a=p.enc.Hex.parse(s),c=p.enc.Hex.parse(i),h=p.enc.Hex.parse(n.iv);if("des-EDE3-CBC"==r)o=p.TripleDES.encrypt(c,a,{iv:h});else{if("aes128-CBC"!=r&&"aes256-CBC"!=r)throw new Error("unsupported algorithm: "+r);o=p.AES.encrypt(c,a,{iv:h})}return o+""}if(t instanceof ne&&t.isPublic){var l=he.crypto.Cipher.getAlgByKeyAndName(t,r);if("RSA"===l)return t.encrypt(e);if("RSAOAEP"===l)return t.encryptOAEP(e,"sha1");var u=l.match(/^RSAOAEP(\d+)$/);if(null!==u)return t.encryptOAEP(e,"sha"+u[1]);throw"Cipher.encrypt: unsupported algorithm for RSAKey: "+r}throw"Cipher.encrypt: unsupported key or algorithm"},he.crypto.Cipher.decrypt=function(e,t,r,n){if(null!=rt(n,"enclag")&&(r=n.encalg),"string"==typeof r&&"-CBC"==r.substr(-4)){var s=t,i=e;null!=rt(n,"key")&&(s=n.key),null!=rt(n,"enc")&&(i=n.enc);var o,a=p.enc.Hex.parse(s),c=p.enc.Hex.parse(i),h=p.enc.Hex.parse(n.iv);if("des-EDE3-CBC"==r)o=p.TripleDES.decrypt({ciphertext:c},a,{iv:h});else{if("aes128-CBC"!=r&&"aes256-CBC"!=r)throw new Error("unsupported algorithm: "+r);o=p.AES.decrypt({ciphertext:c},a,{iv:h})}return p.enc.Hex.stringify(o)}if(t instanceof ne&&t.isPrivate){var l=he.crypto.Cipher.getAlgByKeyAndName(t,r);if("RSA"===l)return t.decrypt(e);if("RSAOAEP"===l)return t.decryptOAEP(e,"sha1");var u=l.match(/^RSAOAEP(\d+)$/);if(null!==u)return t.decryptOAEP(e,"sha"+u[1]);throw"Cipher.decrypt: unsupported algorithm for RSAKey: "+r}throw"Cipher.decrypt: unsupported key or algorithm"},he.crypto.Cipher.getAlgByKeyAndName=function(e,t){if(e instanceof ne){if(-1!=":RSA:RSAOAEP:RSAOAEP224:RSAOAEP256:RSAOAEP384:RSAOAEP512:".indexOf(t))return t;if(null==t)return"RSA";throw"getAlgByKeyAndName: not supported algorithm name for RSAKey: "+t}throw"getAlgByKeyAndName: not supported algorithm name: "+t},he.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040022":"secp384r1","2b81040023":"secp521r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}},void 0!==he&&he||(he={}),void 0!==he.crypto&&he.crypto||(he.crypto={}),he.crypto.ECDSA=function(e){var t=Error,r=S,n=oe,s=he.crypto.ECDSA,i=he.crypto.ECParameterDB,o=s.getName,a=de,c=a.getVbyListEx,h=a.isASN1HEX,l=new ee;this.type="EC",this.isPrivate=!1,this.isPublic=!1,this.getBigRandom=function(e){return new r(e.bitLength(),l).mod(e.subtract(r.ONE)).add(r.ONE)},this.setNamedCurve=function(e){this.ecparams=i.getByName(e),this.prvKeyHex=null,this.pubKeyHex=null,this.curveName=e},this.setPrivateKeyHex=function(e){this.isPrivate=!0,this.prvKeyHex=e},this.setPublicKeyHex=function(e){this.isPublic=!0,this.pubKeyHex=e},this.getPublicKeyXYHex=function(){var e=this.pubKeyHex;if("04"!==e.substr(0,2))throw"this method supports uncompressed format(04) only";var t=this.ecparams.keycharlen;if(e.length!==2+2*t)throw"malformed public key hex length";var r={};return r.x=e.substr(2,t),r.y=e.substr(2+t),r},this.getShortNISTPCurveName=function(){var e=this.curveName;return"secp256r1"===e||"NIST P-256"===e||"P-256"===e||"prime256v1"===e?"P-256":"secp384r1"===e||"NIST P-384"===e||"P-384"===e?"P-384":"secp521r1"===e||"NIST P-521"===e||"P-521"===e?"P-521":null},this.generateKeyPairHex=function(){var e=this.ecparams.n,t=this.getBigRandom(e),r=this.ecparams.keycharlen,n=("0000000000"+t.toString(16)).slice(-r);return this.setPrivateKeyHex(n),{ecprvhex:n,ecpubhex:this.generatePublicKeyHex()}},this.generatePublicKeyHex=function(){var e=new r(this.prvKeyHex,16),t=this.ecparams.G.multiply(e),n=t.getX().toBigInteger(),s=t.getY().toBigInteger(),i=this.ecparams.keycharlen,o="04"+("0000000000"+n.toString(16)).slice(-i)+("0000000000"+s.toString(16)).slice(-i);return this.setPublicKeyHex(o),o},this.signWithMessageHash=function(e){return this.signHex(e,this.prvKeyHex)},this.signHex=function(e,t){var n=new r(t,16),i=this.ecparams.n,o=new r(e.substring(0,this.ecparams.keycharlen),16);do{var a=this.getBigRandom(i),c=this.ecparams.G.multiply(a).getX().toBigInteger().mod(i)}while(c.compareTo(r.ZERO)<=0);var h=a.modInverse(i).multiply(o.add(n.multiply(c))).mod(i);return s.biRSSigToASN1Sig(c,h)},this.sign=function(e,t){var n=t,s=this.ecparams.n,i=r.fromByteArrayUnsigned(e);do{var o=this.getBigRandom(s),a=this.ecparams.G.multiply(o).getX().toBigInteger().mod(s)}while(a.compareTo(S.ZERO)<=0);var c=o.modInverse(s).multiply(i.add(n.multiply(a))).mod(s);return this.serializeSig(a,c)},this.verifyWithMessageHash=function(e,t){return this.verifyHex(e,t,this.pubKeyHex)},this.verifyHex=function(e,t,i){try{var o,a,c=s.parseSigHex(t);o=c.r,a=c.s;var h=n.decodeFromHex(this.ecparams.curve,i),l=new r(e.substring(0,this.ecparams.keycharlen),16);return this.verifyRaw(l,o,a,h)}catch(e){return!1}},this.verify=function(e,t,s){var i,o,a;if(Bitcoin.Util.isArray(t)){var c=this.parseSig(t);i=c.r,o=c.s}else{if("object"!=typeof t||!t.r||!t.s)throw"Invalid value for signature";i=t.r,o=t.s}if(s instanceof oe)a=s;else{if(!Bitcoin.Util.isArray(s))throw"Invalid format for pubkey value, must be byte array or ECPointFp";a=n.decodeFrom(this.ecparams.curve,s)}var h=r.fromByteArrayUnsigned(e);return this.verifyRaw(h,i,o,a)},this.verifyRaw=function(e,t,n,s){var i=this.ecparams.n,o=this.ecparams.G;if(t.compareTo(r.ONE)<0||t.compareTo(i)>=0)return!1;if(n.compareTo(r.ONE)<0||n.compareTo(i)>=0)return!1;var a=n.modInverse(i),c=e.multiply(a).mod(i),h=t.multiply(a).mod(i);return o.multiply(c).add(s.multiply(h)).getX().toBigInteger().mod(i).equals(t)},this.serializeSig=function(e,t){var r=e.toByteArraySigned(),n=t.toByteArraySigned(),s=[];return s.push(2),s.push(r.length),(s=s.concat(r)).push(2),s.push(n.length),(s=s.concat(n)).unshift(s.length),s.unshift(48),s},this.parseSig=function(e){var t;if(48!=e[0])throw new Error("Signature not a valid DERSequence");if(2!=e[t=2])throw new Error("First element in signature must be a DERInteger");var n=e.slice(t+2,t+2+e[t+1]);if(2!=e[t+=2+e[t+1]])throw new Error("Second element in signature must be a DERInteger");var s=e.slice(t+2,t+2+e[t+1]);return t+=2+e[t+1],{r:r.fromByteArrayUnsigned(n),s:r.fromByteArrayUnsigned(s)}},this.parseSigCompact=function(e){if(65!==e.length)throw"Signature has the wrong length";var t=e[0]-27;if(t<0||t>7)throw"Invalid signature type";var n=this.ecparams.n;return{r:r.fromByteArrayUnsigned(e.slice(1,33)).mod(n),s:r.fromByteArrayUnsigned(e.slice(33,65)).mod(n),i:t}},this.readPKCS5PrvKeyHex=function(e){if(!1===h(e))throw new Error("not ASN.1 hex string");var t,r,n;try{t=c(e,0,["[0]",0],"06"),r=c(e,0,[1],"04");try{n=c(e,0,["[1]",0],"03")}catch(e){}}catch(e){throw new Error("malformed PKCS#1/5 plain ECC private key")}if(this.curveName=o(t),void 0===this.curveName)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(n),this.setPrivateKeyHex(r),this.isPublic=!1},this.readPKCS8PrvKeyHex=function(e){if(!1===h(e))throw new t("not ASN.1 hex string");var r,n,s;try{c(e,0,[1,0],"06"),r=c(e,0,[1,1],"06"),n=c(e,0,[2,0,1],"04");try{s=c(e,0,[2,0,"[1]",0],"03")}catch(e){}}catch(e){throw new t("malformed PKCS#8 plain ECC private key")}if(this.curveName=o(r),void 0===this.curveName)throw new t("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(s),this.setPrivateKeyHex(n),this.isPublic=!1},this.readPKCS8PubKeyHex=function(e){if(!1===h(e))throw new t("not ASN.1 hex string");var r,n;try{c(e,0,[0,0],"06"),r=c(e,0,[0,1],"06"),n=c(e,0,[1],"03")}catch(e){throw new t("malformed PKCS#8 ECC public key")}if(this.curveName=o(r),null===this.curveName)throw new t("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(n)},this.readCertPubKeyHex=function(e,r){if(!1===h(e))throw new t("not ASN.1 hex string");var n,s;try{n=c(e,0,[0,5,0,1],"06"),s=c(e,0,[0,5,1],"03")}catch(e){throw new t("malformed X.509 certificate ECC public key")}if(this.curveName=o(n),null===this.curveName)throw new t("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(s)},void 0!==e&&void 0!==e.curve&&(this.curveName=e.curve),void 0===this.curveName&&(this.curveName="secp256r1"),this.setNamedCurve(this.curveName),void 0!==e&&(void 0!==e.prv&&this.setPrivateKeyHex(e.prv),void 0!==e.pub&&this.setPublicKeyHex(e.pub))},he.crypto.ECDSA.parseSigHex=function(e){var t=he.crypto.ECDSA.parseSigHexInHexRS(e);return{r:new S(t.r,16),s:new S(t.s,16)}},he.crypto.ECDSA.parseSigHexInHexRS=function(e){var t=de,r=t.getChildIdx,n=t.getV;if(t.checkStrictDER(e,0),"30"!=e.substr(0,2))throw new Error("signature is not a ASN.1 sequence");var s=r(e,0);if(2!=s.length)throw new Error("signature shall have two elements");var i=s[0],o=s[1];if("02"!=e.substr(i,2))throw new Error("1st item not ASN.1 integer");if("02"!=e.substr(o,2))throw new Error("2nd item not ASN.1 integer");return{r:n(e,i),s:n(e,o)}},he.crypto.ECDSA.asn1SigToConcatSig=function(e){var t=he.crypto.ECDSA.parseSigHexInHexRS(e),r=t.r,n=t.s;if(r.length>=130&&r.length<=134){if(r.length%2!=0)throw Error("unknown ECDSA sig r length error");if(n.length%2!=0)throw Error("unknown ECDSA sig s length error");"00"==r.substr(0,2)&&(r=r.substr(2)),"00"==n.substr(0,2)&&(n=n.substr(2));var s=Math.max(r.length,n.length);return(r=("000000"+r).slice(-s))+("000000"+n).slice(-s)}if("00"==r.substr(0,2)&&r.length%32==2&&(r=r.substr(2)),"00"==n.substr(0,2)&&n.length%32==2&&(n=n.substr(2)),r.length%32==30&&(r="00"+r),n.length%32==30&&(n="00"+n),r.length%32!=0)throw Error("unknown ECDSA sig r length error");if(n.length%32!=0)throw Error("unknown ECDSA sig s length error");return r+n},he.crypto.ECDSA.concatSigToASN1Sig=function(e){if(e.length%4!=0)throw Error("unknown ECDSA concatinated r-s sig length error");var t=e.substr(0,e.length/2),r=e.substr(e.length/2);return he.crypto.ECDSA.hexRSSigToASN1Sig(t,r)},he.crypto.ECDSA.hexRSSigToASN1Sig=function(e,t){var r=new S(e,16),n=new S(t,16);return he.crypto.ECDSA.biRSSigToASN1Sig(r,n)},he.crypto.ECDSA.biRSSigToASN1Sig=function(e,t){var r=he.asn1,n=new r.DERInteger({bigint:e}),s=new r.DERInteger({bigint:t});return new r.DERSequence({array:[n,s]}).tohex()},he.crypto.ECDSA.getName=function(e){return"2b8104001f"===e?"secp192k1":"2a8648ce3d030107"===e?"secp256r1":"2b8104000a"===e?"secp256k1":"2b81040021"===e?"secp224r1":"2b81040022"===e?"secp384r1":"2b81040023"===e?"secp521r1":-1!=="|secp256r1|NIST P-256|P-256|prime256v1|".indexOf(e)?"secp256r1":-1!=="|secp256k1|".indexOf(e)?"secp256k1":-1!=="|secp224r1|NIST P-224|P-224|".indexOf(e)?"secp224r1":-1!=="|secp384r1|NIST P-384|P-384|".indexOf(e)?"secp384r1":-1!=="|secp521r1|NIST P-521|P-521|".indexOf(e)?"secp521r1":null},void 0!==he&&he||(he={}),void 0!==he.crypto&&he.crypto||(he.crypto={}),he.crypto.ECParameterDB=new function(){var e={},t={};function r(e){return new S(e,16)}this.getByName=function(r){var n=r;if(void 0!==t[n]&&(n=t[r]),void 0!==e[n])return e[n];throw"unregistered EC curve name: "+n},this.regist=function(n,s,i,o,a,c,h,l,u,d,p,g){e[n]={};var m=r(i),f=r(o),y=r(a),v=r(c),b=r(h),S=new ae(m,f,y),w=S.decodePointHex("04"+l+u);e[n].name=n,e[n].keylen=s,e[n].keycharlen=2*Math.ceil(s/8),e[n].curve=S,e[n].G=w,e[n].n=v,e[n].h=b,e[n].oid=p,e[n].info=g;for(var x=0;x<d.length;x++)t[d[x]]=n}},he.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field"),he.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field"),he.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field"),he.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]),he.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]),he.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]),he.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]),he.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]),he.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7","3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]),he.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409","1","00C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]),void 0!==he&&he||(he={}),void 0!==he.crypto&&he.crypto||(he.crypto={}),he.crypto.DSA=function(){var e=de,t=(e.getVbyList,e.getVbyListEx),r=e.isASN1HEX,n=S;this.p=null,this.q=null,this.g=null,this.y=null,this.x=null,this.type="DSA",this.isPrivate=!1,this.isPublic=!1,this.setPrivate=function(e,t,r,n,s){this.isPrivate=!0,this.p=e,this.q=t,this.g=r,this.y=n,this.x=s},this.setPrivateHex=function(e,t,r,n,s){var i,o,a,c,h;i=new S(e,16),o=new S(t,16),a=new S(r,16),c="string"==typeof n&&n.length>1?new S(n,16):null,h=new S(s,16),this.setPrivate(i,o,a,c,h)},this.setPublic=function(e,t,r,n){this.isPublic=!0,this.p=e,this.q=t,this.g=r,this.y=n,this.x=null},this.setPublicHex=function(e,t,r,n){var s,i,o,a;s=new S(e,16),i=new S(t,16),o=new S(r,16),a=new S(n,16),this.setPublic(s,i,o,a)},this.signWithMessageHash=function(e){var t=this.p,r=this.q,n=this.g,s=(this.y,this.x),i=he.crypto.Util.getRandomBigIntegerMinToMax(S.ONE.add(S.ONE),r.subtract(S.ONE)),o=new S(e.substr(0,r.bitLength()/4),16),a=n.modPow(i,t).mod(r),c=i.modInverse(r).multiply(o.add(s.multiply(a))).mod(r);return he.asn1.ASN1Util.jsonToASN1HEX({seq:[{int:{bigint:a}},{int:{bigint:c}}]})},this.verifyWithMessageHash=function(e,t){var r=this.p,n=this.q,s=this.g,i=this.y,o=this.parseASN1Signature(t),a=o[0],c=o[1],h=new S(e.substr(0,n.bitLength()/4),16);if(S.ZERO.compareTo(a)>0||a.compareTo(n)>0)throw"invalid DSA signature";if(S.ZERO.compareTo(c)>=0||c.compareTo(n)>0)throw"invalid DSA signature";var l=c.modInverse(n),u=h.multiply(l).mod(n),d=a.multiply(l).mod(n);return 0==s.modPow(u,r).multiply(i.modPow(d,r)).mod(r).mod(n).compareTo(a)},this.parseASN1Signature=function(e){try{return[new n(t(e,0,[0],"02"),16),new n(t(e,0,[1],"02"),16)]}catch(e){throw new Error("malformed ASN.1 DSA signature")}},this.readPKCS5PrvKeyHex=function(e){var n,s,i,o,a;if(!1===r(e))throw new Error("not ASN.1 hex string");try{n=t(e,0,[1],"02"),s=t(e,0,[2],"02"),i=t(e,0,[3],"02"),o=t(e,0,[4],"02"),a=t(e,0,[5],"02")}catch(e){throw new Error("malformed PKCS#1/5 plain DSA private key")}this.setPrivateHex(n,s,i,o,a)},this.readPKCS8PrvKeyHex=function(e){var n,s,i,o;if(!1===r(e))throw new Error("not ASN.1 hex string");try{n=t(e,0,[1,1,0],"02"),s=t(e,0,[1,1,1],"02"),i=t(e,0,[1,1,2],"02"),o=t(e,0,[2,0],"02")}catch(e){throw new Error("malformed PKCS#8 plain DSA private key")}this.setPrivateHex(n,s,i,null,o)},this.readPKCS8PubKeyHex=function(e){var n,s,i,o;if(!1===r(e))throw new Error("not ASN.1 hex string");try{n=t(e,0,[0,1,0],"02"),s=t(e,0,[0,1,1],"02"),i=t(e,0,[0,1,2],"02"),o=t(e,0,[1,0],"02")}catch(e){throw new Error("malformed PKCS#8 DSA public key")}this.setPublicHex(n,s,i,o)},this.readCertPubKeyHex=function(e,n){var s,i,o,a;if(!1===r(e))throw new Error("not ASN.1 hex string");try{s=t(e,0,[0,5,0,1,0],"02"),i=t(e,0,[0,5,0,1,1],"02"),o=t(e,0,[0,5,0,1,2],"02"),a=t(e,0,[0,5,1,0],"02")}catch(e){throw new Error("malformed X.509 certificate DSA public key")}this.setPublicHex(s,i,o,a)}};var st=function(){var e=function(e,r,n){return t(p.AES,e,r,n)},t=function(e,t,r,n){var s=p.enc.Hex.parse(t),i=p.enc.Hex.parse(r),o=p.enc.Hex.parse(n),a={};a.key=i,a.iv=o,a.ciphertext=s;var c=e.decrypt(a,i,{iv:o});return p.enc.Hex.stringify(c)},r=function(e,t,r){return n(p.AES,e,t,r)},n=function(e,t,r,n){var s=p.enc.Hex.parse(t),i=p.enc.Hex.parse(r),o=p.enc.Hex.parse(n),a=e.encrypt(s,i,{iv:o}),c=p.enc.Hex.parse(a.toString());return p.enc.Base64.stringify(c)},s={"AES-256-CBC":{proc:e,eproc:r,keylen:32,ivlen:16},"AES-192-CBC":{proc:e,eproc:r,keylen:24,ivlen:16},"AES-128-CBC":{proc:e,eproc:r,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:function(e,r,n){return t(p.TripleDES,e,r,n)},eproc:function(e,t,r){return n(p.TripleDES,e,t,r)},keylen:24,ivlen:8},"DES-CBC":{proc:function(e,r,n){return t(p.DES,e,r,n)},eproc:function(e,t,r){return n(p.DES,e,t,r)},keylen:8,ivlen:8}},i=function(e){var t={},r=e.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));r&&(t.cipher=r[1],t.ivsalt=r[2]);var n=e.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));n&&(t.type=n[1]);var s=-1,i=0;-1!=e.indexOf("\r\n\r\n")&&(s=e.indexOf("\r\n\r\n"),i=2),-1!=e.indexOf("\n\n")&&(s=e.indexOf("\n\n"),i=1);var o=e.indexOf("-----END");if(-1!=s&&-1!=o){var a=e.substring(s+2*i,o-i);a=a.replace(/\s+/g,""),t.data=a}return t},o=function(e,t,r){for(var n=r.substring(0,16),i=p.enc.Hex.parse(n),o=p.enc.Utf8.parse(t),a=s[e].keylen+s[e].ivlen,c="",h=null;;){var l=p.algo.MD5.create();if(null!=h&&l.update(h),l.update(o),l.update(i),h=l.finalize(),(c+=p.enc.Hex.stringify(h)).length>=2*a)break}var u={};return u.keyhex=c.substr(0,2*s[e].keylen),u.ivhex=c.substr(2*s[e].keylen,2*s[e].ivlen),u},a=function(e,t,r,n){var i=p.enc.Base64.parse(e),o=p.enc.Hex.stringify(i);return(0,s[t].proc)(o,r,n)};return{version:"1.0.0",parsePKCS5PEM:function(e){return i(e)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(e,t,r){return o(e,t,r)},decryptKeyB64:function(e,t,r,n){return a(e,t,r,n)},getDecryptedKeyHex:function(e,t){var r=i(e),n=(r.type,r.cipher),s=r.ivsalt,c=r.data,h=o(n,t,s).keyhex;return a(c,n,h,s)},getEncryptedPKCS5PEMFromPrvKeyHex:function(e,t,r,n,i){var a="";if(void 0!==n&&null!=n||(n="AES-256-CBC"),void 0===s[n])throw new Error("KEYUTIL unsupported algorithm: "+n);if(void 0===i||null==i){var c=function(e){var t=p.lib.WordArray.random(e);return p.enc.Hex.stringify(t)}(s[n].ivlen);i=c.toUpperCase()}var h=function(e,t,r,n){return(0,s[t].eproc)(e,r,n)}(t,n,o(n,r,i).keyhex,i);return a="-----BEGIN "+e+" PRIVATE KEY-----\r\n",a+="Proc-Type: 4,ENCRYPTED\r\n",a+="DEK-Info: "+n+","+i+"\r\n",a+="\r\n",(a+=h.replace(/(.{64})/g,"$1\r\n"))+"\r\n-----END "+e+" PRIVATE KEY-----\r\n"},getEncryptedPKCS8PEM:function(e,t,r){return Pe(this.getEncryptedPKCS8Hex(e,t,r),"ENCRYPTED PRIVATE KEY")},getEncryptedPKCS8Hex:function(e,t,r){var n;(n=null==r||null==r?{}:JSON.parse(JSON.stringify(r))).plain=e,this.initPBES2Param(n),this.encryptPBES2Param(n,t);var s=this.generatePBES2ASN1Param(n);return he.asn1.ASN1Util.newObject(s).tohex()},initPBES2Param:function(e){var t;null==rt(e,"encalg")&&(e.encalg="aes256-CBC"),null==rt(e,"iter")&&(e.iter=2048),null==rt(e,"prf")&&(e.prf="hmacWithSHA256"),null==rt(e,"salt")&&(e.salt=p.enc.Hex.stringify(p.lib.WordArray.random(8))),null==rt(e,"enciv")&&("des-EDE3-CBC"==e.encalg&&(t=8),"aes128-CBC"==e.encalg&&(t=16),"aes256-CBC"==e.encalg&&(t=16),e.enciv=p.enc.Hex.stringify(p.lib.WordArray.random(t)))},encryptPBES2Param:function(e,t){var r=st.getDKFromPBES2Param(e,t);try{var n=he.crypto.Cipher.encrypt(e.plain,r,e.encalg,{iv:e.enciv})}catch(t){throw new Error("encrypt error: "+e.plain+" "+r+" "+e.encalg+" "+e.enciv)}e.enc=n},generatePBES2ASN1Param:function(e){var t={seq:[{seq:[{oid:"pkcs5PBES2"},{seq:[{seq:[{oid:"pkcs5PBKDF2"},{seq:[{octstr:{hex:e.salt}},{int:{hex:Je(e.iter)}}]}]},{seq:[{oid:e.encalg},{octstr:{hex:e.enciv}}]}]}]},{octstr:{hex:e.enc}}]};return"hmacWithSHA1"!=e.prf&&t.seq[0].seq[1].seq[0].seq[1].seq.push({seq:[{oid:e.prf},{null:""}]}),t},parseHexOfEncryptedPKCS8:function(e){var t=de,r=t.getChildIdx,n=t.getV,s={},i=r(e,0);if(2!=i.length)throw new Error("malformed format: SEQUENCE(0).items != 2: "+i.length);s.ciphertext=n(e,i[1]);var o=r(e,i[0]);if(2!=o.length)throw new Error("malformed format: SEQUENCE(0.0).items != 2: "+o.length);if("2a864886f70d01050d"!=n(e,o[0]))throw new Error("this only supports pkcs5PBES2");var a=r(e,o[1]);if(2!=o.length)throw new Error("malformed format: SEQUENCE(0.0.1).items != 2: "+a.length);var c=r(e,a[1]);if(2!=c.length)throw new Error("malformed format: SEQUENCE(0.0.1.1).items != 2: "+c.length);if("2a864886f70d0307"!=n(e,c[0]))throw"this only supports TripleDES";s.encryptionSchemeAlg="TripleDES",s.encryptionSchemeIV=n(e,c[1]);var h=r(e,a[0]);if(2!=h.length)throw new Error("malformed format: SEQUENCE(0.0.1.0).items != 2: "+h.length);if("2a864886f70d01050c"!=n(e,h[0]))throw new Error("this only supports pkcs5PBKDF2");var l=r(e,h[1]);if(l.length<2)throw new Error("malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+l.length);s.pbkdf2Salt=n(e,l[0]);var u=n(e,l[1]);try{s.pbkdf2Iter=parseInt(u,16)}catch(e){throw new Error("malformed format pbkdf2Iter: "+u)}return s},getPBKDF2KeyHexFromParam:function(e,t){var r=p.enc.Hex.parse(e.pbkdf2Salt),n=e.pbkdf2Iter,s=p.PBKDF2(t,r,{keySize:6,iterations:n});return p.enc.Hex.stringify(s)},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(e,t){var r=Re(e,"ENCRYPTED PRIVATE KEY"),n=this.parseHexOfEncryptedPKCS8(r),s=st.getPBKDF2KeyHexFromParam(n,t),i={};i.ciphertext=p.enc.Hex.parse(n.ciphertext);var o=p.enc.Hex.parse(s),a=p.enc.Hex.parse(n.encryptionSchemeIV),c=p.TripleDES.decrypt(i,o,{iv:a});return p.enc.Hex.stringify(c)},parsePBES2:function(e){var t=de.parse(e);if("pkcs5PBES2"!=rt(t,"seq.0.seq.0.oid")||"pkcs5PBKDF2"!=rt(t,"seq.0.seq.1.seq.0.seq.0.oid"))throw new Error("not pkcs5PBES2 and pkcs5PBKDF2 used");var r=rt(t,"seq.0.seq.1.seq.0.seq.1.seq");if(null==r)throw new Error("PBKDF2 parameter not found");var n=rt(r,"0.octstr.hex"),s=rt(r,"1.int.hex"),i=rt(r,"2.seq.0.oid","hmacWithSHA1"),o=-1;try{o=parseInt(s,16)}catch(e){throw new Error("iter not proper value")}var a=rt(t,"seq.0.seq.1.seq.1.seq.0.oid"),c=rt(t,"seq.0.seq.1.seq.1.seq.1.octstr.hex"),h=rt(t,"seq.1.octstr.hex");if(null==a||null==c||null==h)throw new Error("encalg, enciv or enc is undefined");return{salt:n,iter:o,prf:i,encalg:a,enciv:c,enc:h}},getDKFromPBES2Param:function(e,t){var r={hmacWithSHA1:p.algo.SHA1,hmacWithSHA224:p.algo.SHA224,hmacWithSHA256:p.algo.SHA256,hmacWithSHA384:p.algo.SHA384,hmacWithSHA512:p.algo.SHA512}[e.prf];if(null==r)throw new Error("unsupported prf");var n={"des-EDE3-CBC":6,"aes128-CBC":4,"aes256-CBC":8}[e.encalg];if(null==n)throw new Error("unsupported encalg");var s=p.enc.Hex.parse(e.salt),i=e.iter;try{var o=p.PBKDF2(t,s,{keySize:n,iterations:i,hasher:r});return p.enc.Hex.stringify(o)}catch(r){throw new Error("PBKDF2 error: "+r+" "+JSON.stringify(e)+" "+t)}},getPlainHexFromEncryptedPKCS8PEM:function(e,t){if(-1==e.indexOf("BEGIN ENCRYPTED PRIVATE KEY"))throw new Error("not Encrypted PKCS#8 PEM string");var r,n=Re(e);try{r=st.parsePBES2(n)}catch(e){throw new Error("malformed PBES2 format: "+e.message)}var s=st.getDKFromPBES2Param(r,t);return he.crypto.Cipher.decrypt(r.enc,s,r.encalg,{iv:r.enciv})},getKeyFromEncryptedPKCS8PEM:function(e,t){var r=this.getPlainHexFromEncryptedPKCS8PEM(e,t);return this.getKeyFromPlainPrivatePKCS8Hex(r)},parsePlainPrivatePKCS8Hex:function(e){var t=de,r=t.getChildIdx,n=t.getV,s={algparam:null};if("30"!=e.substr(0,2))throw new Error("malformed plain PKCS8 private key(code:001)");var i=r(e,0);if(i.length<3)throw new Error("malformed plain PKCS8 private key(code:002)");if("30"!=e.substr(i[1],2))throw new Error("malformed PKCS8 private key(code:003)");var o=r(e,i[1]);if(2!=o.length)throw new Error("malformed PKCS8 private key(code:004)");if("06"!=e.substr(o[0],2))throw new Error("malformed PKCS8 private key(code:005)");if(s.algoid=n(e,o[0]),"06"==e.substr(o[1],2)&&(s.algparam=n(e,o[1])),"04"!=e.substr(i[2],2))throw new Error("malformed PKCS8 private key(code:006)");return s.keyidx=t.getVidx(e,i[2]),s},getKeyFromPlainPrivatePKCS8PEM:function(e){var t=Re(e,"PRIVATE KEY");return this.getKeyFromPlainPrivatePKCS8Hex(t)},getKeyFromPlainPrivatePKCS8Hex:function(e){var t,r=this.parsePlainPrivatePKCS8Hex(e);if("2a864886f70d010101"==r.algoid)t=new ne;else if("2a8648ce380401"==r.algoid)t=new he.crypto.DSA;else{if("2a8648ce3d0201"!=r.algoid)throw new Error("unsupported private key algorithm");t=new he.crypto.ECDSA}return t.readPKCS8PrvKeyHex(e),t},_getKeyFromPublicPKCS8Hex:function(e){var t,r=de.getVbyList(e,0,[0,0],"06");if("2a864886f70d010101"===r)t=new ne;else if("2a8648ce380401"===r)t=new he.crypto.DSA;else{if("2a8648ce3d0201"!==r)throw new Error("unsupported PKCS#8 public key hex");t=new he.crypto.ECDSA}return t.readPKCS8PubKeyHex(e),t},parsePublicRawRSAKeyHex:function(e){var t=de,r=t.getChildIdx,n=t.getV,s={};if("30"!=e.substr(0,2))throw new Error("malformed RSA key(code:001)");var i=r(e,0);if(2!=i.length)throw new Error("malformed RSA key(code:002)");if("02"!=e.substr(i[0],2))throw new Error("malformed RSA key(code:003)");if(s.n=n(e,i[0]),"02"!=e.substr(i[1],2))throw new Error("malformed RSA key(code:004)");return s.e=n(e,i[1]),s},parsePublicPKCS8Hex:function(e){var t=de,r=t.getChildIdx,n=t.getV,s={algparam:null},i=r(e,0);if(2!=i.length)throw new Error("outer DERSequence shall have 2 elements: "+i.length);var o=i[0];if("30"!=e.substr(o,2))throw new Error("malformed PKCS8 public key(code:001)");var a=r(e,o);if(2!=a.length)throw new Error("malformed PKCS8 public key(code:002)");if("06"!=e.substr(a[0],2))throw new Error("malformed PKCS8 public key(code:003)");if(s.algoid=n(e,a[0]),"06"==e.substr(a[1],2)?s.algparam=n(e,a[1]):"30"==e.substr(a[1],2)&&(s.algparam={},s.algparam.p=t.getVbyList(e,a[1],[0],"02"),s.algparam.q=t.getVbyList(e,a[1],[1],"02"),s.algparam.g=t.getVbyList(e,a[1],[2],"02")),"03"!=e.substr(i[1],2))throw new Error("malformed PKCS8 public key(code:004)");return s.key=n(e,i[1]).substr(2),s}}}();function it(e,t){for(var r="",n=t/4-e.length,s=0;s<n;s++)r+="0";return r+e}function ot(e,t,r){for(var n="",s=0;n.length<t;)n+=Ee(r(Ae(e+String.fromCharCode.apply(String,[(4278190080&s)>>24,(16711680&s)>>16,(65280&s)>>8,255&s])))),s+=1;return n}function at(e){for(var t in he.crypto.Util.DIGESTINFOHEAD){var r=he.crypto.Util.DIGESTINFOHEAD[t],n=r.length;if(e.substring(0,n)==r)return[t,e.substring(n)]}return[]}function ct(e){var t,r=de,n=r.getChildIdx,s=r.getV,i=(r.dump,r.parse),o=r.getTLV,a=r.getVbyList,c=r.getVbyListEx,h=r.getTLVbyList,l=r.getTLVbyListEx,u=r.getIdxbyList,d=r.getIdxbyListEx,p=r.getVidx,g=r.getInt,m=r.oidname,f=r.hextooidstr,y=Re,v=Error;try{t=he.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch(e){}this.HEX2STAG={"0c":"utf8",13:"prn",16:"ia5","1a":"vis","1e":"bmp"},this.hex=null,this.version=0,this.foffset=0,this.aExtInfo=null,this.getVersion=function(){if(null===this.hex||0!==this.version)return this.version;var e=h(this.hex,0,[0,0]);if("a0"==e.substr(0,2)){var t=h(e,0,[0]),r=g(t,0);if(r<0||2<r)throw new Error("malformed version field");return this.version=r+1,this.version}return this.version=1,this.foffset=-1,1},this.getSerialNumberHex=function(){return c(this.hex,0,[0,0],"02")},this.getSignatureAlgorithmField=function(){var e=l(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(e)},this.getAlgorithmIdentifierName=function(e){for(var r in t)if(e===t[r])return r;return m(c(e,0,[0],"06"))},this.getIssuer=function(e,t){return this.getX500Name(this.getIssuerHex(),e,t)},this.getIssuerHex=function(){return h(this.hex,0,[0,3+this.foffset],"30")},this.getIssuerString=function(){return this.getIssuer().str},this.getSubject=function(e,t){return this.getX500Name(this.getSubjectHex(),e,t)},this.getSubjectHex=function(){return h(this.hex,0,[0,5+this.foffset],"30")},this.getSubjectString=function(){return this.getSubject().str},this.getNotBefore=function(){var e=a(this.hex,0,[0,4+this.foffset,0]);return e=e.replace(/(..)/g,"%$1"),decodeURIComponent(e)},this.getNotAfter=function(){var e=a(this.hex,0,[0,4+this.foffset,1]);return e=e.replace(/(..)/g,"%$1"),decodeURIComponent(e)},this.getPublicKeyHex=function(){return this.getSPKI()},this.getSPKI=function(){return h(this.hex,0,[0,6+this.foffset],"30")},this.getSPKIValue=function(){var e=this.getSPKI();return null==e?null:a(e,0,[1],"03",!0)},this.getPublicKeyIdx=function(){return u(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyContentIdx=function(){var e=this.getPublicKeyIdx();return u(this.hex,e,[1,0],"30")},this.getPublicKey=function(){return st.getKey(this.getPublicKeyHex(),null,"pkcs8pub")},this.getSignatureAlgorithmName=function(){var e=h(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(e)},this.getSignatureValueHex=function(){return a(this.hex,0,[2],"03",!0)},this.verifySignature=function(e){var t=this.getSignatureAlgorithmField(),r=this.getSignatureValueHex(),n=h(this.hex,0,[0],"30"),s=new he.crypto.Signature({alg:t});return s.init(e),s.updateHex(n),s.verify(r)},this.parseExt=function(e){var t,i,o;if(void 0===e){if(o=this.hex,3!==this.version)return-1;t=u(o,0,[0,7,0],"30"),i=n(o,t)}else{o=Re(e);var c=u(o,0,[0,3,0,0],"06");if("2a864886f70d01090e"!=s(o,c))return void(this.aExtInfo=new Array);t=u(o,0,[0,3,0,1,0],"30"),i=n(o,t),this.hex=o}this.aExtInfo=new Array;for(var h=0;h<i.length;h++){var l={critical:!1},d=0;3===n(o,i[h]).length&&(l.critical=!0,d=1),l.oid=r.hextooidstr(a(o,i[h],[0],"06"));var g=u(o,i[h],[1+d]);l.vidx=p(o,g),this.aExtInfo.push(l)}},this.getExtInfo=function(e){var t=this.aExtInfo,r=e;if(e.match(/^[0-9.]+$/)||(r=he.asn1.x509.OID.name2oid(e)),""!==r)for(var n=0;n<t.length;n++)if(t[n].oid===r)return t[n]},this.getCriticalExtV=function(e,t,r){if(null!=t)return[t,r];var n=this.getExtInfo(e);return null==n?[null,null]:[o(this.hex,n.vidx),n.critical]},this.getExtBasicConstraints=function(e,t){if(void 0===e&&void 0===t){var r=this.getExtInfo("basicConstraints");if(void 0===r)return;e=o(this.hex,r.vidx),t=r.critical}var n={extname:"basicConstraints"};if(t&&(n.critical=!0),"3000"===e)return n;if("30030101ff"===e)return n.cA=!0,n;if("30060101ff02"===e.substr(0,12)){var i=s(e,10),a=parseInt(i,16);return n.cA=!0,n.pathLen=a,n}throw new Error("hExtV parse error: "+e)},this.getExtNameConstraints=function(e,t){var r=this.getCriticalExtV("nameConstraints",e,t);if(e=r[0],t=r[1],null!=e){var s={extname:"nameConstraints"};t&&(s.critical=!0);for(var i=n(e,0),a=0;a<i.length;a++){for(var c=[],h=n(e,i[a]),l=0;l<h.length;l++){var u=o(e,h[l]),d=this.getGeneralSubtree(u);c.push(d)}var p=e.substr(i[a],2);"a0"==p?s.permit=c:"a1"==p&&(s.exclude=c)}return s}},this.getGeneralSubtree=function(e){var t=n(e,0),r=t.length;if(r<1||2<r)throw new Error("wrong num elements");for(var i=this.getGeneralName(o(e,t[0])),a=1;a<r;a++){var c=e.substr(t[a],2),h=s(e,t[a]),l=parseInt(h,16);"80"==c&&(i.min=l),"81"==c&&(i.max=l)}return i},this.getExtKeyUsage=function(e,t){var r=this.getCriticalExtV("keyUsage",e,t);if(e=r[0],t=r[1],null!=e){var n={extname:"keyUsage"};return t&&(n.critical=!0),n.names=this.getExtKeyUsageString(e).split(","),n}},this.getExtKeyUsageBin=function(e){if(void 0===e){var t=this.getExtInfo("keyUsage");if(void 0===t)return"";e=o(this.hex,t.vidx)}if(8!=e.length&&10!=e.length)throw new Error("malformed key usage value: "+e);var r="000000000000000"+parseInt(e.substr(6),16).toString(2);return 8==e.length&&(r=r.slice(-8)),10==e.length&&(r=r.slice(-16)),""==(r=r.replace(/0+$/,""))&&(r="0"),r},this.getExtKeyUsageString=function(e){for(var t=this.getExtKeyUsageBin(e),r=new Array,n=0;n<t.length;n++)"1"==t.substr(n,1)&&r.push(ct.KEYUSAGE_NAME[n]);return r.join(",")},this.getExtSubjectKeyIdentifier=function(e,t){if(void 0===e&&void 0===t){var r=this.getExtInfo("subjectKeyIdentifier");if(void 0===r)return;e=o(this.hex,r.vidx),t=r.critical}var n={extname:"subjectKeyIdentifier"};t&&(n.critical=!0);var i=s(e,0);return n.kid={hex:i},n},this.getExtAuthorityKeyIdentifier=function(e,t){if(void 0===e&&void 0===t){var r=this.getExtInfo("authorityKeyIdentifier");if(void 0===r)return;e=o(this.hex,r.vidx),t=r.critical}var i={extname:"authorityKeyIdentifier"};t&&(i.critical=!0);for(var a=n(e,0),c=0;c<a.length;c++){var h=e.substr(a[c],2);if("80"===h&&(i.kid={hex:s(e,a[c])}),"a1"===h){var l=o(e,a[c]),u=this.getGeneralNames(l);i.issuer=u[0].dn}"82"===h&&(i.sn={hex:s(e,a[c])})}return i},this.getExtExtKeyUsage=function(e,t){if(void 0===e&&void 0===t){var r=this.getExtInfo("extKeyUsage");if(void 0===r)return;e=o(this.hex,r.vidx),t=r.critical}var i={extname:"extKeyUsage",array:[]};t&&(i.critical=!0);for(var a=n(e,0),c=0;c<a.length;c++)i.array.push(m(s(e,a[c])));return i},this.getExtExtKeyUsageName=function(){var e=this.getExtInfo("extKeyUsage");if(void 0===e)return e;var t=new Array,r=o(this.hex,e.vidx);if(""===r)return t;for(var i=n(r,0),a=0;a<i.length;a++)t.push(m(s(r,i[a])));return t},this.getExtSubjectAltName=function(e,t){if(void 0===e&&void 0===t){var r=this.getExtInfo("subjectAltName");if(void 0===r)return;e=o(this.hex,r.vidx),t=r.critical}var n={extname:"subjectAltName",array:[]};return t&&(n.critical=!0),n.array=this.getGeneralNames(e),n},this.getExtIssuerAltName=function(e,t){if(void 0===e&&void 0===t){var r=this.getExtInfo("issuerAltName");if(void 0===r)return;e=o(this.hex,r.vidx),t=r.critical}var n={extname:"issuerAltName",array:[]};return t&&(n.critical=!0),n.array=this.getGeneralNames(e),n},this.getGeneralNames=function(e){for(var t=n(e,0),r=[],s=0;s<t.length;s++){var i=this.getGeneralName(o(e,t[s]));void 0!==i&&r.push(i)}return r},this.getGeneralName=function(e){var t=e.substr(0,2),r=s(e,0),n=Ee(r);return"81"==t?{rfc822:n}:"82"==t?{dns:n}:"86"==t?{uri:n}:"87"==t?{ip:Be(r)}:"a4"==t?{dn:this.getX500Name(r)}:"a0"==t?{other:this.getOtherName(e)}:void 0},this.getExtSubjectAltName2=function(){var e,t,r,i=this.getExtInfo("subjectAltName");if(void 0===i)return i;for(var a=new Array,c=o(this.hex,i.vidx),h=n(c,0),l=0;l<h.length;l++)r=c.substr(h[l],2),e=s(c,h[l]),"81"===r&&(t=xe(e),a.push(["MAIL",t])),"82"===r&&(t=xe(e),a.push(["DNS",t])),"84"===r&&(t=ct.hex2dn(e,0),a.push(["DN",t])),"86"===r&&(t=xe(e),a.push(["URI",t])),"87"===r&&(t=Be(e),a.push(["IP",t]));return a},this.getExtCRLDistributionPoints=function(e,t){if(void 0===e&&void 0===t){var r=this.getExtInfo("cRLDistributionPoints");if(void 0===r)return;e=o(this.hex,r.vidx),t=r.critical}var s={extname:"cRLDistributionPoints",array:[]};t&&(s.critical=!0);for(var i=n(e,0),a=0;a<i.length;a++){var c=o(e,i[a]);s.array.push(this.getDistributionPoint(c))}return s},this.getDistributionPoint=function(e){for(var t={},r=n(e,0),s=0;s<r.length;s++){var i=e.substr(r[s],2),a=o(e,r[s]);"a0"==i&&(t.dpname=this.getDistributionPointName(a))}return t},this.getDistributionPointName=function(e){for(var t={},r=n(e,0),s=0;s<r.length;s++){var i=e.substr(r[s],2),a=o(e,r[s]);"a0"==i&&(t.full=this.getGeneralNames(a))}return t},this.getExtCRLDistributionPointsURI=function(){var e=this.getExtCRLDistributionPoints();if(null==e)return e;for(var t=e.array,r=[],n=0;n<t.length;n++)try{null!=t[n].dpname.full[0].uri&&r.push(t[n].dpname.full[0].uri)}catch(e){}return r},this.getExtAIAInfo=function(){var e=this.getExtInfo("authorityInfoAccess");if(void 0===e)return e;for(var t={ocsp:[],caissuer:[]},r=n(this.hex,e.vidx),s=0;s<r.length;s++){var i=a(this.hex,r[s],[0],"06"),o=a(this.hex,r[s],[1],"86");"2b06010505073001"===i&&t.ocsp.push(xe(o)),"2b06010505073002"===i&&t.caissuer.push(xe(o))}return t},this.getExtAuthorityInfoAccess=function(e,t){if(void 0===e&&void 0===t){var r=this.getExtInfo("authorityInfoAccess");if(void 0===r)return;e=o(this.hex,r.vidx),t=r.critical}var s={extname:"authorityInfoAccess",array:[]};t&&(s.critical=!0);for(var i=n(e,0),h=0;h<i.length;h++){var l=c(e,i[h],[0],"06"),u=xe(a(e,i[h],[1],"86"));if("2b06010505073001"==l)s.array.push({ocsp:u});else{if("2b06010505073002"!=l)throw new Error("unknown method: "+l);s.array.push({caissuer:u})}}return s},this.getExtCertificatePolicies=function(e,t){if(void 0===e&&void 0===t){var r=this.getExtInfo("certificatePolicies");if(void 0===r)return;e=o(this.hex,r.vidx),t=r.critical}var s={extname:"certificatePolicies",array:[]};t&&(s.critical=!0);for(var i=n(e,0),a=0;a<i.length;a++){var c=o(e,i[a]),h=this.getPolicyInformation(c);s.array.push(h)}return s},this.getPolicyInformation=function(e){var t={},r=a(e,0,[0],"06");t.policyoid=m(r);var s=d(e,0,[1],"30");if(-1!=s){t.array=[];for(var i=n(e,s),c=0;c<i.length;c++){var h=o(e,i[c]),l=this.getPolicyQualifierInfo(h);t.array.push(l)}}return t},this.getOtherName=function(e){var t={},r=n(e,0),s=a(e,r[0],[],"06"),o=a(e,r[1],[]);return t.oid=m(s),t.value=i(o),t},this.getPolicyQualifierInfo=function(e){var t={},r=a(e,0,[0],"06");if("2b06010505070201"===r){var n=c(e,0,[1],"16");t.cps=Ee(n)}else if("2b06010505070202"===r){var s=h(e,0,[1],"30");t.unotice=this.getUserNotice(s)}return t},this.getUserNotice=function(e){var t=null;try{return t=r.parse(e),this._asn1ToUnotice(t)}catch(e){return}},this._asn1ToUnotice=function(e){try{for(var t={},r=rt(e,"seq"),n=0;n<r.length;n++){var s=this._asn1ToNoticeRef(r[n]);null!=s&&(t.noticeref=s);var i=this.asn1ToDisplayText(r[n]);null!=i&&(t.exptext=i)}return Object.keys(t).length>0?t:void 0}catch(e){return}},this._asn1ToNoticeRef=function(e){try{for(var t={},r=rt(e,"seq"),n=0;n<r.length;n++){var s=this._asn1ToNoticeNum(r[n]);null!=s&&(t.noticenum=s);var i=this.asn1ToDisplayText(r[n]);null!=i&&(t.org=i)}return Object.keys(t).length>0?t:void 0}catch(e){return}},this._asn1ToNoticeNum=function(e){try{for(var t=rt(e,"seq"),r=[],n=0;n<t.length;n++){var s=t[n];r.push(parseInt(rt(s,"int.hex"),16))}return r}catch(e){return}},this.getDisplayText=function(e){var t={};return t.type={"0c":"utf8",16:"ia5","1a":"vis","1e":"bmp"}[e.substr(0,2)],t.str=Ee(s(e,0)),t},this.asn1ToDisplayText=function(e){return null!=e.utf8str?{type:"utf8",str:e.utf8str.str}:null!=e.ia5str?{type:"ia5",str:e.ia5str.str}:null!=e.visstr?{type:"vis",str:e.visstr.str}:null!=e.bmpstr?{type:"bmp",str:e.bmpstr.str}:null!=e.prnstr?{type:"prn",str:e.prnstr.str}:void 0},this.getExtPolicyMappings=function(e,t){var r=this.getCriticalExtV("policyMappings",e,t);if(e=r[0],t=r[1],null!=e){var n={extname:"policyMappings"};t&&(n.critical=!0);try{for(var s=i(e).seq,o=[],a=0;a<s.length;a++){var c=s[a].seq;o.push([c[0].oid,c[1].oid])}n.array=o}catch(e){throw new v("malformed policyMappings")}return n}},this.getExtPolicyConstraints=function(e,t){var r=this.getCriticalExtV("policyConstraints",e,t);if(e=r[0],t=r[1],null!=e){var n={extname:"policyConstraints"};t&&(n.critical=!0);var s=i(e);try{for(var o=s.seq,a=0;a<o.length;a++){var c=o[a].tag;0==c.explicit&&("80"==c.tag&&(n.reqexp=parseInt(c.hex,16)),"81"==c.tag&&(n.inhibit=parseInt(c.hex,16)))}}catch(e){return new v("malformed policyConstraints value")}return n}},this.getExtInhibitAnyPolicy=function(e,t){var r=this.getCriticalExtV("inhibitAnyPolicy",e,t);if(e=r[0],t=r[1],null!=e){var n={extname:"inhibitAnyPolicy"};t&&(n.critical=!0);var s=g(e,0);return-1==s?new v("wrong value"):(n.skip=s,n)}},this.getExtCRLNumber=function(e,t){var r={extname:"cRLNumber"};if(t&&(r.critical=!0),"02"==e.substr(0,2))return r.num={hex:s(e,0)},r;throw new v("hExtV parse error: "+e)},this.getExtCRLReason=function(e,t){var r={extname:"cRLReason"};if(t&&(r.critical=!0),"0a"==e.substr(0,2))return r.code=parseInt(s(e,0),16),r;throw new Error("hExtV parse error: "+e)},this.getExtOcspNonce=function(e,t){var r={extname:"ocspNonce"};t&&(r.critical=!0);var n=s(e,0);return r.hex=n,r},this.getExtOcspNoCheck=function(e,t){var r={extname:"ocspNoCheck"};return t&&(r.critical=!0),r},this.getExtAdobeTimeStamp=function(e,t){if(void 0===e&&void 0===t){var r=this.getExtInfo("adobeTimeStamp");if(void 0===r)return;e=o(this.hex,r.vidx),t=r.critical}var s={extname:"adobeTimeStamp"};t&&(s.critical=!0);var i=n(e,0);if(i.length>1){var a=o(e,i[1]),c=this.getGeneralName(a);null!=c.uri&&(s.uri=c.uri)}if(i.length>2){var h=o(e,i[2]);"0101ff"==h&&(s.reqauth=!0),"010100"==h&&(s.reqauth=!1)}return s},this.getExtSubjectDirectoryAttributes=function(e,t){if(void 0===e&&void 0===t){var r=this.getExtInfo("subjectDirectoryAttributes");if(void 0===r)return;e=o(this.hex,r.vidx),t=r.critical}var n={extname:"subjectDirectoryAttributes"};t&&(n.critical=!0);try{for(var s=i(e),a=[],c=0;c<s.seq.length;c++){var h=s.seq[c],l=rt(h,"seq.0.oid"),u=rt(h,"seq.1.set");if(null==l||null==u)throw"error";a.push({attr:l,array:u})}return n.array=a,n}catch(e){throw new Error("malformed subjectDirectoryAttributes extension value")}};var b=function(e){var t={};try{var r=e.seq[0].oid,n=he.asn1.x509.OID.name2oid(r);t.type=he.asn1.x509.OID.oid2atype(n);var s=e.seq[1];if(null!=s.utf8str)t.ds="utf8",t.value=s.utf8str.str;else if(null!=s.numstr)t.ds="num",t.value=s.numstr.str;else if(null!=s.telstr)t.ds="tel",t.value=s.telstr.str;else if(null!=s.prnstr)t.ds="prn",t.value=s.prnstr.str;else if(null!=s.ia5str)t.ds="ia5",t.value=s.ia5str.str;else if(null!=s.visstr)t.ds="vis",t.value=s.visstr.str;else{if(null==s.bmpstr)throw"error";t.ds="bmp",t.value=s.bmpstr.str}return t}catch(e){throw new Erorr("improper ASN.1 parsed AttrTypeAndValue")}},S=function(e){try{return e.set.map((function(e){return b(e)}))}catch(e){throw new Error("improper ASN.1 parsed RDN: "+e)}};this.getX500NameRule=function(e){for(var t=null,r=[],n=0;n<e.length;n++)for(var s=e[n],i=0;i<s.length;i++)r.push(s[i]);for(n=0;n<r.length;n++){var o=r[n],a=o.ds,c=o.value,h=o.type;if("prn"!=a&&"utf8"!=a&&"ia5"!=a)return"mixed";if("ia5"==a){if("CN"!=h)return"mixed";if(he.lang.String.isMail(c))continue;return"mixed"}if("C"==h){if("prn"==a)continue;return"mixed"}if(null==t)t=a;else if(t!==a)return"mixed"}return null==t?"prn":t},this.getAttrTypeAndValue=function(e){var t=i(e);return b(t)},this.getRDN=function(e){var t=i(e);return S(t)},this.getX500NameArray=function(e){return function(e){try{return e.seq.map((function(e){return S(e)}))}catch(e){throw new Error("improper ASN.1 parsed X500Name: "+e)}}(i(e))},this.getX500Name=function(e,t,r){var n=this.getX500NameArray(e),s={str:this.dnarraytostr(n)};return s.array=n,1==r&&(s.hex=e),1==t&&(s.canon=this.c14nRDNArray(n)),s},this.readCertPEM=function(e){this.readCertHex(y(e))},this.readCertHex=function(e){this.hex=e,this.getVersion();try{u(this.hex,0,[0,7],"a3"),this.parseExt()}catch(e){}},this.getParam=function(e){var t={};return null==e&&(e={}),t.version=this.getVersion(),t.serial={hex:this.getSerialNumberHex()},t.sigalg=this.getSignatureAlgorithmField(),t.issuer=this.getIssuer(e.dncanon,e.dnhex),t.notbefore=this.getNotBefore(),t.notafter=this.getNotAfter(),t.subject=this.getSubject(e.dncanon,e.dnhex),t.sbjpubkey=Pe(this.getPublicKeyHex(),"PUBLIC KEY"),null!=this.aExtInfo&&this.aExtInfo.length>0&&(t.ext=this.getExtParamArray()),t.sighex=this.getSignatureValueHex(),1==e.tbshex&&(t.tbshex=h(this.hex,0,[0])),1==e.nodnarray&&(delete t.issuer.array,delete t.subject.array),t},this.getExtParamArray=function(e){null==e&&-1!=d(this.hex,0,[0,"[3]"])&&(e=l(this.hex,0,[0,"[3]",0],"30"));for(var t=[],r=n(e,0),s=0;s<r.length;s++){var i=o(e,r[s]),a=this.getExtParam(i);null!=a&&t.push(a)}return t},this.getExtParam=function(e){var t=n(e,0).length;if(2!=t&&3!=t)throw new Error("wrong number elements in Extension: "+t+" "+e);var r=f(a(e,0,[0],"06")),s=!1;3==t&&"0101ff"==h(e,0,[1])&&(s=!0);var o=h(e,0,[t-1,0]),c=void 0;if("2.5.29.14"==r?c=this.getExtSubjectKeyIdentifier(o,s):"2.5.29.15"==r?c=this.getExtKeyUsage(o,s):"2.5.29.17"==r?c=this.getExtSubjectAltName(o,s):"2.5.29.18"==r?c=this.getExtIssuerAltName(o,s):"2.5.29.19"==r?c=this.getExtBasicConstraints(o,s):"2.5.29.30"==r?c=this.getExtNameConstraints(o,s):"2.5.29.31"==r?c=this.getExtCRLDistributionPoints(o,s):"2.5.29.32"==r?c=this.getExtCertificatePolicies(o,s):"2.5.29.33"==r?c=this.getExtPolicyMappings(o,s):"2.5.29.35"==r?c=this.getExtAuthorityKeyIdentifier(o,s):"2.5.29.36"==r?c=this.getExtPolicyConstraints(o,s):"2.5.29.37"==r?c=this.getExtExtKeyUsage(o,s):"2.5.29.54"==r?c=this.getExtInhibitAnyPolicy(o,s):"1.3.6.1.5.5.7.1.1"==r?c=this.getExtAuthorityInfoAccess(o,s):"2.5.29.20"==r?c=this.getExtCRLNumber(o,s):"2.5.29.21"==r?c=this.getExtCRLReason(o,s):"2.5.29.9"==r?c=this.getExtSubjectDirectoryAttributes(o,s):"1.3.6.1.5.5.7.48.1.2"==r?c=this.getExtOcspNonce(o,s):"1.3.6.1.5.5.7.48.1.5"==r?c=this.getExtOcspNoCheck(o,s):"1.2.840.113583.1.1.9.1"==r?c=this.getExtAdobeTimeStamp(o,s):null!=ct.EXT_PARSER[r]&&(c=ct.EXT_PARSER[r](r,s,o)),null!=c)return c;var l={extname:r,extn:o};try{l.extn=i(o)}catch(e){}return s&&(l.critical=!0),l},this.findExt=function(e,t){for(var r=0;r<e.length;r++)if(e[r].extname==t)return e[r];return null},this.updateExtCDPFullURI=function(e,t){var r=this.findExt(e,"cRLDistributionPoints");if(null!=r&&null!=r.array)for(var n=r.array,s=0;s<n.length;s++)if(null!=n[s].dpname&&null!=n[s].dpname.full)for(var i=n[s].dpname.full,o=0;o<i.length;o++){var a=i[s];null!=a.uri&&(a.uri=t)}},this.updateExtAIAOCSP=function(e,t){var r=this.findExt(e,"authorityInfoAccess");if(null!=r&&null!=r.array)for(var n=r.array,s=0;s<n.length;s++)null!=n[s].ocsp&&(n[s].ocsp=t)},this.updateExtAIACAIssuer=function(e,t){var r=this.findExt(e,"authorityInfoAccess");if(null!=r&&null!=r.array)for(var n=r.array,s=0;s<n.length;s++)null!=n[s].caissuer&&(n[s].caissuer=t)},this.dnarraytostr=function(e){return"/"+e.map((function(e){return function(e){return e.map((function(e){return function(e){return e.type+"="+e.value}(e).replace(/\+/,"\\+")})).join("+")}(e).replace(/\//,"\\/")})).join("/")},this.setCanonicalizedDN=function(e){var t;if(null!=e.str&&null==e.array){var r=new he.asn1.x509.X500Name({str:e.str}).tohex();t=this.getX500NameArray(r)}else t=e.array;null==e.canon&&(e.canon=this.c14nRDNArray(t))},this.c14nRDNArray=function(e){for(var t=[],r=0;r<e.length;r++){for(var n=e[r],s=[],i=0;i<n.length;i++){var o=n[i],a=o.value;a=(a=(a=(a=a.replace(/^\s*/,"")).replace(/\s*$/,"")).replace(/\s+/g," ")).toLowerCase(),s.push(o.type.toLowerCase()+"="+a)}t.push(s.join("+"))}return"/"+t.join("/")},this.getInfo=function(){var e,t,r,n=function(e){for(var t="",r="    ",n="\n",s=e.array,i=0;i<s.length;i++){var o=s[i];null!=o.dn&&(t+=r+"dn: "+o.dn.str+n),null!=o.ip&&(t+=r+"ip: "+o.ip+n),null!=o.rfc822&&(t+=r+"rfc822: "+o.rfc822+n),null!=o.dns&&(t+=r+"dns: "+o.dns+n),null!=o.uri&&(t+=r+"uri: "+o.uri+n),null!=o.other&&(t+=r+"other: "+o.other.oid+"="+JSON.stringify(o.other.value).replace(/\"/g,"")+n)}return t.replace(/\n$/,"")},s=function(e){for(var t="",r=e.array,n=0;n<r.length;n++){var s=r[n];if(t+="    policy oid: "+s.policyoid+"\n",void 0!==s.array)for(var i=0;i<s.array.length;i++){var o=s.array[i];void 0!==o.cps&&(t+="    cps: "+o.cps+"\n")}}return t},i=function(e){for(var t="",r=e.array,n=0;n<r.length;n++){var s=r[n];try{void 0!==s.dpname.full[0].uri&&(t+="    "+s.dpname.full[0].uri+"\n")}catch(e){}try{void 0!==s.dname.full[0].dn.hex&&(t+="    "+ct.hex2dn(s.dpname.full[0].dn.hex)+"\n")}catch(e){}}return t},o=function(e){for(var t="",r=e.array,n=0;n<r.length;n++){var s=r[n];void 0!==s.caissuer&&(t+="    caissuer: "+s.caissuer+"\n"),void 0!==s.ocsp&&(t+="    ocsp: "+s.ocsp+"\n")}return t};if(e="Basic Fields\n",e+="  serial number: "+this.getSerialNumberHex()+"\n",e+="  signature algorithm: "+this.getSignatureAlgorithmField()+"\n",e+="  issuer: "+this.getIssuerString()+"\n",e+="  notBefore: "+this.getNotBefore()+"\n",e+="  notAfter: "+this.getNotAfter()+"\n",e+="  subject: "+this.getSubjectString()+"\n",e+="  subject public key info: \n",e+="    key algorithm: "+(t=this.getPublicKey()).type+"\n","RSA"===t.type&&(e+="    n="+Ke(t.n.toString(16)).substr(0,16)+"...\n",e+="    e="+Ke(t.e.toString(16))+"\n"),null!=(r=this.aExtInfo)){e+="X509v3 Extensions:\n";for(var a=0;a<r.length;a++){var c=r[a],h=he.asn1.x509.OID.oid2name(c.oid);""===h&&(h=c.oid);var l="";if(!0===c.critical&&(l="CRITICAL"),e+="  "+h+" "+l+":\n","basicConstraints"===h){var u=this.getExtBasicConstraints();void 0===u.cA?e+="    {}\n":(e+="    cA=true",void 0!==u.pathLen&&(e+=", pathLen="+u.pathLen),e+="\n")}else{var d;if("policyMappings"==h)e+="    "+this.getExtPolicyMappings().array.map((function(e){var t=e;return t[0]+":"+t[1]})).join(", ")+"\n";else if("policyConstraints"==h)e+="    ",null!=(d=this.getExtPolicyConstraints()).reqexp&&(e+=" reqexp="+d.reqexp),null!=d.inhibit&&(e+=" inhibit="+d.inhibit),e+="\n";else if("inhibitAnyPolicy"==h)e+="    skip="+(d=this.getExtInhibitAnyPolicy()).skip+"\n";else if("keyUsage"==h)e+="    "+this.getExtKeyUsageString()+"\n";else if("subjectKeyIdentifier"==h)e+="    "+this.getExtSubjectKeyIdentifier().kid.hex+"\n";else if("authorityKeyIdentifier"==h){var p=this.getExtAuthorityKeyIdentifier();void 0!==p.kid&&(e+="    kid="+p.kid.hex+"\n")}else"extKeyUsage"==h?e+="    "+this.getExtExtKeyUsage().array.join(", ")+"\n":"subjectAltName"==h?e+=n(this.getExtSubjectAltName())+"\n":"cRLDistributionPoints"==h?e+=i(this.getExtCRLDistributionPoints()):"authorityInfoAccess"==h?e+=o(this.getExtAuthorityInfoAccess()):"certificatePolicies"==h&&(e+=s(this.getExtCertificatePolicies()))}}}return(e+="signature algorithm: "+this.getSignatureAlgorithmName()+"\n")+"signature: "+this.getSignatureValueHex().substr(0,16)+"...\n"},"string"==typeof e&&(-1!=e.indexOf("-----BEGIN")?this.readCertPEM(e):he.lang.String.isHex(e)&&this.readCertHex(e))}st.getKey=function(e,t,r){var n,s=(y=de).getChildIdx,i=(y.getV,y.getVbyList),o=he.crypto,a=o.ECDSA,c=o.DSA,h=ne,l=Re,u=st;if(void 0!==h&&e instanceof h)return e;if(void 0!==a&&e instanceof a)return e;if(void 0!==c&&e instanceof c)return e;if(void 0!==e.curve&&void 0!==e.xy&&void 0===e.d)return new a({pub:e.xy,curve:e.curve});if(void 0!==e.curve&&void 0!==e.d)return new a({prv:e.d,curve:e.curve});if(void 0===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0===e.d)return(P=new h).setPublic(e.n,e.e),P;if(void 0===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0!==e.d&&void 0!==e.p&&void 0!==e.q&&void 0!==e.dp&&void 0!==e.dq&&void 0!==e.co&&void 0===e.qi)return(P=new h).setPrivateEx(e.n,e.e,e.d,e.p,e.q,e.dp,e.dq,e.co),P;if(void 0===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0!==e.d&&void 0===e.p)return(P=new h).setPrivate(e.n,e.e,e.d),P;if(void 0!==e.p&&void 0!==e.q&&void 0!==e.g&&void 0!==e.y&&void 0===e.x)return(P=new c).setPublic(e.p,e.q,e.g,e.y),P;if(void 0!==e.p&&void 0!==e.q&&void 0!==e.g&&void 0!==e.y&&void 0!==e.x)return(P=new c).setPrivate(e.p,e.q,e.g,e.y,e.x),P;if("RSA"===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0===e.d)return(P=new h).setPublic(Se(e.n),Se(e.e)),P;if("RSA"===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0!==e.d&&void 0!==e.p&&void 0!==e.q&&void 0!==e.dp&&void 0!==e.dq&&void 0!==e.qi)return(P=new h).setPrivateEx(Se(e.n),Se(e.e),Se(e.d),Se(e.p),Se(e.q),Se(e.dp),Se(e.dq),Se(e.qi)),P;if("RSA"===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0!==e.d)return(P=new h).setPrivate(Se(e.n),Se(e.e),Se(e.d)),P;if("EC"===e.kty&&void 0!==e.crv&&void 0!==e.x&&void 0!==e.y&&void 0===e.d){var d=(N=new a({curve:e.crv})).ecparams.keycharlen,p="04"+("0000000000"+Se(e.x)).slice(-d)+("0000000000"+Se(e.y)).slice(-d);return N.setPublicKeyHex(p),N}if("EC"===e.kty&&void 0!==e.crv&&void 0!==e.x&&void 0!==e.y&&void 0!==e.d){d=(N=new a({curve:e.crv})).ecparams.keycharlen,p="04"+("0000000000"+Se(e.x)).slice(-d)+("0000000000"+Se(e.y)).slice(-d);var g=("0000000000"+Se(e.d)).slice(-d);return N.setPublicKeyHex(p),N.setPrivateKeyHex(g),N}if("pkcs5prv"===r){var m,f=e,y=de;if(9===(m=s(f,0)).length)(P=new h).readPKCS5PrvKeyHex(f);else if(6===m.length)(P=new c).readPKCS5PrvKeyHex(f);else{if(!(m.length>2&&"04"===f.substr(m[1],2)))throw new Error("unsupported PKCS#1/5 hexadecimal key");(P=new a).readPKCS5PrvKeyHex(f)}return P}if("pkcs8prv"===r)return u.getKeyFromPlainPrivatePKCS8Hex(e);if("pkcs8pub"===r)return u._getKeyFromPublicPKCS8Hex(e);if("x509pub"===r)return ct.getPublicKeyFromCertHex(e);if(-1!=e.indexOf("-END CERTIFICATE-",0)||-1!=e.indexOf("-END X509 CERTIFICATE-",0)||-1!=e.indexOf("-END TRUSTED CERTIFICATE-",0))return ct.getPublicKeyFromCertPEM(e);if(-1!=e.indexOf("-END PUBLIC KEY-")){var v=Re(e,"PUBLIC KEY");return u._getKeyFromPublicPKCS8Hex(v)}if(-1!=e.indexOf("-END RSA PRIVATE KEY-")&&-1==e.indexOf("4,ENCRYPTED")){var b=l(e,"RSA PRIVATE KEY");return u.getKey(b,null,"pkcs5prv")}if(-1!=e.indexOf("-END DSA PRIVATE KEY-")&&-1==e.indexOf("4,ENCRYPTED")){var w=i(n=l(e,"DSA PRIVATE KEY"),0,[1],"02"),x=i(n,0,[2],"02"),C=i(n,0,[3],"02"),E=i(n,0,[4],"02"),A=i(n,0,[5],"02");return(P=new c).setPrivate(new S(w,16),new S(x,16),new S(C,16),new S(E,16),new S(A,16)),P}if(-1!=e.indexOf("-END EC PRIVATE KEY-")&&-1==e.indexOf("4,ENCRYPTED"))return b=l(e,"EC PRIVATE KEY"),u.getKey(b,null,"pkcs5prv");if(-1!=e.indexOf("-END PRIVATE KEY-"))return u.getKeyFromPlainPrivatePKCS8PEM(e);if(-1!=e.indexOf("-END RSA PRIVATE KEY-")&&-1!=e.indexOf("4,ENCRYPTED")){var T=u.getDecryptedKeyHex(e,t),O=new ne;return O.readPKCS5PrvKeyHex(T),O}if(-1!=e.indexOf("-END EC PRIVATE KEY-")&&-1!=e.indexOf("4,ENCRYPTED")){var N,P=i(n=u.getDecryptedKeyHex(e,t),0,[1],"04"),R=i(n,0,[2,0],"06"),I=i(n,0,[3,0],"03").substr(2);if(void 0===he.crypto.OID.oidhex2name[R])throw new Error("undefined OID(hex) in KJUR.crypto.OID: "+R);return(N=new a({curve:he.crypto.OID.oidhex2name[R]})).setPublicKeyHex(I),N.setPrivateKeyHex(P),N.isPublic=!1,N}if(-1!=e.indexOf("-END DSA PRIVATE KEY-")&&-1!=e.indexOf("4,ENCRYPTED"))return w=i(n=u.getDecryptedKeyHex(e,t),0,[1],"02"),x=i(n,0,[2],"02"),C=i(n,0,[3],"02"),E=i(n,0,[4],"02"),A=i(n,0,[5],"02"),(P=new c).setPrivate(new S(w,16),new S(x,16),new S(C,16),new S(E,16),new S(A,16)),P;if(-1!=e.indexOf("-END ENCRYPTED PRIVATE KEY-"))return u.getKeyFromEncryptedPKCS8PEM(e,t);throw new Error("not supported argument")},st.generateKeypair=function(e,t){if("RSA"==e){var r=t;(o=new ne).generate(r,"10001"),o.isPrivate=!0,o.isPublic=!0;var n=new ne,s=o.n.toString(16),i=o.e.toString(16);return n.setPublic(s,i),n.isPrivate=!1,n.isPublic=!0,(a={}).prvKeyObj=o,a.pubKeyObj=n,a}if("EC"==e){var o,a,c=t,h=new he.crypto.ECDSA({curve:c}).generateKeyPairHex();return(o=new he.crypto.ECDSA({curve:c})).setPublicKeyHex(h.ecpubhex),o.setPrivateKeyHex(h.ecprvhex),o.isPrivate=!0,o.isPublic=!1,(n=new he.crypto.ECDSA({curve:c})).setPublicKeyHex(h.ecpubhex),n.isPrivate=!1,n.isPublic=!0,(a={}).prvKeyObj=o,a.pubKeyObj=n,a}throw new Error("unknown algorithm: "+e)},st.getPEM=function(e,t,r,n,s,i){var o=he,a=o.asn1,c=a.DERObjectIdentifier,h=a.DERInteger,l=a.ASN1Util.newObject,u=a.x509.SubjectPublicKeyInfo,d=o.crypto,p=d.DSA,g=d.ECDSA,m=ne;function f(e){return l({seq:[{int:0},{int:{bigint:e.n}},{int:e.e},{int:{bigint:e.d}},{int:{bigint:e.p}},{int:{bigint:e.q}},{int:{bigint:e.dmp1}},{int:{bigint:e.dmq1}},{int:{bigint:e.coeff}}]})}function y(e){return l({seq:[{int:1},{octstr:{hex:e.prvKeyHex}},{tag:["a0",!0,{oid:{name:e.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+e.pubKeyHex}}]}]})}function v(e){return l({seq:[{int:0},{int:{bigint:e.p}},{int:{bigint:e.q}},{int:{bigint:e.g}},{int:{bigint:e.y}},{int:{bigint:e.x}}]})}if((void 0!==m&&e instanceof m||void 0!==p&&e instanceof p||void 0!==g&&e instanceof g)&&1==e.isPublic&&(void 0===t||"PKCS8PUB"==t))return Pe(x=new u(e).tohex(),"PUBLIC KEY");if("PKCS1PRV"==t&&void 0!==m&&e instanceof m&&(void 0===r||null==r)&&1==e.isPrivate)return Pe(x=f(e).tohex(),"RSA PRIVATE KEY");if("PKCS1PRV"==t&&void 0!==g&&e instanceof g&&(void 0===r||null==r)&&1==e.isPrivate){var b=new c({name:e.curveName}).tohex(),S=y(e).tohex(),w="";return(w+=Pe(b,"EC PARAMETERS"))+Pe(S,"EC PRIVATE KEY")}if("PKCS1PRV"==t&&void 0!==p&&e instanceof p&&(void 0===r||null==r)&&1==e.isPrivate)return Pe(x=v(e).tohex(),"DSA PRIVATE KEY");if("PKCS5PRV"==t&&void 0!==m&&e instanceof m&&void 0!==r&&null!=r&&1==e.isPrivate){var x=f(e).tohex();return void 0===n&&(n="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",x,r,n,i)}if("PKCS5PRV"==t&&void 0!==g&&e instanceof g&&void 0!==r&&null!=r&&1==e.isPrivate)return x=y(e).tohex(),void 0===n&&(n="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",x,r,n,i);if("PKCS5PRV"==t&&void 0!==p&&e instanceof p&&void 0!==r&&null!=r&&1==e.isPrivate)return x=v(e).tohex(),void 0===n&&(n="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",x,r,n,i);var C=function(e,t){if("string"==typeof t)return st.getEncryptedPKCS8PEM(e,t);if("object"==typeof t&&null!=rt(t,"passcode")){var r=JSON.parse(JSON.stringify(t)),n=r.passcode;return delete r.passcode,st.getEncryptedPKCS8PEM(e,n,r)}};if("PKCS8PRV"==t&&null!=m&&e instanceof m&&1==e.isPrivate){var E=f(e).tohex();return x=l({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:E}}]}).tohex(),void 0===r||null==r?Pe(x,"PRIVATE KEY"):C(x,r)}if("PKCS8PRV"==t&&void 0!==g&&e instanceof g&&1==e.isPrivate){var A={seq:[{int:1},{octstr:{hex:e.prvKeyHex}}]};return"string"==typeof e.pubKeyHex&&A.seq.push({tag:["a1",!0,{bitstr:{hex:"00"+e.pubKeyHex}}]}),E=new l(A).tohex(),x=l({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:e.curveName}}]},{octstr:{hex:E}}]}).tohex(),void 0===r||null==r?Pe(x,"PRIVATE KEY"):C(x,r)}if("PKCS8PRV"==t&&void 0!==p&&e instanceof p&&1==e.isPrivate)return E=new h({bigint:e.x}).tohex(),x=l({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:e.p}},{int:{bigint:e.q}},{int:{bigint:e.g}}]}]},{octstr:{hex:E}}]}).tohex(),void 0===r||null==r?Pe(x,"PRIVATE KEY"):C(x,r);throw new Error("unsupported object nor format")},st.getKeyFromCSRPEM=function(e){var t=Re(e,"CERTIFICATE REQUEST");return st.getKeyFromCSRHex(t)},st.getKeyFromCSRHex=function(e){var t=st.parseCSRHex(e);return st.getKey(t.p8pubkeyhex,null,"pkcs8pub")},st.parseCSRHex=function(e){var t=de,r=t.getChildIdx,n=t.getTLV,s={},i=e;if("30"!=i.substr(0,2))throw new Error("malformed CSR(code:001)");var o=r(i,0);if(o.length<1)throw new Error("malformed CSR(code:002)");if("30"!=i.substr(o[0],2))throw new Error("malformed CSR(code:003)");var a=r(i,o[0]);if(a.length<3)throw new Error("malformed CSR(code:004)");return s.p8pubkeyhex=n(i,a[2]),s},st.getKeyID=function(e){var t=st,r=de;"string"==typeof e&&-1!=e.indexOf("BEGIN ")&&(e=t.getKey(e));var n=Re(t.getPEM(e)),s=r.getIdxbyList(n,0,[1]),i=r.getV(n,s).substring(2);return he.crypto.Util.hashHex(i,"sha1")},st.getJWK=function(e,t,r,n,s){var i,o,a={},c=he.crypto.Util.hashHex;if("string"==typeof e)i=st.getKey(e),-1!=e.indexOf("CERTIFICATE")&&(o=Re(e));else{if("object"!=typeof e)throw new Error("unsupported keyinfo type");e instanceof ct?(i=e.getPublicKey(),o=e.hex):i=e}if(i instanceof ne&&i.isPrivate)a.kty="RSA",a.n=be(i.n.toString(16)),a.e=be(i.e.toString(16)),a.d=be(i.d.toString(16)),a.p=be(i.p.toString(16)),a.q=be(i.q.toString(16)),a.dp=be(i.dmp1.toString(16)),a.dq=be(i.dmq1.toString(16)),a.qi=be(i.coeff.toString(16));else if(i instanceof ne&&i.isPublic)a.kty="RSA",a.n=be(i.n.toString(16)),a.e=be(i.e.toString(16));else if(i instanceof he.crypto.ECDSA&&i.isPrivate){if("P-256"!==(l=i.getShortNISTPCurveName())&&"P-384"!==l&&"P-521"!==l)throw new Error("unsupported curve name for JWT: "+l);var h=i.getPublicKeyXYHex();a.kty="EC",a.crv=l,a.x=be(h.x),a.y=be(h.y),a.d=be(i.prvKeyHex)}else if(i instanceof he.crypto.ECDSA&&i.isPublic){var l;if("P-256"!==(l=i.getShortNISTPCurveName())&&"P-384"!==l&&"P-521"!==l)throw new Error("unsupported curve name for JWT: "+l);h=i.getPublicKeyXYHex(),a.kty="EC",a.crv=l,a.x=be(h.x),a.y=be(h.y)}if(null==a.kty)throw new Error("unsupported keyinfo");return i.isPrivate||1==t||(a.kid=he.jws.JWS.getJWKthumbprint(a)),null!=o&&1!=r&&(a.x5c=[y(o)]),null!=o&&1!=n&&(a.x5t=ye(y(c(o,"sha1")))),null!=o&&1!=s&&(a["x5t#S256"]=ye(y(c(o,"sha256")))),a},st.getJWKFromKey=function(e){return st.getJWK(e,!0,!0,!0,!0)},ne.getPosArrayOfChildrenFromHex=function(e){return de.getChildIdx(e,0)},ne.getHexValueArrayOfChildrenFromHex=function(e){var t,r=de.getV,n=r(e,(t=ne.getPosArrayOfChildrenFromHex(e))[0]),s=r(e,t[1]),i=r(e,t[2]),o=r(e,t[3]),a=r(e,t[4]),c=r(e,t[5]),h=r(e,t[6]),l=r(e,t[7]),u=r(e,t[8]);return(t=new Array).push(n,s,i,o,a,c,h,l,u),t},ne.prototype.readPrivateKeyFromPEMString=function(e){var t=Re(e),r=ne.getHexValueArrayOfChildrenFromHex(t);this.setPrivateEx(r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8])},ne.prototype.readPKCS5PrvKeyHex=function(e){var t=ne.getHexValueArrayOfChildrenFromHex(e);this.setPrivateEx(t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},ne.prototype.readPKCS8PrvKeyHex=function(e){var t,r,n,s,i,o,a,c,h=de,l=h.getVbyListEx;if(!1===h.isASN1HEX(e))throw new Error("not ASN.1 hex string");try{t=l(e,0,[2,0,1],"02"),r=l(e,0,[2,0,2],"02"),n=l(e,0,[2,0,3],"02"),s=l(e,0,[2,0,4],"02"),i=l(e,0,[2,0,5],"02"),o=l(e,0,[2,0,6],"02"),a=l(e,0,[2,0,7],"02"),c=l(e,0,[2,0,8],"02")}catch(e){throw new Error("malformed PKCS#8 plain RSA private key")}this.setPrivateEx(t,r,n,s,i,o,a,c)},ne.prototype.readPKCS5PubKeyHex=function(e){var t=de,r=t.getV;if(!1===t.isASN1HEX(e))throw new Error("keyHex is not ASN.1 hex string");var n=t.getChildIdx(e,0);if(2!==n.length||"02"!==e.substr(n[0],2)||"02"!==e.substr(n[1],2))throw new Error("wrong hex for PKCS#5 public key");var s=r(e,n[0]),i=r(e,n[1]);this.setPublic(s,i)},ne.prototype.readPKCS8PubKeyHex=function(e){var t=de;if(!1===t.isASN1HEX(e))throw new Error("not ASN.1 hex string");if("06092a864886f70d010101"!==t.getTLVbyListEx(e,0,[0,0]))throw new Error("not PKCS8 RSA public key");var r=t.getTLVbyListEx(e,0,[1,0]);this.readPKCS5PubKeyHex(r)},ne.prototype.readCertPubKeyHex=function(e,t){var r,n;(r=new ct).readCertHex(e),n=r.getPublicKeyHex(),this.readPKCS8PubKeyHex(n)},ne.prototype.sign=function(e,t){var r=function(e){return he.crypto.Util.hashString(e,t)}(e);return this.signWithMessageHash(r,t)},ne.prototype.signWithMessageHash=function(e,t){var r=te(he.crypto.Util.getPaddedDigestInfoHex(e,t,this.n.bitLength()),16);return it(this.doPrivate(r).toString(16),this.n.bitLength())},ne.prototype.signPSS=function(e,t,r){var n=function(e){return he.crypto.Util.hashHex(e,t)}(Ae(e));return void 0===r&&(r=-1),this.signWithMessageHashPSS(n,t,r)},ne.prototype.signWithMessageHashPSS=function(e,t,r){var n,s=Ee(e),i=s.length,o=this.n.bitLength()-1,a=Math.ceil(o/8),c=function(e){return he.crypto.Util.hashHex(e,t)};if(-1===r||void 0===r)r=i;else if(-2===r)r=a-i-2;else if(r<-2)throw new Error("invalid salt length");if(a<i+r+2)throw new Error("data too long");var h="";r>0&&(h=new Array(r),(new ee).nextBytes(h),h=String.fromCharCode.apply(String,h));var l=Ee(c(Ae("\0\0\0\0\0\0\0\0"+s+h))),u=[];for(n=0;n<a-r-i-2;n+=1)u[n]=0;var d=String.fromCharCode.apply(String,u)+""+h,p=ot(l,d.length,c),g=[];for(n=0;n<d.length;n+=1)g[n]=d.charCodeAt(n)^p.charCodeAt(n);var m=65280>>8*a-o&255;for(g[0]&=~m,n=0;n<i;n++)g.push(l.charCodeAt(n));return g.push(188),it(this.doPrivate(new S(g)).toString(16),this.n.bitLength())},ne.prototype.verify=function(e,t){if(null==(t=t.toLowerCase()).match(/^[0-9a-f]+$/))return!1;var r=te(t,16),n=this.n.bitLength();if(r.bitLength()>n)return!1;var s=this.doPublic(r).toString(16);if(s.length+3!=n/4)return!1;var i=at(s.replace(/^1f+00/,""));if(0==i.length)return!1;var o=i[0],a=i[1],c=function(e){return he.crypto.Util.hashString(e,o)}(e);return a==c},ne.prototype.verifyWithMessageHash=function(e,t){if(t.length!=Math.ceil(this.n.bitLength()/4))return!1;var r=te(t,16);if(r.bitLength()>this.n.bitLength())return 0;var n=at(this.doPublic(r).toString(16).replace(/^1f+00/,""));return 0!=n.length&&(n[0],n[1]==e)},ne.prototype.verifyPSS=function(e,t,r,n){var s,i=(s=Ae(e),he.crypto.Util.hashHex(s,r));return void 0===n&&(n=-1),this.verifyWithMessageHashPSS(i,t,r,n)},ne.prototype.verifyWithMessageHashPSS=function(e,t,r,n){if(t.length!=Math.ceil(this.n.bitLength()/4))return!1;var s,i=new S(t,16),o=function(e){return he.crypto.Util.hashHex(e,r)},a=Ee(e),c=a.length,h=this.n.bitLength()-1,l=Math.ceil(h/8);if(-1===n||void 0===n)n=c;else if(-2===n)n=l-c-2;else if(n<-2)throw new Error("invalid salt length");if(l<c+n+2)throw new Error("data too long");var u=this.doPublic(i).toByteArray();for(s=0;s<u.length;s+=1)u[s]&=255;for(;u.length<l;)u.unshift(0);if(188!==u[l-1])throw new Error("encoded message does not end in 0xbc");var d=(u=String.fromCharCode.apply(String,u)).substr(0,l-c-1),p=u.substr(d.length,c),g=65280>>8*l-h&255;if(0!=(d.charCodeAt(0)&g))throw new Error("bits beyond keysize not zero");var m=ot(p,d.length,o),f=[];for(s=0;s<d.length;s+=1)f[s]=d.charCodeAt(s)^m.charCodeAt(s);f[0]&=~g;var y=l-c-n-2;for(s=0;s<y;s+=1)if(0!==f[s])throw new Error("leftmost octets not zero");if(1!==f[y])throw new Error("0x01 marker not found");return p===Ee(o(Ae("\0\0\0\0\0\0\0\0"+a+String.fromCharCode.apply(String,f.slice(-n)))))},ne.SALT_LEN_HLEN=-1,ne.SALT_LEN_MAX=-2,ne.SALT_LEN_RECOVER=-2,ct.EXT_PARSER={},ct.registExtParser=function(e,t){ct.EXT_PARSER[e]=t},ct.hex2dn=function(e,t){void 0===t&&(t=0);var r=new ct;return de.getTLV(e,t),r.getX500Name(e).str},ct.hex2rdn=function(e,t){if(void 0===t&&(t=0),"31"!==e.substr(t,2))throw new Error("malformed RDN");for(var r=new Array,n=de.getChildIdx(e,t),s=0;s<n.length;s++)r.push(ct.hex2attrTypeValue(e,n[s]));return r=r.map((function(e){return e.replace("+","\\+")})),r.join("+")},ct.hex2attrTypeValue=function(e,t){var r=de,n=r.getV;if(void 0===t&&(t=0),"30"!==e.substr(t,2))throw new Error("malformed attribute type and value");var s=r.getChildIdx(e,t);2!==s.length||e.substr(s[0],2);var i=n(e,s[0]),o=he.asn1.ASN1Util.oidHexToInt(i);return he.asn1.x509.OID.oid2atype(o)+"="+Ee(n(e,s[1]))},ct.getPublicKeyFromCertHex=function(e){var t=new ct;return t.readCertHex(e),t.getPublicKey()},ct.getPublicKeyFromCertPEM=function(e){var t=new ct;return t.readCertPEM(e),t.getPublicKey()},ct.getPublicKeyInfoPropOfCertPEM=function(e){var t,r,n=de.getVbyList,s={algparam:null};return(t=new ct).readCertPEM(e),r=t.getPublicKeyHex(),s.keyhex=n(r,0,[1],"03").substr(2),s.algoid=n(r,0,[0,0],"06"),"2a8648ce3d0201"===s.algoid&&(s.algparam=n(r,0,[0,1],"06")),s},ct.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"],void 0!==he&&he||(he={}),void 0!==he.jws&&he.jws||(he.jws={}),he.jws.JWS=function(){var e=he.jws.JWS.isSafeJSONString;this.parseJWS=function(t,r){if(void 0===this.parsedJWS||!r&&void 0===this.parsedJWS.sigvalH){var n=t.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(null==n)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var s=n[1],i=n[2],o=n[3],a=s+"."+i;if(this.parsedJWS={},this.parsedJWS.headB64U=s,this.parsedJWS.payloadB64U=i,this.parsedJWS.sigvalB64U=o,this.parsedJWS.si=a,!r){var c=Se(o),h=te(c,16);this.parsedJWS.sigvalH=c,this.parsedJWS.sigvalBI=h}var l=ue(s),u=ue(i);if(this.parsedJWS.headS=l,this.parsedJWS.payloadS=u,!e(l,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+l}}},he.jws.JWS.sign=function(e,t,r,n,s){var i,o,a,c=he,h=c.jws.JWS,l=h.readSafeJSONString,u=h.isSafeJSONString,d=c.crypto,p=(d.ECDSA,d.Mac),g=d.Signature,m=JSON;if("string"!=typeof t&&"object"!=typeof t)throw"spHeader must be JSON string or object: "+t;if("object"==typeof t&&(o=t,i=m.stringify(o)),"string"==typeof t){if(!u(i=t))throw"JWS Head is not safe JSON string: "+i;o=l(i)}if(a=r,"object"==typeof r&&(a=m.stringify(r)),""!=e&&null!=e||void 0===o.alg||(e=o.alg),""!=e&&null!=e&&void 0===o.alg&&(o.alg=e,i=m.stringify(o)),e!==o.alg)throw"alg and sHeader.alg doesn't match: "+e+"!="+o.alg;var f=null;if(void 0===h.jwsalg2sigalg[e])throw"unsupported alg name: "+e;f=h.jwsalg2sigalg[e];var y=le(i)+"."+le(a),v="";if("Hmac"==f.substr(0,4)){if(void 0===n)throw"mac key shall be specified for HS* alg";var b=new p({alg:f,prov:"cryptojs",pass:n});b.updateString(y),v=b.doFinal()}else if(-1!=f.indexOf("withECDSA")){(w=new g({alg:f})).init(n,s),w.updateString(y);var S=w.sign();v=he.crypto.ECDSA.asn1SigToConcatSig(S)}else{var w;"none"!=f&&((w=new g({alg:f})).init(n,s),w.updateString(y),v=w.sign())}return y+"."+be(v)},he.jws.JWS.verify=function(e,t,r){var n,s=he,i=s.jws.JWS,o=i.readSafeJSONString,a=s.crypto,c=a.ECDSA,h=a.Mac,l=a.Signature;if(n=ne,!Ge(e))return!1;var u=e.split(".");if(3!==u.length)return!1;var d,p=u[0]+"."+u[1],g=Se(u[2]),m=o(ue(u[0])),f=null;if(void 0===m.alg)throw"algorithm not specified in header";if(d=(f=m.alg).substr(0,2),null!=r&&"[object Array]"===Object.prototype.toString.call(r)&&r.length>0&&-1==(":"+r.join(":")+":").indexOf(":"+f+":"))throw"algorithm '"+f+"' not accepted in the list";if("none"!=f&&null===t)throw"key shall be specified to verify.";if("string"==typeof t&&-1!=t.indexOf("-----BEGIN ")&&(t=st.getKey(t)),!("RS"!=d&&"PS"!=d||t instanceof n))throw"key shall be a RSAKey obj for RS* and PS* algs";if("ES"==d&&!(t instanceof c))throw"key shall be a ECDSA obj for ES* algs";var y=null;if(void 0===i.jwsalg2sigalg[m.alg])throw"unsupported alg name: "+f;if("none"==(y=i.jwsalg2sigalg[f]))throw"not supported";if("Hmac"==y.substr(0,4)){if(void 0===t)throw"hexadecimal key shall be specified for HMAC";var v=new h({alg:y,pass:t});return v.updateString(p),g==v.doFinal()}if(-1!=y.indexOf("withECDSA")){var b,S=null;try{S=c.concatSigToASN1Sig(g)}catch(e){return!1}return(b=new l({alg:y})).init(t),b.updateString(p),b.verify(S)}return(b=new l({alg:y})).init(t),b.updateString(p),b.verify(g)},he.jws.JWS.parse=function(e){var t,r,n,s=e.split("."),i={};if(2!=s.length&&3!=s.length)throw"malformed sJWS: wrong number of '.' splitted elements";return t=s[0],r=s[1],3==s.length&&(n=s[2]),i.headerObj=he.jws.JWS.readSafeJSONString(ue(t)),i.payloadObj=he.jws.JWS.readSafeJSONString(ue(r)),i.headerPP=JSON.stringify(i.headerObj,null,"  "),null==i.payloadObj?i.payloadPP=ue(r):i.payloadPP=JSON.stringify(i.payloadObj,null,"  "),void 0!==n&&(i.sigHex=Se(n)),i},he.jws.JWS.verifyJWT=function(e,t,r){var n=he.jws,s=n.JWS,i=s.readSafeJSONString,o=s.inArray,a=s.includedArray;if(!Ge(e))return!1;var c=e.split(".");if(3!=c.length)return!1;var h=c[0],l=c[1],u=(Se(c[2]),i(ue(h))),d=i(ue(l));if(void 0===u.alg)return!1;if(void 0===r.alg)throw"acceptField.alg shall be specified";if(!o(u.alg,r.alg))return!1;if(void 0!==d.iss&&"object"==typeof r.iss&&!o(d.iss,r.iss))return!1;if(void 0!==d.sub&&"object"==typeof r.sub&&!o(d.sub,r.sub))return!1;if(void 0!==d.aud&&"object"==typeof r.aud)if("string"==typeof d.aud){if(!o(d.aud,r.aud))return!1}else if("object"==typeof d.aud&&!a(d.aud,r.aud))return!1;var p=n.IntDate.getNow();return void 0!==r.verifyAt&&"number"==typeof r.verifyAt&&(p=r.verifyAt),void 0!==r.gracePeriod&&"number"==typeof r.gracePeriod||(r.gracePeriod=0),!(void 0!==d.exp&&"number"==typeof d.exp&&d.exp+r.gracePeriod<p||void 0!==d.nbf&&"number"==typeof d.nbf&&p<d.nbf-r.gracePeriod||void 0!==d.iat&&"number"==typeof d.iat&&p<d.iat-r.gracePeriod||void 0!==d.jti&&void 0!==r.jti&&d.jti!==r.jti||!s.verify(e,t,r.alg))},he.jws.JWS.includedArray=function(e,t){var r=he.jws.JWS.inArray;if(null===e)return!1;if("object"!=typeof e)return!1;if("number"!=typeof e.length)return!1;for(var n=0;n<e.length;n++)if(!r(e[n],t))return!1;return!0},he.jws.JWS.inArray=function(e,t){if(null===t)return!1;if("object"!=typeof t)return!1;if("number"!=typeof t.length)return!1;for(var r=0;r<t.length;r++)if(t[r]==e)return!0;return!1},he.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",ES512:"SHA512withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},he.jws.JWS.isSafeJSONString=function(e,t,r){var n=null;try{return"object"!=typeof(n=ce(e))||n.constructor===Array?0:(t&&(t[r]=n),1)}catch(e){return 0}},he.jws.JWS.readSafeJSONString=function(e){var t=null;try{return"object"!=typeof(t=ce(e))||t.constructor===Array?null:t}catch(e){return null}},he.jws.JWS.getEncodedSignatureValueFromJWS=function(e){var t=e.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(null==t)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return t[1]},he.jws.JWS.getJWKthumbprint=function(e){if("RSA"!==e.kty&&"EC"!==e.kty&&"oct"!==e.kty)throw"unsupported algorithm for JWK Thumprint";var t="{";if("RSA"===e.kty){if("string"!=typeof e.n||"string"!=typeof e.e)throw"wrong n and e value for RSA key";t+='"e":"'+e.e+'",',t+='"kty":"'+e.kty+'",',t+='"n":"'+e.n+'"}'}else if("EC"===e.kty){if("string"!=typeof e.crv||"string"!=typeof e.x||"string"!=typeof e.y)throw"wrong crv, x and y value for EC key";t+='"crv":"'+e.crv+'",',t+='"kty":"'+e.kty+'",',t+='"x":"'+e.x+'",',t+='"y":"'+e.y+'"}'}else if("oct"===e.kty){if("string"!=typeof e.k)throw"wrong k value for oct(symmetric) key";t+='"kty":"'+e.kty+'",',t+='"k":"'+e.k+'"}'}var r=Ae(t);return be(he.crypto.Util.hashHex(r,"sha256"))},he.jws.IntDate={},he.jws.IntDate.get=function(e){var t=he.jws.IntDate,r=t.getNow,n=t.getZulu;if("now"==e)return r();if("now + 1hour"==e)return r()+3600;if("now + 1day"==e)return r()+86400;if("now + 1month"==e)return r()+2592e3;if("now + 1year"==e)return r()+31536e3;if(e.match(/Z$/))return n(e);if(e.match(/^[0-9]+$/))return parseInt(e);throw"unsupported format: "+e},he.jws.IntDate.getZulu=function(e){return Fe(e)},he.jws.IntDate.getNow=function(){return~~(new Date/1e3)},he.jws.IntDate.intDate2UTCString=function(e){return new Date(1e3*e).toUTCString()},he.jws.IntDate.intDate2Zulu=function(e){var t=new Date(1e3*e);return("0000"+t.getUTCFullYear()).slice(-4)+("00"+(t.getUTCMonth()+1)).slice(-2)+("00"+t.getUTCDate()).slice(-2)+("00"+t.getUTCHours()).slice(-2)+("00"+t.getUTCMinutes()).slice(-2)+("00"+t.getUTCSeconds()).slice(-2)+"Z"},void 0!==he&&he||(he={}),void 0!==he.jws&&he.jws||(he.jws={}),he.jws.JWSJS=function(){var e=he.jws.JWS,t=e.readSafeJSONString;this.aHeader=[],this.sPayload="",this.aSignature=[],this.init=function(){this.aHeader=[],this.sPayload=void 0,this.aSignature=[]},this.initWithJWS=function(e){this.init();var t=e.split(".");if(3!=t.length)throw"malformed input JWS";this.aHeader.push(t[0]),this.sPayload=t[1],this.aSignature.push(t[2])},this.addSignature=function(e,t,r,n){if(void 0===this.sPayload||null===this.sPayload)throw"there's no JSON-JS signature to add.";var s=this.aHeader.length;if(this.aHeader.length!=this.aSignature.length)throw"aHeader.length != aSignature.length";try{var i=he.jws.JWS.sign(e,t,this.sPayload,r,n).split(".");i[0],i[2],this.aHeader.push(i[0]),this.aSignature.push(i[2])}catch(e){throw this.aHeader.length>s&&this.aHeader.pop(),this.aSignature.length>s&&this.aSignature.pop(),"addSignature failed: "+e}},this.verifyAll=function(e){if(this.aHeader.length!==e.length||this.aSignature.length!==e.length)return!1;for(var t=0;t<e.length;t++){var r=e[t];if(2!==r.length)return!1;if(!1===this.verifyNth(t,r[0],r[1]))return!1}return!0},this.verifyNth=function(t,r,n){if(this.aHeader.length<=t||this.aSignature.length<=t)return!1;var s=this.aHeader[t],i=this.aSignature[t],o=s+"."+this.sPayload+"."+i,a=!1;try{a=e.verify(o,r,n)}catch(e){return!1}return a},this.readJWSJS=function(e){if("string"==typeof e){var r=t(e);if(null==r)throw"argument is not safe JSON object string";this.aHeader=r.headers,this.sPayload=r.payload,this.aSignature=r.signatures}else try{if(!(e.headers.length>0))throw"malformed header";if(this.aHeader=e.headers,"string"!=typeof e.payload)throw"malformed signatures";if(this.sPayload=e.payload,!(e.signatures.length>0))throw"malformed signatures";this.aSignature=e.signatures}catch(e){throw"malformed JWS-JS JSON object: "+e}},this.getJSON=function(){return{headers:this.aHeader,payload:this.sPayload,signatures:this.aSignature}},this.isEmpty=function(){return 0==this.aHeader.length?1:0}},t.SecureRandom=ee,t.rng_seed_time=$,t.BigInteger=S,t.RSAKey=ne,t.ECDSA=he.crypto.ECDSA,t.DSA=he.crypto.DSA,t.Signature=he.crypto.Signature,t.MessageDigest=he.crypto.MessageDigest,t.Mac=he.crypto.Mac,t.Cipher=he.crypto.Cipher,t.KEYUTIL=st,t.ASN1HEX=de,t.X509=ct,t.X509CRL=function(e){var t=he.lang.String.isHex,r=de,n=r.getV,s=r.getTLV,i=r.getVbyList,o=r.getTLVbyList,a=r.getTLVbyListEx,c=r.getIdxbyList,h=r.getIdxbyListEx,l=r.getChildIdx,u=new ct;this.hex=null,this.posSigAlg=null,this.posRevCert=null,this.parsed=null,this._setPos=function(){var e=c(this.hex,0,[0,0]),t=this.hex.substr(e,2);if("02"==t)this.posSigAlg=1;else{if("30"!=t)throw new Error("malformed 1st item of TBSCertList: "+t);this.posSigAlg=0}var r,n=c(this.hex,0,[0,this.posSigAlg+3]),s=this.hex.substr(n,2);if("17"==s||"18"==s)r=c(this.hex,0,[0,this.posSigAlg+4]),this.posRevCert=null,-1!=r&&"30"==this.hex.substr(r,2)&&(this.posRevCert=this.posSigAlg+4);else if("30"==s)this.posRevCert=this.posSigAlg+3;else{if("a0"!=s)throw new Error("malformed nextUpdate or revCert tag: "+s);this.posRevCert=null}},this.getVersion=function(){return 0==this.posSigAlg?null:parseInt(i(this.hex,0,[0,0],"02"),16)+1},this.getSignatureAlgorithmField=function(){var e=o(this.hex,0,[0,this.posSigAlg],"30");return u.getAlgorithmIdentifierName(e)},this.getIssuer=function(){return u.getX500Name(this.getIssuerHex())},this.getIssuerHex=function(){return o(this.hex,0,[0,this.posSigAlg+1],"30")},this.getThisUpdate=function(){var e=i(this.hex,0,[0,this.posSigAlg+2]);return result=Ee(e)},this.getNextUpdate=function(){var e=c(this.hex,0,[0,this.posSigAlg+3]),t=this.hex.substr(e,2);return"17"!=t&&"18"!=t?null:Ee(n(this.hex,e))},this.getRevCertArray=function(){if(null==this.posRevCert)return null;for(var e=[],t=c(this.hex,0,[0,this.posRevCert]),r=l(this.hex,t),n=0;n<r.length;n++){var i=s(this.hex,r[n]);e.push(this.getRevCert(i))}return e},this.getRevCert=function(e){var t={},r=l(e,0);return t.sn={hex:i(e,0,[0],"02")},t.date=Ee(i(e,0,[1])),3==r.length&&(t.ext=u.getExtParamArray(o(e,0,[2]))),t},this.findRevCert=function(e){var t=new ct(e).getSerialNumberHex();return this.findRevCertBySN(t)},this.findRevCertBySN=function(e){if(null==this.parsed&&this.getParam(),null==this.parsed.revcert)return null;for(var t=this.parsed.revcert,r=0;r<t.length;r++)if(e==t[r].sn.hex)return t[r];return null},this.getSignatureValueHex=function(){return i(this.hex,0,[2],"03",!0)},this.verifySignature=function(e){var t=this.getSignatureAlgorithmField(),r=this.getSignatureValueHex(),n=o(this.hex,0,[0],"30"),s=new he.crypto.Signature({alg:t});return s.init(e),s.updateHex(n),s.verify(r)},this.getParam=function(e){var t={},r=this.getVersion();null!=r&&(t.version=r),t.sigalg=this.getSignatureAlgorithmField(),t.issuer=this.getIssuer(),t.thisupdate=this.getThisUpdate();var n=this.getNextUpdate();null!=n&&(t.nextupdate=n);var s=this.getRevCertArray();if(null!=s&&(t.revcert=s),-1!=h(this.hex,0,[0,"[0]"])){var i=a(this.hex,0,[0,"[0]",0]);t.ext=u.getExtParamArray(i)}return t.sighex=this.getSignatureValueHex(),this.parsed=t,"object"==typeof e&&(1==e.tbshex&&(t.tbshex=o(this.hex,0,[0])),1==e.nodnarray&&delete t.issuer.array),t},"string"==typeof e&&(t(e)?this.hex=e:e.match(/-----BEGIN X509 CRL/)&&(this.hex=Re(e)),this._setPos())},t.CryptoJS=p,t.b64tohex=v,t.b64toBA=b,t.ECFieldElementFp=ie,t.ECPointFp=oe,t.ECCurveFp=ae,t.stoBA=pe,t.BAtos=ge,t.BAtohex=me,t.stohex=fe,t.stob64=function(e){return y(fe(e))},t.stob64u=function(e){return ye(y(fe(e)))},t.b64utos=function(e){return ge(b(ve(e)))},t.b64tob64u=ye,t.b64utob64=ve,t.hex2b64=y,t.hextob64u=be,t.b64utohex=Se,t.utf8tob64u=le,t.b64utoutf8=ue,t.utf8tob64=function(e){return y(De(ze(e)))},t.b64toutf8=function(e){return decodeURIComponent(Me(v(e)))},t.utf8tohex=we,t.hextoutf8=xe,t.hextorstr=Ee,t.rstrtohex=Ae,t.hextob64=Te,t.hextob64nl=function(e){return Oe(Te(e),64)},t.b64nltohex=Ne,t.hextopem=Pe,t.pemtohex=Re,t.hextoArrayBuffer=function(e){if(e.length%2!=0)throw"input is not even length";if(null==e.match(/^[0-9A-Fa-f]+$/))throw"input is not hexadecimal";for(var t=new ArrayBuffer(e.length/2),r=new DataView(t),n=0;n<e.length/2;n++)r.setUint8(n,parseInt(e.substr(2*n,2),16));return t},t.ArrayBuffertohex=function(e){for(var t="",r=new DataView(e),n=0;n<e.byteLength;n++)t+=("00"+r.getUint8(n).toString(16)).slice(-2);return t},t.zulutomsec=Ie,t.msectozulu=function(e){var t=new Date(e),r=("0000"+t.getUTCFullYear()).slice(-4),n=("00"+(t.getUTCMonth()+1)).slice(-2),s=("00"+t.getUTCDate()).slice(-2),i=("00"+t.getUTCHours()).slice(-2),o=("00"+t.getUTCMinutes()).slice(-2),a=("00"+t.getUTCSeconds()).slice(-2),c=("000"+t.getUTCMilliseconds()).slice(-3);return r+n+s+i+o+a+(c=""!=(c=c.replace(/0+$/,""))?"."+c:c)+"Z"},t.zulutosec=Fe,t.zulutodate=function(e){return new Date(Ie(e))},t.datetozulu=function(e,t,r){var n,s=e.getUTCFullYear();if(t){if(s<1950||2049<s)throw"not proper year for UTCTime: "+s;n=(""+s).slice(-2)}else n=("000"+s).slice(-4);if(n+=("0"+(e.getUTCMonth()+1)).slice(-2),n+=("0"+e.getUTCDate()).slice(-2),n+=("0"+e.getUTCHours()).slice(-2),n+=("0"+e.getUTCMinutes()).slice(-2),n+=("0"+e.getUTCSeconds()).slice(-2),r){var i=e.getUTCMilliseconds();0!==i&&(n+="."+(i=(i=("00"+i).slice(-3)).replace(/0+$/g,"")))}return n+"Z"},t.uricmptohex=De,t.hextouricmp=Me,t.ipv6tohex=qe,t.hextoipv6=Le,t.hextoip=Be,t.iptohex=_e,t.ucs2hextoutf8=Ue,t.encodeURIComponentAll=ze,t.newline_toUnix=function(e){return e.replace(/\r\n/gm,"\n")},t.newline_toDos=function(e){return(e=e.replace(/\r\n/gm,"\n")).replace(/\n/gm,"\r\n")},t.hextoposhex=Ke,t.intarystrtohex=function(e){e=(e=(e=e.replace(/^\s*\[\s*/,"")).replace(/\s*\]\s*$/,"")).replace(/\s*/g,"");try{var t=e.split(/,/).map((function(e,t,r){var n=parseInt(e);if(n<0||255<n)throw"integer not in range 0-255";return("00"+n.toString(16)).slice(-2)})).join("");return t}catch(e){throw"malformed integer array string: "+e}},t.strdiffidx=function(e,t){var r=e.length;e.length>t.length&&(r=t.length);for(var n=0;n<r;n++)if(e.charCodeAt(n)!=t.charCodeAt(n))return n;return e.length!=t.length?r:-1},t.oidtohex=We,t.hextooid=$e,t.strpad=Qe,t.bitstrtoint=Ze,t.inttobitstr=Ye,t.bitstrtobinstr=et,t.binstrtobitstr=function(e){if("string"!=typeof e)return null;if(null==e.match(/^[01]+$/))return null;try{return Ye(parseInt(e,2))}catch(e){return null}},t.isBase64URLDot=Ge,t.namearraytobinstr=tt,t.extendClass=nt,t.foldnl=Oe,t.b64topem=function(e,t){return"-----BEGIN "+t+"-----\r\n"+Oe(e,64)+"\r\n-----END "+t+"-----\r\n"},t.pemtob64=function(e){return-1==e.indexOf("-----BEGIN ")||-1==e.indexOf("-----END ")?null:(e=(e=(e=e.replace(/^[\s\S]*?-----BEGIN [^-]+-----/m,"")).replace(/-----END [\s\S]+$/m,"")).replace(/\s+/g,"")).match(/^[0-9a-zA-Z+/=]+$/)?e:null},t.timeogen=ke,t.aryval=rt,t.inttohex=Je,t.twoscompl=Xe,t.KJUR=he,t.crypto=he.crypto,t.asn1=he.asn1,t.jws=he.jws,t.lang=he.lang,t.VERSION="10.9.0",t.VERSION_FULL="jsrsasign(all) 10.9.0 (2023-11-27) (c) 2010-2023 Kenji Urushima | kjur.github.io/jsrsasign/license"},8552:(e,t,r)=>{var n=r(852)(r(5639),"DataView");e.exports=n},1989:(e,t,r)=>{var n=r(1789),s=r(401),i=r(7667),o=r(1327),a=r(1866);function c(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}c.prototype.clear=n,c.prototype.delete=s,c.prototype.get=i,c.prototype.has=o,c.prototype.set=a,e.exports=c},8407:(e,t,r)=>{var n=r(7040),s=r(4125),i=r(2117),o=r(7518),a=r(4705);function c(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}c.prototype.clear=n,c.prototype.delete=s,c.prototype.get=i,c.prototype.has=o,c.prototype.set=a,e.exports=c},7071:(e,t,r)=>{var n=r(852)(r(5639),"Map");e.exports=n},3369:(e,t,r)=>{var n=r(4785),s=r(1285),i=r(6e3),o=r(9916),a=r(5265);function c(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}c.prototype.clear=n,c.prototype.delete=s,c.prototype.get=i,c.prototype.has=o,c.prototype.set=a,e.exports=c},3818:(e,t,r)=>{var n=r(852)(r(5639),"Promise");e.exports=n},8525:(e,t,r)=>{var n=r(852)(r(5639),"Set");e.exports=n},6384:(e,t,r)=>{var n=r(8407),s=r(7465),i=r(3779),o=r(7599),a=r(4758),c=r(4309);function h(e){var t=this.__data__=new n(e);this.size=t.size}h.prototype.clear=s,h.prototype.delete=i,h.prototype.get=o,h.prototype.has=a,h.prototype.set=c,e.exports=h},2705:(e,t,r)=>{var n=r(5639).Symbol;e.exports=n},1149:(e,t,r)=>{var n=r(5639).Uint8Array;e.exports=n},577:(e,t,r)=>{var n=r(852)(r(5639),"WeakMap");e.exports=n},6874:e=>{e.exports=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}},7412:e=>{e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}},4963:e=>{e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length,s=0,i=[];++r<n;){var o=e[r];t(o,r,e)&&(i[s++]=o)}return i}},4636:(e,t,r)=>{var n=r(2545),s=r(5694),i=r(1469),o=r(4144),a=r(5776),c=r(6719),h=Object.prototype.hasOwnProperty;e.exports=function(e,t){var r=i(e),l=!r&&s(e),u=!r&&!l&&o(e),d=!r&&!l&&!u&&c(e),p=r||l||u||d,g=p?n(e.length,String):[],m=g.length;for(var f in e)!t&&!h.call(e,f)||p&&("length"==f||u&&("offset"==f||"parent"==f)||d&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||a(f,m))||g.push(f);return g}},2488:e=>{e.exports=function(e,t){for(var r=-1,n=t.length,s=e.length;++r<n;)e[s+r]=t[r];return e}},6556:(e,t,r)=>{var n=r(9465),s=r(7813);e.exports=function(e,t,r){(void 0!==r&&!s(e[t],r)||void 0===r&&!(t in e))&&n(e,t,r)}},4865:(e,t,r)=>{var n=r(9465),s=r(7813),i=Object.prototype.hasOwnProperty;e.exports=function(e,t,r){var o=e[t];i.call(e,t)&&s(o,r)&&(void 0!==r||t in e)||n(e,t,r)}},8470:(e,t,r)=>{var n=r(7813);e.exports=function(e,t){for(var r=e.length;r--;)if(n(e[r][0],t))return r;return-1}},4037:(e,t,r)=>{var n=r(8363),s=r(3674);e.exports=function(e,t){return e&&n(t,s(t),e)}},3886:(e,t,r)=>{var n=r(8363),s=r(1704);e.exports=function(e,t){return e&&n(t,s(t),e)}},9465:(e,t,r)=>{var n=r(8777);e.exports=function(e,t,r){"__proto__"==t&&n?n(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}},5990:(e,t,r)=>{var n=r(6384),s=r(7412),i=r(4865),o=r(4037),a=r(3886),c=r(4626),h=r(278),l=r(8805),u=r(1911),d=r(8234),p=r(6904),g=r(4160),m=r(3824),f=r(9148),y=r(8517),v=r(1469),b=r(4144),S=r(6688),w=r(3218),x=r(2928),C=r(3674),E=r(1704),A="[object Arguments]",T="[object Function]",O="[object Object]",N={};N[A]=N["[object Array]"]=N["[object ArrayBuffer]"]=N["[object DataView]"]=N["[object Boolean]"]=N["[object Date]"]=N["[object Float32Array]"]=N["[object Float64Array]"]=N["[object Int8Array]"]=N["[object Int16Array]"]=N["[object Int32Array]"]=N["[object Map]"]=N["[object Number]"]=N[O]=N["[object RegExp]"]=N["[object Set]"]=N["[object String]"]=N["[object Symbol]"]=N["[object Uint8Array]"]=N["[object Uint8ClampedArray]"]=N["[object Uint16Array]"]=N["[object Uint32Array]"]=!0,N["[object Error]"]=N[T]=N["[object WeakMap]"]=!1,e.exports=function e(t,r,P,R,I,F){var k,D=1&r,M=2&r,q=4&r;if(P&&(k=I?P(t,R,I,F):P(t)),void 0!==k)return k;if(!w(t))return t;var L=v(t);if(L){if(k=m(t),!D)return h(t,k)}else{var B=g(t),j=B==T||"[object GeneratorFunction]"==B;if(b(t))return c(t,D);if(B==O||B==A||j&&!I){if(k=M||j?{}:y(t),!D)return M?u(t,a(k,t)):l(t,o(k,t))}else{if(!N[B])return I?t:{};k=f(t,B,D)}}F||(F=new n);var _=F.get(t);if(_)return _;F.set(t,k),x(t)?t.forEach((function(n){k.add(e(n,r,P,n,t,F))})):S(t)&&t.forEach((function(n,s){k.set(s,e(n,r,P,s,t,F))}));var H=L?void 0:(q?M?p:d:M?E:C)(t);return s(H||t,(function(n,s){H&&(n=t[s=n]),i(k,s,e(n,r,P,s,t,F))})),k}},3118:(e,t,r)=>{var n=r(3218),s=Object.create,i=function(){function e(){}return function(t){if(!n(t))return{};if(s)return s(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();e.exports=i},8483:(e,t,r)=>{var n=r(5063)();e.exports=n},8866:(e,t,r)=>{var n=r(2488),s=r(1469);e.exports=function(e,t,r){var i=t(e);return s(e)?i:n(i,r(e))}},4239:(e,t,r)=>{var n=r(2705),s=r(9607),i=r(2333),o=n?n.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":o&&o in Object(e)?s(e):i(e)}},9454:(e,t,r)=>{var n=r(4239),s=r(7005);e.exports=function(e){return s(e)&&"[object Arguments]"==n(e)}},5588:(e,t,r)=>{var n=r(4160),s=r(7005);e.exports=function(e){return s(e)&&"[object Map]"==n(e)}},8458:(e,t,r)=>{var n=r(3560),s=r(5346),i=r(3218),o=r(346),a=/^\[object .+?Constructor\]$/,c=Function.prototype,h=Object.prototype,l=c.toString,u=h.hasOwnProperty,d=RegExp("^"+l.call(u).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!i(e)||s(e))&&(n(e)?d:a).test(o(e))}},9221:(e,t,r)=>{var n=r(4160),s=r(7005);e.exports=function(e){return s(e)&&"[object Set]"==n(e)}},8749:(e,t,r)=>{var n=r(4239),s=r(1780),i=r(7005),o={};o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o["[object Arguments]"]=o["[object Array]"]=o["[object ArrayBuffer]"]=o["[object Boolean]"]=o["[object DataView]"]=o["[object Date]"]=o["[object Error]"]=o["[object Function]"]=o["[object Map]"]=o["[object Number]"]=o["[object Object]"]=o["[object RegExp]"]=o["[object Set]"]=o["[object String]"]=o["[object WeakMap]"]=!1,e.exports=function(e){return i(e)&&s(e.length)&&!!o[n(e)]}},280:(e,t,r)=>{var n=r(5726),s=r(6916),i=Object.prototype.hasOwnProperty;e.exports=function(e){if(!n(e))return s(e);var t=[];for(var r in Object(e))i.call(e,r)&&"constructor"!=r&&t.push(r);return t}},313:(e,t,r)=>{var n=r(3218),s=r(5726),i=r(3498),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!n(e))return i(e);var t=s(e),r=[];for(var a in e)("constructor"!=a||!t&&o.call(e,a))&&r.push(a);return r}},2980:(e,t,r)=>{var n=r(6384),s=r(6556),i=r(8483),o=r(9783),a=r(3218),c=r(1704),h=r(6390);e.exports=function e(t,r,l,u,d){t!==r&&i(r,(function(i,c){if(d||(d=new n),a(i))o(t,r,c,l,e,u,d);else{var p=u?u(h(t,c),i,c+"",t,r,d):void 0;void 0===p&&(p=i),s(t,c,p)}}),c)}},9783:(e,t,r)=>{var n=r(6556),s=r(4626),i=r(7133),o=r(278),a=r(8517),c=r(5694),h=r(1469),l=r(9246),u=r(4144),d=r(3560),p=r(3218),g=r(8630),m=r(6719),f=r(6390),y=r(9881);e.exports=function(e,t,r,v,b,S,w){var x=f(e,r),C=f(t,r),E=w.get(C);if(E)n(e,r,E);else{var A=S?S(x,C,r+"",e,t,w):void 0,T=void 0===A;if(T){var O=h(C),N=!O&&u(C),P=!O&&!N&&m(C);A=C,O||N||P?h(x)?A=x:l(x)?A=o(x):N?(T=!1,A=s(C,!0)):P?(T=!1,A=i(C,!0)):A=[]:g(C)||c(C)?(A=x,c(x)?A=y(x):p(x)&&!d(x)||(A=a(C))):T=!1}T&&(w.set(C,A),b(A,C,v,S,w),w.delete(C)),n(e,r,A)}}},5976:(e,t,r)=>{var n=r(6557),s=r(5357),i=r(61);e.exports=function(e,t){return i(s(e,t,n),e+"")}},6560:(e,t,r)=>{var n=r(5703),s=r(8777),i=r(6557),o=s?function(e,t){return s(e,"toString",{configurable:!0,enumerable:!1,value:n(t),writable:!0})}:i;e.exports=o},2545:e=>{e.exports=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}},1717:e=>{e.exports=function(e){return function(t){return e(t)}}},4318:(e,t,r)=>{var n=r(1149);e.exports=function(e){var t=new e.constructor(e.byteLength);return new n(t).set(new n(e)),t}},4626:(e,t,r)=>{e=r.nmd(e);var n=r(5639),s=t&&!t.nodeType&&t,i=s&&e&&!e.nodeType&&e,o=i&&i.exports===s?n.Buffer:void 0,a=o?o.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var r=e.length,n=a?a(r):new e.constructor(r);return e.copy(n),n}},7157:(e,t,r)=>{var n=r(4318);e.exports=function(e,t){var r=t?n(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}},3147:e=>{var t=/\w*$/;e.exports=function(e){var r=new e.constructor(e.source,t.exec(e));return r.lastIndex=e.lastIndex,r}},419:(e,t,r)=>{var n=r(2705),s=n?n.prototype:void 0,i=s?s.valueOf:void 0;e.exports=function(e){return i?Object(i.call(e)):{}}},7133:(e,t,r)=>{var n=r(4318);e.exports=function(e,t){var r=t?n(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}},278:e=>{e.exports=function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}},8363:(e,t,r)=>{var n=r(4865),s=r(9465);e.exports=function(e,t,r,i){var o=!r;r||(r={});for(var a=-1,c=t.length;++a<c;){var h=t[a],l=i?i(r[h],e[h],h,r,e):void 0;void 0===l&&(l=e[h]),o?s(r,h,l):n(r,h,l)}return r}},8805:(e,t,r)=>{var n=r(8363),s=r(9551);e.exports=function(e,t){return n(e,s(e),t)}},1911:(e,t,r)=>{var n=r(8363),s=r(1442);e.exports=function(e,t){return n(e,s(e),t)}},4429:(e,t,r)=>{var n=r(5639)["__core-js_shared__"];e.exports=n},1463:(e,t,r)=>{var n=r(5976),s=r(6612);e.exports=function(e){return n((function(t,r){var n=-1,i=r.length,o=i>1?r[i-1]:void 0,a=i>2?r[2]:void 0;for(o=e.length>3&&"function"==typeof o?(i--,o):void 0,a&&s(r[0],r[1],a)&&(o=i<3?void 0:o,i=1),t=Object(t);++n<i;){var c=r[n];c&&e(t,c,n,o)}return t}))}},5063:e=>{e.exports=function(e){return function(t,r,n){for(var s=-1,i=Object(t),o=n(t),a=o.length;a--;){var c=o[e?a:++s];if(!1===r(i[c],c,i))break}return t}}},8777:(e,t,r)=>{var n=r(852),s=function(){try{var e=n(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=s},1957:(e,t,r)=>{var n="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g;e.exports=n},8234:(e,t,r)=>{var n=r(8866),s=r(9551),i=r(3674);e.exports=function(e){return n(e,i,s)}},6904:(e,t,r)=>{var n=r(8866),s=r(1442),i=r(1704);e.exports=function(e){return n(e,i,s)}},5050:(e,t,r)=>{var n=r(7019);e.exports=function(e,t){var r=e.__data__;return n(t)?r["string"==typeof t?"string":"hash"]:r.map}},852:(e,t,r)=>{var n=r(8458),s=r(7801);e.exports=function(e,t){var r=s(e,t);return n(r)?r:void 0}},5924:(e,t,r)=>{var n=r(5569)(Object.getPrototypeOf,Object);e.exports=n},9607:(e,t,r)=>{var n=r(2705),s=Object.prototype,i=s.hasOwnProperty,o=s.toString,a=n?n.toStringTag:void 0;e.exports=function(e){var t=i.call(e,a),r=e[a];try{e[a]=void 0;var n=!0}catch(e){}var s=o.call(e);return n&&(t?e[a]=r:delete e[a]),s}},9551:(e,t,r)=>{var n=r(4963),s=r(479),i=Object.prototype.propertyIsEnumerable,o=Object.getOwnPropertySymbols,a=o?function(e){return null==e?[]:(e=Object(e),n(o(e),(function(t){return i.call(e,t)})))}:s;e.exports=a},1442:(e,t,r)=>{var n=r(2488),s=r(5924),i=r(9551),o=r(479),a=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)n(t,i(e)),e=s(e);return t}:o;e.exports=a},4160:(e,t,r)=>{var n=r(8552),s=r(7071),i=r(3818),o=r(8525),a=r(577),c=r(4239),h=r(346),l="[object Map]",u="[object Promise]",d="[object Set]",p="[object WeakMap]",g="[object DataView]",m=h(n),f=h(s),y=h(i),v=h(o),b=h(a),S=c;(n&&S(new n(new ArrayBuffer(1)))!=g||s&&S(new s)!=l||i&&S(i.resolve())!=u||o&&S(new o)!=d||a&&S(new a)!=p)&&(S=function(e){var t=c(e),r="[object Object]"==t?e.constructor:void 0,n=r?h(r):"";if(n)switch(n){case m:return g;case f:return l;case y:return u;case v:return d;case b:return p}return t}),e.exports=S},7801:e=>{e.exports=function(e,t){return null==e?void 0:e[t]}},1789:(e,t,r)=>{var n=r(4536);e.exports=function(){this.__data__=n?n(null):{},this.size=0}},401:e=>{e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},7667:(e,t,r)=>{var n=r(4536),s=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(n){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return s.call(t,e)?t[e]:void 0}},1327:(e,t,r)=>{var n=r(4536),s=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return n?void 0!==t[e]:s.call(t,e)}},1866:(e,t,r)=>{var n=r(4536);e.exports=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=n&&void 0===t?"__lodash_hash_undefined__":t,this}},3824:e=>{var t=Object.prototype.hasOwnProperty;e.exports=function(e){var r=e.length,n=new e.constructor(r);return r&&"string"==typeof e[0]&&t.call(e,"index")&&(n.index=e.index,n.input=e.input),n}},9148:(e,t,r)=>{var n=r(4318),s=r(7157),i=r(3147),o=r(419),a=r(7133);e.exports=function(e,t,r){var c=e.constructor;switch(t){case"[object ArrayBuffer]":return n(e);case"[object Boolean]":case"[object Date]":return new c(+e);case"[object DataView]":return s(e,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return a(e,r);case"[object Map]":case"[object Set]":return new c;case"[object Number]":case"[object String]":return new c(e);case"[object RegExp]":return i(e);case"[object Symbol]":return o(e)}}},8517:(e,t,r)=>{var n=r(3118),s=r(5924),i=r(5726);e.exports=function(e){return"function"!=typeof e.constructor||i(e)?{}:n(s(e))}},5776:e=>{var t=/^(?:0|[1-9]\d*)$/;e.exports=function(e,r){var n=typeof e;return!!(r=null==r?9007199254740991:r)&&("number"==n||"symbol"!=n&&t.test(e))&&e>-1&&e%1==0&&e<r}},6612:(e,t,r)=>{var n=r(7813),s=r(8612),i=r(5776),o=r(3218);e.exports=function(e,t,r){if(!o(r))return!1;var a=typeof t;return!!("number"==a?s(r)&&i(t,r.length):"string"==a&&t in r)&&n(r[t],e)}},7019:e=>{e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},5346:(e,t,r)=>{var n,s=r(4429),i=(n=/[^.]+$/.exec(s&&s.keys&&s.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"";e.exports=function(e){return!!i&&i in e}},5726:e=>{var t=Object.prototype;e.exports=function(e){var r=e&&e.constructor;return e===("function"==typeof r&&r.prototype||t)}},7040:e=>{e.exports=function(){this.__data__=[],this.size=0}},4125:(e,t,r)=>{var n=r(8470),s=Array.prototype.splice;e.exports=function(e){var t=this.__data__,r=n(t,e);return!(r<0||(r==t.length-1?t.pop():s.call(t,r,1),--this.size,0))}},2117:(e,t,r)=>{var n=r(8470);e.exports=function(e){var t=this.__data__,r=n(t,e);return r<0?void 0:t[r][1]}},7518:(e,t,r)=>{var n=r(8470);e.exports=function(e){return n(this.__data__,e)>-1}},4705:(e,t,r)=>{var n=r(8470);e.exports=function(e,t){var r=this.__data__,s=n(r,e);return s<0?(++this.size,r.push([e,t])):r[s][1]=t,this}},4785:(e,t,r)=>{var n=r(1989),s=r(8407),i=r(7071);e.exports=function(){this.size=0,this.__data__={hash:new n,map:new(i||s),string:new n}}},1285:(e,t,r)=>{var n=r(5050);e.exports=function(e){var t=n(this,e).delete(e);return this.size-=t?1:0,t}},6e3:(e,t,r)=>{var n=r(5050);e.exports=function(e){return n(this,e).get(e)}},9916:(e,t,r)=>{var n=r(5050);e.exports=function(e){return n(this,e).has(e)}},5265:(e,t,r)=>{var n=r(5050);e.exports=function(e,t){var r=n(this,e),s=r.size;return r.set(e,t),this.size+=r.size==s?0:1,this}},4536:(e,t,r)=>{var n=r(852)(Object,"create");e.exports=n},6916:(e,t,r)=>{var n=r(5569)(Object.keys,Object);e.exports=n},3498:e=>{e.exports=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}},1167:(e,t,r)=>{e=r.nmd(e);var n=r(1957),s=t&&!t.nodeType&&t,i=s&&e&&!e.nodeType&&e,o=i&&i.exports===s&&n.process,a=function(){try{return i&&i.require&&i.require("util").types||o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=a},2333:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},5569:e=>{e.exports=function(e,t){return function(r){return e(t(r))}}},5357:(e,t,r)=>{var n=r(6874),s=Math.max;e.exports=function(e,t,r){return t=s(void 0===t?e.length-1:t,0),function(){for(var i=arguments,o=-1,a=s(i.length-t,0),c=Array(a);++o<a;)c[o]=i[t+o];o=-1;for(var h=Array(t+1);++o<t;)h[o]=i[o];return h[t]=r(c),n(e,this,h)}}},5639:(e,t,r)=>{var n=r(1957),s="object"==typeof self&&self&&self.Object===Object&&self,i=n||s||Function("return this")();e.exports=i},6390:e=>{e.exports=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}},61:(e,t,r)=>{var n=r(6560),s=r(1275)(n);e.exports=s},1275:e=>{var t=Date.now;e.exports=function(e){var r=0,n=0;return function(){var s=t(),i=16-(s-n);if(n=s,i>0){if(++r>=800)return arguments[0]}else r=0;return e.apply(void 0,arguments)}}},7465:(e,t,r)=>{var n=r(8407);e.exports=function(){this.__data__=new n,this.size=0}},3779:e=>{e.exports=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}},7599:e=>{e.exports=function(e){return this.__data__.get(e)}},4758:e=>{e.exports=function(e){return this.__data__.has(e)}},4309:(e,t,r)=>{var n=r(8407),s=r(7071),i=r(3369);e.exports=function(e,t){var r=this.__data__;if(r instanceof n){var o=r.__data__;if(!s||o.length<199)return o.push([e,t]),this.size=++r.size,this;r=this.__data__=new i(o)}return r.set(e,t),this.size=r.size,this}},346:e=>{var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},361:(e,t,r)=>{var n=r(5990);e.exports=function(e){return n(e,5)}},5703:e=>{e.exports=function(e){return function(){return e}}},7813:e=>{e.exports=function(e,t){return e===t||e!=e&&t!=t}},6557:e=>{e.exports=function(e){return e}},5694:(e,t,r)=>{var n=r(9454),s=r(7005),i=Object.prototype,o=i.hasOwnProperty,a=i.propertyIsEnumerable,c=n(function(){return arguments}())?n:function(e){return s(e)&&o.call(e,"callee")&&!a.call(e,"callee")};e.exports=c},1469:e=>{var t=Array.isArray;e.exports=t},8612:(e,t,r)=>{var n=r(3560),s=r(1780);e.exports=function(e){return null!=e&&s(e.length)&&!n(e)}},9246:(e,t,r)=>{var n=r(8612),s=r(7005);e.exports=function(e){return s(e)&&n(e)}},4144:(e,t,r)=>{e=r.nmd(e);var n=r(5639),s=r(5062),i=t&&!t.nodeType&&t,o=i&&e&&!e.nodeType&&e,a=o&&o.exports===i?n.Buffer:void 0,c=(a?a.isBuffer:void 0)||s;e.exports=c},3560:(e,t,r)=>{var n=r(4239),s=r(3218);e.exports=function(e){if(!s(e))return!1;var t=n(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},1780:e=>{e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},6688:(e,t,r)=>{var n=r(5588),s=r(1717),i=r(1167),o=i&&i.isMap,a=o?s(o):n;e.exports=a},3218:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},7005:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},8630:(e,t,r)=>{var n=r(4239),s=r(5924),i=r(7005),o=Function.prototype,a=Object.prototype,c=o.toString,h=a.hasOwnProperty,l=c.call(Object);e.exports=function(e){if(!i(e)||"[object Object]"!=n(e))return!1;var t=s(e);if(null===t)return!0;var r=h.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&c.call(r)==l}},2928:(e,t,r)=>{var n=r(9221),s=r(1717),i=r(1167),o=i&&i.isSet,a=o?s(o):n;e.exports=a},6719:(e,t,r)=>{var n=r(8749),s=r(1717),i=r(1167),o=i&&i.isTypedArray,a=o?s(o):n;e.exports=a},3674:(e,t,r)=>{var n=r(4636),s=r(280),i=r(8612);e.exports=function(e){return i(e)?n(e):s(e)}},1704:(e,t,r)=>{var n=r(4636),s=r(313),i=r(8612);e.exports=function(e){return i(e)?n(e,!0):s(e)}},2492:(e,t,r)=>{var n=r(2980),s=r(1463)((function(e,t,r){n(e,t,r)}));e.exports=s},479:e=>{e.exports=function(){return[]}},5062:e=>{e.exports=function(){return!1}},9881:(e,t,r)=>{var n=r(8363),s=r(1704);e.exports=function(e){return n(e,s(e))}},8908:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tag=t.log=t.LogLevel=t.Log=void 0;let r=function(e){return e.DEBUG="DEBUG",e.TRACE="TRACE",e.INFO="INFO",e.WARN="WARN",e.ERROR="ERROR",e.OFF="OFF",e}({});t.LogLevel=r;var n=function(e){return e[e.DEBUG=1]="DEBUG",e[e.TRACE=2]="TRACE",e[e.INFO=3]="INFO",e[e.WARN=4]="WARN",e[e.ERROR=5]="ERROR",e[e.OFF=6]="OFF",e}(n||{});const s={};t.tag=s;class i{_tagToLevel={};init(e,t){for(const t in e)this._tagToLevel[t]=n[e[t]]||1;void 0!==t&&(this._callback=t);for(const e in this._tagToLevel)s[e]=e;return this}error(e,t,...r){this.log(n.ERROR,e,t,r)}warn(e,t,...r){this.log(n.WARN,e,t,r)}info(e,t,...r){this.log(n.INFO,e,t,r)}trace(e,t,...r){this.log(n.TRACE,e,t,r)}debug(e,t,...r){this.log(n.DEBUG,e,t,r)}log(e,t,r,s){this._callback&&e>=(this._tagToLevel[t]??n.DEBUG)&&this._callback(n[e],t,r,s)}}t.Log=i;const o=new i;t.log=o},631:(e,t,r)=>{var n="function"==typeof Map&&Map.prototype,s=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,i=n&&s&&"function"==typeof s.get?s.get:null,o=n&&Map.prototype.forEach,a="function"==typeof Set&&Set.prototype,c=Object.getOwnPropertyDescriptor&&a?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,h=a&&c&&"function"==typeof c.get?c.get:null,l=a&&Set.prototype.forEach,u="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,d="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,p="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,g=Boolean.prototype.valueOf,m=Object.prototype.toString,f=Function.prototype.toString,y=String.prototype.match,v=String.prototype.slice,b=String.prototype.replace,S=String.prototype.toUpperCase,w=String.prototype.toLowerCase,x=RegExp.prototype.test,C=Array.prototype.concat,E=Array.prototype.join,A=Array.prototype.slice,T=Math.floor,O="function"==typeof BigInt?BigInt.prototype.valueOf:null,N=Object.getOwnPropertySymbols,P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,R="function"==typeof Symbol&&"object"==typeof Symbol.iterator,I="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol.toStringTag,1)?Symbol.toStringTag:null,F=Object.prototype.propertyIsEnumerable,k=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function D(e,t){if(e===1/0||e===-1/0||e!=e||e&&e>-1e3&&e<1e3||x.call(/e/,t))return t;var r=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof e){var n=e<0?-T(-e):T(e);if(n!==e){var s=String(n),i=v.call(t,s.length+1);return b.call(s,r,"$&_")+"."+b.call(b.call(i,/([0-9]{3})/g,"$&_"),/_$/,"")}}return b.call(t,r,"$&_")}var M=r(4654),q=M.custom,L=U(q)?q:null;function B(e,t,r){var n="double"===(r.quoteStyle||t)?'"':"'";return n+e+n}function j(e){return b.call(String(e),/"/g,"&quot;")}function _(e){return!("[object Array]"!==G(e)||I&&"object"==typeof e&&I in e)}function H(e){return!("[object RegExp]"!==G(e)||I&&"object"==typeof e&&I in e)}function U(e){if(R)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||!P)return!1;try{return P.call(e),!0}catch(e){}return!1}e.exports=function e(t,n,s,a){var c=n||{};if(V(c,"quoteStyle")&&"single"!==c.quoteStyle&&"double"!==c.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(V(c,"maxStringLength")&&("number"==typeof c.maxStringLength?c.maxStringLength<0&&c.maxStringLength!==1/0:null!==c.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var m=!V(c,"customInspect")||c.customInspect;if("boolean"!=typeof m&&"symbol"!==m)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(V(c,"indent")&&null!==c.indent&&"\t"!==c.indent&&!(parseInt(c.indent,10)===c.indent&&c.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(V(c,"numericSeparator")&&"boolean"!=typeof c.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var S=c.numericSeparator;if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return W(t,c);if("number"==typeof t){if(0===t)return 1/0/t>0?"0":"-0";var x=String(t);return S?D(t,x):x}if("bigint"==typeof t){var T=String(t)+"n";return S?D(t,T):T}var N=void 0===c.depth?5:c.depth;if(void 0===s&&(s=0),s>=N&&N>0&&"object"==typeof t)return _(t)?"[Array]":"[Object]";var q,z=function(e,t){var r;if("\t"===e.indent)r="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;r=E.call(Array(e.indent+1)," ")}return{base:r,prev:E.call(Array(t+1),r)}}(c,s);if(void 0===a)a=[];else if(K(a,t)>=0)return"[Circular]";function $(t,r,n){if(r&&(a=A.call(a)).push(r),n){var i={depth:c.depth};return V(c,"quoteStyle")&&(i.quoteStyle=c.quoteStyle),e(t,i,s+1,a)}return e(t,c,s+1,a)}if("function"==typeof t&&!H(t)){var ee=function(e){if(e.name)return e.name;var t=y.call(f.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}(t),te=Y(t,$);return"[Function"+(ee?": "+ee:" (anonymous)")+"]"+(te.length>0?" { "+E.call(te,", ")+" }":"")}if(U(t)){var re=R?b.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):P.call(t);return"object"!=typeof t||R?re:J(re)}if((q=t)&&"object"==typeof q&&("undefined"!=typeof HTMLElement&&q instanceof HTMLElement||"string"==typeof q.nodeName&&"function"==typeof q.getAttribute)){for(var ne="<"+w.call(String(t.nodeName)),se=t.attributes||[],ie=0;ie<se.length;ie++)ne+=" "+se[ie].name+"="+B(j(se[ie].value),"double",c);return ne+=">",t.childNodes&&t.childNodes.length&&(ne+="..."),ne+"</"+w.call(String(t.nodeName))+">"}if(_(t)){if(0===t.length)return"[]";var oe=Y(t,$);return z&&!function(e){for(var t=0;t<e.length;t++)if(K(e[t],"\n")>=0)return!1;return!0}(oe)?"["+Z(oe,z)+"]":"[ "+E.call(oe,", ")+" ]"}if(function(e){return!("[object Error]"!==G(e)||I&&"object"==typeof e&&I in e)}(t)){var ae=Y(t,$);return"cause"in Error.prototype||!("cause"in t)||F.call(t,"cause")?0===ae.length?"["+String(t)+"]":"{ ["+String(t)+"] "+E.call(ae,", ")+" }":"{ ["+String(t)+"] "+E.call(C.call("[cause]: "+$(t.cause),ae),", ")+" }"}if("object"==typeof t&&m){if(L&&"function"==typeof t[L]&&M)return M(t,{depth:N-s});if("symbol"!==m&&"function"==typeof t.inspect)return t.inspect()}if(function(e){if(!i||!e||"object"!=typeof e)return!1;try{i.call(e);try{h.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(t)){var ce=[];return o&&o.call(t,(function(e,r){ce.push($(r,t,!0)+" => "+$(e,t))})),Q("Map",i.call(t),ce,z)}if(function(e){if(!h||!e||"object"!=typeof e)return!1;try{h.call(e);try{i.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(t)){var he=[];return l&&l.call(t,(function(e){he.push($(e,t))})),Q("Set",h.call(t),he,z)}if(function(e){if(!u||!e||"object"!=typeof e)return!1;try{u.call(e,u);try{d.call(e,d)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}(t))return X("WeakMap");if(function(e){if(!d||!e||"object"!=typeof e)return!1;try{d.call(e,d);try{u.call(e,u)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}(t))return X("WeakSet");if(function(e){if(!p||!e||"object"!=typeof e)return!1;try{return p.call(e),!0}catch(e){}return!1}(t))return X("WeakRef");if(function(e){return!("[object Number]"!==G(e)||I&&"object"==typeof e&&I in e)}(t))return J($(Number(t)));if(function(e){if(!e||"object"!=typeof e||!O)return!1;try{return O.call(e),!0}catch(e){}return!1}(t))return J($(O.call(t)));if(function(e){return!("[object Boolean]"!==G(e)||I&&"object"==typeof e&&I in e)}(t))return J(g.call(t));if(function(e){return!("[object String]"!==G(e)||I&&"object"==typeof e&&I in e)}(t))return J($(String(t)));if("undefined"!=typeof window&&t===window)return"{ [object Window] }";if(t===r.g)return"{ [object globalThis] }";if(!function(e){return!("[object Date]"!==G(e)||I&&"object"==typeof e&&I in e)}(t)&&!H(t)){var le=Y(t,$),ue=k?k(t)===Object.prototype:t instanceof Object||t.constructor===Object,de=t instanceof Object?"":"null prototype",pe=!ue&&I&&Object(t)===t&&I in t?v.call(G(t),8,-1):de?"Object":"",ge=(ue||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(pe||de?"["+E.call(C.call([],pe||[],de||[]),": ")+"] ":"");return 0===le.length?ge+"{}":z?ge+"{"+Z(le,z)+"}":ge+"{ "+E.call(le,", ")+" }"}return String(t)};var z=Object.prototype.hasOwnProperty||function(e){return e in this};function V(e,t){return z.call(e,t)}function G(e){return m.call(e)}function K(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}function W(e,t){if(e.length>t.maxStringLength){var r=e.length-t.maxStringLength,n="... "+r+" more character"+(r>1?"s":"");return W(v.call(e,0,t.maxStringLength),t)+n}return B(b.call(b.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,$),"single",t)}function $(e){var t=e.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return r?"\\"+r:"\\x"+(t<16?"0":"")+S.call(t.toString(16))}function J(e){return"Object("+e+")"}function X(e){return e+" { ? }"}function Q(e,t,r,n){return e+" ("+t+") {"+(n?Z(r,n):E.call(r,", "))+"}"}function Z(e,t){if(0===e.length)return"";var r="\n"+t.prev+t.base;return r+E.call(e,","+r)+"\n"+t.prev}function Y(e,t){var r=_(e),n=[];if(r){n.length=e.length;for(var s=0;s<e.length;s++)n[s]=V(e,s)?t(e[s],e):""}var i,o="function"==typeof N?N(e):[];if(R){i={};for(var a=0;a<o.length;a++)i["$"+o[a]]=o[a]}for(var c in e)V(e,c)&&(r&&String(Number(c))===c&&c<e.length||R&&i["$"+c]instanceof Symbol||(x.call(/[^\w$]/,c)?n.push(t(c,e)+": "+t(e[c],e)):n.push(c+": "+t(e[c],e))));if("function"==typeof N)for(var h=0;h<o.length;h++)F.call(e,o[h])&&n.push("["+t(o[h])+"]: "+t(e[o[h]],e));return n}},6470:e=>{"use strict";function t(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function r(e,t){for(var r,n="",s=0,i=-1,o=0,a=0;a<=e.length;++a){if(a<e.length)r=e.charCodeAt(a);else{if(47===r)break;r=47}if(47===r){if(i===a-1||1===o);else if(i!==a-1&&2===o){if(n.length<2||2!==s||46!==n.charCodeAt(n.length-1)||46!==n.charCodeAt(n.length-2))if(n.length>2){var c=n.lastIndexOf("/");if(c!==n.length-1){-1===c?(n="",s=0):s=(n=n.slice(0,c)).length-1-n.lastIndexOf("/"),i=a,o=0;continue}}else if(2===n.length||1===n.length){n="",s=0,i=a,o=0;continue}t&&(n.length>0?n+="/..":n="..",s=2)}else n.length>0?n+="/"+e.slice(i+1,a):n=e.slice(i+1,a),s=a-i-1;i=a,o=0}else 46===r&&-1!==o?++o:o=-1}return n}var n={resolve:function(){for(var e,n="",s=!1,i=arguments.length-1;i>=-1&&!s;i--){var o;i>=0?o=arguments[i]:(void 0===e&&(e=process.cwd()),o=e),t(o),0!==o.length&&(n=o+"/"+n,s=47===o.charCodeAt(0))}return n=r(n,!s),s?n.length>0?"/"+n:"/":n.length>0?n:"."},normalize:function(e){if(t(e),0===e.length)return".";var n=47===e.charCodeAt(0),s=47===e.charCodeAt(e.length-1);return 0!==(e=r(e,!n)).length||n||(e="."),e.length>0&&s&&(e+="/"),n?"/"+e:e},isAbsolute:function(e){return t(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,r=0;r<arguments.length;++r){var s=arguments[r];t(s),s.length>0&&(void 0===e?e=s:e+="/"+s)}return void 0===e?".":n.normalize(e)},relative:function(e,r){if(t(e),t(r),e===r)return"";if((e=n.resolve(e))===(r=n.resolve(r)))return"";for(var s=1;s<e.length&&47===e.charCodeAt(s);++s);for(var i=e.length,o=i-s,a=1;a<r.length&&47===r.charCodeAt(a);++a);for(var c=r.length-a,h=o<c?o:c,l=-1,u=0;u<=h;++u){if(u===h){if(c>h){if(47===r.charCodeAt(a+u))return r.slice(a+u+1);if(0===u)return r.slice(a+u)}else o>h&&(47===e.charCodeAt(s+u)?l=u:0===u&&(l=0));break}var d=e.charCodeAt(s+u);if(d!==r.charCodeAt(a+u))break;47===d&&(l=u)}var p="";for(u=s+l+1;u<=i;++u)u!==i&&47!==e.charCodeAt(u)||(0===p.length?p+="..":p+="/..");return p.length>0?p+r.slice(a+l):(a+=l,47===r.charCodeAt(a)&&++a,r.slice(a))},_makeLong:function(e){return e},dirname:function(e){if(t(e),0===e.length)return".";for(var r=e.charCodeAt(0),n=47===r,s=-1,i=!0,o=e.length-1;o>=1;--o)if(47===(r=e.charCodeAt(o))){if(!i){s=o;break}}else i=!1;return-1===s?n?"/":".":n&&1===s?"//":e.slice(0,s)},basename:function(e,r){if(void 0!==r&&"string"!=typeof r)throw new TypeError('"ext" argument must be a string');t(e);var n,s=0,i=-1,o=!0;if(void 0!==r&&r.length>0&&r.length<=e.length){if(r.length===e.length&&r===e)return"";var a=r.length-1,c=-1;for(n=e.length-1;n>=0;--n){var h=e.charCodeAt(n);if(47===h){if(!o){s=n+1;break}}else-1===c&&(o=!1,c=n+1),a>=0&&(h===r.charCodeAt(a)?-1==--a&&(i=n):(a=-1,i=c))}return s===i?i=c:-1===i&&(i=e.length),e.slice(s,i)}for(n=e.length-1;n>=0;--n)if(47===e.charCodeAt(n)){if(!o){s=n+1;break}}else-1===i&&(o=!1,i=n+1);return-1===i?"":e.slice(s,i)},extname:function(e){t(e);for(var r=-1,n=0,s=-1,i=!0,o=0,a=e.length-1;a>=0;--a){var c=e.charCodeAt(a);if(47!==c)-1===s&&(i=!1,s=a+1),46===c?-1===r?r=a:1!==o&&(o=1):-1!==r&&(o=-1);else if(!i){n=a+1;break}}return-1===r||-1===s||0===o||1===o&&r===s-1&&r===n+1?"":e.slice(r,s)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var r=t.dir||t.root,n=t.base||(t.name||"")+(t.ext||"");return r?r===t.root?r+n:r+"/"+n:n}(0,e)},parse:function(e){t(e);var r={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return r;var n,s=e.charCodeAt(0),i=47===s;i?(r.root="/",n=1):n=0;for(var o=-1,a=0,c=-1,h=!0,l=e.length-1,u=0;l>=n;--l)if(47!==(s=e.charCodeAt(l)))-1===c&&(h=!1,c=l+1),46===s?-1===o?o=l:1!==u&&(u=1):-1!==o&&(u=-1);else if(!h){a=l+1;break}return-1===o||-1===c||0===u||1===u&&o===c-1&&o===a+1?-1!==c&&(r.base=r.name=0===a&&i?e.slice(1,c):e.slice(a,c)):(0===a&&i?(r.name=e.slice(1,o),r.base=e.slice(1,c)):(r.name=e.slice(a,o),r.base=e.slice(a,c)),r.ext=e.slice(o,c)),a>0?r.dir=e.slice(0,a-1):i&&(r.dir="/"),r},sep:"/",delimiter:":",win32:null,posix:null};n.posix=n,e.exports=n},5798:e=>{"use strict";var t=String.prototype.replace,r=/%20/g,n="RFC3986";e.exports={default:n,formatters:{RFC1738:function(e){return t.call(e,r,"+")},RFC3986:function(e){return String(e)}},RFC1738:"RFC1738",RFC3986:n}},129:(e,t,r)=>{"use strict";var n=r(8261),s=r(5235),i=r(5798);e.exports={formats:i,parse:s,stringify:n}},5235:(e,t,r)=>{"use strict";var n=r(2769),s=Object.prototype.hasOwnProperty,i=Array.isArray,o={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:n.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},c=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},h=function(e,t,r,n){if(e){var i=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/g,a=r.depth>0&&/(\[[^[\]]*])/.exec(i),h=a?i.slice(0,a.index):i,l=[];if(h){if(!r.plainObjects&&s.call(Object.prototype,h)&&!r.allowPrototypes)return;l.push(h)}for(var u=0;r.depth>0&&null!==(a=o.exec(i))&&u<r.depth;){if(u+=1,!r.plainObjects&&s.call(Object.prototype,a[1].slice(1,-1))&&!r.allowPrototypes)return;l.push(a[1])}return a&&l.push("["+i.slice(a.index)+"]"),function(e,t,r,n){for(var s=n?t:c(t,r),i=e.length-1;i>=0;--i){var o,a=e[i];if("[]"===a&&r.parseArrays)o=[].concat(s);else{o=r.plainObjects?Object.create(null):{};var h="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,l=parseInt(h,10);r.parseArrays||""!==h?!isNaN(l)&&a!==h&&String(l)===h&&l>=0&&r.parseArrays&&l<=r.arrayLimit?(o=[])[l]=s:"__proto__"!==h&&(o[h]=s):o={0:s}}s=o}return s}(l,t,r,n)}};e.exports=function(e,t){var r=function(e){if(!e)return o;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?o.charset:e.charset;return{allowDots:void 0===e.allowDots?o.allowDots:!!e.allowDots,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:o.allowPrototypes,allowSparse:"boolean"==typeof e.allowSparse?e.allowSparse:o.allowSparse,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:o.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:o.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:o.comma,decoder:"function"==typeof e.decoder?e.decoder:o.decoder,delimiter:"string"==typeof e.delimiter||n.isRegExp(e.delimiter)?e.delimiter:o.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:o.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:o.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:o.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:o.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:o.strictNullHandling}}(t);if(""===e||null==e)return r.plainObjects?Object.create(null):{};for(var l="string"==typeof e?function(e,t){var r,h={__proto__:null},l=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,u=t.parameterLimit===1/0?void 0:t.parameterLimit,d=l.split(t.delimiter,u),p=-1,g=t.charset;if(t.charsetSentinel)for(r=0;r<d.length;++r)0===d[r].indexOf("utf8=")&&("utf8=%E2%9C%93"===d[r]?g="utf-8":"utf8=%26%2310003%3B"===d[r]&&(g="iso-8859-1"),p=r,r=d.length);for(r=0;r<d.length;++r)if(r!==p){var m,f,y=d[r],v=y.indexOf("]="),b=-1===v?y.indexOf("="):v+1;-1===b?(m=t.decoder(y,o.decoder,g,"key"),f=t.strictNullHandling?null:""):(m=t.decoder(y.slice(0,b),o.decoder,g,"key"),f=n.maybeMap(c(y.slice(b+1),t),(function(e){return t.decoder(e,o.decoder,g,"value")}))),f&&t.interpretNumericEntities&&"iso-8859-1"===g&&(f=a(f)),y.indexOf("[]=")>-1&&(f=i(f)?[f]:f),s.call(h,m)?h[m]=n.combine(h[m],f):h[m]=f}return h}(e,r):e,u=r.plainObjects?Object.create(null):{},d=Object.keys(l),p=0;p<d.length;++p){var g=d[p],m=h(g,l[g],r,"string"==typeof e);u=n.merge(u,m,r)}return!0===r.allowSparse?u:n.compact(u)}},8261:(e,t,r)=>{"use strict";var n=r(7478),s=r(2769),i=r(5798),o=Object.prototype.hasOwnProperty,a={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},c=Array.isArray,h=Array.prototype.push,l=function(e,t){h.apply(e,c(t)?t:[t])},u=Date.prototype.toISOString,d=i.default,p={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:s.encode,encodeValuesOnly:!1,format:d,formatter:i.formatters[d],indices:!1,serializeDate:function(e){return u.call(e)},skipNulls:!1,strictNullHandling:!1},g={},m=function e(t,r,i,o,a,h,u,d,m,f,y,v,b,S,w,x){for(var C,E=t,A=x,T=0,O=!1;void 0!==(A=A.get(g))&&!O;){var N=A.get(t);if(T+=1,void 0!==N){if(N===T)throw new RangeError("Cyclic object value");O=!0}void 0===A.get(g)&&(T=0)}if("function"==typeof d?E=d(r,E):E instanceof Date?E=y(E):"comma"===i&&c(E)&&(E=s.maybeMap(E,(function(e){return e instanceof Date?y(e):e}))),null===E){if(a)return u&&!S?u(r,p.encoder,w,"key",v):r;E=""}if("string"==typeof(C=E)||"number"==typeof C||"boolean"==typeof C||"symbol"==typeof C||"bigint"==typeof C||s.isBuffer(E))return u?[b(S?r:u(r,p.encoder,w,"key",v))+"="+b(u(E,p.encoder,w,"value",v))]:[b(r)+"="+b(String(E))];var P,R=[];if(void 0===E)return R;if("comma"===i&&c(E))S&&u&&(E=s.maybeMap(E,u)),P=[{value:E.length>0?E.join(",")||null:void 0}];else if(c(d))P=d;else{var I=Object.keys(E);P=m?I.sort(m):I}for(var F=o&&c(E)&&1===E.length?r+"[]":r,k=0;k<P.length;++k){var D=P[k],M="object"==typeof D&&void 0!==D.value?D.value:E[D];if(!h||null!==M){var q=c(E)?"function"==typeof i?i(F,D):F:F+(f?"."+D:"["+D+"]");x.set(t,T);var L=n();L.set(g,x),l(R,e(M,q,i,o,a,h,"comma"===i&&S&&c(E)?null:u,d,m,f,y,v,b,S,w,L))}}return R};e.exports=function(e,t){var r,s=e,h=function(e){if(!e)return p;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||p.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=i.default;if(void 0!==e.format){if(!o.call(i.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var n=i.formatters[r],s=p.filter;return("function"==typeof e.filter||c(e.filter))&&(s=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:p.addQueryPrefix,allowDots:void 0===e.allowDots?p.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:p.charsetSentinel,delimiter:void 0===e.delimiter?p.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:p.encode,encoder:"function"==typeof e.encoder?e.encoder:p.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:p.encodeValuesOnly,filter:s,format:r,formatter:n,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:p.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:p.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:p.strictNullHandling}}(t);"function"==typeof h.filter?s=(0,h.filter)("",s):c(h.filter)&&(r=h.filter);var u,d=[];if("object"!=typeof s||null===s)return"";u=t&&t.arrayFormat in a?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var g=a[u];if(t&&"commaRoundTrip"in t&&"boolean"!=typeof t.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var f="comma"===g&&t&&t.commaRoundTrip;r||(r=Object.keys(s)),h.sort&&r.sort(h.sort);for(var y=n(),v=0;v<r.length;++v){var b=r[v];h.skipNulls&&null===s[b]||l(d,m(s[b],b,g,f,h.strictNullHandling,h.skipNulls,h.encode?h.encoder:null,h.filter,h.sort,h.allowDots,h.serializeDate,h.format,h.formatter,h.encodeValuesOnly,h.charset,y))}var S=d.join(h.delimiter),w=!0===h.addQueryPrefix?"?":"";return h.charsetSentinel&&("iso-8859-1"===h.charset?w+="utf8=%26%2310003%3B&":w+="utf8=%E2%9C%93&"),S.length>0?w+S:""}},2769:(e,t,r)=>{"use strict";var n=r(5798),s=Object.prototype.hasOwnProperty,i=Array.isArray,o=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),a=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},n=0;n<e.length;++n)void 0!==e[n]&&(r[n]=e[n]);return r};e.exports={arrayToObject:a,assign:function(e,t){return Object.keys(t).reduce((function(e,r){return e[r]=t[r],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],n=0;n<t.length;++n)for(var s=t[n],o=s.obj[s.prop],a=Object.keys(o),c=0;c<a.length;++c){var h=a[c],l=o[h];"object"==typeof l&&null!==l&&-1===r.indexOf(l)&&(t.push({obj:o,prop:h}),r.push(l))}return function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(i(r)){for(var n=[],s=0;s<r.length;++s)void 0!==r[s]&&n.push(r[s]);t.obj[t.prop]=n}}}(t),e},decode:function(e,t,r){var n=e.replace(/\+/g," ");if("iso-8859-1"===r)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(e){return n}},encode:function(e,t,r,s,i){if(0===e.length)return e;var a=e;if("symbol"==typeof e?a=Symbol.prototype.toString.call(e):"string"!=typeof e&&(a=String(e)),"iso-8859-1"===r)return escape(a).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var c="",h=0;h<a.length;++h){var l=a.charCodeAt(h);45===l||46===l||95===l||126===l||l>=48&&l<=57||l>=65&&l<=90||l>=97&&l<=122||i===n.RFC1738&&(40===l||41===l)?c+=a.charAt(h):l<128?c+=o[l]:l<2048?c+=o[192|l>>6]+o[128|63&l]:l<55296||l>=57344?c+=o[224|l>>12]+o[128|l>>6&63]+o[128|63&l]:(h+=1,l=65536+((1023&l)<<10|1023&a.charCodeAt(h)),c+=o[240|l>>18]+o[128|l>>12&63]+o[128|l>>6&63]+o[128|63&l])}return c},isBuffer:function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(i(e)){for(var r=[],n=0;n<e.length;n+=1)r.push(t(e[n]));return r}return t(e)},merge:function e(t,r,n){if(!r)return t;if("object"!=typeof r){if(i(t))t.push(r);else{if(!t||"object"!=typeof t)return[t,r];(n&&(n.plainObjects||n.allowPrototypes)||!s.call(Object.prototype,r))&&(t[r]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(r);var o=t;return i(t)&&!i(r)&&(o=a(t,n)),i(t)&&i(r)?(r.forEach((function(r,i){if(s.call(t,i)){var o=t[i];o&&"object"==typeof o&&r&&"object"==typeof r?t[i]=e(o,r,n):t.push(r)}else t[i]=r})),t):Object.keys(r).reduce((function(t,i){var o=r[i];return s.call(t,i)?t[i]=e(t[i],o,n):t[i]=o,t}),o)}}},2587:e=>{"use strict";function t(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,r,n,s){r=r||"&",n=n||"=";var i={};if("string"!=typeof e||0===e.length)return i;var o=/\+/g;e=e.split(r);var a=1e3;s&&"number"==typeof s.maxKeys&&(a=s.maxKeys);var c=e.length;a>0&&c>a&&(c=a);for(var h=0;h<c;++h){var l,u,d,p,g=e[h].replace(o,"%20"),m=g.indexOf(n);m>=0?(l=g.substr(0,m),u=g.substr(m+1)):(l=g,u=""),d=decodeURIComponent(l),p=decodeURIComponent(u),t(i,d)?Array.isArray(i[d])?i[d].push(p):i[d]=[i[d],p]:i[d]=p}return i}},2361:e=>{"use strict";var t=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,r,n,s){return r=r||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map((function(s){var i=encodeURIComponent(t(s))+n;return Array.isArray(e[s])?e[s].map((function(e){return i+encodeURIComponent(t(e))})).join(r):i+encodeURIComponent(t(e[s]))})).filter(Boolean).join(r):s?encodeURIComponent(t(s))+n+encodeURIComponent(t(e)):""}},7673:(e,t,r)=>{"use strict";r(2587),t.stringify=r(2361)},7129:(e,t)=>{"use strict";var r=Object.prototype.hasOwnProperty;function n(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function s(e){try{return encodeURIComponent(e)}catch(e){return null}}t.stringify=function(e,t){t=t||"";var n,i,o=[];for(i in"string"!=typeof t&&(t="?"),e)if(r.call(e,i)){if((n=e[i])||null!=n&&!isNaN(n)||(n=""),i=s(i),n=s(n),null===i||null===n)continue;o.push(i+"="+n)}return o.length?t+o.join("&"):""},t.parse=function(e){for(var t,r=/([^=?#&]+)=?([^&]*)/g,s={};t=r.exec(e);){var i=n(t[1]),o=n(t[2]);null===i||null===o||i in s||(s[i]=o)}return s}},745:(e,t,r)=>{"use strict";var n=r(3293);t.createRoot=n.createRoot,t.hydrateRoot=n.hydrateRoot},7418:e=>{"use strict";e.exports=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}},7771:(e,t,r)=>{"use strict";var n=r(210),s=r(2296),i=r(3596)(),o=r(7296),a=n("%TypeError%"),c=n("%Math.floor%");e.exports=function(e,t){if("function"!=typeof e)throw new a("`fn` is not a function");if("number"!=typeof t||t<0||t>4294967295||c(t)!==t)throw new a("`length` must be a positive 32-bit integer");var r=arguments.length>2&&!!arguments[2],n=!0,h=!0;if("length"in e&&o){var l=o(e,"length");l&&!l.configurable&&(n=!1),l&&!l.writable&&(h=!1)}return(n||h||!r)&&(i?s(e,"length",t,!0,!0):s(e,"length",t)),e}},7478:(e,t,r)=>{"use strict";var n=r(210),s=r(1924),i=r(631),o=n("%TypeError%"),a=n("%WeakMap%",!0),c=n("%Map%",!0),h=s("WeakMap.prototype.get",!0),l=s("WeakMap.prototype.set",!0),u=s("WeakMap.prototype.has",!0),d=s("Map.prototype.get",!0),p=s("Map.prototype.set",!0),g=s("Map.prototype.has",!0),m=function(e,t){for(var r,n=e;null!==(r=n.next);n=r)if(r.key===t)return n.next=r.next,r.next=e.next,e.next=r,r};e.exports=function(){var e,t,r,n={assert:function(e){if(!n.has(e))throw new o("Side channel does not contain "+i(e))},get:function(n){if(a&&n&&("object"==typeof n||"function"==typeof n)){if(e)return h(e,n)}else if(c){if(t)return d(t,n)}else if(r)return function(e,t){var r=m(e,t);return r&&r.value}(r,n)},has:function(n){if(a&&n&&("object"==typeof n||"function"==typeof n)){if(e)return u(e,n)}else if(c){if(t)return g(t,n)}else if(r)return function(e,t){return!!m(e,t)}(r,n);return!1},set:function(n,s){a&&n&&("object"==typeof n||"function"==typeof n)?(e||(e=new a),l(e,n,s)):c?(t||(t=new c),p(t,n,s)):(r||(r={key:{},next:null}),function(e,t,r){var n=m(e,t);n?n.value=r:e.next={key:t,next:e.next,value:r}}(r,n,s))}};return n}},8280:e=>{var t=["Black","White","Gray","Brown","Red","Pink","Crimson","Carnelian","Orange","Yellow","Ivory","Cream","Green","Viridian","Aquamarine","Cyan","Blue","Cerulean","Azure","Indigo","Navy","Violet","Purple","Lavender","Magenta","Rainbow","Iridescent","Spectrum","Prism","Bold","Vivid","Pale","Clear","Glass","Translucent","Misty","Dark","Light","Gold","Silver","Copper","Bronze","Steel","Iron","Brass","Mercury","Zinc","Chrome","Platinum","Titanium","Nickel","Lead","Pewter","Rust","Metal","Stone","Quartz","Granite","Marble","Alabaster","Agate","Jasper","Pebble","Pyrite","Crystal","Geode","Obsidian","Mica","Flint","Sand","Gravel","Boulder","Basalt","Ruby","Beryl","Scarlet","Citrine","Sulpher","Topaz","Amber","Emerald","Malachite","Jade","Abalone","Lapis","Sapphire","Diamond","Peridot","Gem","Jewel","Bevel","Coral","Jet","Ebony","Wood","Tree","Cherry","Maple","Cedar","Branch","Bramble","Rowan","Ash","Fir","Pine","Cactus","Alder","Grove","Forest","Jungle","Palm","Bush","Mulberry","Juniper","Vine","Ivy","Rose","Lily","Tulip","Daffodil","Honeysuckle","Fuschia","Hazel","Walnut","Almond","Lime","Lemon","Apple","Blossom","Bloom","Crocus","Rose","Buttercup","Dandelion","Iris","Carnation","Fern","Root","Branch","Leaf","Seed","Flower","Petal","Pollen","Orchid","Mangrove","Cypress","Sequoia","Sage","Heather","Snapdragon","Daisy","Mountain","Hill","Alpine","Chestnut","Valley","Glacier","Forest","Grove","Glen","Tree","Thorn","Stump","Desert","Canyon","Dune","Oasis","Mirage","Well","Spring","Meadow","Field","Prairie","Grass","Tundra","Island","Shore","Sand","Shell","Surf","Wave","Foam","Tide","Lake","River","Brook","Stream","Pool","Pond","Sun","Sprinkle","Shade","Shadow","Rain","Cloud","Storm","Hail","Snow","Sleet","Thunder","Lightning","Wind","Hurricane","Typhoon","Dawn","Sunrise","Morning","Noon","Twilight","Evening","Sunset","Midnight","Night","Sky","Star","Stellar","Comet","Nebula","Quasar","Solar","Lunar","Planet","Meteor","Sprout","Pear","Plum","Kiwi","Berry","Apricot","Peach","Mango","Pineapple","Coconut","Olive","Ginger","Root","Plain","Fancy","Stripe","Spot","Speckle","Spangle","Ring","Band","Blaze","Paint","Pinto","Shade","Tabby","Brindle","Patch","Calico","Checker","Dot","Pattern","Glitter","Glimmer","Shimmer","Dull","Dust","Dirt","Glaze","Scratch","Quick","Swift","Fast","Slow","Clever","Fire","Flicker","Flash","Spark","Ember","Coal","Flame","Chocolate","Vanilla","Sugar","Spice","Cake","Pie","Cookie","Candy","Caramel","Spiral","Round","Jelly","Square","Narrow","Long","Short","Small","Tiny","Big","Giant","Great","Atom","Peppermint","Mint","Butter","Fringe","Rag","Quilt","Truth","Lie","Holy","Curse","Noble","Sly","Brave","Shy","Lava","Foul","Leather","Fantasy","Keen","Luminous","Feather","Sticky","Gossamer","Cotton","Rattle","Silk","Satin","Cord","Denim","Flannel","Plaid","Wool","Linen","Silent","Flax","Weak","Valiant","Fierce","Gentle","Rhinestone","Splash","North","South","East","West","Summer","Winter","Autumn","Spring","Season","Equinox","Solstice","Paper","Motley","Torch","Ballistic","Rampant","Shag","Freckle","Wild","Free","Chain","Sheer","Crazy","Mad","Candle","Ribbon","Lace","Notch","Wax","Shine","Shallow","Deep","Bubble","Harvest","Fluff","Venom","Boom","Slash","Rune","Cold","Quill","Love","Hate","Garnet","Zircon","Power","Bone","Void","Horn","Glory","Cyber","Nova","Hot","Helix","Cosmic","Quark","Quiver","Holly","Clover","Polar","Regal","Ripple","Ebony","Wheat","Phantom","Dew","Chisel","Crack","Chatter","Laser","Foil","Tin","Clever","Treasure","Maze","Twisty","Curly","Fortune","Fate","Destiny","Cute","Slime","Ink","Disco","Plume","Time","Psychadelic","Relic","Fossil","Water","Savage","Ancient","Rapid","Road","Trail","Stitch","Button","Bow","Nimble","Zest","Sour","Bitter","Phase","Fan","Frill","Plump","Pickle","Mud","Puddle","Pond","River","Spring","Stream","Battle","Arrow","Plume","Roan","Pitch","Tar","Cat","Dog","Horse","Lizard","Bird","Fish","Saber","Scythe","Sharp","Soft","Razor","Neon","Dandy","Weed","Swamp","Marsh","Bog","Peat","Moor","Muck","Mire","Grave","Fair","Just","Brick","Puzzle","Skitter","Prong","Fork","Dent","Dour","Warp","Luck","Coffee","Split","Chip","Hollow","Heavy","Legend","Hickory","Mesquite","Nettle","Rogue","Charm","Prickle","Bead","Sponge","Whip","Bald","Frost","Fog","Oil","Veil","Cliff","Volcano","Rift","Maze","Proud","Dew","Mirror","Shard","Salt","Pepper","Honey","Thread","Bristle","Ripple","Glow","Zenith"],r=["head","crest","crown","tooth","fang","horn","frill","skull","bone","tongue","throat","voice","nose","snout","chin","eye","sight","seer","speaker","singer","song","chanter","howler","chatter","shrieker","shriek","jaw","bite","biter","neck","shoulder","fin","wing","arm","lifter","grasp","grabber","hand","paw","foot","finger","toe","thumb","talon","palm","touch","racer","runner","hoof","fly","flier","swoop","roar","hiss","hisser","snarl","dive","diver","rib","chest","back","ridge","leg","legs","tail","beak","walker","lasher","swisher","carver","kicker","roarer","crusher","spike","shaker","charger","hunter","weaver","crafter","binder","scribe","muse","snap","snapper","slayer","stalker","track","tracker","scar","scarer","fright","killer","death","doom","healer","saver","friend","foe","guardian","thunder","lightning","cloud","storm","forger","scale","hair","braid","nape","belly","thief","stealer","reaper","giver","taker","dancer","player","gambler","twister","turner","painter","dart","drifter","sting","stinger","venom","spur","ripper","swallow","devourer","knight","lady","lord","queen","king","master","mistress","prince","princess","duke","dutchess","samurai","ninja","knave","slave","servant","sage","wizard","witch","warlock","warrior","jester","paladin","bard","trader","sword","shield","knife","dagger","arrow","bow","fighter","bane","follower","leader","scourge","watcher","cat","panther","tiger","cougar","puma","jaguar","ocelot","lynx","lion","leopard","ferret","weasel","wolverine","bear","raccoon","dog","wolf","kitten","puppy","cub","fox","hound","terrier","coyote","hyena","jackal","pig","horse","donkey","stallion","mare","zebra","antelope","gazelle","deer","buffalo","bison","boar","elk","whale","dolphin","shark","fish","minnow","salmon","ray","fisher","otter","gull","duck","goose","crow","raven","bird","eagle","raptor","hawk","falcon","moose","heron","owl","stork","crane","sparrow","robin","parrot","cockatoo","carp","lizard","gecko","iguana","snake","python","viper","boa","condor","vulture","spider","fly","scorpion","heron","oriole","toucan","bee","wasp","hornet","rabbit","bunny","hare","brow","mustang","ox","piper","soarer","flasher","moth","mask","hide","hero","antler","chill","chiller","gem","ogre","myth","elf","fairy","pixie","dragon","griffin","unicorn","pegasus","sprite","fancier","chopper","slicer","skinner","butterfly","legend","wanderer","rover","raver","loon","lancer","glass","glazer","flame","crystal","lantern","lighter","cloak","bell","ringer","keeper","centaur","bolt","catcher","whimsey","quester","rat","mouse","serpent","wyrm","gargoyle","thorn","whip","rider","spirit","sentry","bat","beetle","burn","cowl","stone","gem","collar","mark","grin","scowl","spear","razor","edge","seeker","jay","ape","monkey","gorilla","koala","kangaroo","yak","sloth","ant","roach","weed","seed","eater","razor","shirt","face","goat","mind","shift","rider","face","mole","vole","pirate","llama","stag","bug","cap","boot","drop","hugger","sargent","snagglefoot","carpet","curtain"];function n(e){return e=e||Math.random,r[Math.floor(e()*r.length)]}function s(e){return e=e||Math.random,t[Math.floor(e()*t.length)]}e.exports=function(e){var t=n(e),r=n(e);return r=r.substr(0,1).toUpperCase()+r.substr(1),s(e)+t+" "+r},e.exports.randomNoun=n,e.exports.randomAdjective=s},1478:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.App=void 0;const s=n(r(2261)),i=r(745),o=r(8908),a=r(7812),c=r(3072),h=r(4433),l={[o.LogLevel.ERROR]:(e,t,r)=>console.error(t,...r),[o.LogLevel.WARN]:(e,t,r)=>console.warn(t,...r),[o.LogLevel.INFO]:(e,t,r)=>console.log(t,...r),[o.LogLevel.TRACE]:(e,t,r)=>console.log(t,...r),[o.LogLevel.DEBUG]:(e,t,r)=>console.log(t,...r)};class u extends s.default.Component{_initialUser;_router;_connectedInterest;constructor(e){super(e),o.log.init({application:"DEBUG",notification:"DEBUG"},((e,t,r,n)=>{l[e](t,r,n)})),this._initialUser=null;var t=new h.FluidConnection({});this._router=new c.NotificationRouterFor(this.onConnection.bind(this)),this._connectedInterest=new c.ObserverInterest(this._router,h.FluidConnection.connectedInterest),t.addObserver(this._connectedInterest);var r="";window.location.hash&&(r=window.location.hash.substring(1));var n=(0,a.looksLikeUuid)(r);this.state={localUser:this._initialUser,fluidConnection:t,participantCaucus:null,containerId:n?r:null}}onConnection(e,t){this.setState({localUser:this.state.localUser,containerId:t.eventData,fluidConnection:this.state.fluidConnection,participantCaucus:this.state.fluidConnection.participantCaucus()})}render(){return s.default.createElement("p",null,"Hello")}}t.App=u,void 0!==document&&void 0!==document.getElementById&&(0,i.createRoot)(document.getElementById("reactRoot")).render(s.default.createElement(u,null))},7627:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CaucusOf=void 0;const n=r(9978),s=r(3111),i=r(3072);class o extends i.Notifier{static caucusMemberAddedNotificationId="caucusMemberAdded";static caucusMemberAddedInterest=new i.Interest(o.caucusMemberAddedNotificationId);static caucusMemberChangedNotificationId="caucusMemberChanged";static caucusMemberChangedInterest=new i.Interest(o.caucusMemberChangedNotificationId);static caucusMemberRemovedNotificationId="caucusMemberRemoved";static caucusMemberRemovedInterest=new i.Interest(o.caucusMemberRemovedNotificationId);_localCopy;_shared;constructor(e){super(),this._shared=e,this._localCopy=new Map,this._shared.on("valueChanged",((e,t,r)=>{t||this.doNotification(null!==e.previousValue,r.has(e.key),e.key)})),(0,n.debounce)(function(){this.doNotification(!1,!1,null)}.bind(this),250)()}doNotification(e,t,r){e?t?this.notifyObservers(o.caucusMemberChangedInterest,new i.NotificationFor(o.caucusMemberChangedInterest,r)):this.notifyObservers(o.caucusMemberRemovedInterest,new i.NotificationFor(o.caucusMemberRemovedInterest,r)):this.notifyObservers(o.caucusMemberAddedInterest,new i.NotificationFor(o.caucusMemberAddedInterest,r))}has(e){return this._shared.has(e)}add(e,t){let r=t.flatten();this._shared.set(e,r)}remove(e){return this._shared.delete(e)}amend(e,t){let r=t.flatten();this._shared.set(e,r)}get(e){let t=this._shared.get(e);return t?s.MDynamicStreamable.resurrect(t):null}current(){return this._localCopy.clear(),this._shared.forEach(((e,t,r)=>{let n=s.MDynamicStreamable.resurrect(e);this._localCopy.set(t,n)})),this._localCopy}synchFrom(e){var t=new Array;this._shared.forEach(((r,n)=>{e.get(n)||t.push(n)})),t.forEach(((e,t)=>{this._shared.delete(e)})),e.forEach(((e,t)=>{let r=this._shared.get(t),n=e.flatten();r?r!==n&&this.amend(t,e):this.add(t,e)}))}}t.CaucusOf=o},9978:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.debounce=void 0,t.debounce=function(e,t){var r=null;return()=>{r&&clearTimeout(r),r=setTimeout((()=>{r=null,e.apply(this,arguments)}),t)}}},1640:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnvironmentError=t.ConnectionError=t.InvalidOperationError=t.InvalidParameterError=void 0;class r extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype),this.name=r.name}}t.InvalidParameterError=r;class n extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype),this.name=n.name}}t.InvalidOperationError=n;class s extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype),this.name=n.name}}t.ConnectionError=s;class i extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype),this.name=i.name}}t.EnvironmentError=i},4433:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FluidConnection=void 0;const n=r(2580),s=r(5969),i=r(3072),o=r(1640),a=r(6006),c=r(7627),h={initialObjects:{participantMap:n.SharedMap,shapeMap:n.SharedMap}};class l extends i.Notifier{static connectedNotificationId="connected";static connectedInterest=new i.Interest(l.connectedNotificationId);_props;_localUser;_client;_container;_participantCaucus;constructor(e){super(),this._client=null,this._props=e,this._container=null,this._localUser=null,this._participantCaucus=null}async createNew(e){try{var t=new a.ClientProps;await t.connection.makeTokenProvider(),this._client=new s.AzureClient(t),this._localUser=e;const{container:r,services:n}=await this._client.createContainer(h);this._container=r;let i=this;return new Promise(((e,t)=>{r.attach().then((t=>{i.setupAfterConnection(t,!0),e(t)})).catch((()=>{t()}))}))}catch(e){throw new o.ConnectionError(e.message)}}async attachToExisting(e,t){try{var r=new a.ClientProps;await r.connection.makeTokenProvider(),this._client=new s.AzureClient(r),this._localUser=t;const{container:n,services:i}=await this._client.getContainer(e,h);return this._container=n,this.setupAfterConnection(e,!1),e}catch(e){throw new o.ConnectionError(e.message)}}setupAfterConnection(e,t){this._participantCaucus=new c.CaucusOf(this._container.initialObjects.participantMap),this.notifyObservers(l.connectedInterest,new i.NotificationFor(l.connectedInterest,e));var r=this._localUser.flatten();this._container.initialObjects.participantMap.set(this._localUser.id,r)}canDisconnect(){return!!this._container&&this._container.connectionState===n.ConnectionState.Connected}async disconnect(){if(this.canDisconnect())return await this._container.disconnect(),this._participantCaucus=null,!0;throw new o.InvalidOperationError("The remote data service is not connected - please try again in a short while.")}participantCaucus(){return this._participantCaucus}}t.FluidConnection=l},6006:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ClientProps=t.ConnectionConfig=void 0;const s=r(7719),i=n(r(7218)),o=r(1640);var a="b03724b3-4be0-4491-b0fa-43b01ab80d50";class c{tokenProvider;endpoint;type;tenantId;documentId;async getToken(e,t,r,n){var s=location.protocol+"//"+location.host+"/api/key";const a=await i.default.get(s,{params:{tenantId_:e,documentId_:t,userId:n,userName:r}});if(!a.data)throw new o.ConnectionError("Error connecting to remote data services for API token.");return a.data}constructor(){this.documentId=a}async makeTokenProvider(){var e={id:a,name:"Whiteboard Application"};return this.tenantId="06fcf322-99f7-412d-9889-f2e94b066b7e",this.endpoint="http://localhost:7070",this.type="local",this.tokenProvider=new s.InsecureTokenProvider("testKey",e),this.tokenProvider}}t.ConnectionConfig=c,t.ClientProps=class{connection;constructor(){this.connection=new c}}},3072:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Notifier=t.NotificationRouterFor=t.NotificationRouter=t.ObserverInterest=t.NotificationFor=t.Notification=t.Interest=void 0,t.Interest=class{_notificationId;constructor(...e){0!==e.length?this.isMyType(e[0])?this._notificationId=e[0]._notificationId:this._notificationId=e[0]:this._notificationId=null}isMyType(e){return e.hasOwnProperty("_notificationId")}get notificationId(){return this._notificationId}equals(e){return this._notificationId===e._notificationId}assign(e){return this._notificationId=e._notificationId,this}};class r{_interest;constructor(...e){0!==e.length?this.isMyType(e[0])?this._interest=e[0]._interest:this._interest=e[0]:this._interest=null}isMyType(e){return e.hasOwnProperty("_interest")}get interest(){return this._interest}equals(e){return this.interest===e.interest||null!==this._interest&&null!==e.interest&&this._interest.equals(e._interest)}assign(e){return this._interest=e._interest,this}}t.Notification=r,t.NotificationFor=class extends r{_eventData;constructor(...e){if(0===e.length)return super(),void(this._eventData=null);1===e.length?(super(e[0]),this._eventData=e[0]._eventData):(super(e[0]),this._eventData=e[1])}get eventData(){return this._eventData}equals(e){return super.equals(e)&&this._eventData===e._eventData}assign(e){return super.assign(e),this._eventData=e._eventData,this}},t.ObserverInterest=class{_observer;_interest;constructor(...e){if(0===e.length)return this._observer=null,void(this._interest=null);1===e.length?(this._observer=e[0]._observer,this._interest=e[0]._interest):(this._observer=e[0],this._interest=e[1])}get observer(){return this._observer}get interest(){return this._interest}equals(e){return this._observer===e._observer&&(this.interest===e.interest||null!==this._interest&&null!==e.interest&&this._interest.equals(e._interest))}assign(e){return this._observer=e._observer,this._interest=e._interest,this}},t.NotificationRouter=class{_function;constructor(...e){0!==e.length?this.isMyType(e[0])?this._function=e[0]._function:this._function=e[0]:this._function=null}isMyType(e){return e.hasOwnProperty("_function")}get function(){return this._function}equals(e){return this._function===e._function}assign(e){return this._function=e._function,this}notify(e,t){this._function(e,t)}},t.NotificationRouterFor=class{_function;constructor(...e){0!==e.length?this.isMyType(e[0])?this._function=e[0]._function:this._function=e[0]:this._function=null}isMyType(e){return e.hasOwnProperty("_function")}get function(){return this._function}equals(e){return this._function===e._function}assign(e){return this._function=e._function,this}notify(e,t){this._function(e,t)}},t.Notifier=class{_observerInterests;constructor(){this._observerInterests=new Array}notifyObservers(e,t){for(var r=0;r<this._observerInterests.length;r++)this._observerInterests[r].interest.equals(e)&&this._observerInterests[r].observer.notify(this._observerInterests[r].interest,t)}addObserver(e){-1===this._observerInterests.indexOf(e)&&this._observerInterests.push(e)}removeObserver(e){const t=this._observerInterests.indexOf(e);return t>-1&&(this._observerInterests.splice(t,1),!0)}removeAllObservers(){this._observerInterests.length=0}}},3111:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DynamicStreamableFactory=t.MDynamicStreamable=t.MStreamable=void 0;class r{constructor(){}}t.MStreamable=r,t.MDynamicStreamable=class extends r{constructor(){super()}flatten(){return JSON.stringify({className:this.className(),data:this.streamOut()})}static resurrect(e){const t=JSON.parse(e);let r=s.create(t.className);return r.streamIn(t.data),r}};var n=null;class s{_className;_factoryMethod;_nextFactory;constructor(e,t){if(this._className=e,this._factoryMethod=t,this._nextFactory=null,null===n)n=this;else{for(var r=n;r._nextFactory;)r=r._nextFactory;r._nextFactory=this}}static create(e){for(var t=n;t;){if(t._className===e)return t._factoryMethod();t=t._nextFactory}return null}}t.DynamicStreamableFactory=s},7812:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.looksLikeUuid=t.uuid=void 0;const n=r(1640);t.uuid=function(){var e,t,r=null;if("undefined"!=typeof Blob){let e=URL.createObjectURL(new Blob);URL.revokeObjectURL(e),r="undefined"==typeof window?e.split(":")[2]:"file:"===window.location.protocol?e.split("/")[1]:e.split("/")[3]}else e=(new Date).getTime(),t="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0,r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(r){var n=16*Math.random();return e>0?(n=(e+n)%16|0,e=Math.floor(e/16)):(n=(t+n)%16|0,t=Math.floor(t/16)),("x"===r?n:3&n|8).toString(16)}));if(!r)throw new n.EnvironmentError("Error creating UUID.");return r},t.looksLikeUuid=function(e){return 36===e.length&&5===e.split("-").length}},4564:(e,t,r)=>{"use strict";var n=r(7418),s=r(7129),i=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,o=/[\n\r\t]/g,a=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,c=/:\d+$/,h=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,l=/^[a-zA-Z]:/;function u(e){return(e||"").toString().replace(i,"")}var d=[["#","hash"],["?","query"],function(e,t){return m(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],p={hash:1,query:1};function g(e){var t,n=("undefined"!=typeof window?window:void 0!==r.g?r.g:"undefined"!=typeof self?self:{}).location||{},s={},i=typeof(e=e||n);if("blob:"===e.protocol)s=new y(unescape(e.pathname),{});else if("string"===i)for(t in s=new y(e,{}),p)delete s[t];else if("object"===i){for(t in e)t in p||(s[t]=e[t]);void 0===s.slashes&&(s.slashes=a.test(e.href))}return s}function m(e){return"file:"===e||"ftp:"===e||"http:"===e||"https:"===e||"ws:"===e||"wss:"===e}function f(e,t){e=(e=u(e)).replace(o,""),t=t||{};var r,n=h.exec(e),s=n[1]?n[1].toLowerCase():"",i=!!n[2],a=!!n[3],c=0;return i?a?(r=n[2]+n[3]+n[4],c=n[2].length+n[3].length):(r=n[2]+n[4],c=n[2].length):a?(r=n[3]+n[4],c=n[3].length):r=n[4],"file:"===s?c>=2&&(r=r.slice(2)):m(s)?r=n[4]:s?i&&(r=r.slice(2)):c>=2&&m(t.protocol)&&(r=n[4]),{protocol:s,slashes:i||m(s),slashesCount:c,rest:r}}function y(e,t,r){if(e=(e=u(e)).replace(o,""),!(this instanceof y))return new y(e,t,r);var i,a,c,h,p,v,b=d.slice(),S=typeof t,w=this,x=0;for("object"!==S&&"string"!==S&&(r=t,t=null),r&&"function"!=typeof r&&(r=s.parse),i=!(a=f(e||"",t=g(t))).protocol&&!a.slashes,w.slashes=a.slashes||i&&t.slashes,w.protocol=a.protocol||t.protocol||"",e=a.rest,("file:"===a.protocol&&(2!==a.slashesCount||l.test(e))||!a.slashes&&(a.protocol||a.slashesCount<2||!m(w.protocol)))&&(b[3]=[/(.*)/,"pathname"]);x<b.length;x++)"function"!=typeof(h=b[x])?(c=h[0],v=h[1],c!=c?w[v]=e:"string"==typeof c?~(p="@"===c?e.lastIndexOf(c):e.indexOf(c))&&("number"==typeof h[2]?(w[v]=e.slice(0,p),e=e.slice(p+h[2])):(w[v]=e.slice(p),e=e.slice(0,p))):(p=c.exec(e))&&(w[v]=p[1],e=e.slice(0,p.index)),w[v]=w[v]||i&&h[3]&&t[v]||"",h[4]&&(w[v]=w[v].toLowerCase())):e=h(e,w);r&&(w.query=r(w.query)),i&&t.slashes&&"/"!==w.pathname.charAt(0)&&(""!==w.pathname||""!==t.pathname)&&(w.pathname=function(e,t){if(""===e)return t;for(var r=(t||"/").split("/").slice(0,-1).concat(e.split("/")),n=r.length,s=r[n-1],i=!1,o=0;n--;)"."===r[n]?r.splice(n,1):".."===r[n]?(r.splice(n,1),o++):o&&(0===n&&(i=!0),r.splice(n,1),o--);return i&&r.unshift(""),"."!==s&&".."!==s||r.push(""),r.join("/")}(w.pathname,t.pathname)),"/"!==w.pathname.charAt(0)&&m(w.protocol)&&(w.pathname="/"+w.pathname),n(w.port,w.protocol)||(w.host=w.hostname,w.port=""),w.username=w.password="",w.auth&&(~(p=w.auth.indexOf(":"))?(w.username=w.auth.slice(0,p),w.username=encodeURIComponent(decodeURIComponent(w.username)),w.password=w.auth.slice(p+1),w.password=encodeURIComponent(decodeURIComponent(w.password))):w.username=encodeURIComponent(decodeURIComponent(w.auth)),w.auth=w.password?w.username+":"+w.password:w.username),w.origin="file:"!==w.protocol&&m(w.protocol)&&w.host?w.protocol+"//"+w.host:"null",w.href=w.toString()}y.prototype={set:function(e,t,r){var i=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(r||s.parse)(t)),i[e]=t;break;case"port":i[e]=t,n(t,i.protocol)?t&&(i.host=i.hostname+":"+t):(i.host=i.hostname,i[e]="");break;case"hostname":i[e]=t,i.port&&(t+=":"+i.port),i.host=t;break;case"host":i[e]=t,c.test(t)?(t=t.split(":"),i.port=t.pop(),i.hostname=t.join(":")):(i.hostname=t,i.port="");break;case"protocol":i.protocol=t.toLowerCase(),i.slashes=!r;break;case"pathname":case"hash":if(t){var o="pathname"===e?"/":"#";i[e]=t.charAt(0)!==o?o+t:t}else i[e]=t;break;case"username":case"password":i[e]=encodeURIComponent(t);break;case"auth":var a=t.indexOf(":");~a?(i.username=t.slice(0,a),i.username=encodeURIComponent(decodeURIComponent(i.username)),i.password=t.slice(a+1),i.password=encodeURIComponent(decodeURIComponent(i.password))):i.username=encodeURIComponent(decodeURIComponent(t))}for(var h=0;h<d.length;h++){var l=d[h];l[4]&&(i[l[1]]=i[l[1]].toLowerCase())}return i.auth=i.password?i.username+":"+i.password:i.username,i.origin="file:"!==i.protocol&&m(i.protocol)&&i.host?i.protocol+"//"+i.host:"null",i.href=i.toString(),i},toString:function(e){e&&"function"==typeof e||(e=s.stringify);var t,r=this,n=r.host,i=r.protocol;i&&":"!==i.charAt(i.length-1)&&(i+=":");var o=i+(r.protocol&&r.slashes||m(r.protocol)?"//":"");return r.username?(o+=r.username,r.password&&(o+=":"+r.password),o+="@"):r.password?(o+=":"+r.password,o+="@"):"file:"!==r.protocol&&m(r.protocol)&&!n&&"/"!==r.pathname&&(o+="@"),(":"===n[n.length-1]||c.test(r.hostname)&&!r.port)&&(n+=":"),o+=n+r.pathname,(t="object"==typeof r.query?e(r.query):r.query)&&(o+="?"!==t.charAt(0)?"?"+t:t),r.hash&&(o+=r.hash),o}},y.extractProtocol=f,y.location=g,y.trimLeft=u,y.qs=s,e.exports=y},2511:function(e,t,r){var n;e=r.nmd(e),function(s){t&&t.nodeType,e&&e.nodeType;var i="object"==typeof r.g&&r.g;i.global!==i&&i.window!==i&&i.self;var o,a=2147483647,c=36,h=26,l=38,u=700,d=/^xn--/,p=/[^\x20-\x7E]/,g=/[\x2E\u3002\uFF0E\uFF61]/g,m={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},f=c-1,y=Math.floor,v=String.fromCharCode;function b(e){throw new RangeError(m[e])}function S(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function w(e,t){var r=e.split("@"),n="";return r.length>1&&(n=r[0]+"@",e=r[1]),n+S((e=e.replace(g,".")).split("."),t).join(".")}function x(e){for(var t,r,n=[],s=0,i=e.length;s<i;)(t=e.charCodeAt(s++))>=55296&&t<=56319&&s<i?56320==(64512&(r=e.charCodeAt(s++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),s--):n.push(t);return n}function C(e){return S(e,(function(e){var t="";return e>65535&&(t+=v((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+v(e)})).join("")}function E(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function A(e,t,r){var n=0;for(e=r?y(e/u):e>>1,e+=y(e/t);e>f*h>>1;n+=c)e=y(e/f);return y(n+(f+1)*e/(e+l))}function T(e){var t,r,n,s,i,o,l,u,d,p,g,m=[],f=e.length,v=0,S=128,w=72;for((r=e.lastIndexOf("-"))<0&&(r=0),n=0;n<r;++n)e.charCodeAt(n)>=128&&b("not-basic"),m.push(e.charCodeAt(n));for(s=r>0?r+1:0;s<f;){for(i=v,o=1,l=c;s>=f&&b("invalid-input"),((u=(g=e.charCodeAt(s++))-48<10?g-22:g-65<26?g-65:g-97<26?g-97:c)>=c||u>y((a-v)/o))&&b("overflow"),v+=u*o,!(u<(d=l<=w?1:l>=w+h?h:l-w));l+=c)o>y(a/(p=c-d))&&b("overflow"),o*=p;w=A(v-i,t=m.length+1,0==i),y(v/t)>a-S&&b("overflow"),S+=y(v/t),v%=t,m.splice(v++,0,S)}return C(m)}function O(e){var t,r,n,s,i,o,l,u,d,p,g,m,f,S,w,C=[];for(m=(e=x(e)).length,t=128,r=0,i=72,o=0;o<m;++o)(g=e[o])<128&&C.push(v(g));for(n=s=C.length,s&&C.push("-");n<m;){for(l=a,o=0;o<m;++o)(g=e[o])>=t&&g<l&&(l=g);for(l-t>y((a-r)/(f=n+1))&&b("overflow"),r+=(l-t)*f,t=l,o=0;o<m;++o)if((g=e[o])<t&&++r>a&&b("overflow"),g==t){for(u=r,d=c;!(u<(p=d<=i?1:d>=i+h?h:d-i));d+=c)w=u-p,S=c-p,C.push(v(E(p+w%S,0))),u=y(w/S);C.push(v(E(u,0))),i=A(r,f,n==s),r=0,++n}++r,++t}return C.join("")}o={version:"1.4.1",ucs2:{decode:x,encode:C},decode:T,encode:O,toASCII:function(e){return w(e,(function(e){return p.test(e)?"xn--"+O(e):e}))},toUnicode:function(e){return w(e,(function(e){return d.test(e)?T(e.slice(4).toLowerCase()):e}))}},void 0===(n=function(){return o}.call(t,r,t,e))||(e.exports=n)}()},8575:(e,t,r)=>{"use strict";var n=r(2511);function s(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var i=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,a=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),h=["'"].concat(c),l=["%","/","?",";","#"].concat(h),u=["/","?","#"],d=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,g={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},f={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=r(129);function v(e,t,r){if(e&&"object"==typeof e&&e instanceof s)return e;var n=new s;return n.parse(e,t,r),n}s.prototype.parse=function(e,t,r){if("string"!=typeof e)throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var s=e.indexOf("?"),o=-1!==s&&s<e.indexOf("#")?"?":"#",c=e.split(o);c[0]=c[0].replace(/\\/g,"/");var v=e=c.join(o);if(v=v.trim(),!r&&1===e.split("#").length){var b=a.exec(v);if(b)return this.path=v,this.href=v,this.pathname=b[1],b[2]?(this.search=b[2],this.query=t?y.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var S=i.exec(v);if(S){var w=(S=S[0]).toLowerCase();this.protocol=w,v=v.substr(S.length)}if(r||S||v.match(/^\/\/[^@/]+@[^@/]+/)){var x="//"===v.substr(0,2);!x||S&&m[S]||(v=v.substr(2),this.slashes=!0)}if(!m[S]&&(x||S&&!f[S])){for(var C,E,A=-1,T=0;T<u.length;T++)-1!==(O=v.indexOf(u[T]))&&(-1===A||O<A)&&(A=O);for(-1!==(E=-1===A?v.lastIndexOf("@"):v.lastIndexOf("@",A))&&(C=v.slice(0,E),v=v.slice(E+1),this.auth=decodeURIComponent(C)),A=-1,T=0;T<l.length;T++){var O;-1!==(O=v.indexOf(l[T]))&&(-1===A||O<A)&&(A=O)}-1===A&&(A=v.length),this.host=v.slice(0,A),v=v.slice(A),this.parseHost(),this.hostname=this.hostname||"";var N="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!N)for(var P=this.hostname.split(/\./),R=(T=0,P.length);T<R;T++){var I=P[T];if(I&&!I.match(d)){for(var F="",k=0,D=I.length;k<D;k++)I.charCodeAt(k)>127?F+="x":F+=I[k];if(!F.match(d)){var M=P.slice(0,T),q=P.slice(T+1),L=I.match(p);L&&(M.push(L[1]),q.unshift(L[2])),q.length&&(v="/"+q.join(".")+v),this.hostname=M.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),N||(this.hostname=n.toASCII(this.hostname));var B=this.port?":"+this.port:"",j=this.hostname||"";this.host=j+B,this.href+=this.host,N&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==v[0]&&(v="/"+v))}if(!g[w])for(T=0,R=h.length;T<R;T++){var _=h[T];if(-1!==v.indexOf(_)){var H=encodeURIComponent(_);H===_&&(H=escape(_)),v=v.split(_).join(H)}}var U=v.indexOf("#");-1!==U&&(this.hash=v.substr(U),v=v.slice(0,U));var z=v.indexOf("?");if(-1!==z?(this.search=v.substr(z),this.query=v.substr(z+1),t&&(this.query=y.parse(this.query)),v=v.slice(0,z)):t&&(this.search="",this.query={}),v&&(this.pathname=v),f[w]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){B=this.pathname||"";var V=this.search||"";this.path=B+V}return this.href=this.format(),this},s.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",n=this.hash||"",s=!1,i="";this.host?s=e+this.host:this.hostname&&(s=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&"object"==typeof this.query&&Object.keys(this.query).length&&(i=y.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var o=this.search||i&&"?"+i||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||f[t])&&!1!==s?(s="//"+(s||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):s||(s=""),n&&"#"!==n.charAt(0)&&(n="#"+n),o&&"?"!==o.charAt(0)&&(o="?"+o),t+s+(r=r.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(o=o.replace("#","%23"))+n},s.prototype.resolve=function(e){return this.resolveObject(v(e,!1,!0)).format()},s.prototype.resolveObject=function(e){if("string"==typeof e){var t=new s;t.parse(e,!1,!0),e=t}for(var r=new s,n=Object.keys(this),i=0;i<n.length;i++){var o=n[i];r[o]=this[o]}if(r.hash=e.hash,""===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var a=Object.keys(e),c=0;c<a.length;c++){var h=a[c];"protocol"!==h&&(r[h]=e[h])}return f[r.protocol]&&r.hostname&&!r.pathname&&(r.pathname="/",r.path=r.pathname),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!f[e.protocol]){for(var l=Object.keys(e),u=0;u<l.length;u++){var d=l[u];r[d]=e[d]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||m[e.protocol])r.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),r.pathname=p.join("/")}if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var g=r.pathname||"",y=r.search||"";r.path=g+y}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var v=r.pathname&&"/"===r.pathname.charAt(0),b=e.host||e.pathname&&"/"===e.pathname.charAt(0),S=b||v||r.host&&e.pathname,w=S,x=r.pathname&&r.pathname.split("/")||[],C=(p=e.pathname&&e.pathname.split("/")||[],r.protocol&&!f[r.protocol]);if(C&&(r.hostname="",r.port=null,r.host&&(""===x[0]?x[0]=r.host:x.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),S=S&&(""===p[0]||""===x[0])),b)r.host=e.host||""===e.host?e.host:r.host,r.hostname=e.hostname||""===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,x=p;else if(p.length)x||(x=[]),x.pop(),x=x.concat(p),r.search=e.search,r.query=e.query;else if(null!=e.search)return C&&(r.host=x.shift(),r.hostname=r.host,(N=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=N.shift(),r.hostname=N.shift(),r.host=r.hostname)),r.search=e.search,r.query=e.query,null===r.pathname&&null===r.search||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r;if(!x.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var E=x.slice(-1)[0],A=(r.host||e.host||x.length>1)&&("."===E||".."===E)||""===E,T=0,O=x.length;O>=0;O--)"."===(E=x[O])?x.splice(O,1):".."===E?(x.splice(O,1),T++):T&&(x.splice(O,1),T--);if(!S&&!w)for(;T--;T)x.unshift("..");!S||""===x[0]||x[0]&&"/"===x[0].charAt(0)||x.unshift(""),A&&"/"!==x.join("/").substr(-1)&&x.push("");var N,P=""===x[0]||x[0]&&"/"===x[0].charAt(0);return C&&(r.hostname=P?"":x.length?x.shift():"",r.host=r.hostname,(N=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=N.shift(),r.hostname=N.shift(),r.host=r.hostname)),(S=S||r.host&&x.length)&&!P&&x.unshift(""),x.length>0?r.pathname=x.join("/"):(r.pathname=null,r.path=null),null===r.pathname&&null===r.search||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},s.prototype.parseHost=function(){var e=this.host,t=o.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)},t.Qc=v},8410:(e,t,r)=>{"use strict";r.r(t),r.d(t,{NIL:()=>A,parse:()=>u,stringify:()=>o.Z,v1:()=>h,v3:()=>S,v4:()=>w.Z,v5:()=>E,validate:()=>l.Z,version:()=>T});var n,s,i=r(3653),o=r(3958),a=0,c=0;const h=function(e,t,r){var h=t&&r||0,l=t||new Array(16),u=(e=e||{}).node||n,d=void 0!==e.clockseq?e.clockseq:s;if(null==u||null==d){var p=e.random||(e.rng||i.Z)();null==u&&(u=n=[1|p[0],p[1],p[2],p[3],p[4],p[5]]),null==d&&(d=s=16383&(p[6]<<8|p[7]))}var g=void 0!==e.msecs?e.msecs:Date.now(),m=void 0!==e.nsecs?e.nsecs:c+1,f=g-a+(m-c)/1e4;if(f<0&&void 0===e.clockseq&&(d=d+1&16383),(f<0||g>a)&&void 0===e.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=g,c=m,s=d;var y=(1e4*(268435455&(g+=122192928e5))+m)%4294967296;l[h++]=y>>>24&255,l[h++]=y>>>16&255,l[h++]=y>>>8&255,l[h++]=255&y;var v=g/4294967296*1e4&268435455;l[h++]=v>>>8&255,l[h++]=255&v,l[h++]=v>>>24&15|16,l[h++]=v>>>16&255,l[h++]=d>>>8|128,l[h++]=255&d;for(var b=0;b<6;++b)l[h+b]=u[b];return t||(0,o.Z)(l)};var l=r(7738);const u=function(e){if(!(0,l.Z)(e))throw TypeError("Invalid UUID");var t,r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r};function d(e,t,r){function n(e,n,s,i){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof n&&(n=u(n)),16!==n.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var a=new Uint8Array(16+e.length);if(a.set(n),a.set(e,n.length),(a=r(a))[6]=15&a[6]|t,a[8]=63&a[8]|128,s){i=i||0;for(var c=0;c<16;++c)s[i+c]=a[c];return s}return(0,o.Z)(a)}try{n.name=e}catch(e){}return n.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",n.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",n}function p(e){return 14+(e+64>>>9<<4)+1}function g(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function m(e,t,r,n,s,i){return g((o=g(g(t,e),g(n,i)))<<(a=s)|o>>>32-a,r);var o,a}function f(e,t,r,n,s,i,o){return m(t&r|~t&n,e,t,s,i,o)}function y(e,t,r,n,s,i,o){return m(t&n|r&~n,e,t,s,i,o)}function v(e,t,r,n,s,i,o){return m(t^r^n,e,t,s,i,o)}function b(e,t,r,n,s,i,o){return m(r^(t|~n),e,t,s,i,o)}const S=d("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var r=0;r<t.length;++r)e[r]=t.charCodeAt(r)}return function(e){for(var t=[],r=32*e.length,n="0123456789abcdef",s=0;s<r;s+=8){var i=e[s>>5]>>>s%32&255,o=parseInt(n.charAt(i>>>4&15)+n.charAt(15&i),16);t.push(o)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[p(t)-1]=t;for(var r=1732584193,n=-271733879,s=-1732584194,i=271733878,o=0;o<e.length;o+=16){var a=r,c=n,h=s,l=i;r=f(r,n,s,i,e[o],7,-680876936),i=f(i,r,n,s,e[o+1],12,-389564586),s=f(s,i,r,n,e[o+2],17,606105819),n=f(n,s,i,r,e[o+3],22,-1044525330),r=f(r,n,s,i,e[o+4],7,-176418897),i=f(i,r,n,s,e[o+5],12,1200080426),s=f(s,i,r,n,e[o+6],17,-1473231341),n=f(n,s,i,r,e[o+7],22,-45705983),r=f(r,n,s,i,e[o+8],7,1770035416),i=f(i,r,n,s,e[o+9],12,-1958414417),s=f(s,i,r,n,e[o+10],17,-42063),n=f(n,s,i,r,e[o+11],22,-1990404162),r=f(r,n,s,i,e[o+12],7,1804603682),i=f(i,r,n,s,e[o+13],12,-40341101),s=f(s,i,r,n,e[o+14],17,-1502002290),r=y(r,n=f(n,s,i,r,e[o+15],22,1236535329),s,i,e[o+1],5,-165796510),i=y(i,r,n,s,e[o+6],9,-1069501632),s=y(s,i,r,n,e[o+11],14,643717713),n=y(n,s,i,r,e[o],20,-373897302),r=y(r,n,s,i,e[o+5],5,-701558691),i=y(i,r,n,s,e[o+10],9,38016083),s=y(s,i,r,n,e[o+15],14,-660478335),n=y(n,s,i,r,e[o+4],20,-405537848),r=y(r,n,s,i,e[o+9],5,568446438),i=y(i,r,n,s,e[o+14],9,-1019803690),s=y(s,i,r,n,e[o+3],14,-187363961),n=y(n,s,i,r,e[o+8],20,1163531501),r=y(r,n,s,i,e[o+13],5,-1444681467),i=y(i,r,n,s,e[o+2],9,-51403784),s=y(s,i,r,n,e[o+7],14,1735328473),r=v(r,n=y(n,s,i,r,e[o+12],20,-1926607734),s,i,e[o+5],4,-378558),i=v(i,r,n,s,e[o+8],11,-2022574463),s=v(s,i,r,n,e[o+11],16,1839030562),n=v(n,s,i,r,e[o+14],23,-35309556),r=v(r,n,s,i,e[o+1],4,-1530992060),i=v(i,r,n,s,e[o+4],11,1272893353),s=v(s,i,r,n,e[o+7],16,-155497632),n=v(n,s,i,r,e[o+10],23,-1094730640),r=v(r,n,s,i,e[o+13],4,681279174),i=v(i,r,n,s,e[o],11,-358537222),s=v(s,i,r,n,e[o+3],16,-722521979),n=v(n,s,i,r,e[o+6],23,76029189),r=v(r,n,s,i,e[o+9],4,-640364487),i=v(i,r,n,s,e[o+12],11,-421815835),s=v(s,i,r,n,e[o+15],16,530742520),r=b(r,n=v(n,s,i,r,e[o+2],23,-995338651),s,i,e[o],6,-198630844),i=b(i,r,n,s,e[o+7],10,1126891415),s=b(s,i,r,n,e[o+14],15,-1416354905),n=b(n,s,i,r,e[o+5],21,-57434055),r=b(r,n,s,i,e[o+12],6,1700485571),i=b(i,r,n,s,e[o+3],10,-1894986606),s=b(s,i,r,n,e[o+10],15,-1051523),n=b(n,s,i,r,e[o+1],21,-2054922799),r=b(r,n,s,i,e[o+8],6,1873313359),i=b(i,r,n,s,e[o+15],10,-30611744),s=b(s,i,r,n,e[o+6],15,-1560198380),n=b(n,s,i,r,e[o+13],21,1309151649),r=b(r,n,s,i,e[o+4],6,-145523070),i=b(i,r,n,s,e[o+11],10,-1120210379),s=b(s,i,r,n,e[o+2],15,718787259),n=b(n,s,i,r,e[o+9],21,-343485551),r=g(r,a),n=g(n,c),s=g(s,h),i=g(i,l)}return[r,n,s,i]}(function(e){if(0===e.length)return[];for(var t=8*e.length,r=new Uint32Array(p(t)),n=0;n<t;n+=8)r[n>>5]|=(255&e[n/8])<<n%32;return r}(e),8*e.length))}));var w=r(2045);function x(e,t,r,n){switch(e){case 0:return t&r^~t&n;case 1:case 3:return t^r^n;case 2:return t&r^t&n^r&n}}function C(e,t){return e<<t|e>>>32-t}const E=d("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var n=unescape(encodeURIComponent(e));e=[];for(var s=0;s<n.length;++s)e.push(n.charCodeAt(s))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var i=e.length/4+2,o=Math.ceil(i/16),a=new Array(o),c=0;c<o;++c){for(var h=new Uint32Array(16),l=0;l<16;++l)h[l]=e[64*c+4*l]<<24|e[64*c+4*l+1]<<16|e[64*c+4*l+2]<<8|e[64*c+4*l+3];a[c]=h}a[o-1][14]=8*(e.length-1)/Math.pow(2,32),a[o-1][14]=Math.floor(a[o-1][14]),a[o-1][15]=8*(e.length-1)&4294967295;for(var u=0;u<o;++u){for(var d=new Uint32Array(80),p=0;p<16;++p)d[p]=a[u][p];for(var g=16;g<80;++g)d[g]=C(d[g-3]^d[g-8]^d[g-14]^d[g-16],1);for(var m=r[0],f=r[1],y=r[2],v=r[3],b=r[4],S=0;S<80;++S){var w=Math.floor(S/20),E=C(m,5)+x(w,f,y,v)+b+t[w]+d[S]>>>0;b=v,v=y,y=C(f,30)>>>0,f=m,m=E}r[0]=r[0]+m>>>0,r[1]=r[1]+f>>>0,r[2]=r[2]+y>>>0,r[3]=r[3]+v>>>0,r[4]=r[4]+b>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]})),A="00000000-0000-0000-0000-000000000000",T=function(e){if(!(0,l.Z)(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}},3653:(e,t,r)=>{"use strict";var n;r.d(t,{Z:()=>i});var s=new Uint8Array(16);function i(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(s)}},3958:(e,t,r)=>{"use strict";r.d(t,{Z:()=>o});for(var n=r(7738),s=[],i=0;i<256;++i)s.push((i+256).toString(16).substr(1));const o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(s[e[t+0]]+s[e[t+1]]+s[e[t+2]]+s[e[t+3]]+"-"+s[e[t+4]]+s[e[t+5]]+"-"+s[e[t+6]]+s[e[t+7]]+"-"+s[e[t+8]]+s[e[t+9]]+"-"+s[e[t+10]]+s[e[t+11]]+s[e[t+12]]+s[e[t+13]]+s[e[t+14]]+s[e[t+15]]).toLowerCase();if(!(0,n.Z)(r))throw TypeError("Stringified UUID is invalid");return r}},2045:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var n=r(3653),s=r(3958);const i=function(e,t,r){var i=(e=e||{}).random||(e.rng||n.Z)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){r=r||0;for(var o=0;o<16;++o)t[r+o]=i[o];return t}return(0,s.Z)(i)}},7738:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});const n=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,s=function(e){return"string"==typeof e&&n.test(e)}},2261:e=>{"use strict";e.exports=window.react},3293:e=>{"use strict";e.exports=window["react-dom"]},4654:()=>{},7218:(e,t,r)=>{"use strict";function n(e,t){return function(){return e.apply(t,arguments)}}const{toString:s}=Object.prototype,{getPrototypeOf:i}=Object,o=(a=Object.create(null),e=>{const t=s.call(e);return a[t]||(a[t]=t.slice(8,-1).toLowerCase())});var a;const c=e=>(e=e.toLowerCase(),t=>o(t)===e),h=e=>t=>typeof t===e,{isArray:l}=Array,u=h("undefined"),d=c("ArrayBuffer"),p=h("string"),g=h("function"),m=h("number"),f=e=>null!==e&&"object"==typeof e,y=e=>{if("object"!==o(e))return!1;const t=i(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},v=c("Date"),b=c("File"),S=c("Blob"),w=c("FileList"),x=c("URLSearchParams");function C(e,t,{allOwnKeys:r=!1}={}){if(null==e)return;let n,s;if("object"!=typeof e&&(e=[e]),l(e))for(n=0,s=e.length;n<s;n++)t.call(null,e[n],n,e);else{const s=r?Object.getOwnPropertyNames(e):Object.keys(e),i=s.length;let o;for(n=0;n<i;n++)o=s[n],t.call(null,e[o],o,e)}}function E(e,t){t=t.toLowerCase();const r=Object.keys(e);let n,s=r.length;for(;s-- >0;)if(n=r[s],t===n.toLowerCase())return n;return null}const A="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:r.g,T=e=>!u(e)&&e!==A,O=(N="undefined"!=typeof Uint8Array&&i(Uint8Array),e=>N&&e instanceof N);var N;const P=c("HTMLFormElement"),R=(({hasOwnProperty:e})=>(t,r)=>e.call(t,r))(Object.prototype),I=c("RegExp"),F=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),n={};C(r,((r,s)=>{let i;!1!==(i=t(r,s,e))&&(n[s]=i||r)})),Object.defineProperties(e,n)},k="abcdefghijklmnopqrstuvwxyz",D="0123456789",M={DIGIT:D,ALPHA:k,ALPHA_DIGIT:k+k.toUpperCase()+D},q=c("AsyncFunction");var L={isArray:l,isArrayBuffer:d,isBuffer:function(e){return null!==e&&!u(e)&&null!==e.constructor&&!u(e.constructor)&&g(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||g(e.append)&&("formdata"===(t=o(e))||"object"===t&&g(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&d(e.buffer),t},isString:p,isNumber:m,isBoolean:e=>!0===e||!1===e,isObject:f,isPlainObject:y,isUndefined:u,isDate:v,isFile:b,isBlob:S,isRegExp:I,isFunction:g,isStream:e=>f(e)&&g(e.pipe),isURLSearchParams:x,isTypedArray:O,isFileList:w,forEach:C,merge:function e(){const{caseless:t}=T(this)&&this||{},r={},n=(n,s)=>{const i=t&&E(r,s)||s;y(r[i])&&y(n)?r[i]=e(r[i],n):y(n)?r[i]=e({},n):l(n)?r[i]=n.slice():r[i]=n};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&C(arguments[e],n);return r},extend:(e,t,r,{allOwnKeys:s}={})=>(C(t,((t,s)=>{r&&g(t)?e[s]=n(t,r):e[s]=t}),{allOwnKeys:s}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},toFlatObject:(e,t,r,n)=>{let s,o,a;const c={};if(t=t||{},null==e)return t;do{for(s=Object.getOwnPropertyNames(e),o=s.length;o-- >0;)a=s[o],n&&!n(a,e,t)||c[a]||(t[a]=e[a],c[a]=!0);e=!1!==r&&i(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:o,kindOfTest:c,endsWith:(e,t,r)=>{e=String(e),(void 0===r||r>e.length)&&(r=e.length),r-=t.length;const n=e.indexOf(t,r);return-1!==n&&n===r},toArray:e=>{if(!e)return null;if(l(e))return e;let t=e.length;if(!m(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},forEachEntry:(e,t)=>{const r=(e&&e[Symbol.iterator]).call(e);let n;for(;(n=r.next())&&!n.done;){const r=n.value;t.call(e,r[0],r[1])}},matchAll:(e,t)=>{let r;const n=[];for(;null!==(r=e.exec(t));)n.push(r);return n},isHTMLForm:P,hasOwnProperty:R,hasOwnProp:R,reduceDescriptors:F,freezeMethods:e=>{F(e,((t,r)=>{if(g(e)&&-1!==["arguments","caller","callee"].indexOf(r))return!1;const n=e[r];g(n)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")}))}))},toObjectSet:(e,t)=>{const r={},n=e=>{e.forEach((e=>{r[e]=!0}))};return l(e)?n(e):n(String(e).split(t)),r},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,r){return t.toUpperCase()+r})),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t),findKey:E,global:A,isContextDefined:T,ALPHABET:M,generateString:(e=16,t=M.ALPHA_DIGIT)=>{let r="";const{length:n}=t;for(;e--;)r+=t[Math.random()*n|0];return r},isSpecCompliantForm:function(e){return!!(e&&g(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),r=(e,n)=>{if(f(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[n]=e;const s=l(e)?[]:{};return C(e,((e,t)=>{const i=r(e,n+1);!u(i)&&(s[t]=i)})),t[n]=void 0,s}}return e};return r(e,0)},isAsyncFn:q,isThenable:e=>e&&(f(e)||g(e))&&g(e.then)&&g(e.catch)};function B(e,t,r,n,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),s&&(this.response=s)}L.inherits(B,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:L.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const j=B.prototype,_={};function H(e){return L.isPlainObject(e)||L.isArray(e)}function U(e){return L.endsWith(e,"[]")?e.slice(0,-2):e}function z(e,t,r){return e?e.concat(t).map((function(e,t){return e=U(e),!r&&t?"["+e+"]":e})).join(r?".":""):t}["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{_[e]={value:e}})),Object.defineProperties(B,_),Object.defineProperty(j,"isAxiosError",{value:!0}),B.from=(e,t,r,n,s,i)=>{const o=Object.create(j);return L.toFlatObject(e,o,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),B.call(o,e.message,t,r,n,s),o.cause=e,o.name=e.name,i&&Object.assign(o,i),o};const V=L.toFlatObject(L,{},null,(function(e){return/^is[A-Z]/.test(e)}));function G(e,t,r){if(!L.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const n=(r=L.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!L.isUndefined(t[e])}))).metaTokens,s=r.visitor||h,i=r.dots,o=r.indexes,a=(r.Blob||"undefined"!=typeof Blob&&Blob)&&L.isSpecCompliantForm(t);if(!L.isFunction(s))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(L.isDate(e))return e.toISOString();if(!a&&L.isBlob(e))throw new B("Blob is not supported. Use a Buffer instead.");return L.isArrayBuffer(e)||L.isTypedArray(e)?a&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function h(e,r,s){let a=e;if(e&&!s&&"object"==typeof e)if(L.endsWith(r,"{}"))r=n?r:r.slice(0,-2),e=JSON.stringify(e);else if(L.isArray(e)&&function(e){return L.isArray(e)&&!e.some(H)}(e)||(L.isFileList(e)||L.endsWith(r,"[]"))&&(a=L.toArray(e)))return r=U(r),a.forEach((function(e,n){!L.isUndefined(e)&&null!==e&&t.append(!0===o?z([r],n,i):null===o?r:r+"[]",c(e))})),!1;return!!H(e)||(t.append(z(s,r,i),c(e)),!1)}const l=[],u=Object.assign(V,{defaultVisitor:h,convertValue:c,isVisitable:H});if(!L.isObject(e))throw new TypeError("data must be an object");return function e(r,n){if(!L.isUndefined(r)){if(-1!==l.indexOf(r))throw Error("Circular reference detected in "+n.join("."));l.push(r),L.forEach(r,(function(r,i){!0===(!(L.isUndefined(r)||null===r)&&s.call(t,r,L.isString(i)?i.trim():i,n,u))&&e(r,n?n.concat(i):[i])})),l.pop()}}(e),t}function K(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function W(e,t){this._pairs=[],e&&G(e,this,t)}const $=W.prototype;function J(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function X(e,t,r){if(!t)return e;const n=r&&r.encode||J,s=r&&r.serialize;let i;if(i=s?s(t,r):L.isURLSearchParams(t)?t.toString():new W(t,r).toString(n),i){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}$.append=function(e,t){this._pairs.push([e,t])},$.toString=function(e){const t=e?function(t){return e.call(this,t,K)}:K;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};var Q=class{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){L.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},Z={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Y={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:W,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]};const ee="undefined"!=typeof window&&"undefined"!=typeof document,te=(re="undefined"!=typeof navigator&&navigator.product,ee&&["ReactNative","NativeScript","NS"].indexOf(re)<0);var re;const ne="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts;var se={...Object.freeze({__proto__:null,hasBrowserEnv:ee,hasStandardBrowserWebWorkerEnv:ne,hasStandardBrowserEnv:te}),...Y};function ie(e){function t(e,r,n,s){let i=e[s++];if("__proto__"===i)return!0;const o=Number.isFinite(+i),a=s>=e.length;return i=!i&&L.isArray(n)?n.length:i,a?(L.hasOwnProp(n,i)?n[i]=[n[i],r]:n[i]=r,!o):(n[i]&&L.isObject(n[i])||(n[i]=[]),t(e,r,n[i],s)&&L.isArray(n[i])&&(n[i]=function(e){const t={},r=Object.keys(e);let n;const s=r.length;let i;for(n=0;n<s;n++)i=r[n],t[i]=e[i];return t}(n[i])),!o)}if(L.isFormData(e)&&L.isFunction(e.entries)){const r={};return L.forEachEntry(e,((e,n)=>{t(function(e){return L.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),n,r,0)})),r}return null}const oe={transitional:Z,adapter:["xhr","http"],transformRequest:[function(e,t){const r=t.getContentType()||"",n=r.indexOf("application/json")>-1,s=L.isObject(e);if(s&&L.isHTMLForm(e)&&(e=new FormData(e)),L.isFormData(e))return n&&n?JSON.stringify(ie(e)):e;if(L.isArrayBuffer(e)||L.isBuffer(e)||L.isStream(e)||L.isFile(e)||L.isBlob(e))return e;if(L.isArrayBufferView(e))return e.buffer;if(L.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let i;if(s){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return G(e,new se.classes.URLSearchParams,Object.assign({visitor:function(e,t,r,n){return se.isNode&&L.isBuffer(e)?(this.append(t,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((i=L.isFileList(e))||r.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return G(i?{"files[]":e}:e,t&&new t,this.formSerializer)}}return s||n?(t.setContentType("application/json",!1),function(e,t,r){if(L.isString(e))try{return(0,JSON.parse)(e),L.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||oe.transitional,r=t&&t.forcedJSONParsing,n="json"===this.responseType;if(e&&L.isString(e)&&(r&&!this.responseType||n)){const r=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(e){if(r){if("SyntaxError"===e.name)throw B.from(e,B.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:se.classes.FormData,Blob:se.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};L.forEach(["delete","get","head","post","put","patch"],(e=>{oe.headers[e]={}}));var ae=oe;const ce=L.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),he=Symbol("internals");function le(e){return e&&String(e).trim().toLowerCase()}function ue(e){return!1===e||null==e?e:L.isArray(e)?e.map(ue):String(e)}function de(e,t,r,n,s){return L.isFunction(n)?n.call(this,t,r):(s&&(t=r),L.isString(t)?L.isString(n)?-1!==t.indexOf(n):L.isRegExp(n)?n.test(t):void 0:void 0)}class pe{constructor(e){e&&this.set(e)}set(e,t,r){const n=this;function s(e,t,r){const s=le(t);if(!s)throw new Error("header name must be a non-empty string");const i=L.findKey(n,s);(!i||void 0===n[i]||!0===r||void 0===r&&!1!==n[i])&&(n[i||t]=ue(e))}const i=(e,t)=>L.forEach(e,((e,r)=>s(e,r,t)));return L.isPlainObject(e)||e instanceof this.constructor?i(e,t):L.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim())?i((e=>{const t={};let r,n,s;return e&&e.split("\n").forEach((function(e){s=e.indexOf(":"),r=e.substring(0,s).trim().toLowerCase(),n=e.substring(s+1).trim(),!r||t[r]&&ce[r]||("set-cookie"===r?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)})),t})(e),t):null!=e&&s(t,e,r),this}get(e,t){if(e=le(e)){const r=L.findKey(this,e);if(r){const e=this[r];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(e);)t[n[1]]=n[2];return t}(e);if(L.isFunction(t))return t.call(this,e,r);if(L.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=le(e)){const r=L.findKey(this,e);return!(!r||void 0===this[r]||t&&!de(0,this[r],r,t))}return!1}delete(e,t){const r=this;let n=!1;function s(e){if(e=le(e)){const s=L.findKey(r,e);!s||t&&!de(0,r[s],s,t)||(delete r[s],n=!0)}}return L.isArray(e)?e.forEach(s):s(e),n}clear(e){const t=Object.keys(this);let r=t.length,n=!1;for(;r--;){const s=t[r];e&&!de(0,this[s],s,e,!0)||(delete this[s],n=!0)}return n}normalize(e){const t=this,r={};return L.forEach(this,((n,s)=>{const i=L.findKey(r,s);if(i)return t[i]=ue(n),void delete t[s];const o=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,r)=>t.toUpperCase()+r))}(s):String(s).trim();o!==s&&delete t[s],t[o]=ue(n),r[o]=!0})),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return L.forEach(this,((r,n)=>{null!=r&&!1!==r&&(t[n]=e&&L.isArray(r)?r.join(", "):r)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([e,t])=>e+": "+t)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach((e=>r.set(e))),r}static accessor(e){const t=(this[he]=this[he]={accessors:{}}).accessors,r=this.prototype;function n(e){const n=le(e);t[n]||(function(e,t){const r=L.toCamelCase(" "+t);["get","set","has"].forEach((n=>{Object.defineProperty(e,n+r,{value:function(e,r,s){return this[n].call(this,t,e,r,s)},configurable:!0})}))}(r,e),t[n]=!0)}return L.isArray(e)?e.forEach(n):n(e),this}}pe.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),L.reduceDescriptors(pe.prototype,(({value:e},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[r]=e}}})),L.freezeMethods(pe);var ge=pe;function me(e,t){const r=this||ae,n=t||r,s=ge.from(n.headers);let i=n.data;return L.forEach(e,(function(e){i=e.call(r,i,s.normalize(),t?t.status:void 0)})),s.normalize(),i}function fe(e){return!(!e||!e.__CANCEL__)}function ye(e,t,r){B.call(this,null==e?"canceled":e,B.ERR_CANCELED,t,r),this.name="CanceledError"}L.inherits(ye,B,{__CANCEL__:!0});var ve=se.hasStandardBrowserEnv?{write(e,t,r,n,s,i){const o=[e+"="+encodeURIComponent(t)];L.isNumber(r)&&o.push("expires="+new Date(r).toGMTString()),L.isString(n)&&o.push("path="+n),L.isString(s)&&o.push("domain="+s),!0===i&&o.push("secure"),document.cookie=o.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function be(e,t){return e&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}var Se=se.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let r;function n(r){let n=r;return e&&(t.setAttribute("href",n),n=t.href),t.setAttribute("href",n),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return r=n(window.location.href),function(e){const t=L.isString(e)?n(e):e;return t.protocol===r.protocol&&t.host===r.host}}():function(){return!0};function we(e,t){let r=0;const n=function(e,t){e=e||10;const r=new Array(e),n=new Array(e);let s,i=0,o=0;return t=void 0!==t?t:1e3,function(a){const c=Date.now(),h=n[o];s||(s=c),r[i]=a,n[i]=c;let l=o,u=0;for(;l!==i;)u+=r[l++],l%=e;if(i=(i+1)%e,i===o&&(o=(o+1)%e),c-s<t)return;const d=h&&c-h;return d?Math.round(1e3*u/d):void 0}}(50,250);return s=>{const i=s.loaded,o=s.lengthComputable?s.total:void 0,a=i-r,c=n(a);r=i;const h={loaded:i,total:o,progress:o?i/o:void 0,bytes:a,rate:c||void 0,estimated:c&&o&&i<=o?(o-i)/c:void 0,event:s};h[t?"download":"upload"]=!0,e(h)}}const xe={http:null,xhr:"undefined"!=typeof XMLHttpRequest&&function(e){return new Promise((function(t,r){let n=e.data;const s=ge.from(e.headers).normalize();let i,o,{responseType:a,withXSRFToken:c}=e;function h(){e.cancelToken&&e.cancelToken.unsubscribe(i),e.signal&&e.signal.removeEventListener("abort",i)}if(L.isFormData(n))if(se.hasStandardBrowserEnv||se.hasStandardBrowserWebWorkerEnv)s.setContentType(!1);else if(!1!==(o=s.getContentType())){const[e,...t]=o?o.split(";").map((e=>e.trim())).filter(Boolean):[];s.setContentType([e||"multipart/form-data",...t].join("; "))}let l=new XMLHttpRequest;if(e.auth){const t=e.auth.username||"",r=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";s.set("Authorization","Basic "+btoa(t+":"+r))}const u=be(e.baseURL,e.url);function d(){if(!l)return;const n=ge.from("getAllResponseHeaders"in l&&l.getAllResponseHeaders());!function(e,t,r){const n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(new B("Request failed with status code "+r.status,[B.ERR_BAD_REQUEST,B.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}((function(e){t(e),h()}),(function(e){r(e),h()}),{data:a&&"text"!==a&&"json"!==a?l.response:l.responseText,status:l.status,statusText:l.statusText,headers:n,config:e,request:l}),l=null}if(l.open(e.method.toUpperCase(),X(u,e.params,e.paramsSerializer),!0),l.timeout=e.timeout,"onloadend"in l?l.onloadend=d:l.onreadystatechange=function(){l&&4===l.readyState&&(0!==l.status||l.responseURL&&0===l.responseURL.indexOf("file:"))&&setTimeout(d)},l.onabort=function(){l&&(r(new B("Request aborted",B.ECONNABORTED,e,l)),l=null)},l.onerror=function(){r(new B("Network Error",B.ERR_NETWORK,e,l)),l=null},l.ontimeout=function(){let t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const n=e.transitional||Z;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),r(new B(t,n.clarifyTimeoutError?B.ETIMEDOUT:B.ECONNABORTED,e,l)),l=null},se.hasStandardBrowserEnv&&(c&&L.isFunction(c)&&(c=c(e)),c||!1!==c&&Se(u))){const t=e.xsrfHeaderName&&e.xsrfCookieName&&ve.read(e.xsrfCookieName);t&&s.set(e.xsrfHeaderName,t)}void 0===n&&s.setContentType(null),"setRequestHeader"in l&&L.forEach(s.toJSON(),(function(e,t){l.setRequestHeader(t,e)})),L.isUndefined(e.withCredentials)||(l.withCredentials=!!e.withCredentials),a&&"json"!==a&&(l.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&l.addEventListener("progress",we(e.onDownloadProgress,!0)),"function"==typeof e.onUploadProgress&&l.upload&&l.upload.addEventListener("progress",we(e.onUploadProgress)),(e.cancelToken||e.signal)&&(i=t=>{l&&(r(!t||t.type?new ye(null,e,l):t),l.abort(),l=null)},e.cancelToken&&e.cancelToken.subscribe(i),e.signal&&(e.signal.aborted?i():e.signal.addEventListener("abort",i)));const p=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(u);p&&-1===se.protocols.indexOf(p)?r(new B("Unsupported protocol "+p+":",B.ERR_BAD_REQUEST,e)):l.send(n||null)}))}};L.forEach(xe,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}}));const Ce=e=>`- ${e}`,Ee=e=>L.isFunction(e)||null===e||!1===e;var Ae=e=>{e=L.isArray(e)?e:[e];const{length:t}=e;let r,n;const s={};for(let i=0;i<t;i++){let t;if(r=e[i],n=r,!Ee(r)&&(n=xe[(t=String(r)).toLowerCase()],void 0===n))throw new B(`Unknown adapter '${t}'`);if(n)break;s[t||"#"+i]=n}if(!n){const e=Object.entries(s).map((([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build")));throw new B("There is no suitable adapter to dispatch the request "+(t?e.length>1?"since :\n"+e.map(Ce).join("\n"):" "+Ce(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return n};function Te(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new ye(null,e)}function Oe(e){return Te(e),e.headers=ge.from(e.headers),e.data=me.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),Ae(e.adapter||ae.adapter)(e).then((function(t){return Te(e),t.data=me.call(e,e.transformResponse,t),t.headers=ge.from(t.headers),t}),(function(t){return fe(t)||(Te(e),t&&t.response&&(t.response.data=me.call(e,e.transformResponse,t.response),t.response.headers=ge.from(t.response.headers))),Promise.reject(t)}))}const Ne=e=>e instanceof ge?e.toJSON():e;function Pe(e,t){t=t||{};const r={};function n(e,t,r){return L.isPlainObject(e)&&L.isPlainObject(t)?L.merge.call({caseless:r},e,t):L.isPlainObject(t)?L.merge({},t):L.isArray(t)?t.slice():t}function s(e,t,r){return L.isUndefined(t)?L.isUndefined(e)?void 0:n(void 0,e,r):n(e,t,r)}function i(e,t){if(!L.isUndefined(t))return n(void 0,t)}function o(e,t){return L.isUndefined(t)?L.isUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function a(r,s,i){return i in t?n(r,s):i in e?n(void 0,r):void 0}const c={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(e,t)=>s(Ne(e),Ne(t),!0)};return L.forEach(Object.keys(Object.assign({},e,t)),(function(n){const i=c[n]||s,o=i(e[n],t[n],n);L.isUndefined(o)&&i!==a||(r[n]=o)})),r}const Re={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{Re[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}}));const Ie={};Re.transitional=function(e,t,r){function n(e,t){return"[Axios v1.6.4] Transitional option '"+e+"'"+t+(r?". "+r:"")}return(r,s,i)=>{if(!1===e)throw new B(n(s," has been removed"+(t?" in "+t:"")),B.ERR_DEPRECATED);return t&&!Ie[s]&&(Ie[s]=!0,console.warn(n(s," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,s,i)}};var Fe={assertOptions:function(e,t,r){if("object"!=typeof e)throw new B("options must be an object",B.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let s=n.length;for(;s-- >0;){const i=n[s],o=t[i];if(o){const t=e[i],r=void 0===t||o(t,i,e);if(!0!==r)throw new B("option "+i+" must be "+r,B.ERR_BAD_OPTION_VALUE)}else if(!0!==r)throw new B("Unknown option "+i,B.ERR_BAD_OPTION)}},validators:Re};const ke=Fe.validators;class De{constructor(e){this.defaults=e,this.interceptors={request:new Q,response:new Q}}request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=Pe(this.defaults,t);const{transitional:r,paramsSerializer:n,headers:s}=t;void 0!==r&&Fe.assertOptions(r,{silentJSONParsing:ke.transitional(ke.boolean),forcedJSONParsing:ke.transitional(ke.boolean),clarifyTimeoutError:ke.transitional(ke.boolean)},!1),null!=n&&(L.isFunction(n)?t.paramsSerializer={serialize:n}:Fe.assertOptions(n,{encode:ke.function,serialize:ke.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let i=s&&L.merge(s.common,s[t.method]);s&&L.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete s[e]})),t.headers=ge.concat(i,s);const o=[];let a=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(a=a&&e.synchronous,o.unshift(e.fulfilled,e.rejected))}));const c=[];let h;this.interceptors.response.forEach((function(e){c.push(e.fulfilled,e.rejected)}));let l,u=0;if(!a){const e=[Oe.bind(this),void 0];for(e.unshift.apply(e,o),e.push.apply(e,c),l=e.length,h=Promise.resolve(t);u<l;)h=h.then(e[u++],e[u++]);return h}l=o.length;let d=t;for(u=0;u<l;){const e=o[u++],t=o[u++];try{d=e(d)}catch(e){t.call(this,e);break}}try{h=Oe.call(this,d)}catch(e){return Promise.reject(e)}for(u=0,l=c.length;u<l;)h=h.then(c[u++],c[u++]);return h}getUri(e){return X(be((e=Pe(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}L.forEach(["delete","get","head","options"],(function(e){De.prototype[e]=function(t,r){return this.request(Pe(r||{},{method:e,url:t,data:(r||{}).data}))}})),L.forEach(["post","put","patch"],(function(e){function t(t){return function(r,n,s){return this.request(Pe(s||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:n}))}}De.prototype[e]=t(),De.prototype[e+"Form"]=t(!0)}));var Me=De;class qe{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const r=this;this.promise.then((e=>{if(!r._listeners)return;let t=r._listeners.length;for(;t-- >0;)r._listeners[t](e);r._listeners=null})),this.promise.then=e=>{let t;const n=new Promise((e=>{r.subscribe(e),t=e})).then(e);return n.cancel=function(){r.unsubscribe(t)},n},e((function(e,n,s){r.reason||(r.reason=new ye(e,n,s),t(r.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}static source(){let e;return{token:new qe((function(t){e=t})),cancel:e}}}var Le=qe;const Be={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Be).forEach((([e,t])=>{Be[t]=e}));var je=Be;const _e=function e(t){const r=new Me(t),s=n(Me.prototype.request,r);return L.extend(s,Me.prototype,r,{allOwnKeys:!0}),L.extend(s,r,null,{allOwnKeys:!0}),s.create=function(r){return e(Pe(t,r))},s}(ae);_e.Axios=Me,_e.CanceledError=ye,_e.CancelToken=Le,_e.isCancel=fe,_e.VERSION="1.6.4",_e.toFormData=G,_e.AxiosError=B,_e.Cancel=_e.CanceledError,_e.all=function(e){return Promise.all(e)},_e.spread=function(e){return function(t){return e.apply(null,t)}},_e.isAxiosError=function(e){return L.isObject(e)&&!0===e.isAxiosError},_e.mergeConfig=Pe,_e.AxiosHeaders=ge,_e.formToJSON=e=>ie(L.isHTMLForm(e)?new FormData(e):e),_e.getAdapter=Ae,_e.HttpStatusCode=je,_e.default=_e,e.exports=_e},2638:e=>{"use strict";e.exports=JSON.parse('{"name":"axios","version":"0.21.4","description":"Promise based HTTP client for the browser and node.js","main":"index.js","scripts":{"test":"grunt test","start":"node ./sandbox/server.js","build":"NODE_ENV=production grunt build","preversion":"npm test","version":"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json","postversion":"git push && git push --tags","examples":"node ./examples/server.js","coveralls":"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js","fix":"eslint --fix lib/**/*.js"},"repository":{"type":"git","url":"https://github.com/axios/axios.git"},"keywords":["xhr","http","ajax","promise","node"],"author":"Matt Zabriskie","license":"MIT","bugs":{"url":"https://github.com/axios/axios/issues"},"homepage":"https://axios-http.com","devDependencies":{"coveralls":"^3.0.0","es6-promise":"^4.2.4","grunt":"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1","karma":"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2","minimist":"^1.2.0","mocha":"^8.2.1","sinon":"^4.5.0","terser-webpack-plugin":"^4.2.3","typescript":"^4.0.5","url-search-params":"^0.10.0","webpack":"^4.44.2","webpack-dev-server":"^3.11.0"},"browser":{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},"jsdelivr":"dist/axios.min.js","unpkg":"dist/axios.min.js","typings":"./index.d.ts","dependencies":{"follow-redirects":"^1.14.0"},"bundlesize":[{"path":"./dist/axios.min.js","threshold":"5kB"}]}')}},n={};function s(e){var t=n[e];if(void 0!==t)return t.exports;var i=n[e]={id:e,loaded:!1,exports:{}};return r[e].call(i.exports,i,i.exports,s),i.loaded=!0,i.exports}s.m=r,s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((t,r)=>(s.f[r](e,t),t)),[])),s.u=e=>e+".fsbot.min.js",s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="fsbot:",s.l=(r,n,i,o)=>{if(e[r])e[r].push(n);else{var a,c;if(void 0!==i)for(var h=document.getElementsByTagName("script"),l=0;l<h.length;l++){var u=h[l];if(u.getAttribute("src")==r||u.getAttribute("data-webpack")==t+i){a=u;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,s.nc&&a.setAttribute("nonce",s.nc),a.setAttribute("data-webpack",t+i),a.src=r),e[r]=[n];var d=(t,n)=>{a.onerror=a.onload=null,clearTimeout(p);var s=e[r];if(delete e[r],a.parentNode&&a.parentNode.removeChild(a),s&&s.forEach((e=>e(n))),t)return t(n)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),c&&document.head.appendChild(a)}},s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var n=r.length-1;n>-1&&!e;)e=r[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),(()=>{var e={179:0};s.f.j=(t,r)=>{var n=s.o(e,t)?e[t]:void 0;if(0!==n)if(n)r.push(n[2]);else{var i=new Promise(((r,s)=>n=e[t]=[r,s]));r.push(n[2]=i);var o=s.p+s.u(t),a=new Error;s.l(o,(r=>{if(s.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var i=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;a.message="Loading chunk "+t+" failed.\n("+i+": "+o+")",a.name="ChunkLoadError",a.type=i,a.request=o,n[1](a)}}),"chunk-"+t,t)}};var t=(t,r)=>{var n,i,[o,a,c]=r,h=0;if(o.some((t=>0!==e[t]))){for(n in a)s.o(a,n)&&(s.m[n]=a[n]);c&&c(s)}for(t&&t(r);h<o.length;h++)i=o[h],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0},r=self.webpackChunkfsbot=self.webpackChunkfsbot||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var i=s(1478),o=window;for(var a in i)o[a]=i[a];i.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})})();
//# sourceMappingURL=fsbot.min.js.map